var A=Object.defineProperty,B=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var M=(n,a,e)=>a in n?A(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,g=(n,a)=>{for(var e in a||(a={}))j.call(a,e)&&M(n,e,a[e]);if(E)for(var e of E(a))k.call(a,e)&&M(n,e,a[e]);return n},P=(n,a)=>B(n,O(a));import{R as q,bs as G,pr as Y,ps as _,l5 as U,i0 as Z,bw as H,k as J,pt as K,pu as L}from"./vendor.d5f590a2.js";import{T as Q,s as W,m as X,c as aa,V as na,g as ea,h as ia,y as ta,D as oa,z as sa}from"./utils.636e4519.js";import"./ClassBreaksDefinition.662b56be.js";let I=null;function la(n,a,e){return n.x<0?n.x+=a:n.x>e&&(n.x-=a),n}function ra(n,a,e,o){const t=_(e)?U(e):null,r=t?Math.round((t.valid[1]-t.valid[0])/a.scale[0]):null;return n.map(l=>{const i=new q(G(l.geometry));return Y(a,i,i,i.hasZ,i.hasM),l.geometry=t?la(i,r,o[0]):i,l})}function ua(n,a=18,e,o,t,r){const l=new Float64Array(t*r);a=Math.round(Z(a));let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=0,m=0,d=0,f=0;const c=K(o,e);for(const{geometry:v,attributes:z}of n){const{x:y,y:w}=v,$=Math.max(0,y-a),b=Math.max(0,w-a),D=Math.min(r,w+a),N=Math.min(t,y+a),C=+c(z);for(let x=b;x<D;x++)for(let T=$;T<N;T++){const F=x*t+T,S=L(T-y,x-w,a),R=l[F];u=l[F]+=S*C;const V=u-R;m+=V,d+=V*V,u<i&&(i=u),u>s&&(s=u),f++}}if(!f)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const p=(s-i)/2;return{mean:m/f,stdDev:Math.sqrt((d-m*m/f)/f),min:i,max:s,mid:p,count:f}}async function h(n,a){if(!a)return[];const e=n.field,o=n.valueExpression,t=n.normalizationType,r=n.normalizationField,l=n.normalizationTotal,i=[],s=n.viewInfoParams;let u=null,m=null;if(o){if(!I){const{arcadeUtils:c}=await H();I=c}u=I.createFunction(o),m=s&&I.getViewInfo({viewingMode:s.viewingMode,scale:s.scale,spatialReference:new J(s.spatialReference)})}const d=n.fieldInfos,f=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&d?{fields:d}:null;return a.forEach(c=>{const p=c.attributes;let v;if(o){const z=f?P(g({},c),{layer:f}):c,y=I.createExecContext(z,m);v=I.executeFunction(u,y)}else p&&(v=p[e]);if(t&&isFinite(v)){const z=p&&parseFloat(p[r]);v=Q(v,t,z,l)}i.push(v)}),i}async function pa(n){const{attribute:a,features:e}=n,{normalizationType:o,normalizationField:t,minValue:r,maxValue:l,fieldType:i}=a,s=await h({field:a.field,valueExpression:a.valueExpression,normalizationType:o,normalizationField:t,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=W({normalizationType:o,normalizationField:t,minValue:r,maxValue:l}),m={value:.5,fieldType:i},d=i==="esriFieldTypeString"?X({values:s,supportsNullCount:u,percentileParams:m}):aa({values:s,minValue:r,maxValue:l,useSampleStdDev:!o,supportsNullCount:u,percentileParams:m});return na(d,i==="esriFieldTypeDate")}async function va(n){const{attribute:a,features:e}=n,o=await h({field:a.field,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),t=ea(o);return ia(t,a.domain,a.returnAllCodedValues)}async function Ia(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i}=a,s=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:l,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=ta(s,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return oa(u,i)}async function za(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i}=a,s=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:l,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e);return sa(s,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function ya(n){const{attribute:a,features:e}=n,{field:o,radius:t,fieldOffset:r,transform:l,spatialReference:i,size:s}=a,u=ra(e,l,i,s),{count:m,min:d,max:f,mean:c,stdDev:p}=ua(u,t,r,o,s[0],s[1]);return{count:m,min:d,max:f,avg:c,stddev:p}}export{Ia as classBreaks,ya as heatmapStatistics,za as histogram,pa as summaryStatistics,va as uniqueValues};
