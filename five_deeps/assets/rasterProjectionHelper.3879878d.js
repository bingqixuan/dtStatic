var Pt=Object.defineProperty,bt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var Et=Object.prototype.hasOwnProperty,Nt=Object.prototype.propertyIsEnumerable;var st=(t,n,e)=>n in t?Pt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,J=(t,n)=>{for(var e in n||(n={}))Et.call(n,e)&&st(t,e,n[e]);if(it)for(var e of it(n))Nt.call(n,e)&&st(t,e,n[e]);return t},X=(t,n)=>bt(t,St(n));import{jm as V,fn as Gt,M as Y,c0 as j,a2 as G,a0 as S,c3 as $,v as kt,R as E,br as Tt,ao as vt,jx as T,jy as k,jz as rt,jA as _t,jB as Ct,k as zt,jC as at}from"./vendor.d5f590a2.js";var Q;function pt(t,n,e){return!Tt(t,n,e)}function O(t,n,e){const s=pt(t,n,e);if(s&&!V())throw new vt("rasterprojectionhelper-project","projection engine is not loaded");return s}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(Q||(Q={}));const lt=(t,n,e,s=0)=>{if(e[0]===1)return[0,0];let r=1,o=-1,i=1,f=-1;for(let c=0;c<t.length;c+=2)isNaN(t[c])||(r=r>t[c]?t[c]:r,o=o>t[c]?o:t[c],i=i>t[c+1]?t[c+1]:i,f=f>t[c+1]?f:t[c+1]);const{cols:a,rows:l}=n,u=(o-r)/a/e[0],M=(f-i)/l/e[1],g=2*s;let m=0,x=!1,p=[0,0];for(let c=0;c<a-3;c++){for(let w=0;w<l-3;w++){const y=c*l*2+2*w,h=(t[y]+t[y+4]+t[y+4*l]+t[y+4*l+4])/4,d=(t[y+1]+t[y+5]+t[y+4*l+1]+t[y+4*l+5])/4,R=Math.abs((h-t[y+2*l+2])/u),P=Math.abs((d-t[y+2*l+3])/M);if(R+P>m&&(m=R+P,p=[R,P]),g&&m>g){x=!0;break}}if(x)break}return p},jt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},L=32,B=4,K=B,U=new Map,D=new Map;async function Jt(){if(V())return null;await Gt()}function Xt(t,n,e){return O(t.spatialReference,n)?e?at(n,t.spatialReference,t):at(t.spatialReference,n,t):null}function Kt(t,n,e,s=null){const r=t.spatialReference;if(r.equals(n))return t;O(r,n,s);const o=e.center,i=new Y({xmin:o.x-t.x/2,xmax:o.x+t.x/2,ymin:o.y-t.y/2,ymax:o.y+t.y/2,spatialReference:r}),f=j(i,n,s),a=v(n);let l;if(G(f)||S(a)&&f.width>=a){const u=$(r)/$(n);l={x:t.x*u,y:t.y*u}}else l={x:f.width,y:f.height};return l}function N(t,n=.01){return $(t)?n/$(t):0}function ct(t,n,e=null,s=!0){const r=t.spatialReference;if(r.equals(n))return t;O(r,n,e);const o=j(t,n,e);if(!s||!o)return o;const i=I(r,!0),f=I(n,!0),a=N(r);return a&&S(i)&&S(f)&&(o.x>0&&Math.abs(t.x-i[0])<a?o.x-=f[1]-f[0]:o.x<0&&Math.abs(t.x-i[1])<a&&(o.x+=f[1]-f[0])),o}function Ot(t){const{inSR:n,outSR:e,datumTransformation:s,preferPE:r}=t;if(n.equals(e)){const{points:o}=Z(t,null);return o}if(n.isWebMercator&&e.isWGS84||n.isWGS84&&e.isWebMercator)return $t(t);if(O(n,e,s)&&r){if(n.isGeographic)return ft(t);const o=z(n);if(S(o))return ft(t)}return Wt(t)}function Wt(t){const{points:n}=Z(t,null),e=n.map(s=>new E(s[0],s[1],t.inSR));return j(e,t.outSR,t.datumTransformation).map(s=>s?[s.x,s.y]:[NaN,NaN])}function ft(t){const{inSR:n,outSR:e,datumTransformation:s}=t,r=z(n),{points:o,mask:i}=Z(t,r);if(!n.isGeographic){const a=n.wkid?T.coordsys(n.wkid):T.fromString(n.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,n.wkt);rt.projToGeog(a,o.length,o)}if(S(s)&&s.steps.length&&s.steps.forEach(a=>{const l=a.wkid?T.geogtran(a.wkid):T.fromString(k.PE_TYPE_GEOGTRAN,a.wkt);_t.geogToGeog(l,o.length,o,null,a.isInverse?k.PE_TRANSFORM_2_TO_1:k.PE_TRANSFORM_1_TO_2)}),!e.isGeographic){const a=z(e,!0),l=S(a)&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90];At(o,l);const u=e.wkid?T.coordsys(e.wkid):T.fromString(e.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,e.wkt);rt.geogToProj(u,o.length,o)}let f=o;if(i&&o.length!==i.length){f=[];for(let a=0,l=0;a<i.length;a++)i[a]?f.push(o[l++]):f.push([NaN,NaN])}return f}function $t(t){const{cols:n,rows:e,xres:s,yres:r,usePixelCenter:o,inSR:i,outSR:f}=t;let{xmin:a,ymax:l}=t;o&&(a+=s/2,l-=r/2);const u=[],M=[],g=Math.max(n,e);for(let x=0;x<g;x++){const p=a+s*Math.min(n,x),c=l-r*Math.min(e,x),w=j(new E({x:p,y:c,spatialReference:i}),f);x<=n&&u.push(w.x),x<=e&&M.push(w.y)}const m=[];for(let x=0;x<n;x++)for(let p=0;p<e;p++)m.push([u[x],M[p]]);return m}function z(t,n=!1){let e=t.wkid||t.wkt;if(!e||t.isGeographic)return null;if(e=String(e),U.has(e)){const i=U.get(e);return n?i==null?void 0:i.gcs:i==null?void 0:i.pcs}const s=t.wkid?T.coordsys(t.wkid):T.fromString(t.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,t.wkt),r=ut(s,N(t,1e-4)),o=ut(s,0,!0);return U.set(e,{pcs:r,gcs:o}),n?o:r}function ut(t,n=0,e=!1){const s=Ct.generate(t),r=e?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!(r!=null&&r.length))return null;let o=!1,i=r.find(c=>c.getInclusive()===1&&c.getKind()===1);if(!i){if(i=r.find(c=>c.getInclusive()===1&&c.getKind()===0),!i)return null;o=!0}const f=e?0:(s.getNorthPoleLocation()===2?1:0)|(s.getSouthPoleLocation()===2?2:0),a=s.isPannableRectangle(),l=i.getCoord();if(o)return{isEnvelope:o,isPannable:a,vertices:l,coef:null,bbox:[l[0][0]-n,l[0][1]-n,l[1][0]+n,l[1][1]+n],poleLocation:f};let u=0;const M=[];let[g,m]=l[0],[x,p]=l[0];for(let c=0,w=l.length;c<w;c++){u++,u===w&&(u=0);const[y,h]=l[c],[d,R]=l[u];if(R===h)M.push([y,d,h,R,2]);else{const P=(d-y)/(R-h||1e-4),_=y-P*h;h<R?M.push([P,_,h,R,0]):M.push([P,_,R,h,1])}g=g<y?g:y,m=m<h?m:h,x=x>y?x:y,p=p>h?p:h}return{isEnvelope:!1,isPannable:a,vertices:l,coef:M,bbox:[g,m,x,p],poleLocation:f}}function Z(t,n){const e=[],{cols:s,rows:r,xres:o,yres:i,usePixelCenter:f}=t;let{xmin:a,ymax:l}=t;if(f&&(a+=o/2,l-=i/2),G(n)){for(let m=0;m<s;m++)for(let x=0;x<r;x++)e.push([a+o*m,l-i*x]);return{points:e}}const u=new Uint8Array(s*r);if(n.isEnvelope){const{bbox:[m,x,p,c]}=n;for(let w=0,y=0;w<s;w++){const h=a+o*w,d=n.isPannable||h>=m&&h<=p;for(let R=0;R<r;R++,y++){const P=l-i*R;d&&P>=x&&P<=c&&(e.push([h,P]),u[y]=1)}}return{points:e,mask:u}}const{coef:M}=n,g=[];for(let m=0;m<r;m++){const x=l-i*m,p=[],c=[];for(let y=0;y<M.length;y++){const[h,d,R,P,_]=M[y];if(x===R&&R===P)p.push(h),p.push(d),c.push(2),c.push(2);else if(x>=R&&x<=P){const A=h*x+d;p.push(A),c.push(_)}}let w=p;if(p.length>2){let y=c[0]===2?0:c[0],h=p[0];w=[];for(let d=1;d<c.length;d++)c[d]===2&&d!==c.length-1||(c[d]!==y&&(w.push(y===0?Math.min(h,p[d-1]):Math.max(h,p[d-1])),y=c[d],h=p[d]),d===c.length-1&&w.push(c[d]===0?Math.min(h,p[d]):Math.max(h,p[d])));w.sort((d,R)=>d-R)}else p[0]>p[1]&&(w=[p[1],p[0]]);g.push(w)}for(let m=0,x=0;m<s;m++){const p=a+o*m;for(let c=0;c<r;c++,x++){const w=l-i*c,y=g[c];if(y.length===2)p>=y[0]&&p<=y[1]&&(e.push([p,w]),u[x]=1);else if(y.length>2){let h=!1;for(let d=0;d<y.length;d+=2)if(p>=y[d]&&p<=y[d+1]){h=!0;break}h&&(e.push([p,w]),u[x]=1)}}}return{points:e,mask:u}}function At(t,n){const[e,s]=n;for(let r=0;r<t.length;r++){const o=t[r][1];(o<e||o>s)&&(t[r]=[NaN,NaN])}}function gt(t){const n=v(t[0].spatialReference);if(t.length<2||G(n))return t[0];let{xmin:e,xmax:s,ymin:r,ymax:o}=t[0];for(let i=1;i<t.length;i++){const f=t[i];s=f.xmax+n*i,r=Math.min(r,f.ymin),o=Math.max(o,f.ymax)}return new Y({xmin:e,xmax:s,ymin:r,ymax:o,spatialReference:t[0].spatialReference})}function Lt(t,n,e=null,s=!0){const r=t.spatialReference;if(r.equals(n))return t;const o=It(t),i=v(r,!0),f=v(n);if(o===0||G(i)||G(f)){const l=xt(t,n,e,s);if(G(i)&&S(f)&&Math.abs(l.width-f)<N(n)&&V()){const u=z(r);if(S(u)&&u.poleLocation===Q.None&&t.width<(u.bbox[2]-u.bbox[0])/2)return Bt(t,n)||l}return l}const a=t.clone().normalize();if(a.length===1&&t.xmax<i&&t.xmax-i/2>N(r)){const{xmin:l,xmax:u}=t;for(let M=0;M<=o;M++){const g=M===0?l:-i/2,m=M===o?u-i*M:i/2;a[M]=new Y({xmin:g,xmax:m,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}return gt(a.map(l=>xt(l,n,e,s)).filter(l=>!!l))}function Bt(t,n){const e=v(n);if(G(e))return null;let{xmin:s,ymin:r,xmax:o,ymax:i}=t;const f=t.spatialReference,a=new kt({spatialReference:f,rings:[[[s,r],[o,r],[o,i],[s,i],[s,r]]]}),l=j(a,n);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;const{rings:u}=l,M=N(f),g=new Y({spatialReference:n});for(let m=0;m<2;m++){s=o=u[m][0][0],r=i=u[m][0][1];for(let x=0;x<u[m].length;x++)s=s>u[m][x][0]?u[m][x][0]:s,o=o<u[m][x][0]?u[m][x][0]:o,r=r>u[m][x][1]?u[m][x][1]:r,i=i<u[m][x][1]?u[m][x][1]:i;if(m===0)g.ymin=r,g.ymax=i,g.xmin=s,g.xmax=o;else if(g.ymin=Math.min(g.ymin,r),g.ymax=Math.max(g.ymax,i),Math.abs(o-e/2)<M)g.xmin=s,g.xmax=g.xmax+e;else{if(!(Math.abs(s+e/2)<M))return null;g.xmax=o+e}}return g}function xt(t,n,e=null,s=!0,r=!0){const o=t.spatialReference;if(o.equals(n))return t;O(o,n,e);const i=j(t,n,e);if(r&&n.isWebMercator&&i&&(i.ymax=Math.min(20037508342787e-6,i.ymax),i.ymin=Math.max(-20037508342787e-6,i.ymin),i.ymin>=i.ymax))return null;if(!s||!i)return i;const f=I(o,!0),a=I(n,!0);if(G(f)||G(a))return i;const l=N(o,.001),u=N(o,500),M=N(n,.001);if(Math.abs(i.xmin-a[0])<M&&Math.abs(i.xmax-a[1])<M){const g=Math.abs(t.xmin-f[0]),m=Math.abs(f[1]-t.xmax);if(g<l&&m>u){i.xmin=a[0];const x=[];x.push(new E(t.xmax,t.ymin,o)),x.push(new E(t.xmax,(t.ymin+t.ymax)/2,o)),x.push(new E(t.xmax,t.ymax,o));const p=x.map(c=>ct(c,n,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);i.xmax=Math.max.apply(null,p)}if(m<l&&g>u){i.xmax=a[1];const x=[];x.push(new E(t.xmin,t.ymin,o)),x.push(new E(t.xmin,(t.ymin+t.ymax)/2,o)),x.push(new E(t.xmin,t.ymax,o));const p=x.map(c=>ct(c,n,e)).filter(c=>!isNaN(c==null?void 0:c.x)).map(c=>c.x);i.xmin=Math.min.apply(null,p)}}else{const g=N(n,.001);Math.abs(i.xmin-a[0])<g&&(i.xmin=a[0]),Math.abs(i.xmax-a[1])<g&&(i.xmax=a[1])}return i}function v(t,n=!1){const e=n?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*e:t.wkid&&t.isGeographic?360:2*jt[t.wkid]||null}function I(t,n=!1){if(t.isGeographic)return[-180,180];const e=v(t,n);return S(e)?[-e/2,e/2]:null}function mt(t,n,e,s){let r=(t-n)/e;return r-Math.floor(r)!=0?r=Math.floor(r):s&&(r-=1),r}function It(t,n=!1){const e=v(t.spatialReference);if(G(e))return 0;const s=n?0:-(e/2),r=N(t.spatialReference),o=!n&&Math.abs(t.xmax-e/2)<r?e/2:t.xmax,i=!n&&Math.abs(t.xmin+e/2)<r?-e/2:t.xmin;return mt(o,s,e,!0)-mt(i,s,e,!1)}function Ut(t){const n=t.storageInfo.origin.x,e=v(t.spatialReference,!0);if(G(e))return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const s=e/2,{nativePixelSize:r,storageInfo:o,extent:i}=t,{maximumPyramidLevel:f,blockWidth:a,pyramidScalingFactor:l}=o;let u=r.x;const M=[],g=S(t.transform)&&t.transform.type==="gcs-shift",m=n+(g?0:s),x=g?e-n:s-n;for(let p=0;p<=f;p++){const c=(i.xmax-n)/u/a,w=c-Math.floor(c)==0?c:Math.ceil(c),y=x/u/a,h=y-Math.floor(y)==0?y:Math.ceil(y),d=Math.floor(m/u/a),R=Math.round(m/u)%a,P=(a-Math.round(x/u)%a)%a;M.push({resolutionX:u,blockWidth:a,datsetColumnCount:w,worldColumnCountFromOrigin:h,leftMargin:R,rightPadding:P,originColumnOffset:d}),u*=l}return{originX:n,halfWorldWidth:s,pyramidsInfo:M,hasGCSSShiftTransform:g}}function Yt(t){if(!t||t.isGeographic)return t;const n=String(t.wkid||t.wkt);let e;return D.has(n)?e=D.get(n):(e=(t.wkid?T.coordsys(t.wkid):T.fromString(k.PE_TYPE_PROJCS,t.wkt)).getGeogcs().getCode(),D.set(n,e)),new zt({wkid:e})}function Dt(t){const n=t.isAdaptive&&t.spacing==null;let e=t.spacing||[L,L],s=H(t),r={cols:s.size[0]+1,rows:s.size[1]+1};const o=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let i=s.outofBoundPointCount===s.offsets.length/2||n&&o?[0,0]:lt(s.offsets,r,e,K);const f=(i[0]+i[1])/2,a=t.projectedExtent.spatialReference,l=t.srcBufferExtent.spatialReference;if(n&&(o||f>K)&&(pt(a,l,t.datumTransformation)&&(a.isGeographic||S(z(a))),e=[B,B],s=H(X(J({},t),{spacing:e})),r={cols:s.size[0]+1,rows:s.size[1]+1},i=lt(s.offsets,r,e,K)),s.error=i,e[0]>1&&(s.coefficients=ht(s.offsets,r,o)),t.includeGCSGrid&&!a.isGeographic&&!a.isWebMercator)if(l.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:e};else{const u=z(a);if(S(u)&&!u.isEnvelope){const M=Yt(a),g=Lt(t.projectedExtent,M),{offsets:m}=H(X(J({},t),{srcBufferExtent:g,spacing:e})),x=ht(m,r,o);s.gcsGrid={offsets:m,coefficients:x,spacing:e}}}return s}function H(t){const{projectedExtent:n,srcBufferExtent:e,pixelSize:s,datumTransformation:r,rasterTransform:o}=t,i=n.spatialReference,f=e.spatialReference,a=O(i,f),{xmin:l,ymin:u,xmax:M,ymax:g}=n,m=v(f),x=S(m)&&(t.hasWrapAround||(o==null?void 0:o.type)==="gcs-shift"),p=t.spacing||[L,L],c=p[0]*s.x,w=p[1]*s.y,y=p[0]===1,h=Math.ceil((M-l)/c-.1/p[0])+(y?0:1),d=Math.ceil((g-u)/w-.1/p[1])+(y?0:1),R=Ot({cols:h,rows:d,xmin:l,ymax:g,xres:c,yres:w,inSR:i,outSR:f,datumTransformation:r,preferPE:p[0]<=B,usePixelCenter:y}),P=[];let _,A=0;const tt=y?-1:NaN,{xmin:nt,xmax:F,ymax:yt,width:dt,height:Mt}=e,wt=N(f,500),Rt=S(m)&&nt>0&&F>m/2;let et=!1;if(a){const C=z(i);et=S(C)&&C.poleLocation>0}for(let C=0;C<h;C++){const q=[];for(let W=0;W<d;W++){let b=R[C*d+W];if(x&&b[0]>F&&b[0]>m/2-wt?b[0]-=m:x&&C===0&&b[0]<0&&Rt&&!o&&(b[0]+=m),!b||isNaN(b[0])||isNaN(b[1]))P.push(tt),P.push(tt),q.push(null),A++;else{if(o){const ot=o.inverseTransform(new E({x:b[0],y:b[1],spatialReference:f}));b=[ot.x,ot.y]}q.push(b),C>0&&x&&_[W]&&b[0]<_[W][0]&&(b[0]+=m,et&&b[0]>F&&b[0]>m&&(b[0]-=m)),P.push((b[0]-nt)/dt),P.push((yt-b[1])/Mt)}}_=q}return{offsets:P,error:null,coefficients:null,outofBoundPointCount:A,spacing:p,size:y?[h,d]:[h-1,d-1]}}function ht(t,n,e){const{cols:s,rows:r}=n,o=new Float32Array((s-1)*(r-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let a=0;a<s-1;a++){for(let l=0;l<r-1;l++){let u=a*r*2+2*l;const M=t[u],g=t[u+1],m=t[u+2],x=t[u+3];u+=2*r;const p=t[u],c=t[u+1],w=t[u+2],y=t[u+3];let h=0,d=12*(l*(s-1)+a);for(let R=0;R<3;R++)o[d++]=i[h++]*M+i[h++]*m+i[h++]*w;h=0;for(let R=0;R<3;R++)o[d++]=i[h++]*g+i[h++]*x+i[h++]*y;h=0;for(let R=0;R<3;R++)o[d++]=f[h++]*M+f[h++]*p+f[h++]*w;h=0;for(let R=0;R<3;R++)o[d++]=f[h++]*g+f[h++]*c+f[h++]*y}if(e)for(let l=0;l<o.length;l++)isNaN(o[l])&&(o[l]=-1)}return o}function Ht(t){const n=t.clone().normalize();return n.length===1?n[0]:gt(n)}function Qt(t,n,e){const{storageInfo:s,pixelSize:r}=n;let o,i=!1;const{pyramidResolutions:f}=s;if(S(f)&&f.length){const g=(t.x+t.y)/2,m=f[f.length-1],x=(m.x+m.y)/2,p=(r.x+r.y)/2;if(g<=p)o=0;else if(g>=x)o=f.length,i=g/x>8;else{let w,y=p;for(let h=1;h<=f.length;h++){if(w=(f[h-1].x+f[h-1].y)/2,g<=w){g===w?o=h:e==="down"?(o=h-1,i=g/y>8):o=e==="up"||g-y>w-g||g/y>2?h:h-1;break}y=w}}const c=o===0?r:f[o-1];return i&&Math.min(c.x,c.y)*$(n.spatialReference)>19567&&(i=!1),{pyramidLevel:o,pyramidResolution:new E({x:c.x,y:c.y,spatialReference:n.spatialReference}),excessiveReading:i}}const a=Math.log(t.x/r.x)/Math.LN2,l=Math.log(t.y/r.y)/Math.LN2,u=n.storageInfo.maximumPyramidLevel||0;o=e==="down"?Math.floor(Math.min(a,l)):e==="up"?Math.ceil(Math.max(a,l)):Math.round((a+l)/2),o<0?o=0:o>u&&(i=o>u+3,o=u);const M=2**o;return{pyramidLevel:o,pyramidResolution:new E({x:M*n.nativePixelSize.x,y:M*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:i}}export{It as D,Lt as F,Ut as H,pt as M,Xt as T,Dt as V,v as X,ct as _,Ht as e,Jt as k,Qt as t,Kt as v};
