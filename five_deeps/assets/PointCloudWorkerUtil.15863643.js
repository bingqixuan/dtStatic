import{a0 as v,fH as w,jb as A,a2 as x,jc as O,jd as R}from"./vendor.d5f590a2.js";import{a as S,b as V,d as B}from"./PointCloudUniqueValueRenderer.01723c98.js";function U(l,o,u,c){const{rendererJSON:d,isRGBRenderer:g}=l;let r=null,i=null;if(o&&g)r=o;else if(o&&d.type==="pointCloudUniqueValueRenderer"){i=S.fromJSON(d);const e=i.colorUniqueValueInfos;r=new Uint8Array(3*c);const a=m(i.fieldTransformType);for(let t=0;t<c;t++){const s=(a?a(o[t]):o[t])+"";for(let n=0;n<e.length;n++)if(e[n].values.includes(s)){r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;break}}}else if(o&&d.type==="pointCloudStretchRenderer"){i=V.fromJSON(d);const e=i.stops;r=new Uint8Array(3*c);const a=m(i.fieldTransformType);for(let t=0;t<c;t++){const s=a?a(o[t]):o[t],n=e.length-1;if(s<e[0].value)r[3*t]=e[0].color.r,r[3*t+1]=e[0].color.g,r[3*t+2]=e[0].color.b;else if(s>=e[n].value)r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;else for(let f=1;f<e.length;f++)if(s<e[f].value){const b=(s-e[f-1].value)/(e[f].value-e[f-1].value);r[3*t]=e[f].color.r*b+e[f-1].color.r*(1-b),r[3*t+1]=e[f].color.g*b+e[f-1].color.g*(1-b),r[3*t+2]=e[f].color.b*b+e[f-1].color.b*(1-b);break}}}else if(o&&d.type==="pointCloudClassBreaksRenderer"){i=B.fromJSON(d);const e=i.colorClassBreakInfos;r=new Uint8Array(3*c);const a=m(i.fieldTransformType);for(let t=0;t<c;t++){const s=a?a(o[t]):o[t];for(let n=0;n<e.length;n++)if(s>=e[n].minValue&&s<=e[n].maxValue){r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;break}}}else{r=new Uint8Array(3*c);for(let e=0;e<r.length;e++)r[e]=255}if(u&&i&&i.colorModulation){const e=i.colorModulation.minValue,a=i.colorModulation.maxValue,t=.3;for(let s=0;s<c;s++){const n=u[s],f=n>=a?1:n<=e?t:t+(1-t)*(n-e)/(a-e);r[3*s]=f*r[3*s],r[3*s+1]=f*r[3*s+1],r[3*s+2]=f*r[3*s+2]}}return r}function $(l,o){if(l.encoding==null||l.encoding===""){const u=A(o,l);if(x(u.vertexAttributes.position))return;const c=O(o,u.vertexAttributes.position),d=u.header.fields,g=[d.offsetX,d.offsetY,d.offsetZ],r=[d.scaleX,d.scaleY,d.scaleZ],i=c.length/3,e=new Float64Array(3*i);for(let a=0;a<i;a++)e[3*a]=c[3*a]*r[0]+g[0],e[3*a+1]=c[3*a+1]*r[1]+g[1],e[3*a+2]=c[3*a+2]*r[2]+g[2];return e}if(l.encoding==="lepcc-xyz")return R(o).result}function F(l,o,u){return v(l)&&l.attributeInfo.useElevation?I(o,u):v(l)?w(l.attributeInfo.storageInfo,l.buffer,u):null}function I(l,o){const u=new Float64Array(o);for(let c=0;c<o;c++)u[c]=l[3*c+2];return u}function J(l,o,u,c,d){const g=l.length/3;let r=0;for(let i=0;i<g;i++){let e=!0;for(let a=0;a<c.length&&e;a++){const{filterJSON:t}=c[a],s=d[a].values[i];switch(t.type){case"pointCloudValueFilter":{const n=t.mode==="exclude";t.values.includes(s)===n&&(e=!1);break}case"pointCloudBitfieldFilter":{const n=k(t.requiredSetBits),f=k(t.requiredClearBits);(s&n)===n&&(s&f)==0||(e=!1);break}case"pointCloudReturnFilter":{const n=15&s,f=s>>>4&15,b=f>1,C=n===1,y=n===f;let h=!1;for(const p of t.includedReturns)if(p==="last"&&y||p==="firstOfMany"&&C&&b||p==="lastOfMany"&&y&&b||p==="single"&&!b){h=!0;break}h||(e=!1);break}}}e&&(u[r]=i,l[3*r]=l[3*i],l[3*r+1]=l[3*i+1],l[3*r+2]=l[3*i+2],o[3*r]=o[3*i],o[3*r+1]=o[3*i+1],o[3*r+2]=o[3*i+2],r++)}return r}function m(l){return l==null||l==="none"?null:l==="low-four-bit"?o=>15&o:l==="high-four-bit"?o=>(240&o)>>4:l==="absolute-value"?o=>Math.abs(o):l==="modulo-ten"?o=>o%10:null}function k(l){let o=0;for(const u of l||[])o|=1<<u;return o}export{F as a,$ as c,I as d,U as f,J as m};
