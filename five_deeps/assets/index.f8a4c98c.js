var ue=Object.defineProperty,de=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var Y=(n,e,t)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$=(n,e)=>{for(var t in e||(e={}))pe.call(e,t)&&Y(n,t,e[t]);if(J)for(var t of J(e))fe.call(e,t)&&Y(n,t,e[t]);return n},_=(n,e)=>de(n,me(e));import{_ as m,d as y,n as O,y as Z,M as W,k as N,N as q,i as ge,o as ye,u as we,l as ve,h as ne,S as xe,f as L,x as re,c as R,g as A,a as H,b as j,m as U,e as K,j as Q,p as Se,v as be,q as Te,r as Ce,s as Me,t as Ie,O as De,w as Ge,z as X,L as ee,K as Ee,A as Ae,B as te,C as P,D as ze,E as Re,F as Pe,G as Fe,H as Ve,I as Be,J as Le,P as Ne,Q as ie,R as se,T as ke,U as Oe,V as $e,W as v}from"./vendor.d5f590a2.js";const _e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}};_e();function He(n){const e=document.createElement("canvas"),t=256;e.width=1,e.height=t;const s=e.getContext("2d"),i=s.createLinearGradient(0,0,0,t);for(const{offset:a,color:[o,l,h]}of n)i.addColorStop(a,`rgb(${o}, ${l}, ${h})`);return s.fillStyle=i,s.fillRect(0,0,1,t),s.getImageData(0,0,1,t)}function je(n,e,t){const s=e*.15,i=t*.15,a=n.createRadialGradient(e/2+s,t/2-i,0,e/2+s,t/2-i,Math.sqrt(e*e+t*t)/2*1.6);return a.addColorStop(0,"rgba(255, 255, 255, 0)"),a.addColorStop(.5,"rgba(180, 255, 255, 0)"),a.addColorStop(1,"rgba(0, 163, 163)"),n.save(),n.fillStyle=a,n.fillRect(0,0,e,t),n.restore(),n.getImageData(0,0,e,t)}function Ue(n){const e=n.map(({color:t})=>typeof t=="string"?We(t):t);return t=>{for(let s=0;s<n.length;s++){const i=n[s],a=e[s];if(t<=i.offset){if(s===0)return e[0];const o=n[s-1],l=(t-o.offset)/(i.offset-o.offset),h=e[s-1],g=a,u=[0,0,0];for(let c=0;c<3;c++)u[c]=h[c]*(1-l)+g[c]*l;return u}}return e[e.length-1]}}function We(n){return[parseInt(n.slice(1,3),16),parseInt(n.slice(3,5),16),parseInt(n.slice(5,7),16)]}let T=class extends Z{constructor(){super(...arguments);this.displayArea=new W({xmin:0,xmax:100,ymin:0,ymax:100,zmin:0,zmax:50,spatialReference:N.WebMercator}),this.samplingResolutionPixels=512,this.colorTextureResolution=512,this.elevationMeshResolutionPixels=256,this.waterSurfaceResolution=64,this.hillshadeStretchStddev=2,this.terrainColorSaturation=1.5,this.glassTextureResolution=256,this.colorRamp=Ue([{offset:0,color:"#000004"},{offset:.1,color:"#140e36"},{offset:.2,color:"#3b0f70"},{offset:.3,color:"#641a80"},{offset:.4,color:"#8c2981"},{offset:.5,color:"#b5367a"},{offset:.6,color:"#de4968"},{offset:.7,color:"#f66e5c"},{offset:.8,color:"#fe9f6d"},{offset:.9,color:"#fecf92"},{offset:1,color:"#fecf92"}]),this.surfacePaddingBottom=.01,this.shadingMode="multi-hillshade",this.waterSurfaceNoiseSeed=123,this.waterSurfaceNoiseHarmonics=[{waveLength:.87,amplitude:5},{waveLength:3,amplitude:.6}]}};m([y()],T.prototype,"displayArea",void 0);m([y()],T.prototype,"samplingResolutionPixels",void 0);m([y()],T.prototype,"colorTextureResolution",void 0);m([y()],T.prototype,"elevationMeshResolutionPixels",void 0);m([y()],T.prototype,"waterSurfaceResolution",void 0);m([y()],T.prototype,"hillshadeStretchStddev",void 0);m([y()],T.prototype,"terrainColorSaturation",void 0);m([y()],T.prototype,"glassTextureResolution",void 0);m([y()],T.prototype,"colorRamp",void 0);m([y()],T.prototype,"surfacePaddingBottom",void 0);m([y()],T.prototype,"shadingMode",void 0);m([y()],T.prototype,"waterSurfaceNoiseSeed",void 0);m([y()],T.prototype,"waterSurfaceNoiseHarmonics",void 0);T=m([O("Configuration")],T);function ae(n){let e=null;return(...t)=>{e&&e.abort(),e=new AbortController;const s=e;return n(e.signal,...t).finally(()=>{s===e&&(e=null)})}}async function qe(n,e,t){var g;const s=await Ze(),i=s.transaction("meshes").objectStore("meshes"),a=`${JSON.stringify(e.toJSON())}/${(g=t==null?void 0:t.demResolution)!=null?g:0}`,o=await i.get(a);if(o)return q.fromJSON(o);const l=await ge(n,e,t);return s.transaction("meshes","readwrite").objectStore("meshes").put(l.toJSON(),a),l}async function Ze(){const n=await ye("diarama-cache",2,{upgrade:(t,s,i)=>{for(let a=s;a<=(i!=null?i:0);a++)switch(a){case 0:t.createObjectStore("meshes");break;case 1:t.createObjectStore("textures");break}}}),e=n.transaction(["meshes","textures"],"readwrite");return await Promise.all([e.objectStore("meshes").clear(),e.objectStore("textures").clear()]),n}let M=class extends Z{constructor(e){super(e);this.sourceZmin=0,this.sourceZmax=0,this.handles=new we}get demResolution(){return this.sampler.demResolution}get extent(){return this.sampler.extent}get spatialReference(){return this.sampler.spatialReference}get noDataValue(){return this.sampler.noDataValue}initialize(){let e=this.sampler.extent.zmin,t=this.sampler.extent.zmax;this.sourceZmin=e,this.sourceZmax=t;const s=t-e;this.handles.add(ve(()=>this.config.displayArea,i=>{if(!i)return;const a=i.zmax-i.zmin;this.scale=a/s,this.offset=i.zmin-e},{initial:!0}))}destroy(){this.handles.destroy()}elevationAt(e,t){const s=this.sampler.elevationAt(e,t);return s===this.sampler.noDataValue?s:this.scaleValue(s)}on(e,t){return this.sampler.on(e,t)}queryElevation(e){const t=this.sampler.queryElevation(e);switch(t.type){case"multipoint":this.scaleCoords(t.points);break;case"polyline":for(const s of t.paths)this.scaleCoords(s);break;case"point":t.z=this.scaleValue(t.z);break}return t}scaleValue(e){return(e+this.offset)*this.scale}scaleCoords(e){for(const t of e)t[2]=this.scaleValue(t[2])}};m([y()],M.prototype,"config",void 0);m([y()],M.prototype,"sampler",void 0);m([y()],M.prototype,"demResolution",null);m([y()],M.prototype,"extent",null);m([y()],M.prototype,"spatialReference",null);m([y()],M.prototype,"noDataValue",null);m([y()],M.prototype,"sourceZmin",void 0);m([y()],M.prototype,"sourceZmax",void 0);M=m([O("ExaggeratedElevationSampler")],M);function Je(n,e,t){const s=n.length/3,i=new Float64Array(s*6),a=new Float32Array(s*4);let o=0,l=0,h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(let r=0;r<s;r++){const f=n[r*3+0],w=n[r*3+1],x=n[r*3+2];i[o++]=f,i[o++]=w,i[o++]=x,i[o++]=f,i[o++]=w;const b=x+t(f,w,x);i[o++]=b,h=Math.min(h,x,b),g=Math.max(g,x,b),a[l++]=e?e[r]:0,a[l++]=0,a[l++]=e?e[r]:0,a[l++]=0}o=0,l=0;const u=g-h;for(let r=0;r<s;r++){const f=i[o+2];a[++l]=(f-h)/u,++l;const w=i[o+5];a[++l]=(w-h)/u,++l,o+=6}const c=s-1,p=new Uint32Array(c*6);let d=0;for(let r=0;r<c;r++){const f=r*2;p[d++]=f+2,p[d++]=f,p[d++]=f+1,p[d++]=f+2,p[d++]=f+1,p[d++]=f+3}return{position:i,uv:a,faces:p}}function oe(n,e,t,s){let i=0;const a=(n+2)*2+(e+2)*2,o=new Float64Array(a*3),l=new Float32Array(a),h=[0,0,0];let g=0;const u=(p,d,r,f)=>{let w=p,x=r;const b=Math.sign(d-p),I=Math.sign(f-r);for(;Math.sign(w-d)!==b||Math.sign(x-f)!==I;)t(h,w,x),o[i++]=h[0],o[i++]=h[1],o[i++]=h[2],l[g++]=b?(w-p)/(d-p):(x-r)/(f-r),w+=b,x+=I;let D=i-3;o[i++]=o[D++],o[i++]=o[D++],o[i++]=o[D++],l[g++]=1};u(0,n,0,0),u(n,n,0,e),u(n,0,e,e),u(0,0,e,0);const c=Je(o,l,typeof s=="number"?(p,d,r)=>s-r:(p,d,r)=>s(p,d,r));return{position:c.position,faces:c.faces,uv:c.uv,numVertices:{x:(n+2)*2,y:(e+2)*2}}}function Ye(n,e){var c;const t=it(e),s=(c=e.colorOutput)!=null?c:!1,i=new Uint8ClampedArray(e.width*e.height*(s?4:1));let a=0;const o={slope:0,aspect:0},l=t.multi?tt:et,g=t.stretchStddev!==0?new Float64Array(e.width*e.height):null;let u=0;for(let p=0;p<e.height;p++)for(let d=0;d<e.width;d++){Qe(o,n,d,p,t);const r=l(o,t);if(g)g[a++]=r,u+=r;else{const f=255*r;i[a++]=f,s&&(i[a++]=f,i[a++]=f,i[a++]=255)}}return g&&Ke(i,g,u/g.length,t),i}function Ke(n,e,t,{stretchStddev:s,colorOutput:i}){let a=0;for(let u=0;u<e.length;u++){const c=e[u]-t;a+=c*c}a=Math.sqrt(a/e.length);const o=a*s,l=t-o,h=t+o;let g=0;for(let u=0;u<e.length;u++){const c=Math.min(1,Math.max(0,(e[u]-l)/(h-l)))*255;n[g++]=c,i&&(n[g++]=c,n[g++]=c,n[g++]=255)}}function Qe(n,e,t,s,i){const{dx:a,dy:o}=Xe(st,e,t,s,i),l=Math.atan(Math.sqrt(a*a+o*o)*i.zFactor);let h;return a!==0?(h=Math.atan2(o,-a),h<0&&(h+=Math.PI*2)):o>0?h=Math.PI*.5:o<0?h=Math.PI*1.5:h=0,n.slope=l,n.aspect=h,n}function Xe(n,e,t,s,{dx:i,dy:a}){const o=e(t,s,-1,1),l=e(t,s,0,1),h=e(t,s,1,1),g=e(t,s,-1,0),u=e(t,s,1,0),c=e(t,s,-1,-1),p=e(t,s,0,-1),d=e(t,s,1,-1);return n.dx=(h+2*u+d-(o+2*g+c))/(8*i),n.dy=(c+2*p+d-(o+2*l+h))/(8*a),n}function et({slope:n,aspect:e},{cosZenith:t,sinZenith:s,azimuth:i}){const a=Math.cos(n),o=Math.sin(n);return t*a+s*o*Math.cos(i-e)}function tt({slope:n,aspect:e},{cosZenith:t,sinZenith:s}){const i=Math.cos(n),a=Math.sin(n),o=t*i,l=s*a;return(F(o,l,e,at)+F(o,l,e,ot)+F(o,l,e,nt)+F(o,l,e,rt))/2}function F(n,e,t,s){const i=Math.sin(t-s);return(n+e*Math.cos(s-t))*i*i}function it(n){var r,f,w,x,b,I;const{width:e,height:t,extent:s}=n,i=s.width/e,a=s.height/t,o=z((r=n.azimuth)!=null?r:315),l=le(90-((f=n.altitude)!=null?f:45)),h=Math.cos(l),g=Math.sin(l),u=(w=n.multi)!=null?w:!1,c=(x=n.zFactor)!=null?x:1,p=(b=n.stretchStddev)!=null?b:0,d=(I=n.colorOutput)!=null?I:!1;return{dx:i,dy:a,width:e,height:t,extent:s,azimuth:o,zenith:l,cosZenith:h,sinZenith:g,multi:u,zFactor:c,stretchStddev:p,colorOutput:d}}function le(n){return n/180*Math.PI}function z(n){return le(360-n+90)}const st={dx:0,dy:0},at=z(225),ot=z(270),nt=z(315),rt=z(360);var lt="./assets/caustics.c9316de1.png";let S=class extends Z{constructor(e){super(e);this.layer=new ne,this.elevationSurfaceMesh=null,this.elevationSurfaceGraphic=null,this.surfaceBoxGraphic=null,this.glassBoxGraphic=null,this.topSurfaceGraphic=null,this.sampler=null,this.zmin=Number.POSITIVE_INFINITY,this.zmax=Number.POSITIVE_INFINITY,this.numUpdating=0,this.loading=null,this.causticsImage=new Image,this.causticsImage.src=lt,this.causticsImage.decode()}get updating(){return this.numUpdating!==0}get terrainColorTextureCanvas(){return document.createElement("canvas")}get hillshadeCanvas(){return document.createElement("canvas")}get glassCanvas(){return document.createElement("canvas")}get topSurfaceZ(){return this.config.displayArea.height*.65}get topSurfaceSampler(){return this.waterSurfaceSampler}get waterSurfaceSampler(){const e=this.config.displayArea,{xmin:t,ymin:s,width:i,height:a}=e,{waterSurfaceNoiseHarmonics:o,waterSurfaceNoiseSeed:l}=this.config,h=new xe(l),g=this.topSurfaceZ;return(u,c)=>{const p=(u-t)/i,d=(c-s)/a;let r=g;for(const{waveLength:f,amplitude:w}of o)r+=(h.noise2D(p*f,d*f)+1)/2*w;return r}}get glassGradientImageData(){const e=this.config.glassTextureResolution,t=this.glassCanvas;return t.width=e,t.height=e,je(t.getContext("2d"),e,e)}destroyDiorama(){this.sampler=null,this.elevationSurfaceGraphic&&(this.layer.remove(this.elevationSurfaceGraphic),this.elevationSurfaceGraphic.destroy(),this.elevationSurfaceGraphic=null),this.surfaceBoxGraphic&&(this.layer.remove(this.surfaceBoxGraphic),this.surfaceBoxGraphic.destroy(),this.surfaceBoxGraphic=null),this.glassBoxGraphic&&(this.layer.remove(this.glassBoxGraphic),this.glassBoxGraphic=null),this.topSurfaceGraphic&&(this.layer.remove(this.topSurfaceGraphic),this.topSurfaceGraphic=null)}generateDiorama(e){this.loading&&(this.loading.style.display="flex");const t=a=>(this.numUpdating++,a.finally(()=>this.numUpdating--),a),s=ae(async(a,o)=>o?t(this.recreateSampler(a,o)):null),i=ae(async(a,o)=>o?t(this.recreateElevationMesh(a,o)):null);s({sourceArea:e,samplingResolutionPixels:this.config.samplingResolutionPixels}).then(()=>{i({sampler:this.sampler,sourceArea:e,terrainSurfaceVertexResolution:this.terrainSurfaceVertexResolution(e),displayArea:this.config.displayArea}).then(()=>{this.updateMeshVisualization({visualizationParams:this.terrainVisualizationParams(e),graphic:this.elevationSurfaceGraphic}),this.recreateSurfaceBoxMesh({zmin:this.zmin,zmax:this.zmax,surfacePaddingBottom:this.config.surfacePaddingBottom,terrainSurfaceVertexResolution:this.terrainSurfaceVertexResolution(e),sourceArea:e,displayArea:this.config.displayArea,sampler:this.sampler}),this.recreateGlassBox({displayArea:this.config.displayArea,sourceArea:e,glassTextureResolution:this.config.glassTextureResolution,sampler:this.sampler,terrainSurfaceVertexResolution:this.terrainSurfaceVertexResolution(e),glassGradientImageData:this.glassGradientImageData,topSurfaceSampler:this.topSurfaceSampler}),this.recreateWaterSurface({displayArea:this.config.displayArea,topSurfaceSampler:this.topSurfaceSampler,waterSurfaceResolution:this.config.waterSurfaceResolution,glassGradientImageData:this.glassGradientImageData}),this.loading&&(this.loading.style.display="none")})})}initialize(){this.view.map.add(this.layer),L(()=>!this.view.updating,()=>{this.view.basemapTerrain.suspended=!0},{once:!0})}async recreateSampler(e,{sourceArea:t,samplingResolutionPixels:s}){const i=Math.max(t.width,t.height)/s,a=new re({url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer"});this.sampler=new M({sampler:await a.createElevationSampler(t,{demResolution:i,signal:e,noDataValue:1e-30}),config:this.config})}async recreateElevationMesh(e,t){this.elevationSurfaceMesh=null;const{sampler:s,sourceArea:i,terrainSurfaceVertexResolution:{demResolution:a}}=t;if(!s)return;const o=await qe(s,i,{demResolution:a});if(e.aborted)throw new Error("AbortError");this.renormalizeTerrainSurface(o,t),o.components[0].material=new R({metallic:0,roughness:1}),this.elevationSurfaceMesh=o,this.elevationSurfaceGraphic=new A({geometry:o,symbol:new H({symbolLayers:[new j({material:{color:"white"}})]}),visible:!1}),this.layer.add(this.elevationSurfaceGraphic)}renormalizeTerrainSurface(e,{sourceArea:t,displayArea:s}){const i=e.vertexAttributes.position,a=new Float32Array(i.length/3*4);e.vertexAttributes.tangent=a;let o=0,l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;const g=s.width/t.width,u=s.height/t.height;for(let c=0;c<i.length;c+=3){const p=i[c],d=i[c+1];i[c]=(p-t.xmin)*g+s.xmin,i[c+1]=(d-t.ymin)*u+s.ymin,a[o++]=1,a[o++]=0,a[o++]=0,a[o++]=1;const r=i[c+2];l=Math.min(l,r),h=Math.max(h,r)}this.zmin=l,this.zmax=h,e.vertexAttributesChanged()}createTerrainColorTexture(e){const t=this.sampler;if(!t)return null;const{colorTextureResolution:s,colorRamp:i,terrainColorSaturation:a}=this.config,o=new ImageData(s,s);let l=0;const{zmin:h,zmax:g}=this;for(let r=0;r<s;r++)for(let f=0;f<s;f++){const w=e.xmin+f/s*e.width,x=e.ymin+r/s*e.height,I=(t.elevationAt(w,x)-h)/(g-h),D=i(I);o.data[l++]=D[0],o.data[l++]=D[1],o.data[l++]=D[2],o.data[l++]=255}const u=this.terrainColorTextureCanvas;u.width=s,u.height=s;const c=u.getContext("2d");c.save(),c.putImageData(o,0,0),c.filter=`saturate(${a})`,c.drawImage(u,0,0),c.restore();const{shadingMode:p}=this.config;c.save();const d=this.cachedElevationSampleFunction(e);if((p==="hillshade"||p==="multi-hillshade")&&d){const{hillshadeStretchStddev:r}=this.config,f=Ye(d,{extent:e,width:s,height:s,colorOutput:!0,multi:p==="multi-hillshade",stretchStddev:r}),w=new ImageData(f,s,s),x=this.hillshadeCanvas;x.width=s,x.height=s,x.getContext("2d").putImageData(w,0,0),c.globalCompositeOperation="soft-light",c.drawImage(x,0,0)}c.restore();for(let r=0;r<3;r++)c.drawImage(this.causticsImage,0,0,s,s);return new U({data:c.getImageData(0,0,s,s)})}terrainVisualizationParams(e){return{shadingMode:this.config.shadingMode,mesh:this.elevationSurfaceMesh,colorTexture:this.createTerrainColorTexture(e)}}cachedElevationSampleFunction(e){if(!this.sampler)return null;const t=this.config.colorTextureResolution,s=new Float64Array(t*t),{xmin:i,ymin:a,width:o,height:l}=e;let h=a,g=0;const u=o/t,c=l/t;for(let p=0;p<t;p++){let d=i;for(let r=0;r<t;r++)s[g++]=this.sampler.sampler.elevationAt(d,h),d+=u;h+=c}return(p,d,r,f)=>{const w=Math.min(Math.max(p+r,0),t-1),x=Math.min(Math.max(d+f,0),t-1);return s[x*t+w]}}updateMeshVisualization({visualizationParams:e,graphic:t}){if(!(e!=null&&e.mesh)||!t)return;const s=e.mesh.clone();this.setTerrainVisualization(_($({},e),{mesh:s})),t.geometry=s,t.visible=!0}setTerrainVisualization(e){const{mesh:t,colorTexture:s}=e;if(!t||!s)return;const i=t.components[0].material;if(i instanceof R)switch(e.shadingMode){case"none":i.colorTexture=s,i.emissiveTexture=null,i.emissiveColor=null,i.color=null,i.normalTexture=null;break;default:i.colorTexture=null,i.emissiveTexture=s,i.emissiveColor=new K([255,255,255]),i.color=new K([0,0,0]),i.normalTexture=null;break}}terrainSurfaceVertexResolution(e){const{elevationMeshResolutionPixels:t}=this.config,s=Math.max(e.width,e.height)/t,i=Math.ceil(e.width/s),a=Math.ceil(e.height/s);return{width:i,height:a,demResolution:s}}recreateSurfaceBoxMesh({zmin:e,zmax:t,surfacePaddingBottom:s,terrainSurfaceVertexResolution:{width:i,height:a},sourceArea:o,displayArea:l,sampler:h}){if(!h||!Number.isFinite(e))return;const{position:g,faces:u,uv:c}=oe(i,a,(r,f,w)=>{const x=o.xmin+f/i*o.width,b=o.ymin+w/a*o.height;r[0]=l.xmin+f/i*l.width,r[1]=l.ymin+w/a*l.height,r[2]=h.elevationAt(x,b)},e-s*(t-e)),p=He([{offset:0,color:[255,158,116]},{offset:.4,color:[235,210,182]},{offset:1,color:[235,235,235]}]),d=new q({spatialReference:N.WebMercator,vertexAttributes:{position:g,uv:c},components:[new Q({faces:u,material:new R({colorTexture:new U({data:p}),roughness:.25,metallic:0})})]});this.surfaceBoxGraphic=new A({geometry:d,symbol:new H({symbolLayers:[new j({material:{color:"white"},edges:new Se({size:"5px",color:[235,210,182]})})]})}),this.layer.add(this.surfaceBoxGraphic)}recreateWaterSurface({displayArea:e,topSurfaceSampler:t,waterSurfaceResolution:s}){if(!t)return;const{xmin:i,ymin:a,xmax:o,ymax:l}=e,h=(o-i)/s,g=(l-a)/s,u=(d,r)=>[d,r,t(d,r)],c=[];for(let d=0;d<s;d++){const r=a+g*d;for(let f=0;f<s;f++){const w=i+h*f;c.push([u(w,r),u(w,r+g),u(w+h,r+g),u(w+h,r),u(w,r)])}}const p=new be({rings:c,spatialReference:N.WebMercator});this.topSurfaceGraphic=new A({geometry:p,symbol:new Te({symbolLayers:[new Ce({waterbodySize:"large",waveStrength:"moderate",color:[30,160,160,.8]})]})}),this.layer.add(this.topSurfaceGraphic)}recreateGlassBox({sourceArea:e,displayArea:t,sampler:s,topSurfaceSampler:i,glassGradientImageData:a,terrainSurfaceVertexResolution:o}){if(!s||!i)return;const{xmin:l,width:h,ymin:g,height:u}=e,{xmin:c,ymin:p,width:d,height:r}=t,{position:f,uv:w,faces:x,numVertices:b}=oe(o.width,o.height,(C,G,E)=>{C[0]=c+G/o.width*d,C[1]=p+E/o.height*r,C[2]=i(C[0],C[1])},(C,G,E)=>{const ce=(C-c)/d*h+l,he=(G-p)/r*u+g;return s.elevationAt(ce,he)-E}),I=b.x*2,D=(b.x*2+b.y)*2;for(let C=0;C<b.y*2;C+=2){const G=I+C,E=D+C;w[G]=1-w[G],w[E]=1-w[E]}this.glassBoxGraphic=new A({geometry:new q({vertexAttributes:{position:f,uv:w},components:[new Q({faces:x,material:new R({colorTexture:new U({data:a,transparent:!0}),emissiveColor:[100,100,100],alphaMode:"blend",roughness:1,metallic:0})})]}),symbol:new H({symbolLayers:[new j({material:{color:"white"}})]})}),this.layer.add(this.glassBoxGraphic)}};m([y()],S.prototype,"view",void 0);m([y()],S.prototype,"config",void 0);m([y()],S.prototype,"layer",void 0);m([y()],S.prototype,"elevationSurfaceMesh",void 0);m([y()],S.prototype,"elevationSurfaceGraphic",void 0);m([y()],S.prototype,"surfaceBoxGraphic",void 0);m([y()],S.prototype,"glassBoxGraphic",void 0);m([y()],S.prototype,"topSurfaceGraphic",void 0);m([y()],S.prototype,"sampler",void 0);m([y()],S.prototype,"zmin",void 0);m([y()],S.prototype,"zmax",void 0);m([y()],S.prototype,"numUpdating",void 0);m([y()],S.prototype,"updating",null);m([y()],S.prototype,"terrainColorTextureCanvas",null);m([y()],S.prototype,"hillshadeCanvas",null);m([y()],S.prototype,"glassCanvas",null);m([y()],S.prototype,"topSurfaceZ",null);m([y()],S.prototype,"topSurfaceSampler",null);m([y()],S.prototype,"waterSurfaceSampler",null);m([y()],S.prototype,"glassGradientImageData",null);S=m([O("DioramaBuilder")],S);const V={"Mariana Trench":{extent:{xmin:157427593237e-4,xmax:159595445453e-4,ymin:11670643473e-4,ymax:13745635104e-4,spatialReference:102100},camera:{position:[-.0010853,-41511e-8,96.58543],heading:58.69,tilt:67.48},properties:{en_name:"Mariana Trench",name:"\u9A6C\u91CC\u4E9A\u7EB3\u6D77\u6C9F",depth:10935,ocean:"\u592A\u5E73\u6D0B",description:"\u5728\u8FD9\u6761\u6D77\u6C9F\u4E2D\u662F\u6311\u6218\u8005\u6DF1\u6E0A\uFF0C\u5730\u7403\u4E0A\u6700\u6DF1\u7684\u5730\u65B9\u3002\u5728\u6311\u6218\u8005\u6DF1\u5904\u53D1\u73B0\u4E86\u5FAE\u5851\u6599\uFF0C\u663E\u793A\u51FA\u6C61\u67D3\u7684\u6DF1\u8FDC\u5F71\u54CD\u3002",year:1875},geometry:{type:"Point",coordinates:[142.19956582458715,11.35019574348784]}},"Java Trench":{extent:{xmin:121327326907e-4,xmax:123241437436e-4,ymin:-12171696194e-4,ymax:-10339591237e-4,spatialReference:102100},camera:{position:[-75943e-8,-94133e-8,88.96978],heading:40.39,tilt:71.55},properties:{en_name:"Java Trench",name:"\u722A\u54C7\u6D77\u6C9F",depth:7192,ocean:"\u5370\u5EA6\u6D0B",description:"\u722A\u54C7\u6D77\u6C9F\u662F\u7531\u4FEF\u51B2\u4F5C\u7528\u5F62\u6210\u7684\uFF0C\u4E5F\u5C31\u662F\u4E00\u4E2A\u6784\u9020\u677F\u5757\u63A8\u52A8\u53E6\u4E00\u4E2A\u677F\u5757\u3002\u6F5C\u6CA1\u53EF\u4EE5\u5F62\u6210\u6D77\u6C9F\u3001\u5C71\u8109\u6216\u5C9B\u5F27\uFF0C\u5E76\u7ECF\u5E38\u5F15\u8D77\u5730\u9707\u548C\u706B\u5C71\u6D3B\u52A8\u3002",year:1958},geometry:{type:"Point",coordinates:[109.93537191049057,-10.186947190266002]}},"Puerto Rico Trench":{extent:{xmin:-74870225066e-4,xmax:-72267809267e-4,ymin:21216081334e-4,ymax:23707027469e-4,spatialReference:102100},camera:{position:[-.00106119,.00177365,107.95943],heading:131.02,tilt:68.41},properties:{en_name:"Puerto Rico Trench",name:"\u6CE2\u591A\u9ECE\u5404\u6D77\u6C9F",depth:8376,ocean:"\u5927\u897F\u6D0B",description:"\u6D77\u6C9F\u662F\u6DF1\u6D77\u6D77\u7EF5\u3001\u9ED1\u73CA\u745A\u3001\u6D77\u8475\u548C\u6C34\u6BCD\u7B49\u72EC\u7279\u7269\u79CD\u7684\u5BB6\u56ED\u3002\u6DF1\u6D77\u4F5C\u4E3A\u6709\u673A\u78B3\u6C47\u4E5F\u4F1A\u5BF9\u5176\u4ED6\u751F\u6001\u7CFB\u7EDF\u4EA7\u751F\u79EF\u6781\u5F71\u54CD\u3002",year:1964},geometry:{type:"Point",coordinates:[-65.9998283058703,20.00060412021876]}},"Molloy Hole":{extent:{xmin:182660.366,xmax:487098.0292,ymin:148789443125e-4,ymax:151702797656e-4,spatialReference:102100},camera:{position:[.00148054,.00166472,110.60867],heading:221.6,tilt:61.65},properties:{en_name:"Molloy Hole",name:"\u83AB\u6D1B\u4F0A\u6D1E",depth:5550,ocean:"\u5317\u51B0\u6D0B",description:"\u6D77\u6C9F\u7684\u6DF1\u5EA6\u8D85\u8FC76000\u7C73\uFF0C\u8FD9\u5C31\u662F\u4E3A\u4EC0\u4E48\u83AB\u6D1B\u4F0A\u6D1E\u4E0D\u662F\u6D77\u6C9F\u3002\u83AB\u6D1B\u4F0A\u6D1E\u662F\u7531\u6D77\u5E95\u6269\u5F20\u6216\u6784\u9020\u677F\u5757\u76F8\u4E92\u8FDC\u79BB\u5F62\u6210\u7684\u3002",year:1972},geometry:{type:"Point",coordinates:[3.0680365309103568,79.14254225105523]}},"South Sandwich Trench":{extent:{xmin:-29755362112e-4,xmax:-26050498626e-4,ymin:-78601543639e-4,ymax:-75056044465e-4,spatialReference:102100},camera:{position:[.00190333,-76102e-8,108.09049],heading:309.55,tilt:66.14},properties:{en_name:"South Sandwich Trench",name:"\u5357\u6851\u5FB7\u97E6\u5947\u6D77\u6C9F",depth:7434,ocean:"\u5357\u51B0\u6D0B",description:"\u6D77\u6D0B\u6DF1\u5EA6\u8D85\u8FC76000\u7C73\u7684\u533A\u57DF\u88AB\u79F0\u4E3A\u6DF1\u6E0A\u533A\u3002\u5357\u6851\u5FB7\u97E6\u5947\u6D77\u6C9F\u662F\u5730\u7403\u4E0A\u552F\u4E00\u6E29\u5EA6\u4F4E\u4E8E\u96F6\u5EA6\u7684\u6DF1\u6E0A\u5E26\u3002",year:1926},geometry:{type:"Point",coordinates:[-25.000000204859887,-56.499525148767766]}}};Me("https://js.arcgis.com/calcite-components/1.0.0-beta.80/assets");const B=[255,255,255];Ie(1);let k=class extends De{constructor(){super(...arguments);this.config=new T,this.initialCamera=new Ge({position:{x:-.00126813,y:-.00107487,z:114.0035},heading:49.6,tilt:69.68}),this.view=new X({map:new ee({ground:{opacity:0,surfaceColor:[100,100,50]}}),camera:this.initialCamera,clippingArea:this.config.displayArea,alphaCompositingEnabled:!0,environment:{atmosphereEnabled:!1,starsEnabled:!1,background:{type:"color",color:[255,255,255,0]},lighting:{date:"Tue Mar 15 2022 08:05:00 GMT-0700 (Pacific Daylight Time)"}},spatialReference:N.WebMercator,qualityProfile:"high",viewingMode:"local"}),this.pointsLayer=new Ee({source:this.getGraphics(V),geometryType:"point",spatialReference:{wkid:4326},fields:[{name:"ObjectID",type:"oid"},{name:"en_name",type:"string"},{name:"name",type:"string"},{name:"depth",type:"integer"},{name:"ocean",type:"string"},{name:"description",type:"string"},{name:"year",type:"integer"}],objectIdField:"ObjectID",outFields:["*"],renderer:new Ae({symbol:new te({symbolLayers:[new P({resource:{href:"./assets/icon.svg"},anchor:"relative",anchorPosition:{x:-.4,y:0},size:40})]})}),labelingInfo:[new ze({labelExpressionInfo:{expression:"$feature.name"},labelPlacement:"center-right",symbol:new Re({symbolLayers:[new Pe({material:{color:[50,50,50]},background:{color:B},font:{size:12,family:'"Avenir Next", "Avenir", "Helvetica Neue", sans-serif',weight:"bolder"}})]})})]}),this.cloudsLayer=new Fe({source:[new Ve({image:"./assets/clouds-nasa.png",georeference:new Be({extent:new W({spatialReference:{wkid:4326},xmin:-180,xmax:180,ymin:-80,ymax:80}),rotation:0})})]}),this.highlightGraphicsLayer=new ne({}),this.selectView=new X({map:new ee({ground:new Le({layers:[new re({url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer"})],surfaceColor:[255,255,255]}),basemap:new Ne({baseLayers:[new ie({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",opacity:.7}),new ie({url:"https://tiles.arcgis.com/tiles/C8EMgrsFcRFL6LrL/arcgis/rest/services/GEBCO_basemap_NCEI/MapServer",blendMode:"multiply"})]}),layers:[this.highlightGraphicsLayer,this.cloudsLayer]}),ui:{components:[]},qualityProfile:"high"}),this.dioramaBuilder=new S({view:this.view,config:this.config}),this.highlightGraphic=new A({symbol:new te({symbolLayers:[new P({resource:{primitive:"circle"},size:10,material:{color:[0,0,0,0]},outline:{color:B,size:2}}),new P({resource:{primitive:"circle"},size:20,material:{color:[0,0,0,0]},outline:{color:[...B,.7],size:2}}),new P({resource:{primitive:"circle"},size:30,material:{color:[0,0,0,0]},outline:{color:[...B,.4],size:2}})]})}),this.highlightedPoint=null,this.selected=!1,this.animationFrameTask=null,this.elements={selectViewer:null,dioramaViewer:null,intro:null,overlayInfo:null,appTitle:null,loading:null}}getGraphics(e){const t=[];let s=0;for(const[i,a]of Object.entries(e))t.push({attributes:_($({},a.properties),{ObjectID:s}),geometry:new se({x:a.geometry.coordinates[0],y:a.geometry.coordinates[1],spatialReference:{wkid:4326}})}),s++;return t}initialize(){L(()=>!this.selectView.updating,()=>{this.elements.loading&&(this.elements.loading.style.display="none"),this.startGlobeAnimation(),this.selectView.on("pointer-move",t=>{this.selectView.hitTest(t,{include:this.pointsLayer}).then(s=>{const i=s.results;if(i&&i.length>0){const a=i[0].graphic;(!this.highlightedPoint||this.highlightedPoint.name!==a.attributes.name)&&(this.highlightGraphic.geometry=a.geometry,this.selectView.graphics.add(this.highlightGraphic),this.elements.selectViewer.style.cursor="pointer",this.highlightedPoint=a.attributes,this.elements.overlayInfo.classList.add("fade-in"))}else this.selectView.graphics.removeAll(),this.elements.selectViewer.style.cursor="default",this.highlightedPoint=null,this.elements.overlayInfo.innerHTML="",this.elements.overlayInfo.classList.remove("fade-in")}).catch(console.error)}),this.selectView.on("click",t=>{this.animationFrameTask&&this.stopGlobeAnimation(),this.selectView.hitTest(t,{include:this.pointsLayer}).then(s=>{const i=s.results;if(i&&i.length>0){const a=i[0].graphic;this.selectGraphic(a)}}).catch(console.error)})},{once:!0}),L(()=>Math.floor(this.selectView.zoom),t=>{t&&(this.cloudsLayer.opacity=.02*Math.pow(t-10,2))});const e=new ke({view:this.view,viewpoint:new Oe({camera:this.initialCamera})});this.view.ui.add(e,"top-left")}selectGraphic(e){const t=new W(V[e.attributes.en_name].extent);this.highlightedPoint=e.attributes,this.showDiorama(t),this.view.goTo(V[e.attributes.en_name].camera),this.selected=!0,this.elements.overlayInfo.classList.add("fade-in")}startGlobeAnimation(){this.elements.selectViewer.classList.add("fade-in");let e=0;const t=100,s=()=>{const i=this.selectView.camera.clone();i.position.longitude=-(360*(e/1e3/t))%360,this.selectView.goTo(i,{animate:!1})};this.animationFrameTask=$e({update:i=>{var a;e+=(a=i==null?void 0:i.deltaTime)!=null?a:0,s()}}),L(()=>this.selectView.interacting,()=>{this.stopGlobeAnimation()},{once:!0})}stopGlobeAnimation(){var e;(e=this.animationFrameTask)==null||e.remove(),this.animationFrameTask=null}render(){const e=this.highlightedPoint?v("div",{class:"container"},v("div",{class:"left-info"},v("div",{class:"title",afterCreate:t=>this.selected?t.classList.add("big"):setTimeout(()=>t.classList.add("big"),0)},v("p",null,this.highlightedPoint.name)),v("div",{class:"info"},v("p",null,"\u53D1\u73B0\u4E8E ",this.highlightedPoint.year),v("p",null,ct(this.highlightedPoint.depth)," m \u6DF1\u5EA6"),v("p",null,this.highlightedPoint.ocean))),v("div",{class:"separator"}),v("div",{class:"right-info"},v("p",null,this.highlightedPoint.description))):null;return v("div",{id:"main"},v("div",{id:"viewer"},v("div",{id:"diorama-viewer",afterCreate:t=>this.elements.dioramaViewer=t},v("div",{id:"viewDiv",afterCreate:t=>this.onAfterCreate(t)}),v("button",{class:"close",onclick:()=>this.showGlobe()},v("img",{src:"./assets/close.svg"}))),v("div",{id:"select-viewer",afterCreate:t=>this.elements.selectViewer=t},v("div",{id:"selectAreaDiv",afterCreate:t=>this.onAfterCreateSelectArea(t)}))),v("div",{id:"loading",afterCreate:t=>{this.elements.loading=t,this.dioramaBuilder.loading=t}},v("div",null)),v("div",{class:"overlay-info",afterCreate:t=>this.elements.overlayInfo=t},e),v("div",{class:"intro",afterCreate:t=>this.elements.intro=t},v("h1",null,"\u4E94\u5927\u6D0B\u6700\u6DF1\u5904\u63A2\u7D22"),v("p",null,"\u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u8D85\u8FC780%\u7684\u6D77\u6D0B\u4ECD\u7136\u5904\u4E8E\u672A\u77E5\u548C\u672A\u5F00\u53D1\u72B6\u6001\uFF0C\u8054\u5408\u56FD\u7684\u201C\u6D77\u5E952030\u201D\u9879\u76EE\u65E8\u5728\u5728\u672C\u4E16\u7EAA\u672B\u7ED8\u5236\u6574\u4E2A\u6D77\u5E95\u5730\u56FE\u3002"),v("button",{class:"intro-button",onclick:()=>this.hideIntro()},"\u4E00\u8D77\u6765\u63A2\u7D22\u6D77\u6D0B\u6700\u6DF1\u5904")),v("div",{class:"app-title",afterCreate:t=>this.elements.appTitle=t},v("h1",null,"\u4E94\u5927\u6D0B\u6700\u6DF1\u5904\u63A2\u7D22"),v("div",{class:"point-list"},v("button",{onclick:t=>this.goTo(t)},"\u5357\u6851\u5FB7\u97E6\u5947\u6D77\u6C9F-South Sandwich Trench"),v("button",{onclick:t=>this.goTo(t)},"\u6CE2\u591A\u9ECE\u5404\u6D77\u6C9F-Puerto Rico Trench"),v("button",{onclick:t=>this.goTo(t)},"\u9A6C\u91CC\u4E9A\u7EB3\u6D77\u6C9F-Mariana Trench"),v("button",{onclick:t=>this.goTo(t)},"\u83AB\u6D1B\u4F0A\u6D1E-Molloy Hole"),v("button",{onclick:t=>this.goTo(t)},"\u722A\u54C7\u6D77\u6C9F-Java Trench"))))}animateGraphicOpacity(e){return new Promise((t,s)=>{this.highlightGraphicsLayer.opacity=0,this.highlightGraphicsLayer.add(e);let i=.1;const a=o=>{this.highlightGraphicsLayer.opacity=Math.max(Math.min(o,1),0),o>1&&window.setTimeout(()=>{i=-.1},100),o>=0?requestAnimationFrame(()=>{a(o+i)}):t("animation finished")};a(0)})}goTo(e){if(e.target&&e.target instanceof HTMLButtonElement){const t=e.target.innerHTML.split("-")[1],s=V[t];if(s){this.animationFrameTask&&this.stopGlobeAnimation();const i=new se({x:s.geometry.coordinates[0],y:s.geometry.coordinates[1],spatialReference:{wkid:4326}});this.selectView.goTo({target:i,zoom:4},{speedFactor:.6}).then(()=>{this.highlightGraphic.geometry=i,this.animateGraphicOpacity(this.highlightGraphic).then(()=>{this.selectGraphic(new A({attributes:s.properties,geometry:i}))})})}}}hideIntro(){this.elements.intro.classList.add("fade-out"),this.elements.appTitle.classList.add("fade-in"),this.selectView.map.add(this.pointsLayer)}showGlobe(){this.elements.dioramaViewer.classList.remove("fade-in"),this.dioramaBuilder.destroyDiorama(),this.elements.selectViewer.classList.add("fade-in"),this.elements.appTitle.style.display="revert",this.highlightedPoint=null,this.selected=!1}showDiorama(e){this.view.camera=this.initialCamera,this.dioramaBuilder.generateDiorama(e),this.stopGlobeAnimation(),this.elements.dioramaViewer.classList.add("fade-in"),this.elements.selectViewer.classList.remove("fade-in"),this.elements.appTitle.style.display="none"}onAfterCreate(e){this.view.container=e,window.view=this.view}onAfterCreateSelectArea(e){this.selectView.container=e,window.selectView=this.selectView}};m([y()],k.prototype,"highlightedPoint",void 0);k=m([O("App")],k);const ct=n=>new Intl.NumberFormat("en-US").format(n),ht=new k({container:"app"});window.app=ht;
