var sCe=Object.defineProperty,nCe=Object.defineProperties;var oCe=Object.getOwnPropertyDescriptors;var vP=Object.getOwnPropertySymbols;var TJ=Object.prototype.hasOwnProperty,SJ=Object.prototype.propertyIsEnumerable;var xJ=(e,t,i)=>t in e?sCe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))TJ.call(t,i)&&xJ(e,i,t[i]);if(vP)for(var i of vP(t))SJ.call(t,i)&&xJ(e,i,t[i]);return e},ye=(e,t)=>nCe(e,oCe(t));var _P=(e,t)=>{var i={};for(var r in e)TJ.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&vP)for(var r of vP(e))t.indexOf(r)<0&&SJ.call(e,r)&&(i[r]=e[r]);return i};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function gbt(e,t,i,r){var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n}let sv;function he(e){return typeof sv[e]=="function"?sv[e]=sv[e](globalThis):sv[e]}var gue,yue,vue,_ue;sv=((gue=globalThis.dojoConfig)==null?void 0:gue.has)||((yue=globalThis.esriConfig)==null?void 0:yue.has)?F(F({},(vue=globalThis.dojoConfig)==null?void 0:vue.has),(_ue=globalThis.esriConfig)==null?void 0:_ue.has):{},he.add=(e,t,i,r)=>((r||sv[e]===void 0)&&(sv[e]=t),i&&he(e)),he.cache=sv,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(r.split("Edge/")[1])||void 0),he.add("opr",parseFloat(r.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(r.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he.add("trident",parseFloat(s.split("Trident/")[1])||void 0),he("webkit")||(!r.includes("Gecko")||he("wp")||he("khtml")||he("trident")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&he.add("esri-mobile",t),i&&he.add("esri-iPhone",i),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-canvas-svg-support",!he("trident")),he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-enabled",!1),he.add("mapimagelayer-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();const f1=null;function _(e){return e!=null}function M(e){return e==null}function Qs(e,t){return _(e)?t(e):f1}function ybt(e){return e}function aCe(e,t){if(M(e))throw new Error(t);return e}function _t(e,t){return _(e)?e:typeof t=="function"?t():t}function vbt(e,t){return _(e)?e:t}function at(e){return _(e)&&e.destroy(),null}function Je(e){return _(e)&&e.dispose(),null}function sn(e){return _(e)&&e.remove(),null}function zh(e){return _(e)&&e.abort(),null}function Hi(e){return _(e)&&e.release(),null}function lCe(e,t,i){return _(e)&&_(t)?_(i)?i(e,t):e.equals(t):e===t}function cCe(e){return null}function _bt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function bbt(e,t){const i=new Array;for(const r of e)i.push(uu(r,null,t));return i}function wbt(e,t){for(const i of e)Qs(i,t)}function uu(e,t,i){return _(e)?i(e):t}function xbt(e){return e.filter(t=>_(t))}function en(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}class Th{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Th._m:t}getInt(){return this._seed=(Th._a*this._seed+Th._c)%Th._m,this._seed}getFloat(){return this.getInt()/(Th._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Th._m*r}}Th._m=2147483647,Th._a=48271,Th._c=0;function i3(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function Uv(e,t,i){if(M(e)&&M(t))return!0;if(M(e)||M(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function $q(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function uCe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function hCe(e){return e&&typeof e.length=="number"}function dCe(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const pCe=!!Array.prototype.fill;function fCe(e,t){if(pCe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function mCe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function Eue(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function Cue(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class Dq{constructor(){this.last=0}}const Aue=new Dq;function ON(e,t,i,r){r=r||Aue;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function J4(e,t,i,r){const s=i==null?e.length:i,n=ON(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const id=new Set;function gCe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;id.clear();for(let a=0;a<r;++a)id.add(t[a]);s=s||Aue;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(id.has(e[a])&&(n&&n.push(e[a]),id.delete(e[a]),e[a]=e[i-1],--i,--a,id.size===0||i===0))return id.clear(),i;for(let a=0;a<o;++a)if(id.has(e[a])&&(n&&n.push(e[a]),id.delete(e[a]),e[a]=e[i-1],--i,--a,id.size===0||i===0))return id.clear(),i;return id.clear(),i}function yCe(e){return e?(EJ.seed=e,()=>EJ.getFloat()):Math.random}function Tbt(e,t){const i=yCe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const EJ=new Th;function Lq(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function vCe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function Nq(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function ZE(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function _Ce(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function lb(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function bCe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function Mue(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function RN(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function Oue(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function PN(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function Rue(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function Pue(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function wCe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function bP(e){return M(e)?0:128+e.buffer.byteLength+64}function Iue(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&Iue(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function te(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=Nue(e);if(_(t))return t;if($ue(e))return e.clone();if(Due(e))return e.map(te);if(Lue(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=te(e[r]);return i}function C8(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=Nue(e);if(_(t))return t;if(Due(e)){let i=!0;const r=e.map(s=>{const n=C8(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if($ue(e))return e.clone();if(!Lue(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=C8(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function $ue(e){return typeof e.clone=="function"}function Due(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function Lue(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function CJ(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function Nue(e){if(_Ce(e)||lb(e)||bCe(e)||Mue(e)||RN(e)||Oue(e)||PN(e)||Rue(e)||Pue(e))return Nq(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,te(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(te(i))}),t}return null}function Fq(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function xCe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Uv(e,t):e instanceof Set?t instanceof Set&&SCe(e,t):e instanceof Map?t instanceof Map&&ECe(e,t):!!CJ(e)&&CJ(t)&&TCe(e,t))}function TCe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function SCe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function ECe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function Fue(e,t,i=!1){return kue(e,t,i)}function pE(e,t){if(t!=null)return t[e]||Uue(e.split("."),!1,t)}function _c(e,t,i){const r=e.split("."),s=r.pop(),n=Uue(r,!0,i);n&&s&&(n[s]=t)}function Uue(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function kue(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=te(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=kue(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var bue;const ki={apiKey:void 0,applicationUrl:(bue=globalThis.location)==null?void 0:bue.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Fue(ki,globalThis.esriConfig,!0),delete ki.has),!ki.assetsPath){const e="4.24.7";ki.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}ki.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(ki,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),ki.request.corsEnabledServers=[],ki.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const CCe=/\{([^\}]+)\}/g;function AJ(e){return e==null?"":e}function zf(e,t){return e.replace(CCe,typeof t=="object"?(i,r)=>AJ(pE(r,t)):(i,r)=>AJ(t(r)))}function zue(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function Uq(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function Sbt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const MJ={info:0,warn:1,error:2,none:3};class de{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,de._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=de.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=de._loggers;return de._loggers=t,i},set throttlingDisabled(t){de._throttlingDisabled=t}}}static getLogger(t){let i=de._loggers[t];return i||(i=new de({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!de._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=de._tickCounter)return;this._loggedMessages[t].set(s,de._tickCounter),de._scheduleTickCounterIncrement()}for(const s of ki.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=ki.log.level?ki.log.level:"warn";return MJ[this._parentWithMember("level",i)]<=MJ[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return Uq(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){de._tickCounterScheduled||(de._tickCounterScheduled=!0,Promise.resolve().then(()=>{de._tickCounter++,de._tickCounterScheduled=!1}))}}de._loggers={},de._tickCounter=0,de._tickCounterScheduled=!1,de._throttlingDisabled=!1;function Js(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function Ebt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function kq(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const LS=de.getLogger("esri.core.Accessor");function ACe(e){return e==null?e:new Date(e)}function MCe(e){return e==null?e:!!e}function r3(e){return e==null?e:e.toString()}function Sh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function K4(e){return e==null?e:Math.round(parseFloat(e))}function Vue(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function IN(e,t){return t!=null&&e&&!(t instanceof e)}function Bue(e){return e&&"isCollection"in e}function OJ(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function OCe(e,t){if(!t||!t.constructor||!Bue(t.constructor))return A8(e,t)?t:new e(t);const i=OJ(e.prototype.itemType),r=OJ(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(A8(e,t),t):new e(t):t}function A8(e,t){return!!Vue(t)&&(LS.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+e5(e)+"'"),!0)}function kv(e,t){return t==null?t:Bue(e)?OCe(e,t):IN(e,t)?A8(e,t)?t:new e(t):t}function e5(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const RCe=new WeakMap;function PCe(e){switch(e){case Number:return Sh;case wr:return K4;case Boolean:return MCe;case String:return r3;case Date:return ACe;default:return kq(RCe,e,()=>kv.bind(null,e))}}function Ss(e,t){const i=PCe(e);return arguments.length===1?i:i(t)}function CO(e,t,i){return arguments.length===1?CO.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function ICe(e,t){return arguments.length===1?CO(Ss.bind(null,e)):CO(Ss.bind(null,e),t)}function Gue(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>Gue(e,t-1,r)):e(i)}function $N(e,t,i){if(arguments.length===2)return $N.bind(null,e,t);if(!i)return i;let r=t,s=i=Gue(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function $Ce(e,t,i){return arguments.length===2?$N(Ss.bind(null,e),t):$N(Ss.bind(null,e),t,i)}function jue(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function M8(e,t){if(arguments.length===2)return M8(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!IN(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),LS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>e5(p)).join(", ")),LS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):LS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function up(e,t){if(arguments.length===2)return up(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=Ss(c),r.push(e5(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!IN(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return LS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!IN(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!Vue(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class wr{}const Cbt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function DCe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Hue(e){switch(e.type){case"native":return Ss(e.value);case"array":return CO(Hue(e.value));case"one-of":return LCe(e);default:return null}}function LCe(e){let t=null;return(i,r)=>R8(i,e)?i:(t==null&&(t=O8(e)),LS.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function O8(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case wr:return"integer";case Date:return"date";default:return e5(e.value)}case"array":return`array of ${O8(e.value)}`;case"one-of":{const t=e.values.map(i=>O8(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function R8(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case wr:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!R8(i,t.value));case"one-of":return t.values.some(i=>R8(e,i))}}function u2(e){return Vh(()=>e.forEach(t=>_(t)&&t.remove()))}function Vh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function Abt(e){return Vh(_(e)?()=>e.destroy():void 0)}function NCe(e,t){const i=setTimeout(e,t);return Vh(()=>clearTimeout(i))}function Nn(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function FCe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function AD(e,t,i){return i?DN(e,t,{policy:i,path:""}):DN(e,t,null)}function DN(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=te(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=DN(a,l,i),i.path=c}else r[s]=DN(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function que(e){return Array.isArray(e)?e:e.split(".")}function RJ(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function UCe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...RJ(i));return t}return RJ(e)}function Wue(e,t,i,r){const s=UCe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return u2(n)}return r(e,s[0],i)}function zq(e){let t=!1;return()=>{t||(t=!0,e())}}function Xue(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=Nn(t);return FCe(r,i)?r.get(i):t[i]}function Yue(e,t,i){if(e==null)return e;const r=Xue(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Yue(r,t,i+1)}function s3(e,t,i=0){return typeof t!="string"||t.includes(".")?Yue(e,que(t),i):Xue(t,e)}function LN(e,t){return s3(e,t)}function PJ(e,t){return s3(t,e)!==void 0}class IJ{constructor(t){this.autoDestroy=!1,this.properties=t}}function n3(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=te(r[n]);t=new IJ(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new IJ({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function kCe(e){return n3(e).properties}function t5(e,t){const i=kCe(e);let r=i[t];return r||(r=i[t]={}),r}function zCe(e,t){return AD(e,t,BCe)}const VCe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function BCe(e){return VCe.test(e)?"replace":"merge"}function GCe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=pE(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class i5{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof i5&&(this.message=i&&GCe(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class q extends i5{constructor(t,i,r){if(super(t,i,r),!(this instanceof q))return new q(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return te(i)}catch{return"[object]"}}))}}catch(t){throw de.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new q(t.name,t.message,t.details)}}q.prototype.type="error";function NN(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))NN(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void NN(LN(e,s),n,i)}const r=e.__accessor__;r!=null&&jCe(t,r),e[t]=i}}function jCe(e,t){if(he("esri-unknown-property-errors")&&!HCe(e,t))throw new q("set:unknown-property",qCe(e,t))}function HCe(e,t){return t.metadatas[e]!=null}function qCe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}de.getLogger("esri.core.accessorSupport.set");function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=t5(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&de.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=LN(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=LN(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){NN(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=WCe(o):a&&(Array.isArray(a)?s.cast=CO(up(a[0])):s.cast=up(a))),e.range&&(s.cast=XCe(s.cast,e.range)),zCe(s,e)}}function Zue(e,t,i){const r=t5(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function WCe(e){let t=0,i=e;if(DCe(e))return Hue(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(jue(r))return t===0?M8(r):$N(M8(r),t);if(t===1)return ICe(r);if(t>1)return $Ce(r,t);const s=e;return s.from?s.from:Ss(s)}function XCe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function ht(e,t){const i=t?ye(F({},t),{source:e}):e;return d({aliasOf:i})}const YCe=Object.prototype.toString;function ZCe(e){const t="__accessorMetadata__"in e?Ss(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return QCe.apply(this,i)}}function QCe(e,t,i,r){t5(e,t).cast=r}function JCe(e){return(t,i)=>{t5(t,e).cast=t[i]}}function Nt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&YCe.call(e[0])==="[object Function]"?ZCe(e[0]):e.length===1&&typeof e[0]=="string"?JCe(e[0]):void 0}class Mi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&_c(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function da(){return function(e,t){return new Mi(e,F({ignoreUnknown:!0},t))}}function mt(e,t={}){var s;const i=e instanceof Mi?e:new Mi(e,t),r={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?i.apiValues:String,json:{type:i.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),d(r)}function Ie(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=Zue(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Vq(e){return(t,i)=>{t[i]=e}}var Ef;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Ef||(Ef={}));var vr;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(vr||(vr={}));let FN,pA=[];const KCe=de.getLogger("esri.core.Accessor");function ei(e){FN!==void 0&&FN.onObservableAccessed(e)}let MD=!1,OD=!1;function jg(e,t,i){if(MD)return Bq(e,t,i);Que(e);const r=t.call(i);return Jue(),r}function eAe(e,t){return jg(void 0,e,t)}function Bq(e,t,i){const r=MD;MD=!0,Que(e);let s=null;try{s=t.call(i)}catch(n){OD&&KCe.error(n)}return Jue(),MD=r,s}function Que(e){FN=e,pA.push(e)}function Jue(){const e=pA.pop();FN=pA.length>0?pA[pA.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function Kue(e,t){if(t.flags&vr.DepTrackingInitialized)return;const i=OD;OD=!1,t.flags&vr.AutoTracked?Bq(t,t.metadata.get,e):ehe(e,t),OD=i}const tAe=[];function ehe(e,t){t.flags&vr.ExplicitlyTracking||(t.flags|=vr.ExplicitlyTracking,Bq(t,()=>{const i=t.metadata.dependsOn||tAe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=que(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=$J(o,s[n],n!==s.length-1)}else $J(e,r,!1)}),t.flags&=~vr.ExplicitlyTracking)}function $J(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=Nn(e))==null?void 0:n.properties.get(r);return s&&(ei(s),Kue(e,s)),i?e[r]:void 0}function iAe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Pu extends i5{constructor(t,i,r){if(super(t,i,r),!(this instanceof Pu))return new Pu(t,i,r)}}Pu.prototype.type="warning";function the(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const P8=de.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function DJ(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||nAe(e)&&_c("read.reader",fE(e),t))}function fE(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return sAe(e);if(t===1)return LJ(e);if("type"in e&&rhe(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=LJ(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return Gq(e)}function Gq(e){return"type"in e?rAe(e.type):oAe(e.types)}function rAe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void P8.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function ihe(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>ihe(e,s,i,r-1)):e(t,void 0,i)}function sAe(e){var s;const t=Gq(e),i=ihe.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function LJ(e){const t=Gq(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function rhe(e){if(!the(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?jq(t.Type):she(t.Type))}function nAe(e){return"types"in e?she(e.types):jq(e.type)}function jq(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||rhe(e))}function she(e){for(const t in e.typeMap)if(!jq(e.typeMap[t]))return!1;return!0}function oAe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void P8.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=aAe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Pu(`${i}:unsupported`,f,{definition:s,context:o})),void P8.error(f)}const p=new h;return p.read(s,o),p}}function aAe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=n3(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function lAe(e){if(e.json||(e.json={}),FJ(e.json),UJ(e.json),NJ(e.json),e.json.origins)for(const t in e.json.origins)FJ(e.json.origins[t]),UJ(e.json.origins[t]),NJ(e.json.origins[t]);return!0}function NJ(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function FJ(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function UJ(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const cAe=de.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function kJ(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&the(e.type))?t.write.writer=dAe:i>1?t.write.writer=pAe(i):t.types?Array.isArray(t.types)?t.write.writer=hAe(t.types[0]):t.write.writer=uAe(t.types):t.write.writer=AO}function uAe(e){return(t,i,r,s)=>t?nhe(t,e,s)?AO(t,i,r,s):void 0:AO(t,i,r,s)}function nhe(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i!=null&&i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new q(`${n}:unsupported`,o,{definition:e,context:i})),cAe.error(o)}return!1}function hAe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?AO(t,i,r,s):AO(t.filter(n=>nhe(n,e,s)),i,r,s)}function AO(e,t,i,r){_c(i,UN(e,r),t)}function UN(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?kN(e):e}function kN(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function dAe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>UN(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[UN(e,r)],_c(i,s,t)}function ohe(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>ohe(r,t,i-1)):UN(e,t)}function pAe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=ohe(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}_c(r,n,i)}}function I8(e,t){return Hq(e,"read",t)}function ahe(e,t){return Hq(e,"write",t)}function Hq(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function fAe(e){const t=mAe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?gAe(r):t;DJ(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=F({},e.json.write)),kJ(s,r)}DJ(t,e.json,!0),kJ(t,e.json)}function mAe(e){return e.json.types?$8(e.json):e.type?lhe(e):$8(e)}function gAe(e){return e.type?lhe(e):$8(e)}function lhe(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!jue(i);)i=i[0],t++;return{type:i,ndimArray:t}}function $8(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function yAe(e){lAe(e)&&(iAe(e),fAe(e))}const hz=new Set,dz=new Set;function P(e){return t=>{t.prototype.declaredClass=e,_Ae(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!hz.has(s.initialize)&&(hz.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!dz.has(s.destroy)&&(dz.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);hz.clear(),dz.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=n3(t.prototype),n.prototype.declaredClass=e,n}}function vAe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;ei(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function _Ae(e){const t=e.prototype,i=n3(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];yAe(n),r[s]={enumerable:!0,configurable:!0,get:vAe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Ef.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}function He(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=Zue(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}let LM;var wue,xue,Tue;const pz=(Tue=(wue=globalThis.esriConfig)==null?void 0:wue.locale)!=null?Tue:(xue=globalThis.dojoConfig)==null?void 0:xue.locale;function che(){var e,t;return(t=pz!=null?pz:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function Tu(){return LM===void 0&&(LM=che()),LM}const NM=[];function bAe(e){return NM.push(e),{remove(){NM.splice(NM.indexOf(e),1)}}}const D8=[];function qq(e){return D8.push(e),{remove(){NM.splice(D8.indexOf(e),1)}}}function wAe(){const e=che();LM!==e&&(LM=e,[...D8].forEach(t=>{t.call(null,e)}),[...NM].forEach(t=>{t.call(null,e)}))}var Sue;(Sue=globalThis.addEventListener)==null||Sue.call(globalThis,"languagechange",wAe);const Tp={year:"numeric",month:"numeric",day:"numeric"},QE={year:"numeric",month:"long",day:"numeric"},JE={year:"numeric",month:"short",day:"numeric"},KE={year:"numeric",month:"long",weekday:"long",day:"numeric"},ih={hour:"numeric",minute:"numeric"},rd=ye(F({},ih),{second:"numeric"}),Wq={"short-date":Tp,"short-date-short-time":F(F({},Tp),ih),"short-date-short-time-24":ye(F(F({},Tp),ih),{hour12:!1}),"short-date-long-time":F(F({},Tp),rd),"short-date-long-time-24":ye(F(F({},Tp),rd),{hour12:!1}),"short-date-le":Tp,"short-date-le-short-time":F(F({},Tp),ih),"short-date-le-short-time-24":ye(F(F({},Tp),ih),{hour12:!1}),"short-date-le-long-time":F(F({},Tp),rd),"short-date-le-long-time-24":ye(F(F({},Tp),rd),{hour12:!1}),"long-month-day-year":QE,"long-month-day-year-short-time":F(F({},QE),ih),"long-month-day-year-short-time-24":ye(F(F({},QE),ih),{hour12:!1}),"long-month-day-year-long-time":F(F({},QE),rd),"long-month-day-year-long-time-24":ye(F(F({},QE),rd),{hour12:!1}),"day-short-month-year":JE,"day-short-month-year-short-time":F(F({},JE),ih),"day-short-month-year-short-time-24":ye(F(F({},JE),ih),{hour12:!1}),"day-short-month-year-long-time":F(F({},JE),rd),"day-short-month-year-long-time-24":ye(F(F({},JE),rd),{hour12:!1}),"long-date":KE,"long-date-short-time":F(F({},KE),ih),"long-date-short-time-24":ye(F(F({},KE),ih),{hour12:!1}),"long-date-long-time":F(F({},KE),rd),"long-date-long-time-24":ye(F(F({},KE),rd),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":ih,"long-time":rd},MO=da()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});MO.apiValues;MO.toJSON.bind(MO);MO.fromJSON.bind(MO);const xAe={ar:"ar-u-nu-latn-ca-gregory"};let RD=new WeakMap,uhe=Wq["short-date-short-time"];function TAe(e){const t=e||uhe;if(!RD.has(t)){const i=Tu(),r=xAe[Tu()]||i;RD.set(t,new Intl.DateTimeFormat(r,t))}return RD.get(t)}function r5(e){return Wq[e]||null}function Vf(e,t){return TAe(t).format(e)}qq(()=>{RD=new WeakMap,uhe=Wq["short-date-short-time"]});const SAe={ar:"ar-u-nu-latn"};let PD=new WeakMap,hhe={};function EAe(e){const t=e||hhe;if(!PD.has(t)){const i=Tu(),r=SAe[Tu()]||i;PD.set(t,new Intl.NumberFormat(r,e))}return PD.get(t)}function dhe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Bf(e,t){return e===-0&&(e=0),EAe(t).format(e)}qq(()=>{PD=new WeakMap,hhe={}});const phe=de.getLogger("esri.intl");function Im(e,t,i={}){const{format:r={}}=i;return zf(e,s=>CAe(s,t,r))}function CAe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=pE(r,t);if(o==null)return"";const a=i[s]||i[r];return a?AAe(o,a):s?MAe(o,s):Xq(o)}function AAe(e,t){switch(t.type){case"date":return Vf(e,t.intlOptions);case"number":return Bf(e,t.intlOptions);default:return phe.warn("missing format descriptor for key {key}"),Xq(e)}}function MAe(e,t){switch(t.toLowerCase()){case"dateformat":return Vf(e);case"numberformat":return Bf(e);default:return phe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Vf(e):/^numberformat/i.test(t)?Bf(e):Xq(e)}}function Xq(e){switch(typeof e){case"string":return e;case"number":return Bf(e);case"boolean":return""+e;default:return e instanceof Date?Vf(e):""}}function OAe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const s5=OAe(globalThis),zJ=new Set;function RAe(e,t,i=!1){i&&zJ.has(t)||(i&&zJ.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function PAe(e,t,i={}){if(he("esri-deprecation-warnings")){const{moduleName:r}=i;fhe(e,`Property: ${(r?r+"::":"")+t}`,i)}}function fhe(e,t,i={}){if(he("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),RAe(e,a,o)}}function n5(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function o3(e,t,i){if(!n5(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function mhe(e,t,i){if(!n5(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=o3(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const IAe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function cb({key:e}){return IAe[e]||e}function hi(e="Aborted"){return new q("AbortError",e)}function Wt(e,t="Aborted"){if(bs(e))throw hi(t)}function o5(e){return _(e)?"aborted"in e?e:e.signal:e}function bs(e){const t=o5(e);return _(t)&&t.aborted}function bp(e){if(Br(e))throw e}function L8(e){if(!Br(e))throw e}function Fo(e,t){const i=o5(e);if(!M(i)){if(!i.aborted)return mhe(i,"abort",()=>t());t()}}function Yq(e,t){const i=o5(e);if(!M(i))return Wt(i),mhe(i,"abort",()=>t(hi()))}function a5(e,t){const i=o5(t);return M(i)?e:new Promise((r,s)=>{let n=Fo(t,()=>s(hi()));const o=()=>n=sn(n);e.then(o,o),e.then(r,s)})}function Br(e){return e&&e.name==="AbortError"}async function N8(e){try{return await e}catch(t){if(!Br(t))throw t}}async function Mbt(e,t=de.getLogger("esri")){try{return await e}catch(i){Br(i)||t.error(i)}}function zv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Ba(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Ba(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function ghe(e){return(await Ba(e)).filter(t=>!!t.value).map(t=>t.value)}function h2(e,t,i){const r=new AbortController;return Fo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Fo(r,()=>{o&&(clearTimeout(o),n(hi()))})})}function Fu(e){return e&&typeof e.then=="function"}function F8(e){return Fu(e)?e:Promise.resolve(e)}function yhe(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(hi()),n=zv();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||zv(),n=null,t>0){const f=new AbortController;i=F8(e(...l,f.signal));const m=i;h2(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=F8(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function hp(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>s5.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Obt(e,t){return e.then(t,t)}function a3(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=Fo(t,()=>{_(n)&&n.abort()}),n}async function VJ(e){await Promise.resolve(),Wt(e)}const BJ=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,$Ae={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function GJ(e){var t;return(t=$Ae[e])!=null?t:!1}const fA=[],NS=new Map;function jJ(e){for(const t of NS.keys())_he(e.pattern,t)&&NS.delete(t)}function DAe(e){return fA.includes(e)||(jJ(e),fA.unshift(e)),{remove(){const t=fA.indexOf(e);t>-1&&(fA.splice(t,1),jJ(e))}}}async function vhe(e){const t=Tu();NS.has(e)||NS.set(e,NAe(e,t));const i=NS.get(e);return await FAe.add(i),i}function LAe(e){if(!BJ.test(e))return null;const[,t,i]=BJ.exec(e),r=t+(i?"-"+i.toUpperCase():"");return GJ(r)?r:GJ(t)?t:null}async function NAe(e,t){const i=[];for(const r of fA)if(_he(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new q("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new q("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function _he(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}qq(()=>{NS.clear()});const FAe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=zv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},UAe=de.getLogger("esri.core.urlUtils"),mE=ki.request,HJ="esri/config: esriConfig.request.proxyUrl is not set.",bhe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,whe=/^\s*http:/i,kAe=/^\s*https:/i,zAe=/^\s*file:/i,VAe=/:\d+$/,BAe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,GAe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),jAe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class FS{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(GAe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(jAe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const wP={},HAe=new FS(ki.applicationUrl);let Na=HAe;const qAe=WAe();let Zq=qAe;const Qq=()=>Na,Rbt=()=>Zq;function WAe(){const e=Na.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Na.scheme}://${Na.host}${Na.port!=null?`:${Na.port}`:""}`}${t}`}function ho(e){const t={path:null,query:null},i=new FS(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=xhe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function xhe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function qJ(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function Hg(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>qJ(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):qJ(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function XAe(e=!1){let t,i=mE.proxyUrl;if(typeof e=="string"){t=eMe(e);const r=l5(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw UAe.warn(HJ),new q("urlutils:proxy-not-set",HJ);return t&&U8()&&(i=tW(i)),ho(i)}function Pbt(e){const t=l5(e);let i,r;if(t){const s=Jq(t.proxyUrl);i=s.path,r=s.query?xhe(s.query):null}if(i){const s=ho(e);e=i+"?"+s.path;const n=Hg(F(F({},r),s.query));n&&(e=`${e}?${n}`)}return e}const eC={path:"",query:""};function Jq(e){const t=e.indexOf("?");return t!==-1?(eC.path=e.slice(0,t),eC.query=e.slice(t+1)):(eC.path=e,eC.query=null),eC}function The(e){return e=(e=zN(e=nMe(e=Jq(e).path),!0)).toLowerCase()}function YAe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:The(e.urlPrefix)},i=mE.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function l5(e){const t=mE.proxyRules,i=The(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function She(e,t){return e=WJ(e),t=WJ(t),zN(e)===zN(t)}function WJ(e){const t=(e=sp(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Ehe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=mE.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function OO(e,t,i=!1){const r=z8(e),s=z8(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Kq(e){if(typeof e=="string"){if(!Su(e))return!0;e=z8(e)}if(OO(e,Na))return!0;const t=mE.trustedServers||[];for(let i=0;i<t.length;i++){const r=ZAe(t[i]);for(let s=0;s<r.length;s++)if(OO(e,r[s]))return!0}return!1}function ZAe(e){return wP[e]||(eW(e)||Gf(e)?wP[e]=[new FS(_u(e))]:wP[e]=[new FS(`http://${e}`),new FS(`https://${e}`)]),wP[e]}function _u(e,t=Zq,i){return Gf(e)?i&&i.preserveProtocolRelative?e:Na.scheme==="http"&&Na.authority===np(e).slice(2)?`http:${e}`:`https:${e}`:eW(e)?e:ow(e[0]==="/"?sMe(t):t,e)}function c5(e,t=Zq,i){if(!Su(e))return e;const r=sp(e),s=r.toLowerCase(),n=sp(t).toLowerCase().replace(/\/+$/,""),o=i?sp(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function sp(e){return e=lMe(e=aMe(e=oMe(e=_u(e=e.trim()))))}function ow(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(Su(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),iMe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function np(e,t=!1){if(d2(e)||em(e))return null;let i=e.indexOf("://");if(i===-1&&Gf(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=zN(e,!0)),e}function Su(e){return Gf(e)||eW(e)}function d2(e){return e!=null&&e.slice(0,5)==="blob:"}function em(e){return e.slice(0,5)==="data:"}function Che(e){const t=u5(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function Ibt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const QAe=/^data:(.*?)(;base64)?,(.*)$/;function u5(e){const t=e.match(QAe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function Ahe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function $bt(e,t){JAe(e,t)||KAe(e,t)}function JAe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function KAe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Gf(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function eW(e){return bhe.test(e)}function eMe(e){return kAe.test(e)||Na.scheme==="https"&&Gf(e)}function tMe(e){return whe.test(e)||Na.scheme==="http"&&Gf(e)}function iMe(e){return zAe.test(e)}function tW(e){return Gf(e)?`https:${e}`:e.replace(whe,"https:")}function rMe(){return Na.scheme==="http"}function U8(){return Na.scheme==="https"}function zN(e,t=!1){return Gf(e)?e.slice(2):(e=e.replace(bhe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function sMe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function Mhe(e){let t=0;if(Su(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function Dbt(e,t){if(!e)return"";const i=ho(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t!=null&&t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function nMe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Ohe(e){return e.replace(/\/+$/,"")}function oMe(e){if(/^https?:\/\//i.test(e)){const t=Jq(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function aMe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function lMe(e){const t=mE.httpsDomains;if(!tMe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),VAe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return rMe()&&r===Na.authority&&!BAe.test(e)||(U8()&&r===Na.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||U8()&&!l5(e))&&(e=tW(e)),e}function k8(e,t,i){if(!(t&&i&&e&&Su(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function z8(e){return typeof e=="string"?new FS(_u(e)):(e.scheme||(e.scheme=Na.scheme),e)}function iW(e){return uMe.test(e)}function Rhe(e,t){const i=ho(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Phe(e,t,i){const r=ho(e),s=r.query||{};return s[t]=String(i),`${r.path}?${Hg(s)}`}function fz(e,t){const i=ho(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=Hg(r);return s?`${i.path}?${s}`:i.path}function Lbt(e){if(M(e))return null;const t=e.match(cMe);return t?t[1]:null}const cMe=/.*?\.([^\/]*)$/,uMe=/(^data:image\/svg|\.svg$)/i,Ihe="20220708",$he="7fd01dbc0e83d753fcf101c8ff2a8d215430252d",Dhe="4.24",hMe={async request(e,t){var a;const{default:i}=await Promise.resolve().then(function(){return khe}),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=Ehe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Fs;function Nbt(e){Fs=e}function Fbt(e){const t=Fs&&Fs.findCredential(e);return t&&t.token?Phe(e,"token",t.token):e}he("host-webworker")||(he("edge")||he("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const dMe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Lhe(e){const t=np(e,!0);return t&&t.endsWith(".arcgis.com")&&!dMe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Nhe(e,t,i=!1,r){return new Promise((s,n)=>{if(bs(r))return void n(XJ());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(XJ())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function XJ(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function pMe(e){ki.request.crossOriginNoCorsDomains||(ki.request.crossOriginNoCorsDomains={});const t=ki.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[np(i)]=0:(t[np("http://"+i)]=0,t[np("https://"+i)]=0)}function fMe(e){const t=ki.request.crossOriginNoCorsDomains;if(t){let i=np(e);if(i)return i=i.toLowerCase(),!OO(i,Qq())&&t[i]<Date.now()-36e5}return!1}async function mMe(e){var r;const t=ki.request.crossOriginNoCorsDomains;t&&(t[np(e).toLowerCase()]=Date.now());const i=ho(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function _i(e,t){var c;const i=em(e),r=d2(e);r||i||(e=sp(e));const s={url:e,requestOptions:F({},t)};let n=Ehe(e);if(n){const h=await TMe(n,s);if(h!=null)return{data:h,getHeader:rW,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw Xd("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw Xd("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Xd("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Xd("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await bMe(),VN)return VN.execute(e,t);const o=new AbortController;Fo(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Ud.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await EMe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let VN;const Ud=ki.request,Fhe="FormData"in globalThis,gMe=[499,498,403,401],yMe=["COM_0056","COM_0057","SB_0008"],vMe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],rW=()=>null,V8=Symbol();function _Me(e){const t=np(e);t&&!_i._corsServers.includes(t)&&_i._corsServers.push(t)}function YJ(e){const t=np(e);return!t||t.endsWith(".arcgis.com")||_i._corsServers.includes(t)||Kq(t)}function Xd(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:rW,ssl:!1};if(t instanceof q)return t.details?(t.details=te(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=V8 in t?t[V8]:t}return Br(t)?hi():new q(e,s,n)}async function bMe(){he("host-webworker")?VN||(VN=await import("./request.06f7c832.js")):_i._abortableFetch||(_i._abortableFetch=globalThis.fetch.bind(globalThis))}async function B8(){Fs||await import("./IdentityManager.c234e895.js")}async function wMe(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(Fhe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!_i._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Ud.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&ki.apiKey&&Lhe(t)&&(i.query||(i.query={}),i.query.token=ki.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Uhe(t)&&!bs(r)){let l;i.authMode==="immediate"?(await B8(),l=await Fs.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await B8(),l=await Fs.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Fs&&(l=Fs.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function Uhe(e){return vMe.some(t=>t.test(e))}async function xMe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=d2(t)||em(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Ud.timeout;let a=!1;if(!s){e.useSSL&&(t=tW(t)),i.cacheBust&&r.cache==="default"&&(t=Phe(t,"request.preventCache",Date.now()));let f=F({},i.query);e.credentialToken&&(f.token=e.credentialToken);let m=Hg(f);he("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const y=t.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>Ud.maxUrlLength;const b=i.useProxy||!!l5(t);if(b){const w=XAe(t);v=w.path,!a&&v.length+1+y>Ud.maxUrlLength&&(a=!0),w.query&&(f=F(F({},w.query),f))}if(r.method==="HEAD"&&(a||b)){if(a)throw y>Ud.maxUrlLength?Xd("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Xd("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(b)throw Xd("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=fz(t,f):(r.body=Hg(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=fz(t,f),b&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&Fhe&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!OO(t,Qq())){if(Kq(t))e.withCredentials=!0;else if(Fs){const w=Fs.findServerInfo(t);w&&w.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",fMe(t)&&await mMe(a?fz(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||SMe(i.headers)||!s&&!e.useProxy&&Ud.proxyUrl&&!YJ(t)){if(l=await _i._abortableFetch(t,r),e.useProxy||_Me(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=ZJ(c,"application/xml");break;case"document":c=ZJ(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await QJ(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await QJ(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):hi("Request canceled");if(!(!l&&f instanceof TypeError&&Ud.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||YJ(t))throw f;e.redoRequest=!0,YAe({proxyUrl:Ud.proxyUrl,urlPrefix:np(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function TMe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=F(F({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=F(F({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=Xd("request:interceptor",s,t)}if((r instanceof Error||r instanceof q)&&(i=Xd("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function SMe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function ZJ(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function EMe(e){var n;let t,i;await wMe(e);try{do[t,i]=await xMe(e);while(!await CMe(e,t,i))}catch(o){const a=Xd("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!Kq(r)){const o=np(r,!0);o&&Ud.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&pMe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Fs){const o=Fs.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Fs.findCredential(a,s.userId);l&&Fs._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):rW,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function CMe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[V8]=i,s;i!=null&&i.error&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&gMe.includes(n)&&!Uhe(e.params.url)&&(n!==403||!yMe.includes(a)&&(o==null||o===2&&e.credentialToken))){await B8();try{const c=await Fs.getCredential(e.params.url,{error:Xd("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function QJ(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Ud.priority,s.src=e,Nhe(s,e,i,r)}_i._abortableFetch=null,_i._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var khe=Object.freeze(Object.defineProperty({__proto__:null,default:_i},Symbol.toStringTag,{value:"Module"}));async function AMe(e,t,i,r){const s=t.exec(i);if(!s)throw new q("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=LAe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await JJ(e(c))}catch(p){if(c===l)throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await JJ(e(l))}catch(f){throw new q("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function JJ(e){if(_(KJ.fetchBundleAsset))return KJ.fetchBundleAsset(e);const t=await _i(e,{responseType:"text"});return JSON.parse(t.data)}class MMe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return AMe(this.getAssetUrl,this.matcher,t,i)}}function OMe(e){return new MMe(e)}const KJ={},RMe=de.getLogger("esri.assets");function PMe(e,t){return _i(Ni(e),t)}function Ni(e){if(!ki.assetsPath)throw RMe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new q("assets:path-not-set","config.assetsPath is not set");return ow(ki.assetsPath,e)}DAe(OMe({pattern:"esri/",location:Ni}));function h5(e){return typeof e=="string"?document.getElementById(e):e}function zhe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function eK(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function tK(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function Ubt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function kbt(e,t){for(const i of e)if(i!=null&&t(i))return i}function Vhe(e){return e!=null&&typeof e[Symbol.iterator]=="function"}function IMe(e){return e&&e.release&&typeof e.release=="function"}function $Me(e){return e&&e.acquire&&typeof e.acquire=="function"}class Ts{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(Ts.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):$Me(i)&&i.acquire(...t),i}release(t){t&&!Ts.test.disabled&&(this.releaseFunction?this.releaseFunction(t):IMe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}Ts.test={disabled:!1};var Ye;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Ye||(Ye={}));const G8=Ye.USER+1;function Dh(e){switch(e){case"defaults":return Ye.DEFAULTS;case"service":return Ye.SERVICE;case"portal-item":return Ye.PORTAL_ITEM;case"web-scene":return Ye.WEB_SCENE;case"web-map":return Ye.WEB_MAP;case"user":return Ye.USER}}function RO(e){switch(e){case Ye.DEFAULTS:return"defaults";case Ye.SERVICE:return"service";case Ye.PORTAL_ITEM:return"portal-item";case Ye.WEB_SCENE:return"web-scene";case Ye.WEB_MAP:return"web-map";case Ye.USER:return"user"}return void 0}function DMe(e){return RO(e)}class Bhe{constructor(t,i){this._observers=t,this._observer=i}remove(){Lq(this._observers,this._observer)}}class iK{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=vr.Dirty|(r.nonNullable?vr.NonNullable:0)|(r.hasOwnProperty("value")?vr.HasDefaultValue:0)|(r.get===void 0?vr.DepTrackingInitialized:0)|(r.dependsOn===void 0?vr.AutoTracked:0)}destroy(){if(this.flags&vr.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){ei(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&vr.Computing||~r&vr.Dirty&&t.has(i))return s;this.flags|=vr.Computing;const n=this.properties.host;let o;r&vr.AutoTracked?o=jg(this,this.metadata.get,n):(ehe(n,this),o=this.metadata.get.call(n)),t.set(i,o,Ye.COMPUTED);const a=t.get(i);return a===s?this.flags&=~vr.Dirty:eAe(this.commit,this),this.flags&=~vr.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=vr.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new Bhe(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&vr.Overriden&&(this.flags|=vr.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~vr.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class sW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new sW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,te(r))}),i}get(t){return this._values.get(t)}originOf(){return Ye.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function xP(e,t,i){return e!==void 0}function rK(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&vr.NonNullable)||(r.lifecycle,Ef.INITIALIZING,!1))}function LMe(e){return e&&typeof e.destroy=="function"}de.getLogger("esri.core.accessorSupport.Properties");class NMe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Ef.INITIALIZING,this.store=new sW,this._origin=Ye.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new iK(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=Ef.CONSTRUCTING}constructed(){this.lifecycle=Ef.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&LMe(r)&&(r.destroy(),~i.flags&vr.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==Ef.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();ei(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&vr.HasDefaultValue)return"defaults"}return RO(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(xP(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);xP(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!xP(s))return"";const n=new Set,o=jg({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof iK))continue;const c=l.properties.host,h=l.propertyName,p=Nn(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(xP(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&vr.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&vr.Overriden&&(i.flags&=~vr.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!rK(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(mz.release(n),!o)return;i=a}r.flags|=vr.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!rK(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(mz.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=Dh(t)}getDefaultOrigin(){return RO(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==Ef.INITIALIZING?this._origin:Ye.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&Fq(i,s.get(n))&&~t.flags&vr.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),Kue(this.host,t))}_cast(t,i){const r=mz.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class FMe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const mz=new Ts(FMe);function UMe(e){e.length=0}class uc{constructor(t=50,i=50){this._pool=new Ts(Array,void 0,UMe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return gz.acquire()}static release(t){return gz.release(t)}static prune(){gz.prune()}}const gz=new uc(100);class Ghe extends Ts{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=cCe(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const TP=[];function p2(e){TP.push(e),TP.length===1&&queueMicrotask(()=>{const t=TP.slice();TP.length=0;for(const i of t)i()})}const kMe=29;class Sv{constructor(t,i=kMe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var j8;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(j8||(j8={}));const sK=j8,zMe=1.5,VMe=1.1;class It{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Dq,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>nK(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,nK(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=ON(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=J4(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=gCe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){sK.sort(this.data,0,this.length,t)}iterableSort(t){return sK.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function nK(e){e.data.length>zMe*e.length&&(e.data.length=Math.floor(e.length*VMe))}function jhe(e){return 1e3*e}function nW(e){return .001*e}class BMe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class GMe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let H8=0,q8=0;const tC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},W8=["prepare","preRender","render","postRender","update","finish"],X8=[],aw=new It;class jMe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const BN={frameTasks:aw,willDispatch:!1,clearFrameTasks:HMe,dispatch:Whe,executeFrameTasks:WMe};function gE(e){const t=new GMe(e);return X8.push(t),BN.willDispatch||(BN.willDispatch=!0,p2(Whe)),t}function lw(e){const t=new BMe(e);return aw.push(t),GN==null&&(H8=performance.now(),GN=requestAnimationFrame(Hhe)),new jMe(t)}let GN=null;function HMe(e=!1){aw.forAll(t=>{t.removed=!0}),e&&qhe()}function qMe(e){q8=Math.max(0,e)}function Hhe(){const e=performance.now();GN=null,GN=aw.length>0?requestAnimationFrame(Hhe):null,BN.executeFrameTasks(e)}function WMe(e){const t=e-H8;H8=e;const i=q8>0?q8:1e3/60,r=Math.max(0,t-i);for(let s=0;s<W8.length;s++){const n=performance.now(),o=W8[s];aw.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(tC.time=e,tC.deltaTime=a.ticks===0?0:t,tC.elapsedFrameTime=performance.now()-e,tC.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,tC)))}),YMe[s].record(performance.now()-n)}qhe(),ZMe.record(performance.now()-e)}const SP=new It;function qhe(){aw.forAll(e=>{e.removed&&SP.push(e)}),aw.removeUnorderedMany(SP.data,SP.length),SP.clear()}function Whe(){for(;X8.length;){const e=X8.shift();e.isActive&&e.callback()}BN.willDispatch=!1}function XMe(e=1,t){const i=hp(),r=()=>{bs(t)?i.reject(hi()):e===0?i():(--e,p2(()=>r()))};return r(),i.promise}const YMe=W8.map(e=>new Sv(e)),ZMe=new Sv("total");function ID(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let QMe=0;const JMe=0;function wl(){return++QMe}class d5{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let US=!1;const jN=[];function Xhe(e,t){let i=new d5(n),r=null,s=!1;function n(){if(!i||s)return;if(US)return void Qhe(n);const a=r;i.clear(),US=!0,s=!0,r=jg(i,e),s=!1,US=!1,t(r,a),Jhe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=jg(i,e),s=!1,{remove:o}}function Yhe(e,t){let i=new d5(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=jg(i,e),r):null}return o(),{remove:n}}function Zhe(e){let t=new d5(r),i=!1;function r(){t&&!i&&(US?Qhe(r):(t.clear(),US=!0,i=!0,jg(t,e),i=!1,US=!1,Jhe()))}function s(){t&&(t.destroy(),t=null)}return i=!0,jg(t,e),i=!1,{remove:s}}function Qhe(e){jN.includes(e)||jN.unshift(e)}function Jhe(){for(;jN.length;)jN.pop()()}var FM;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(FM||(FM={}));class PO{constructor(){this.uid=wl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(FM.Untracked,t,i,r,s,n,Fq)}static acquireTracked(t,i,r,s){return this.pool.acquire(FM.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===FM.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=wl(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=wl(),this.removed=!0}}PO.pool=new Ghe(PO);const $D=new uc,Og=new Set;let HN;function qN(e){Og.delete(e),Og.add(e),HN||(HN=gE(tOe))}function KMe(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function eOe(e){for(const t of Og.values())t.target===e&&(t.removed=!0)}function tOe(){let e=10;for(;HN&&e--;){HN=null;const t=iOe(),i=$D.acquire();for(const r of t){const s=r.uid;KMe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Og)r.removed&&(i.push(r),Og.delete(r));for(const r of i)PO.pool.release(r);$D.release(i),$D.release(t),Y8.forEach(r=>r())}}function iOe(){const e=$D.acquire();e.length=Og.size;let t=0;for(const i of Og)e[t]=i,++t;return Og.clear(),e}const Y8=new Set;function Khe(e){return Y8.add(e),{remove(){Y8.delete(e)}}}function rOe(e,t,i){let r=Wue(e,t,i,(s,n,o)=>{let a,l,c=Yhe(()=>s3(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=PO.acquireUntracked(h,o,p,s,n),l=a.uid),qN(a))});return{remove:zq(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,qN(a)),a=null),r=c=null})}});return r}function sOe(e,t,i){const r=Wue(e,t,i,(s,n,o)=>{let a=!1;return Xhe(()=>s3(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,Fq(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function nOe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?sOe(e,t,i):rOe(e,t,i)}function oOe(e,t,i){let r,s,n=Yhe(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=PO.acquireTracked(o,t,a,i),s=r.uid),qN(r))});return{remove:zq(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,qN(r)),r=null),n=null})}}function aOe(e,t,i){let r=!1;return Xhe(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function lOe(e,t,i=!1,r=xCe){return i?aOe(e,t,r):oOe(e,t,r)}function oK(e){return ID(Og,t=>t.oldValue===e)}var ede;function cOe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const mA=Symbol("Accessor-Handles");class Ae{constructor(...t){if(this[ede]=null,this.constructor===Ae)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new NMe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}n3(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=cOe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(Qs(this[mA],t=>{t.forEach(i=>i.remove())}),this[mA]=null,eOe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Ef.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return LN(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return NN(this,t,i),this}watch(t,i,r){return nOe(this,t,i,r)}own(t){let i=this[mA];if(M(i)&&(i=this[mA]=new Set),Vhe(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}ede=mA;class kS{constructor(){this._emitter=new kS.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return u2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends Ae{constructor(){super(...arguments),this._emitter=new kS.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(kS||(kS={}));const Zr=kS;var Yi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Yi||(Yi={}));class tde{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new Bhe(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var mg;class uOe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Bu=new Ts(uOe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),hOe=()=>{};function yz(e){return e?e instanceof ub?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function vz(e){if(e&&e.length)return e[0]}function dOe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function ide(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),ide(e,i.call(r,s,n,o),i,r)})}const _y=new Set,by=new Set,wy=new Set,_z=new Map;let pOe=0,ub=mg=class extends Zr.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new tde,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:pOe++})}static isCollection(e){return e!=null&&e instanceof mg}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof mg?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return ei(this._observable),this._items}set items(e){this._emitBeforeChanges(Yi.ADD)||(this._splice(0,this.length,yz(e)),this._emitAfterChanges(Yi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=hOe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(ei(this._observable),this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Yi.ADD),this}addMany(e,t=this._items.length){if(ei(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,yz(e)),this._emitAfterChanges(Yi.ADD),this}at(e){if(ei(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Yi.REMOVE),e}clone(){return ei(this._observable),this._createNewInstance({items:this._items.map(te)})}concat(...e){ei(this._observable);const t=e.map(yz);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Yi.REMOVE)}every(e,t){return ei(this._observable),this._items.every(e,t)}filter(e,t){let i;return ei(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return ei(this._observable),this._items.find(e,t)}findIndex(e,t){return ei(this._observable),this._items.findIndex(e,t)}flatten(e,t){ei(this._observable);const i=[];return ide(i,this,e,t),new mg(i)}forEach(e,t){return ei(this._observable),this._items.forEach(e,t)}getItemAt(e){return ei(this._observable),this._items[e]}getNextIndex(e){ei(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return ei(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return ei(this._observable),this._items.indexOf(e,t)}join(e=","){return ei(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return ei(this._observable),this._items.lastIndexOf(e,t)}map(e,t){ei(this._observable);const i=this._items.map(e,t);return new mg({items:i})}reorder(e,t=this.length-1){ei(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Yi.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Yi.MOVE)}return e}}pop(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=vz(this._splice(this.length-1,1));return this._emitAfterChanges(Yi.REMOVE),e}push(...e){return ei(this._observable),this._emitBeforeChanges(Yi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Yi.ADD)),this.length}reduce(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return ei(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(ei(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Yi.REMOVE))return;const t=vz(this._splice(e,1));return this._emitAfterChanges(Yi.REMOVE),t}removeMany(e){if(ei(this._observable),!e||!e.length||this._emitBeforeChanges(Yi.REMOVE))return[];const t=e instanceof mg?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+dOe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Yi.REMOVE),r}reverse(){if(ei(this._observable),this._emitBeforeChanges(Yi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Yi.MOVE),this}shift(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=vz(this._splice(0,1));return this._emitAfterChanges(Yi.REMOVE),e}slice(e=0,t=this.length){return ei(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return ei(this._observable),this._items.some(e,t)}sort(e){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Yi.MOVE),this}splice(e,t,...i){ei(this._observable);const r=(t?Yi.REMOVE:0)|(i.length?Yi.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return ei(this._observable),this._items.slice()}toJSON(){return ei(this._observable),this.toArray()}toLocaleString(){return ei(this._observable),this._items.toLocaleString()}toString(){return ei(this._observable),this._items.toString()}unshift(...e){return ei(this._observable),!e.length||this._emitBeforeChanges(Yi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Yi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=gE(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=Bu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);Bu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Bu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Bu.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Bu.acquire();h.target=this,h.cancellable=!0;const p=Bu.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));Bu.release(p),Bu.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=Bu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,Bu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Bu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Bu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;_y.clear(),by.clear(),wy.clear();for(const{added:l,removed:c}of i){if(l)if(wy.size===0&&by.size===0)for(const h of l)_y.add(h);else for(const h of l)by.has(h)?(wy.add(h),by.delete(h)):wy.has(h)||_y.add(h);if(c)if(wy.size===0&&_y.size===0)for(const h of c)by.add(h);else for(const h of c)_y.has(h)?_y.delete(h):(wy.delete(h),by.add(h))}const r=uc.acquire();_y.forEach(l=>{r.push(l)});const s=uc.acquire();by.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=uc.acquire();if(wy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}uc.release(r),uc.release(s),uc.release(a)}_y.clear(),by.clear(),wy.clear()}};ub.ofType=e=>{if(!e)return mg;if(_z.has(e))return _z.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends mg{};return u([Vq({Type:e,ensureType:typeof e=="function"?Ss(e):up(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),_z.set(e,i),i},u([d()],ub.prototype,"length",void 0),u([d()],ub.prototype,"items",null),ub=mg=u([P("esri.core.Collection")],ub);const ct=ub;let DD=class extends Ae{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!ct.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||ct.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||ct.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],DD.prototype,"size",null),DD=u([P("esri.core.Handles")],DD);const si=DD;var U0;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(U0||(U0={}));class fOe{constructor(t){this.instance=t,this._resolver=zv(),this._status=U0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=U0.RESOLVED,this._cleanUp()},()=>{this._status=U0.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===U0.RESOLVED}isRejected(){return this._status===U0.REJECTED}isFulfilled(){return this._status!==U0.PENDING}abort(){this._resolver.reject(hi())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=zv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Br(s)||this._resolver.reject(s)}),t.resolve()}}const yE=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new fOe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let WN=class extends yE(Ae){};WN=u([P("esri.core.Promise")],WN);function ae(e,t,i={}){return oW(e,t,i,rde)}function Cl(e,t,i={}){return oW(e,t,i,sde)}function oW(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(sn(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=lOe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function oo(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&sn(o),i(h)}const c=ae(e,(h,p)=>{var f;a(),n5(h)&&(s=h,n=o3(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Vh(()=>{c.remove(),a()}),o}function IO(e,t){return mOe(e,sde,t)}function mOe(e,t,i){if(bs(i))return Promise.reject(hi());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function n(){s=sn(s)}return new Promise((o,a)=>{s=u2([Fo(i,()=>{n(),a(hi())}),oW(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:rde)])})}function rde(e){return!0}function sde(e){return!!e}const Qi={sync:!0},Ft={initial:!0},_s={sync:!0,initial:!0},gOe="randomUUID"in crypto;function yOe(){if(gOe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var vOe="[object Object]";function _Oe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function bOe(e,t){return function(i){return e(t(i))}}var wOe=Function.prototype,nde=Object.prototype,ode=wOe.toString,xOe=nde.hasOwnProperty,TOe=ode.call(Object),SOe=nde.toString,EOe=bOe(Object.getPrototypeOf,Object);function COe(e){return!!e&&typeof e=="object"}function AOe(e){if(!COe(e)||SOe.call(e)!=vOe||_Oe(e))return!1;var t=EOe(e);if(t===null)return!0;var i=xOe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&ode.call(i)==TOe}var MOe=AOe,hb={exports:{}},Vs={},$O={exports:{}},Xw={};function ade(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function OOe(e,t,i){}function ROe(e,t,i){}var POe=/javascript\s*\:/img;function IOe(e,t){return POe.test(t)?"":t}Xw.whiteList=ade();Xw.getDefaultWhiteList=ade;Xw.onAttr=OOe;Xw.onIgnoreAttr=ROe;Xw.safeAttrValue=IOe;var $Oe={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},iC=$Oe;function DOe(e,t){e=iC.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=iC.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=iC.trim(h.slice(0,p)),m=iC.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return iC.trim(o)}var LOe=DOe,EP=Xw,NOe=LOe;function aK(e){return e==null}function FOe(e){var t={};for(var i in e)t[i]=e[i];return t}function lde(e){e=FOe(e||{}),e.whiteList=e.whiteList||EP.whiteList,e.onAttr=e.onAttr||EP.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||EP.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||EP.safeAttrValue,this.options=e}lde.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=NOe(e,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var b=s(h,p,v);return aK(b)?h+":"+p:b}else{var b=n(h,p,v);if(!aK(b))return b}}});return a};var UOe=lde;(function(e,t){var i=Xw,r=UOe;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})($O,$O.exports);var aW={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},kOe=$O.exports.FilterCSS,zOe=$O.exports.getDefaultWhiteList,XN=aW;function cde(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var ude=new kOe;function VOe(e,t,i){}function BOe(e,t,i){}function GOe(e,t,i){}function jOe(e,t,i){}function hde(e){return e.replace(qOe,"&lt;").replace(WOe,"&gt;")}function HOe(e,t,i,r){if(i=yde(i),t==="href"||t==="src"){if(i=XN.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(CP.lastIndex=0,CP.test(i))return""}else if(t==="style"){if(lK.lastIndex=0,lK.test(i)||(cK.lastIndex=0,cK.test(i)&&(CP.lastIndex=0,CP.test(i))))return"";r!==!1&&(r=r||ude,i=r.process(i))}return i=vde(i),i}var qOe=/</g,WOe=/>/g,XOe=/"/g,YOe=/&quot;/g,ZOe=/&#([a-zA-Z0-9]*);?/gim,QOe=/&colon;?/gim,JOe=/&newline;?/gim,CP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,lK=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,cK=/u\s*r\s*l\s*\(.*/gi;function dde(e){return e.replace(XOe,"&quot;")}function pde(e){return e.replace(YOe,'"')}function fde(e){return e.replace(ZOe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function mde(e){return e.replace(QOe,":").replace(JOe," ")}function gde(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return XN.trim(t)}function yde(e){return e=pde(e),e=fde(e),e=mde(e),e=gde(e),e}function vde(e){return e=dde(e),e=hde(e),e}function KOe(){return""}function eRe(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:XN.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return XN.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function tRe(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function iRe(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}Vs.whiteList=cde();Vs.getDefaultWhiteList=cde;Vs.onTag=VOe;Vs.onIgnoreTag=BOe;Vs.onTagAttr=GOe;Vs.onIgnoreTagAttr=jOe;Vs.safeAttrValue=HOe;Vs.escapeHtml=hde;Vs.escapeQuote=dde;Vs.unescapeQuote=pde;Vs.escapeHtmlEntities=fde;Vs.escapeDangerHtml5Entities=mde;Vs.clearNonPrintableCharacter=gde;Vs.friendlyAttrValue=yde;Vs.escapeAttrValue=vde;Vs.onIgnoreTagStripAll=KOe;Vs.StripTagBody=eRe;Vs.stripCommentTag=tRe;Vs.stripBlankChar=iRe;Vs.cssFilter=ude;Vs.getDefaultCSSWhiteList=zOe;var p5={},k0=aW;function rRe(e){var t=k0.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=k0.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function sRe(e){return e.slice(0,2)==="</"}function nRe(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=rRe(h),r+=t(n,r.length,c,h,sRe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var oRe=/[^a-zA-Z0-9_:\.\-]/gim;function aRe(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=k0.trim(p),p=p.replace(oRe,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&r.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=k0.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=lRe(e,a),h===-1){c=k0.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=cRe(e,a-1),h===-1){c=k0.trim(e.slice(i,a)),c=uK(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,uK(k0.trim(e.slice(i))))),k0.trim(r.join(" "))}function lRe(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function cRe(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function uRe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function uK(e){return uRe(e)?e.substr(1,e.length-2):e}p5.parseTag=nRe;p5.parseAttr=aRe;var hRe=$O.exports.FilterCSS,Ld=Vs,_de=p5,dRe=_de.parseTag,pRe=_de.parseAttr,LD=aW;function AP(e){return e==null}function fRe(e){var t=LD.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=LD.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=LD.trim(e.slice(0,-1))),{html:e,closing:i}}function mRe(e){var t={};for(var i in e)t[i]=e[i];return t}function bde(e){e=mRe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Ld.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Ld.whiteList,e.onTag=e.onTag||Ld.onTag,e.onTagAttr=e.onTagAttr||Ld.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Ld.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Ld.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Ld.safeAttrValue,e.escapeHtml=e.escapeHtml||Ld.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new hRe(e.css))}bde.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=Ld.stripBlankChar(e)),i.allowCommentTag||(e=Ld.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=Ld.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=dRe(e,function(m,y,v,b,w){var S={sourcePosition:m,position:y,isClosing:w,isWhite:r.hasOwnProperty(v)},T=s(v,b,S);if(!AP(T))return T;if(S.isWhite){if(S.isClosing)return"</"+v+">";var E=fRe(b),C=r[v],A=pRe(E.html,function(L,D){var k=LD.indexOf(C,L)!==-1,z=o(v,L,D,k);if(!AP(z))return z;if(k)return D=l(v,L,D,h),D?L+'="'+D+'"':L;var z=a(v,L,D,k);return AP(z)?void 0:z}),b="<"+v;return A&&(b+=" "+A),E.closing&&(b+=" /"),b+=">",b}else{var T=n(v,b,S);return AP(T)?c(b):T}},c);return p&&(f=p.remove(f)),f};var gRe=bde;(function(e,t){var i=Vs,r=p5,s=gRe;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(hb,hb.exports);var yRe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):hb.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new hb.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?hb.exports.escapeAttrValue(t):!n&&!s?hb.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):hb.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(MOe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const f5=new Map;function wde(){f5.clear()}function vRe(e){return f5.get(e)}function _Re(e,t){f5.set(e,t)}function bz(e){f5.delete(e)}var cw,f2,bRe=function(e){if("WebkitTransition"in e.style)cw="webkitTransitionEnd",f2="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");cw="transitionend",f2="animationend"}},xde=function(e){cw||bRe(e)},wRe=function(e,t){return t===void 0&&(t=e+"-active"),function(i){xde(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(cw,s),i.removeEventListener(f2,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(cw,s),i.addEventListener(f2,s),requestAnimationFrame(function(){i.classList.add(t)})}},xRe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){xde(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(cw,n),i.removeEventListener(f2,n),r())};i.classList.add(e),i.addEventListener(cw,n),i.addEventListener(f2,n),requestAnimationFrame(function(){i.classList.add(t)})}};const TRe=de.getLogger("esri.widgets.support.widgetUtils");function Tde(e){const t=uc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return uc.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{wde();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&TRe.error("Already observing element",i),e.set(i,r),t.observe(i,s),Vh(()=>{t.unobserve(i),e.delete(i)}))})();function nv(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function hK(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function Z8(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function SRe(e,t){return(e==="enter"?wRe:xRe)(t)}const ERe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],CRe=ERe.reduce((e,t)=>(e[t]=[],e),{}),ARe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Sde=new yRe({whiteList:CRe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(ARe.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function MRe(e){return e==="Enter"||e===" "}const Ede="http://www.w3.org/",m5=`${Ede}2000/svg`,Cde=`${Ede}1999/xlink`;let YN,dK=[],lW=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},cW=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Ade=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},ORe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(cW(e[r],t))return r}return-1},wz=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(cW(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},RRe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},Q8=[],J8=!1,Mde=e=>{(e.children||[]).forEach(Mde),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},pK=()=>{J8=!1,Q8.forEach(Mde),Q8.length=0},fK=e=>{Q8.push(e),J8||(J8=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(pK,{timeout:16}):setTimeout(pK,16))},mK=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),fK(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),fK(e))},PRe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")K8(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Ade(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===m5?a==="href"?e.setAttributeNS(Cde,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=Sde.sanitize(l):e.setAttribute(a,l):e[a]=l}}},IRe=(e,t,i)=>{if(t)for(let r of t)uS(r,e,void 0,i)},Ode=(e,t,i)=>{IRe(e,t.children,i),t.text&&(e.textContent=t.text),PRe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},uS=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=lW(r,{namespace:m5})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Ode(s,e,r)}},K8=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},$Re=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(K8(e,h,!1),K8(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let v=f[y],b=!!c[v];b!==!!h[v]&&(s=!0,b?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],v=c[y];v!==h[y]&&(s=!0,v?(Ade(v),r.styleApplyer(e,y,v)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===m5?l==="href"?e.setAttributeNS(Cde,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=Sde.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},DRe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||dK;let n,o=(i=i||dK).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&cW(p,f))h=YN(p,f,s)||h,l++;else{let m=ORe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)mK(i[n]),wz(i,n,e,"removed");h=YN(i[m],f,s)||h,l=m+1}else uS(f,t,l<o?i[l].domNode:void 0,s),RRe(f),wz(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)mK(i[n]),wz(i,n,e,"removed");return h};YN=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=lW(i,{namespace:m5})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=DRe(t,r,e.children,t.children,i)||n,n=$Re(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let rC=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,YN(r,i,t)},domNode:e.domNode});const LRe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let vT=e=>lW(LRe,e),ov={create:(e,t)=>(t=vT(t),uS(e,document.createElement("div"),void 0,t),rC(e,t)),append:(e,t,i)=>(i=vT(i),uS(t,e,void 0,i),rC(t,i)),insertBefore:(e,t,i)=>(i=vT(i),uS(t,e.parentNode,e,i),rC(t,i)),merge:(e,t,i)=>(i=vT(i),t.domNode=e,Ode(e,t,i),rC(t,i)),replace:(e,t,i)=>(i=vT(i),uS(t,e.parentNode,e,i),e.parentNode.removeChild(e),rC(t,i))},Rde,NRe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};Rde=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let FRe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?Rde(i.children,s=>s.domNode===r):void 0}),i},URe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=NRe(s.currentTarget,n.domNode);o.reverse();let a,l=FRe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},e9=e=>{let t,i,r=vT(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,v=()=>y;r.eventHandlerInterceptor=URe(t,v,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(ov.append,p,f)},insertBefore:(p,f)=>{c(ov.insertBefore,p,f)},merge:(p,f)=>{c(ov.merge,p,f)},replace:(p,f)=>{c(ov.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t};const kRe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},zRe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},VRe=e=>F(F({},zRe),e),BRe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},GRe=(e,t)=>e.find(t),gK=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=r!=null&&r.children?GRe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},jRe=e=>{let t;const i=F(F({},kRe),e),r=VRe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var w;let v;r.eventHandlerInterceptor=(S,T,E,C)=>function(A){let I;s("domEvent",A);const L=BRe(A.currentTarget,v.domNode),D=L.some(z=>{var V;return customElements.get((V=z==null?void 0:z.tagName)==null?void 0:V.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!D)L.reverse(),I=gK(v.getLastRender(),L);else{const z=A.composedPath(),V=z.slice(z.indexOf(A.currentTarget),z.indexOf(v.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();I=gK(v.getLastRender(),V,!0)}let k;return I&&(k=i.handleInterceptedEvent(t,I,this,A)),s("domEventProcessed",A),k},(w=i.postProcessProjectionOptions)==null||w.call(i,r);const b=y();v=f(m,b,r),l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,b)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(ov.append,f,m)},insertBefore:(f,m)=>{h(ov.insertBefore,f,m)},merge:(f,m)=>{h(ov.merge,f,m)},replace:(f,m)=>{h(ov.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Ii={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let _T,Pde,g5,Ide=!1,ZN=!1,uW=!1,tu=!1,yK=null,t9=!1;const vE=typeof window!="undefined"?window:{};Ii.cssVarShim&&vE.CSS;const op=vE.document||{head:{}},_E=vE.HTMLElement||class{},aa={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},QN=Ii.shadowDomShim&&Ii.shadowDom?(()=>(op.head.attachShadow+"").indexOf("[native")>-1)():!0,HRe=(()=>{let e=!1;try{op.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),qRe=e=>Promise.resolve(e),WRe=Ii.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,$de=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=YRe(e,s),l=XRe(t,o),c=ZRe(s);aa.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>aa.rel(a,n,l,c))})},XRe=(e,t)=>i=>{try{Ii.lazyLoad||e.$hostElement$[t](i)}catch(r){l3(r)}},YRe=(e,t)=>t&4?op:t&8?vE:t&16?op.body:e,ZRe=e=>HRe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,vK="http://www.w3.org/1999/xlink",uw=(e,t="")=>()=>{},_K=new WeakMap,QRe=(e,t,i)=>{let r=eF.get(e);WRe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,eF.set(e,r)},JRe=(e,t,i,r)=>{let s=Dde(t,i),n=eF.get(s);if(e=e.nodeType===11?e:op,n)if(typeof n=="string"){e=e.head||e;let o=_K.get(e),a;o||_K.set(e,o=new Set),o.has(s)||(a=op.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},KRe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=uw("attachStyles",t.$tagName$),n=JRe(QN&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Dde=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),e3e=e=>P3e.map(t=>t(e)).find(t=>!!t),bK={},t3e="http://www.w3.org/2000/svg",i3e="http://www.w3.org/1999/xhtml",r3e=e=>e!=null,hW=e=>(e=typeof e,e==="object"||e==="function"),ui=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!hW(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?JN(null,r):r),a=o)};if(c(i),t&&(Ii.isDev&&e==="input"&&o3e(t),Ii.vdomKey&&t.key&&(s=t.key),Ii.slotRelocation&&t.name&&(n=t.name),Ii.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Ii.isDev&&l.some(Lde)&&R3e(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ii.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,s3e);const h=JN(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Ii.vdomKey&&(h.$key$=s),Ii.slotRelocation&&(h.$name$=n),h},JN=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ii.vdomAttribute&&(i.$attrs$=null),Ii.vdomKey&&(i.$key$=null),Ii.slotRelocation&&(i.$name$=null),i},y5={},Lde=e=>e&&e.$tag$===y5,s3e={forEach:(e,t)=>e.map(wK).forEach(t),map:(e,t)=>e.map(wK).map(t).map(n3e)},wK=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),n3e=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),ui(e.vtag,i,...e.vchildren||[])}const t=JN(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},o3e=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&Hde('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},xK=(e,t,i,r,s,n)=>{if(i!==r){let o=CK(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=TK(i),h=TK(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):CK(vE,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&aa.rel(e,t,i,!1),r&&aa.ael(e,t,r,!1);else{const l=hW(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(vK,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(vK,t,r):e.setAttribute(t,r))}}},a3e=/\s/,TK=e=>e?e.split(a3e):[],Nde=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||bK,o=t.$attrs$||bK;for(r in n)r in o||xK(s,r,n[r],void 0,i,t.$flags$);for(r in o)xK(s,r,n[r],o[r],i,t.$flags$)},KN=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(Ide||(uW=!0,s.$tag$==="slot"&&(_T&&r.classList.add(_T+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=op.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=op.createTextNode("");else{if(tu||(tu=s.$tag$==="svg"),o=s.$elm$=op.createElementNS(tu?t3e:i3e,s.$flags$&2?"slot-fb":s.$tag$),tu&&s.$tag$==="foreignObject"&&(tu=!1),Nde(null,s,tu),r3e(_T)&&o["s-si"]!==_T&&o.classList.add(o["s-si"]=_T),s.$children$)for(n=0;n<s.$children$.length;++n)a=KN(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?tu=!1:o.tagName==="foreignObject"&&(tu=!0)}return o["s-hn"]=g5,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Pde,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&DO(e.$elm$,!1)),o},DO=(e,t)=>{aa.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==g5&&s["s-ol"]&&(kde(s).insertBefore(s,dW(s)),s["s-ol"].remove(),s["s-ol"]=void 0,uW=!0),t&&DO(s,t)}aa.$flags$&=-2},Fde=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===g5&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=KN(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,dW(t))))},Ude=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Bde(r),ZN=!0,s["s-ol"]?s["s-ol"].remove():DO(s,!0),s.remove())},l3e=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(MP(c,f))bT(c,f),c=t[++s],f=r[++n];else if(MP(h,m))bT(h,m),h=t[--l],m=r[--p];else if(MP(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&DO(c.$elm$.parentNode,!1),bT(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(MP(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&DO(h.$elm$.parentNode,!1),bT(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=KN(t&&t[n],i,o,e):(bT(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=KN(t&&t[n],i,n,e),f=r[++n]),y&&kde(c.$elm$).insertBefore(y,dW(c.$elm$))}s>l?Fde(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&Ude(t,s,l)},MP=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,dW=e=>e&&e["s-ol"]||e,kde=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,bT=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(tu=n==="svg"?!0:n==="foreignObject"?!1:tu,n==="slot"||Nde(e,t,tu),r!==null&&s!==null?l3e(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Fde(i,null,t,s,0,s.length-1)):r!==null&&Ude(r,0,r.length-1),tu&&n==="svg"&&(tu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},zde=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}zde(i)}},Vd=[],Vde=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(SK(i,s)?(n=Vd.find(h=>h.$nodeToRelocate$===i),ZN=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Vd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Vd.map(h=>{SK(h.$nodeToRelocate$,i["s-sn"])&&(n=Vd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Vd.some(h=>h.$nodeToRelocate$===i)||Vd.push({$nodeToRelocate$:i}));t.nodeType===1&&Vde(t)}},SK=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Bde=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Bde)},c3e=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||JN(null,null),n=Lde(t)?t:ui(null,null,t);g5=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,_T=i["s-sc"],Pde=i["s-cr"],Ide=QN&&(r.$flags$&1)!==0,ZN=!1,bT(s,n);{if(aa.$flags$|=1,uW){Vde(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Vd.length;f++)o=Vd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=op.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Vd.length;f++)if(o=Vd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}ZN&&zde(n.$elm$),aa.$flags$&=-2,Vd.length=0}},u3e=e=>Ii.lazyLoad?wE(e).$hostElement$:e,Ab=(e,t,i)=>{const r=u3e(e);return{emit:s=>(Ii.isDev&&!r.isConnected&&Hde(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),h3e(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},h3e=(e,t,i)=>{const r=aa.ce(t,i);return e.dispatchEvent(r),r},d3e=(e,t)=>{},pW=(e,t)=>(e.$flags$|=16,d3e(e,e.$ancestorComponent$),D3e(()=>p3e(e,t))),p3e=(e,t)=>{const i=e.$hostElement$,r=uw("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=zS(s,"componentWillLoad"):n=zS(s,"componentWillUpdate"),n=EK(n,()=>zS(s,"componentWillRender")),r(),EK(n,()=>f3e(e,s,t))},f3e=async(e,t,i)=>{const r=e.$hostElement$,s=uw("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&KRe(e);const n=uw("render",e.$cmpMeta$.$tagName$);m3e(e,t,r),n(),s(),g3e(e)},m3e=(e,t,i)=>{try{yK=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ii.hasRenderFn||Ii.reflect)&&(Ii.vdomRender||Ii.reflect)&&(Ii.hydrateServerSide||c3e(e,t))}catch(a){l3(a,e.$hostElement$)}return yK=null,null},g3e=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=uw("postUpdate",t),s=i;e.$ancestorComponent$,zS(s,"componentDidRender"),e.$flags$&64?(zS(s,"componentDidUpdate"),r()):(e.$flags$|=64,zS(s,"componentDidLoad"),r())},zbt=e=>{if(Ii.updatable){const t=wE(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&pW(t,!1),i}return!1},zS=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){l3(r)}},EK=(e,t)=>e&&e.then?e.then(t):t(),y3e=(e,t)=>e!=null&&!hW(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,v3e=(e,t)=>wE(e).$instanceValues$.get(t),_3e=(e,t,i,r)=>{const s=wE(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=y3e(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){l3(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;pW(s,!1)}}}},b3e=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return v3e(this,n)},set(a){_3e(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){aa.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},w3e=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=e3e(e)]);const a=Dde(i,t.$modeName$);if(!eF.has(a)){const l=uw("registerStyles",i.$tagName$);QRe(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>pW(t,!0))()},x3e=e=>{},T3e=e=>{if((aa.$flags$&1)===0){const t=wE(e),i=t.$cmpMeta$,r=uw("connectedCallback",i.$tagName$);t.$flags$&1?($de(e,t,i.$listeners$),x3e(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&S3e(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),w3e(e,t,i)),r()}},S3e=e=>{const t=e["s-cr"]=op.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},E3e=e=>{if((aa.$flags$&1)===0){const t=wE(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},bE=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Ii.member&&(i.$members$=t[2]),Ii.hostListener&&(i.$listeners$=t[3]),Ii.watchCallback&&(i.$watchers$=e.$watchers$),Ii.reflect&&(i.$attrsToReflect$=[]),Ii.shadowDom&&!QN&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){O3e(this,i)},connectedCallback(){T3e(this),Ii.connectedCallback&&r&&r.call(this)},disconnectedCallback(){E3e(this),Ii.disconnectedCallback&&s&&s.call(this)},__attachShadow(){QN?Ii.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,b3e(e,i)},C3e=e=>{const t=new URL(e,aa.$resourcesUrl$);return t.origin!==vE.location.origin?t.href:t.pathname},A3e=e=>aa.$resourcesUrl$=e,M3e=(e,t)=>t,Gde=new WeakMap,wE=e=>Gde.get(e),O3e=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Ii.isDev&&(i.$renderCount$=0),Ii.method&&Ii.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Ii.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),$de(e,i,t.$listeners$),Gde.set(e,i)},CK=(e,t)=>t in e,l3=(e,t)=>(0,console.error)(e,t),jde=Ii.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],R3e=(...e)=>console.error(...jde,...e),Hde=(...e)=>console.warn(...jde,...e),eF=new Map,P3e=[],AK=[],qde=[],I3e=(e,t)=>i=>{e.push(i),t9||(t9=!0,t&&aa.$flags$&4?$3e(i9):aa.raf(i9))},MK=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){l3(i)}e.length=0},i9=()=>{MK(AK),MK(qde),(t9=AK.length>0)&&aa.raf(i9)},$3e=e=>qRe().then(e),D3e=I3e(qde,!0),Wde={isDev:!!Ii.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ii.isTesting};let Xde;function L3e(){A3e(_u(Ni(Xde)))}Xde="components/assets";const Yde=Symbol("widget"),N3e=[],F3e={},tF=new WeakMap;function Zde(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=Zde(e,i[s]);else i=N3e;const r=t.vnodeSelector;if(fW(r)){const s=t.properties||F3e,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:U3e,afterUpdate:k3e,afterRemoved:Qde,parentWidget:e,widgetConstructor:r,widgetProperties:ye(F({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function U3e(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,tF.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(Vh(()=>Qde(e)))}function k3e(e,t,i,{widgetProperties:r}){var n;const s=tF.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function Qde(e){const t=tF.get(e);t&&(t.destroy(),tF.delete(e))}function fW(e){return typeof e=="function"&&e[Yde]}const OK=new Set;function z3e(e){OK.add(e),e.finally(()=>OK.delete(e))}const Jde="esri.widgets.Widget",V3e=de.getLogger(Jde);let B3e=0;const G3e={widgetIcon:"esri-icon-checkbox-unchecked"};function Kde(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?Kde(e[i],t[i]):e[i]=t[i]);return e}const j3e=jRe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(wde(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let xz=!1,Tn=class extends yE(Zr.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new si,this._projector=j3e,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=G3e.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=yhe(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Ba(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await vhe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=Kde(te(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&V3e.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),L3e();const i="esri-widget-uid-"+yOe(),r=this.render.bind(this);this._trackingTarget=new d5(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(fW(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),Zde(this,n)};this.render=()=>{if(xz)return s();let n=vRe(this);if(n)return n;this._trackingTarget.clear(),xz=!0;try{n=jg(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{xz=!1}return _Re(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),z3e(this._resourcesFetch)}normalizeCtorArgs(e,t){const i=F({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(L8)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(at(this._trackingTarget),at(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,bz(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return h5(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+B3e++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(bz(this),this._projector.scheduleRender())}classes(...e){return Tde.apply(this,e)}renderNow(){bz(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(ae(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&n5(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>o3(i,s,n=>{this.emit(s,n)})),"delegated-events")},Ft)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(L8),this.scheduleRender()};this._internalHandles.add([bAe(e),ae(()=>this.uiStrings,e),Cl(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Tn[Yde]=!0,u([d()],Tn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Tn.prototype,"container",null),u([Nt("container")],Tn.prototype,"castContainer",null),u([d({aliasOf:"container"})],Tn.prototype,"domNode",void 0),u([d()],Tn.prototype,"iconClass",void 0),u([d()],Tn.prototype,"id",null),u([d()],Tn.prototype,"label",void 0),u([d()],Tn.prototype,"renderable",null),u([d()],Tn.prototype,"uiStrings",void 0),u([d()],Tn.prototype,"viewModel",void 0),u([d()],Tn.prototype,"visible",void 0),u([d()],Tn.prototype,"key",void 0),u([d()],Tn.prototype,"children",void 0),u([d()],Tn.prototype,"afterCreate",void 0),u([d()],Tn.prototype,"afterUpdate",void 0),u([d()],Tn.prototype,"afterRemoved",void 0),Tn=u([P(Jde)],Tn);const ja=Tn;function iu(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:q3e(e[t])}}}function H3e(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function q3e(e){return function(t,...i){H3e(t)?MRe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function za(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}function W3e(e){return e.split(",").map(t=>t.trim())}function epe(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:W3e(e);i.push(...r)}}var X3e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},tpe=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?tpe(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=X3e(s)),t.push(s))}},Y3e=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return tpe(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function ce(e,t,...i){return typeof e!="function"||fW(e)?Y3e(e,t,...i):e(t,...i)}const ipe="calcite-theme-";function Z3e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function rpe(){return Z3e().startsWith("dark")}function Q3e(){return`${ipe}${rpe()?"dark":"light"}`}function J3e(e){K3e(e),e.classList.add(Q3e())}function K3e(e){Array.from(e.classList).forEach(t=>{t.startsWith(ipe)&&e.classList.remove(t)})}function spe(e){return e&&typeof e.render=="function"}function ePe(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}de.getLogger("esri.core.Clonable");const Ec=e=>{let t=class extends e{clone(){var l;const i=aCe(Nn(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Ye.USER&&p!==Ye.DEFAULTS&&p!==Ye.WEB_MAP&&p!==Ye.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:C8(m),m!=null&&y==null||(p===Ye.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Nn(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Ye.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let r9=class extends Ec(Ae){};r9=u([P("esri.core.Clonable")],r9);function R(){return[0,0,0]}function rs(e){return[e[0],e[1],e[2]]}function Ue(e,t,i){return[e,t,i]}function dl(e){const t=R(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function mW(e,t){return new Float64Array(e,t,3)}function npe(){return R()}function ope(){return Ue(1,1,1)}function ape(){return Ue(1,0,0)}function lpe(){return Ue(0,1,0)}function gW(){return Ue(0,0,1)}const No=npe(),Rf=ope(),tPe=ape(),iPe=lpe(),cpe=gW();Object.freeze(Object.defineProperty({__proto__:null,create:R,clone:rs,fromValues:Ue,fromArray:dl,createView:mW,zeros:npe,ones:ope,unitX:ape,unitY:lpe,unitZ:gW,ZEROS:No,ONES:Rf,UNIT_X:tPe,UNIT_Y:iPe,UNIT_Z:cpe},Symbol.toStringTag,{value:"Module"}));const Ct=1e-6,Yd=Math.random,rPe=Math.PI/180,sPe=180/Math.PI;function c3(e){return e*rPe}function nPe(e){return e*sPe}function oPe(e,t){return Math.abs(e-t)<=Ct*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Ct,RANDOM:Yd,toRadian:c3,toDegree:nPe,equals:oPe},Symbol.toStringTag,{value:"Module"}));function Re(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function ne(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ie(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function pe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function fe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function v5(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function iF(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function aPe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function lPe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function s9(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function upe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function hpe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function cPe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function uPe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function oe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Mb(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function ur(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function _n(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Fa(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function oa(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function hPe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Se(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lt(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function on(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function dPe(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function pPe(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function fPe(e,t){t=t||1;const i=2*Yd()*Math.PI,r=2*Yd()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function ke(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function Oo(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Eu(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,v=r*p-s*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,y*=2,v*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+v,e}function mPe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function gPe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function yPe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function vPe(e,t){ne(OP,e),ne(RP,t),we(OP,OP),we(RP,RP);const i=Se(OP,RP);return i>1?0:i<-1?Math.PI:Math.acos(i)}const OP=R(),RP=R();function _Pe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function ka(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function hw(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Ct*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Ct*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Ct*Math.max(1,Math.abs(s),Math.abs(a))}function ny(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const bc=fe,bPe=v5,wPe=iF,yW=ur,vW=_n,_W=Re,n9=Fa,RK=Object.freeze(Object.defineProperty({__proto__:null,length:Re,copy:ne,set:ie,add:pe,subtract:fe,multiply:v5,divide:iF,ceil:aPe,floor:lPe,abs:s9,sign:upe,min:hpe,max:cPe,round:uPe,scale:oe,scaleAndAdd:Mb,distance:ur,squaredDistance:_n,squaredLength:Fa,negate:oa,inverse:hPe,normalize:we,dot:Se,cross:lt,lerp:on,hermite:dPe,bezier:pPe,random:fPe,transformMat4:ke,transformMat3:Oo,transformQuat:Eu,rotateX:mPe,rotateY:gPe,rotateZ:yPe,angle:vPe,str:_Pe,exactEquals:ka,equals:hw,direction:ny,sub:bc,mul:bPe,div:wPe,dist:yW,sqrDist:vW,len:_W,sqrLen:n9},Symbol.toStringTag,{value:"Module"}));function Zd(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ji(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function bW(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function dpe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function ppe(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function fpe(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function xPe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function TPe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function SPe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function EPe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function CPe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function u3(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function APe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function mpe(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function rF(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function wW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function xW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function MPe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function OPe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function gpe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function ype(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function _5(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function RPe(e,t){let i,r,s,n,o,a;t=t||1;do i=2*Yd()-1,r=2*Yd()-1,o=i*i+r*r;while(o>=1);do s=2*Yd()-1,n=2*Yd()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function bu(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function PPe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function IPe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function LO(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vpe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ct*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ct*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ct*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ct*Math.max(1,Math.abs(n),Math.abs(c))}const $Pe=dpe,DPe=ppe,LPe=fpe,NPe=mpe,FPe=rF,UPe=wW,kPe=xW,_pe=Object.freeze(Object.defineProperty({__proto__:null,copy:Zd,set:Ji,add:bW,subtract:dpe,multiply:ppe,divide:fpe,ceil:xPe,floor:TPe,min:SPe,max:EPe,round:CPe,scale:u3,scaleAndAdd:APe,distance:mpe,squaredDistance:rF,length:wW,squaredLength:xW,negate:MPe,inverse:OPe,normalize:gpe,dot:ype,lerp:_5,random:RPe,transformMat4:bu,transformQuat:PPe,str:IPe,exactEquals:LO,equals:vpe,sub:$Pe,mul:DPe,div:LPe,dist:NPe,sqrDist:FPe,len:UPe,sqrLen:kPe},Symbol.toStringTag,{value:"Module"})),PK=new Float32Array(1);function m2(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Ne(e,t,i){return Math.min(Math.max(e,t),i)}function g2(e){return(e&e-1)==0}function Vbt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Bbt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Zt(e,t,i){return e+(t-e)*i}function Pt(e){return e*Math.PI/180}function Al(e){return 180*e/Math.PI}function o9(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function an(e){return Math.acos(Ne(e,-1,1))}function dp(e){return Math.asin(Ne(e,-1,1))}function zPe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function VS(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function VPe(e){return bpe(Math.max(-a9,Math.min(e,a9)))}function bpe(e){return PK[0]=e,PK[0]}function y2(e,t,i){const r=Ne((i-e)/(t-e),0,1);return r*r*(3-2*r)}function IK(e,t){const i=Re(e),r=dp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return ie(t,i,r,s),t}function Gbt(e,t,i){return Ji(e,t[0],t[1],t[2],t[3]*i)}function jbt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(VS(t,1)&&VS(i,1)&&VS(r,1))}const a9=bpe(34028234663852886e22);class Vv{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return Ne(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function TW(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const BPe=TW(new Vv(0,2*Math.PI)),Bv=TW(new Vv(-Math.PI,Math.PI)),SW=TW(new Vv(0,360));class EW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new EW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,te(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:Ye.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===Ye.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new GPe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===Ye.DEFAULTS?t:Ye.USER}}class GPe{constructor(t,i){this.value=t,this.origin=i}}function wpe(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),Ye.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),Ye.DEFAULTS)})}function jPe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&PJ(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&PJ(s,i))return!0;return!1}function HPe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function qPe(e,t,i,r,s){let n=I8(t[i],s);HPe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=I8(t[o],s),jPe(n,i,r)&&(e[o]=!0)}function WPe(e,t,i,r){const s=i.metadatas,n=Hq(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const xpe={origin:"service"};function Tpe(e,t,i=xpe){if(!t||typeof t!="object")return;const r=Nn(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))qPe(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=I8(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?s3(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||WPe(e,o,r,i)}r.setDefaultOrigin("user")}function XPe(e,t,i,r=xpe){var n;const s=ye(F({},r),{messages:[]});i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const YPe=de.getLogger("esri.core.accessorSupport.write");function ZPe(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function Spe(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new q("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&YPe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===Ye.DEFAULTS)&&QPe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<Dh(n.origin))}function QPe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return Uv(o,s)}return!1}return n===s}function JPe(e,t,i,r){const s=Nn(e),n=s.metadatas,o=ahe(n[t],r);return!!o&&Spe(e,s,t,o,i,r)}function Epe(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return AD(t,e.toJSON(i));const r=Nn(e),s=r.metadatas;for(const a in s){const l=ahe(s[a],i);if(!Spe(e,r,a,l,void 0,i))continue;const c=e.get(a),h=ZPe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=AD(t,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&Promise.all(i.resources.pendingOperations).then(()=>AD(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:DMe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const h3=e=>{let t=class extends e{constructor(...i){super(...i);const r=Nn(this),s=r.store,n=new EW;r.store=n,wpe(r,s,n)}read(i,r){Tpe(this,i,r)}write(i={},r){return Epe(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return KPe.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function KPe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let xe=class extends h3(Ae){};xe=u([P("esri.core.JSONSupport")],xe);var Rh;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Rh||(Rh={}));let g;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)N[g]=0;for(g=2056;g<=2065;g++)N[g]=0;for(g=2067;g<=2135;g++)N[g]=0;for(g=2137;g<=2154;g++)N[g]=0;for(g=2161;g<=2170;g++)N[g]=0;for(g=2172;g<=2193;g++)N[g]=0;for(g=2195;g<=2198;g++)N[g]=0;for(g=2200;g<=2203;g++)N[g]=0;for(g=2205;g<=2217;g++)N[g]=0;for(g=2222;g<=2224;g++)N[g]=1;for(g=2225;g<=2250;g++)N[g]=2;for(g=2251;g<=2253;g++)N[g]=1;for(g=2257;g<=2264;g++)N[g]=2;for(g=2274;g<=2279;g++)N[g]=2;for(g=2280;g<=2282;g++)N[g]=1;for(g=2283;g<=2289;g++)N[g]=2;for(g=2290;g<=2292;g++)N[g]=0;for(g=2308;g<=2313;g++)N[g]=0;for(g=2315;g<=2491;g++)N[g]=0;for(g=2494;g<=2866;g++)N[g]=0;for(g=2867;g<=2869;g++)N[g]=1;for(g=2870;g<=2888;g++)N[g]=2;for(g=2891;g<=2895;g++)N[g]=2;for(g=2896;g<=2898;g++)N[g]=1;for(g=2902;g<=2908;g++)N[g]=2;for(g=2915;g<=2920;g++)N[g]=2;for(g=2921;g<=2923;g++)N[g]=1;for(g=2924;g<=2930;g++)N[g]=2;for(g=2931;g<=2962;g++)N[g]=0;for(g=2964;g<=2968;g++)N[g]=2;for(g=2969;g<=2973;g++)N[g]=0;for(g=2975;g<=2991;g++)N[g]=0;for(g=2995;g<=3051;g++)N[g]=0;for(g=3054;g<=3079;g++)N[g]=0;for(g=3081;g<=3088;g++)N[g]=0;for(g=3092;g<=3101;g++)N[g]=0;for(g=3106;g<=3138;g++)N[g]=0;for(g=3146;g<=3151;g++)N[g]=0;for(g=3153;g<=3166;g++)N[g]=0;for(g=3168;g<=3172;g++)N[g]=0;for(g=3174;g<=3203;g++)N[g]=0;for(g=3294;g<=3358;g++)N[g]=0;for(g=3367;g<=3403;g++)N[g]=0;for(g=3408;g<=3416;g++)N[g]=0;for(g=3417;g<=3438;g++)N[g]=2;for(g=3441;g<=3446;g++)N[g]=2;for(g=3447;g<=3450;g++)N[g]=0;for(g=3451;g<=3459;g++)N[g]=2;for(g=3460;g<=3478;g++)N[g]=0;for(g=3554;g<=3559;g++)N[g]=0;for(g=3560;g<=3570;g++)N[g]=2;for(g=3571;g<=3581;g++)N[g]=0;for(g=3594;g<=3597;g++)N[g]=0;for(g=3601;g<=3604;g++)N[g]=0;for(g=3637;g<=3639;g++)N[g]=0;for(g=3665;g<=3667;g++)N[g]=0;for(g=3693;g<=3695;g++)N[g]=0;for(g=3701;g<=3727;g++)N[g]=0;for(g=3728;g<=3739;g++)N[g]=2;for(g=3740;g<=3751;g++)N[g]=0;for(g=3753;g<=3760;g++)N[g]=2;for(g=3761;g<=3773;g++)N[g]=0;for(g=3775;g<=3777;g++)N[g]=0;for(g=3779;g<=3781;g++)N[g]=0;for(g=3783;g<=3785;g++)N[g]=0;for(g=3788;g<=3791;g++)N[g]=0;for(g=3797;g<=3802;g++)N[g]=0;for(g=3814;g<=3816;g++)N[g]=0;for(g=3825;g<=3829;g++)N[g]=0;for(g=3832;g<=3841;g++)N[g]=0;for(g=3844;g<=3852;g++)N[g]=0;for(g=3873;g<=3885;g++)N[g]=0;for(g=3890;g<=3893;g++)N[g]=0;for(g=3907;g<=3912;g++)N[g]=0;for(g=3942;g<=3950;g++)N[g]=0;for(g=3968;g<=3970;g++)N[g]=0;for(g=3973;g<=3976;g++)N[g]=0;for(g=3986;g<=3989;g++)N[g]=0;for(g=3994;g<=3997;g++)N[g]=0;for(g=4048;g<=4051;g++)N[g]=0;for(g=4056;g<=4063;g++)N[g]=0;for(g=4093;g<=4096;g++)N[g]=0;for(g=4390;g<=4398;g++)N[g]=0;for(g=4399;g<=4413;g++)N[g]=2;for(g=4418;g<=4433;g++)N[g]=2;for(g=4455;g<=4457;g++)N[g]=2;for(g=4484;g<=4489;g++)N[g]=0;for(g=4491;g<=4554;g++)N[g]=0;for(g=4568;g<=4589;g++)N[g]=0;for(g=4652;g<=4656;g++)N[g]=0;for(g=4766;g<=4800;g++)N[g]=0;for(g=5014;g<=5016;g++)N[g]=0;for(g=5069;g<=5072;g++)N[g]=0;for(g=5105;g<=5130;g++)N[g]=0;for(g=5173;g<=5188;g++)N[g]=0;for(g=5253;g<=5259;g++)N[g]=0;for(g=5269;g<=5275;g++)N[g]=0;for(g=5292;g<=5311;g++)N[g]=0;for(g=5329;g<=5331;g++)N[g]=0;for(g=5343;g<=5349;g++)N[g]=0;for(g=5355;g<=5357;g++)N[g]=0;for(g=5387;g<=5389;g++)N[g]=0;for(g=5459;g<=5463;g++)N[g]=0;for(g=5479;g<=5482;g++)N[g]=0;for(g=5518;g<=5520;g++)N[g]=0;for(g=5530;g<=5539;g++)N[g]=0;for(g=5550;g<=5552;g++)N[g]=0;for(g=5562;g<=5583;g++)N[g]=0;for(g=5623;g<=5625;g++)N[g]=2;for(g=5631;g<=5639;g++)N[g]=0;for(g=5649;g<=5653;g++)N[g]=0;for(g=5663;g<=5680;g++)N[g]=0;for(g=5682;g<=5685;g++)N[g]=0;for(g=5875;g<=5877;g++)N[g]=0;for(g=5896;g<=5899;g++)N[g]=0;for(g=5921;g<=5940;g++)N[g]=0;for(g=6050;g<=6125;g++)N[g]=0;for(g=6244;g<=6275;g++)N[g]=0;for(g=6328;g<=6348;g++)N[g]=0;for(g=6350;g<=6356;g++)N[g]=0;for(g=6366;g<=6372;g++)N[g]=0;for(g=6381;g<=6387;g++)N[g]=0;for(g=6393;g<=6404;g++)N[g]=0;for(g=6480;g<=6483;g++)N[g]=0;for(g=6511;g<=6514;g++)N[g]=0;for(g=6579;g<=6581;g++)N[g]=0;for(g=6619;g<=6624;g++)N[g]=0;for(g=6625;g<=6627;g++)N[g]=2;for(g=6628;g<=6632;g++)N[g]=0;for(g=6634;g<=6637;g++)N[g]=0;for(g=6669;g<=6692;g++)N[g]=0;for(g=6707;g<=6709;g++)N[g]=0;for(g=6720;g<=6723;g++)N[g]=0;for(g=6732;g<=6738;g++)N[g]=0;for(g=6931;g<=6933;g++)N[g]=0;for(g=6956;g<=6959;g++)N[g]=0;for(g=7005;g<=7007;g++)N[g]=0;for(g=7057;g<=7070;g++)N[g]=2;for(g=7074;g<=7082;g++)N[g]=0;for(g=7109;g<=7118;g++)N[g]=0;for(g=7119;g<=7127;g++)N[g]=1;for(g=7374;g<=7376;g++)N[g]=0;for(g=7528;g<=7586;g++)N[g]=0;for(g=7587;g<=7645;g++)N[g]=2;for(g=7692;g<=7696;g++)N[g]=0;for(g=7755;g<=7787;g++)N[g]=0;for(g=7791;g<=7795;g++)N[g]=0;for(g=7799;g<=7801;g++)N[g]=0;for(g=7803;g<=7805;g++)N[g]=0;for(g=7825;g<=7831;g++)N[g]=0;for(g=7845;g<=7859;g++)N[g]=0;for(g=8013;g<=8032;g++)N[g]=0;for(g=8065;g<=8068;g++)N[g]=1;for(g=8518;g<=8529;g++)N[g]=2;for(g=8533;g<=8536;g++)N[g]=2;for(g=8538;g<=8540;g++)N[g]=2;for(g=8677;g<=8679;g++)N[g]=0;for(g=8836;g<=8840;g++)N[g]=0;for(g=8857;g<=8859;g++)N[g]=0;for(g=8908;g<=8910;g++)N[g]=0;for(g=9154;g<=9159;g++)N[g]=0;for(g=9205;g<=9218;g++)N[g]=0;for(g=9271;g<=9273;g++)N[g]=0;for(g=9295;g<=9297;g++)N[g]=0;for(g=9356;g<=9360;g++)N[g]=0;for(g=9404;g<=9407;g++)N[g]=0;for(g=9476;g<=9482;g++)N[g]=0;for(g=9487;g<=9494;g++)N[g]=0;for(g=9697;g<=9699;g++)N[g]=0;for(g=20002;g<=20032;g++)N[g]=0;for(g=20062;g<=20092;g++)N[g]=0;for(g=20135;g<=20138;g++)N[g]=0;for(g=20248;g<=20258;g++)N[g]=0;for(g=20348;g<=20358;g++)N[g]=0;for(g=20436;g<=20440;g++)N[g]=0;for(g=20822;g<=20824;g++)N[g]=0;for(g=20904;g<=20932;g++)N[g]=0;for(g=20934;g<=20936;g++)N[g]=0;for(g=21004;g<=21032;g++)N[g]=0;for(g=21035;g<=21037;g++)N[g]=0;for(g=21095;g<=21097;g++)N[g]=0;for(g=21148;g<=21150;g++)N[g]=0;for(g=21207;g<=21264;g++)N[g]=0;for(g=21307;g<=21364;g++)N[g]=0;for(g=21413;g<=21423;g++)N[g]=0;for(g=21453;g<=21463;g++)N[g]=0;for(g=21473;g<=21483;g++)N[g]=0;for(g=21780;g<=21782;g++)N[g]=0;for(g=21891;g<=21894;g++)N[g]=0;for(g=21896;g<=21899;g++)N[g]=0;for(g=22171;g<=22177;g++)N[g]=0;for(g=22181;g<=22187;g++)N[g]=0;for(g=22191;g<=22197;g++)N[g]=0;for(g=22234;g<=22236;g++)N[g]=0;for(g=22521;g<=22525;g++)N[g]=0;for(g=22991;g<=22994;g++)N[g]=0;for(g=23028;g<=23038;g++)N[g]=0;for(g=23830;g<=23853;g++)N[g]=0;for(g=23866;g<=23872;g++)N[g]=0;for(g=23877;g<=23884;g++)N[g]=0;for(g=23886;g<=23894;g++)N[g]=0;for(g=23946;g<=23948;g++)N[g]=0;for(g=24311;g<=24313;g++)N[g]=0;for(g=24342;g<=24347;g++)N[g]=0;for(g=24370;g<=24374;g++)N[g]=10;for(g=24375;g<=24381;g++)N[g]=0;for(g=24718;g<=24721;g++)N[g]=0;for(g=24817;g<=24821;g++)N[g]=0;for(g=24877;g<=24882;g++)N[g]=0;for(g=24891;g<=24893;g++)N[g]=0;for(g=25391;g<=25395;g++)N[g]=0;for(g=25828;g<=25838;g++)N[g]=0;for(g=26191;g<=26195;g++)N[g]=0;for(g=26391;g<=26393;g++)N[g]=0;for(g=26701;g<=26722;g++)N[g]=0;for(g=26729;g<=26799;g++)N[g]=2;for(g=26801;g<=26803;g++)N[g]=2;for(g=26811;g<=26813;g++)N[g]=2;for(g=26847;g<=26870;g++)N[g]=2;for(g=26891;g<=26899;g++)N[g]=0;for(g=26901;g<=26923;g++)N[g]=0;for(g=26929;g<=26946;g++)N[g]=0;for(g=26948;g<=26998;g++)N[g]=0;for(g=27037;g<=27040;g++)N[g]=0;for(g=27205;g<=27232;g++)N[g]=0;for(g=27258;g<=27260;g++)N[g]=0;for(g=27391;g<=27398;g++)N[g]=0;for(g=27561;g<=27564;g++)N[g]=0;for(g=27571;g<=27574;g++)N[g]=0;for(g=27581;g<=27584;g++)N[g]=0;for(g=27591;g<=27594;g++)N[g]=0;for(g=28191;g<=28193;g++)N[g]=0;for(g=28348;g<=28358;g++)N[g]=0;for(g=28402;g<=28432;g++)N[g]=0;for(g=28462;g<=28492;g++)N[g]=0;for(g=29118;g<=29122;g++)N[g]=0;for(g=29168;g<=29172;g++)N[g]=0;for(g=29177;g<=29185;g++)N[g]=0;for(g=29187;g<=29195;g++)N[g]=0;for(g=29900;g<=29903;g++)N[g]=0;for(g=30161;g<=30179;g++)N[g]=0;for(g=30491;g<=30494;g++)N[g]=0;for(g=30729;g<=30732;g++)N[g]=0;for(g=31251;g<=31259;g++)N[g]=0;for(g=31265;g<=31268;g++)N[g]=0;for(g=31275;g<=31279;g++)N[g]=0;for(g=31281;g<=31297;g++)N[g]=0;for(g=31461;g<=31469;g++)N[g]=0;for(g=31491;g<=31495;g++)N[g]=0;for(g=31917;g<=31922;g++)N[g]=0;for(g=31965;g<=32e3;g++)N[g]=0;for(g=32001;g<=32003;g++)N[g]=2;for(g=32005;g<=32031;g++)N[g]=2;for(g=32033;g<=32060;g++)N[g]=2;for(g=32064;g<=32067;g++)N[g]=2;for(g=32074;g<=32077;g++)N[g]=2;for(g=32081;g<=32086;g++)N[g]=0;for(g=32107;g<=32130;g++)N[g]=0;for(g=32133;g<=32158;g++)N[g]=0;for(g=32164;g<=32167;g++)N[g]=2;for(g=32180;g<=32199;g++)N[g]=0;for(g=32201;g<=32260;g++)N[g]=0;for(g=32301;g<=32360;g++)N[g]=0;for(g=32601;g<=32662;g++)N[g]=0;for(g=32664;g<=32667;g++)N[g]=2;for(g=32701;g<=32761;g++)N[g]=0;for(g=53001;g<=53004;g++)N[g]=0;for(g=53008;g<=53019;g++)N[g]=0;for(g=53021;g<=53032;g++)N[g]=0;for(g=53034;g<=53037;g++)N[g]=0;for(g=53042;g<=53046;g++)N[g]=0;for(g=53074;g<=53080;g++)N[g]=0;for(g=54001;g<=54004;g++)N[g]=0;for(g=54008;g<=54019;g++)N[g]=0;for(g=54021;g<=54032;g++)N[g]=0;for(g=54034;g<=54037;g++)N[g]=0;for(g=54042;g<=54046;g++)N[g]=0;for(g=54048;g<=54053;g++)N[g]=0;for(g=54074;g<=54080;g++)N[g]=0;for(g=54098;g<=54101;g++)N[g]=0;for(g=102001;g<=102040;g++)N[g]=0;for(g=102042;g<=102063;g++)N[g]=0;for(g=102065;g<=102067;g++)N[g]=0;for(g=102070;g<=102117;g++)N[g]=0;for(g=102122;g<=102216;g++)N[g]=0;for(g=102221;g<=102377;g++)N[g]=0;for(g=102382;g<=102388;g++)N[g]=0;for(g=102389;g<=102398;g++)N[g]=2;for(g=102399;g<=102444;g++)N[g]=0;for(g=102445;g<=102447;g++)N[g]=2;for(g=102448;g<=102458;g++)N[g]=0;for(g=102459;g<=102468;g++)N[g]=2;for(g=102469;g<=102499;g++)N[g]=0;for(g=102500;g<=102519;g++)N[g]=1;for(g=102520;g<=102524;g++)N[g]=0;for(g=102525;g<=102529;g++)N[g]=2;for(g=102530;g<=102588;g++)N[g]=0;for(g=102590;g<=102598;g++)N[g]=0;for(g=102601;g<=102603;g++)N[g]=0;for(g=102605;g<=102628;g++)N[g]=0;for(g=102629;g<=102646;g++)N[g]=2;for(g=102648;g<=102700;g++)N[g]=2;for(g=102701;g<=102703;g++)N[g]=0;for(g=102707;g<=102730;g++)N[g]=2;for(g=102733;g<=102758;g++)N[g]=2;for(g=102767;g<=102900;g++)N[g]=0;for(g=102901;g<=102933;g++)N[g]=2;for(g=102934;g<=102950;g++)N[g]=13;for(g=102951;g<=102955;g++)N[g]=0;for(g=102961;g<=102963;g++)N[g]=0;for(g=102965;g<=102969;g++)N[g]=0;for(g=102971;g<=102973;g++)N[g]=0;for(g=102975;g<=102989;g++)N[g]=0;for(g=102990;g<=102992;g++)N[g]=1;for(g=102997;g<=103002;g++)N[g]=0;for(g=103003;g<=103008;g++)N[g]=2;for(g=103009;g<=103011;g++)N[g]=0;for(g=103012;g<=103014;g++)N[g]=2;for(g=103019;g<=103021;g++)N[g]=0;for(g=103022;g<=103024;g++)N[g]=2;for(g=103029;g<=103031;g++)N[g]=0;for(g=103032;g<=103034;g++)N[g]=2;for(g=103065;g<=103068;g++)N[g]=0;for(g=103074;g<=103076;g++)N[g]=0;for(g=103077;g<=103079;g++)N[g]=1;for(g=103080;g<=103082;g++)N[g]=0;for(g=103083;g<=103085;g++)N[g]=2;for(g=103090;g<=103093;g++)N[g]=0;for(g=103097;g<=103099;g++)N[g]=0;for(g=103100;g<=103102;g++)N[g]=2;for(g=103107;g<=103109;g++)N[g]=0;for(g=103110;g<=103112;g++)N[g]=2;for(g=103113;g<=103116;g++)N[g]=0;for(g=103117;g<=103120;g++)N[g]=2;for(g=103153;g<=103157;g++)N[g]=0;for(g=103158;g<=103162;g++)N[g]=2;for(g=103163;g<=103165;g++)N[g]=0;for(g=103166;g<=103168;g++)N[g]=1;for(g=103169;g<=103171;g++)N[g]=2;for(g=103186;g<=103188;g++)N[g]=0;for(g=103189;g<=103191;g++)N[g]=2;for(g=103192;g<=103195;g++)N[g]=0;for(g=103196;g<=103199;g++)N[g]=2;for(g=103200;g<=103224;g++)N[g]=0;for(g=103225;g<=103227;g++)N[g]=1;for(g=103232;g<=103237;g++)N[g]=0;for(g=103238;g<=103243;g++)N[g]=2;for(g=103244;g<=103246;g++)N[g]=0;for(g=103247;g<=103249;g++)N[g]=2;for(g=103254;g<=103256;g++)N[g]=0;for(g=103257;g<=103259;g++)N[g]=2;for(g=103264;g<=103266;g++)N[g]=0;for(g=103267;g<=103269;g++)N[g]=2;for(g=103300;g<=103375;g++)N[g]=0;for(g=103381;g<=103383;g++)N[g]=0;for(g=103384;g<=103386;g++)N[g]=1;for(g=103387;g<=103389;g++)N[g]=0;for(g=103390;g<=103392;g++)N[g]=2;for(g=103397;g<=103399;g++)N[g]=0;for(g=103400;g<=103471;g++)N[g]=2;for(g=103476;g<=103478;g++)N[g]=0;for(g=103479;g<=103481;g++)N[g]=2;for(g=103486;g<=103488;g++)N[g]=0;for(g=103489;g<=103491;g++)N[g]=2;for(g=103492;g<=103495;g++)N[g]=0;for(g=103496;g<=103499;g++)N[g]=2;for(g=103528;g<=103543;g++)N[g]=0;for(g=103544;g<=103548;g++)N[g]=2;for(g=103549;g<=103551;g++)N[g]=0;for(g=103552;g<=103554;g++)N[g]=1;for(g=103555;g<=103557;g++)N[g]=2;for(g=103558;g<=103560;g++)N[g]=0;for(g=103571;g<=103573;g++)N[g]=0;for(g=103574;g<=103576;g++)N[g]=2;for(g=103577;g<=103580;g++)N[g]=0;for(g=103581;g<=103583;g++)N[g]=2;for(g=103595;g<=103694;g++)N[g]=0;for(g=103696;g<=103699;g++)N[g]=0;for(g=103700;g<=103793;g++)N[g]=2;for(g=103794;g<=103887;g++)N[g]=0;for(g=103900;g<=103971;g++)N[g]=2;const eIe={102113:!0,102100:!0,3857:!0,3785:!0},tIe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},$K='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',PP=[-20037508342788905e-9,20037508342788905e-9],IP=[-20037508342787e-6,20037508342787e-6],Cpe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PP,origin:IP,dx:1e-5},102100:{wkTemplate:$K,valid:PP,origin:IP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:PP,origin:IP,dx:1e-5},3857:{wkTemplate:$K,valid:PP,origin:IP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Cc(e,t){return!M(e)&&!M(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Gv(e)&&Gv(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function Rg(e){return Ml(e)&&e.wkid&&Cpe[e.wkid]||null}function Ape(e){return!!Ml(e)&&(e.wkid?N[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function NO(e){return!(tm(e)||im(e))}function FO(e){return Ml(e)&&e.wkid===4326}function Mpe(e){return Ml(e)&&e.wkid===Rh.CGCS2000}function Gv(e){return Ml(e)&&e.wkid!=null&&eIe[e.wkid]===!0}function UO(e){return Ml(e)&&e.wkid===32662}function CW(e){return e===Rh.GCSMARS2000||e===Rh.GCSMARS2000_SPHERE}function tm(e){return Ml(e)&&e.wkid!=null&&CW(e.wkid)}function AW(e){return e===Rh.GCSMOON2000}function im(e){return Ml(e)&&e.wkid!=null&&AW(e.wkid)}function iIe(e){return Ml(e)&&e.wkid!=null&&tIe[e.wkid]===!0}function Ml(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const rIe={wkid:4326,wkt:zf(Cpe[4326].wkTemplate,{Central_Meridian:"0.0"})},sIe={wkid:102100,latestWkid:3857},nIe={wkid:32662};var jp;let Sr=jp=class extends xe{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return jp.WebMercator;if(e.wkid===4326)return jp.WGS84}const t=new jp;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return FO(this)}get isWebMercator(){return Gv(this)}get isGeographic(){return Ape(this)}get isWrappable(){return iIe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===jp.WGS84)return jp.WGS84;if(this===jp.WebMercator)return jp.WebMercator;const e=new jp;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=te(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return Cc(this,e)}toJSON(e){return this.write(void 0,e)}};Sr.GCS_NAD_1927=null,Sr.WGS84=null,Sr.WebMercator=null,Sr.PlateCarree=null,u([d({readOnly:!0})],Sr.prototype,"isWGS84",null),u([d({readOnly:!0})],Sr.prototype,"isWebMercator",null),u([d({readOnly:!0})],Sr.prototype,"isGeographic",null),u([d({readOnly:!0})],Sr.prototype,"isWrappable",null),u([d({type:wr,json:{write:!0}})],Sr.prototype,"latestWkid",void 0),u([d({type:wr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Sr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Sr.prototype,"wkt",void 0),u([He("wkt"),He("web-scene","wkt")],Sr.prototype,"writeWkt",null),u([d({type:wr,json:{write:!0}})],Sr.prototype,"vcsWkid",void 0),u([d({type:wr,json:{write:!0}})],Sr.prototype,"latestVcsWkid",void 0),u([d()],Sr.prototype,"imageCoordinateSystem",void 0),Sr=jp=u([P("esri.geometry.SpatialReference")],Sr),Sr.prototype.toJSON.isDefaultToJSON=!0,Sr.GCS_NAD_1927=new Sr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Sr.WGS84=new Sr(rIe),Sr.WebMercator=new Sr(sIe),Sr.PlateCarree=new Sr(nIe),Object.freeze&&(Object.freeze(Sr.GCS_NAD_1927),Object.freeze(Sr.WGS84),Object.freeze(Sr.WebMercator));const Ze=Sr;let Hp=class extends xe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ze.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ze)return e;if(e!=null){const i=new Ze;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],Hp.prototype,"type",void 0),u([d({readOnly:!0})],Hp.prototype,"cache",null),u([d({readOnly:!0})],Hp.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Hp.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Hp.prototype,"hasZ",void 0),u([d({type:Ze,json:{write:!0}})],Hp.prototype,"spatialReference",void 0),u([Ie("spatialReference")],Hp.prototype,"readSpatialReference",null),Hp=u([P("esri.geometry.Geometry")],Hp);const Ol=Hp;function oIe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function aIe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class MW{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const $i=new MW(6378137,1/298.257223563,3e5,.006694379990137799),$f=new MW(3396190,1/169.8944472236118,23e4),qg=new MW(1737400,0,0),lIe=57.29577951308232,cIe=.017453292519943;function DK(e){return e*lIe}function LK(e){return e*cIe}function NK(e){return e/$i.radius}function sF(e){return Math.PI/2-2*Math.atan(Math.exp(-e/$i.radius))}function l9(e){return e.wkid!=null||e.wkt!=null}const Tz=[0,0];function nF(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,Tz,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,Tz,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,Tz,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Ev(e,t){const i=e&&(l9(e)?e:e.spatialReference),r=t&&(l9(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!Cc(r,i)||Gv(r)&&FO(i)||Gv(i)&&FO(r))}function Yw(e,t){if(M(e))return null;const i=e.spatialReference,r=t&&(l9(t)?t:t.spatialReference);return Ev(i,r)?Cc(i,r)?te(e):Gv(r)?nF(e,hS,Ze.WebMercator,!1,te(e)):FO(r)?nF(e,UM,Ze.WGS84,!1,te(e)):null:null}function hS(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=LK(t);return i[0]=LK(e)*$i.radius,i[1]=$i.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function UM(e,t,i=[0,0],r=!1){const s=DK(e/$i.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=DK(Math.PI/2-2*Math.atan(Math.exp(-t/$i.radius))),i}function Pg(e,t=!1,i=te(e)){return nF(e,hS,Ze.WebMercator,t,i)}function gA(e,t=!1,i=te(e)){return nF(e,UM,Ze.WGS84,t,i)}var ND;const sC=[0,0];function FK(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const $P=de.getLogger("esri.geometry.Point");let tl=ND=class extends Ol{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ze(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)$P.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)$P.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=hS(n.longitude,n.latitude,sC);e=a[0],t=a[1]}}}else FK(i)?(s=i,i=null):FK(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?$P.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&$P.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return UM(t,i,sC)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",hS(i,e,sC)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return UM(e,t,sC)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",hS(e,t,sC)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new ND;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return ND.copy(e,this),this}equals(e){if(M(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=hS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=UM(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return oIe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=Rg(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return aIe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],tl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasZ",null),u([d({type:Number})],tl.prototype,"latitude",null),u([d({type:Number})],tl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Nt(e=>isNaN(e)?e:Sh(e))],tl.prototype,"x",void 0),u([He("x")],tl.prototype,"writeX",null),u([Ie("x")],tl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],tl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],tl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],tl.prototype,"m",void 0),tl=ND=u([P("esri.geometry.Point")],tl),tl.prototype.toJSON.isDefaultToJSON=!0;const qe=tl;let $m=class extends Ec(xe){constructor(...e){super(...e),this.position=new qe([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Sh(e.x||0),s.y=Sh(e.y||0),s.z=e.hasZ?Sh(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new qe;return i.read(e,t),i.x=Sh(i.x||0),i.y=Sh(i.y||0),i.z=i.hasZ?Sh(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:qe,json:{write:{isRequired:!0}}})],$m.prototype,"position",void 0),u([He("position")],$m.prototype,"writePosition",null),u([Ie("position")],$m.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Nt(e=>SW.normalize(Sh(e)))],$m.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Nt(e=>Ne(Sh(e),-180,180))],$m.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],$m.prototype,"fov",void 0),$m=u([P("esri.Camera")],$m);const wc=$m,Sz=[0,0];function OW(e,t){return!!_(t)&&Ra(e,t.x,t.y,t.z)}function Hbt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!v2(e,i))return!1;return!0}function uIe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Ra(e,i,r,s)&&Ra(e,i,o,s)&&Ra(e,n,o,s)&&Ra(e,n,r,s)&&Ra(e,i,r,a)&&Ra(e,i,o,a)&&Ra(e,n,o,a)&&Ra(e,n,r,a):Ra(e,i,r)&&Ra(e,i,o)&&Ra(e,n,o)&&Ra(e,n,r)}function v2(e,t){return Ra(e,t[0],t[1])}function hIe(e,t){return Ra(e,t[0],t[1],t[2])}function Ra(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function dIe(e,t){return Sz[1]=t.y,Sz[0]=t.x,pIe(e,Sz)}function pIe(e,t){return Ope(e.rings,t)}function Ope(e,t){if(!e)return!1;if(fIe(e))return UK(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=UK(i,e[r],t);return i}function fIe(e){return!Array.isArray(e[0][0])}function UK(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function mIe(e,t){return OW(e,t)}function gIe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function yIe(e,t){const{points:i,hasZ:r}=t,s=r?hIe:v2;for(const n of i)if(s(e,n))return!0;return!1}const dw=[0,0],pw=[0,0],fw=[0,0],mw=[0,0],vIe=[dw,pw,fw,mw],Rpe=[[fw,dw],[dw,pw],[pw,mw],[mw,fw]];function Ppe(e,t){return _Ie(e,t.rings)}function _Ie(e,t){dw[0]=e.xmin,dw[1]=e.ymax,pw[0]=e.xmax,pw[1]=e.ymax,fw[0]=e.xmin,fw[1]=e.ymin,mw[0]=e.xmax,mw[1]=e.ymin;for(const i of vIe)if(Ope(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(v2(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(v2(e,n)||Ipe(r,n,Rpe))return!0;r=n}}return!1}function bIe(e,t){dw[0]=e.xmin,dw[1]=e.ymax,pw[0]=e.xmax,pw[1]=e.ymax,fw[0]=e.xmin,fw[1]=e.ymin,mw[0]=e.xmax,mw[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(v2(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(v2(e,o)||Ipe(s,o,Rpe))return!0;s=o}}return!1}const mo=[0,0];function wIe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(c9(n,o,c,h,mo)&&!(mo[0]===n[0]&&mo[1]===n[1]||mo[0]===c[0]&&mo[1]===c[1]||mo[0]===o[0]&&mo[1]===o[1]||mo[0]===h[0]&&mo[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(c9(o,a,c,h,mo)&&!(mo[0]===o[0]&&mo[1]===o[1]||mo[0]===c[0]&&mo[1]===c[1]||mo[0]===a[0]&&mo[1]===a[1]||mo[0]===h[0]&&mo[1]===h[1]))return!0}}}return!1}function Ipe(e,t,i){for(let r=0;r<i.length;r++)if(c9(e,t,i[r][0],i[r][1]))return!0;return!1}function c9(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,y=n-c,v=a-n,b=f-h,w=o-h,S=l-o,T=b*v-m*S;if(T===0)return!1;const E=(m*w-b*y)/T,C=(v*w-S*y)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function xIe(e){switch(e){case"esriGeometryEnvelope":case"extent":return gIe;case"esriGeometryMultipoint":case"multipoint":return yIe;case"esriGeometryPoint":case"point":return mIe;case"esriGeometryPolygon":case"polygon":return Ppe;case"esriGeometryPolyline":case"polyline":return bIe}}var rh;function TIe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function xy(e,t,i){return t==null?i:i==null?t:e(t,i)}let Vn=rh=class extends Ol{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return TIe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ze.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?Ze.WGS84:s}}static fromBounds(e,t){return new rh({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new rh({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new qe({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new rh;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ev(t,i)&&(e=t.isWebMercator?Pg(e):gA(e,!0)),e.type==="point"?OW(this,e):e.type==="extent"&&uIe(this,e)}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ev(t,i)&&(e=t.isWebMercator?Pg(e):gA(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(M(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ev(t,i)&&(e=t.isWebMercator?Pg(e):gA(e,!0)),xIe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=xy(Math.min,this.zmin,e.zmin),this.zmax=xy(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=xy(Math.min,this.mmin,e.mmin),this.mmax=xy(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:M(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=xy(Math.max,this.zmin,e.zmin),this.zmax=xy(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=xy(Math.max,this.mmin,e.mmin),this.mmax=xy(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=Rg(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?gA(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new Ze(zf(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||Rg(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||Rg(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,b=h.frameId,w=m===v&&a>0;if(a>2*f){const S=new rh(l<c?m:v,s,f,n,o),T=new rh(p,s,l<c?v:m,n,o),E=new rh(0,s,f,n,o),C=new rh(p,s,0,n,o),A=[],I=[];S.contains(E)&&A.push(y),S.contains(C)&&I.push(y),T.contains(E)&&A.push(b),T.contains(C)&&I.push(b);for(let L=y+1;L<b;L++)A.push(L),I.push(L);t.push({extent:S,frameIds:[y]},{extent:T,frameIds:[b]},{extent:E,frameIds:A},{extent:C,frameIds:I})}else m>v||w?t.push({extent:new rh(m,s,f,n,o),frameIds:[y]},{extent:new rh(p,s,v,n,o),frameIds:[b]}):t.push({extent:new rh(m,s,v,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],Vn.prototype,"cache",null),u([d({readOnly:!0})],Vn.prototype,"center",null),u([d({readOnly:!0})],Vn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Vn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Vn.prototype,"hasZ",null),u([d({readOnly:!0})],Vn.prototype,"height",null),u([d({readOnly:!0})],Vn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Vn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Vn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Vn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Vn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Vn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Vn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Vn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Vn.prototype,"zmax",void 0),Vn=rh=u([P("esri.geometry.Extent")],Vn),Vn.prototype.toJSON.isDefaultToJSON=!0;const Xt=Vn;function _2(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var u9;function kK(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function SIe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let n0=u9=class extends Ol{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):SIe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Xt,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=kK(Math.min),a=kK(Math.max);let l,c,h,p,[f,m]=n,[y,v]=n;for(let b=0,w=e.length;b<w;b++){const S=e[b],[T,E]=S;if(f=o(f,T),m=o(m,E),y=a(y,T),v=a(v,E),i&&S.length>2){const C=S[2];l=o(l,C),h=a(h,C)}if(r&&S.length>s){const C=S[s];c=o(c,C),p=a(p,C)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=v,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=te(this.points)}addPoint(e){return _2(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:te(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new u9(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new qe(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new qe(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(_2(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],n0.prototype,"cache",null),u([d()],n0.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],n0.prototype,"points",void 0),u([He("points")],n0.prototype,"writePoints",null),n0=u9=u([P("esri.geometry.Multipoint")],n0),n0.prototype.toJSON.isDefaultToJSON=!0;const Zw=n0;function RW(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function $pe(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function EIe(e,t){return $pe(e,t,.5)}function Dpe(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=RW(e[r],e[r+1]);return i}function Lpe(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=RW(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return $pe(e[s],e[s+1],o)}r+=n}return e[i-1]}function PW(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function CIe(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function qbt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function AIe(e){return e?Npe(e.rings,e.hasZ):null}function Npe(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=MIe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?OIe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function MIe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[v,b,w]=m,S=v-l,T=b-c,E=t?w-h:void 0,[C,A,I]=y,L=C-l,D=A-c,k=t?I-h:void 0,z=S*D-L*T;if(o+=z,r+=(S+L)*z,s+=(T+D)*z,t&&m.length>2&&y.length>2){const V=S*k-L*E;n+=(E+k)*V,a+=V}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),b<i[2]&&(i[2]=b),b>i[3]&&(i[3]=b),t&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function OIe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=RW(i,r);if(f){s+=f;const m=EIe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function Fpe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Upe(e){return e.points!==void 0}function kpe(e){return e.x!==void 0&&e.y!==void 0}function zpe(e){return e.paths!==void 0}function Vpe(e){return e.rings!==void 0}function Bpe(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const av=Bpe(Math.min),lv=Bpe(Math.max);function RIe(e,t){return zpe(t)?b2(e,t.paths,!1,!1):Vpe(t)?b2(e,t.rings,!1,!1):Upe(t)?IW(e,t.points,!1,!1,!1,!1):Fpe(t)?Gpe(e,t):(kpe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Wbt(e,t){return zpe(t)?b2(e,t.paths,!0,!1):Vpe(t)?b2(e,t.rings,!0,!1):Upe(t)?IW(e,t.points,!0,!1,!0,!1):Fpe(t)?Gpe(e,t,!0,!1,!0,!1):(kpe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function b2(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let v=0;v<y.length;v++){const b=y[v],[w,S]=b;if(c=av(c,w),h=av(h,S),p=lv(p,w),f=lv(f,S),i&&b.length>2){const T=b[2];n=av(n,T),o=lv(o,T)}if(r&&b.length>s){const T=b[s];a=av(n,T),l=lv(o,T)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Gpe(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function IW(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[v,b]=t[0];for(let w=0;w<t.length;w++){const S=t[w],[T,E]=S;if(m=av(m,T),y=av(y,E),v=lv(v,T),b=lv(b,E),l&&S.length>2){const C=S[2];c=av(c,C),h=lv(h,C)}if(a&&S.length>o){const C=S[o];p=av(c,C),f=lv(h,C)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=v,e[5]=b,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=v,e[4]=b,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=v,e[4]=b,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=v,e[3]=b,e)}function PIe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function IIe(e){return e.points!==void 0}function $Ie(e){return e.x!==void 0&&e.y!==void 0}function DIe(e){return e.paths!==void 0}function LIe(e){return e.rings!==void 0}const $W=[];function jpe(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Hpe(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function qpe(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Wpe(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function DW(e,t=!1,i=!1){return t?i?Wpe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Hpe(e[0],e[1],e[2],e[3],e[4],e[5]):i?qpe(e[0],e[1],e[2],e[3],e[4],e[5]):jpe(e[0],e[1],e[2],e[3])}function Xbt(e){return e?PIe(e)?e:$Ie(e)?FIe(e):LIe(e)?Xpe(e):DIe(e)?Ype(e):IIe(e)?NIe(e):null:null}function NIe(e){const{hasZ:t,hasM:i,points:r}=e;return DW(IW($W,r,t,i),t,i)}function FIe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Wpe(t,i,r,s,t,i,r,s):Hpe(t,i,r,t,i,r):n?qpe(t,i,s,t,i,s):jpe(t,i,t,i)}function Xpe(e){const{hasZ:t,hasM:i,rings:r}=e,s=b2($W,r,t,i);return s?DW(s,t,i):null}function Ype(e){const{hasZ:t,hasM:i,paths:r}=e,s=b2($W,r,t,i);return s?DW(s,t,i):null}var FD;function zK(e){return!Array.isArray(e[0])}let qp=FD=class extends Ol{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new FD(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=AIe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new qe;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Xpe(this);if(!t)return null;const i=new Xt(t);return i.spatialReference=e,i}get isSelfIntersecting(){return wIe(this.rings)}writeRings(e,t){t.rings=te(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(zK(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new FD;return e.spatialReference=this.spatialReference,e.rings=te(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(M(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!Uv(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=Yw(e,this.spatialReference);return dIe(this,_(t)?t:e)}isClockwise(e){let t;return t=zK(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,PW(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new qe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new qe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new qe(i[0],i[1],i[2],i[3],this.spatialReference):new qe(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(_2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new qe(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new qe(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(_2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],qp.prototype,"cache",null),u([d({readOnly:!0})],qp.prototype,"centroid",null),u([d({readOnly:!0})],qp.prototype,"extent",null),u([d({readOnly:!0})],qp.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],qp.prototype,"rings",void 0),u([He("rings")],qp.prototype,"writeRings",null),qp=FD=u([P("esri.geometry.Polygon")],qp),qp.prototype.toJSON.isDefaultToJSON=!0;const la=qp;var h9;function UIe(e){return!Array.isArray(e[0])}let o0=h9=class extends Ol{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Ype(this);if(!t)return null;const i=new Xt(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=te(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(UIe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new h9;return e.spatialReference=this.spatialReference,e.paths=te(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new qe(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new qe(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new qe(i[0],i[1],i[2],i[3],this.spatialReference):new qe(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(_2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new qe(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new qe(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(_2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],o0.prototype,"cache",null),u([d({readOnly:!0})],o0.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],o0.prototype,"paths",void 0),u([He("paths")],o0.prototype,"writePaths",null),o0=h9=u([P("esri.geometry.Polyline")],o0),o0.prototype.toJSON.isDefaultToJSON=!0;const wu=o0,Zpe=da()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),VK=da()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function LW(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function b5(e){return e.points!==void 0}function w5(e){return e.x!==void 0&&e.y!==void 0}function d3(e){return e.paths!==void 0}function Cv(e){return e.rings!==void 0}function Wg(e){return M(e)?null:e instanceof Ol?e:w5(e)?qe.fromJSON(e):d3(e)?wu.fromJSON(e):Cv(e)?la.fromJSON(e):b5(e)?Zw.fromJSON(e):LW(e)?Xt.fromJSON(e):null}function xE(e){return e?w5(e)?"esriGeometryPoint":d3(e)?"esriGeometryPolyline":Cv(e)?"esriGeometryPolygon":LW(e)?"esriGeometryEnvelope":b5(e)?"esriGeometryMultipoint":null:null}const kIe={esriGeometryPoint:qe,esriGeometryPolyline:wu,esriGeometryPolygon:la,esriGeometryEnvelope:Xt,esriGeometryMultipoint:Zw};function Qpe(e){return e&&kIe[e]||null}const Qw={base:Ol,key:"type",typeMap:{extent:Xt,multipoint:Zw,point:qe,polyline:wu,polygon:la}};up(Qw);var w2;function zIe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return w2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return w2.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(w2||(w2={}));let Ez;function jf(){return Ez||(Ez=(async()=>{const e=await import("./arcadeUtils.0154e3c5.js").then(function(t){return t.t});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),Ez}const VIe=(e,t,i)=>p3.create(e,t,i,null,["$feature"]),BIe=(e,t,i)=>p3.create(e,t,i,null,["$feature","$view"]),GIe=(e,t,i,r)=>p3.create(e,t,i,r,["$feature","$view"]);class p3{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await jf(),h=Ze.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((C,A)=>ye(F({},C),{[A]:null}),{});let m=null;_(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(p)&&a.enableAsyncSupport(),w={vars:f,spatialReference:h,useAsync:!!b},S=new c;S.immutable=!1,S.setField("scale",0);const T=a.compileScript(p,w),E=C=>("$view"in C&&C.$view&&(S.setField("scale",C.$view.scale),C.$view=S),m&&(C.$config=m),T({vars:C,spatialReference:h}));return await Promise.all([y,v,b]),new p3(t,a,c,p,E,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const jIe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],HIe=["field","normalizationField"];function BK(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(GK(jIe,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)GK(HIe,r,t)}}function GK(e,t,i){if(e)for(const r of e){const s=pE(r,t),n=s&&typeof s!="function"&&i.get(s);n&&_c(r,n.name,t)}}function Jpe(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const Cz=new Set;function Kpe(e,t){return e&&t?(Cz.clear(),kO(Cz,e,t),Array.from(Cz).sort()):[]}function kO(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)Uh(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function Uh(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function Ybt(e,t){return M(t)||M(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function Rl(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await jf(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Uh(e,t,o)}async function efe(e,t,i){if(i&&i!=="1=1"){const r=(await import("./WhereClause.b4219540.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new q("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});kO(e,t,r.fieldNames)}}function qIe({displayField:e,fields:t}){return e||(t&&t.length?Az(t,"name-or-title")||Az(t,"unique-identifier")||Az(t,"type-or-category")||WIe(t):null)}function WIe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function Az(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function Zbt(e,t){if(!t)return;const i=pE("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function XIe(e,t,i){i.outStatistic.onStatisticValueExpression?Rl(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function Qbt(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if((s=i.popupTemplate)!=null&&s.expressionInfos&&r.push(...i.popupTemplate.expressionInfos.map(o=>Rl(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(Rl(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>XIe(e,t.fieldsIndex,o))),await Promise.all(r)}async function Jbt(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&kO(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&kO(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await efe(e,t.fieldsIndex,i.where))}async function Kbt(e,t,i){t&&i&&await Promise.all(i.map(r=>YIe(e,t,r)))}async function YIe(e,t,i){t&&i&&(i.valueExpression?await Rl(e,t.fieldsIndex,i.valueExpression):i.field&&Uh(e,t.fieldsIndex,i.field))}function ewt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Kpe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function twt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>ZIe(e,r,s)))}async function ZIe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Rl(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Uh(e,t,o.slice(1,-1))})}await efe(e,t,s)}function QIe(e){const t=e.defaultValue;return t!==void 0&&rfe(e,t)?t:e.nullable?null:void 0}function tfe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function JIe(e){return e===null||tfe(e)}const NW="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function KIe(e){return e===null||NW(e)}function ife(e){return e!=null&&typeof e=="string"}function e$e(e){return e===null||ife(e)}function t$e(){return!0}function rfe(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?KIe:NW;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?JIe:tfe;break;case"string":case"esriFieldTypeString":i=e.nullable?e$e:ife;break;default:i=t$e}return arguments.length===1?i:i(t)}const i$e=["integer","small-integer","single","double"],r$e=new Set([...i$e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function x5(e){return e!=null&&r$e.has(e.type)}function iwt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var oF,aF;function rwt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function swt(e,t){return e.nullable&&t===null?null:x5(e)&&!s$e(e.type,Number(t))?oF.OUT_OF_RANGE:rfe(e,t)?e.domain?zIe(e.domain,t):null:aF.INVALID_TYPE}function s$e(e,t){const i=typeof e=="string"?sfe(e):e;return!!i&&(i.isInteger?NW(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function sfe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return n$e;case"esriFieldTypeInteger":case"integer":return o$e;case"esriFieldTypeSingle":case"single":return a$e;case"esriFieldTypeDouble":case"double":return l$e}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(oF||(oF={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(aF||(aF={}));const n$e={min:-32768,max:32767,isInteger:!0},o$e={min:-2147483648,max:2147483647,isInteger:!0},a$e={min:-34e37,max:12e37,isInteger:!1},l$e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function nwt(e,t,i){switch(e){case w2.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case w2.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case aF.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case oF.OUT_OF_RANGE:{const{min:r,max:s}=sfe(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function c$e(e,t){return!u$e(e,t,null)}function u$e(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}function nfe(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let UD=class extends xe{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],UD.prototype,"type",void 0),UD=u([P("esri.popup.content.Content")],UD);const Jw=UD;var d9;let m1=d9=class extends Jw{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new d9({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],m1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],m1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],m1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],m1.prototype,"type",void 0),m1=d9=u([P("esri.popup.content.AttachmentsContent")],m1);const zO=m1;var p9;let g1=p9=class extends Jw{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new p9({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?te(this.outFields):null})}};u([d()],g1.prototype,"creator",void 0),u([d()],g1.prototype,"destroyer",void 0),u([d()],g1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],g1.prototype,"type",void 0),g1=p9=u([P("esri.popup.content.CustomContent")],g1);const h$e=g1;var f9;let wT=f9=class extends xe{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new f9({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],wT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],wT.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],wT.prototype,"returnType",void 0),wT=f9=u([P("esri.popup.ElementExpressionInfo")],wT);const ofe=wT;var m9;let yA=m9=class extends Jw{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new m9({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:ofe,json:{write:!0}})],yA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],yA.prototype,"type",void 0),yA=m9=u([P("esri.popup.content.ExpressionContent")],yA);const FW=yA,VO=da()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});VO.toJSON.bind(VO);VO.fromJSON.bind(VO);var g9;let y1=g9=class extends xe{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new g9({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Vf(e,F(F({},r5(this.dateFormat)),this.dateTimeFormatOptions)):Bf(e,dhe(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([mt(VO)],y1.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],y1.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],y1.prototype,"digitSeparator",void 0),u([d({type:wr,json:{write:!0}})],y1.prototype,"places",void 0),y1=g9=u([P("esri.popup.support.FieldInfoFormat")],y1);const dS=y1;var y9;let dd=y9=class extends xe{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new y9({fieldName:this.fieldName,format:this.format?te(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],dd.prototype,"fieldName",void 0),u([d({type:dS,json:{write:!0}})],dd.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],dd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],dd.prototype,"label",void 0),u([mt(new Mi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],dd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],dd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],dd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],dd.prototype,"visible",void 0),dd=y9=u([P("esri.popup.FieldInfo")],dd);const f3=dd;var v9;let Dm=v9=class extends Jw{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new v9(te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Dm.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Dm.prototype,"description",void 0),u([d({type:[f3]})],Dm.prototype,"fieldInfos",void 0),u([He("fieldInfos")],Dm.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Dm.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Dm.prototype,"type",void 0),Dm=v9=u([P("esri.popup.content.FieldsContent")],Dm);const x2=Dm;let v1=class extends xe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],v1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],v1.prototype,"type",void 0),v1=u([P("esri.popup.content.mixins.MediaInfo")],v1);const UW=v1;var _9;let xT=_9=class extends Ae{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new _9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],xT.prototype,"fieldName",void 0),u([d()],xT.prototype,"tooltip",void 0),u([d()],xT.prototype,"value",void 0),xT=_9=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],xT);const afe=xT;var b9;let _1=b9=class extends xe{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new b9({fields:te(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],_1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"normalizeField",void 0),u([d({type:[afe],json:{read:!1}})],_1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"tooltipField",void 0),_1=b9=u([P("esri.popup.content.support.ChartMediaInfoValue")],_1);const d$e=_1;let vA=class extends UW{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],vA.prototype,"type",void 0),u([d({type:d$e,json:{write:!0}})],vA.prototype,"value",void 0),vA=u([P("esri.popup.content.mixins.ChartMediaInfo")],vA);const T5=vA,S5=da()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var w9;let kD=w9=class extends T5{constructor(e){super(e),this.type="bar-chart"}clone(){return new w9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:S5.write}})],kD.prototype,"type",void 0),kD=w9=u([P("esri.popup.content.BarChartMediaInfo")],kD);const lfe=kD;var x9;let zD=x9=class extends T5{constructor(e){super(e),this.type="column-chart"}clone(){return new x9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:S5.write}})],zD.prototype,"type",void 0),zD=x9=u([P("esri.popup.content.ColumnChartMediaInfo")],zD);const cfe=zD;var T9;let _A=T9=class extends xe{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new T9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],_A.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],_A.prototype,"sourceURL",void 0),_A=T9=u([P("esri.popup.content.support.ImageMediaInfoValue")],_A);const p$e=_A;var S9;let TT=S9=class extends UW{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new S9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],TT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],TT.prototype,"type",void 0),u([d({type:p$e,json:{write:!0}})],TT.prototype,"value",void 0),TT=S9=u([P("esri.popup.content.ImageMediaInfo")],TT);const ufe=TT;var E9;let VD=E9=class extends T5{constructor(e){super(e),this.type="line-chart"}clone(){return new E9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:S5.write}})],VD.prototype,"type",void 0),VD=E9=u([P("esri.popup.content.LineChartMediaInfo")],VD);const hfe=VD;var C9;let BD=C9=class extends T5{constructor(e){super(e),this.type="pie-chart"}clone(){return new C9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:S5.write}})],BD.prototype,"type",void 0),BD=C9=u([P("esri.popup.content.PieChartMediaInfo")],BD);const dfe=BD,pfe={base:UW,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":lfe,"column-chart":cfe,"line-chart":hfe,"pie-chart":dfe,image:ufe}};var A9;let pd=A9=class extends Jw{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?ufe.fromJSON(t):t.type==="barchart"?lfe.fromJSON(t):t.type==="columnchart"?cfe.fromJSON(t):t.type==="linechart"?hfe.fromJSON(t):t.type==="piechart"?dfe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new A9(te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],pd.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],pd.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],pd.prototype,"description",void 0),u([d({types:[pfe]})],pd.prototype,"mediaInfos",void 0),u([Ie("mediaInfos")],pd.prototype,"readMediaInfos",null),u([He("mediaInfos")],pd.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],pd.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],pd.prototype,"type",void 0),pd=A9=u([P("esri.popup.content.MediaContent")],pd);const BO=pd;var M9;let bA=M9=class extends Jw{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new M9({text:this.text})}};u([d({type:String,json:{write:!0}})],bA.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],bA.prototype,"type",void 0),bA=M9=u([P("esri.popup.content.TextContent")],bA);const T2=bA,f$e={base:null,key:"type",typeMap:{attachment:zO,media:BO,text:T2,expression:FW,field:x2}};var O9;let b1=O9=class extends xe{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new O9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],b1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],b1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],b1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],b1.prototype,"returnType",void 0),b1=O9=u([P("esri.popup.ExpressionInfo")],b1);const ffe=b1;var R9;let wA=R9=class extends xe{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new R9({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],wA.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],wA.prototype,"showNoDataRecords",void 0),wA=R9=u([P("esri.popup.LayerOptions")],wA);const m$e=wA;var P9;let xA=P9=class extends xe{constructor(e){super(e),this.field=null,this.order=null}clone(){return new P9({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],xA.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],xA.prototype,"order",void 0),xA=P9=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],xA);const mfe=xA;var I9;let TA=I9=class extends xe{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new I9({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?te(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],TA.prototype,"showRelatedRecords",void 0),u([d({type:[mfe],json:{write:!0}})],TA.prototype,"orderByFields",void 0),TA=I9=u([P("esri.popup.RelatedRecordsInfo")],TA);const g$e=TA;let gfe=0;const E5=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+gfe++})}};return t=u([P("esri.core.Identifiable")],t),t},y$e=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:gfe++})}};return t=u([P("esri.core.NumericIdentifiable")],t),t};let jK=class extends E5(class{}){};jK=u([P("esri.core.Identifiable")],jK);var $9;let fd=$9=class extends E5(Ae){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new $9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],fd.prototype,"active",void 0),u([d()],fd.prototype,"className",void 0),u([d()],fd.prototype,"disabled",void 0),u([d()],fd.prototype,"id",void 0),u([d()],fd.prototype,"indicator",void 0),u([d()],fd.prototype,"title",void 0),u([d()],fd.prototype,"type",void 0),u([d()],fd.prototype,"visible",void 0),fd=$9=u([P("esri.support.actions.ActionBase")],fd);const C5=fd;var D9;let GD=D9=class extends C5{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new D9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],GD.prototype,"image",void 0),GD=D9=u([P("esri.support.Action.ActionButton")],GD);const TE=GD;var L9;let SA=L9=class extends C5{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new L9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],SA.prototype,"image",void 0),u([d()],SA.prototype,"value",void 0),SA=L9=u([P("esri.support.Action.ActionToggle")],SA);const yfe=SA;var N9;const v$e=ct.ofType({key:"type",defaultKeyValue:"button",base:C5,typeMap:{button:TE,toggle:yfe}}),_$e={base:Jw,key:"type",typeMap:{media:BO,custom:h$e,text:T2,attachments:zO,fields:x2,expression:FW}},vfe="esri.PopupTemplate",b$e=de.getLogger(vfe),w$e=["attachments","fields","media","text","expression"];let Sn=N9=class extends xe{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>up(_$e,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Fu(e)?e:(b$e.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>w$e.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?te(e.toArray()):[];return new N9({actions:t,content:Array.isArray(this.content)?te(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?te(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?te(this.fieldInfos):null,layerOptions:this.layerOptions?te(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?te(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?te(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),kO(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=te(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=te(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),BO.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),T2.fromJSON(s)):s.type==="attachments"?zO.fromJSON(s):s.type==="fields"?x2.fromJSON(s):s.type==="expression"?FW.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new T2({text:e})):r.push(new x2),Array.isArray(t)&&t.length&&r.push(BO.fromJSON({mediaInfos:t})),i&&r.push(zO.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Rl(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:v$e})],Sn.prototype,"actions",void 0),u([d()],Sn.prototype,"content",void 0),u([Nt("content")],Sn.prototype,"castContent",null),u([Ie("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],Sn.prototype,"readContent",null),u([He("content",{popupElements:{type:ct.ofType(f$e)},showAttachments:{type:Boolean},mediaInfos:{type:ct.ofType(pfe)},description:{type:String}})],Sn.prototype,"writeContent",null),u([d({type:[ffe],json:{write:!0}})],Sn.prototype,"expressionInfos",void 0),u([d({type:[f3]})],Sn.prototype,"fieldInfos",void 0),u([He("fieldInfos")],Sn.prototype,"writeFieldInfos",null),u([d({type:m$e})],Sn.prototype,"layerOptions",void 0),u([He("layerOptions")],Sn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Sn.prototype,"lastEditInfoEnabled",void 0),u([d()],Sn.prototype,"outFields",void 0),u([d()],Sn.prototype,"overwriteActions",void 0),u([d()],Sn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Sn.prototype,"title",void 0),u([He("title")],Sn.prototype,"writeTitle",null),u([d({type:g$e,json:{write:!0}})],Sn.prototype,"relatedRecordsInfo",void 0),Sn=N9=u([P(vfe)],Sn);const SE=Sn,lF={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function _fe(e){return lF[e]||lF[e.toLowerCase()]}function kW(e){var t;return(t=lF[e])!=null?t:lF[e.toLowerCase()]}function x$e(e){return[...kW(e)]}function Mz(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function bfe(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*Mz(o,n,s+1/3)),Math.round(255*Mz(o,n,s)),Math.round(255*Mz(o,n,s-1/3)),r]}function T$e(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function DP(e){return Ne(K4(e),0,255)}function LP(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class fn{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new fn){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),fn.fromArray(a,i)}return fn.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return fn.fromArray(bfe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new fn){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new fn){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=_fe(t)?kW(t):null;return r&&fn.fromArray(r,i)||fn.fromRgb(t,i)||fn.fromHex(t,i)}static fromJSON(t){return t&&new fn([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?fn.fromString(t,this):Array.isArray(t)?fn.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof fn||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=fn.AlphaMode.ALWAYS){const i=DP(this.r),r=DP(this.g),s=DP(this.b);return t===fn.AlphaMode.ALWAYS||this.a!==1?[i,r,s,DP(255*this.a)]:[i,r,s]}clone(){return new fn(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(LP(this.r,0,255)),this.g=Math.round(LP(this.g,0,255)),this.b=Math.round(LP(this.b,0,255)),this.a=LP(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}fn.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(fn||(fn={}));const We=fn,HK=new Mi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let S$e=0,ST=class extends xe{constructor(e){super(e),this.id="sym"+S$e++,this.type=null,this.color=new We([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:HK.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:HK.write}}})],ST.prototype,"type",void 0),u([d({type:We,json:{write:{allowNull:!0}}})],ST.prototype,"color",void 0),u([Ie("color")],ST.prototype,"readColor",null),ST=u([P("esri.symbols.Symbol")],ST);const Ac=ST;var F9;let a0=F9=class extends Ac{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return Rl(e,t,n.expression)});await Promise.all(r)}}}clone(){return new F9({data:te(this.data)})}hash(){return Uq(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],a0.prototype,"color",void 0),u([d({json:{write:!0}})],a0.prototype,"data",void 0),u([Ie("data",["symbol"])],a0.prototype,"readData",null),u([He("data",{})],a0.prototype,"writeData",null),u([mt({CIMSymbolReference:"cim"},{readOnly:!0})],a0.prototype,"type",void 0),a0=F9=u([P("esri.symbols.CIMSymbol")],a0);const EE=a0;let ET=class extends xe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],ET.prototype,"enabled",void 0),u([He("enabled")],ET.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],ET.prototype,"type",void 0),ET=u([P("esri.symbols.Symbol3DLayer")],ET);const rm=ET,E$e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,C$e="screenUtils.toPt: input not recognized!",wfe=96;function no(e){return e?e/72*wfe:0}function Iu(e){return e?72*e/wfe:0}function er(e){if(typeof e=="string"){const t=e.match(E$e);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Iu(i):i;return s?-n:n}return console.warn(C$e),null}return e}function pp(e=0,t=0){return{x:e,y:t}}function Wr(e=0,t=0){return[e,t]}function A$e(e=0,t=0){return[e,t]}function Ro(e=0,t=0,i=0){return[e,t,i]}function owt(e){return e}function awt(e){return e}function lwt(e){return e}function vg(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function A5(e){const t=K4(100*(1-e));return Math.max(0,Math.min(t,100))}function GO(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function M$e(e,t){const i=t.transparency!=null?GO(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new We([r[0]||0,r[1]||0,r[2]||0,i]):null}function O$e(e,t){t.color=e.toJSON().slice(0,3);const i=A5(e.a);i!==0&&(t.transparency=i)}const oy={type:We,json:{type:[wr],default:null,read:{source:["color","transparency"],reader:M$e},write:{target:{color:{type:[wr]},transparency:{type:wr}},writer:O$e}}},Hf={type:Number,cast:er,json:{write:!0}};let w1=class extends xe{constructor(e){super(e),this.color=new We([0,0,0,1]),this.extensionLength=0,this.size=Iu(1)}clone(){}cloneProperties(){return{color:te(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],w1.prototype,"type",void 0),u([d(oy)],w1.prototype,"color",void 0),u([d(ye(F({},Hf),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],w1.prototype,"extensionLength",void 0),u([d(Hf)],w1.prototype,"size",void 0),w1=u([P("esri.symbols.edges.Edges3D")],w1);const zW=w1;var U9;let jD=U9=class extends zW{constructor(e){super(e),this.type="sketch"}clone(){return new U9(this.cloneProperties())}};u([mt({sketch:"sketch"},{readOnly:!0})],jD.prototype,"type",void 0),jD=U9=u([P("esri.symbols.edges.SketchEdges3D")],jD);const R$e=jD;var k9;let HD=k9=class extends zW{constructor(e){super(e),this.type="solid"}clone(){return new k9(this.cloneProperties())}};u([mt({solid:"solid"},{readOnly:!0})],HD.prototype,"type",void 0),HD=k9=u([P("esri.symbols.support.SolidEdges3D")],HD);const P$e=HD,xfe={types:{key:"type",base:zW,typeMap:{solid:P$e,sketch:R$e}},json:{write:!0}};var z9;let Cu=z9=class extends xe{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new z9(e)}};u([d(oy)],Cu.prototype,"color",void 0),Cu=z9=u([P("esri.symbols.support.Symbol3DMaterial")],Cu);var V9;let l0=V9=class extends rm{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new V9({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([mt({Extrude:"extrude"},{readOnly:!0})],l0.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],l0.prototype,"size",void 0),u([d({type:Cu,json:{write:!0}})],l0.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],l0.prototype,"castShadows",void 0),u([d(xfe)],l0.prototype,"edges",void 0),l0=V9=u([P("esri.symbols.ExtrudeSymbol3DLayer")],l0);const Tfe=l0;let EA=class extends Ac{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([mt({esriSLS:"simple-line"},{readOnly:!0})],EA.prototype,"type",void 0),u([d({type:Number,cast:er,json:{write:!0}})],EA.prototype,"width",void 0),EA=u([P("esri.symbols.LineSymbol")],EA);const I$e=EA,$$e=["begin","end","begin-end"],Sfe=["arrow","circle","square","diamond","cross","x"];var B9;let Wp=B9=class extends xe{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new B9({color:te(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Wp.prototype,"placement",void 0),u([mt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Wp.prototype,"type",void 0),u([d({type:Sfe})],Wp.prototype,"style",void 0),u([He("style")],Wp.prototype,"writeStyle",null),u([d({type:We,value:null,json:{write:{allowNull:!0}}})],Wp.prototype,"color",null),u([Ie("color")],Wp.prototype,"readColor",null),u([He("color")],Wp.prototype,"writeColor",null),Wp=B9=u([P("esri.symbols.LineSymbolMarker")],Wp);const D$e=Wp;var G9;const Oz=new Mi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Lm=G9=class extends I$e{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=er(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=er(n)),o}clone(){var e;return new G9({color:te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([mt({esriSLS:"simple-line"},{readOnly:!0})],Lm.prototype,"type",void 0),u([d({type:Oz.apiValues,json:{read:Oz.read,write:Oz.write}})],Lm.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Lm.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Lm.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":D$e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Lm.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Lm.prototype,"miterLimit",void 0),Lm=G9=u([P("esri.symbols.SimpleLineSymbol")],Lm);const Qh=Lm;let CA=class extends Ac{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Qh}},json:{default:null,write:!0}})],CA.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],CA.prototype,"type",void 0),CA=u([P("esri.symbols.FillSymbol")],CA);const Efe=CA;let qD=class extends xe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],qD.prototype,"type",void 0),qD=u([P("esri.symbols.patterns.LinePattern3D")],qD);const Cfe=qD,L$e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var j9;const N$e=da()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let AA=j9=class extends Cfe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new j9(e)}};u([d({type:["style"]})],AA.prototype,"type",void 0),u([mt(N$e),d({type:L$e})],AA.prototype,"style",void 0),AA=j9=u([P("esri.symbols.patterns.LineStylePattern3D")],AA);const VW=AA;let WD=class extends xe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],WD.prototype,"type",void 0),WD=u([P("esri.symbols.patterns.Pattern3D")],WD);const Afe=WD,F$e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var H9;let MA=H9=class extends Afe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new H9(e)}};u([d({type:["style"]})],MA.prototype,"type",void 0),u([d({type:F$e,json:{read:!0,write:!0}})],MA.prototype,"style",void 0),MA=H9=u([P("esri.symbols.patterns.StylePattern3D")],MA);const Mfe=MA,U$e={types:{key:"type",base:Afe,typeMap:{style:Mfe}},json:{write:!0}},Ofe={types:{key:"type",base:Cfe,typeMap:{style:VW}},json:{write:!0}},kM=new We("white");new We("black");const k$e=new We([255,255,255,0]);function z$e(e){return e.r===0&&e.g===0&&e.b===0}var q9;let zM=q9=class extends Cu{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new q9(e)}};u([mt({multiply:"multiply",replace:"replace",tint:"tint"})],zM.prototype,"colorMixMode",void 0),zM=q9=u([P("esri.symbols.support.Symbol3DFillMaterial")],zM);function Lt(e=j$e){return[e[0],e[1],e[2],e[3]]}function cwt(e){return[e[0],e[1],e[2],e[3]]}function Xg(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function BW(e,t,i,r,s=Lt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function jO(e,t=Lt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function M5(e,t){return new Xt({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function BS(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Hb(e,t,i){if(M(t))Xg(i,e);else if("length"in t)X9(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function Rz(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function W9(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function fu(e){return M(e)||e[0]>=e[2]?0:e[2]-e[0]}function fp(e){return e[1]>=e[3]?0:e[3]-e[1]}function Rfe(e){return fu(e)*fp(e)}function GW(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Pfe(e,t){return jW(e,t[0],t[1])}function qK(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function uwt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),v=p(r,s);return!(f===m&&m===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function hwt(e,t){return jW(e,t.x,t.y)}function jW(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function OA(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function V$e(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function m3(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function WK(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function XD(e,t,i){if(M(t))return Xg(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=Ne(e[0],r,n),i[1]=Ne(e[1],s,o),i[2]=Ne(e[2],r,n),i[3]=Ne(e[3],s,o),i}function B$e(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-fu(e)/2,0),n=Math.max(Math.abs(t[1]-r)-fp(e)/2,0);return Math.sqrt(s*s+n*n)}function cF(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function xc(e){return e?Xg(e,Y9):Lt(Y9)}function X9(e){return e!=null&&e.length===4}function G$e(e){return!(fu(e)!==0&&isFinite(e[0])||fp(e)!==0&&isFinite(e[1]))}function qb(e,t){return X9(e)&&X9(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const dwt=[-1/0,-1/0,1/0,1/0],Y9=[1/0,1/0,-1/0,-1/0],j$e=[0,0,0,0];function ks(e=Nfe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function gw(e,t,i,r,s,n,o=ks()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function pwt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new Xt(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function S2(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function H$e(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function qf(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function xu(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function Pz(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function q$e(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function Kw(e){return e[0]>=e[3]?0:e[3]-e[0]}function ex(e){return e[1]>=e[4]?0:e[4]-e[1]}function p_(e){return e[2]>=e[5]?0:e[5]-e[2]}function Ife(e){const t=Kw(e),i=p_(e),r=ex(e);return Math.sqrt(t*t+i*i+r*r)}function Qd(e,t=[0,0,0]){return t[0]=e[0]+Kw(e)/2,t[1]=e[1]+ex(e)/2,t[2]=e[2]+p_(e)/2,t}function NP(e,t=[0,0,0]){return t[0]=Kw(e),t[1]=ex(e),t[2]=p_(e),t}function W$e(e){return Math.max(Kw(e),p_(e),ex(e))}function HW(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function fwt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function X$e(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function Jd(e,t){return!!M(t)||X$e(e,t)}function $fe(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function mwt(e,t,i=e){const r=e[0]+Kw(e)/2,s=e[1]+ex(e)/2,n=e[2]+p_(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function Dfe(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function Lfe(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function O5(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function pr(e){return e?O5(e,YK):ks(YK)}function qW(e,t){return t||(t=Lt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function gwt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function XK(e){return e.length===6}function R5(e){return Kw(e)===0&&ex(e)===0&&p_(e)===0}function ywt(e,t,i){if(M(e)||M(t))return e===t;if(!XK(e)||!XK(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Y$e(e,t,i,r,s,n){return gw(e,t,i,r,s,n,Z$e)}const vwt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],YK=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Nfe=[0,0,0,0,0,0],Z$e=ks();function Iz(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Ue(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const Q$e=gw(-.5,-.5,-.5,.5,.5,.5),J$e=gw(-.5,-.5,0,.5,.5,1),K$e=gw(-.5,-.5,0,.5,.5,.5);function eDe(e){switch(e){case"sphere":case"cube":case"diamond":return Q$e;case"cylinder":case"cone":case"inverted-cone":return J$e;case"tetrahedron":return K$e;default:return}}const WW=["butt","square","round"],tDe=[...WW,"none"],Ffe=["miter","bevel","round"];var Z9;let x1=Z9=class extends xe{constructor(e){super(e),this.color=new We([0,0,0,1]),this.size=Iu(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new Z9(e)}};u([d(oy)],x1.prototype,"color",void 0),u([d(Hf)],x1.prototype,"size",void 0),u([d(Ofe)],x1.prototype,"pattern",void 0),u([d({type:WW,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],x1.prototype,"patternCap",void 0),x1=Z9=u([P("esri.symbols.support.Symbol3DOutline")],x1);var YD;let Nm=YD=class extends rm{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new YD(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new VW({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:kM).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new YD({material:new zM({color:((l=e.color)!=null?l:k$e).clone()}),pattern:e.style&&e.style!=="solid"?new Mfe({style:e.style}):null,outline:i})}};u([mt({Fill:"fill"},{readOnly:!0})],Nm.prototype,"type",void 0),u([d({type:zM,json:{write:!0}})],Nm.prototype,"material",void 0),u([d(U$e)],Nm.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Nm.prototype,"castShadows",void 0),u([d({type:x1,json:{write:!0}})],Nm.prototype,"outline",void 0),u([d(xfe)],Nm.prototype,"edges",void 0),Nm=YD=u([P("esri.symbols.FillSymbol3DLayer")],Nm);const P5=Nm,iDe=["none","underline","line-through"],rDe=["normal","italic","oblique"],sDe=["normal","lighter","bold","bolder"],Ufe={type:Number,cast:e=>{const t=Sh(e);return t===0?1:Ne(t,.1,4)},nonNullable:!0},nDe=["left","right","center"],oDe=["baseline","top","middle","bottom"],kfe={type:nDe,nonNullable:!0},zfe={type:oDe,nonNullable:!0};var Q9;let Fm=Q9=class extends xe{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return er(e)}clone(){return new Q9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:iDe,json:{default:"none",write:!0}})],Fm.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Fm.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Fm.prototype,"size",void 0),u([Nt("size")],Fm.prototype,"castSize",null),u([d({type:rDe,json:{default:"normal",write:!0}})],Fm.prototype,"style",void 0),u([d({type:sDe,json:{default:"normal",write:!0}})],Fm.prototype,"weight",void 0),Fm=Q9=u([P("esri.symbols.Font")],Fm);const I5=Fm;function CE(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=_u(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=c5(e,t.portalItem.itemUrl);lDe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return J9(e,t&&t.portal)}function yw(e,t,i=HO.YES){if(!e)return e;!Su(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=_u(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=J9(s,t.portal);r=c5(J9(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Vfe(r,t&&t.portal),Su(r)&&(r=sp(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Su(r)&&!em(r)&&i===HO.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function XW(e,t,i){return CE(e,i)}function jv(e,t,i,r){const s=yw(e,r);s!==void 0&&(t[i]=s)}const aDe=/\/items\/([^\/]+)\/resources\//,lDe=/^\.\/resources\//;function cDe(e){const t=_(e)?e.match(aDe):null;return _(t)?t[1]:null}function Vfe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?k8(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function J9(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=Qq();return OO(r,`${r.scheme}://${i}`)?k8(e,t.portalHostname,i):k8(e,i,t.portalHostname)}var HO;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(HO||(HO={}));const _wt=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:CE,toJSON:yw,read:XW,write:jv,itemIdFromResourceUrl:cDe,ensureMainOnlineDomain:Vfe,get MarkKeep(){return HO}},Symbol.toStringTag,{value:"Module"}));var K9;const uDe=da()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let T1=K9=class extends xe{constructor(e){super(e)}readHref(e,t,i){return e?CE(e,i):t.dataURI}writeHref(e,t,i,r){e&&(em(e)?t.dataURI=e:(t.href=yw(e,r),Su(t.href)&&(t.href=sp(t.href))))}clone(){return new K9({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],T1.prototype,"href",void 0),u([Ie("href")],T1.prototype,"readHref",null),u([He("href",{href:{type:String},dataURI:{type:String}})],T1.prototype,"writeHref",null),u([mt(uDe)],T1.prototype,"primitive",void 0),T1=K9=u([P("esri.symbols.support.IconSymbol3DLayerResource")],T1);const hDe="circle";var eG;let pS=eG=class extends Ae{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new eG({x:this.x,y:this.y})}};u([d({type:Number})],pS.prototype,"x",void 0),u([d({type:Number})],pS.prototype,"y",void 0),pS=eG=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],pS);var tG;let RA=tG=class extends xe{constructor(e){super(e),this.color=new We([0,0,0,1]),this.size=Iu(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new tG(e)}};u([d(oy)],RA.prototype,"color",void 0),u([d(Hf)],RA.prototype,"size",void 0),RA=tG=u([P("esri.symbols.support.Symbol3DIconOutline")],RA);var CT;const dDe=de.getLogger("esri.symbols.IconSymbol3DLayer");let Xp=CT=class extends rm{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new CT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||kM,i=ZK(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||kM).clone()}:null;return new CT({size:e.size,resource:{primitive:fDe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||z$e(e.color)?kM:e.color,i=ZK(e);return new CT({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new CT({resource:{href:Ahe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function ZK(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=QK(e.xoffset),s=QK(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function QK(e){return isFinite(e)?e:0}u([d({type:Cu,json:{write:!0}})],Xp.prototype,"material",void 0),u([d({type:T1,json:{write:!0}})],Xp.prototype,"resource",void 0),u([mt({Icon:"icon"},{readOnly:!0})],Xp.prototype,"type",void 0),u([d(Hf)],Xp.prototype,"size",void 0),u([mt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Xp.prototype,"anchor",void 0),u([d({type:pS,json:{type:[Number],read:{reader:e=>new pS({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Xp.prototype,"anchorPosition",void 0),u([d({type:RA,json:{write:!0}})],Xp.prototype,"outline",void 0),Xp=CT=u([P("esri.symbols.IconSymbol3DLayer")],Xp);const pDe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function fDe(e){return pDe[e]||(dDe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const cv=Xp;function Hv(e,t,i=ct){return t||(t=new i),t===e||(t.removeAll(),mDe(e)?t.addMany(e):e&&t.add(e)),t}function Bfe(e){return e}function mDe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const gDe="not-loaded",yDe="loading",vDe="failed",JK="loaded",Gfe=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=Yq(n,l);this.destroyed&&l(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===gDe){this._set("loadStatus",yDe);const a=this._loadController=new AbortController;s({signal:a.signal}),Fo(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",JK),this._loadController=null},r=>{this._set("loadStatus",vDe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===JK}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new q("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Pu],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let PA=class extends Gfe(WN){};PA=u([P("esri.core.Loadable")],PA),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=Gfe,e.isLoadable=t}(PA||(PA={}));const $u=PA;var iG;const _De=new Mi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let sh=iG=class extends Ae{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new iG({categories:this.categories?te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=Yw(this.extent,Ze.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>_De.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:F(F({},t),n)}}};u([d()],sh.prototype,"categories",void 0),u([d()],sh.prototype,"disableExtraQuery",void 0),u([d({type:Xt})],sh.prototype,"extent",void 0),u([d()],sh.prototype,"filter",void 0),u([d()],sh.prototype,"num",void 0),u([d()],sh.prototype,"query",void 0),u([d()],sh.prototype,"sortField",void 0),u([d()],sh.prototype,"sortOrder",null),u([d()],sh.prototype,"start",void 0),sh=iG=u([P("esri.portal.PortalQueryParams")],sh);const _g=sh;let S1=class extends Ae{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],S1.prototype,"nextQueryParams",void 0),u([d()],S1.prototype,"queryParams",void 0),u([d()],S1.prototype,"results",void 0),u([d()],S1.prototype,"total",void 0),S1=u([P("esri.portal.PortalQueryResult")],S1);const bDe=S1;let Um=class extends xe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Um.prototype,"created",void 0),u([d()],Um.prototype,"id",void 0),u([d()],Um.prototype,"portal",void 0),u([d()],Um.prototype,"title",void 0),u([d({readOnly:!0})],Um.prototype,"url",null),u([d()],Um.prototype,"username",void 0),Um=u([P("esri.portal.PortalFolder")],Um);const wDe=Um;let Bn=class extends xe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=Ss(_g,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new _g,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new _g,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new _g;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new _g;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],Bn.prototype,"access",void 0),u([d({type:Date})],Bn.prototype,"created",void 0),u([d()],Bn.prototype,"description",void 0),u([d()],Bn.prototype,"id",void 0),u([d()],Bn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Bn.prototype,"modified",void 0),u([d()],Bn.prototype,"owner",void 0),u([d()],Bn.prototype,"portal",void 0),u([d()],Bn.prototype,"snippet",void 0),u([d()],Bn.prototype,"sortField",void 0),u([d()],Bn.prototype,"sortOrder",void 0),u([d()],Bn.prototype,"tags",void 0),u([d()],Bn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Bn.prototype,"thumbnailUrl",null),u([d()],Bn.prototype,"title",void 0),u([d({readOnly:!0})],Bn.prototype,"url",null),Bn=u([P("esri.portal.PortalGroup")],Bn);const rG=Bn;var xDe=Object.freeze(Object.defineProperty({__proto__:null,default:rG},Symbol.toStringTag,{value:"Module"})),sG;let Jr=sG=class extends xe{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=wDe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=rG.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return $ve}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new rG({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new q("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new sG;return t.sourceJSON=e,t.read(e),t}};u([d()],Jr.prototype,"access",void 0),u([d({type:Date})],Jr.prototype,"created",void 0),u([d()],Jr.prototype,"culture",void 0),u([d()],Jr.prototype,"description",void 0),u([d()],Jr.prototype,"email",void 0),u([d()],Jr.prototype,"favGroupId",void 0),u([d()],Jr.prototype,"fullName",void 0),u([d({type:Date})],Jr.prototype,"modified",void 0),u([d()],Jr.prototype,"orgId",void 0),u([d()],Jr.prototype,"portal",void 0),u([d()],Jr.prototype,"preferredView",void 0),u([d()],Jr.prototype,"privileges",void 0),u([d()],Jr.prototype,"region",void 0),u([d()],Jr.prototype,"role",void 0),u([d()],Jr.prototype,"roleId",void 0),u([d()],Jr.prototype,"sourceJSON",void 0),u([d()],Jr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Jr.prototype,"thumbnailUrl",null),u([d()],Jr.prototype,"units",void 0),u([d({readOnly:!0})],Jr.prototype,"userContentUrl",null),u([d({readOnly:!0})],Jr.prototype,"url",null),u([d()],Jr.prototype,"username",void 0),u([d()],Jr.prototype,"userType",void 0),Jr=sG=u([P("esri.portal.PortalUser")],Jr);const YW=Jr;var TDe=Object.freeze(Object.defineProperty({__proto__:null,default:YW},Symbol.toStringTag,{value:"Module"})),Bc;let $z;const KK={PortalGroup:()=>Promise.resolve().then(function(){return xDe}),PortalItem:()=>Promise.resolve().then(function(){return $ve}),PortalUser:()=>Promise.resolve().then(function(){return TDe})};let Ve=Bc=class extends h3($u){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ki.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)ki.request.trustedServers.includes(t)||ki.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=YW.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return b7e}).then(({default:i})=>{Wt(e),$z=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(Fs){const r=Fs;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Bc.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await Promise.resolve().then(function(){return v_t})).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new _g;return i.query=e||(ki.apiKey&&Lhe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new $z({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):bs(e)?Promise.reject(hi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new _g;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return bs(e)?Promise.reject(hi()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Tu();return this._request(this.restUrl+"/portals/regions",ye(F({},e),{query:{culture:t}}))}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Tu();return this._request(this.restUrl+"/portals/self/settings",ye(F({},e),{query:{culture:t}}))}static getDefault(){return Bc._default&&!Bc._default.destroyed||(Bc._default=new Bc),Bc._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new q("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Bc({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new q("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new q("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=F({authMode:e,query:{culture:Tu().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=Ss(_g,t),n=o=>this._request(this.restUrl+e,F(F({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new bDe({nextQueryParams:l,queryParams:s,total:a.total,results:Bc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(bp(l),a)));return i&&KK[i]?KK[i]().then(({default:o})=>(Wt(r),n(o))):n()}_signIn(){if(this.authMode===Bc.AUTH_MODE_ANONYMOUS)return Promise.reject(new q("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Fs?Fs.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=Bc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=$z.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=F({f:"json"},t.query),{authMode:r=this.authMode===Bc.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return _i(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ve.AUTH_MODE_ANONYMOUS="anonymous",Ve.AUTH_MODE_AUTO="auto",Ve.AUTH_MODE_IMMEDIATE="immediate",u([d()],Ve.prototype,"access",void 0),u([d()],Ve.prototype,"allSSL",void 0),u([d()],Ve.prototype,"authMode",void 0),u([d()],Ve.prototype,"authorizedCrossOriginDomains",void 0),u([Ie("authorizedCrossOriginDomains")],Ve.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Ve.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Ve.prototype,"bingKey",void 0),u([d()],Ve.prototype,"canListApps",void 0),u([d()],Ve.prototype,"canListData",void 0),u([d()],Ve.prototype,"canListPreProvisionedItems",void 0),u([d()],Ve.prototype,"canProvisionDirectPurchase",void 0),u([d()],Ve.prototype,"canSearchPublic",void 0),u([d()],Ve.prototype,"canShareBingPublic",void 0),u([d()],Ve.prototype,"canSharePublic",void 0),u([d()],Ve.prototype,"canSignInArcGIS",void 0),u([d()],Ve.prototype,"canSignInIDP",void 0),u([d()],Ve.prototype,"colorSetsGroupQuery",void 0),u([d()],Ve.prototype,"commentsEnabled",void 0),u([d({type:Date})],Ve.prototype,"created",void 0),u([d()],Ve.prototype,"credential",void 0),u([d()],Ve.prototype,"culture",void 0),u([d()],Ve.prototype,"currentVersion",void 0),u([d()],Ve.prototype,"customBaseUrl",void 0),u([d()],Ve.prototype,"defaultBasemap",void 0),u([Ie("defaultBasemap")],Ve.prototype,"readDefaultBasemap",null),u([d()],Ve.prototype,"defaultDevBasemap",void 0),u([Ie("defaultDevBasemap")],Ve.prototype,"readDefaultDevBasemap",null),u([d({type:Xt})],Ve.prototype,"defaultExtent",void 0),u([d()],Ve.prototype,"defaultVectorBasemap",void 0),u([Ie("defaultVectorBasemap")],Ve.prototype,"readDefaultVectorBasemap",null),u([d()],Ve.prototype,"description",void 0),u([d()],Ve.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Ve.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Ve.prototype,"extraQuery",null),u([d()],Ve.prototype,"featuredGroups",void 0),u([d()],Ve.prototype,"featuredItemsGroupQuery",void 0),u([d()],Ve.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Ve.prototype,"livingAtlasGroupQuery",void 0),u([d()],Ve.prototype,"hasCategorySchema",void 0),u([d()],Ve.prototype,"helpBase",void 0),u([d()],Ve.prototype,"helperServices",void 0),u([d()],Ve.prototype,"helpMap",void 0),u([d()],Ve.prototype,"homePageFeaturedContent",void 0),u([d()],Ve.prototype,"homePageFeaturedContentCount",void 0),u([d()],Ve.prototype,"httpPort",void 0),u([d()],Ve.prototype,"httpsPort",void 0),u([d()],Ve.prototype,"id",void 0),u([d()],Ve.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Ve.prototype,"isOrganization",null),u([d()],Ve.prototype,"isPortal",void 0),u([d()],Ve.prototype,"isReadOnly",void 0),u([d()],Ve.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Ve.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Ve.prototype,"modified",void 0),u([d()],Ve.prototype,"name",void 0),u([d()],Ve.prototype,"portalHostname",void 0),u([d()],Ve.prototype,"portalMode",void 0),u([d()],Ve.prototype,"portalProperties",void 0),u([d()],Ve.prototype,"region",void 0),u([d({readOnly:!0})],Ve.prototype,"restUrl",null),u([d()],Ve.prototype,"rotatorPanels",void 0),u([d()],Ve.prototype,"showHomePageDescription",void 0),u([d()],Ve.prototype,"sourceJSON",void 0),u([d()],Ve.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Ve.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Ve.prototype,"stylesGroupQuery3d",void 0),u([d()],Ve.prototype,"supportsHostedServices",void 0),u([d()],Ve.prototype,"symbolSetsGroupQuery",void 0),u([d()],Ve.prototype,"templatesGroupQuery",void 0),u([d()],Ve.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ve.prototype,"thumbnailUrl",null),u([d()],Ve.prototype,"units",void 0),u([d()],Ve.prototype,"url",void 0),u([d()],Ve.prototype,"urlKey",void 0),u([Ie("urlKey")],Ve.prototype,"readUrlKey",null),u([d()],Ve.prototype,"user",void 0),u([Ie("user")],Ve.prototype,"readUser",null),u([d()],Ve.prototype,"useStandardizedQuery",void 0),u([d()],Ve.prototype,"useVectorBasemaps",void 0),u([d()],Ve.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ve=Bc=u([P("esri.portal.Portal")],Ve);const Pl=Ve;let E1=class extends Ec(xe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(M(this.color)&&M(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],E1.prototype,"type",void 0),u([d({type:$$e,json:{default:"begin-end",write:!0}})],E1.prototype,"placement",void 0),u([d({type:Sfe,json:{default:"arrow",write:!0}})],E1.prototype,"style",void 0),u([d({type:We,json:{type:[wr],default:null,write:!0}})],E1.prototype,"color",void 0),E1=u([P("esri.symbols.LineStyleMarker3D")],E1);const nG=E1;var ZD;let Yp=ZD=class extends rm{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Iu(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new ZD(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:Iu(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new VW({style:e.style}):null,material:new Cu({color:(e.color||kM).clone()}),marker:e.marker?new nG({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new ZD(t)}};u([d({type:Cu,json:{write:!0}})],Yp.prototype,"material",void 0),u([mt({Line:"line"},{readOnly:!0})],Yp.prototype,"type",void 0),u([d({type:Ffe,json:{write:!0,default:"miter"}})],Yp.prototype,"join",void 0),u([d({type:WW,json:{write:!0,default:"butt"}})],Yp.prototype,"cap",void 0),u([d(Hf)],Yp.prototype,"size",void 0),u([d(Ofe)],Yp.prototype,"pattern",void 0),u([d({types:{key:"type",base:nG,typeMap:{style:nG}},json:{write:!0}})],Yp.prototype,"marker",void 0),Yp=ZD=u([P("esri.symbols.LineSymbol3DLayer")],Yp);const g3=Yp;var oG;const SDe=da()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let IA=oG=class extends xe{clone(){return new oG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:XW,write:jv}})],IA.prototype,"href",void 0),u([mt(SDe)],IA.prototype,"primitive",void 0),IA=oG=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],IA);const jfe="sphere";var aG;let db=aG=class extends Ae{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new aG({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],db.prototype,"x",void 0),u([d({type:Number})],db.prototype,"y",void 0),u([d({type:Number})],db.prototype,"z",void 0),db=aG=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],db);var lG;let va=lG=class extends rm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new lG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Cu,json:{write:!0}})],va.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],va.prototype,"castShadows",void 0),u([d({type:IA,json:{write:!0}})],va.prototype,"resource",void 0),u([mt({Object:"object"},{readOnly:!0})],va.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"depth",void 0),u([mt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],va.prototype,"anchor",void 0),u([d({type:db,json:{type:[Number],read:{reader:e=>new db({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],va.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],va.prototype,"roll",void 0),u([d({readOnly:!0})],va.prototype,"isPrimitive",null),va=lG=u([P("esri.symbols.ObjectSymbol3DLayer")],va);const ZW=va;var cG;let il=cG=class extends rm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new cG({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Cu,json:{write:!0}})],il.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],il.prototype,"castShadows",void 0),u([mt({Path:"path"},{readOnly:!0})],il.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],il.prototype,"profile",void 0),u([d({type:Ffe,json:{write:!0,default:"miter"}})],il.prototype,"join",void 0),u([d({type:tDe,json:{write:!0,default:"butt"}})],il.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],il.prototype,"width",void 0),u([Ie("width",["width","size","height"])],il.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],il.prototype,"height",void 0),u([Ie("height",["height","size","width"])],il.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],il.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],il.prototype,"profileRotation",void 0),il=cG=u([P("esri.symbols.PathSymbol3DLayer")],il);const QW=il;var uG;let fS=uG=class extends xe{constructor(){super(...arguments),this.color=new We([0,0,0,1]),this.size=0}clone(){const e={color:te(this.color),size:this.size};return new uG(e)}};u([d(oy)],fS.prototype,"color",void 0),u([d(Hf)],fS.prototype,"size",void 0),fS=uG=u([P("esri.symbols.support.Symbol3DHalo")],fS);let VM=class extends Ec(xe){constructor(e){super(e),this.color=null}};u([d(oy)],VM.prototype,"color",void 0),VM=u([P("esri.symbols.support.Symbol3DTextBackground")],VM);var QD;let Hl=QD=class extends rm{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=ye(F({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new QD({enabled:this.enabled,font:this.font&&te(this.font),halo:this.halo&&te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:te(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new QD({font:_(e.font)?e.font.clone():new I5,halo:EDe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Cu({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new VM({color:e.backgroundColor.clone()}):null})}};function EDe(e,t){return e&&t>0?new fS({color:te(e),size:t}):null}u([d({type:I5,json:{write:!0}})],Hl.prototype,"font",null),u([He("font")],Hl.prototype,"writeFont",null),u([d({type:fS,json:{write:!0}})],Hl.prototype,"halo",void 0),u([d(ye(F({},kfe),{json:{default:"center",write:!0}}))],Hl.prototype,"horizontalAlignment",void 0),u([d(ye(F({},Ufe),{json:{default:1,write:!0}}))],Hl.prototype,"lineHeight",void 0),u([d({type:Cu,json:{write:!0}})],Hl.prototype,"material",void 0),u([d({type:VM,json:{write:!0}})],Hl.prototype,"background",void 0),u([d(Hf)],Hl.prototype,"size",null),u([d({type:String,json:{write:!0}})],Hl.prototype,"text",void 0),u([mt({Text:"text"},{readOnly:!0})],Hl.prototype,"type",void 0),u([d(ye(F({},zfe),{json:{default:"baseline",write:!0}}))],Hl.prototype,"verticalAlignment",void 0),Hl=QD=u([P("esri.symbols.TextSymbol3DLayer")],Hl);const tx=Hl;var hG;let c0=hG=class extends rm{constructor(e){super(e),this.color=dG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new hG({color:te(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:We,nonNullable:!0,json:{type:[wr],write:(e,t,i)=>t[i]=e.toArray(We.AlphaMode.UNLESS_OPAQUE),default:()=>dG.clone(),defaultEquals:e=>e.toCss(!0)===dG.toCss(!0)}})],c0.prototype,"color",void 0),u([mt({Water:"water"},{readOnly:!0})],c0.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],c0.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],c0.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],c0.prototype,"waveStrength",void 0),c0=hG=u([P("esri.symbols.WaterSymbol3DLayer")],c0);const dG=new We([0,119,190]),Hfe=c0;var pG;let C1=pG=class extends Ae{constructor(){super(...arguments),this.portal=null}clone(){return new pG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],C1.prototype,"name",void 0),u([d({type:String})],C1.prototype,"styleUrl",void 0),u([d({type:String})],C1.prototype,"styleName",void 0),u([d({type:Pl})],C1.prototype,"portal",void 0),C1=pG=u([P("esri.symbols.support.StyleOrigin")],C1);const fG=C1;var mG;let BM=mG=class extends Ae{clone(){return new mG({url:this.url})}};u([d({type:String})],BM.prototype,"url",void 0),BM=mG=u([P("esri.symbols.support.Thumbnail")],BM);const qfe={icon:cv,object:ZW,line:g3,path:QW,fill:P5,extrude:Tfe,text:tx,water:Hfe},CDe=ct.ofType({base:rm,key:"type",typeMap:qfe,errorContext:"symbol-layer"}),ADe=de.getLogger("esri.symbols.Symbol3D");let Zp=class extends Ac{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||ct;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&ADe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Hv(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=CE(e.styleUrl,i);return new fG({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new fG({portal:i&&i.portal||Pl.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Pu("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=yw(e.styleUrl,r);Su(s)&&(s=sp(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!She(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Pu("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof rm||e&&qfe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],Zp.prototype,"color",null),u([d({type:CDe,nonNullable:!0,json:{write:!0}}),Nt(Bfe)],Zp.prototype,"symbolLayers",null),u([d({type:fG})],Zp.prototype,"styleOrigin",void 0),u([Ie("styleOrigin")],Zp.prototype,"readStyleOrigin",null),u([He("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Zp.prototype,"writeStyleOrigin",null),u([d({type:BM,json:{read:!1}})],Zp.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Zp.prototype,"type",void 0),Zp=u([P("esri.symbols.Symbol3D")],Zp);const AE=Zp;let $A=class extends xe{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],$A.prototype,"type",void 0),u([d({readOnly:!0})],$A.prototype,"visible",void 0),$A=u([P("esri.symbols.callouts.Callout3D")],$A);const Wfe=$A;var gG;let JD=gG=class extends xe{constructor(){super(...arguments),this.color=new We("white")}clone(){return new gG({color:te(this.color)})}};u([d(oy)],JD.prototype,"color",void 0),JD=gG=u([P("esri.symbols.callouts.LineCallout3DBorder")],JD);const Xfe=JD;Object.freeze(Object.defineProperty({__proto__:null,default:Xfe},Symbol.toStringTag,{value:"Module"}));var yG;let u0=yG=class extends Wfe{constructor(e){super(e),this.type="line",this.color=new We([0,0,0,1]),this.size=Iu(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new yG({color:te(this.color),size:this.size,border:te(this.border)})}};u([mt({line:"line"},{readOnly:!0})],u0.prototype,"type",void 0),u([d(oy)],u0.prototype,"color",void 0),u([d(Hf)],u0.prototype,"size",void 0),u([d({type:Xfe,json:{write:!0}})],u0.prototype,"border",void 0),u([d({readOnly:!0})],u0.prototype,"visible",null),u0=yG=u([P("esri.symbols.callouts.LineCallout3D")],u0);const MDe=u0;function JW(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function Yfe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!JW(e)}function KW(e){return e.type==="point-3d"||e.type==="label-3d"}function Zfe(e){return e.horizontalAlignment==="center"}const Qfe={types:{key:"type",base:Wfe,typeMap:{line:MDe}},json:{write:!0}};var vG;let pb=vG=class extends xe{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new vG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Hf)],pb.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],pb.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],pb.prototype,"maxWorldLength",void 0),pb=vG=u([P("esri.symbols.support.Symbol3DVerticalOffset")],pb);var KD;const Jfe=ct.ofType({base:null,key:"type",typeMap:{text:tx}});let h0=KD=class extends AE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Jfe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Yfe(this)}hasVisibleVerticalOffset(){return JW(this)}clone(){return new KD({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail),callout:te(this.callout),verticalOffset:te(this.verticalOffset)})}static fromTextSymbol(e){return new KD({symbolLayers:[tx.fromTextSymbol(e)]})}};u([d({type:pb,json:{write:!0}})],h0.prototype,"verticalOffset",void 0),u([d(Qfe)],h0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],h0.prototype,"styleOrigin",void 0),u([d({type:Jfe})],h0.prototype,"symbolLayers",void 0),u([mt({LabelSymbol3D:"label-3d"},{readOnly:!0})],h0.prototype,"type",void 0),h0=KD=u([P("esri.symbols.LabelSymbol3D")],h0);const $5=h0;var eL;const Kfe=ct.ofType({base:null,key:"type",typeMap:{line:g3,path:QW}}),ODe=ct.ofType({base:null,key:"type",typeMap:{line:g3,path:QW}});let DA=eL=class extends AE{constructor(e){super(e),this.symbolLayers=new Kfe,this.type="line-3d"}clone(){return new eL({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleLineSymbol(e){return new eL({symbolLayers:[g3.fromSimpleLineSymbol(e)]})}};u([d({type:Kfe,json:{type:ODe}})],DA.prototype,"symbolLayers",void 0),u([mt({LineSymbol3D:"line-3d"},{readOnly:!0})],DA.prototype,"type",void 0),DA=eL=u([P("esri.symbols.LineSymbol3D")],DA);const D5=DA;let d0=class extends Ac{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],d0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],d0.prototype,"type",void 0),u([d({type:Number,cast:er,json:{write:!0}})],d0.prototype,"xoffset",void 0),u([d({type:Number,cast:er,json:{write:!0}})],d0.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:er(e),json:{write:!0}})],d0.prototype,"size",void 0),d0=u([P("esri.symbols.MarkerSymbol")],d0);const eme=d0;var _G;const tme=ct.ofType({base:null,key:"type",typeMap:{fill:P5}});let LA=_G=class extends AE{constructor(e){super(e),this.symbolLayers=new tme,this.type="mesh-3d"}clone(){return new _G({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}};u([d({type:tme})],LA.prototype,"symbolLayers",void 0),u([mt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],LA.prototype,"type",void 0),LA=_G=u([P("esri.symbols.MeshSymbol3D")],LA);const eX=LA;function RDe(e,t,i){return t.imageData?Ahe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):ime(t.url,i)}function ime(e,t){return IDe(t)&&!Su(e)&&t.layer.parsedUrl?ow(t.layer.parsedUrl.path,"images",e):CE(e,t)}function PDe(e,t,i,r){if(em(e)){const s=u5(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&jv(i.url,t,"url",r)}else jv(e,t,"url",r)}const rme={json:{read:{source:["imageData","url"],reader:RDe},write:{writer(e,t,i,r){PDe(e,t,this.source,r)}}}},sme={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=ime(t.url,i)),r}}}};function IDe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var bG;let nh=bG=class extends Efe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=er(i)),r!=null&&(s.height=er(r)),s}clone(){const e=new bG({color:te(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",te(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([mt({esriPFS:"picture-fill"},{readOnly:!0})],nh.prototype,"type",void 0),u([d(rme)],nh.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],nh.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],nh.prototype,"yscale",void 0),u([d({type:Number,cast:er,json:{write:!0}})],nh.prototype,"width",void 0),u([d({type:Number,cast:er,json:{write:!0}})],nh.prototype,"height",void 0),u([d({type:Number,cast:er,json:{write:!0}})],nh.prototype,"xoffset",void 0),u([d({type:Number,cast:er,json:{write:!0}})],nh.prototype,"yoffset",void 0),u([d(sme)],nh.prototype,"source",void 0),nh=bG=u([P("esri.symbols.PictureFillSymbol")],nh);const nme=nh;var wG;let md=wG=class extends eme{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=er(t)),i!=null&&(r.height=er(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new wG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",te(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],md.prototype,"color",void 0),u([mt({esriPMS:"picture-marker"},{readOnly:!0})],md.prototype,"type",void 0),u([d(rme)],md.prototype,"url",void 0),u([d(sme)],md.prototype,"source",void 0),u([d({type:Number,cast:er,json:{write:!0}})],md.prototype,"height",void 0),u([Ie("height",["height","size"])],md.prototype,"readHeight",null),u([d({type:Number,cast:er,json:{write:!0}})],md.prototype,"width",void 0),u([d({json:{write:!1}})],md.prototype,"size",void 0),md=wG=u([P("esri.symbols.PictureMarkerSymbol")],md);const L5=md;var p0;const ome=ct.ofType({base:null,key:"type",typeMap:{icon:cv,object:ZW,text:tx}});let A1=p0=class extends AE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new ome,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Yfe(this)}hasVisibleVerticalOffset(){return JW(this)}clone(){return new p0({verticalOffset:te(this.verticalOffset),callout:te(this.callout),styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new p0({symbolLayers:[cv.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new p0({symbolLayers:[cv.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new p0({symbolLayers:[cv.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new p0({symbolLayers:[cv.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new p0({symbolLayers:[tx.fromTextSymbol(e)]})}};u([d({type:pb,json:{write:!0}})],A1.prototype,"verticalOffset",void 0),u([d(Qfe)],A1.prototype,"callout",void 0),u([d({type:ome,json:{origins:{"web-scene":{write:!0}}}})],A1.prototype,"symbolLayers",void 0),u([mt({PointSymbol3D:"point-3d"},{readOnly:!0})],A1.prototype,"type",void 0),A1=p0=u([P("esri.symbols.PointSymbol3D")],A1);const uv=A1;var NA;const ame=ct.ofType({base:null,key:"type",typeMap:{extrude:Tfe,fill:P5,icon:cv,line:g3,object:ZW,text:tx,water:Hfe}});let FA=NA=class extends AE{constructor(e){super(e),this.symbolLayers=new ame,this.type="polygon-3d"}clone(){return new NA({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromJSON(e){const t=new NA;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new NA({symbolLayers:[P5.fromSimpleFillSymbol(e)]})}};u([d({type:ame,json:{write:!0}})],FA.prototype,"symbolLayers",void 0),u([mt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],FA.prototype,"type",void 0),FA=NA=u([P("esri.symbols.PolygonSymbol3D")],FA);const y3=FA;var xG;const Dz=new Mi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let M1=xG=class extends Efe{constructor(...e){super(...e),this.color=new We([0,0,0,.25]),this.outline=new Qh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new xG({color:te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],M1.prototype,"color",void 0),u([d()],M1.prototype,"outline",void 0),u([mt({esriSFS:"simple-fill"},{readOnly:!0})],M1.prototype,"type",void 0),u([d({type:Dz.apiValues,json:{read:Dz.read,write:Dz.write}})],M1.prototype,"style",void 0),M1=xG=u([P("esri.symbols.SimpleFillSymbol")],M1);const f_=M1;var TG;const Lz=new Mi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Qp=TG=class extends eme{constructor(...e){super(...e),this.color=new We([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Qh}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=er(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new TG({angle:this.angle,color:te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],Qp.prototype,"color",void 0),u([He("color")],Qp.prototype,"writeColor",null),u([mt({esriSMS:"simple-marker"},{readOnly:!0})],Qp.prototype,"type",void 0),u([d()],Qp.prototype,"size",void 0),u([d({type:Lz.apiValues,json:{read:Lz.read,write:Lz.write}})],Qp.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Qp.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Qh}},json:{default:null,write:!0}})],Qp.prototype,"outline",void 0),Qp=TG=u([P("esri.symbols.SimpleMarkerSymbol")],Qp);const m_=Qp;var SG;let as=SG=class extends Ac{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new I5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return er(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new SG({angle:this.angle,backgroundColor:te(this.backgroundColor),borderLineColor:te(this.borderLineColor),borderLineSize:this.borderLineSize,color:te(this.color),font:this.font&&this.font.clone(),haloColor:te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:We,json:{write:!0}})],as.prototype,"backgroundColor",void 0),u([d({type:We,json:{write:!0}})],as.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],as.prototype,"borderLineSize",void 0),u([d({type:I5,json:{write:!0}})],as.prototype,"font",void 0),u([d(ye(F({},kfe),{json:{write:!0}}))],as.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],as.prototype,"kerning",void 0),u([d({type:We,json:{write:!0}})],as.prototype,"haloColor",void 0),u([d({type:Number,cast:er,json:{write:!0}})],as.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],as.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],as.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],as.prototype,"text",void 0),u([mt({esriTS:"text"},{readOnly:!0})],as.prototype,"type",void 0),u([d(ye(F({},zfe),{json:{write:!0}}))],as.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:er,json:{write:!0}})],as.prototype,"xoffset",void 0),u([d({type:Number,cast:er,json:{write:!0}})],as.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],as.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],as.prototype,"width",void 0),u([d({type:Number})],as.prototype,"lineWidth",void 0),u([He("lineWidth")],as.prototype,"writeLineWidth",null),u([Nt("lineWidth")],as.prototype,"castLineWidth",null),u([d(Ufe)],as.prototype,"lineHeight",void 0),u([He("lineHeight")],as.prototype,"writeLineHeight",null),as=SG=u([P("esri.symbols.TextSymbol")],as);const ME=as;var EG;const $De=de.getLogger("esri.symbols.WebStyleSymbol");let gd=EG=class extends Ac{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:Pl.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new EG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=_(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(_(i)){const a=i.get(r);if(a)return a.clone()}const s=await DDe();Wt(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{$De.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(_(i)&&i.set(r,o.clone()),o):null}};function DDe(){return import("./webStyleSymbolUtils.fa9a0626.js")}u([d({json:{write:!1}})],gd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"styleName",void 0),u([d({type:Pl,json:{write:!1}})],gd.prototype,"portal",void 0),u([d({type:String,json:{read:XW,write:jv}})],gd.prototype,"styleUrl",void 0),u([d({type:BM,json:{read:!1}})],gd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"name",void 0),u([mt({styleSymbolReference:"web-style"},{readOnly:!0})],gd.prototype,"type",void 0),u([d()],gd.prototype,"fetchCacheKey",null),gd=EG=u([P("esri.symbols.WebStyleSymbol")],gd);const ix=gd;function N5(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function vw(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Wb={base:Ac,key:"type",typeMap:{"simple-fill":f_,"picture-fill":nme,"picture-marker":L5,"simple-line":Qh,"simple-marker":m_,text:ME,"label-3d":$5,"line-3d":D5,"mesh-3d":eX,"point-3d":uv,"polygon-3d":y3,"web-style":ix,cim:EE},errorContext:"symbol"},LDe={base:Ac,key:"type",typeMap:{"picture-marker":L5,"simple-marker":m_,text:ME,"web-style":ix,cim:EE},errorContext:"symbol"},NDe=fE({types:Wb}),lme={base:Ac,key:"type",typeMap:{"simple-fill":f_,"picture-fill":nme,"picture-marker":L5,"simple-line":Qh,"simple-marker":m_,text:ME,"line-3d":D5,"mesh-3d":eX,"point-3d":uv,"polygon-3d":y3,"web-style":ix,cim:EE},errorContext:"symbol"},FDe={base:Ac,key:"type",typeMap:{text:ME,"label-3d":$5},errorContext:"symbol"},eee={base:Ac,key:"type",typeMap:{"line-3d":D5,"mesh-3d":eX,"point-3d":uv,"polygon-3d":y3,"web-style":ix,cim:EE},errorContext:"symbol"},UDe={base:Ac,key:"type",typeMap:{"label-3d":$5},errorContext:"symbol"},cme=up(Wb);function kDe(e){if(!e)return null;const t={};for(const i in e){const r=Wg(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function zDe(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let ql=class extends Ec(xe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:wl(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:zDe(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:F({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:kDe}})],ql.prototype,"aggregateGeometries",null),u([d({value:null})],ql.prototype,"attributes",null),u([d({value:null,types:Qw,json:{read:Wg}})],ql.prototype,"geometry",null),u([d({type:Boolean})],ql.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],ql.prototype,"layer",void 0),u([d({type:SE})],ql.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],ql.prototype,"sourceLayer",void 0),u([d({value:null,types:Wb})],ql.prototype,"symbol",null),u([d({type:Boolean,value:!0})],ql.prototype,"visible",null),ql=u([P("esri.Graphic")],ql),function(e){e.generateUID=wl}(ql||(ql={}));const Ga=ql;var CG;let f0=CG=class extends xe{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new CG({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function Nz(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Nz}}}}})],f0.prototype,"rotation",void 0),u([Nt("rotation")],f0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Nz}}}}})],f0.prototype,"scale",void 0),u([d({types:Qw,json:{read:Wg,write:!0,origins:{"web-scene":{read:Wg,write:{overridePolicy:Nz}}}}})],f0.prototype,"targetGeometry",void 0),u([d({type:wc,json:{write:!0}})],f0.prototype,"camera",void 0),f0=CG=u([P("esri.Viewpoint")],f0);const Bh=f0;class AG{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var xl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(xl||(xl={}));let VDe=0;function ume(){return VDe++}function BDe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function uF(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function hme(e,t,i,r){if(t.type===xl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==xl.INVOKE&&t.type!==xl.RESPONSE)return void e.postMessage(t);let s;BDe(i)?(s=tee(i.transferList),t.data=i.result):(s=tee(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function qO(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function tee(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!GDe(i));return t.length?t:null}function GDe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const jDe={statsWorker:()=>import("./statsWorker.4c9b72d2.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.6b706bcf.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.bfa1d417.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return Hmt}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.03f99e44.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.0f24045b.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.89ea364d.js"),LercWorker:()=>import("./LercWorker.65f0b53e.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.4ecdc3ea.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.735c4fb2.js"),Pipeline:()=>import("./Pipeline.34649e77.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.56b36ce7.js"),RasterWorker:()=>import("./RasterWorker.4c8d9249.js"),SceneLayerSnappingSourceWorker:()=>import("./SceneLayerSnappingSourceWorker.f8fa4f3c.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.13036660.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.fa1a6583.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.ae71a03f.js")},{CLOSE:iee,ABORT:ree,INVOKE:see,RESPONSE:nC,OPEN_PORT:nee,ON:HDe}=xl,qDe=2;class WDe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===xl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class dc{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new WDe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new dc(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),dc.clients.set(s,r),i.port2}static loadWorker(t){const i=jDe[t];return i?i():Promise.resolve(null)}close(){this._post({type:iee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new q("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=ume();return new Promise((a,l)=>{if(bs(s))return this._processWork(),void l(hi());const c=Fo(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),sn(p.abortHandle),this._post({type:ree,jobId:o}),l(hi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:see,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:xl.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:xl.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:nee,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=qDe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{sn(t.abortHandle),t.reject(hi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=qO(t);if(i)switch(i.type){case nC:this._onResponseMessage(i);break;case see:this._invokeQueue.push(i);break;case ree:this._onAbortMessage(i);break;case iee:this._onCloseMessage();break;case nee:this._onOpenPortMessage(i);break;case HDe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&dc.clients.get(this)===t&&t.destroy(),dc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:nC,jobId:r,error:uF(p)})}Fu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:nC,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Br(p)||this._post({type:nC,jobId:r,error:uF(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:nC,jobId:r},l)}_onOpenPortMessage(t){new dc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=o3(t.port,"message",n=>{qO(n).type===xl.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),sn(o.abortHandle),r?o.reject(q.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return hme(this._port,t,i,r)}}dc.kernelInfo={revision:$he,version:Dhe,buildDate:Ihe},dc.clients=new Map;const XDe=de.getLogger("esri.core.workers.Connection");class YDe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new AG}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{Wt(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Fu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new dc(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new dc(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(hi(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(XDe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=zv();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>u2(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const oee={};function ZDe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function QDe(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:F({},e.has),map:F({},e.map),packages:e.packages&&e.packages.concat()||[],paths:F({},e.paths)};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=oee.baseUrl),(i=oee.packages)==null||i.forEach(r=>{ZDe(t.packages,r)}),t}class JDe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class tL{constructor(){this._dispatcher=new JDe,this._workerPostMessage({type:xl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){p2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){p2(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=qO(t);if(i&&i.type===xl.OPEN){const{modulePath:r,jobId:s}=i;let n=await dc.loadWorker(r);n||(n=await import(r));const o=dc.connect(n);this._workerPostMessage({type:xl.OPENED,jobId:s,data:o})}}}const MG=de.getLogger("esri.core.workers"),{HANDSHAKE:KDe}=xl,eLe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let FP,UP;const aee="Failed to create Worker. Fallback to execute module in main thread";async function tLe(){if(!he("esri-workers")||(he("mozilla"),0))return lee(new tL);if(!FP&&!UP)try{const t=eLe.replace('"{CONFIGURATION}"',`'${iLe()}'`);FP=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){UP=t||{}}let e;if(FP)try{e=new Worker(FP,{name:"esri-worker-"+rLe++})}catch{MG.warn(aee,UP),e=new tL}else MG.warn(aee,UP),e=new tL;return lee(e)}async function lee(e){return new Promise(t=>{function i(s){const n=qO(s);n&&n.type===KDe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),MG.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new tL).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function iLe(){let e;if(ki.default!=null){const s=F({},ki);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(ki));e.assetsPath=_u(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Tu(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":he("esri-2d-query-centroid-enabled"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=_u(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=_u(e.workers.workerPath):e.workers.workerPath=_u(Ni("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=ki.workers.loaderConfig,i=QDe({baseUrl:t==null?void 0:t.baseUrl,locale:Tu(),has:F({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:F({},t==null?void 0:t.map),paths:F({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:Dhe,buildDate:Ihe,revision:$he};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let rLe=0;const sLe=de.getLogger("esri.core.workers"),{ABORT:cee,INVOKE:nLe,OPEN:oLe,OPENED:aLe,RESPONSE:oC}=xl;class tX{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),sLe.error(r)})}static async create(t){const i=await tLe();return new tX(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=ume();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:Yq(r,()=>{this._outJobs.delete(s),this._post({type:cee,jobId:s})})};this._outJobs.set(s,a),this._post({type:oLe,jobId:s,modulePath:t})})}_onMessage(t){const i=qO(t);if(i)switch(i.type){case aLe:this._onOpenedMessage(i);break;case oC:this._onResponseMessage(i);break;case cee:this._onAbortMessage(i);break;case nLe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=hMe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:oC,jobId:r,error:uF(h)})}Fu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:oC,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Br(h)||this._post({type:oC,jobId:r,error:uF(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:oC,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),sn(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),sn(n.abortHandle),r?n.reject(q.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return hme(this.worker,t,i,r)}}let Ob=he("esri-workers-debug")?1:he("host-browser")?navigator.hardwareConcurrency-1:0;Ob||(Ob=he("safari")&&he("mac")||he("trident")?7:2);let uee=0;const iL=[];function lLe(){pme()}async function kP(e,t){const i=new YDe;return await i.open(e,t),i}async function dme(e,t={}){if(typeof e!="string")throw new q("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(i="local"),i==="local"){let r=await dc.loadWorker(e);r||(r=await import(e)),Wt(t.signal);const s=t.client||r;return kP([dc.connect(r)],ye(F({},t),{client:s}))}if(await pme(),Wt(t.signal),i==="dedicated"){const r=uee++%Ob;return kP([await iL[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Ob);if(r<Ob){const s=new Array(r);for(let n=0;n<r;++n){const o=uee++%Ob;s[n]=iL[o].open(e,t)}return kP(s,t)}}return kP(iL.map(r=>r.open(e,t)),t)}let zP=null;async function pme(){if(zP)return zP;new AbortController;const e=[];for(let t=0;t<Ob;t++){const i=tX.create(t).then(r=>(iL[t]=r,r));e.push(i)}return zP=Promise.all(e),zP}let Df=class extends Ae{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new si,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,ae)}addWhen(e,t,i={}){return this._installWatch(e,t,i,Cl)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([oo(e,"after-changes",this._createSyncUpdatingCallback(),Qi),oo(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(M(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(VP)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=ae(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(VP),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(gE(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(VP))}),VP)}}};u([d({readOnly:!0})],Df.prototype,"updating",void 0),Df=u([P("esri.core.support.WatchUpdatingTracking")],Df);const VP=-42;var hee;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(hee||(hee={}));const Jh=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new si}get updatingHandles(){return this._get("updatingHandles")||new Df}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let E2=class extends Jh(Ae){};E2=u([P("esri.core.HandleOwner")],E2);de.getLogger("esri.core.support.OwningCollection");let GM=class extends Jh(ct){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{M(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ct.ofType(this.itemType.Type))(e):new ct(e)}};function hF(e,t){return{type:e,cast:Bfe,set(i){const r=Hv(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],GM.prototype,"owner",null),GM=u([P("esri.core.support.OwningCollection")],GM);function iX(e){return new Ze({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const fme=iX($i),dF=iX($f),pF=iX(qg),cLe=new Ze({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${$i.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function Il(e){return e&&(tm(e)||e===dF)?dF:e&&(im(e)||e===pF)?pF:fme}function Ai(e){return e&&(tm(e)||e===dF)?$f:e&&(im(e)||e===pF)?qg:$i}function bwt(e){return CW(e)?$f:AW(e)?qg:$i}const mme=39.37,uLe=$i.radius*Math.PI/200,gme=/UNIT\[([^\]]+)\]\]$/i,Xb=N,yme=/UNIT\[([^\]]+)\]/i,hLe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),dLe=da()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Sp=e=>e*e,Ty=e=>e*e*e,WO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Sp(.001)},"square-centimeters":{inBaseUnits:Sp(.01)},"square-decimeters":{inBaseUnits:Sp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Sp(1e3)},"square-inches":{inBaseUnits:Sp(.0254)},"square-feet":{inBaseUnits:Sp(.3048)},"square-yards":{inBaseUnits:Sp(.9144)},"square-miles":{inBaseUnits:Sp(1609.344)},"square-us-feet":{inBaseUnits:Sp(1200/3937)},acres:{inBaseUnits:.0015625*Sp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Ty(.001)},"cubic-centimeters":{inBaseUnits:1e3*Ty(.01)},"cubic-decimeters":{inBaseUnits:1e3*Ty(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Ty(1e3)},"cubic-inches":{inBaseUnits:1e3*Ty(.0254)},"cubic-feet":{inBaseUnits:1e3*Ty(.3048)},"cubic-yards":{inBaseUnits:1e3*Ty(.9144)},"cubic-miles":{inBaseUnits:1e3*Ty(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},pLe=(()=>{const e={};for(const t in WO)for(const i in WO[t].units)e[i]=t;return e})();function fLe(e,t,i){return e*WO[i].units[t].inBaseUnits}function mLe(e,t,i){return e/WO[i].units[t].inBaseUnits}const gLe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function OG(e){const t=pLe[e];if(!t)throw new Error("unknown type");return t}function dee(e,t=null){return t=t||OG(e),WO[t].baseUnit===e}function Is(e,t,i){if(t===i)return e;const r=OG(t);if(r!==OG(i))throw new Error("incompatible units");const s=dee(t,r)?e:fLe(e,t,r);return dee(i,r)?s:mLe(s,i,r)}function yLe(e,t){const i=Is(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function vLe(e,t){const i=Is(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function _Le(e,t){const i=Is(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function bLe(e,t){const i=Is(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function wwt(e,t){const i=Is(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function xwt(e,t){const i=Is(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function wLe(e,t,i){return Is(e,t,"meters")/(i*Math.PI/180)}function vme(e){return dLe.fromJSON(e.toLowerCase())||null}function _w(e){if(e&&typeof e=="object"&&!NO(e))return 1;const t=Nl(e);return t>1e5?1:t}function xLe(e){return Nl(e)>=(e instanceof Ze?Ai(e).metersPerDegree:1e5)?"meters":rX(e)}function Nl(e,t=$i.metersPerDegree){return _t(TLe(e,!0),t)}function TLe(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(CW(i))return $f.metersPerDegree;if(AW(i))return qg.metersPerDegree;s=Xb.values[Xb[i]],!s&&t&&hLe.has(i)&&(s=uLe)}else r&&(wme(r)?s=pee(gme.exec(r),s):bme(r)&&(s=pee(yme.exec(r),s)));return s}function pee(e,t){return e&&e[1]?_me(e[1]):t}function _me(e){return parseFloat(e.split(",")[1])}function rX(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=Xb.units[Xb[t]];else if(i){const s=wme(i)?gme:bme(i)?yme:null;if(s){const n=s.exec(i);n&&n[1]&&(r=ELe(n[1]))}}return _(r)?vme(r):null}function Twt(e){const t=rX(e);return M(t)||!gLe.includes(t)?null:t}function bme(e){return/^GEOCCS/i.test(e)}function wme(e){return/^PROJCS/i.test(e)}const SLe=1e-7;function ELe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!Xb.units.includes(i)){const r=_me(e);i=null;const s=Xb.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<SLe){i=Xb.units[n];break}}return i}function CLe(e){const t=rX(e);if(M(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function Swt(e){var s,n,o;const t="metric";if(M(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return _t(CLe(e.spatialReference),t)}const xme={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Tme={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},ALe=da()(xme),MLe=da()(Tme);da()(F(F({},xme),Tme));var UA;const fF=da()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Sme=fF.jsonValues.slice();J4(Sme,"orthometric");const jM=da()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let yd=UA=class extends xe{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return fF.write(e,t,i)}readHeightModel(e,t,i){return fF.read(e)||(i&&i.messages&&i.messages.push(OLe(e,{context:i})),null)}readHeightUnit(e,t,i){return jM.read(e)||(i&&i.messages&&i.messages.push(fee(e,{context:i})),null)}readHeightUnitService(e,t,i){return vme(e)||jM.read(e)||(i&&i.messages&&i.messages.push(fee(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new UA({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=xLe(t);return new UA({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=F({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new UA;return t.read(e,{origin:"web-scene"}),t}};function fee(e,t){return new Pu("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function OLe(e,t){return new Pu("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:fF.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Sme,default:"ellipsoidal"}}}})],yd.prototype,"heightModel",void 0),u([He("web-scene","heightModel")],yd.prototype,"writeHeightModel",null),u([Ie(["web-scene","service"],"heightModel")],yd.prototype,"readHeightModel",null),u([d({type:jM.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:jM.jsonValues,write:jM.write}}}})],yd.prototype,"heightUnit",void 0),u([Ie("web-scene","heightUnit")],yd.prototype,"readHeightUnit",null),u([Ie("service","heightUnit")],yd.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],yd.prototype,"vertCRS",void 0),u([Ie("service","vertCRS",["vertCRS","ellipsoid","geoid"])],yd.prototype,"readVertCRS",null),yd=UA=u([P("esri.geometry.HeightModelInfo")],yd);const rx=yd;function ws(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sm(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,b){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=v,e[15]=b,e}function Wf(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $l(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Xr(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],b=t[14],w=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,L=h*v-p*y,D=h*b-f*y,k=h*w-m*y,z=p*b-f*v,V=p*w-m*v,X=f*w-m*b;let Y=S*X-T*V+E*z+C*k-A*D+I*L;return Y?(Y=1/Y,e[0]=(a*X-l*V+c*z)*Y,e[1]=(s*V-r*X-n*z)*Y,e[2]=(v*I-b*A+w*C)*Y,e[3]=(f*A-p*I-m*C)*Y,e[4]=(l*k-o*X-c*D)*Y,e[5]=(i*X-s*k+n*D)*Y,e[6]=(b*E-y*I-w*T)*Y,e[7]=(h*I-f*E+m*T)*Y,e[8]=(o*V-a*k+c*L)*Y,e[9]=(r*k-i*V-n*L)*Y,e[10]=(y*A-v*E+w*S)*Y,e[11]=(p*E-h*A-m*S)*Y,e[12]=(a*D-o*z-l*L)*Y,e[13]=(i*z-r*D+s*L)*Y,e[14]=(v*T-y*C-b*S)*Y,e[15]=(h*C-p*T+f*S)*Y,e):null}function RLe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],b=t[14],w=t[15];return e[0]=a*(f*w-m*b)-p*(l*w-c*b)+v*(l*m-c*f),e[1]=-(r*(f*w-m*b)-p*(s*w-n*b)+v*(s*m-n*f)),e[2]=r*(l*w-c*b)-a*(s*w-n*b)+v*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*w-m*b)-h*(l*w-c*b)+y*(l*m-c*f)),e[5]=i*(f*w-m*b)-h*(s*w-n*b)+y*(s*m-n*f),e[6]=-(i*(l*w-c*b)-o*(s*w-n*b)+y*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*w-m*v)-h*(a*w-c*v)+y*(a*m-c*p),e[9]=-(i*(p*w-m*v)-h*(r*w-n*v)+y*(r*m-n*p)),e[10]=i*(a*w-c*v)-o*(r*w-n*v)+y*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*b-f*v)-h*(a*b-l*v)+y*(a*f-l*p)),e[13]=i*(p*b-f*v)-h*(r*b-s*v)+y*(r*f-s*p),e[14]=-(i*(a*b-l*v)-o*(r*b-s*v)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function PLe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],v=e[14],b=e[15];return(t*o-i*n)*(p*b-f*v)-(t*a-r*n)*(h*b-f*y)+(t*l-s*n)*(h*v-p*y)+(i*a-r*o)*(c*b-f*m)-(i*l-s*o)*(c*v-p*m)+(r*l-s*a)*(c*y-h*m)}function Dr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],v=t[12],b=t[13],w=t[14],S=t[15];let T=i[0],E=i[1],C=i[2],A=i[3];return e[0]=T*r+E*a+C*p+A*v,e[1]=T*s+E*l+C*f+A*b,e[2]=T*n+E*c+C*m+A*w,e[3]=T*o+E*h+C*y+A*S,T=i[4],E=i[5],C=i[6],A=i[7],e[4]=T*r+E*a+C*p+A*v,e[5]=T*s+E*l+C*f+A*b,e[6]=T*n+E*c+C*m+A*w,e[7]=T*o+E*h+C*y+A*S,T=i[8],E=i[9],C=i[10],A=i[11],e[8]=T*r+E*a+C*p+A*v,e[9]=T*s+E*l+C*f+A*b,e[10]=T*n+E*c+C*m+A*w,e[11]=T*o+E*h+C*y+A*S,T=i[12],E=i[13],C=i[14],A=i[15],e[12]=T*r+E*a+C*p+A*v,e[13]=T*s+E*l+C*f+A*b,e[14]=T*n+E*c+C*m+A*w,e[15]=T*o+E*h+C*y+A*S,e}function ca(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],v=t[9],b=t[10],w=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=v,e[10]=b,e[11]=w,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+v*n+t[13],e[14]=l*r+f*s+b*n+t[14],e[15]=c*r+m*s+w*n+t[15]}return e}function v3(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vl(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,y,v,b,w,S,T,E,C,A,I,L,D,k,z,V=r[0],X=r[1],Y=r[2],le=Math.sqrt(V*V+X*X+Y*Y);return le<Ct?null:(le=1/le,V*=le,X*=le,Y*=le,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],v=t[8],b=t[9],w=t[10],S=t[11],T=V*V*o+n,E=X*V*o+Y*s,C=Y*V*o-X*s,A=V*X*o-Y*s,I=X*X*o+n,L=Y*X*o+V*s,D=V*Y*o+X*s,k=X*Y*o-V*s,z=Y*Y*o+n,e[0]=a*T+p*E+v*C,e[1]=l*T+f*E+b*C,e[2]=c*T+m*E+w*C,e[3]=h*T+y*E+S*C,e[4]=a*A+p*I+v*L,e[5]=l*A+f*I+b*L,e[6]=c*A+m*I+w*L,e[7]=h*A+y*I+S*L,e[8]=a*D+p*k+v*z,e[9]=l*D+f*k+b*z,e[10]=c*D+m*k+w*z,e[11]=h*D+y*k+S*z,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function C2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function F5(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function A2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function U5(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Eme(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tc(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Ct?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Cme(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ILe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ame(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mme(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,v=n*c,b=o*a,w=o*l,S=o*c;return e[0]=1-(m+v),e[1]=p+S,e[2]=f-w,e[3]=0,e[4]=p-S,e[5]=1-(h+v),e[6]=y+b,e[7]=0,e[8]=f+w,e[9]=y-b,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $Le(e,t){const i=DLe,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),Mme(e,t,i),e}const DLe=R();function LLe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Ome(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function NLe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function FLe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,v=n*h,b=o*h,w=a*l,S=a*c,T=a*h,E=r[0],C=r[1],A=r[2];return e[0]=(1-(y+b))*E,e[1]=(f+T)*E,e[2]=(m-S)*E,e[3]=0,e[4]=(f-T)*C,e[5]=(1-(p+b))*C,e[6]=(v+w)*C,e[7]=0,e[8]=(m+S)*A,e[9]=(v-w)*A,e[10]=(1-(p+y))*A,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ULe(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,v=o*h,b=o*p,w=a*p,S=l*c,T=l*h,E=l*p,C=r[0],A=r[1],I=r[2],L=s[0],D=s[1],k=s[2],z=(1-(v+w))*C,V=(m+E)*C,X=(y-T)*C,Y=(m-E)*A,le=(1-(f+w))*A,re=(b+S)*A,$=(y+T)*I,U=(b-S)*I,B=(1-(f+v))*I;return e[0]=z,e[1]=V,e[2]=X,e[3]=0,e[4]=Y,e[5]=le,e[6]=re,e[7]=0,e[8]=$,e[9]=U,e[10]=B,e[11]=0,e[12]=i[0]+L-(z*L+Y*D+$*k),e[13]=i[1]+D-(V*L+le*D+U*k),e[14]=i[2]+k-(X*L+re*D+B*k),e[15]=1,e}function kLe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[1]=h+w,e[2]=f-b,e[3]=0,e[4]=h-w,e[5]=1-c-y,e[6]=m+v,e[7]=0,e[8]=f+b,e[9]=m-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Rme(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function zLe(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function VLe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function sX(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function k5(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const y=t[0],v=t[1],b=t[2],w=r[0],S=r[1],T=r[2],E=i[0],C=i[1],A=i[2];return Math.abs(y-E)<Ct&&Math.abs(v-C)<Ct&&Math.abs(b-A)<Ct?Wf(e):(h=y-E,p=v-C,f=b-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-w*f,o=w*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*v+o*b),e[13]=-(a*y+l*v+c*b),e[14]=-(h*y+p*v+f*b),e[15]=1,e)}function Pme(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,v=c*h-a*f,b=a*p-l*h;return m=y*y+v*v+b*b,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,b*=m),e[0]=y,e[1]=v,e[2]=b,e[3]=0,e[4]=p*b-f*v,e[5]=f*y-h*b,e[6]=h*v-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function BLe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function GLe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function jLe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Ime(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function HLe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function qLe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function $me(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function nX(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],v=e[13],b=e[14],w=e[15],S=t[0],T=t[1],E=t[2],C=t[3],A=t[4],I=t[5],L=t[6],D=t[7],k=t[8],z=t[9],V=t[10],X=t[11],Y=t[12],le=t[13],re=t[14],$=t[15];return Math.abs(i-S)<=Ct*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=Ct*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-E)<=Ct*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-C)<=Ct*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-A)<=Ct*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=Ct*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-L)<=Ct*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-D)<=Ct*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-k)<=Ct*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-z)<=Ct*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(f-V)<=Ct*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-X)<=Ct*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(y-Y)<=Ct*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(v-le)<=Ct*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(b-re)<=Ct*Math.max(1,Math.abs(b),Math.abs(re))&&Math.abs(w-$)<=Ct*Math.max(1,Math.abs(w),Math.abs($))}function oX(e){const t=Ct,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const WLe=Dr,XLe=Ime;Object.freeze(Object.defineProperty({__proto__:null,copy:ws,set:sm,identity:Wf,transpose:$l,invert:Xr,adjoint:RLe,determinant:PLe,multiply:Dr,translate:ca,scale:v3,rotate:vl,rotateX:C2,rotateY:F5,rotateZ:A2,fromTranslation:U5,fromScaling:Eme,fromRotation:Tc,fromXRotation:Cme,fromYRotation:ILe,fromZRotation:Ame,fromRotationTranslation:Mme,fromQuat2:$Le,getTranslation:LLe,getScaling:Ome,getRotation:NLe,fromRotationTranslationScale:FLe,fromRotationTranslationScaleOrigin:ULe,fromQuat:kLe,frustum:Rme,perspective:zLe,perspectiveFromFieldOfView:VLe,ortho:sX,lookAt:k5,targetTo:Pme,str:BLe,frob:GLe,add:jLe,subtract:Ime,multiplyScalar:HLe,multiplyScalarAndAdd:qLe,exactEquals:$me,equals:nX,isOrthoNormal:oX,mul:WLe,sub:XLe},Symbol.toStringTag,{value:"Module"}));let Fz,se=null;function Dme(){return!!se}function YLe(){return!!he("esri-wasm")}function Lme(){return Fz||(Fz=import("./pe-wasm.41ba155b.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>Ni(`esri/geometry/support/${t}`)})).then(e=>{Fme(e)}),Fz)}var RG,cs,PG;(function(e){function t(n,o,a){se.ensureCache.prepare();const l=fb(a),c=a===l,h=se.ensureFloat64(l),p=se._pe_geog_to_proj(se.getPointer(n),o,h);return p&&Z0(a,o,h,c),p}function i(n,o,a,l){switch(l){case cs.PE_TRANSFORM_P_TO_G:return r(n,o,a);case cs.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){se.ensureCache.prepare();const c=fb(a),h=a===c,p=se.ensureFloat64(c),f=se._pe_proj_to_geog_center(se.getPointer(n),o,p,l);return f&&Z0(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(RG||(RG={})),function(e){function t(){e.PE_BUFFER_MAX=se.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=se.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=se.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=se.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=se.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=se.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=se.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=se.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=se.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=se.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=se.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=se.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=se.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=se.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=se.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=se.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=se.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=se.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=se.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=se.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=se.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=se.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=se.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=se.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=se.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=se.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=se.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=se.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=se.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=se.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(cs||(cs={})),function(e){const t={},i={},r=m=>{if(m){const y=m.getType();switch(y){case cs.PE_TYPE_GEOGCS:m=se.castObject(m,se.PeGeogcs);break;case cs.PE_TYPE_PROJCS:m=se.castObject(m,se.PeProjcs);break;case cs.PE_TYPE_GEOGTRAN:m=se.castObject(m,se.PeGeogtran);break;default:y&cs.PE_TYPE_UNIT&&(m=se.castObject(m,se.PeUnit))}}return m};function s(){se.PeFactory.prototype.initialize(null)}function n(m){return o(cs.PE_TYPE_COORDSYS,m)}function o(m,y){let v=null,b=t[m];if(b||(b={},t[m]=b),b.hasOwnProperty(String(y)))v=b[y];else{const w=se.PeFactory.prototype.factoryByType(m,y);se.compare(w,se.NULL)||(v=w,b[y]=v)}return v=r(v),v}function a(m,y){let v=null,b=i[m];if(b||(b={},i[m]=b),b.hasOwnProperty(y))v=b[y];else{const w=se.PeFactory.prototype.fromString(m,y);se.compare(w,se.NULL)||(v=w,b[y]=v)}return v=r(v),v}function l(m){return o(cs.PE_TYPE_GEOGCS,m)}function c(m){return o(cs.PE_TYPE_GEOGTRAN,m)}function h(m){return se.PeFactory.prototype.getCode(m)}function p(m){return o(cs.PE_TYPE_PROJCS,m)}function f(m){return o(cs.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(PG||(PG={}));let Nme=null;var mF,IG,$G,DG,gF,LG,yF,vF,NG;function Fme(e){function t(n,o,a){n[o]=a(n[o])}se=e,cs.init(),mF.init(),gF.init(),yF.init(),vF.init(),Nme=class extends se.PeGCSExtent{destroy(){se.destroy(this)}};const i=[se.PeDatum,se.PeGeogcs,se.PeGeogtran,se.PeObject,se.PeParameter,se.PePrimem,se.PeProjcs,se.PeSpheroid,se.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(cs.PE_NAME_MAX))});for(const n of[se.PeGeogtran,se.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(cs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=se.getValue(l,"*");a[c]=h?se.wrapPointer(h,se.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(se.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Z0(a,o,n.call(this)),a}),t(se.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=se._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!se.compare(l,se.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=se.getPointer(l);for(let p=1;p<c;p++)a.push(se.wrapPointer(h+o*p,se.PeGTlistExtendedGTs))}}return a}});const r=se._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!se.compare(l,se.NULL)){a=[l];const c=l.getNump();if(c>1){const h=se.getPointer(l);for(let p=1;p<c;p++)a.push(se.wrapPointer(h+r*p,se.PeHorizon))}}return o.set(n,a),a};t(se.PeProjcs.prototype,"horizonGcsGenerate",s),t(se.PeProjcs.prototype,"horizonPcsGenerate",s),se.PeObject.prototype.toString=function(n=cs.PE_STR_OPTS_NONE){se.ensureCache.prepare();const o=se.getPointer(this),a=se.ensureInt8(new Array(cs.PE_BUFFER_MAX));return se.UTF8ToString(se._pe_object_to_string_ext(o,n,a))}}function mm(e){if(!e)return;const t=se.getClass(e);if(!t)return;const i=se.getCache(t);if(!i)return;const r=se.getPointer(e);r&&delete i[r]}function BP(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(se.ensureInt8(r));return i}function fb(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function Z0(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=se.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=se.getValue(i,"double"),e[n][1]=se.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=se.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=se._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new se.PeInteger(c);try{const f=se.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=se.getPointer(f);for(let y=1;y<c;y++)h.push(se.wrapPointer(m+t*y,se.PeGTlistExtendedEntry))}}finally{se.destroy(p)}return h}e.init=i,e.getGTlist=r})(mF||(mF={})),function(e){function t(i){if(i&&i.length){for(const r of i)mm(r),r.getEntries().forEach(s=>{mm(s);const n=s.getGeogtran();mm(n),n.getParameters().forEach(mm),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{mm(o);const a=o.getDatum();mm(a),mm(a.getSpheroid()),mm(o.getPrimem()),mm(o.getUnit())})});se.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(IG||(IG={})),function(e){function t(i,r,s,n,o){se.ensureCache.prepare();const a=fb(s),l=s===a,c=se.ensureFloat64(a);let h=0;n&&(h=se.ensureFloat64(n));const p=se._pe_geog_to_geog(se.getPointer(i),r,c,h,o);return p&&Z0(s,r,c,l),p}e.geogToGeog=t}($G||($G={})),function(e){const t=(c,h,p,f,m,y)=>{let v,b;switch(se.ensureCache.prepare(),c){case"dd":v=se._pe_geog_to_dd,b=cs.PE_DD_MAX;break;case"ddm":v=se._pe_geog_to_ddm,b=cs.PE_DDM_MAX;break;case"dms":v=se._pe_geog_to_dms,b=cs.PE_DMS_MAX}let w=0;h&&(w=se.getPointer(h));const S=fb(f),T=se.ensureFloat64(S),E=BP(p,b),C=v(w,p,T,m,se.ensureInt32(E));if(C)for(let A=0;A<p;A++)y[A]=se.UTF8ToString(E[A]);return C},i=(c,h,p,f,m)=>{let y;switch(se.ensureCache.prepare(),c){case"dd":y=se._pe_dd_to_geog;break;case"ddm":y=se._pe_ddm_to_geog;break;case"dms":y=se._pe_dms_to_geog}let v=0;h&&(v=se.getPointer(h));const b=f.map(E=>se.ensureString(E)),w=se.ensureInt32(b),S=se.ensureFloat64(new Array(2*p)),T=y(v,p,w,S);return T&&Z0(m,p,S),T};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(DG||(DG={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=se.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=se.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=se.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=se.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=se.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){se.ensureCache.prepare();let p=0;s&&(p=se.getPointer(s));const f=fb(o),m=se.ensureFloat64(f),y=BP(n,cs.PE_MGRS_MAX),v=se.ensureInt32(y),b=se._pe_geog_to_mgrs_extended(p,n,m,a,l,c,v);if(b)for(let w=0;w<n;w++)h[w]=se.UTF8ToString(y[w]);return b}function r(s,n,o,a,l){se.ensureCache.prepare();let c=0;s&&(c=se.getPointer(s));const h=o.map(y=>se.ensureString(y)),p=se.ensureInt32(h),f=se.ensureFloat64(new Array(2*n)),m=se._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&Z0(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(gF||(gF={})),function(e){function t(r,s,n,o,a,l,c){se.ensureCache.prepare();let h=0;r&&(h=se.getPointer(r));const p=fb(n),f=se.ensureFloat64(p),m=BP(s,cs.PE_MGRS_MAX),y=se.ensureInt32(m),v=se._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let b=0;b<s;b++)c[b]=se.UTF8ToString(m[b]);return v}function i(r,s,n,o){se.ensureCache.prepare();let a=0;r&&(a=se.getPointer(r));const l=n.map(f=>se.ensureString(f)),c=se.ensureInt32(l),h=se.ensureFloat64(new Array(2*s)),p=se._pe_usng_to_geog(a,s,c,h);return p&&Z0(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(LG||(LG={})),function(e){function t(){e.PE_UTM_OPTS_NONE=se.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=se.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=se.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){se.ensureCache.prepare();let c=0;s&&(c=se.getPointer(s));const h=fb(o),p=se.ensureFloat64(h),f=BP(n,cs.PE_UTM_MAX),m=se.ensureInt32(f),y=se._pe_geog_to_utm(c,n,p,a,m);if(y)for(let v=0;v<n;v++)l[v]=se.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){se.ensureCache.prepare();let c=0;s&&(c=se.getPointer(s));const h=o.map(y=>se.ensureString(y)),p=se.ensureInt32(h),f=se.ensureFloat64(new Array(2*n)),m=se._pe_utm_to_geog(c,n,p,a,f);return m&&Z0(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(yF||(yF={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=se.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=se.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=se.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=se.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=se.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(vF||(vF={})),function(e){function t(){return se.PeVersion.prototype.version_string()}e.versionString=t}(NG||(NG={}));const ZLe=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return se},isLoaded:Dme,isSupported:YLe,load:Lme,get PeCSTransformations(){return RG},get PeDefs(){return cs},get PeFactory(){return PG},get PeGCSExtent(){return Nme},get PeGTlistExtended(){return mF},get PeGTlistExtendedEntry(){return IG},get PeGTTransformations(){return $G},get PeNotationDms(){return DG},get PeNotationMgrs(){return gF},get PeNotationUsng(){return LG},get PeNotationUtm(){return yF},get PePCSInfo(){return vF},get PeVersion(){return NG},_init:Fme},Symbol.toStringTag,{value:"Module"})),Ewt=Math.PI/180,Cwt=/SPHEROID\[([^\]]+)]/i,Sy=$i.radius,sd=$i.eccentricitySquared,QLe={a1:Sy*sd,a2:Sy*sd*Sy*sd,a3:Sy*sd*sd/2,a4:Sy*sd*Sy*sd*2.5,a5:Sy*sd+Sy*sd*sd/2,a6:1-sd},Awt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:$i.radius,f:$i.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:qg.radius,f:qg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:$f.radius,f:$f.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:$f.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let GP=0;class GS{constructor(t=null){this.uid=GP++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new GS;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=GP++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=GP++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=GP++}getInverse(){const t=new GS;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class hv{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof GS?this.steps.push(i):this.steps.push(new GS({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new hv;let r="";for(const s of t.steps){const n=GS.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new hv;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[hv.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[hv.cacheKey(t,i)];return s===void 0?null:s}}function Ume(e,t,i){if(M(t)||M(i)||i.vcsWkid||Cc(t,i))return null;const r=_w(t)/_w(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>JLe(s,r);case"polyline":case"esriGeometryPolyline":return s=>eNe(s,r);case"polygon":case"esriGeometryPolygon":return s=>KLe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>tNe(s,r);case"extent":case"esriGeometryExtent":return s=>iNe(s,r);default:return null}}function JLe(e,t){e&&e.z!=null&&(e.z*=t)}function KLe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function eNe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function tNe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function iNe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let Av=null,_F=null,Uz=null,kz={};const kme=new tde;function aX(){return!!Av&&Dme()}function bF(e){return M(Uz)&&(Uz=Promise.all([Lme(),import("./geometryEngineBase.f43341a0.js").then(t=>t.g),import("./hydrated.30d56e91.js")])),Uz.then(([,t,{hydratedAdapter:i}])=>{Wt(e),_F=i,Av=t.default,Av._enableProjection(ZLe),kme.notify()})}function OE(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:mee(_F,e,e[0].spatialReference,t,i,r):mee(_F,[e],e.spatialReference,t,i,r)[0]}function mee(e,t,i,r,s=null,n=null){if(M(i)||M(r))return t;if(qv(i,r,s))return t.map(o=>zme(o,i,r));if(M(s)){const o=hv.cacheKey(i,r);kz[o]!==void 0?s=kz[o]:(s=rNe(i,r,null),M(s)&&(s=new hv),kz[o]=s)}if(M(Av))throw new lX;return _(n)?Av._project(e,t,i,r,s,n):Av._project(e,t,i,r,s)}function rL(e,t){return M(e)?{pending:null,geometry:null}:Cc(e.spatialReference,t)?{pending:null,geometry:e}:Ml(e.spatialReference)&&Ml(t)?qv(e.spatialReference,t)||aX()?{pending:null,geometry:sNe(e,t)}:(ei(kme),{pending:bF(),geometry:null}):{pending:null,geometry:null}}function rNe(e,t,i=null){if(M(Av))throw new lX;if(M(e)||M(t))return null;const r=Av._getTransformation(_F,e,t,i,i==null?void 0:i.spatialReference);return r!==null?hv.fromGE(r):null}class lX extends q{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function sNe(e,t){try{const i=OE(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=Ume(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof lX))throw i;return null}}function qv(e,t,i){return!i&&(!!Cc(e,t)||Ml(e)&&Ml(t)&&!!dX(e,t,fX))}async function nNe(e,t,i,r){if(aX())return VJ(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!qv(s,n,o))return bF(r)}else if(!qv(e,t,i))return bF(r);return VJ(r)}function Mwt(e,t){switch(dX(e,t,fX)){case yr:return"copy3";case pv:return"wgs84ToSphericalECEF";case bw:return"wgs84ToWebMercator";case dv:return"wgs84ToPlateCarree";case mv:return"wgs84ToWGS84ECEF";case Yb:return"webMercatorToWGS84";case qme:return"webMercatorToSphericalECEF";case Wme:return"webMercatorToWGS84ECEF";case Xme:return"webMercatorToPlateCarree";case gv:return"wgs84ECEFToWGS84";case Qme:return"wgs84ECEFToSphericalECEF";case Jme:return"wgs84ECEFToWebMercator";case fv:return"sphericalECEFToWGS84";case Yme:return"sphericalECEFToWebMercator";case zG:return"sphericalMarsPCPFToMars2000";case kG:return"sphericalMoonPCPFToMoon2000";case Zme:return"sphericalECEFToWGS84ECEF";case UG:return"mars2000ToSphericalPCPF";case FG:return"moon2000ToSphericalPCPF";default:return null}}function zme(e,t,i){return e?"x"in e?Vme(e,t,new qe,i,0):"xmin"in e?cNe(e,t,new Xt,i,0):"rings"in e?Bme(e,t,new la,i,0):"paths"in e?lNe(e,t,new wu,i,0):"points"in e?aNe(e,t,new Zw,i,0):null:null}function oNe(e,t,i=t.spatialReference,r=0){return!M(i)&&_(Vme(e,e.spatialReference,t,i,r))}function Vme(e,t,i,r,s){Bi[0]=e.x,Bi[1]=e.y;const n=e.z;return Bi[2]=n!==void 0?n:s,tr(Bi,t,0,Bi,r,0,1)?(i.x=Bi[0],i.y=Bi[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=Bi[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function aNe(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!tr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function lNe(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return jme(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function Owt(e,t,i=t.spatialReference,r=0){return _(i)&&_(Bme(e,e.spatialReference,t,i,r))}function Bme(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return jme(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function cNe(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return gee(n,o,c?e.zmin:s,t,Bi,r)?(i.xmin=Bi[0],i.ymin=Bi[1],c&&(i.zmin=Bi[2]),gee(a,l,c?e.zmax:s,t,Bi,r)?(i.xmax=Bi[0],i.ymax=Bi[1],c&&(i.zmax=Bi[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function Wv(e,t,i){if(M(t)||M(i))return null;const r=new qe({spatialReference:i});return tr(e,t,0,Bi,i,0,1)?(r.x=Bi[0],r.y=Bi[1],r.z=Bi[2],r):null}function Gme(e,t,i){return tr(e,t,0,Bi,i.spatialReference,0,1)?(i.x=Bi[0],i.y=Bi[1],i.z=Bi[2],i):null}function Gr(e,t,i,r=0){Bi[0]=e.x,Bi[1]=e.y;const s=e.z;return Bi[2]=s!==void 0?s:r,tr(Bi,e.spatialReference,0,t,i,0,1)}function gee(e,t,i,r,s,n){return qr[0]=e,qr[1]=t,qr[2]=i,tr(qr,r,0,s,n,0,1)}function nn(e,t,i,r){return!(M(t)||M(r)||e.length<2)&&(e.length===2&&(qr[0]=e[0],qr[1]=e[1],qr[2]=0,e=qr),tr(e,t,0,i,r,0,1))}function uNe(e,t){Bi[0]=e.x,Bi[1]=e.y;const i=e.z;return Bi[2]=i!==void 0?i:0,hNe(Bi,e.spatialReference,t)}function hNe(e,t,i){return dNe(e,t,i)}function dNe(e,t,i){if(M(t))return!1;const r=Xv(t,V5),s=Pf[r][J.WGS84_COMPARABLE_LON_LAT];return!M(s)&&(s(e,0,qr,0),i!==qr&&(i[0]=qr[0],i[1]=qr[1],i.length>2&&(i[2]=qr[2])),!0)}function tr(e,t,i,r,s,n,o=1){const a=dX(t,s,fX);if(M(a))return!1;if(a===yr){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function Rwt(e,t,i,r,s){ne(Bi,e),pe(jP,e,t),nn(Bi,i,Bi,s),nn(jP,i,jP,s),fe(r,jP,Bi),we(r,r)}function jme(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!tr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function pNe(e,t,i,r){if(M(t)||M(r))return!1;const s=Kme(t,r,wNe);if(s.projector===yr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(M(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===J.WEB_MERCATOR){const a=Pf[n.spatialReferenceId][J.WGS84];return!M(a)&&(a(e,0,Nd,0),bw(Nd,0,i,0),i[3]=yee(Nd[1],e[2],e[3],$i.radius),!0)}if(n.spatialReferenceId!==J.WGS84&&n.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=Pf[n.spatialReferenceId][J.SPHERICAL_ECEF],l=Pf[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=yee(e[1],e[2],e[3],$i.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function yee(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(Kd*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function z5(e,t,i,r){return e!=null&&(Cc(t,r)?(Xg(i,e),!0):(qr[0]=e[0],qr[1]=e[1],qr[2]=0,!!tr(qr,t,0,qr,r,0,1)&&(i[0]=qr[0],i[1]=qr[1],qr[0]=e[2],qr[1]=e[3],qr[2]=0,!!tr(qr,t,0,qr,r,0,1)&&(i[2]=qr[0],i[3]=qr[1],!0))))}function Pwt(e,t,i,r){if(M(t)||M(r))return!1;const s=Xv(t,V5),n=Xv(r,ege);if(s===n&&s!==J.UNKNOWN||Cc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===J.SPHERICAL_ECEF){const o=Re(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/$i.radius;if(n===J.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===J.WGS84||n===J.CGCS2000){const c=HM;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===J.PLATE_CARREE){if(n===J.WGS84||n===J.CGCS2000)return i[0]=HM,i[1]=HM,i[2]=1,!0;if(n===J.WEB_MERCATOR){const o=e[1]/$i.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function ua(e,t,i,r){if(M(e)||M(r))return!1;const s=Xv(e,V5),n=Xv(r,ege);if(s===n&&!vee(n)&&(s!==J.UNKNOWN||Cc(e,r)))return U5(i,t),!0;if(vee(n)){const o=Pf[s][J.LON_LAT],a=Pf[J.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,Nd,0),a(Nd,0,Ey,0),Hme(Kd*Nd[0],Kd*Nd[1],i),i[12]=Ey[0],i[13]=Ey[1],i[14]=Ey[2],!0)}if((n===J.WEB_MERCATOR||n===J.PLATE_CARREE)&&(s===J.WGS84||s===J.CGCS2000&&n===J.PLATE_CARREE||s===J.SPHERICAL_ECEF||s===J.WEB_MERCATOR)){const o=Pf[s][J.LON_LAT],a=Pf[J.LON_LAT][n];return!M(o)&&!M(a)&&(o(t,0,Nd,0),a(Nd,0,Ey,0),s===J.SPHERICAL_ECEF?fNe(Kd*Nd[0],Kd*Nd[1],i):Wf(i),i[12]=Ey[0],i[13]=Ey[1],i[14]=Ey[2],!0)}return!1}function vee(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function Hme(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function fNe(e,t,i){return Hme(e,t,i),$l(i,i),i}function Xv(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Nl(e,1)),e.wkt===fme.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:FO(e)?t.spatialReferenceId=J.WGS84:Gv(e)?t.spatialReferenceId=J.WEB_MERCATOR:UO(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===cLe.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Rh.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===dF.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===pF.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:tm(e)?t.spatialReferenceId=J.GCSMARS2000:im(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN)}function yr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function Yb(e,t,i,r){i[r++]=M2*(e[t++]/$i.radius),i[r++]=M2*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/$i.radius))),i[r]=e[t]}function qme(e,t,i,r){Yb(e,t,i,r),pv(i,r,i,r)}function Wme(e,t,i,r){Yb(e,t,i,r),mv(i,r,i,r)}function cX(e,t,i,r,s){const n=.4999999*Math.PI,o=Ne(Kd*e[t+1],-n,n),a=Math.sin(o);i[r++]=Kd*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function bw(e,t,i,r){cX(e,t,i,r,$i)}const _ee=$i.radius*Math.PI/180,HM=180/($i.radius*Math.PI);function dv(e,t,i,r){i[r]=e[t]*_ee,i[r+1]=e[t+1]*_ee,i[r+2]=e[t+2]}function Rb(e,t,i,r){i[r]=e[t]*HM,i[r+1]=e[t+1]*HM,i[r+2]=e[t+2]}function Xme(e,t,i,r){Yb(e,t,i,r),dv(i,r,i,r)}function mNe(e,t,i,r){gv(e,t,i,r),dv(i,r,i,r)}function gNe(e,t,i,r){fv(e,t,i,r),dv(i,r,i,r)}function yNe(e,t,i,r){Rb(e,t,i,r),pv(i,r,i,r)}function vNe(e,t,i,r){Rb(e,t,i,r),bw(i,r,i,r)}function _Ne(e,t,i,r){Rb(e,t,i,r),mv(i,r,i,r)}function ww(e){if(M(e))return!1;const t=Xv(e,V5);return!!Pf[t][J.WGS84_COMPARABLE_LON_LAT]}function aC(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function uX(e,t,i,r,s){const n=s+e[t+2],o=Kd*e[t+1],a=Kd*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function FG(e,t,i,r){uX(e,t,i,r,qg.radius)}function UG(e,t,i,r){uX(e,t,i,r,$f.radius)}function pv(e,t,i,r){uX(e,t,i,r,$i.radius)}function hX(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=dp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=M2*h,i[r++]=M2*c,i[r]=l-s}function kG(e,t,i,r){hX(e,t,i,r,qg.radius)}function zG(e,t,i,r){hX(e,t,i,r,$f.radius)}function fv(e,t,i,r){hX(e,t,i,r,$i.radius)}function Yme(e,t,i,r){fv(e,t,i,r),bw(i,r,i,r)}function Zme(e,t,i,r){fv(e,t,i,r),mv(i,r,i,r)}function bNe(e,t,i,r,s){const n=Kd*e[t],o=Kd*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function mv(e,t,i,r){bNe(e,t,i,r,$i)}function gv(e,t,i,r){const s=QLe,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,v,b,w,S,T,E,C,A,I,L,D,k,z,V;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),z=Math.atan2(o,n),m=a*a/p,y=c/p,C=s.a2/f,A=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+C+m*A)/f),k=Math.asin(v),w=v*v,b=Math.sqrt(1-w)):(b=h/f*(1-m*(s.a5-C-y*A)/f),k=Math.acos(b),w=1-b*b,v=Math.sqrt(w)),S=1-$i.eccentricitySquared*w,T=$i.radius/Math.sqrt(S),E=s.a6*T,C=h-T*b,A=l-E*v,L=b*C+v*A,I=b*A-v*C,D=I/(E/S+L),k+=D,V=L+I*D/2,a<0&&(k=-k),i[r++]=M2*z,i[r++]=M2*k,i[r]=V}function Qme(e,t,i,r){gv(e,t,i,r),pv(i,r,i,r)}function Jme(e,t,i,r){gv(e,t,i,r),bw(i,r,i,r)}const Pf={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:yr,[J.SPHERICAL_ECEF]:pv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:bw,[J.PLATE_CARREE]:dv,[J.WGS84]:yr,[J.WGS84_ECEF]:mv},[J.CGCS2000]:{[J.CGCS2000]:yr,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:yr,[J.SPHERICAL_ECEF]:pv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:dv,[J.WGS84]:null,[J.WGS84_ECEF]:mv},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:yr,[J.GCSMOON2000]:null,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:UG,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:yr,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:FG,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Yb,[J.WGS84_COMPARABLE_LON_LAT]:Yb,[J.SPHERICAL_ECEF]:qme,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:yr,[J.PLATE_CARREE]:Xme,[J.WGS84]:Yb,[J.WGS84_ECEF]:Wme},[J.WGS84_ECEF]:{[J.CGCS2000]:gv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:gv,[J.WGS84_COMPARABLE_LON_LAT]:gv,[J.SPHERICAL_ECEF]:Qme,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Jme,[J.PLATE_CARREE]:mNe,[J.WGS84]:gv,[J.WGS84_ECEF]:yr},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:fv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:fv,[J.WGS84_COMPARABLE_LON_LAT]:fv,[J.SPHERICAL_ECEF]:yr,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Yme,[J.PLATE_CARREE]:gNe,[J.WGS84]:fv,[J.WGS84_ECEF]:Zme},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:zG,[J.GCSMOON2000]:null,[J.LON_LAT]:zG,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:yr,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:kG,[J.LON_LAT]:kG,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:yr,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:yr,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:yr,[J.GCSMARS2000]:yr,[J.GCSMOON2000]:yr,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:yr,[J.SPHERICAL_ECEF]:pv,[J.SPHERICAL_MARS_PCPF]:UG,[J.SPHERICAL_MOON_PCPF]:FG,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:bw,[J.PLATE_CARREE]:dv,[J.WGS84]:yr,[J.WGS84_ECEF]:mv},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:yr,[J.WGS84_COMPARABLE_LON_LAT]:yr,[J.SPHERICAL_ECEF]:pv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:dv,[J.WGS84]:yr,[J.WGS84_ECEF]:mv},[J.PLATE_CARREE]:{[J.CGCS2000]:Rb,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Rb,[J.WGS84_COMPARABLE_LON_LAT]:Rb,[J.SPHERICAL_ECEF]:yNe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:vNe,[J.PLATE_CARREE]:yr,[J.WGS84]:Rb,[J.WGS84_ECEF]:_Ne}};function dX(e,t,i=pX()){return M(e)||M(t)?null:Kme(e,t,i).projector}function Kme(e,t,i){if(M(e)||M(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=Xv(e,i.source),s=Xv(t,i.dest);return r===J.UNKNOWN&&s===J.UNKNOWN?Cc(e,t)?i.projector=yr:i.projector=null:i.projector=Pf[r][s],i}function pX(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:yr}}const V5={spatialReference:null,spatialReferenceId:J.UNKNOWN},ege={spatialReference:null,spatialReferenceId:J.UNKNOWN},fX=pX(),wNe=pX(),Kd=Pt(1),M2=Al(1),qr=R(),Nd=R(),Ey=R(),Bi=R(),jP=R();class ay{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&p2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*bee);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,bee));t++)this._items.push(this.allocator())}}const bee=1024;function Ee(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Zb(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function mX(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v]}function tge(e,t){return new Float64Array(e,t,16)}const Us=Ee();Object.freeze(Object.defineProperty({__proto__:null,create:Ee,clone:Zb,fromValues:mX,createView:tge,IDENTITY:Us},Symbol.toStringTag,{value:"Module"}));var Au;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Au||(Au={}));function xNe(e){return 32+e.length}function TNe(){return 16}function ige(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=xNe(r);break;case"number":t+=TNe();break;case"boolean":t+=4}}return t}function Iwt(e,t){return 32+e.length*t}var xw;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(xw||(xw={}));function ir(){return[1,0,0,0,1,0,0,0,1]}function SNe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function ENe(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function rge(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:ir,clone:SNe,fromValues:ENe,createView:rge},Symbol.toStringTag,{value:"Module"}));function wp(){return[0,0,0,1]}function CNe(e){return[e[0],e[1],e[2],e[3]]}function ANe(e,t,i,r){return[e,t,i,r]}function sge(e,t){return new Float64Array(e,t,4)}const MNe=wp();Object.freeze(Object.defineProperty({__proto__:null,create:wp,clone:CNe,fromValues:ANe,createView:sge,IDENTITY:MNe},Symbol.toStringTag,{value:"Module"}));function st(){return[0,0]}function kA(e){return[e[0],e[1]]}function Fi(e,t){return[e,t]}function nge(e){const t=st(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function oge(e,t){return new Float64Array(e,t,2)}function age(){return st()}function lge(){return Fi(1,1)}function cge(){return Fi(1,0)}function uge(){return Fi(0,1)}const Gh=age(),hge=lge(),ONe=cge(),RNe=uge();Object.freeze(Object.defineProperty({__proto__:null,create:st,clone:kA,fromValues:Fi,fromArray:nge,createView:oge,zeros:age,ones:lge,unitX:cge,unitY:uge,ZEROS:Gh,ONES:hge,UNIT_X:ONe,UNIT_Y:RNe},Symbol.toStringTag,{value:"Module"}));function qt(){return[0,0,0,0]}function B5(e){return[e[0],e[1],e[2],e[3]]}function vi(e,t,i,r){return[e,t,i,r]}function gX(e){const t=qt(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function dge(e,t){return new Float64Array(e,t,4)}function pge(){return qt()}function fge(){return vi(1,1,1,1)}function mge(){return vi(1,0,0,0)}function gge(){return vi(0,1,0,0)}function yge(){return vi(0,0,1,0)}function vge(){return vi(0,0,0,1)}const Lf=pge(),Ph=fge(),PNe=mge(),INe=gge(),$Ne=yge(),DNe=vge();Object.freeze(Object.defineProperty({__proto__:null,create:qt,clone:B5,fromValues:vi,fromArray:gX,createView:dge,zeros:pge,ones:fge,unitX:mge,unitY:gge,unitZ:yge,unitW:vge,ZEROS:Lf,ONES:Ph,UNIT_X:PNe,UNIT_Y:INe,UNIT_Z:$Ne,UNIT_W:DNe},Symbol.toStringTag,{value:"Module"}));class hu{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&p2(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=dx){return new hu(16,oge,t)}static createVec3f64(t=dx){return new hu(24,mW,t)}static createVec4f64(t=dx){return new hu(32,dge,t)}static createMat3f64(t=dx){return new hu(72,rge,t)}static createMat4f64(t=dx){return new hu(128,tge,t)}static createQuatf64(t=dx){return new hu(32,sge,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const dx=4*xw.KILOBYTES,$wt=hu.createVec2f64(),je=hu.createVec3f64(),yX=hu.createVec4f64();hu.createMat3f64();const vX=hu.createMat4f64(),Dwt=hu.createQuatf64();function nm(e){return e?{origin:rs(e.origin),vector:rs(e.vector)}:{origin:R(),vector:R()}}function LNe(e,t){const i=FNe.get();return i.origin=e,i.vector=t,i}function Lwt(e,t=nm()){return NNe(e.origin,e.vector,t)}function NNe(e,t,i=nm()){return ne(i.origin,e),ne(i.vector,t),i}function Qb(e,t,i=nm()){return ne(i.origin,e),fe(i.vector,t,e),i}function _X(e,t){const i=fe(je.get(),t,e.origin),r=Se(e.vector,i),s=Se(e.vector,e.vector),n=Ne(r/s,0,1),o=fe(je.get(),oe(je.get(),e.vector,n),i);return Se(o,o)}function Nwt(e,t,i){return VG(e,t,0,1,i)}function Fwt(e,t,i){return pe(i,e.origin,oe(i,e.vector,t))}function VG(e,t,i,r,s){const{vector:n,origin:o}=e,a=fe(je.get(),t,o),l=Se(n,a)/Fa(n);return oe(s,n,Ne(l,i,r)),pe(s,s,e.origin)}function Uwt(e,t){if(bge(e,LNe(t.origin,t.direction),!1,wF)){const{tA:i,pB:r,distance2:s}=wF;if(i>=0&&i<=1)return s;if(i<0)return _n(e.origin,r);if(i>1)return _n(pe(je.get(),e.origin,e.vector),r)}return null}function _ge(e,t,i){return!!bge(e,t,!0,wF)&&(ne(i,wF.pA),!0)}function bge(e,t,i,r){const n=e.origin,o=pe(je.get(),n,e.vector),a=t.origin,l=pe(je.get(),a,t.vector),c=je.get(),h=je.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=je.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-m*m;if(Math.abs(b)<1e-6)return!1;let w=(f*m-y*v)/b,S=(f+m*w)/v;i&&(w=Ne(w,0,1),S=Ne(S,0,1));const T=je.get(),E=je.get();return T[0]=n[0]+w*p[0],T[1]=n[1]+w*p[1],T[2]=n[2]+w*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=w,r.tB=S,r.pA=T,r.pB=E,r.distance2=_n(T,E),!0}const wF={tA:0,tB:0,pA:R(),pB:R(),distance2:0},FNe=new ay(()=>({origin:null,vector:null}));function io(e){return e?{origin:rs(e.origin),direction:rs(e.direction)}:{origin:R(),direction:R()}}function kwt(e,t){return Uv(e.origin,t.origin)&&Uv(e.direction,t.direction)}function Du(e,t){const i=BNe.get();return i.origin=e,i.direction=t,i}function xF(e,t=io()){return wge(e.origin,e.direction,t)}function UNe(e,t,i=io()){return ne(i.origin,e),fe(i.direction,t,e),i}function wge(e,t,i=io()){return ne(i.origin,e),ne(i.direction,t),i}function kNe(e,t){const i=lt(je.get(),we(je.get(),e.direction),fe(je.get(),t,e.origin));return Se(i,i)}function zNe(e,t,i){const r=Se(e.direction,fe(i,t,e.origin));return pe(i,e.origin,oe(i,e.direction,r)),i}function VNe(){return{origin:null,direction:null}}const BNe=new ay(VNe);function qM(e,t){return Se(e,t)/Re(e)}function bX(e,t){const i=Se(e,t)/(Re(e)*Re(t));return-an(i)}function GNe(e,t,i){we(HP,e),we(zz,t);const r=Se(HP,zz),s=an(r),n=lt(HP,HP,zz);return Se(n,i)<0?2*Math.PI-s:s}const HP=R(),zz=R(),jNe=de.getLogger("esri.geometry.support.sphere");function bn(){return qt()}function O2(e,t=bn()){return Zd(t,e)}function xge(e,t){return vi(e[0],e[1],e[2],t)}function HNe(e){return e}function Tge(e){e[0]=e[1]=e[2]=e[3]=0}function G5(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Ig(e){return e[3]}function qNe(e){return e}function Sge(e,t,i,r){return vi(e,t,i,r)}function WNe(e,t,i){return e!==i&&ne(i,e),i[3]=e[3]+t,i}function XNe(e,t,i){return jNe.error("sphere.setExtent is not yet supported"),e===i?i:O2(e,i)}function g_(e,t,i){if(M(t))return!1;const{origin:r,direction:s}=t,n=YNe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const YNe=R();function BG(e,t){return g_(e,t,null)}function ZNe(e,t,i){if(g_(e,t,i))return i;const r=RE(e,t,je.get());return pe(i,t.origin,oe(je.get(),t.direction,ur(t.origin,r)/Re(t.direction))),i}function RE(e,t,i){const r=je.get(),s=vX.get();lt(r,t.origin,t.direction);const n=Ig(e);lt(i,r,t.origin),oe(i,i,1/Re(i)*n);const o=Age(e,t.origin),a=bX(t.origin,i);return Tc(s,a+o,r),ke(i,i,s),i}function QNe(e,t,i){return g_(e,t,i)?i:(zNe(t,e,i),Ege(e,i,i))}function Ege(e,t,i){const r=fe(je.get(),t,e),s=oe(je.get(),r,e[3]/Re(r));return pe(i,s,e)}function Cge(e,t){const i=fe(je.get(),t,e),r=Fa(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Age(e,t){const i=fe(je.get(),t,e),r=Re(i),s=Ig(e),n=s+Math.abs(s-r);return an(s/n)}const Vz=R();function Mge(e,t,i,r){const s=fe(Vz,t,e);switch(i){case Au.X:{const n=IK(s,Vz)[2];return ie(r,-Math.sin(n),Math.cos(n),0)}case Au.Y:{const n=IK(s,Vz),o=n[1],a=n[2],l=Math.sin(o);return ie(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Au.Z:return we(r,s);default:return}}function Oge(e,t){const i=fe(GG,t,e);return Re(i)-e[3]}function JNe(e,t,i,r){const s=Oge(e,t),n=Mge(e,t,Au.Z,GG),o=oe(GG,n,i-s);return pe(r,t,o)}function KNe(e,t){const i=_n(e,t),r=Ig(e);return i<=r*r}const GG=R(),j5=bn(),eFe=Object.freeze(Object.defineProperty({__proto__:null,create:bn,copy:O2,fromCenterAndRadius:xge,wrap:HNe,clear:Tge,fromRadius:G5,getRadius:Ig,getCenter:qNe,fromValues:Sge,elevate:WNe,setExtent:XNe,intersectRay:g_,intersectsRay:BG,intersectRayClosestSilhouette:ZNe,closestPointOnSilhouette:RE,closestPoint:QNe,projectPoint:Ege,distanceToSilhouette:Cge,angleToSilhouette:Age,axisAt:Mge,altitudeAt:Oge,setAltitudeAt:JNe,containsPoint:KNe,tmpSphere:j5},Symbol.toStringTag,{value:"Module"}));function Tw(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function tFe(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ie(e,i,r,s),e}function zwt(e,t,i){i=i||e;const r=Se(e,t);ie(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),we(i,i)}function Vwt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?ie(t,0,1,0):ie(t,1,0,0),lt(i,e,t),we(t,t),lt(t,i,e),we(i,i)}function qP(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function iFe(e,t,i,r=R()){const s=Re(e),n=Re(t),o=Se(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return oe(Pb,e,c),oe(Ib,t,h),pe(r,Pb,Ib)}return on(r,e,t,i)}function Bwt(e,t,i,r=R(),s=R()){const n=Re(e),o=Re(t),a=Se(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;oe(Pb,e,m/n*p),oe(Ib,t,y),pe(r,Pb,Ib)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));oe(Pb,e,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));oe(Ib,t,y),pe(s,Pb,Ib),oe(s,s,1/c)}return s}return on(r,e,t,i),fe(s,t,e),we(s,s),s}function sL(e,t,i){e=we(Pb,e),t=we(Ib,t);const r=an(Se(e,t));if(i){const s=lt(rFe,e,t);if(Se(s,i)<0)return-r}return r}function nL(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function Gwt(e,t,i,r){fe(wee,t,e),fe(xee,i,e),lt(r,wee,xee),we(r,r),r[3]=-Se(e,r)}const wee=R(),xee=R(),rFe=R(),Pb=R(),Ib=R();function Ei(e=zA){return[e[0],e[1],e[2],e[3]]}function sFe(e=zA[0],t=zA[1],i=zA[2],r=zA[3]){return wX(e,t,i,r,yX.get())}function H5(e,t){return wX(t[0],t[1],t[2],t[3],e)}function wX(e,t,i,r,s=Ei()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Rge(e,t,i){return ne(i,e),i[3]=t,i}function R2(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function ia(e,t,i,r=Ei()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Pge(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,lC);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,px),n++,o=!ka(lC,px);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,mb),n++,fe(WP,lC,px),we(WP,WP),fe(XP,px,mb),we(XP,XP),o=!ka(lC,mb)&&!ka(px,mb)&&Math.abs(Se(WP,XP))<nFe;return o?(ia(lC,px,mb,t),!0):(i!==0||r!==1||s!==2)&&Pge(e,t,0,1,2)}const nFe=.99619469809,lC=R(),px=R(),mb=R(),WP=R(),XP=R();function jG(e,t,i){return t!==e&&H5(e,t),e[3]=-Se(e,i),e}function HG(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function XO(e,t,i,r){return lt(mb,t,e),R2(i,mb,r)}function jwt(e,t,i,r){return q5(e,t,fe(je.get(),i,t),dFe,r)}function sx(e,t,i){return!!_(t)&&q5(e,t.origin,t.direction,pFe,i)}function oFe(e,t,i){return q5(e,t.origin,t.vector,Nf.NONE,i)}function aFe(e,t,i){return q5(e,t.origin,t.vector,Nf.CLAMP,i)}function Ige(e,t){return lr(e,t)>=0}function lFe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function cFe(e,t){const i=Se(e,t.ray.direction),r=-lr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function uFe(e,t){const i=Se(e,t.ray.direction),r=-lr(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function hFe(e,t,i){const r=oe(je.get(),e,-e[3]),s=qG(e,fe(je.get(),t,r),je.get());return pe(i,s,r),i}function qG(e,t,i){const r=oe(je.get(),e,Se(e,t));return fe(i,t,r),i}function lr(e,t){return Se(e,t)+e[3]}function q5(e,t,i,r,s){const n=Se(e,i);if(n===0)return!1;let o=-(Se(e,t)+e[3])/n;return r&Nf.CLAMP&&(o=Ne(o,0,1)),!(!(r&Nf.INFINITE_MIN)&&o<0||!(r&Nf.INFINITE_MAX)&&o>1)&&(pe(s,t,oe(s,i,o)),!0)}function Hwt(e){return e}const zA=[0,0,1,0];var Nf;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Nf||(Nf={}));const dFe=Nf.INFINITE_MIN|Nf.INFINITE_MAX,pFe=Nf.INFINITE_MAX,Bz=de.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class $ge{constructor(){this.plane=Ei(),this.origin=R(),this.basis1=R(),this.basis2=R()}}function y_(e=jge){return{plane:Ei(e.plane),origin:rs(e.origin),basis1:rs(e.basis1),basis2:rs(e.basis2)}}function fFe(e,t,i){const r=CFe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=sFe(0,0,0,0),W5(r),r}function nx(e,t=y_()){return xX(e.origin,e.basis1,e.basis2,t)}function mFe(e,t){ne(t.origin,e.origin),ne(t.basis1,e.basis1),ne(t.basis2,e.basis2),H5(t.plane,e.plane)}function xX(e,t,i,r=y_()){return ne(r.origin,e),ne(r.basis1,t),ne(r.basis2,i),W5(r),SFe(r,"fromValues()"),r}function W5(e){XO(e.basis2,e.basis1,e.origin,e.plane)}function Dge(e,t,i){e!==i&&nx(e,i);const r=oe(je.get(),Yg(e),t);return pe(i.origin,i.origin,r),i.plane[3]-=t,i}function gFe(e,t,i){return Lge(t,i),Dge(i,CX(e,e.origin),i),i}function Lge(e,t=y_()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return ie(t.origin,e[0]+i,e[1]+r,0),ie(t.basis1,i,0,0),ie(t.basis2,0,r,0),wX(0,0,1,0,t.plane),t}function TX(e,t,i){return!!sx(e.plane,t,i)&&Bge(e,i)}function yFe(e,t,i){if(TX(e,t,i))return i;const r=Nge(e,t,je.get());return pe(i,t.origin,oe(je.get(),t.direction,ur(t.origin,r)/Re(t.direction))),i}function Nge(e,t,i){const r=TF.get();Gge(e,t,r,TF.get());let s=Number.POSITIVE_INFINITY;for(const n of MX){const o=AX(e,n,X5.get()),a=je.get();if(oFe(r,o,a)){const l=ny(je.get(),t.origin,a),c=Math.abs(an(Se(t.direction,l)));c<s&&(s=c,ne(i,a))}}return s===Number.POSITIVE_INFINITY?Fge(e,t,i):i}function Fge(e,t,i){if(TX(e,t,i))return i;const r=TF.get(),s=TF.get();Gge(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of MX){const a=AX(e,o,X5.get()),l=je.get();if(aFe(r,a,l)){const c=kNe(t,l);if(!Ige(s,l))continue;c<n&&(n=c,ne(i,l))}}return SX(e,t.origin)<n&&Uge(e,t.origin,i),i}function Uge(e,t,i){const r=hFe(e.plane,t,je.get()),s=VG(Tee(e,e.basis1),r,-1,1,je.get()),n=VG(Tee(e,e.basis2),r,-1,1,je.get());return fe(i,pe(je.get(),s,n),e.origin),i}function kge(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=fe(je.get(),t,r),a=qM(s,o),l=qM(n,o),c=qM(Yg(e),o);return ie(i,a,l,c)}function SX(e,t){const i=kge(e,t,je.get()),{basis1:r,basis2:s}=e,n=Re(r),o=Re(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function vFe(e,t){return Math.sqrt(SX(e,t))}function _Fe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of MX){const s=AX(e,r,X5.get()),n=_X(s,t);n>i&&(i=n)}return Math.sqrt(i)}function EX(e,t){return Ige(e.plane,t)&&Bge(e,t)}function bFe(e,t,i,r){return TFe(e,i,r)}function CX(e,t){const i=-e.plane[3];return qM(Yg(e),t)-i}function wFe(e,t,i,r){const s=CX(e,t),n=oe(EFe,Yg(e),i-s);return pe(r,t,n),r}function zge(e,t){return ka(e.basis1,t.basis1)&&ka(e.basis2,t.basis2)&&ka(e.origin,t.origin)}function Vge(e,t,i){return e!==i&&nx(e,i),Xr(fx,t),$l(fx,fx),ke(i.basis1,e.basis1,fx),ke(i.basis2,e.basis2,fx),ke(i.plane,e.plane,fx),ke(i.origin,e.origin,t),jG(i.plane,i.plane,i.origin),i}function xFe(e,t,i,r){return e!==r&&nx(e,r),Tc(Gz,t,i),ke(r.basis1,e.basis1,Gz),ke(r.basis2,e.basis2,Gz),W5(r),r}function Yg(e){return e.plane}function TFe(e,t,i){switch(t){case Au.X:ne(i,e.basis1),we(i,i);break;case Au.Y:ne(i,e.basis2),we(i,i);break;case Au.Z:ne(i,Yg(e))}return i}function Bge(e,t){const i=fe(je.get(),t,e.origin),r=Fa(e.basis1),s=Fa(e.basis2),n=Se(e.basis1,i),o=Se(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function Tee(e,t){const i=X5.get();return ne(i.origin,e.origin),ne(i.vector,t),i}function AX(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=oe(je.get(),r,t.origin[0]),a=oe(je.get(),s,t.origin[1]);pe(i.origin,o,a),pe(i.origin,i.origin,n);const l=oe(je.get(),r,t.direction[0]),c=oe(je.get(),s,t.direction[1]);return oe(i.vector,pe(l,l,c),2),i}function SFe(e,t){Math.abs(Se(e.basis1,e.basis2)/(Re(e.basis1)*Re(e.basis2)))>1e-6&&Bz.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Se(e.basis1,Yg(e)))>1e-6&&Bz.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Se(Yg(e),e.origin)-e.plane[3])>1e-6&&Bz.warn(t,"Plane offset is not consistent with plane origin")}function Gge(e,t,i,r){const s=Yg(e);XO(s,t.direction,t.origin,i),XO(i,s,t.origin,r)}const jge={plane:Ei(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},TF=new ay(Ei),X5=new ay(nm),EFe=R(),CFe=new ay(()=>({origin:null,basis1:null,basis2:null,plane:null})),MX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],fx=Ee(),Gz=Ee(),AFe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:$ge,create:y_,wrap:fFe,copy:nx,copyWithoutVerify:mFe,fromValues:xX,updateUnboundedPlane:W5,elevate:Dge,setExtent:gFe,fromAABoundingRect:Lge,intersectRay:TX,intersectRayClosestSilhouette:yFe,closestPointOnSilhouette:Nge,closestPoint:Fge,projectPoint:Uge,projectPointLocal:kge,distance2:SX,distance:vFe,distanceToSilhouette:_Fe,extrusionContainsPoint:EX,axisAt:bFe,altitudeAt:CX,setAltitudeAt:wFe,equals:zge,transform:Vge,rotate:xFe,normal:Yg,UP:jge},Symbol.toStringTag,{value:"Module"}));function MFe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function OFe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function RFe(e){return{operations:e,value:e.create()}}function Hge(e,t,i=RFe(e)){return i.operations=e,e.copy(t,i.value),i}function PFe(e){return Hge(eFe,Sge(0,0,0,Ai(e).radius))}const See=2**50;function IFe(){return Hge(AFe,xX([0,0,0],[See,0,0],[0,See,0]))}function $Fe(e,t,i){return e.operations.axisAt(e.value,t,Au.Z,i)}function DFe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function LFe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function NFe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function FFe(e,t){return e.operations.altitudeAt(e.value,t)}function qge(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function UFe(e,t,i,r){return t!==r&&ws(r,t),ie(mx,r[12],r[13],r[14]),qge(e,mx,i,mx),r[12]=mx[0],r[13]=mx[1],r[14]=mx[2],r}function jz(e,t,i){return e.operations.elevate(e.value,t,i.value)}const mx=R();function Eee(e,t,i,r,s){return s[0]=Se(e,t),s[1]=Se(e,i),s[2]=Se(e,r),s}function WG(e,t,i,r,s){ne(i,e),ne(YP,t),we(YP,YP),lt(r,YP,i),lt(s,r,i)}function Wge(e,t){return e?Il(t):t.isGeographic?Ze.PlateCarree:t}const YP=R(),Xge=96;function qwt(e,t){const i=t||e.extent,r=e.width,s=Nl(i&&i.spatialReference);return i&&r?i.width/r*s*mme*Xge:0}function Yge(e,t){return e/(Nl(t)*mme*Xge)}function WM(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function Cee(e){return(e==null?void 0:e.type)==="voxel"}function Aee(e){return(e==null?void 0:e.type)==="imagery-tile"}function Zge(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function OX(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function Wwt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function XG(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function kFe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const zFe=de.getLogger("esri.support.AnalysesCollection");let P2=class extends GM{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{M(t.item)||t.item.parent===this.owner&&(zFe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};P2=u([P("esri.support.AnalysesCollection")],P2);const oL={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Hz={xsmall:544,small:768,medium:992,large:1200};function VFe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function qz(e,t){return t?oL[e].valueToClassName[t].split(" "):[]}const BFe=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new si,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Hz}initialize(){this._breakpointsHandles.add(ae(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ft))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=at(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=VFe(i);if(!r){const s=JSON.stringify(Hz,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:Hz,this._set("breakpoints",F({},i))}_updateClassNames(){if(!this.container)return;const i=uc.acquire(),r=uc.acquire();let s,n=!1;for(s in oL){const o=this[s],a=oL[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,qz(s,o).forEach(l=>r.push(l)),qz(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),uc.release(i),uc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in oL)qz(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};let m0=class extends Ae{constructor(){super(...arguments),this.items=new ct,this._watchUpdatingTracking=new Df,this._callbacks=new Map,this._projector=e9(),this._hiddenProjector=e9()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],m0.prototype,"surface",void 0),u([d({readOnly:!0})],m0.prototype,"items",void 0),u([d({readOnly:!0})],m0.prototype,"needsRender",null),u([d({readOnly:!0})],m0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],m0.prototype,"updating",void 0),m0=u([P("esri.views.overlay.ViewOverlay")],m0);const Mee=m0;function RX(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function GFe(e,t,i){return e.units[t][i]}function Y5(e,t,i,r=2,s="abbr"){return`${Bf(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${GFe(e,i,s)}`}function Xwt(e,t,i,r=2,s="abbr"){const n=yLe(t,i);return Y5(e,Is(t,i,n),n,r,s)}function Ywt(e,t,i,r=2,s="abbr"){const n=vLe(t,i);return Y5(e,Is(t,i,n),n,r,s)}function Zwt(e,t,i,r=2,s="abbr"){const n=_Le(t,i);return Y5(e,Is(t,i,n),n,r,s)}function Qwt(e,t,i,r=2,s="abbr"){const n=bLe(t,i);return Y5(e,Is(t,i,n),n,r,s)}const Oee=["B","kB","MB","GB","TB"];function jFe(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(xw.KILOBYTES));i=Ne(i,0,Oee.length-1);const r=Bf(t/xw.KILOBYTES**i,{maximumFractionDigits:2});return zf(e.units.bytes[Oee[i]],{fileSize:r})}function HFe(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?qFe({tagName:r,tags:s.tags}):null}function qFe(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var YG;const WFe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Wl=YG=class extends xe{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=HFe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return WFe[t]||null}clone(){return new YG({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],Wl.prototype,"contentType",void 0),u([d()],Wl.prototype,"exifInfo",void 0),u([d({readOnly:!0})],Wl.prototype,"orientationInfo",null),u([d({type:wr})],Wl.prototype,"id",void 0),u([d({type:String})],Wl.prototype,"globalId",void 0),u([d({type:String})],Wl.prototype,"keywords",void 0),u([d({type:String})],Wl.prototype,"name",void 0),u([d({json:{read:!1}})],Wl.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],Wl.prototype,"parentObjectId",void 0),u([d({type:wr})],Wl.prototype,"size",void 0),u([d({json:{read:!1}})],Wl.prototype,"url",void 0),Wl=YG=u([P("esri.layers.support.AttachmentInfo")],Wl);const XFe=Wl;var ZG;let wo=ZG=class extends xe{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new ZG(te({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],wo.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],wo.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],wo.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],wo.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],wo.prototype,"globalIds",void 0),u([d({json:{write:!0}})],wo.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],wo.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],wo.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],wo.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],wo.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],wo.prototype,"start",void 0),u([He("start"),He("num")],wo.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],wo.prototype,"where",void 0),wo=ZG=u([P("esri.rest.support.AttachmentQuery")],wo),wo.from=Ss(wo);const QG=wo,YFe="esri.widgets.Feature.support.featureUtils",Ree=de.getLogger(YFe),ZFe=/href=(""|'')/gi,QFe=/(\{([^\{\r\n]+)\})/g,JFe=/\'/g,Qge=/^\s*expression\//i,KFe=/(\n)/gi,e4e=/[\u00A0-\u9999<>\&]/gim,t4e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,i4e=/^(?:mailto:|tel:)/,Jge="relationships/",JG=r5("short-date-short-time");function Kge(e){if(!M(e))return e.get("sourceLayer")||e.get("layer")}async function SF(e,t){return typeof e=="function"?e.call(null,t):e}function eye(e=""){if(e)return!i4e.test(e.trim().toLowerCase())}function tye(e){return!!e&&Qge.test(e)}function r4e(e,t){if(!tye(t)||!e)return null;const i=t.replace(Qge,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function iye(e,t){const i=r4e(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function s4e(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function n4e(e){return e.replace(ZFe,"")}function EF(e,t){const i=PX(t,e);return i?i.name:e}function o4e(e,t){return e&&e.map(i=>EF(i,t))}function PX(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function rye(e){return`${e}`.trim()}function $b({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?KG({formattedAttributes:t,template:u4e(r,F(F(F({},t),s),e),i),fieldInfoMap:n}):""}function KG({formattedAttributes:e,template:t,fieldInfoMap:i}){return rye(n4e(zf(zf(t,r=>s4e(r,i)),e)))}function a4e(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(JFe,s);t[e]=n}}function l4e(e,t=!1){const i=F({},e);return Object.keys(i).forEach(r=>a4e(r,i,t)),i}function c4e(e,t,i){const r=(t=rye(t))&&t[0]!=="{";return zf(e,l4e(i,r))}function e7(e,t){return e.replace(QFe,(i,r,s)=>{const n=PX(t,s);return n?`{${n.name}}`:r})}function u4e(e,t,i){const r=e7(e,i);return r&&r.replace(t4e,(s,n,o)=>c4e(s,n||o,t))}function h4e(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function d4e(e){return(e==null?void 0:e.type)==="feature"}function Pee(e){return!!(e!=null&&e.layer)}function p4e(e){return(e==null?void 0:e.type)==="map-image"}function f4e(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=sye(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=PX(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new dS;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Pee(o)&&d4e(o)&&o.datesInUnknownTimezone||Pee(o)&&p4e(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&nfe(r)&&l?l.formatRasterPixelValue(e):typeof(e=h4e(e,l))=="string"||e==null||l==null?_3(e):n?Bf(e,ye(F({},dhe(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(e)}function sye(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function m4e({fieldName:e,graphic:t,layer:i}){if(Tg(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function g4e({fieldName:e,value:t,graphic:i,layer:r}){if(Tg(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function y4e(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Vf(o,JG),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Vf(a,JG),user:l}}return null}function v4e(e,t){const i=new Map;return e&&e.forEach(r=>{const s=EF(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function Iee(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function IX(e){return e.replace(e4e,t=>`&#${t.charCodeAt(0)};`)}function _3(e){return typeof e=="string"?e.replace(KFe,'<br class="esri-text-new-line" />'):e}function nye(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=g4e({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=m4e({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return f4e(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Vf(t,JG):_3(t)}function Wz({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>T4e({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=nye({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function _4e(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return Ree.warn(f,m),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Ree.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function b4e(e){var r;if(!((r=e.expressionInfos)!=null&&r.length))return!1;const t=await jf(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function w4e({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=c$e(a,e),c=l?[]:a,h=t.returnGeometry||await b4e(t);if(l&&!h)return;const p=await _4e({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=F(F({},e.attributes),p.attributes)))}function Tg(e=""){return!!e&&e.includes(Jge)}function x4e(e){return e?`${Jge}${e.layerId}/${e.fieldName}`:""}function $ee({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=x4e({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=nye({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function T4e({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>$ee({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>$ee({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const Dee=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},oye=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=_(i.where)&&i.where,n=_(i.geometry)&&i.geometry;Dee(r)||Dee(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},S4e=({query:e,layer:t,method:i})=>{oye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},E4e=({queryPayload:e,layer:t,method:i})=>{oye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Lee={editing:!1,operations:{add:!0,update:!0,delete:!0}},aye=ct.ofType(XFe),C4e="graphic.layer.capabilities.operations.supportsResizeAttachments";let vd=class extends Ae{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=F({},Lee),this.activeAttachmentInfo=null,this.attachmentInfos=new aye,this.graphic=null,this.mode="view",this.own(ae(()=>this.graphic,()=>this._graphicChanged(),Ft))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return F(F({},Lee),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(C4e)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new q("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new QG({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new q("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new q("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new q("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new q("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new q("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new q("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new q("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new q("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new q("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new q("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new q("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new QG({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Kge(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],vd.prototype,"abilities",void 0),u([Nt("abilities")],vd.prototype,"castAbilities",null),u([d()],vd.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:aye})],vd.prototype,"attachmentInfos",void 0),u([d({type:Ga})],vd.prototype,"graphic",void 0),u([d()],vd.prototype,"mode",void 0),u([d({readOnly:!0})],vd.prototype,"state",null),u([d({readOnly:!0})],vd.prototype,"supportsResizeAttachments",null),vd=u([P("esri.widgets.Attachments.AttachmentsViewModel")],vd);const $X=vd;function A4e(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function M4e(e){const t=Ni("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}const Nee={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},rt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},Xz=window.CSS;let _a=class extends ja{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new $X,this.visibleElements=F({},Nee),this._supportsImageOrientation=Xz&&Xz.supports&&Xz.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([oo(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Ft)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return F(F({},Nee),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new q("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return ce("div",{class:this.classes(rt.base,rt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?ce("div",{key:"error-message",class:rt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return ce("div",{class:rt.loaderContainer,key:"loader"},ce("div",{class:rt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ce("div",{class:rt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?ce("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.esriButtonSmall,rt.esriButtonHalf,e&&rt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?ce("button",{type:"submit",disabled:i,class:this.classes(rt.esriButton,rt.esriButtonSecondary,rt.esriButtonSmall,rt.esriButtonHalf,{[rt.buttonDisabled]:i})},this.messages.add):null,n=t?ce("span",{key:"file-name",class:rt.fileName},t.name):null,o=ce("form",{bind:this,afterCreate:Z8,afterRemoved:hK,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ce("fieldset",{class:rt.fileFieldset},n,ce("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,ce("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return ce("div",{key:"add-form-container",class:rt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?ce("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.deleteButton,{[rt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?ce("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonThird,{[rt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?ce("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.esriButtonThird,{[rt.buttonDisabled]:s})},this.messages.cancel):null,m=r?ce("span",{key:"file-name",class:rt.fileName},r.name):null,y=l.editing&&l.operations.update?ce("fieldset",{key:"file",class:rt.fileFieldset},m,ce("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},this.messages.changeFile,ce("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=ce("fieldset",{key:"size",class:rt.metadataFieldset},ce("label",null,jFe(this.messagesUnits,o))),b=ce("fieldset",{key:"content-type",class:rt.metadataFieldset},ce("label",null,n)),w=ce("form",{bind:this,afterCreate:Z8,afterRemoved:hK,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},ce("div",{class:rt.metadata},v,b),y,ce("div",{class:rt.actions},h,f,p));return ce("div",{key:"edit-form-container",class:rt.formNode},ce("a",{class:rt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),ce("div",{class:rt.itemLinkOverlay},ce("span",{class:rt.itemLinkOverlayIcon},ce("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},ce("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),ce("path",{fill:"none",d:"M0 0h32v32H0z"}))))),w)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&A4e(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:M4e(r),p={[rt.itemMaskIcon]:!o},f={[rt.itemImageResizable]:i};return ce("div",{class:this.classes(p,rt.itemMask)},ce("img",{styles:l,alt:s,src:h,class:this.classes(f,rt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?ce("span",{"aria-hidden":"true",class:this.classes(rt.itemChevronIcon,nv(this.container)?rt.iconLeft:rt.iconRight)}):null,l=[o,ce("label",{class:rt.itemLabel},ce("span",{class:rt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?ce("button",{key:"details-button",bind:this,class:rt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):ce("a",{key:"details-link",class:rt.itemButton,href:n,target:"_blank"},l);return ce("li",{class:rt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[rt.containerList]:e!=="preview",[rt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?ce("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.addAttachmentButton),type:"button"},ce("span",{"aria-hidden":"true",class:this.classes(rt.itemAddIcon,rt.iconPlus)}),this.messages.add):null,l=n?ce("ul",{class:rt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):ce("div",{class:rt.empty},this.messages.noAttachments);return ce("div",{key:"attachments-container",class:this.classes(rt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([ht("viewModel.abilities")],_a.prototype,"abilities",void 0),u([d()],_a.prototype,"displayType",void 0),u([d({readOnly:!0})],_a.prototype,"effectiveDisplayType",null),u([ht("viewModel.graphic")],_a.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_a.prototype,"label",void 0),u([d(),za("esri/widgets/Attachments/t9n/Attachments")],_a.prototype,"messages",void 0),u([d(),za("esri/core/t9n/Units")],_a.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],_a.prototype,"selectedFile",void 0),u([d({readOnly:!0})],_a.prototype,"submitting",void 0),u([d({readOnly:!0})],_a.prototype,"error",void 0),u([d({type:$X})],_a.prototype,"viewModel",void 0),u([d()],_a.prototype,"visibleElements",void 0),u([Nt("visibleElements")],_a.prototype,"castVisibleElements",null),_a=u([P("esri.widgets.Attachments")],_a);const O4e=_a;let VA=class extends $X{constructor(e){super(e),this.description=null,this.title=null}};u([d()],VA.prototype,"description",void 0),u([d()],VA.prototype,"title",void 0),VA=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],VA);const DX=VA,R4e={heading:"esri-widget__heading"};function LX(e,t){const i=P4e(e.level),r=`h${i}`;return delete e.level,ce(r,ye(F({},e),{class:Tde(R4e.heading,e.class),role:"heading","aria-level":String(i)}),t)}function P4e(e){return Ne(Math.ceil(e),1,6)}const Yz={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let AT=class extends ja{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return ce("div",{class:Yz.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ce(LX,{level:this.headingLevel,class:Yz.title},e):null}renderDescription(){const{description:e}=this;return e?ce("div",{key:"description",class:Yz.description},e):null}};u([d()],AT.prototype,"description",void 0),u([d()],AT.prototype,"headingLevel",void 0),u([d()],AT.prototype,"title",void 0),AT=u([P("esri.widgets.Feature.support.FeatureElementInfo")],AT);const NX=AT,I4e={base:"esri-feature-attachments"};let Jp=class extends ja{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new O4e,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new DX}initialize(){this._featureElementInfo=new NX,this.own([ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Ft),ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Ft)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return ce("div",{class:I4e.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],Jp.prototype,"attachmentsWidget",void 0),u([ht("viewModel.description")],Jp.prototype,"description",void 0),u([ht("attachmentsWidget.displayType")],Jp.prototype,"displayType",void 0),u([ht("viewModel.graphic")],Jp.prototype,"graphic",void 0),u([d()],Jp.prototype,"headingLevel",void 0),u([ht("viewModel.title")],Jp.prototype,"title",void 0),u([d({type:DX})],Jp.prototype,"viewModel",void 0),Jp=u([P("esri.widgets.Feature.FeatureAttachments")],Jp);const $4e=Jp;let g0=class extends Jh(Ae){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ae(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Ft))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(SF(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=SF(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],g0.prototype,"created",void 0),u([d()],g0.prototype,"creator",void 0),u([d()],g0.prototype,"destroyer",void 0),u([d({type:Ga})],g0.prototype,"graphic",void 0),u([d({readOnly:!0})],g0.prototype,"state",null),g0=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],g0);const CF=g0,Zz={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let MT=class extends ja{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{eye(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return ce("div",{class:Zz.loaderContainer,key:"loader"},ce("div",{class:Zz.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?ce("div",{key:e,bind:e,afterCreate:this._attachToNode}):spe(e)?ce("div",{key:e},!e.destroyed&&e.render()):ce("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return ce("div",{class:Zz.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([ht("viewModel.creator")],MT.prototype,"creator",void 0),u([ht("viewModel.graphic")],MT.prototype,"graphic",void 0),u([d({type:CF})],MT.prototype,"viewModel",void 0),MT=u([P("esri.widgets.Feature.FeatureContent")],MT);const aL=MT;let km=class extends Ae{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=iye(s,e),i.push(s)}),i}};u([d()],km.prototype,"attributes",void 0),u([d({type:[ffe]})],km.prototype,"expressionInfos",void 0),u([d()],km.prototype,"description",void 0),u([d({type:[f3]})],km.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],km.prototype,"formattedFieldInfos",null),u([d()],km.prototype,"title",void 0),km=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],km);const Z5=km,D4e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function L4e(e){let t=null;return D4e.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function N4e(e,t){if(typeof t!="string"||!t)return t;const i=L4e(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=zf(zf(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const cC={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let _d=class extends ja{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new Z5,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new NX,this.own(ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ft))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):N4e(this.messagesURIUtils,n),l={[cC.fieldDataDate]:o};return ce("tr",{key:`fields-element-info-row-${r}-${t}`},ce("th",{key:`fields-element-info-row-header-${r}-${t}`,class:cC.fieldHeader,innerHTML:s}),ce("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(cC.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ce("table",{class:cC.esriTable,summary:this.messages.fieldsSummary},ce("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return ce("div",{class:cC.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([ht("viewModel.attributes")],_d.prototype,"attributes",void 0),u([ht("viewModel.description")],_d.prototype,"description",void 0),u([ht("viewModel.expressionInfos")],_d.prototype,"expressionInfos",void 0),u([ht("viewModel.fieldInfos")],_d.prototype,"fieldInfos",void 0),u([ht("viewModel.title")],_d.prototype,"title",void 0),u([d({type:Z5})],_d.prototype,"viewModel",void 0),u([d(),za("esri/widgets/Feature/t9n/Feature")],_d.prototype,"messages",void 0),u([d(),za("esri/widgets/support/t9n/uriUtils")],_d.prototype,"messagesURIUtils",void 0),_d=u([P("esri.widgets.Feature.FeatureFields")],_d);const lye=_d,F4e={maximumFractionDigits:20};function U4e(e){return Bf(e,F4e)}var t7;let O1=t7=class extends xe{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new t7({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:We,json:{type:[wr],write:!0}})],O1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],O1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],O1.prototype,"value",void 0),u([He("value")],O1.prototype,"writeValue",null),O1=t7=u([P("esri.renderers.visualVariables.support.ColorStop")],O1);const k4e=O1;function Q5(e,t,i){return Ba(e.map((r,s)=>t.apply(i,[r,s])))}async function z4e(e,t,i){return(await Ba(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function mp(e){if(M(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function Jwt(e){try{return{ok:!0,value:await e}}catch(t){return bp(t),{ok:!1,error:t}}}function Kwt(e){if(e.ok===!0)return e.value;throw e.error}function b3(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function V4e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function B4e(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){const b=new Float32Array(16);return b[0]=e,b[1]=t,b[2]=i,b[3]=r,b[4]=s,b[5]=n,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=y,b[15]=v,b}function G4e(e,t){return new Float32Array(e,t,16)}const j4e=b3();Object.freeze(Object.defineProperty({__proto__:null,create:b3,clone:V4e,fromValues:B4e,createView:G4e,IDENTITY:j4e},Symbol.toStringTag,{value:"Module"}));const H4e=(e,t)=>{const i=sm(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return $l(i,i)},q4e=(e,t)=>{const i=sm(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return $l(i,i)},W4e=(e,t)=>{const i=1-t,r=sm(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return $l(r,r)},X4e=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=sm(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return $l(s,s)},Y4e=(e,t)=>{const i=1-2*t,r=sm(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return $l(r,r)},Z4e=(e,t)=>{const i=sm(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return $l(i,i)},Q4e=(e,t)=>{const i=1-t,r=sm(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return $l(r,r)};class J5{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=ac(t.strength,i.strength,r),this.radius=ac(t.radius,i.radius,r),this.threshold=ac(t.threshold,i.threshold,r)}clone(){return new J5(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:XM(this.radius),strength:this.strength,threshold:this.threshold}}}class K5{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(ac(t.radius,i.radius,r))}clone(){return new K5(this.radius)}toJSON(){return{type:"blur",radius:XM(this.radius)}}}class YO{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=ac(t.amount,i.amount,r),this._updateMatrix()}clone(){return new YO(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||b3();switch(this.type){case"brightness":this._colorMatrix=H4e(t,this.amount);break;case"contrast":this._colorMatrix=q4e(t,this.amount);break;case"grayscale":this._colorMatrix=W4e(t,this.amount);break;case"invert":this._colorMatrix=Y4e(t,this.amount);break;case"saturate":this._colorMatrix=Z4e(t,this.amount);break;case"sepia":this._colorMatrix=Q4e(t,this.amount)}}}class eU{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=ac(t.offsetX,i.offsetX,r),this.offsetY=ac(t.offsetY,i.offsetY,r),this.blurRadius=ac(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(ac(t.color[0],i.color[0],r)),this.color[1]=Math.round(ac(t.color[1],i.color[1],r)),this.color[2]=Math.round(ac(t.color[2],i.color[2],r)),this.color[3]=ac(t.color[3],i.color[3],r)}clone(){return new eU(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:XM(this.offsetX),yoffset:XM(this.offsetY),blurRadius:XM(this.blurRadius),color:t}}}class tU{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=ac(t.angle,i.angle,r),this._updateMatrix()}clone(){return new tU(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||b3();this._colorMatrix=X4e(t,this.angle)}}class iU{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=ac(t.amount,i.amount,r)}clone(){return new iU(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function ac(e,t,i){return e+(t-e)*i}function XM(e){return Math.round(1e3*Iu(e))/1e3}function J4e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new YO(e.type,0);case"saturate":case"brightness":case"contrast":return new YO(e.type,1);case"opacity":return new iU(1);case"hue-rotate":return new tU(0);case"blur":return new K5(0);case"drop-shadow":return new eU(0,0,0,[...kW("transparent")]);case"bloom":return new J5(0,0,1)}}var ext=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function txt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ixt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function K4e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function e5e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(J4e(i[s]))}function t5e(e){const t=e[0];return!!t&&"type"in t}var Fee,Uee,cye={exports:{}};function uye(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=kee(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new q("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:kee(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!K4e(t[i].effects,t[i+1].effects))throw new q("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});e5e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function kee(e){let t;if(!e)return[];try{t=cye.exports.parse(e)}catch(i){throw new q("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>i5e(i))}function i5e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return r5e(e);case"opacity":return s5e(e);case"hue-rotate":return n5e(e);case"blur":return o5e(e);case"drop-shadow":return a5e(e);case"bloom":return l5e(e)}}catch(t){throw t.details.filter=e,t}throw new q("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function r5e(e){let t=1;return PE(e.parameters,1),e.parameters.length===1&&(t=kd(e.parameters[0])),new YO(e.name,t)}function s5e(e){let t=1;return PE(e.parameters,1),e.parameters.length===1&&(t=kd(e.parameters[0])),new iU(t)}function n5e(e){let t=0;return PE(e.parameters,1),e.parameters.length===1&&(t=f5e(e.parameters[0])),new tU(t)}function o5e(e){let t=0;return PE(e.parameters,1),e.parameters.length===1&&(t=kX(e.parameters[0]),w3(t,e.parameters[0])),new K5(t)}function a5e(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new q("effect:type-error","Accepts only one color",{});i=m5e(r)}else{const s=kX(r);if(Object.isFrozen(t))throw new q("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&w3(s,r)}if(t.length<2||t.length>3)throw new q("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new eU(t[0],t[1],t[2]||0,i||hye("black"))}function l5e(e){let t=1,i=0,r=0;return PE(e.parameters,3),e.parameters[0]&&(t=kd(e.parameters[0])),e.parameters[1]&&(i=kX(e.parameters[1]),w3(i,e.parameters[1])),e.parameters[2]&&(r=kd(e.parameters[2])),new J5(t,i,r)}function PE(e,t){if(e.length>t)throw new q("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function rU(e){if(e.type==="color")return"<color>";if(e.unit){if(UX[e.unit])return"<length>";if(FX[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function w3(e,t){if(e<0)throw new q("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function c5e(e){if(e.type!=="quantity"||e.unit!==null)throw new q("effect:type-error",`Expected <double>, Actual: ${rU(e)}`,{term:e})}function u5e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new q("effect:type-error",`Expected <double> or <percentage>, Actual: ${rU(e)}`,{term:e})}Uee=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:bJ},h=bJ,p="none",f=")",m=",",y="(",v="%",b="px",w="cm",S="mm",T="in",E="pt",C="pc",A="deg",I="rad",L="grad",D="turn",k="#",z=".",V="e",X=/^[ \t\n\r]/,Y=/^[a-z\-]/,le=/^[0-9a-fA-F]/,re=/^[+\-]/,$=/^[0-9]/,U=td("none"),B=wn("none",!1),H=wn(")",!1),W=wn(",",!1),Q=td("whitespace"),G=A_([" ","	",`
`,"\r"],!1,!1),ee=td("function"),me=wn("(",!1),_e=td("identifier"),Me=A_([["a","z"],"-"],!1,!1),ve=td("percentage"),ge=wn("%",!1),Ce=td("length"),$e=wn("px",!1),gi=wn("cm",!1),wi=wn("mm",!1),Ht=wn("in",!1),xi=wn("pt",!1),Yt=wn("pc",!1),Ti=td("angle"),mr=wn("deg",!1),Or=wn("rad",!1),Qe=wn("grad",!1),Gi=wn("turn",!1),os=td("number"),ln=td("color"),Gs=wn("#",!1),ko=A_([["0","9"],["a","f"],["A","F"]],!1,!1),zo=A_(["+","-"],!1,!1),js=A_([["0","9"]],!1,!1),Rc=wn(".",!1),fm=wn("e",!1),Lr=function(){return[]},sP=function(Z,be){return{type:"function",name:Z,parameters:be||[]}},nP=function(Z,be){return be.length>0?rCe(Z,be,3):[Z]},oP=function(Z){return{type:"quantity",value:Z.value,unit:Z.unit}},aP=function(Z){return{type:"color",colorType:Z.type,value:Z.value}},nz=function(Z){return Z},oz=function(){return C_()},az=function(Z){return{value:Z,unit:"%"}},lz=function(Z){return{value:Z,unit:"px"}},XE=function(Z){return{value:Z,unit:"cm"}},lP=function(Z){return{value:Z,unit:"mm"}},cP=function(Z){return{value:Z,unit:"in"}},uP=function(Z){return{value:Z,unit:"pt"}},Di=function(Z){return{value:Z,unit:"pc"}},Vo=function(Z){return{value:Z,unit:"deg"}},po=function(Z){return{value:Z,unit:"rad"}},Fl=function(Z){return{value:Z,unit:"grad"}},S_=function(Z){return{value:Z,unit:"turn"}},hP=function(Z){return{value:Z,unit:null}},dP=function(){return{type:"hex",value:C_()}},pP=function(Z){return{type:"function",value:Z}},fP=function(){return{type:"named",value:C_()}},xp=function(){return parseFloat(C_())},ue=0,Rr=0,hx=[{line:1,column:1}],ku=0,E_=[],ut=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function C_(){return s.substring(Rr,ue)}function wn(Z,be){return{type:"literal",text:Z,ignoreCase:be}}function A_(Z,be,Pe){return{type:"class",parts:Z,inverted:be,ignoreCase:Pe}}function mP(){return{type:"end"}}function td(Z){return{type:"other",description:Z}}function YE(Z){var be,Pe=hx[Z];if(Pe)return Pe;for(be=Z-1;!hx[be];)be--;for(Pe={line:(Pe=hx[be]).line,column:Pe.column};be<Z;)s.charCodeAt(be)===10?(Pe.line++,Pe.column=1):Pe.column++,be++;return hx[Z]=Pe,Pe}function gP(Z,be){var Pe=YE(Z),yi=YE(be);return{source:l,start:{offset:Z,line:Pe.line,column:Pe.column},end:{offset:be,line:yi.line,column:yi.column}}}function Jt(Z){ue<ku||(ue>ku&&(ku=ue,E_=[]),E_.push(Z))}function qEe(Z,be,Pe){return new t(t.buildMessage(Z,be),Z,be,Pe)}function bJ(){var Z;return(Z=WEe())===a&&(Z=XEe()),Z}function WEe(){var Z,be;return ut++,Z=ue,fo(),s.substr(ue,4)===p?(be=p,ue+=4):(be=a,ut===0&&Jt(B)),be!==a?(fo(),Rr=Z,Z=Lr()):(ue=Z,Z=a),ut--,Z===a&&ut===0&&Jt(U),Z}function XEe(){var Z,be;if(Z=[],(be=cz())!==a)for(;be!==a;)Z.push(be),be=cz();else Z=a;return Z}function cz(){var Z,be,Pe,yi;return Z=ue,fo(),(be=ZEe())!==a?(fo(),(Pe=YEe())===a&&(Pe=null),fo(),s.charCodeAt(ue)===41?(yi=f,ue++):(yi=a,ut===0&&Jt(H)),yi!==a?(fo(),Rr=Z,Z=sP(be,Pe)):(ue=Z,Z=a)):(ue=Z,Z=a),Z}function YEe(){var Z,be,Pe,yi,Bo,Es,Vu,yP;if(Z=ue,(be=uz())!==a){for(Pe=[],yi=ue,Bo=fo(),s.charCodeAt(ue)===44?(Es=m,ue++):(Es=a,ut===0&&Jt(W)),Es===a&&(Es=null),Vu=fo(),(yP=uz())!==a?yi=Bo=[Bo,Es,Vu,yP]:(ue=yi,yi=a);yi!==a;)Pe.push(yi),yi=ue,Bo=fo(),s.charCodeAt(ue)===44?(Es=m,ue++):(Es=a,ut===0&&Jt(W)),Es===a&&(Es=null),Vu=fo(),(yP=uz())!==a?yi=Bo=[Bo,Es,Vu,yP]:(ue=yi,yi=a);Rr=Z,Z=nP(be,Pe)}else ue=Z,Z=a;return Z}function uz(){var Z,be;return Z=ue,(be=QEe())===a&&(be=JEe())===a&&(be=KEe())===a&&(be=eCe()),be!==a&&(Rr=Z,be=oP(be)),(Z=be)===a&&(Z=ue,(be=tCe())!==a&&(Rr=Z,be=aP(be)),Z=be),Z}function fo(){var Z,be;for(ut++,Z=[],X.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ut===0&&Jt(G));be!==a;)Z.push(be),X.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ut===0&&Jt(G));return ut--,be=a,ut===0&&Jt(Q),Z}function ZEe(){var Z,be,Pe;return ut++,Z=ue,(be=wJ())!==a?(s.charCodeAt(ue)===40?(Pe=y,ue++):(Pe=a,ut===0&&Jt(me)),Pe!==a?(Rr=Z,Z=nz(be)):(ue=Z,Z=a)):(ue=Z,Z=a),ut--,Z===a&&(be=a,ut===0&&Jt(ee)),Z}function wJ(){var Z,be,Pe;if(ut++,Z=ue,be=[],Y.test(s.charAt(ue))?(Pe=s.charAt(ue),ue++):(Pe=a,ut===0&&Jt(Me)),Pe!==a)for(;Pe!==a;)be.push(Pe),Y.test(s.charAt(ue))?(Pe=s.charAt(ue),ue++):(Pe=a,ut===0&&Jt(Me));else be=a;return be!==a&&(Rr=Z,be=oz()),ut--,(Z=be)===a&&(be=a,ut===0&&Jt(_e)),Z}function QEe(){var Z,be,Pe;return ut++,Z=ue,fo(),(be=zu())!==a?(s.charCodeAt(ue)===37?(Pe=v,ue++):(Pe=a,ut===0&&Jt(ge)),Pe!==a?(Rr=Z,Z=az(be)):(ue=Z,Z=a)):(ue=Z,Z=a),ut--,Z===a&&ut===0&&Jt(ve),Z}function JEe(){var Z,be,Pe;return ut++,Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===b?(Pe=b,ue+=2):(Pe=a,ut===0&&Jt($e)),Pe!==a?(Rr=Z,Z=lz(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===w?(Pe=w,ue+=2):(Pe=a,ut===0&&Jt(gi)),Pe!==a?(Rr=Z,Z=XE(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===S?(Pe=S,ue+=2):(Pe=a,ut===0&&Jt(wi)),Pe!==a?(Rr=Z,Z=lP(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===T?(Pe=T,ue+=2):(Pe=a,ut===0&&Jt(Ht)),Pe!==a?(Rr=Z,Z=cP(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===E?(Pe=E,ue+=2):(Pe=a,ut===0&&Jt(xi)),Pe!==a?(Rr=Z,Z=uP(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,fo(),(be=zu())!==a?(s.substr(ue,2)===C?(Pe=C,ue+=2):(Pe=a,ut===0&&Jt(Yt)),Pe!==a?(Rr=Z,Z=Di(be)):(ue=Z,Z=a)):(ue=Z,Z=a)))))),ut--,Z===a&&ut===0&&Jt(Ce),Z}function KEe(){var Z,be,Pe;return ut++,Z=ue,(be=zu())!==a?(s.substr(ue,3)===A?(Pe=A,ue+=3):(Pe=a,ut===0&&Jt(mr)),Pe!==a?(Rr=Z,Z=Vo(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(be=zu())!==a?(s.substr(ue,3)===I?(Pe=I,ue+=3):(Pe=a,ut===0&&Jt(Or)),Pe!==a?(Rr=Z,Z=po(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(be=zu())!==a?(s.substr(ue,4)===L?(Pe=L,ue+=4):(Pe=a,ut===0&&Jt(Qe)),Pe!==a?(Rr=Z,Z=Fl(be)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(be=zu())!==a?(s.substr(ue,4)===D?(Pe=D,ue+=4):(Pe=a,ut===0&&Jt(Gi)),Pe!==a?(Rr=Z,Z=S_(be)):(ue=Z,Z=a)):(ue=Z,Z=a)))),ut--,Z===a&&(be=a,ut===0&&Jt(Ti)),Z}function eCe(){var Z,be;return ut++,Z=ue,fo(),(be=zu())!==a?(Rr=Z,Z=hP(be)):(ue=Z,Z=a),ut--,Z===a&&ut===0&&Jt(os),Z}function tCe(){var Z,be,Pe,yi;if(ut++,Z=ue,s.charCodeAt(ue)===35?(be=k,ue++):(be=a,ut===0&&Jt(Gs)),be!==a){if(Pe=[],le.test(s.charAt(ue))?(yi=s.charAt(ue),ue++):(yi=a,ut===0&&Jt(ko)),yi!==a)for(;yi!==a;)Pe.push(yi),le.test(s.charAt(ue))?(yi=s.charAt(ue),ue++):(yi=a,ut===0&&Jt(ko));else Pe=a;Pe!==a?(Rr=Z,Z=dP()):(ue=Z,Z=a)}else ue=Z,Z=a;return Z===a&&(Z=ue,(be=cz())!==a&&(Rr=Z,be=pP(be)),(Z=be)===a&&(Z=ue,(be=wJ())!==a&&(Rr=Z,be=fP()),Z=be)),ut--,Z===a&&(be=a,ut===0&&Jt(ln)),Z}function zu(){var Z,be,Pe,yi,Bo,Es,Vu;for(Z=ue,re.test(s.charAt(ue))?(s.charAt(ue),ue++):ut===0&&Jt(zo),be=ue,Pe=[],$.test(s.charAt(ue))?(yi=s.charAt(ue),ue++):(yi=a,ut===0&&Jt(js));yi!==a;)Pe.push(yi),$.test(s.charAt(ue))?(yi=s.charAt(ue),ue++):(yi=a,ut===0&&Jt(js));if(s.charCodeAt(ue)===46?(yi=z,ue++):(yi=a,ut===0&&Jt(Rc)),yi!==a){if(Bo=[],$.test(s.charAt(ue))?(Es=s.charAt(ue),ue++):(Es=a,ut===0&&Jt(js)),Es!==a)for(;Es!==a;)Bo.push(Es),$.test(s.charAt(ue))?(Es=s.charAt(ue),ue++):(Es=a,ut===0&&Jt(js));else Bo=a;Bo!==a?be=Pe=[Pe,yi,Bo]:(ue=be,be=a)}else ue=be,be=a;if(be===a)if(be=[],$.test(s.charAt(ue))?(Pe=s.charAt(ue),ue++):(Pe=a,ut===0&&Jt(js)),Pe!==a)for(;Pe!==a;)be.push(Pe),$.test(s.charAt(ue))?(Pe=s.charAt(ue),ue++):(Pe=a,ut===0&&Jt(js));else be=a;if(be!==a){if(Pe=ue,s.charCodeAt(ue)===101?(yi=V,ue++):(yi=a,ut===0&&Jt(fm)),yi!==a){if(re.test(s.charAt(ue))?(Bo=s.charAt(ue),ue++):(Bo=a,ut===0&&Jt(zo)),Bo===a&&(Bo=null),Es=[],$.test(s.charAt(ue))?(Vu=s.charAt(ue),ue++):(Vu=a,ut===0&&Jt(js)),Vu!==a)for(;Vu!==a;)Es.push(Vu),$.test(s.charAt(ue))?(Vu=s.charAt(ue),ue++):(Vu=a,ut===0&&Jt(js));else Es=a;Es!==a?Pe=yi=[yi,Bo,Es]:(ue=Pe,Pe=a)}else ue=Pe,Pe=a;Pe===a&&(Pe=null),Rr=Z,Z=xp()}else ue=Z,Z=a;return Z}function iCe(Z,be){return Z.map(function(Pe){return Pe[be]})}function rCe(Z,be,Pe){return[Z].concat(iCe(be,Pe))}if((o=h())!==a&&ue===s.length)return o;throw o!==a&&ue<s.length&&Jt(mP()),qEe(E_,ku<s.length?s.charAt(ku):null,ku<s.length?gP(ku,ku+1):gP(ku,ku))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(m.inverted?"^":"")+y+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,v,b=m.map(h);if(b.sort(),b.length>0){for(y=1,v=1;y<b.length;y++)b[y-1]!==b[y]&&(b[v]=b[y],v++);b.length=v}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(Fee=cye).exports&&(Fee.exports=Uee());const FX={deg:1,grad:.9,rad:180/Math.PI,turn:360};function h5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&FX[e.unit]!=null))throw new q("effect:type-error",`Expected <angle>, Actual: ${rU(e)}`,{term:e})}const UX={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function d5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&UX[e.unit]!=null))throw new q("effect:type-error",`Expected <length>, Actual: ${rU(e)}`,{term:e})}function kd(e){u5e(e);const t=e.value;return w3(t,e),e.unit==="%"?.01*t:t}function p5e(e){return c5e(e),w3(e.value,e),e.value}function f5e(e){return h5e(e),e.value*FX[e.unit]||0}function kX(e){return d5e(e),e.value*UX[e.unit]||0}function m5e(e){switch(e.colorType){case"hex":return T$e(e.value);case"named":return hye(e.value);case"function":return v5e(e.value)}}function hye(e){if(!_fe(e))throw new q("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return x$e(e)}const g5e=/^rgba?/i,y5e=/^hsla?/i;function v5e(e){if(PE(e.parameters,4),g5e.test(e.name))return[kd(e.parameters[0]),kd(e.parameters[1]),kd(e.parameters[2]),e.parameters[3]?kd(e.parameters[3]):1];if(y5e.test(e.name))return bfe(p5e(e.parameters[0]),kd(e.parameters[1]),kd(e.parameters[2]),e.parameters[3]?kd(e.parameters[3]):1);throw new q("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function zX(e,t,i){var r;try{return b5e(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function VX(e,t,i,r){try{const s=_5e(e);_c(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function _5e(e){const t=uye(e);return t?t5e(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function b5e(e){if(!e||e.length===0)return null;if(w5e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:zee(i.value)});return t}return zee(e)}function w5e(e){const t=e[0];return!!t&&"scale"in t}function zee(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[gm(i,"amount")];break;case"blur":r=[gm(i,"radius","pt")];break;case"hue-rotate":r=[gm(i,"angle","deg")];break;case"drop-shadow":r=[gm(i,"xoffset","pt"),gm(i,"yoffset","pt"),gm(i,"blurRadius","pt"),x5e(i,"color")];break;case"bloom":r=[gm(i,"strength"),gm(i,"radius","pt"),gm(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;uye(s),t.push(s)}return t.join(" ")}function gm(e,t,i){if(e[t]==null)throw new q("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function x5e(e,t){if(e[t]==null)throw new q("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const lL=-3;var gg;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(gg||(gg={}));class T5e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class BX{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new It,this._users=new It}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,gg.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,gg.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,lL)-lL;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,gg.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+lL-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,gg.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,gg.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,gg.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class S5e{constructor(t,i){this._storage=new BX,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function E5e(e){return typeof e=="function"}function rxt(e,t,i,r){return E5e(e)?e(t,i,r):e}function sxt(e){return[e.r,e.g,e.b,e.a]}function nxt(e,t,i){const r=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!r.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,y]=p;if(f)y?h=f:(h&&(c+=h,h=null),c+=f);else{const v=l.attributes[m];v&&(h&&(c+=h,h=null),c+=v)}}return C5e(c,i)}}function C5e(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function oxt(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,v=0,b=0,w=0,S=0,T=0,E=0;const C=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const I=Math.abs(C-(A+.5))/h,L=(f+.5)*a,D=I*I;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let z=Math.abs(L-(k+.5))/c;const V=Math.sqrt(D+z*z);V>=-1&&V<=1&&(y=2*V*V*V-3*V*V+1,y>0&&(z=4*(k+A*t),E+=y*e[z+3],b+=y,e[z+3]<255&&(y=y*e[z+3]/250),w+=y*e[z],S+=y*e[z+1],T+=y*e[z+2],v+=y))}}r[m]=w/v,r[m+1]=S/v,r[m+2]=T/v,r[m+3]=E/b}}function axt(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function A5e(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const lxt=e=>isNaN(e)||!e?0:e,cxt=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function uxt(){return import("./geometryEngineJSON.2762c1dd.js")}function dye(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)R5e(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":M5e(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":dye(s.lineSymbol,t,!0,ye(F({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function M5e(e,t,i){if(e.markerPlacement&&O5e(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||dye(r.symbol,t,!0,i)}function O5e(e,t){switch(A5e(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function R5e(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}new S5e(1e3);new We([128,128,128]);const Vee=/\/resource\/(.*?)\.svg$/,P5e=new We("white");function I5e(e,t){const i=t.resource.href;return!he("esri-canvas-svg-support")&&e.styleOrigin&&Vee.test(i)?i.replace(Vee,"/resource/png/$1.png"):i}function gx(e,t){if(!e)return null;let i=null;return vw(e)?i=$5e(e):N5(e)&&(i=e.color?new We(e.color):null),i?ZO(i,t):null}function $5e(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:_(r.material)?r.material.color:null)}),i?new We(i):null}function ZO(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new We(i)}function D5e(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return ZO(t=t||o||i!=null&&P5e,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);M(n.material)?n.material=new Cu({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=ZO(n.outline.color,i))}})}function L5e(e,t,i){(t=t||e.color)&&(e.color=ZO(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=ZO(e.outline.color,i))}function Qz(e,t,i){e&&(t||i!=null)&&(t&&(t=new We(t)),vw(e)?D5e(e,t,i):N5(e)&&L5e(e,t,i))}async function N5e(e,t){const i=e.symbolLayers;i&&await Q5(i,async r=>F5e(r,t))}async function F5e(e,t){switch(e.type){case"extrude":k5e(e,t);break;case"icon":case"line":case"text":U5e(e,t);break;case"path":V5e(e,t);break;case"object":await z5e(e,t)}}function U5e(e,t){const i=pye(t);_(i)&&(e.size=i)}function pye(e){for(const t of e)if(typeof t=="number")return t;return null}function k5e(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function z5e(e,t){const{resourceSize:i,symbolSize:r}=await B5e(e),s=fye(t,i,r);e.width=YM(t[0],r[0],i[0],s),e.depth=YM(t[1],r[1],i[1],s),e.height=YM(t[2],r[2],i[2],s)}function V5e(e,t){const i=fye(t,Rf,[e.width,void 0,e.height]);e.width=YM(t[0],e.width,1,i),e.height=YM(t[2],e.height,1,i)}function fye(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function B5e(e){const t=await import("./symbolLayerUtils.517639c0.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function YM(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function G5e(e,t){const i=pye(t);if(!M(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function j5e(e,t){if(e&&t)return vw(e)?N5e(e,t):void(N5(e)&&G5e(e,t))}function H5e(e,t,i){if(e&&t!=null)if(vw(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else N5(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}const q5e="<",W5e=">",X5e=r5("short-date");function Y5e(e,t,i,r){let s="";t===0?s=`${q5e} `:t===i&&(s=`${W5e} `);let n=null;return n=r?Vf(e,X5e):U4e(e),s+n}const Z5e=new We([64,64,64]);function Q5e(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?Y5e(s,n,r,t):null)}async function J5e(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:Q5e(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await K5e(c,e,t):(await Promise.resolve().then(function(){return mY})).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function K5e(e,t,i=Z5e){const r=new We(i),s=(await Promise.resolve().then(function(){return mY})).getOpacity(t,e);return s!=null&&(r.a=s),r}var i7;let BA=i7=class extends xe{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new i7({color:this.color,ratio:this.ratio})}};u([d({type:We,json:{type:[wr],default:null,write:!0}})],BA.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],BA.prototype,"ratio",void 0),BA=i7=u([P("esri.renderers.support.HeatmapColorStop")],BA);const ZM=BA;function eUe(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new ZM({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}de.getLogger("esri.renderers.support.utils");function Pc(e,t,i){kq(e,t,()=>[]).push(...i)}async function tUe(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await J5e(n)).map(l=>l.color);Pc(t,o,a)}}if(e.type==="heatmap"){const s=eUe(e).map(n=>n.color);Pc(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)Pc(t,s.field,[s.color]);Pc(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,gx(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)Pc(t,s.field,[s.color]);Pc(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)Pc(t,s.value.toString(),[gx(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>gx(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&Pc(t,n||l,s),o&&Pc(t,o,s),a&&Pc(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>gx(n.symbol,null));Pc(t,e.field||e.valueExpression,s)}else e.type==="simple"&&Pc(t,null,[gx(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&Pc(t,null,[gx(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=i3(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var r7;let GA=r7=class extends xe{constructor(e){super(e),this.name=null,this.code=null}clone(){return new r7({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],GA.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],GA.prototype,"code",void 0),GA=r7=u([P("esri.layers.support.CodedValue")],GA);const iUe=new Mi({inherited:"inherited",codedValue:"coded-value",range:"range"});let jA=class extends xe{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],jA.prototype,"name",void 0),u([mt(iUe)],jA.prototype,"type",void 0),jA=u([P("esri.layers.support.Domain")],jA);const sU=jA;var s7;let HA=s7=class extends sU{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new s7({codedValues:te(this.codedValues),name:this.name})}};u([d({type:[GA],json:{write:!0}})],HA.prototype,"codedValues",void 0),u([mt({codedValue:"coded-value"})],HA.prototype,"type",void 0),HA=s7=u([P("esri.layers.support.CodedValueDomain")],HA);const mye=HA;var n7;let cL=n7=class extends sU{constructor(e){super(e),this.type="inherited"}clone(){return new n7}};u([mt({inherited:"inherited"})],cL.prototype,"type",void 0),cL=n7=u([P("esri.layers.support.InheritedDomain")],cL);const gye=cL;var o7;let OT=o7=class extends sU{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new o7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],OT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],OT.prototype,"minValue",void 0),u([mt({range:"range"})],OT.prototype,"type",void 0),OT=o7=u([P("esri.layers.support.RangeDomain")],OT);const yye=OT,vye={key:"type",base:sU,typeMap:{range:yye,"coded-value":mye,inherited:gye}};function GX(e){if(!e||!e.type)return null;switch(e.type){case"range":return yye.fromJSON(e);case"codedValue":return mye.fromJSON(e);case"inherited":return gye.fromJSON(e)}return null}const rUe=new Mi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var a7;const sUe=new Mi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let rl=a7=class extends xe{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?sUe.fromJSON(i.fieldValueType):null}clone(){return new a7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],rl.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],rl.prototype,"defaultValue",void 0),u([d()],rl.prototype,"description",void 0),u([Ie("description")],rl.prototype,"readDescription",null),u([d({types:vye,json:{read:{reader:GX},write:!0}})],rl.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],rl.prototype,"editable",void 0),u([d({type:wr,json:{write:!0}})],rl.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],rl.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],rl.prototype,"nullable",void 0),u([mt(rUe)],rl.prototype,"type",void 0),u([d()],rl.prototype,"valueType",void 0),u([Ie("valueType",["description"])],rl.prototype,"readValueType",null),rl=a7=u([P("esri.layers.support.Field")],rl);const IE=rl;var l7;let bg=l7=class extends xe{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new l7({mapLayerId:e,gdbVersion:t})}};u([mt({mapLayer:"map-layer"})],bg.prototype,"type",void 0),u([d({type:wr,json:{write:!0}})],bg.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],bg.prototype,"gdbVersion",void 0),bg=l7=u([P("esri.layers.support.source.MapLayerSource")],bg);var c7;let zm=c7=class extends xe{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new c7(n)}};u([mt({queryTable:"query-table"})],zm.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],zm.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],zm.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],zm.prototype,"oidFields",void 0),u([d({type:Ze,json:{write:!0}})],zm.prototype,"spatialReference",void 0),u([mt(Zpe)],zm.prototype,"geometryType",void 0),zm=c7=u([P("esri.layers.support.source.QueryTableDataSource")],zm);var u7;let RT=u7=class extends xe{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new u7({workspaceId:e,dataSourceName:t})}};u([mt({raster:"raster"})],RT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],RT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],RT.prototype,"workspaceId",void 0),RT=u7=u([P("esri.layers.support.source.RasterDataSource")],RT);var h7;let R1=h7=class extends xe{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new h7({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([mt({table:"table"})],R1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],R1.prototype,"dataSourceName",void 0),R1=h7=u([P("esri.layers.support.source.TableDataSource")],R1);var d7,p7;const nUe=da()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Gc=d7=class extends xe{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return Bee()(e,t,i)}castLeftTableSource(e){return up(f7(),e)}readRightTableSource(e,t,i){return Bee()(e,t,i)}castRightTableSource(e){return up(f7(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new d7(n)}};u([mt({joinTable:"join-table"})],Gc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Gc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Gc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Gc.prototype,"leftTableSource",void 0),u([Ie("leftTableSource")],Gc.prototype,"readLeftTableSource",null),u([Nt("leftTableSource")],Gc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Gc.prototype,"rightTableSource",void 0),u([Ie("rightTableSource")],Gc.prototype,"readRightTableSource",null),u([Nt("rightTableSource")],Gc.prototype,"castRightTableSource",null),u([mt(nUe)],Gc.prototype,"joinType",void 0),Gc=d7=u([P("esri.layers.support.source.JoinTableDataSource")],Gc);let Jz=null;function Bee(){return Jz||(Jz=fE({types:f7()})),Jz}let Kz=null;function f7(){return Kz||(Kz={key:"type",base:null,typeMap:{"data-layer":au,"map-layer":bg}}),Kz}const oUe={key:"type",base:null,typeMap:{"join-table":Gc,"query-table":zm,raster:RT,table:R1}};let au=p7=class extends xe{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new p7({fields:e,dataSource:t})}};u([mt({dataLayer:"data-layer"})],au.prototype,"type",void 0),u([d({type:[IE],json:{write:!0}})],au.prototype,"fields",void 0),u([d({types:oUe,json:{write:!0}})],au.prototype,"dataSource",void 0),au=p7=u([P("esri.layers.support.source.DataLayerSource")],au),au.from=Ss(au);function aUe(e,t){return t?ye(F({},t),{query:F(F({},e),t.query)}):{query:e}}function _ye(e){return typeof e=="string"?ho(e):te(e)}function lUe(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=lUe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const mS={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new wu({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator}),minus180Line:new wu({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new wu({paths:[[[180,-180],[180,180]]],spatialReference:Ze.WGS84}),minus180Line:new wu({paths:[[[-180,-180],[-180,180]]],spatialReference:Ze.WGS84})}};function Lh(e,t){return Math.ceil((e-t)/(2*t))}function jX(e,t){const i=QM(e);for(const r of i)for(const s of r)s[0]+=t;return e}function QM(e){return Cv(e)?e.rings:e.paths}async function cUe(e,t,i,r){const s=typeof e=="string"?ho(e):e,n=t[0].spatialReference,o=ye(F({},r),{query:ye(F({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:xE(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await _i(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Wg(h);return p.spatialReference=n,p})}}async function uUe(e,t,i){const r=typeof e=="string"?ho(e):e,s=t[0].spatialReference,n=xE(t[0]),o=ye(F({},i),{query:ye(F({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(hUe(t))})});return dUe((await _i(r.path+"/simplify",o)).data,n,s)}function hUe(e){return{geometryType:xE(e[0]),geometries:e.map(t=>t.toJSON())}}function dUe(e,t,i){const r=Qpe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const bye=de.getLogger("esri.geometry.support.normalizeUtils");function pUe(e){return e.type==="polygon"}function fUe(e){return e[0].type==="polygon"}function mUe(e){return e[0].type==="polyline"}function gUe(e,t){if(!(e instanceof wu||e instanceof la)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw bye.error(s),new q(s)}const i=QM(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let S=1;S<=y-1;S++){const T=S*t,E=m*T+a,C=f*T+l;n.push([E,C])}const v=(p+Math.floor(y-1)*t)/2,b=m*v+a,w=f*v+l;n.push([b,w])}n.push([c,h])}}return pUe(e)?new la({rings:r,spatialReference:e.spatialReference}):new wu({paths:r,spatialReference:e.spatialReference})}function Gee(e,t,i){if(t){const r=gUe(e,1e6);e=gA(r,!0)}return i&&(e=jX(e,i)),e}function jee(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=Lh(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=Lh(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=Lh(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=Lh(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function yUe(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=QM(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*Lh(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(fUe(e))for(const a of QM(n))e[s]=e[s].addRing(a);else if(mUe(e))for(const a of QM(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function wye(e,t,i){var E;if(!Array.isArray(e))return wye([e],t);t&&typeof t!="string"&&bye.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:ki.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const C of e)if(M(C))y.push(C);else if(s||(s=C.spatialReference,n=Rg(s),o=s.isWebMercator,c=o?102100:4326,a=mS[c].maxX,l=mS[c].minX,h=mS[c].plus180Line,p=mS[c].minus180Line),n)if(C.type==="mesh")y.push(C);else if(C.type==="point")y.push(jee(C.clone(),a,l));else if(C.type==="multipoint"){const A=C.clone();A.points=A.points.map(I=>jee(I,a,l)),y.push(A)}else if(C.type==="extent"){const A=C.clone()._normalize(!1,!1,n);y.push(A.rings?new la(A):A)}else if(C.extent){const A=C.extent,I=Lh(A.xmin,l)*(2*a);let L=I===0?C.clone():jX(C.clone(),I);A.offset(I,0),A.intersects(h)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,L=Gee(L,o),m.push(L),y.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,L=Gee(L,o,360),m.push(L),y.push("cut")):y.push(L)}else y.push(C.clone());else y.push(C);let v=Lh(f,a),b=-90;const w=v,S=new wu;for(;v>0;){const C=360*v-180;S.addPath([[C,b],[C,-1*b]]),b*=-1,v--}if(m.length>0&&w>0){const C=yUe(m,await cUe(r,m,S,i)),A=[],I=[];for(let k=0;k<y.length;k++){const z=y[k];if(z!=="cut")I.push(z);else{const V=C.shift(),X=e[k];_(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&V.rings.length>=X.rings.length?(A.push(V),I.push("simplify")):I.push(o?Pg(V):V)}}if(!A.length)return I;const L=await uUe(r,A,i),D=[];for(let k=0;k<I.length;k++){const z=I[k];z!=="simplify"?D.push(z):D.push(o?Pg(L.shift()):L.shift())}return D}const T=[];for(let C=0;C<y.length;C++){const A=y[C];if(A!=="cut")T.push(A);else{const I=m.shift();T.push(o===!0?Pg(I):I)}}return T}function xye(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=xye(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var z0;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(z0||(z0={}));const Hee=4294967296,vUe=new TextDecoder("utf-8"),_Ue=he("safari")||he("ios")?6:he("ff")?12:32;class Jb{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=z0.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new Jb(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*Hee;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*Hee;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=Jb.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){Jb.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case z0.varint:this._decodeVarint();break;case z0.fixed64:this._skip(8);break;case z0.delimited:this._skip(this._getLength());break;case z0.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==z0.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>_Ue){const o=t.subarray(i,r);return vUe.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}Jb.pool=new Ts(Jb,null,e=>{e._data=null,e._dataView=null});class Tl{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new Tl([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new Tl(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Tl(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Xf{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Xf(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function bUe(e){return!(M(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class hxt extends Xf{}class nU{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new nU;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const Tye=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class dxt{constructor(t){this.options=t,this.geometryTypes=Tye,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new nU}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||Cc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=_w(this.options.sourceSpatialReference)/_w(t.spatialReference);if(i!==1)for(const r of t.features){if(!bUe(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new Xf}createSpatialReference(){return{wkid:0}}createGeometry(){return new Tl}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new Tl}}const qee=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Wee=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Xee=["upperLeft","lowerLeft"];function Yee(e){return e>=qee.length?null:qee[e]}function wUe(e){return e>=Wee.length?null:Wee[e]}function Zee(e){return e>=Xee.length?null:Xee[e]}function Qee(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function xUe(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function TUe(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function SUe(e){const s=new Tl;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=Tye[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function EUe(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function CUe(e){const a={type:Yee(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=Yee(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=wUe(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function AUe(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function MUe(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(EUe);break}case 2:a.geometry=e.processMessageWithArgs(TUe,t,i);break;case 4:a.centroid=e.processMessageWithArgs(xUe,t,i);break;default:e.skip()}return a}function OUe(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function RUe(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function PUe(e){const s={originPosition:Zee(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=Zee(e.getEnum());break;case 2:s.scale=e.processMessage(OUe);break;case 3:s.translate=e.processMessage(RUe);break;default:e.skip()}return s}function IUe(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function $Ue(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function DUe(e,t){const v=t.createFeatureResult();v.geometryType=Qee(t,0);let b=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(IUe);break;case 7:v.geometryType=Qee(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs($Ue,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(PUe);break;case 9:{const w=e.getBool();v.exceededTransferLimit=w;break}case 13:t.addField(v,e.processMessage(CUe));break;case 15:b||(t.prepareFeatures(v),b=!0),t.addFeature(v,e.processMessageWithArgs(MUe,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(AUe);break;default:e.skip()}return t.finishFeatureResult(v),v}function LUe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(SUe);break;case 1:s.featureResult=e.processMessageWithArgs(DUe,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function NUe(e,t){try{const r=new Jb(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(LUe,t):r.skip();return s}catch(i){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function FUe(e,t){const i=NUe(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function m7(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=Ume(i.geometryType,t,e.outSpatialReference);if(!M(r))for(const s of i.features)r(s.geometry)}const Jee="Layer does not support extent calculation.";function Sye(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Eye(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=xE(i),s.geometry=Sye(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Cye(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await $E(e,t,"json",r);return m7(t,i,s.data),s}async function UUe(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await Aye(e,t,r),n=s;return n.data=FUe(s.data,i),n}function Aye(e,t,i){return $E(e,t,"pbf",i)}function kUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):$E(e,t,"json",i,{returnIdsOnly:!0})}function zUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):$E(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function VUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):$E(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(Jee);if(s.hasOwnProperty("count"))throw new Error(Jee);return r})}function $E(e,t,i,r={},s={}){const n=typeof e=="string"?ho(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",wye(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=xye(F(F(ye(F({},n.query),{f:i}),s),Eye(t,s)));return _i(ow(n.path,"query"),ye(F({},r),{query:F(F({},c),r.query)}))})}var BUe=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:Sye,executeQuery:Cye,executeQueryForCount:zUe,executeQueryForExtent:VUe,executeQueryForIds:kUe,executeQueryPBF:UUe,executeQueryPBFBuffer:Aye,queryToQueryStringParameters:Eye,runQuery:$E},Symbol.toStringTag,{value:"Module"})),g7;const y7=new Mi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let xo=g7=class extends xe{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=Ze.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Ga.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;_(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&_(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;_(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void y7.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void y7.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Wg(e);return!i&&t.spatialReference&&(r.spatialReference=Ze.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new g7(this.cloneProperties())}cloneProperties(){return te({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=Cv(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(Cv(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=Cv(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],xo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],xo.prototype,"exceededTransferLimit",void 0),u([d({type:[Ga],json:{write:!0}})],xo.prototype,"features",void 0),u([Ie("features")],xo.prototype,"readFeatures",null),u([d({type:[IE],json:{write:!0}})],xo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:y7.read}}})],xo.prototype,"geometryType",void 0),u([He("geometryType")],xo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],xo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],xo.prototype,"hasZ",void 0),u([d({types:Qw,json:{write:!0}})],xo.prototype,"queryGeometry",void 0),u([Ie("queryGeometry")],xo.prototype,"readQueryGeometry",null),u([d({type:Ze,json:{write:!0}})],xo.prototype,"spatialReference",void 0),u([He("spatialReference")],xo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],xo.prototype,"transform",void 0),xo=g7=u([P("esri.rest.support.FeatureSet")],xo),xo.prototype.toJSON.isDefaultToJSON=!0;const oU=xo;var GUe=Object.freeze(Object.defineProperty({__proto__:null,default:oU},Symbol.toStringTag,{value:"Module"}));const Kee={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},jUe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function HUe(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function Kb(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=jUe[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=HUe(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function ete(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function qUe(e,t,i){return e===0?0:e*Kee[t]/Kee[i]}var bd;let Kc=bd=class extends xe{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return tte}static get empty(){return WUe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(bd.allTime)}get isEmpty(){return this.equals(bd.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new bd({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Qs(this.start,r=>ete(r,e)),i=Qs(this.end,r=>Kb(ete(r,e),1,e));return new bd({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return bd.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=uu(this.start,-1/0,a=>a.getTime()),i=uu(this.end,1/0,a=>a.getTime()),r=uu(e.start,-1/0,a=>a.getTime()),s=uu(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new bd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return bd.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new bd,{start:r,end:s}=this;return _(r)&&(i.start=Kb(r,e,t)),_(s)&&(i.end=Kb(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return tte.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new bd({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Kc.prototype,"end",void 0),u([Ie("end")],Kc.prototype,"readEnd",null),u([He("end")],Kc.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Kc.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Kc.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Kc.prototype,"start",void 0),u([Ie("start")],Kc.prototype,"readStart",null),u([He("start")],Kc.prototype,"writeStart",null),Kc=bd=u([P("esri.TimeExtent")],Kc);const tte=new Kc,WUe=new Kc({start:void 0,end:void 0}),om=Kc;var v7;const ite=new Mi({upperLeft:"upper-left",lowerLeft:"lower-left"});let P1=v7=class extends xe{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new v7(te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:Xt,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],P1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],P1.prototype,"mode",void 0),u([d({type:String,json:{read:ite.read,write:ite.write}})],P1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],P1.prototype,"tolerance",void 0),P1=v7=u([P("esri.rest.support.QuantizationParameters")],P1);const XUe=P1;var _7;const rte=new Mi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let wd=_7=class extends xe{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=te(e))}clone(){return new _7({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:te(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],wd.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],wd.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],wd.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:rte.read},write:{target:"statisticType",writer:rte.write}}})],wd.prototype,"statisticType",void 0),u([d({type:Object})],wd.prototype,"statisticParameters",void 0),u([He("statisticParameters")],wd.prototype,"writeStatisticParameters",null),wd=_7=u([P("esri.rest.support.StatisticDefinition")],wd);const Mye=wd;var jS;const YUe=new Mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ZUe=new Mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=jS=class extends xe{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return kv(jS,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new jS(te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),u([Nt("datumTransformation")],Mt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Mt.prototype,"distance",void 0),u([d({type:au,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),u([d({types:Qw,json:{read:Wg,write:!0}})],Mt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),u([d({type:Date})],Mt.prototype,"historicMoment",void 0),u([He("historicMoment")],Mt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>jS.MAX_MAX_RECORD_COUNT_FACTOR?jS.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),u([d({json:{write:!0}})],Mt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),u([d({type:Ze,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),u([d({type:[Mye],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),u([He("parameterValues")],Mt.prototype,"writeParameterValues",null),u([d({type:qe,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),u([d({type:XUe,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mt.prototype,"returnZ",void 0),u([d({type:Ze,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),u([mt(YUe,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),u([He("start"),He("num")],Mt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),u([d({type:om,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),u([mt(ZUe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Mt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Mt.prototype,"where",void 0),u([He("where")],Mt.prototype,"writeWhere",null),Mt=jS=u([P("esri.rest.support.Query")],Mt);const mu=Mt;async function e6(e,t,i){const r=await QUe(e,t,i);return oU.fromJSON(r)}async function QUe(e,t,i){const r=_ye(e),s=F({},i),n=mu.from(t),{data:o}=await Cye(r,n,n.sourceSpatialReference,s);return o}function ha(e,t){return e?t?4:3:t?3:2}const x3=de.getLogger("esri.layers.graphics.featureConversionUtils"),Oye={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Rye=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},AF=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},JUe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},Pye=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function HX(e,t,i,r){if(e){if(i)return t&&r?Pye:AF;if(t&&r)return JUe}else if(t&&r)return AF;return Rye}function t6({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function i6({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function ste({scale:e,translate:t},i){return i*e[0]+t[0]}function nte({scale:e,translate:t},i){return t[1]-i*e[1]}function pxt(e,t,i){return e?t?i?XX(e):qX(e):i?WX(e):aU(e):null}function aU(e){const t=e.coords;return{x:t[0],y:t[1]}}function Iye(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function qX(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function KUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function WX(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function eke(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function XX(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function tke(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function ike(e,t,i,r){let s=aU;i&&r?s=XX:i?s=qX:r&&(s=WX);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function YX(e,t){return e&&t?tke:e?KUe:t?eke:Iye}function rke(e,t,i,r,s){const n=YX(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new Tl,a)),e.push(new Xf(c,l,null,l[s]))}return e}function fxt(e,t,i=YX(t.z!=null,t.m!=null)){return i(e,t)}function ske(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=$ye(n,i,r)),e.push({attributes:o,geometry:a})}return e}function $ye(e,t,i){if(M(e))return null;const r=ha(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function nke(e,t,i,r,s){const n=ha(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Dye(new Tl,a,n)),e.push(new Xf(c,l,null,l[s]))}return e}function Dye(e,t,i=ha(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function oke(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=Lye(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Lye(e,t,i){if(!e)return null;const r=ha(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function ake(e,t,i,r,s){const n=ha(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Nye(new Tl,a,n)),e.push(new Xf(c,l,null,l[s]))}return e}function Nye(e,t,i=ha(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function lke(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=Fye(n,i,r)),_(a)){const c=aU(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function Fye(e,t,i){if(!e)return null;const r=ha(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function cke(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=Uye(new Tl,o,i,r)),_(a)?e.push(new Xf(c,l,Iye(new Tl,a),l[s])):e.push(new Xf(c,l,null,l[s]))}return e}function Uye(e,t,i=t.hasZ,r=t.hasM){return uke(e,t.rings,i,r),e}function uke(e,t,i,r){const s=ha(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const HS=[],JM=[];function mxt(e,t,i,r,s){HS[0]=e;const[n]=kye(JM,HS,t,i,r,s);return HS.length=JM.length=0,n}function kye(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new Xf(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return rke(e,t,r,s,n);case"esriGeometryMultipoint":return nke(e,t,r,s,n);case"esriGeometryPolyline":return ake(e,t,r,s,n);case"esriGeometryPolygon":return cke(e,t,r,s,n);default:x3.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function gxt(e,t,i,r){JM[0]=e,zye(HS,JM,t,i,r);const s=HS[0];return HS.length=JM.length=0,s}function hke(e,t,i){if(M(e))return null;const r=new Tl;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),w5(e)?YX(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):Cv(e)?Uye(r,e,t,i):d3(e)?Nye(r,e,ha(t,i)):b5(e)?Dye(r,e,ha(t,i)):void x3.error("convertFromGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${e}'`))}function dke(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(M(s))return null;switch(t){case"esriGeometryPoint":{let n=aU;return i&&r?n=XX:i?n=qX:r&&(n=WX),n(s)}case"esriGeometryMultipoint":return $ye(s,i,r);case"esriGeometryPolyline":return Lye(s,i,r);case"esriGeometryPolygon":return Fye(s,i,r);default:return void x3.error("convertToGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${t}'`))}}function pke(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function zye(e,t,i,r,s){if(e.length=0,M(i))return pke(e,t);switch(i){case"esriGeometryPoint":return ike(e,t,r,s);case"esriGeometryMultipoint":return ske(e,t,r,s);case"esriGeometryPolyline":return oke(e,t,r,s);case"esriGeometryPolygon":return lke(e,t,r,s);default:x3.error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${i}'`))}return e}function yxt(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:zye([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:dke(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function vxt(e,t){const i=new nU,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&kye(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(x3.error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function _xt(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&ate(n.geometry,n.geometry,r,s,t),_(n.centroid)&&ate(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function bxt(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Tl,ote(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new Tl,ote(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function ote(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),M(t)||!t.coords.length)return null;const l=Oye[s],{coords:c,lengths:h}=t,p=ha(i,r),f=ha(i&&o,r&&a),m=HX(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,t6(n,c[0]),i6(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y,v,b,w,S=0,T=0,E=T;for(const C of h){if(C<l)continue;let A=0;T=E,b=y=t6(n,c[S]),w=v=i6(n,c[S+1]),m(e.coords,c,T,S,b,w),A++,S+=p,T+=f;for(let I=1;I<C;I++,S+=p)b=t6(n,c[S]),w=i6(n,c[S+1]),b===y&&w===v||(m(e.coords,c,T,S,b-y,w-v),T+=f,A++,y=b,v=w);A>=l&&(e.lengths.push(A),E=T)}return e.coords.length=E,e.coords.length?e:null}function wxt(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=Oye[s],{coords:c,lengths:h}=t,p=ha(i,r),f=ha(i&&o,r&&a),m=HX(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y=0;const v=n*n;for(const b of h){if(b<l){y+=b*p;continue}const w=e.coords.length/f,S=y,T=y+(b-1)*p;m(e.coords,c,e.coords.length,S,c[S],c[S+1]),b7(e.coords,c,p,v,m,S,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/f-w;E>=l?e.lengths.push(E):e.coords.length=w*f,y+=b*p}return e.coords.length?e:null}function fke(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function b7(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=fke(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&b7(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&b7(e,t,i,r,s,c,o))}function xxt(e,t,i,r){if(M(t)||!t.coords||!t.coords.length)return null;const s=ha(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function ate(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?Pye:AF:r?AF:Rye,l=ha(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,ste(s,n[0]),nte(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let y=ste(s,n[p]),v=nte(s,n[p+1]);a(e.coords,n,p,p,y,v),p+=l;for(let b=1;b<m;b++,p+=l)y+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,y,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function Txt(e,t,i,r,s,n){const o=ha(i,r),a=HX(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function mke(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function Sxt(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=mke(i,s,r[o],t),s+=o;return Math.abs(n)}function Ext(e,t){if(M(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var w7;let ms=w7=class extends xe{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new w7(te({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],ms.prototype,"cacheHint",void 0),u([d({type:au,json:{write:!0}})],ms.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],ms.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],ms.prototype,"geometryPrecision",void 0),u([d({type:Date})],ms.prototype,"historicMoment",void 0),u([He("historicMoment")],ms.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],ms.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],ms.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ms.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ms.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ms.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],ms.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ms.prototype,"start",void 0),u([He("start"),He("num")],ms.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ms.prototype,"num",void 0),u([d({json:{write:!0}})],ms.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ms.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ms.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ms.prototype,"where",void 0),ms=w7=u([P("esri.rest.support.RelationshipQuery")],ms),ms.from=Ss(ms);const x7=ms;var T7;let PT=T7=class extends xe{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new T7({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],PT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],PT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],PT.prototype,"orderByFields",void 0),PT=T7=u([P("esri.rest.support.TopFilter")],PT);const gke=PT;var S7;const lte=new Mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),cte=new Mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Kr=S7=class extends xe{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new S7(te({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Kr.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Kr.prototype,"distance",void 0),u([d({types:Qw,json:{read:Wg,write:!0}})],Kr.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Kr.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Kr.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Kr.prototype,"num",void 0),u([d({json:{write:!0}})],Kr.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Kr.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Kr.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Kr.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Kr.prototype,"resultType",void 0),u([d({json:{write:!0}})],Kr.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Kr.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Kr.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Kr.prototype,"start",void 0),u([He("start"),He("num")],Kr.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:lte.read},write:{target:"spatialRel",writer:lte.write}}})],Kr.prototype,"spatialRelationship",void 0),u([d({type:om,json:{write:!0}})],Kr.prototype,"timeExtent",void 0),u([d({type:gke,json:{write:!0}})],Kr.prototype,"topFilter",void 0),u([d({type:String,json:{read:cte.read,write:{writer:cte.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Kr.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Kr.prototype,"where",void 0),Kr=S7=u([P("esri.rest.support.TopFeaturesQuery")],Kr),Kr.from=Ss(Kr);const ZP=Kr,yke="esri.widgets.Feature.support.relatedFeatureUtils",ute=de.getLogger(yke),hte=new Map;function E7(e){if(!Tg(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function vke(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function _ke({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function bke(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function wke(e,t){const i=vke(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function xke(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function Tke(e,t,i,r){const s=new x7;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function Ske(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function Eke(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=_ke({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await Tke(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new mu;v.where=Ske(n.objectIdField,y,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:e6(c,v)};return Ba(b)}}const f=p==null?void 0:p.keyField;if(f){const m=x5(Rke(n.fields,f)),y=bke(e.attributes,o.keyField),v=m?`${f}=${y}`:`${f}='${y}'`,b=e6(c,new mu({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),r),w=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?e6(c,new mu({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:b};return w&&(S.statsFeatures=w),Ba(S)}return null}function Cke(e,t){return _i(e,{query:{f:"json"},signal:t&&t.signal})}function Ake({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new q("relation-required","A relation is required on a layer to retrieve related records.");throw ute.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new q("A related table ID is required on a layer to retrieve related records.");throw ute.error(p),p}const l=`${t.url}/${a}`,c=hte.get(l),h=c||Cke(l,i);c||hte.set(l,h),r[n]=h}),Ba(r)}function Mke({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=Eke(e,n,i,r))}),Ba(s)}function Oke({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new Mye({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function Rke(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const dte={chartAnimation:!0};let Gn=class extends Ae{constructor(e){super(e),this.abilities=F({},dte),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return F(F({},dte),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=e7(o,s);i.sourceURL=KG({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=e7(n,s);i.linkURL=KG({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=o4e(l,n),c&&(t.normalizeField=EF(c,n)),!l.some(p=>!!(r[p]!=null||Tg(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(Tg(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var y;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=E7(i),{layerId:l,fieldName:c}=a,h=(y=this.relatedInfos)==null?void 0:y.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(v=>{const{attributes:b}=v;b&&Object.keys(b).forEach(w=>{w===c&&o.push(this._getChartOption({value:n,attributes:b,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:w,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,E,C,A,I,L;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?Tg(h)?i[E7(h).fieldName]:i[h]:null,m=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],y=new afe({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(Tg(s)){const D=c.get(s.toLowerCase()),k=c.get(p.toLowerCase()),z=(T=D==null?void 0:D.fieldName)!=null?T:s,V=(I=(A=(C=r[(E=k==null?void 0:k.fieldName)!=null?E:p])!=null?C:D==null?void 0:D.label)!=null?A:D==null?void 0:D.fieldName)!=null?I:n,X=r[z];return y.tooltip=this._getTooltip({label:V,value:X,chartType:a}),y}const v=sye(o,s),b=EF(s,l),w=p&&r[p]!==void 0?r[p]:iye(v||new f3({fieldName:b}),(L=this.popupTemplate)==null?void 0:L.expressionInfos),S=r[b];return y.tooltip=this._getTooltip({label:w,value:S,chartType:a}),y}};u([d()],Gn.prototype,"abilities",void 0),u([Nt("abilities")],Gn.prototype,"castAbilities",null),u([d()],Gn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Gn.prototype,"activeMediaInfo",null),u([d()],Gn.prototype,"attributes",void 0),u([d()],Gn.prototype,"description",void 0),u([d()],Gn.prototype,"fieldInfoMap",void 0),u([d()],Gn.prototype,"formattedAttributes",void 0),u([d()],Gn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Gn.prototype,"formattedMediaInfos",null),u([d()],Gn.prototype,"layer",void 0),u([d({readOnly:!0})],Gn.prototype,"formattedMediaInfoCount",null),u([d()],Gn.prototype,"mediaInfos",void 0),u([d()],Gn.prototype,"popupTemplate",void 0),u([d()],Gn.prototype,"relatedInfos",void 0),u([d()],Gn.prototype,"title",void 0),Gn=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Gn);const Db=Gn;var pte=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Pke=[].concat(pte.slice(30,39),pte.slice(28,30).reverse()),Ike=[{name:"default",colors:Pke},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const fte="en-us",ZX=new Map([["ar",()=>import("./ar.e8be3742.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.207f128e.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.87074fc1.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.0604af61.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.5b3a7f75.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.5dfdb9b6.js").then(e=>e.d)],["de-de",()=>import("./de_DE.54fa06bc.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.8b08fc60.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.75d69ab6.js").then(e=>e.e)],["en-us",()=>import("./en_US.1ffab1e4.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.e0731dc9.js").then(e=>e.e)],["es-es",()=>import("./es_ES.b44251c6.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.624fe1e9.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.91beea69.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.bc7e1a46.js").then(e=>e.f)],["he-il",()=>import("./he_IL.54210e00.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.704b3d5b.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.49a0f90d.js").then(e=>e.h)],["id-id",()=>import("./id_ID.9eaeaac2.js").then(e=>e.i)],["it-it",()=>import("./it_IT.6ba59859.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.3b015825.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.95798c0d.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.8c6349d0.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.b3de130f.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.3ba7a210.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.b0b7b67b.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.33a538c2.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.b3f31eed.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.6f05593d.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.c7ef3212.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.a0c36884.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.325eda32.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.d9a696f4.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.8ad5609d.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.8cd58473.js").then(e=>e.s)],["th-th",()=>import("./th_TH.d1bb3995.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.5fa60813.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.4b2fab5b.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.6a8638cf.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.a9168bb7.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.a31a4993.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.a31a4993.js").then(e=>e.z)]]);function $ke(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of ZX.keys())if(r.startsWith(t)){i=r;break}return i}function Dke(e){return e?ZX.has(e.toLowerCase())?e.toLowerCase():$ke(e)||fte:fte}let yx,uC;async function Lke(e=Tu()){if(e=Dke(e),yx&&e===uC)return yx;yx=import("./index.649b2033.js").then(t=>t.i),uC=e;try{const[t,i]=await Promise.all([yx,ZX.get(uC)()]);uC===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return yx=null,uC=null,null}return yx}function Nke(e,t="default"){const i=Ike.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const Cs={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},r6=.05,s6=.95,n6=15,ym="color",Cy="tooltip",hC="value",mte="default-line-value";let Xl=class extends ja{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Db,this.messages=null,this._getChartDependencies=async i=>{const r=await Lke(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new NX,this.own([ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Ft),ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ft)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return ce("div",{bind:this,class:Cs.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ce("div",{key:"media-element-container",class:Cs.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=eye(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,v=m?m.sourceURL:c,b=ce("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:v});return(h?ce("a",{title:a,href:h,rel:f,target:p},b):null)||b}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return ce("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Cs.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?ce("div",{key:"media-title",class:Cs.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?ce("div",{key:"media-caption",class:Cs.mediaItemCaption,innerHTML:e.caption}):null;return ce("div",{key:"media-container",class:Cs.mediaItemContainer},ce("div",{key:"media-item-container",class:Cs.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(Cs.mediaButton,Cs.mediaPrevious):this.classes(Cs.mediaButton,Cs.mediaNext),s=t?this.classes(Cs.mediaIcon,Cs.mediaPreviousIconLTR,Cs.iconLeftTriangleArrow):this.classes(Cs.mediaIcon,Cs.mediaNextIconLTR,Cs.iconRightTriangleArrow),n=t?this.classes(Cs.mediaIcon,Cs.mediaPreviousIconRTL,Cs.iconRightTriangleArrow):this.classes(Cs.mediaIcon,Cs.mediaNextIconRTL,Cs.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return ce("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},ce("span",{"aria-hidden":"true",class:s}),ce("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await tUe(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(mte,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=cb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=Nke(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}rpe()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[Cy]:m.tooltip,[hC]:m.value,[ym]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=nv(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=hC,o.dataFields.category=Cy,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=ym,o.slices.template.propertyFields.stroke=ym,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=Cy,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=r6,l.renderer.maxLabelPosition=s6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=hC,h.dataFields.categoryX=Cy,h.columns.template.propertyFields.fill=ym,h.columns.template.propertyFields.stroke=ym,e.cursor=new o.XYCursor,s.series.length>n6&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=Cy,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=r6,l.renderer.maxLabelPosition=s6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=hC,h.dataFields.categoryY=Cy,h.columns.template.propertyFields.fill=ym,h.columns.template.propertyFields.stroke=ym,e.cursor=new o.XYCursor,s.series.length>n6&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Cy,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=r6,c.renderer.maxLabelPosition=s6,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=Cy,p.dataFields.valueY=hC,p.strokeWidth=1;const f=s.get(mte);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=ym,m.propertyFields.stroke=ym,e.cursor=new a.XYCursor,n.series.length>n6&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=nv(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([ht("viewModel.attributes")],Xl.prototype,"attributes",void 0),u([ht("viewModel.activeMediaInfoIndex")],Xl.prototype,"activeMediaInfoIndex",void 0),u([ht("viewModel.description")],Xl.prototype,"description",void 0),u([ht("viewModel.fieldInfoMap")],Xl.prototype,"fieldInfoMap",void 0),u([ht("viewModel.layer")],Xl.prototype,"layer",void 0),u([ht("viewModel.mediaInfos")],Xl.prototype,"mediaInfos",void 0),u([ht("viewModel.popupTemplate")],Xl.prototype,"popupTemplate",void 0),u([ht("viewModel.relatedInfos")],Xl.prototype,"relatedInfos",void 0),u([ht("viewModel.title")],Xl.prototype,"title",void 0),u([d({type:Db})],Xl.prototype,"viewModel",void 0),u([d(),za("esri/widgets/Feature/t9n/Feature")],Xl.prototype,"messages",void 0),Xl=u([P("esri.widgets.Feature.FeatureMedia")],Xl);const Vye=Xl;class Fke{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class am{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class ox extends am{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new qe(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new qe(i[0],i[1],void 0,i[2],this._spRef):r&&s?new qe(i[0],i[1],i[2],i[3],this._spRef):new qe(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof ox&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class QX extends am{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new ox(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof QX&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class ax extends Error{}class Uke extends ax{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class kke extends ax{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class zke extends ax{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class qA extends ax{}class Bye extends ax{constructor(t){super(`Invalid unit ${t}`)}}class Eh extends ax{}class Ay extends ax{constructor(){super("Zone is an abstract class")}}const Ke="numeric",gp="short",Mu="long",C7={year:Ke,month:Ke,day:Ke},Gye={year:Ke,month:gp,day:Ke},Vke={year:Ke,month:gp,day:Ke,weekday:gp},jye={year:Ke,month:Mu,day:Ke},Hye={year:Ke,month:Mu,day:Ke,weekday:Mu},qye={hour:Ke,minute:Ke},Wye={hour:Ke,minute:Ke,second:Ke},Xye={hour:Ke,minute:Ke,second:Ke,timeZoneName:gp},Yye={hour:Ke,minute:Ke,second:Ke,timeZoneName:Mu},Zye={hour:Ke,minute:Ke,hourCycle:"h23"},Qye={hour:Ke,minute:Ke,second:Ke,hourCycle:"h23"},Jye={hour:Ke,minute:Ke,second:Ke,hourCycle:"h23",timeZoneName:gp},Kye={hour:Ke,minute:Ke,second:Ke,hourCycle:"h23",timeZoneName:Mu},e0e={year:Ke,month:Ke,day:Ke,hour:Ke,minute:Ke},t0e={year:Ke,month:Ke,day:Ke,hour:Ke,minute:Ke,second:Ke},i0e={year:Ke,month:gp,day:Ke,hour:Ke,minute:Ke},r0e={year:Ke,month:gp,day:Ke,hour:Ke,minute:Ke,second:Ke},Bke={year:Ke,month:gp,day:Ke,weekday:gp,hour:Ke,minute:Ke},s0e={year:Ke,month:Mu,day:Ke,hour:Ke,minute:Ke,timeZoneName:gp},n0e={year:Ke,month:Mu,day:Ke,hour:Ke,minute:Ke,second:Ke,timeZoneName:gp},o0e={year:Ke,month:Mu,day:Ke,weekday:Mu,hour:Ke,minute:Ke,timeZoneName:Mu},a0e={year:Ke,month:Mu,day:Ke,weekday:Mu,hour:Ke,minute:Ke,second:Ke,timeZoneName:Mu};function Zi(e){return typeof e=="undefined"}function ew(e){return typeof e=="number"}function lU(e){return typeof e=="number"&&e%1===0}function Gke(e){return typeof e=="string"}function jke(e){return Object.prototype.toString.call(e)==="[object Date]"}function l0e(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Hke(e){return Array.isArray(e)?e:[e]}function gte(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function qke(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function I2(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Sg(e,t,i){return lU(e)&&e>=t&&e<=i}function Wke(e,t){return e-t*Math.floor(e/t)}function $n(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function V0(e){if(!(Zi(e)||e===null||e===""))return parseInt(e,10)}function M_(e){if(!(Zi(e)||e===null||e===""))return parseFloat(e)}function JX(e){if(!(Zi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function KX(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function T3(e){return e%4===0&&(e%100!==0||e%400===0)}function KM(e){return T3(e)?366:365}function MF(e,t){const i=Wke(t-1,12)+1,r=e+(t-i)/12;return i===2?T3(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function eY(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function OF(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function A7(e){return e>99?e:e>60?1900+e:2e3+e}function c0e(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=F({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function cU(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function u0e(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Eh(`Invalid unit value ${e}`);return t}function RF(e,t){const i={};for(const r in e)if(I2(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=u0e(s)}return i}function eO(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${$n(i,2)}:${$n(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${$n(i,2)}${$n(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function uU(e){return qke(e,["hour","minute","second","millisecond"])}const h0e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,Xke=["January","February","March","April","May","June","July","August","September","October","November","December"],d0e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yke=["J","F","M","A","M","J","J","A","S","O","N","D"];function p0e(e){switch(e){case"narrow":return[...Yke];case"short":return[...d0e];case"long":return[...Xke];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const f0e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],m0e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Zke=["M","T","W","T","F","S","S"];function g0e(e){switch(e){case"narrow":return[...Zke];case"short":return[...m0e];case"long":return[...f0e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const y0e=["AM","PM"],Qke=["Before Christ","Anno Domini"],Jke=["BC","AD"],Kke=["B","A"];function v0e(e){switch(e){case"narrow":return[...Kke];case"short":return[...Jke];case"long":return[...Qke];default:return null}}function eze(e){return y0e[e.hour<12?0:1]}function tze(e,t){return g0e(t)[e.weekday-1]}function ize(e,t){return p0e(t)[e.month-1]}function rze(e,t){return v0e(t)[e.year<0?0:1]}function sze(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function yte(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const nze={D:C7,DD:Gye,DDD:jye,DDDD:Hye,t:qye,tt:Wye,ttt:Xye,tttt:Yye,T:Zye,TT:Qye,TTT:Jye,TTTT:Kye,f:e0e,ff:i0e,fff:s0e,ffff:o0e,F:t0e,FF:r0e,FFF:n0e,FFFF:a0e};class mc{static create(t,i={}){return new mc(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return nze[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return $n(t,i);const r=F({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?eze(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?ize(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?tze(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=mc.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>r?rze(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return yte(mc.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=mc.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return yte(n,s(a))}}class ep{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class S3{get type(){throw new Ay}get name(){throw new Ay}get ianaName(){return this.name}get isUniversal(){throw new Ay}offsetName(t,i){throw new Ay}formatOffset(t,i){throw new Ay}offset(t){throw new Ay}equals(t){throw new Ay}get isValid(){throw new Ay}}let o6=null;class tY extends S3{static get instance(){return o6===null&&(o6=new tY),o6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return c0e(t,i,r)}formatOffset(t,i){return eO(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let uL={};function oze(e){return uL[e]||(uL[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),uL[e]}const aze={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function lze(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function cze(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=aze[n];n==="era"?r[a]=o:Zi(a)||(r[a]=parseInt(o,10))}return r}let QP={};class Zg extends S3{static create(t){return QP[t]||(QP[t]=new Zg(t)),QP[t]}static resetCache(){QP={},uL={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=Zg.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return c0e(t,i,r,this.name)}formatOffset(t,i){return eO(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=oze(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?cze(r,i):lze(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=eY({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let a6=null;class _l extends S3{static get utcInstance(){return a6===null&&(a6=new _l(0)),a6}static instance(t){return t===0?_l.utcInstance:new _l(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new _l(cU(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${eO(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${eO(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return eO(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class uze extends S3{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Q0(e,t){if(Zi(e)||e===null)return t;if(e instanceof S3)return e;if(Gke(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?_l.utcInstance:_l.parseSpecifier(i)||Zg.create(e)}else return ew(e)?_l.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new uze(e)}let vte=()=>Date.now(),_te="system",bte=null,wte=null,xte=null,Tte;class Qn{static get now(){return vte}static set now(t){vte=t}static set defaultZone(t){_te=t}static get defaultZone(){return Q0(_te,tY.instance)}static get defaultLocale(){return bte}static set defaultLocale(t){bte=t}static get defaultNumberingSystem(){return wte}static set defaultNumberingSystem(t){wte=t}static get defaultOutputCalendar(){return xte}static set defaultOutputCalendar(t){xte=t}static get throwOnInvalid(){return Tte}static set throwOnInvalid(t){Tte=t}static resetCaches(){Ds.resetCache(),Zg.resetCache()}}let Ste={};function hze(e,t={}){const i=JSON.stringify([e,t]);let r=Ste[i];return r||(r=new Intl.ListFormat(e,t),Ste[i]=r),r}let M7={};function O7(e,t={}){const i=JSON.stringify([e,t]);let r=M7[i];return r||(r=new Intl.DateTimeFormat(e,t),M7[i]=r),r}let R7={};function dze(e,t={}){const i=JSON.stringify([e,t]);let r=R7[i];return r||(r=new Intl.NumberFormat(e,t),R7[i]=r),r}let P7={};function pze(e,t={}){const o=t,{base:i}=o,r=_P(o,["base"]),s=JSON.stringify([e,r]);let n=P7[s];return n||(n=new Intl.RelativeTimeFormat(e,t),P7[s]=n),n}let WA=null;function fze(){return WA||(WA=new Intl.DateTimeFormat().resolvedOptions().locale,WA)}function mze(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=O7(e).resolvedOptions()}catch{i=O7(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function gze(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function yze(e){const t=[];for(let i=1;i<=12;i++){const r=ii.utc(2016,i,1);t.push(e(r))}return t}function vze(e){const t=[];for(let i=1;i<=7;i++){const r=ii.utc(2016,11,13+i);t.push(e(r))}return t}function JP(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function _ze(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class bze{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=_P(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=F({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=dze(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):KX(t,3);return $n(i,this.padTo)}}}class wze{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&Zg.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:ii.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=F({},this.opts);s&&(n.timeZone=s),this.dtf=O7(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class xze{constructor(t,i,r){this.opts=F({style:"long"},r),!i&&l0e()&&(this.rtf=pze(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):sze(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class Ds{static fromOpts(t){return Ds.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||Qn.defaultLocale,o=n||(s?"en-US":fze()),a=i||Qn.defaultNumberingSystem,l=r||Qn.defaultOutputCalendar;return new Ds(o,a,l,n)}static resetCache(){WA=null,M7={},R7={},P7={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return Ds.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=mze(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=gze(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=_ze(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Ds.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(ye(F({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(ye(F({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return JP(this,t,r,p0e,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=yze(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return JP(this,t,r,g0e,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=vze(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return JP(this,void 0,t,()=>y0e,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ii.utc(2016,11,13,9),ii.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return JP(this,t,i,v0e,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[ii.utc(-40,1,1),ii.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new bze(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new wze(t,this.intl,i)}relFormatter(t={}){return new xze(this.intl,this.isEnglish(),t)}listFormatter(t={}){return hze(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function DE(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function LE(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[F(F({},i),o),a||r,l]},[{},null,1]).slice(0,2)}function NE(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function _0e(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=V0(t[i+s]);return[r,null,i+s]}}const b0e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Tze=`(?:${b0e.source}?(?:\\[(${h0e.source})\\])?)?`,iY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,w0e=RegExp(`${iY.source}${Tze}`),rY=RegExp(`(?:T${w0e.source})?`),Sze=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Eze=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Cze=/(\d{4})-?(\d{3})/,Aze=_0e("weekYear","weekNumber","weekDay"),Mze=_0e("year","ordinal"),Oze=/(\d{4})-(\d\d)-(\d\d)/,x0e=RegExp(`${iY.source} ?(?:${b0e.source}|(${h0e.source}))?`),Rze=RegExp(`(?: ${x0e.source})?`);function qS(e,t,i){const r=e[t];return Zi(r)?i:V0(r)}function Pze(e,t){return[{year:qS(e,t),month:qS(e,t+1,1),day:qS(e,t+2,1)},null,t+3]}function FE(e,t){return[{hours:qS(e,t,0),minutes:qS(e,t+1,0),seconds:qS(e,t+2,0),milliseconds:JX(e[t+3])},null,t+4]}function E3(e,t){const i=!e[t]&&!e[t+1],r=cU(e[t+1],e[t+2]),s=i?null:_l.instance(r);return[{},s,t+3]}function C3(e,t){const i=e[t]?Zg.create(e[t]):null;return[{},i,t+1]}const Ize=RegExp(`^T?${iY.source}$`),$ze=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function Dze(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(M_(i)),months:f(M_(r)),weeks:f(M_(s)),days:f(M_(n)),hours:f(M_(o)),minutes:f(M_(a)),seconds:f(M_(l),l==="-0"),milliseconds:f(JX(c),p)}]}const Lze={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function sY(e,t,i,r,s,n,o){const a={year:t.length===2?A7(V0(t)):V0(t),month:d0e.indexOf(i)+1,day:V0(r),hour:V0(s),minute:V0(n)};return o&&(a.second=V0(o)),e&&(a.weekday=e.length>3?f0e.indexOf(e)+1:m0e.indexOf(e)+1),a}const Nze=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Fze(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=sY(t,s,r,i,n,o,a);let m;return l?m=Lze[l]:c?m=0:m=cU(h,p),[f,new _l(m)]}function Uze(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const kze=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,zze=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Vze=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Ete(e){const[,t,i,r,s,n,o,a]=e;return[sY(t,s,r,i,n,o,a),_l.utcInstance]}function Bze(e){const[,t,i,r,s,n,o,a]=e;return[sY(t,a,i,r,s,n,o),_l.utcInstance]}const Gze=DE(Sze,rY),jze=DE(Eze,rY),Hze=DE(Cze,rY),qze=DE(w0e),T0e=LE(Pze,FE,E3,C3),Wze=LE(Aze,FE,E3,C3),Xze=LE(Mze,FE,E3,C3),Yze=LE(FE,E3,C3);function Zze(e){return NE(e,[Gze,T0e],[jze,Wze],[Hze,Xze],[qze,Yze])}function Qze(e){return NE(Uze(e),[Nze,Fze])}function Jze(e){return NE(e,[kze,Ete],[zze,Ete],[Vze,Bze])}function Kze(e){return NE(e,[$ze,Dze])}const e6e=LE(FE);function t6e(e){return NE(e,[Ize,e6e])}const i6e=DE(Oze,Rze),r6e=DE(x0e),s6e=LE(FE,E3,C3);function n6e(e){return NE(e,[i6e,T0e],[r6e,s6e])}const o6e="Invalid Duration",S0e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},a6e=F({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},S0e),Gu=146097/400,vx=146097/4800,l6e=F({years:{quarters:4,months:12,weeks:Gu/7,days:Gu,hours:Gu*24,minutes:Gu*24*60,seconds:Gu*24*60*60,milliseconds:Gu*24*60*60*1e3},quarters:{months:3,weeks:Gu/28,days:Gu/4,hours:Gu*24/4,minutes:Gu*24*60/4,seconds:Gu*24*60*60/4,milliseconds:Gu*24*60*60*1e3/4},months:{weeks:vx/7,days:vx,hours:vx*24,minutes:vx*24*60,seconds:vx*24*60*60,milliseconds:vx*24*60*60*1e3}},S0e),I1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],c6e=I1.slice(0).reverse();function O_(e,t,i=!1){const r={values:i?t.values:F(F({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new or(r)}function u6e(e){return e<0?Math.floor(e):Math.ceil(e)}function E0e(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?u6e(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function h6e(e,t){c6e.reduce((i,r)=>Zi(t[r])?i:(i&&E0e(e,t,i,t,r),r),null)}class or{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Ds.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?l6e:a6e,this.isLuxonDuration=!0}static fromMillis(t,i){return or.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new Eh(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new or({values:RF(t,or.normalizeUnit),loc:Ds.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(ew(t))return or.fromMillis(t);if(or.isDuration(t))return t;if(typeof t=="object")return or.fromObject(t);throw new Eh(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=Kze(t);return r?or.fromObject(r,i):or.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=t6e(t);return r?or.fromObject(r,i):or.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new Eh("need to specify a reason the Duration is invalid");const r=t instanceof ep?t:new ep(t,i);if(Qn.throwOnInvalid)throw new zke(r);return new or({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new Bye(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=ye(F({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?mc.create(this.loc,r).formatDurationFromString(this,t):o6e}toHuman(t={}){const i=I1.map(r=>{const s=this.values[r];return Zi(s)?null:this.loc.numberFormatter(ye(F({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(F({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?F({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=KX(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=F({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t),r={};for(const s of I1)(I2(i.values,s)||I2(this.values,s))&&(r[s]=i.get(s)+this.get(s));return O_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=u0e(t(this.values[r],r));return O_(this,{values:i},!0)}get(t){return this[or.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=F(F({},this.values),RF(t,or.normalizeUnit));return O_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),O_(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return h6e(this.matrix,t),O_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>or.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of I1)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;ew(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)I1.indexOf(c)>I1.indexOf(o)&&E0e(this.matrix,s,c,i,o)}else ew(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return O_(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return O_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of I1)if(!i(this.values[r],t.values[r]))return!1;return!0}}const dC="Invalid Interval";function d6e(e,t){return!e||!e.isValid?Ws.invalid("missing or invalid start"):!t||!t.isValid?Ws.invalid("missing or invalid end"):t<e?Ws.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Ws{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new Eh("need to specify a reason the Interval is invalid");const r=t instanceof ep?t:new ep(t,i);if(Qn.throwOnInvalid)throw new kke(r);return new Ws({invalid:r})}static fromDateTimes(t,i){const r=mC(t),s=mC(i),n=d6e(r,s);return n==null?new Ws({start:r,end:s}):n}static after(t,i){const r=or.fromDurationLike(i),s=mC(t);return Ws.fromDateTimes(s,s.plus(r))}static before(t,i){const r=or.fromDurationLike(i),s=mC(t);return Ws.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=ii.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=ii.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Ws.fromDateTimes(n,a);if(o){const c=or.fromISO(s,i);if(c.isValid)return Ws.after(n,c)}else if(l){const c=or.fromISO(r,i);if(c.isValid)return Ws.before(a,c)}}return Ws.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Ws.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(mC).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Ws.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=or.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Ws.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Ws.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Ws.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Ws.fromDateTimes(i,l.time)),i=null);return Ws.merge(s)}difference(...t){return Ws.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:dC}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:dC}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:dC}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:dC}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:dC}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):or.invalid(this.invalidReason)}mapEndpoints(t){return Ws.fromDateTimes(t(this.s),t(this.e))}}class KP{static hasDST(t=Qn.defaultZone){const i=ii.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return Zg.isValidZone(t)}static normalizeZone(t){return Q0(t,Qn.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ds.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ds.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ds.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ds.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Ds.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Ds.create(i,null,"gregory").eras(t)}static features(){return{relative:l0e()}}}function Cte(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(or.fromMillis(r).as("days"))}function p6e(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Cte(a,l);return(c-c%7)/7}],["days",Cte]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function f6e(e,t,i,r){let[s,n,o,a]=p6e(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=or.fromObject(n,r);return c.length>0?or.fromMillis(l,r).shiftTo(...c).plus(h):h}const nY={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Ate={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},m6e=nY.hanidec.replace(/[\[|\]]/g,"").split("");function g6e(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(nY.hanidec)!==-1)t+=m6e.indexOf(e[i]);else for(const s in Ate){const[n,o]=Ate[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function nd({numberingSystem:e},t=""){return new RegExp(`${nY[e||"latn"]}${t}`)}const y6e="missing Intl.DateTimeFormat.formatToParts support";function gr(e,t=i=>i){return{regex:e,deser:([i])=>t(g6e(i))}}const v6e=String.fromCharCode(160),C0e=`[ ${v6e}]`,A0e=new RegExp(C0e,"g");function _6e(e){return e.replace(/\./g,"\\.?").replace(A0e,C0e)}function Mte(e){return e.replace(/\./g,"").replace(A0e," ").toLowerCase()}function od(e,t){return e===null?null:{regex:RegExp(e.map(_6e).join("|")),deser:([i])=>e.findIndex(r=>Mte(i)===Mte(r))+t}}function Ote(e,t){return{regex:e,deser:([,i,r])=>cU(i,r),groups:t}}function l6(e){return{regex:e,deser:([t])=>t}}function b6e(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function w6e(e,t){const i=nd(t),r=nd(t,"{2}"),s=nd(t,"{3}"),n=nd(t,"{4}"),o=nd(t,"{6}"),a=nd(t,"{1,2}"),l=nd(t,"{1,3}"),c=nd(t,"{1,6}"),h=nd(t,"{1,9}"),p=nd(t,"{2,4}"),f=nd(t,"{4,6}"),m=b=>({regex:RegExp(b6e(b.val)),deser:([w])=>w,literal:!0}),v=(b=>{if(e.literal)return m(b);switch(b.val){case"G":return od(t.eras("short",!1),0);case"GG":return od(t.eras("long",!1),0);case"y":return gr(c);case"yy":return gr(p,A7);case"yyyy":return gr(n);case"yyyyy":return gr(f);case"yyyyyy":return gr(o);case"M":return gr(a);case"MM":return gr(r);case"MMM":return od(t.months("short",!0,!1),1);case"MMMM":return od(t.months("long",!0,!1),1);case"L":return gr(a);case"LL":return gr(r);case"LLL":return od(t.months("short",!1,!1),1);case"LLLL":return od(t.months("long",!1,!1),1);case"d":return gr(a);case"dd":return gr(r);case"o":return gr(l);case"ooo":return gr(s);case"HH":return gr(r);case"H":return gr(a);case"hh":return gr(r);case"h":return gr(a);case"mm":return gr(r);case"m":return gr(a);case"q":return gr(a);case"qq":return gr(r);case"s":return gr(a);case"ss":return gr(r);case"S":return gr(l);case"SSS":return gr(s);case"u":return l6(h);case"uu":return l6(a);case"uuu":return gr(i);case"a":return od(t.meridiems(),0);case"kkkk":return gr(n);case"kk":return gr(p,A7);case"W":return gr(a);case"WW":return gr(r);case"E":case"c":return gr(i);case"EEE":return od(t.weekdays("short",!1,!1),1);case"EEEE":return od(t.weekdays("long",!1,!1),1);case"ccc":return od(t.weekdays("short",!0,!1),1);case"cccc":return od(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Ote(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Ote(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return l6(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(e)||{invalidReason:y6e};return v.token=e,v}const x6e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function T6e(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=x6e[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function S6e(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function E6e(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(I2(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function C6e(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Zi(e.z)||(i=Zg.create(e.z)),Zi(e.Z)||(i||(i=new _l(e.Z)),r=e.Z),Zi(e.q)||(e.M=(e.q-1)*3+1),Zi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Zi(e.u)||(e.S=JX(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let c6=null;function A6e(){return c6||(c6=ii.fromMillis(1555555555555)),c6}function M6e(e,t){if(e.literal)return e;const i=mc.macroTokenToFormatOpts(e.val);if(!i)return e;const n=mc.create(t,i).formatDateTimeParts(A6e()).map(o=>T6e(o,t,i));return n.includes(void 0)?e:n}function O6e(e,t){return Array.prototype.concat(...e.map(i=>M6e(i,t)))}function M0e(e,t,i){const r=O6e(mc.parseFormat(i),e),s=r.map(o=>w6e(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=S6e(s),l=RegExp(o,"i"),[c,h]=E6e(t,l,a),[p,f,m]=h?C6e(h):[null,null,void 0];if(I2(h,"a")&&I2(h,"H"))throw new qA("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function R6e(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=M0e(e,t,i);return[r,s,n,o]}const O0e=[0,31,59,90,120,151,181,212,243,273,304,334],R0e=[0,31,60,91,121,152,182,213,244,274,305,335];function Nh(e,t){return new ep("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function P0e(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function I0e(e,t,i){return i+(T3(e)?R0e:O0e)[t-1]}function $0e(e,t){const i=T3(e)?R0e:O0e,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function I7(e){const{year:t,month:i,day:r}=e,s=I0e(t,i,r),n=P0e(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=OF(a)):o>OF(t)?(a=t+1,o=1):a=t,F({weekYear:a,weekNumber:o,weekday:n},uU(e))}function Rte(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=P0e(t,1,4),n=KM(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=KM(a)):o>n?(a=t+1,o-=KM(t)):a=t;const{month:l,day:c}=$0e(a,o);return F({year:a,month:l,day:c},uU(e))}function u6(e){const{year:t,month:i,day:r}=e,s=I0e(t,i,r);return F({year:t,ordinal:s},uU(e))}function Pte(e){const{year:t,ordinal:i}=e,{month:r,day:s}=$0e(t,i);return F({year:t,month:r,day:s},uU(e))}function P6e(e){const t=lU(e.weekYear),i=Sg(e.weekNumber,1,OF(e.weekYear)),r=Sg(e.weekday,1,7);return t?i?r?!1:Nh("weekday",e.weekday):Nh("week",e.week):Nh("weekYear",e.weekYear)}function I6e(e){const t=lU(e.year),i=Sg(e.ordinal,1,KM(e.year));return t?i?!1:Nh("ordinal",e.ordinal):Nh("year",e.year)}function D0e(e){const t=lU(e.year),i=Sg(e.month,1,12),r=Sg(e.day,1,MF(e.year,e.month));return t?i?r?!1:Nh("day",e.day):Nh("month",e.month):Nh("year",e.year)}function L0e(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=Sg(t,0,23)||t===24&&i===0&&r===0&&s===0,o=Sg(i,0,59),a=Sg(r,0,59),l=Sg(s,0,999);return n?o?a?l?!1:Nh("millisecond",s):Nh("second",r):Nh("minute",i):Nh("hour",t)}const h6="Invalid DateTime",Ite=864e13;function eI(e){return new ep("unsupported zone",`the zone "${e.name}" is not supported`)}function d6(e){return e.weekData===null&&(e.weekData=I7(e.c)),e.weekData}function pC(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ii(ye(F(F({},i),t),{old:i}))}function N0e(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function $te(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function hL(e,t,i){return N0e(eY(e),t,i)}function Dte(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=ye(F({},e.c),{year:r,month:s,day:Math.min(e.c.day,MF(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=or.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=eY(n);let[l,c]=N0e(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function fC(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=ii.fromObject(e,ye(F({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return ii.invalid(new ep("unparsable",`the input "${s}" can't be parsed as ${r}`))}function tI(e,t,i=!0){return e.isValid?mc.create(Ds.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function p6(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=$n(e.c.year,i?6:4),t?(r+="-",r+=$n(e.c.month),r+="-",r+=$n(e.c.day)):(r+=$n(e.c.month),r+=$n(e.c.day)),r}function Lte(e,t,i,r,s,n){let o=$n(e.c.hour);return t?(o+=":",o+=$n(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=$n(e.c.minute),(e.c.second!==0||!i)&&(o+=$n(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=$n(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=$n(Math.trunc(-e.o/60)),o+=":",o+=$n(Math.trunc(-e.o%60))):(o+="+",o+=$n(Math.trunc(e.o/60)),o+=":",o+=$n(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const F0e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},$6e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},D6e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},U0e=["year","month","day","hour","minute","second","millisecond"],L6e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],N6e=["year","ordinal","hour","minute","second","millisecond"];function Nte(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Bye(e);return t}function Fte(e,t){const i=Q0(t.zone,Qn.defaultZone),r=Ds.fromObject(t),s=Qn.now();let n,o;if(Zi(e.year))n=s;else{for(const c of U0e)Zi(e[c])&&(e[c]=F0e[c]);const a=D0e(e)||L0e(e);if(a)return ii.invalid(a);const l=i.offset(s);[n,o]=hL(e,l,i)}return new ii({ts:n,zone:i,loc:r,o})}function Ute(e,t,i){const r=Zi(i.round)?!0:i.round,s=(o,a)=>(o=KX(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function kte(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class ii{constructor(t){const i=t.zone||Qn.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new ep("invalid input"):null)||(i.isValid?null:eI(i));this.ts=Zi(t.ts)?Qn.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=$te(this.ts,a),r=Number.isNaN(s.year)?new ep("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||Ds.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new ii({})}static local(){const[t,i]=kte(arguments),[r,s,n,o,a,l,c]=i;return Fte({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=kte(arguments),[r,s,n,o,a,l,c]=i;return t.zone=_l.utcInstance,Fte({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=jke(t)?t.valueOf():NaN;if(Number.isNaN(r))return ii.invalid("invalid input");const s=Q0(i.zone,Qn.defaultZone);return s.isValid?new ii({ts:r,zone:s,loc:Ds.fromObject(i)}):ii.invalid(eI(s))}static fromMillis(t,i={}){if(ew(t))return t<-Ite||t>Ite?ii.invalid("Timestamp out of range"):new ii({ts:t,zone:Q0(i.zone,Qn.defaultZone),loc:Ds.fromObject(i)});throw new Eh(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(ew(t))return new ii({ts:t*1e3,zone:Q0(i.zone,Qn.defaultZone),loc:Ds.fromObject(i)});throw new Eh("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=Q0(i.zone,Qn.defaultZone);if(!r.isValid)return ii.invalid(eI(r));const s=Qn.now(),n=Zi(i.specificOffset)?r.offset(s):i.specificOffset,o=RF(t,Nte),a=!Zi(o.ordinal),l=!Zi(o.year),c=!Zi(o.month)||!Zi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Ds.fromObject(i);if((h||a)&&p)throw new qA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new qA("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,v,b=$te(s,n);m?(y=L6e,v=$6e,b=I7(b)):a?(y=N6e,v=D6e,b=u6(b)):(y=U0e,v=F0e);let w=!1;for(const L of y){const D=o[L];Zi(D)?w?o[L]=v[L]:o[L]=b[L]:w=!0}const S=m?P6e(o):a?I6e(o):D0e(o),T=S||L0e(o);if(T)return ii.invalid(T);const E=m?Rte(o):a?Pte(o):o,[C,A]=hL(E,n,r),I=new ii({ts:C,zone:r,o:A,loc:f});return o.weekday&&h&&t.weekday!==I.weekday?ii.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(t,i={}){const[r,s]=Zze(t);return fC(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=Qze(t);return fC(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=Jze(t);return fC(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Zi(t)||Zi(i))throw new Eh("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Ds.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=R6e(o,t,i);return h?ii.invalid(h):fC(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return ii.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=n6e(t);return fC(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new Eh("need to specify a reason the DateTime is invalid");const r=t instanceof ep?t:new ep(t,i);if(Qn.throwOnInvalid)throw new Uke(r);return new ii({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?d6(this).weekYear:NaN}get weekNumber(){return this.isValid?d6(this).weekNumber:NaN}get weekday(){return this.isValid?d6(this).weekday:NaN}get ordinal(){return this.isValid?u6(this.c).ordinal:NaN}get monthShort(){return this.isValid?KP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?KP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?KP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?KP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return T3(this.year)}get daysInMonth(){return MF(this.year,this.month)}get daysInYear(){return this.isValid?KM(this.year):NaN}get weeksInWeekYear(){return this.isValid?OF(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=mc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(_l.instance(t),i)}toLocal(){return this.setZone(Qn.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=Q0(t,Qn.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=hL(o,n,t)}return pC(this,{ts:s,zone:t})}else return ii.invalid(eI(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return pC(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=RF(t,Nte),r=!Zi(i.weekYear)||!Zi(i.weekNumber)||!Zi(i.weekday),s=!Zi(i.ordinal),n=!Zi(i.year),o=!Zi(i.month)||!Zi(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new qA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new qA("Can't mix ordinal dates with month/day");let c;r?c=Rte(F(F({},I7(this.c)),i)):Zi(i.ordinal)?(c=F(F({},this.toObject()),i),Zi(i.day)&&(c.day=Math.min(MF(c.year,c.month),c.day))):c=Pte(F(F({},u6(this.c)),i));const[h,p]=hL(c,this.o,this.zone);return pC(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t);return pC(this,Dte(this,i))}minus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t).negate();return pC(this,Dte(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=or.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?mc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):h6}toLocaleString(t=C7,i={}){return this.isValid?mc.create(this.loc.clone(i),t).formatDateTime(this):h6}toLocaleParts(t={}){return this.isValid?mc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=p6(this,o);return a+="T",a+=Lte(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?p6(this,t==="extended"):null}toISOWeekDate(){return tI(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Lte(this,o==="extended",i,t,r,n):null}toRFC2822(){return tI(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return tI(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?p6(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),tI(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():h6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=F({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return or.invalid("created by diffing an invalid DateTime");const s=F({locale:this.locale,numberingSystem:this.numberingSystem},r),n=Hke(i).map(or.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=f6e(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(ii.now(),t,i)}until(t){return this.isValid?Ws.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||ii.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Ute(i,this.plus(r),ye(F({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?Ute(t.base||ii.fromObject({},{zone:this.zone}),this,ye(F({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(ii.isDateTime))throw new Eh("min requires all arguments be DateTimes");return gte(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(ii.isDateTime))throw new Eh("max requires all arguments be DateTimes");return gte(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Ds.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return M0e(o,t,i)}static fromStringExplain(t,i,r={}){return ii.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return C7}static get DATE_MED(){return Gye}static get DATE_MED_WITH_WEEKDAY(){return Vke}static get DATE_FULL(){return jye}static get DATE_HUGE(){return Hye}static get TIME_SIMPLE(){return qye}static get TIME_WITH_SECONDS(){return Wye}static get TIME_WITH_SHORT_OFFSET(){return Xye}static get TIME_WITH_LONG_OFFSET(){return Yye}static get TIME_24_SIMPLE(){return Zye}static get TIME_24_WITH_SECONDS(){return Qye}static get TIME_24_WITH_SHORT_OFFSET(){return Jye}static get TIME_24_WITH_LONG_OFFSET(){return Kye}static get DATETIME_SHORT(){return e0e}static get DATETIME_SHORT_WITH_SECONDS(){return t0e}static get DATETIME_MED(){return i0e}static get DATETIME_MED_WITH_SECONDS(){return r0e}static get DATETIME_MED_WITH_WEEKDAY(){return Bke}static get DATETIME_FULL(){return s0e}static get DATETIME_FULL_WITH_SECONDS(){return n0e}static get DATETIME_HUGE(){return o0e}static get DATETIME_HUGE_WITH_SECONDS(){return a0e}}function mC(e){if(ii.isDateTime(e))return e;if(e&&e.valueOf&&ew(e.valueOf()))return ii.fromJSDate(e);if(e&&typeof e=="object")return ii.fromObject(e);throw new Eh(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const f6={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function k0e(e){e||(e=Tu());let t=e in f6;if(!t){const n=e.split("-");n.length>1&&n[0]in f6&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=f6[e];return{decimal:i,group:r,pattern:s}}function F6e(e,t){const i=k0e((t=F({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:U6e(e,r,t)}const z0e=/[#0,]*[#0](?:\.0*#*)?/;function U6e(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=z0e,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,k6e(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function k6e(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const y=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;y>a.length&&(o[1]=a.padEnd(Number(y),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const y=r[0].substr(0,f);f=y.lastIndexOf(","),f!==-1&&(p=y.length-f-1)}const m=[];for(let y=o[0];y;){const v=y.length-h;m.push(v>0?y.substr(v):y),y=v>0?y.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(i.group||","),o.join(i.decimal||".")}function z6e(e){const t=k0e((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:QO(o,l=>(l="(?:"+zue(l,".")+")").replace(z0e,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+B6e(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function V6e(e,t){const i=z6e(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function B6e(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=zte(e),i=QO(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+QO(e.exponent,s=>s?"([eE]"+zte({signed:e.eSigned})+")":"")}function zte(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",QO(e.signed,t=>t?"[-+]":"",!0)+QO(e.separator,t=>{if(!t)return"(?:\\d+)";(t=zue(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const QO=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return G6e(r.join("|"),i)},G6e=(e,t)=>"("+(t?"?:":"")+e+")";var Vte,Bte;function Cxt(e){return IE.fromJSON(e.toJSON())}function j6e(e){return e.toJSON?e.toJSON():e}function Axt(e){return typeof e=="string"||e instanceof String}function Mxt(e){return typeof e=="number"}function Gte(e){return e instanceof Date}function Oxt(e,t){return e===t||!(!Gte(e)||!Gte(t))&&e.getTime()===t.getTime()}function Rxt(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function Pxt(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new Xt({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function Ixt(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Vte||(Vte={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(Bte||(Bte={}));const $xt=1e3,Dxt={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},jte={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},Lxt={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function Nxt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function Fxt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class V0e{constructor(t){this.value=t}}class B0e{constructor(t){this.value=t}}class oY{constructor(t){this.fn=t}}class aY{constructor(t,i){this.paramCount=i,this.fn=t}}const H6e=oY,q6e=B0e,W6e=V0e,X6e=aY,lu={type:"VOID"},Y6e={type:"BREAK"},Z6e={type:"CONTINUE"};function JO(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function lY(e){return e instanceof oY||e instanceof Fke||e instanceof aY}function PF(e){return!!ta(e)||!!fl(e)||!!$a(e)||!!pl(e)||e===null||e===lu||typeof e=="number"}function Q6e(e,t){return e===void 0?t:e}function ta(e){return typeof e=="string"||e instanceof String}function pl(e){return typeof e=="boolean"}function fl(e){return typeof e=="number"}function J6e(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function jh(e){return e instanceof Array}function K6e(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function eVe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function tVe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function Sw(e){return e instanceof am}function $a(e){return e instanceof Date}function iVe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function rVe(e){return e<0?-Math.round(-e):Math.round(e)}function sVe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function cY(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=JO(t,"\u2030",""),t=JO(t,"\xA4",""),F6e(e,{pattern:t})):e.toString()}function hU(e,t){const i=ii.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(G0e(t),{locale:Tu(),numberingSystem:"latn"})}function G0e(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function Tr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function nVe(e,t,i){if(e===null){if(t===null||t===lu)return Tr(null,null,i);if(fl(t))return Tr(0,t,i);if(ta(t)||pl(t))return Tr(0,Ps(t),i);if($a(t))return Tr(0,t.getTime(),i)}if(e===lu){if(t===null||t===lu)return Tr(null,null,i);if(fl(t))return Tr(0,t,i);if(ta(t)||pl(t))return Tr(0,Ps(t),i);if($a(t))return Tr(0,t.getTime(),i)}else if(fl(e)){if(fl(t))return Tr(e,t,i);if(pl(t))return Tr(e,Ps(t),i);if(t===null||t===lu)return Tr(e,0,i);if(ta(t))return Tr(e,Ps(t),i);if($a(t))return Tr(e,t.getTime(),i)}else if(ta(e)){if(ta(t))return Tr(Mv(e),Mv(t),i);if($a(t))return Tr(Ps(e),t.getTime(),i);if(fl(t))return Tr(Ps(e),t,i);if(t===null||t===lu)return Tr(Ps(e),0,i);if(pl(t))return Tr(Ps(e),Ps(t),i)}else if($a(e)){if($a(t))return Tr(e,t,i);if(t===null||t===lu)return Tr(e.getTime(),0,i);if(fl(t))return Tr(e.getTime(),t,i);if(pl(t)||ta(t))return Tr(e.getTime(),Ps(t),i)}else if(pl(e)){if(pl(t))return Tr(e,t,i);if(fl(t))return Tr(Ps(e),Ps(t),i);if($a(t))return Tr(Ps(e),t.getTime(),i);if(t===null||t===lu)return Tr(Ps(e),0,i);if(ta(t))return Tr(Ps(e),Ps(t),i)}return!!j0e(e,t)&&(i==="<="||i===">=")}function j0e(e,t){if(e===t||e===null&&t===lu||t===null&&e===lu)return!0;if($a(e)&&$a(t))return e.getTime()===t.getTime();if(e instanceof QX||e instanceof ox)return e.equalityTest(t);if(e instanceof qe&&t instanceof qe){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function Mv(e,t){if(ta(e))return e;if(e===null)return"";if(fl(e))return cY(e,t);if(pl(e))return e.toString();if($a(e))return hU(e,t);if(e instanceof Ol)return JSON.stringify(e.toJSON());if(jh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=IF(e[r]);return"["+i.join(",")+"]"}if(e instanceof am){const i=[];for(let r=0;r<e.length();r++)i[r]=IF(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():lY(e)?"object, Function":""}function oVe(e){const t=[];if(jh(e)===!1)return null;if(e instanceof am){for(let i=0;i<e.length();i++)t[i]=Ps(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=Ps(e[i]);return t}function dL(e,t){if(ta(e))return e;if(e===null)return"";if(fl(e))return cY(e,t);if(pl(e))return e.toString();if($a(e))return hU(e,t);if(e instanceof Ol)return e instanceof Xt?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+$7(e.spatialReference)+"}":$7(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(jh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=IF(e[r]);return"["+i.join(",")+"]"}if(e instanceof am){const i=[];for(let r=0;r<e.length();r++)i[r]=IF(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():lY(e)?"object, Function":""}function IF(e){if(e===null)return"null";if(pl(e)||fl(e)||ta(e))return JSON.stringify(e);if(e instanceof Ol||e instanceof am||e instanceof Array)return dL(e);if(e instanceof Date)return JSON.stringify(hU(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===lu)return"null";return"null"}function Ps(e,t){return fl(e)?e:e===null||e===""?0:$a(e)?NaN:pl(e)?e?1:0:jh(e)||e===""||e===void 0?NaN:t!==void 0&&ta(e)?(t=JO(t,"\u2030",""),t=JO(t,"\xA4",""),V6e(e,{pattern:t})):e===lu?0:Number(e)}function aVe(e){if($a(e))return e;if(ta(e)){const t=H0e(e);if(t)return t.toJSDate()}return null}function lVe(e){return $a(e)?ii.fromJSDate(e):ta(e)?H0e(e):null}function H0e(e){const t=/ (\d\d)/;let i=ii.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=ii.fromISO(e),i.isValid)?i:null}function cVe(e){return pl(e)?e:ta(e)?(e=e.toLowerCase())==="true":!!fl(e)&&e!==0&&!isNaN(e)}function uVe(e,t){return M(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function hVe(e){if(e===null)return null;if(e instanceof qe)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof la){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof wu){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof Zw?e.points.length===0?null:e:e instanceof Xt?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function q0e(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=Mv(t);else{if(t==null)return null;if(t==="")return t;t=Ps(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function W0e(e,t){if(!e||!e.domain)return t;let i=null;t=Mv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function dU(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=Hte(o.name,t),n=!0),!0)}),n||s||(s=Hte(e,t)),{field:o,domain:s}}function Hte(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function $7(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function dVe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function $2(e,t){if(!(t instanceof qe))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function pVe(e,t){if(jh(e)||Sw(e)){let i=!1,r=!1,s=[],n=t;if(jh(e)){for(const o of e)$2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof ox)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!Sw(e))throw new Error("Invalid Argument");for(const o of e.toArray())$2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(PW(s,r,i)===!1&&(s=s.slice(0).reverse()),new la({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function fVe(e,t){if(jh(e)||Sw(e)){let i=!1,r=!1,s=[],n=t;if(jh(e)){for(const o of e)$2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof ox)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Sw(e)){for(const o of e.toArray())$2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new wu({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function mVe(e,t){if(jh(e)||Sw(e)){let i=!1,r=!1,s=[],n=t;if(jh(e)){for(const o of e)$2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof ox)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Sw(e)){for(const o of e.toArray())$2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Zw({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function gVe(e,t=!1){const i=[];if(e===null)return i;if(jh(e)===!0){for(let r=0;r<e.length;r++){const s=Mv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof am){for(let r=0;r<e.length();r++){const s=Mv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(PF(e)){const r=Mv(e);return r===""&&t!==!0||i.push(r),i}return[]}let m6=0;function yVe(e){return m6++,m6%100==0?(m6=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function vVe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function KO(e,t=null){return e==null?null:pl(e)||fl(e)||ta(e)?e:e instanceof Ol?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof am?e.toArray().map(i=>KO(i,t)):e instanceof Array?e.map(i=>KO(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function _Ve(e,t,i,r,s){const n=await uY(e,t,i);s[r]=n}async function uY(e,t=null,i=null){if(e instanceof am&&(e=e.toArray()),e==null)return null;if(PF(e)||e instanceof Ol||e instanceof Date)return KO(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||PF(n)||n instanceof Ol||n instanceof Date?s.push(KO(n,i)):(s.push(null),r.push(_Ve(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function bVe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:dU(t,r,e,i)}function wVe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function xVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=dU(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return q0e(n,i)}function TVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return W0e(dU(t,s,e,r),i)}function SVe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(j6e(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:jte[t.geometryType]===void 0?"":jte[t.geometryType],fields:i}}const Uxt=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:V0e,ImplicitResultE:B0e,NativeFunctionE:oY,SizzleFunctionE:aY,NativeFunction:H6e,ImplicitResult:q6e,ReturnResult:W6e,SizzleFunction:X6e,voidOperation:lu,breakResult:Y6e,continueResult:Z6e,multiReplace:JO,isFunctionParameter:lY,isSimpleType:PF,defaultUndefined:Q6e,isString:ta,isBoolean:pl,isNumber:fl,isInteger:J6e,isArray:jh,isFeature:K6e,isFeatureSet:eVe,isFeatureSetCollection:tVe,isImmutableArray:Sw,isDate:$a,pcCheck:iVe,absRound:rVe,generateUUID:sVe,formatNumber:cY,formatDate:hU,standardiseDateFormat:G0e,greaterThanLessThan:nVe,equalityTest:j0e,toString:Mv,toNumberArray:oVe,toStringExplicit:dL,toNumber:Ps,toDate:aVe,toDateTime:lVe,toBoolean:cVe,fixSpatialReference:uVe,fixNullGeometry:hVe,getDomainValue:q0e,getDomainCode:W0e,getDomain:dU,stableStringify:$7,autoCastFeatureToGeometry:dVe,autoCastArrayOfPointsToPolygon:pVe,autoCastArrayOfPointsToPolyline:fVe,autoCastArrayOfPointsToMultiPoint:mVe,toStringArray:gVe,tick:yVe,binaryOperator:vVe,castAsJson:KO,castAsJsonAsync:uY,featureFullDomain:bVe,featureSubtypes:wVe,featureDomainValueLookup:xVe,featureDomainCodeLookup:TVe,featureSchema:SVe},Symbol.toStringTag,{value:"Module"}));var D7;let XA=D7=class extends xe{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new D7({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],XA.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],XA.prototype,"maxValue",void 0),XA=D7=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],XA);var L7;let B0=L7=class extends xe{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new L7({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:te(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],B0.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],B0.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],B0.prototype,"label",void 0),u([d({type:[XA],json:{write:!0}})],B0.prototype,"classBreakInfos",void 0),B0=L7=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],B0);var N7;const iI=new Mi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),rI=new Mi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),qte={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Wte=["high-to-low","above-and-below","centered-on","extremes"],Xte=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Yte=["seconds","minutes","hours","days","months","years"];let Yl=N7=class extends xe{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new N7({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:qte,json:{write:!0}})],Yl.prototype,"endTime",void 0),u([Nt("endTime")],Yl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Yl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Yl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Yl.prototype,"minSliderValue",void 0),u([d({types:qte,json:{write:!0}})],Yl.prototype,"startTime",void 0),u([Nt("startTime")],Yl.prototype,"castStartTime",null),u([d({type:iI.apiValues,value:null,json:{type:iI.jsonValues,read:iI.read,write:iI.write}})],Yl.prototype,"style",null),u([d({type:Xte,value:null,json:{type:Xte,origins:{"web-scene":{type:Wte,write:{writer:(e,t)=>{Wte.includes(e)&&(t.theme=e)}}}},write:!0}})],Yl.prototype,"theme",null),u([d({type:rI.apiValues,json:{type:rI.jsonValues,read:rI.read,write:rI.write}})],Yl.prototype,"type",void 0),u([d({type:Yte,json:{type:Yte,write:!0}})],Yl.prototype,"units",void 0),Yl=N7=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],Yl);const EVe=Yl;let pL=class extends xe{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],pL.prototype,"type",void 0),pL=u([P("esri.rest.support.ColorRamp")],pL);const hY=pL;var F7;let $1=F7=class extends hY{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new F7({fromColor:te(this.fromColor),toColor:te(this.toColor),algorithm:this.algorithm})}};u([mt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],$1.prototype,"algorithm",void 0),u([d({type:We,json:{type:[wr],write:!0}})],$1.prototype,"fromColor",void 0),u([d({type:We,json:{type:[wr],write:!0}})],$1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],$1.prototype,"type",void 0),$1=F7=u([P("esri.rest.support.AlgorithmicColorRamp")],$1);const dY=$1;var U7;let YA=U7=class extends hY{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new U7({colorRamps:te(this.colorRamps)})}};u([d({type:[dY],json:{write:!0}})],YA.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],YA.prototype,"type",void 0),YA=U7=u([P("esri.rest.support.MultipartColorRamp")],YA);const X0e=YA,CVe={key:"type",base:hY,typeMap:{algorithmic:dY,multipart:X0e}};function AVe(e){return e&&e.type?e.type==="algorithmic"?dY.fromJSON(e):e.type==="multipart"?X0e.fromJSON(e):null:null}var k7;const R_=new Mi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),sI=new Mi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Zte=new Mi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Qte=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],MVe=["high-to-low","above-and-below","above","below","90-10"],OVe=["flow-line","wave-front"],RVe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let hn=k7=class extends xe{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return AVe(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new k7({classificationMethod:this.classificationMethod,colorRamp:te(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:te(this.field1),field2:te(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:R_.apiValues,value:null,json:{type:R_.jsonValues,read:R_.read,write:R_.write,origins:{"web-document":{default:"manual",type:R_.jsonValues,read:R_.read,write:R_.write}}}})],hn.prototype,"classificationMethod",null),u([d({types:CVe,json:{write:!0}})],hn.prototype,"colorRamp",void 0),u([Ie("colorRamp")],hn.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],hn.prototype,"fields",null),u([d({type:B0,value:null,json:{write:!0}})],hn.prototype,"field1",null),u([d({type:B0,value:null,json:{write:!0}})],hn.prototype,"field2",null),u([d({type:OVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],hn.prototype,"focus",null),u([d({type:Number,value:null,json:{type:wr,write:!0}})],hn.prototype,"numClasses",null),u([d({type:Qte,json:{type:Qte,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],hn.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hn.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],hn.prototype,"standardDeviationInterval",null),u([d({type:sI.apiValues,value:null,json:{type:sI.jsonValues,read:sI.read,write:sI.write,origins:{"web-scene":{type:Zte.jsonValues,write:{writer:Zte.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],hn.prototype,"type",null),u([d({type:[EVe],json:{write:!0}})],hn.prototype,"visualVariables",void 0),u([d({type:RVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"univariateSymbolStyle",null),u([d({type:MVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"univariateTheme",null),hn=k7=u([P("esri.renderers.support.AuthoringInfo")],hn);const Y0e=hn,g6=new Mi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let ZA=class extends xe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:Y0e,json:{write:!0}})],ZA.prototype,"authoringInfo",void 0),u([d({type:g6.apiValues,readOnly:!0,json:{type:g6.jsonValues,read:!1,write:{writer:g6.write,ignoreOrigin:!0}}})],ZA.prototype,"type",void 0),ZA=u([P("esri.renderers.Renderer")],ZA);const ly=ZA;var z7;let WS=z7=class extends xe{constructor(){super(...arguments),this.title=null}clone(){return new z7({title:this.title})}};u([d({type:String,json:{write:!0}})],WS.prototype,"title",void 0),WS=z7=u([P("esri.renderers.support.LegendOptions")],WS);var V7;let fL=V7=class extends WS{constructor(){super(...arguments),this.showLegend=null}clone(){return new V7({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],fL.prototype,"showLegend",void 0),fL=V7=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],fL);const Z0e=fL,PVe=de.getLogger("esri.renderers.visualVariables.VisualVariable"),y6=new Mi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let xd=class extends xe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(PVe.error(".field: field must be a string value"),null):r3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],xd.prototype,"index",void 0),u([d({type:y6.apiValues,readOnly:!0,json:{read:y6.read,write:y6.write}})],xd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xd.prototype,"field",void 0),u([Nt("field")],xd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],xd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],xd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],xd.prototype,"arcadeRequired",null),u([d({type:Z0e,json:{write:!0}})],xd.prototype,"legendOptions",void 0),xd=u([P("esri.renderers.visualVariables.VisualVariable")],xd);const A3=xd;var B7;let D1=B7=class extends A3{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new B7({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],D1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],D1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],D1.prototype,"normalizationField",void 0),u([d({type:[k4e],json:{write:!0}})],D1.prototype,"stops",null),D1=B7=u([P("esri.renderers.visualVariables.ColorVariable")],D1);const Q0e=D1;var G7;let y0=G7=class extends xe{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return GO(t.transparency)}writeOpacity(e,t,i){t[i]=A5(e)}clone(){return new G7({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],y0.prototype,"label",void 0),u([d({type:Number,json:{type:wr,write:{target:"transparency"}}})],y0.prototype,"opacity",void 0),u([Ie("opacity",["transparency"])],y0.prototype,"readOpacity",null),u([He("opacity")],y0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],y0.prototype,"value",void 0),y0=G7=u([P("esri.renderers.visualVariables.support.OpacityStop")],y0);const IVe=y0;var j7;let L1=j7=class extends A3{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new j7({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],L1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],L1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],L1.prototype,"normalizationField",void 0),u([d({type:[IVe],json:{write:!0}})],L1.prototype,"stops",null),L1=j7=u([P("esri.renderers.visualVariables.OpacityVariable")],L1);const J0e=L1;var H7;let Vm=H7=class extends A3{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new q("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new H7({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Vm.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Vm.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Vm.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Vm.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Vm.prototype,"valueExpressionTitle",void 0),u([He("web-scene","valueExpressionTitle")],Vm.prototype,"writeValueExpressionTitleWebScene",null),Vm=H7=u([P("esri.renderers.visualVariables.RotationVariable")],Vm);const K0e=Vm;var q7;let IT=q7=class extends xe{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new q7({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],IT.prototype,"label",void 0),u([d({type:Number,cast:er,json:{write:!0}})],IT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],IT.prototype,"value",void 0),IT=q7=u([P("esri.renderers.visualVariables.support.SizeStop")],IT);const $Ve=IT;var W7;let mL=W7=class extends Z0e{constructor(){super(...arguments),this.customValues=null}clone(){return new W7({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],mL.prototype,"customValues",void 0),mL=W7=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],mL);const DVe=mL;var $g,Kn;function gS(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function eR(e){return e!=null&&!isNaN(e)&&isFinite(e)}function eve(e){return e.valueExpression?$g.Expression:e.field&&typeof e.field=="string"?$g.Field:$g.Unknown}function LVe(e,t){const i=t||eve(e),r=e.valueUnit||"unknown";return i===$g.Unknown?Kn.Constant:e.stops?Kn.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Kn.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Kn.Proportional:Kn.Additive:Kn.Identity:Kn.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})($g||($g={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Kn||(Kn={}));function kxt(e){}function NVe(e){return()=>e}const D2={inches:Is(1,"meters","inches"),feet:Is(1,"meters","feet"),"us-feet":Is(1,"meters","us-feet"),yards:Is(1,"meters","yards"),miles:Is(1,"meters","miles"),"nautical-miles":Is(1,"meters","nautical-miles"),millimeters:Is(1,"meters","millimeters"),centimeters:Is(1,"meters","centimeters"),decimeters:Is(1,"meters","decimeters"),meters:Is(1,"meters","meters"),kilometers:Is(1,"meters","kilometers"),"decimal-degrees":1/wLe(1,"meters",$i.radius)},Yv=de.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Jte=new Ga,gL=Math.PI,tve=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function ive(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void Yv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(y),w=v.createExecContext(n,b);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=fY(a,c);if(y){const v=y[0],b=y[1],w=v===b?r.stops[v].color:We.blendColors(r.stops[v].color,r.stops[b].color,y[2],_(i)?i.color:void 0);return new We(w)}}}function rve(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(M(i)||M(i.arcade))return void Yv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(y),w=v.createExecContext(n,b);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=fY(a,c);if(y){const v=y[0],b=y[1];if(v===b)return r.stops[v].opacity;{const w=r.stops[v].opacity;return w+(r.stops[b].opacity-w)*y[2]}}}}function sve(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(M(i)||M(i.arcade))return void Yv.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(m),b=y.createExecContext(a,v);if(!p){const w=y.createSyntaxTree(r.valueExpression);p=y.createFunction(w),r.cache.compiledFunc=p}f=y.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function FVe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?UVe(e):h}else if(!r)switch(e.inputValueType){case $g.Expression:{if(M(i)||M(i.arcade))return void Yv.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case $g.Field:n&&(o=n[e.field]);break;case $g.Unknown:o=null}if(!eR(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return eR(c)&&c!==0?o/c:null}function UVe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function pU(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=ove(FVe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function vc(e,t,i){return e==null?null:gS(e)?pU(e,t,i):eR(e)?e:null}function nve(e,t,i){return eR(i)&&e>i?i:eR(t)&&e<t?t:e}function kVe(e,t,i,r){return e+(vc(t.minSize,i,r)||t.minDataValue)}function zVe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),vc(s,t,i)}function VVe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=vc(t.minSize,i,r),o=vc(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?gL*(n/2)**2:n*n,h=c+s*((l?gL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/gL):Math.sqrt(h)}return n+s*(o-n)}function BVe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=vc(t.minSize,i,r),a=vc(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,nve(l,o,a)}function GVe(e,t,i,r,s){const[n,o,a]=fY(e,s);if(n===o)return vc(t.stops[n].size,i,r);{const l=vc(t.stops[n].size,i,r);return l+(vc(t.stops[o].size,i,r)-l)*a}}function jVe(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*D2[t.valueUnit],n=vc(t.minSize,i,r),o=vc(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/gL)/s:a==="radius"||a==="distance"?2*e/s:e/s,nve(l,n,o)}function ove(e,t,i,r,s){switch(t.transformationType){case Kn.Additive:return kVe(e,t,i,r);case Kn.Constant:return zVe(t,i,r);case Kn.ClampedLinear:return VVe(e,t,i,r);case Kn.Proportional:return BVe(e,t,i,r);case Kn.Stops:return GVe(e,t,i,r,s);case Kn.RealWorldSize:return jVe(e,t,i,r);case Kn.Identity:return e;case Kn.Unknown:return null}}function HVe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=vc(e.minSize,Jte,s),o=vc(e.maxSize,Jte,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function pY(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=ive(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=rve(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=sve(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=pU(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function fY(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function qVe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":pU(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var mY=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:qVe,getColor:ive,getOpacity:rve,getRotationAngle:sve,getSize:pU,getSizeForValue:ove,getSizeFromNumberOrVariable:vc,getSizeRangeAtScale:HVe,getVisualVariableValues:pY,viewScaleRE:tve},Symbol.toStringTag,{value:"Module"})),X7;const _x=de.getLogger("esri.renderers.visualVariables.SizeVariable"),nI=new Mi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Y7=new Mi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Kte(e){if(e!=null)return typeof e=="string"||typeof e=="number"?er(e):e.type==="size"?gS(e)?e:(delete(e=F({},e)).type,new nr(e)):void 0}function eie(e,t,i){if(typeof e!="object")return e;const r=new nr;return r.read(e,i),r}let nr=X7=class extends A3{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:tve.test(this.valueExpression)}}set expression(e){_x.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){gS(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),gS(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return eve(this)}set maxDataValue(e){e&&this.stops&&(_x.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(_x.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return Kte(e)}readMaxSize(e,t,i){return eie(e,t,i)}set minDataValue(e){e&&this.stops&&(_x.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(_x.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return Kte(e)}readMinSize(e,t,i){return eie(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(_x.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return LVe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new q("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?Y7.read(e):null}clone(){return new X7({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:gS(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:gS(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Kn.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Kn.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],nr.prototype,"cache",null),u([d({type:nI.apiValues,json:{type:nI.jsonValues,origins:{"web-map":{read:!1}},read:nI.read,write:nI.write}})],nr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],nr.prototype,"expression",null),u([d()],nr.prototype,"index",null),u([d({type:String,readOnly:!0})],nr.prototype,"inputValueType",null),u([d({type:DVe,json:{write:!0}})],nr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"maxSize",null),u([Nt("maxSize")],nr.prototype,"castMaxSize",null),u([Ie("maxSize")],nr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"minSize",null),u([Nt("minSize")],nr.prototype,"castMinSize",null),u([Ie("minSize")],nr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],nr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],nr.prototype,"arcadeRequired",null),u([d({type:String})],nr.prototype,"scaleBy",void 0),u([d({type:[$Ve],value:null,json:{write:!0}})],nr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],nr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],nr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],nr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],nr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],nr.prototype,"valueExpression",void 0),u([Ie("valueExpression",["valueExpression","expression"])],nr.prototype,"readValueExpression",null),u([He("web-scene","valueExpression")],nr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],nr.prototype,"valueRepresentation",void 0),u([d({type:Y7.apiValues,json:{write:Y7.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],nr.prototype,"valueUnit",void 0),u([Ie("valueUnit")],nr.prototype,"readValueUnit",null),nr=X7=u([P("esri.renderers.visualVariables.SizeVariable")],nr);const ave=nr,WVe=de.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),XVe={color:Q0e,size:ave,opacity:J0e,rotation:K0e},YVe=new Mi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),ZVe=/^\[([^\]]+)\]$/i;let yL=class extends Ae{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(ZVe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=YVe.read(a.type),c=XVe[l];c||(WVe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Pu("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],yL.prototype,"visualVariables",null),yL=u([P("esri.renderers.visualVariables.VisualVariableFactory")],yL);const QVe=yL,JVe={base:A3,key:"type",typeMap:{opacity:J0e,color:Q0e,rotation:K0e,size:ave}},UE=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new QVe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Uh(i,r,n.field),n.normalizationField&&Uh(i,r,n.normalizationField),n.valueExpression&&await Rl(i,r,n.valueExpression))}};return u([d({types:[JVe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Ie("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([He("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t},gC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function KVe(e,t=gC){var a,l;if(!e)return{symbol:null};const{retainId:i=gC.retainId,ignoreDrivers:r=gC.ignoreDrivers,hasLabelingContext:s=gC.hasLabelingContext,retainCIM:n=gC.retainCIM}=t;let o;if(vw(e)||e instanceof ix)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new q("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():uv.fromCIMSymbol(e)}else if(e instanceof Qh)o=D5.fromSimpleLineSymbol(e);else if(e instanceof m_)o=uv.fromSimpleMarkerSymbol(e);else if(e instanceof L5)o=uv.fromPictureMarkerSymbol(e);else if(e instanceof f_)o=y3.fromSimpleFillSymbol(e);else{if(!(e instanceof ME))return{error:new q("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?$5.fromTextSymbol(e):uv.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&vw(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const eBe=["building-scene","integrated-mesh","point-cloud","scene"];function $F(e,t,i,r){const s=lve(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function tie(e,t,i,r){const s=lve(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function iie(e){return e instanceof AE||e instanceof ix}function lve(e,t,i){var a;if(M(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!iie(e)){const l=KVe(e,{retainCIM:!0,hasLabelingContext:s});return _(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new q("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!eBe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&iie(e)?(o==null||o.push(new q("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function zxt(e,t){return NDe(e,null,t)}const M3={types:lme,json:{write:{writer:$F},origins:{"web-scene":{types:eee,write:{writer:$F},read:{reader:fE({types:eee})}}}}},cve={types:{base:Ac,key:"type",typeMap:{"simple-fill":Wb.typeMap["simple-fill"],"picture-fill":Wb.typeMap["picture-fill"],"polygon-3d":Wb.typeMap["polygon-3d"]}},json:{write:{writer:$F},origins:{"web-scene":{type:y3,write:{writer:$F}}}}};var Z7;let v0=Z7=class extends xe{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Z7({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],v0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],v0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],v0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],v0.prototype,"maxValue",void 0),u([d(M3)],v0.prototype,"symbol",void 0),v0=Z7=u([P("esri.renderers.support.ClassBreakInfo")],v0);const DF=v0;var Q7;const oI=de.getLogger("esri.renderers.ClassBreaksRenderer"),uve="log",vL="percent-of-total",_L="field",aI=new Mi({esriNormalizeByLog:uve,esriNormalizeByPercentOfTotal:vL,esriNormalizeByField:_L}),tBe=Ss(DF);let En=Q7=class extends UE(ly){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new DF;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(oI.error(".field: field must be a string value"),null):r3(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&_L||i&&vL||null,t&&i&&oI.warn("warning: both normalizationField and normalizationTotal are set!")):e!==_L&&e!==vL||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new DF({minValue:e,maxValue:t,symbol:cme(i)}):tBe(te(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(M(t)||M(t.arcade))&&oI.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(M(t)||M(t.arcade))&&(i=ye(F({},i),{arcade:await jf()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void oI.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(t)||M(t.arcade))){const s=await jf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ye(F({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Q7({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:te(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Rl(e,t,this.valueExpression)];Uh(e,t,this.field),Uh(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=_t(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===uve)s=Math.log(s)*Math.LOG10E;else if(r!==vL||isNaN(n)){if(r===_L&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(cve)],En.prototype,"backgroundFillSymbol",void 0),u([d({type:[DF]})],En.prototype,"classBreakInfos",void 0),u([Ie("classBreakInfos")],En.prototype,"readClassBreakInfos",null),u([He("classBreakInfos")],En.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],En.prototype,"defaultLabel",void 0),u([d(M3)],En.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],En.prototype,"field",void 0),u([Nt("field")],En.prototype,"castField",null),u([d({type:Boolean})],En.prototype,"isMaxInclusive",void 0),u([d({type:WS,json:{write:!0}})],En.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],En.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],En.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>Sh(e),json:{write:!0}})],En.prototype,"normalizationTotal",void 0),u([d({type:aI.apiValues,value:null,json:{type:aI.jsonValues,read:aI.read,write:aI.write}})],En.prototype,"normalizationType",null),u([mt({classBreaks:"class-breaks"})],En.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],En.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],En.prototype,"valueExpressionTitle",void 0),En=Q7=u([P("esri.renderers.ClassBreaksRenderer")],En);const hve=En;class dve{constructor(t,i){this._storage=new BX,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const rie=de.getLogger("esri.renderers.support.DictionaryLoader"),iBe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class gY{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new dve(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(Br(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const v=""+t.attributes[y];s[m]=v}else s[m]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=Uq(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const v=y[0],b=y[1];let w=y[2];if(b==="DashTemplate")w=w.split(" ").map(S=>Number(S));else if(b==="Color"){const S=new We(w).toRgba();w=[S[0],S[1],S[2],255*S[3]]}else w=Number(w);h.push({primitiveName:v,propertyName:b,value:w})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void rie.error("no valid URL!");const i=_i(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:r}]=await Promise.all([i,jf()]);if(!r)throw this._dictionaryPromise=null,new q("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push(ye(F({},h[0]),{name:l}))}return this._dictionaryPromise=GIe(s,_(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=_(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(rie.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)pve(l,a);return new EE({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=_i(r,F({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=F({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=iBe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function pve(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&rBe(s,t)}}function rBe(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":pve(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var Vxt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:gY},Symbol.toStringTag,{value:"Module"})),J7;let Td=J7=class extends UE(ly){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new gY(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r!=null&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new J7({config:te(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:te(this.fieldMap),url:te(this.url),visualVariables:te(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Rl(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:gY})],Td.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Td.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Td.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Td.prototype,"scaleExpression",void 0),u([He("scaleExpression")],Td.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Td.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Td.prototype,"url",void 0),u([He("visualVariables")],Td.prototype,"writeVisualVariables",null),Td=J7=u([P("esri.renderers.DictionaryRenderer")],Td);const sBe=Td;var K7;const nBe=de.getLogger("esri.renderers.support.AttributeColorInfo");let Bm=K7=class extends xe{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(nBe.error(".field: field must be a string value"),null):r3(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new K7({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:We,json:{type:[Number],write:!0}})],Bm.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Bm.prototype,"field",void 0),u([Nt("field")],Bm.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Bm.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Bm.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Bm.prototype,"valueExpressionTitle",void 0),Bm=K7=u([P("esri.renderers.support.AttributeColorInfo")],Bm);const fve=Bm;var ej;let bL=ej=class extends xe{constructor(){super(...arguments),this.unit=null}clone(){return new ej({unit:this.unit})}};u([d({type:String,json:{write:!0}})],bL.prototype,"unit",void 0),bL=ej=u([P("esri.renderers.support.DotDensityLegendOptions")],bL);const oBe=bL;var tj;let ba=tj=class extends UE(ly){constructor(e){super(e),this.attributes=null,this.backgroundColor=new We([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Qh,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new f_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new tj({attributes:te(this.attributes),backgroundColor:te(this.backgroundColor),dotBlendingEnabled:te(this.dotBlendingEnabled),dotShape:te(this.dotShape),dotSize:te(this.dotSize),dotValue:te(this.dotValue),legendOptions:te(this.legendOptions),outline:te(this.outline),referenceScale:te(this.referenceScale),visualVariables:te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Rl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[fve],json:{write:!0}})],ba.prototype,"attributes",void 0),u([d({type:We,json:{write:!0}})],ba.prototype,"backgroundColor",void 0),u([d({type:Boolean}),ht("dotBlendingEnabled")],ba.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],ba.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],ba.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],ba.prototype,"dotSize",void 0),u([d({type:oBe,json:{write:!0}})],ba.prototype,"legendOptions",void 0),u([d({type:Qh,json:{default:null,write:!0}})],ba.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"dotValue",void 0),u([d({type:Number}),ht("dotValue")],ba.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],ba.prototype,"seed",void 0),u([mt({dotDensity:"dot-density"})],ba.prototype,"type",void 0),ba=tj=u([P("esri.renderers.DotDensityRenderer")],ba);const aBe=ba;let $T=class extends Ec(xe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],$T.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],$T.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],$T.prototype,"title",void 0),$T=u([P("esri.renderers.support.HeatmapLegendOptions")],$T);const yY=2.4;function lBe(e){return Iu(e*yY)}function cBe(e){return no(e)/yY}function uBe(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Ne((r-n)/(a-n),0,1);_5(e,s.toArray(),o.toArray(),l)}function Bxt(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=qt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];uBe(o,r,s,l),i.set(o,4*a)}return i}function Gxt(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(no(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=dBe(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const v=y.getObjectId();if(f.has(v))continue;f.add(v);const b=y.readLegacyPointGeometry(),w=128;if(b.x<-w||b.x>=i+w||b.y<-w||b.y>r+w)continue;const S=+p(y),T=Math.max(0,Math.round(b.x)-a),E=Math.max(0,Math.round(b.y)-a),C=Math.min(r,Math.round(b.y)+a),A=Math.min(i,Math.round(b.x)+a);for(let I=E;I<C;I++)for(let L=T;L<A;L++){const D=I*i+L,k=hBe(b.x-L,b.y-I,a);c=l[D]+=k*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function hBe(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function jxt(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function dBe(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var ij;const pBe=de.getLogger("esri.renderers.HeatmapRenderer");function sie(e){if(e!=null){const{maxDensity:i,minDensity:r,radius:s}=e;if(i!=null||r!=null||s!=null){const t=e,{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a}=t;return _P(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}let jn=ij=class extends ly{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new ZM({ratio:0,color:new We("rgba(255, 140, 0, 0)")}),new ZM({ratio:.75,color:new We("rgba(255, 140, 0, 1)")}),new ZM({ratio:.9,color:new We("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return sie(e)}get blurRadius(){return cBe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",lBe(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(yY**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Nn(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,gE(()=>{PAe(pBe,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=sie(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,Iu(256));return new m_({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Uh(e,t,i),r&&typeof r=="string"&&await Rl(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new ij({colorStops:te(this.colorStops),field:this.field,legendOptions:te(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Y0e,json:{write:!1}})],jn.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],jn.prototype,"blurRadius",null),u([d({type:[ZM],json:{write:!0}})],jn.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],jn.prototype,"fieldOffset",void 0),u([d({type:$T,json:{write:!0}})],jn.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],jn.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],jn.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],jn.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],jn.prototype,"minPixelIntensity",null),u([d({type:Number,cast:er,json:{write:!0}})],jn.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],jn.prototype,"referenceScale",void 0),u([mt({heatmap:"heatmap"})],jn.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],jn.prototype,"valueExpression",void 0),u([d({type:String})],jn.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],jn.prototype,"_pixelIntensityToDensity",null),jn=ij=u([P("esri.renderers.HeatmapRenderer")],jn);const mve=jn;let gb=class extends Ec(xe){constructor(){super(...arguments),this.color=new We([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:We,json:{write:!0}})],gb.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],gb.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],gb.prototype,"threshold",void 0),gb=u([P("esri.renderers.support.OthersCategory")],gb);let wL=class extends Ec(xe){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],wL.prototype,"title",void 0),wL=u([P("esri.renderers.support.PieChartLegendOptions")],wL);let jc=class extends UE(Ec(ly)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new We([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new gb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new m_({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Rl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[fve],json:{write:!0}})],jc.prototype,"attributes",void 0),u([d({type:f_,json:{default:null,write:!0}})],jc.prototype,"backgroundFillSymbol",void 0),u([d({type:We,json:{write:!0}})],jc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],jc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],jc.prototype,"holePercentage",void 0),u([d({type:gb,json:{write:!0}})],jc.prototype,"othersCategory",void 0),u([d({type:wL,json:{write:!0}})],jc.prototype,"legendOptions",void 0),u([d({type:Qh,json:{default:null,write:!0}})],jc.prototype,"outline",void 0),u([d({type:Number,cast:er,json:{write:!0}})],jc.prototype,"size",void 0),u([mt({pieChart:"pie-chart"})],jc.prototype,"type",void 0),jc=u([P("esri.renderers.PieChartRenderer")],jc);const fBe=jc;var rj;let N1=rj=class extends UE(ly){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new rj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],N1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],N1.prototype,"label",void 0),u([d(M3)],N1.prototype,"symbol",void 0),u([mt({simple:"simple"})],N1.prototype,"type",void 0),N1=rj=u([P("esri.renderers.SimpleRenderer")],N1);const vY=N1,mBe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function sj(e){return e instanceof Ae}function nie(e){return e instanceof ct?Object.keys(e.items):sj(e)?Nn(e).keys():e?Object.keys(e):[]}function lI(e,t){return e instanceof ct?e.items[t]:e[t]}function gBe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function tO(e){return e?e.declaredClass:null}function gve(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=nie(e),s=nie(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||gBe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&lI(e,p)!==lI(t,p)).concat(n,o).sort(),l=tO(e);if(l&&mBe.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=sj(e)&&sj(t);for(const p of a){const f=lI(e,p),m=lI(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&tO(f)===tO(m)?gve(f,m):{type:"complete",oldValue:f,newValue:m};_(y)&&(_(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function yBe(e,t){if(M(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function Hxt(e,t){for(const i of t)if(yBe(e,i))return!0;return!1}function vBe(e,t){if(!(typeof e=="function"||typeof t=="function"||M(e)&&M(t)))return M(e)||M(t)||typeof e=="object"&&typeof t=="object"&&tO(e)!==tO(t)?{type:"complete",oldValue:e,newValue:t}:gve(e,t)}function cI(e){if(M(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!cI(i))return!1;for(const i of t.removed)if(!cI(i))return!1;for(const i of t.changed)if(!cI(i))return!1;return!0}case"partial":for(const t in e.diff)if(!cI(e.diff[t]))return!1;return!0}}var nj;let _0=nj=class extends xe{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new nj({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],_0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],_0.prototype,"label",void 0),u([d(M3)],_0.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],_0.prototype,"value",void 0),u([Nt("value")],_0.prototype,"castValue",null),_0=nj=u([P("esri.renderers.support.UniqueValueInfo")],_0);const LF=_0,_Be=()=>!!he("enable-feature:force-wosr"),qxt=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),v6={};async function bBe(e,t){try{return{data:(await SBe(e,t)).data,baseUrl:Mhe(e),styleUrl:e}}catch(i){return bp(i),null}}function wBe(e,t,i){const r=_(t.portal)?t.portal:Pl.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return v6[n]||(v6[n]=xBe(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),v6[n]}function xBe(e,t,i){return t.load(i).then(()=>{const r=new _g({disableExtraQuery:!0,query:`owner:${oie} AND type:${aie} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===aie&&o.owner===oie){s=o;break}}if(!s)throw new q("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function TBe(e,t,i){return e.styleUrl?bBe(e.styleUrl,i):e.styleName?wBe(e.styleName,t,i):Promise.reject(new q("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Wxt(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function Xxt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!_Be()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function SBe(e,t){const i=F({responseType:"json",query:{f:"json"}},t);return _i(sp(e),i)}const oie="esri_en",aie="Style",Yxt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var QA;const P_=de.getLogger("esri.renderers.UniqueValueRenderer"),EBe=Ss(LF);let As=QA=class extends UE(ly){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?vBe(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:r3(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new q("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):P_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Pl.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=CE(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=yw(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?P_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void P_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?EBe(e):new LF({value:e,symbol:cme(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)P_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(M(t)||M(t.arcade))&&(i=ye(F({},i),{arcade:await jf()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(M(t)||M(t.arcade)))return void P_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(M(i)||M(i.arcade))){const s=await jf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ye(F({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new QA({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:te(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:te(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=te(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(te(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Rl(e,t,this.valueExpression)];Uh(e,t,this.field),Uh(e,t,this.field2),Uh(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return TBe(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new ix({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new LF({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=_t(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new QA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Pl.getDefault());const r=i.populateFromStyle();return r.catch(s=>{P_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new QA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{P_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],As.prototype,"_cache",null),u([mt({uniqueValue:"unique-value"})],As.prototype,"type",void 0),u([d(cve)],As.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],As.prototype,"field",void 0),u([Nt("field")],As.prototype,"castField",null),u([He("field")],As.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],As.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],As.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],As.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],As.prototype,"valueExpressionTitle",void 0),u([d({type:WS,json:{write:!0}})],As.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],As.prototype,"defaultLabel",void 0),u([d(Fue(F({},M3),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],As.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],As.prototype,"fieldDelimiter",void 0),u([d({type:Pl,readOnly:!0})],As.prototype,"portal",void 0),u([Ie("portal",["styleName"])],As.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],As.prototype,"styleOrigin",void 0),u([Ie("styleOrigin",["styleName","styleUrl"])],As.prototype,"readStyleOrigin",null),u([He("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],As.prototype,"writeStyleOrigin",null),u([d({type:[LF],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],As.prototype,"uniqueValueInfos",null),As=QA=u([P("esri.renderers.UniqueValueRenderer")],As);const _Y=As,O3={key:"type",base:ly,typeMap:{heatmap:mve,simple:vY,"unique-value":_Y,"class-breaks":hve,"dot-density":aBe,dictionary:sBe,"pie-chart":fBe},errorContext:"renderer"},yve={key:"type",base:ly,typeMap:{simple:vY,"unique-value":_Y,"class-breaks":hve,heatmap:mve},errorContext:"renderer"},CBe=fE({types:O3});function ABe(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Pu("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):CBe(e,t,i):null}class bY{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(G8),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new bY,r=this._originStores[Ye.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,te(s),Ye.DEFAULTS)});for(let s=Ye.SERVICE;s<G8;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,te(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=Ye.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=Ye.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Ye.DEFAULTS}forEach(t){this._values.forEach(t)}}const vve=e=>{let t=class extends e{constructor(...i){super(...i);const r=Nn(this),s=r.store,n=new bY;r.store=n,wpe(r,s,n)}read(i,r){Tpe(this,i,r)}getAtOrigin(i,r){const s=_6(this),n=Dh(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return RO(this.originIdOf(i))}originIdOf(i){return _6(this).originOf(i)}revert(i,r){const s=_6(this),n=Dh(r),o=Nn(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function _6(e){return Nn(e).store}let lie=class extends vve(Ae){};lie=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],lie);const MBe=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return b6(this).delete(i,Dh(r))}write(i={},r){return Epe(this,i=i||{},r),i}setAtOrigin(i,r,s){Nn(this).setAtOrigin(i,r,Dh(s))}removeOrigin(i){const r=b6(this),s=Dh(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Ye.USER)}updateOrigin(i,r){const s=b6(this),n=Dh(r),o=this.get(i);for(let a=n+1;a<G8;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function b6(e){return Nn(e).store}const R3=e=>{let t=class extends MBe(vve(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let cie=class extends R3(Ae){};cie=u([P("esri.core.MultiOriginJSONSupport")],cie);async function OBe(e,t){const{WhereClause:i}=await import("./WhereClause.b4219540.js");return i.create(e,t)}function _ve(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var oj;let F1=oj=class extends xe{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new oj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],F1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],F1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"title",void 0),F1=oj=u([P("esri.form.ExpressionInfo")],F1);const RBe=F1;let U1=class extends xe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],U1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],U1.prototype,"label",void 0),u([d()],U1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],U1.prototype,"visibilityExpression",void 0),U1=u([P("esri.form.elements.Element")],U1);const L2=U1;var aj;let xL=aj=class extends xe{constructor(e){super(e),this.type=null}clone(){return new aj({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],xL.prototype,"type",void 0),xL=aj=u([P("esri.form.elements.inputs.AttachmentInput")],xL);const PBe=xL;var lj;let k1=lj=class extends L2{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new lj({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],k1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],k1.prototype,"editable",void 0),u([d({type:PBe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],k1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],k1.prototype,"type",void 0),k1=lj=u([P("esri.form.elements.AttachmentElement")],k1);const uie=k1;let TL=class extends xe{constructor(e){super(e),this.type=null}};u([d()],TL.prototype,"type",void 0),TL=u([P("esri.form.elements.inputs.Input")],TL);const kE=TL;let JA=class extends kE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],JA.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],JA.prototype,"minLength",void 0),JA=u([P("esri.form.elements.inputs.TextInput")],JA);const wY=JA;var cj;let SL=cj=class extends wY{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new cj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],SL.prototype,"type",void 0),SL=cj=u([P("esri.form.elements.inputs.BarcodeScannerInput")],SL);const IBe=SL;var uj;let DT=uj=class extends kE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new uj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],DT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],DT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],DT.prototype,"type",void 0),DT=uj=u([P("esri.form.elements.inputs.ComboBoxInput")],DT);const $Be=DT;var hj;function hie(e){return e!=null?new Date(e):null}function die(e){return e?e.getTime():null}let Sd=hj=class extends kE{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return hie(t.max)}writeMax(e,t){t.max=die(e)}readMin(e,t){return hie(t.min)}writeMin(e,t){t.min=die(e)}clone(){return new hj({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],Sd.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Sd.prototype,"max",void 0),u([Ie("max")],Sd.prototype,"readMax",null),u([He("max")],Sd.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Sd.prototype,"min",void 0),u([Ie("min")],Sd.prototype,"readMin",null),u([He("min")],Sd.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Sd.prototype,"type",void 0),Sd=hj=u([P("esri.form.elements.inputs.DateTimePickerInput")],Sd);const DBe=Sd;var dj;let LT=dj=class extends kE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new dj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],LT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],LT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],LT.prototype,"type",void 0),LT=dj=u([P("esri.form.elements.inputs.RadioButtonsInput")],LT);const LBe=LT;var pj;let NT=pj=class extends kE{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new pj({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],NT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],NT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],NT.prototype,"type",void 0),NT=pj=u([P("esri.form.elements.inputs.SwitchInput")],NT);const NBe=NT;var fj;let EL=fj=class extends wY{constructor(e){super(e),this.type="text-area"}clone(){return new fj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],EL.prototype,"type",void 0),EL=fj=u([P("esri.form.elements.inputs.TextAreaInput")],EL);const FBe=EL;var mj;let CL=mj=class extends wY{constructor(e){super(e),this.type="text-box"}clone(){return new mj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],CL.prototype,"type",void 0),CL=mj=u([P("esri.form.elements.inputs.TextBoxInput")],CL);const UBe=CL,kBe={base:kE,key:"type",typeMap:{"barcode-scanner":IBe,"combo-box":$Be,"datetime-picker":DBe,"radio-buttons":LBe,switch:NBe,"text-area":FBe,"text-box":UBe}};var gj;let oh=gj=class extends L2{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new gj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:vye,json:{read:{reader:GX},write:!0}})],oh.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],oh.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],oh.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],oh.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],oh.prototype,"hint",void 0),u([d({types:kBe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],oh.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],oh.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],oh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],oh.prototype,"valueExpression",void 0),oh=gj=u([P("esri.form.elements.FieldElement")],oh);const pie=oh;var yj;let Gm=yj=class extends L2{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new yj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:te(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],Gm.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Gm.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],Gm.prototype,"editable",void 0),u([d({type:[mfe],json:{write:!0}})],Gm.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],Gm.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],Gm.prototype,"type",void 0),Gm=yj=u([P("esri.form.elements.RelationshipElement")],Gm);const fie=Gm;function bve(e){return{typesWithGroup:{base:L2,key:"type",typeMap:{attachment:uie,field:pie,group:e,relationship:fie}},typesWithoutGroup:{base:L2,key:"type",typeMap:{attachment:uie,field:pie,relationship:fie}}}}function wve(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function xve(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function Tve(e,t,i=!0){return e?e.map(r=>up(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var vj;let gf=vj=class extends L2{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Tve(e,w6,!1)}readElements(e,t){return wve(t.formElements,w6,!1)}writeElements(e,t){t.formElements=xve(e,w6,!1)}clone(){return new vj({description:this.description,elements:te(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],gf.prototype,"elements",void 0),u([Nt("elements")],gf.prototype,"castElements",null),u([Ie("elements",["formElements"])],gf.prototype,"readElements",null),u([He("elements")],gf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],gf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],gf.prototype,"type",void 0),gf=vj=u([P("esri.form.elements.GroupElement")],gf);const w6=bve(gf),zBe=gf;var _j;const x6=bve(zBe);let Kp=_j=class extends xe{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Tve(e,x6)}readElements(e,t){return wve(t.formElements,x6)}writeElements(e,t){t.formElements=xve(e,x6)}clone(){return new _j({description:this.description,expressionInfos:te(this.expressionInfos),elements:te(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],Kp.prototype,"description",void 0),u([d({json:{write:!0}})],Kp.prototype,"elements",void 0),u([Nt("elements")],Kp.prototype,"castElements",null),u([Ie("elements",["formElements"])],Kp.prototype,"readElements",null),u([He("elements")],Kp.prototype,"writeElements",null),u([d({type:[RBe],json:{write:!0}})],Kp.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],Kp.prototype,"title",void 0),Kp=_j=u([P("esri.form.FormTemplate")],Kp);const VBe=Kp,BBe=de.getLogger("esri.layers.support.fromPortalItem");async function GBe(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.690b154c.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||ki.portalUrl;throw BBe.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let jBe=0,Hn=class extends Zr.EventedMixin(E5($u)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Xt(-180,-90,180,90,Ze.WGS84),this.id=Date.now().toString(16)+"-layer-"+jBe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ze.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await import("./arcgisLayers.a6b9ab84.js")).fromUrl(t)}static fromPortalItem(e){return GBe(e)}initialize(){this.when().catch(e=>{var t,i;Br(e)||de.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?ho(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await _i(e,{query:{f:"json"},responseType:"json"})).data;throw new q("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Hn.prototype,"attributionDataUrl",void 0),u([d({type:Xt})],Hn.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Hn.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Hn.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Hn.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Hn.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Hn.prototype,"opacity",void 0),u([d({clonable:!1})],Hn.prototype,"parent",void 0),u([d({readOnly:!0})],Hn.prototype,"parsedUrl",null),u([d({type:Boolean})],Hn.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Hn.prototype,"attributionVisible",void 0),u([d({type:Ze})],Hn.prototype,"spatialReference",void 0),u([d({type:String})],Hn.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Hn.prototype,"type",void 0),u([d()],Hn.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Hn.prototype,"visible",void 0),Hn=u([P("esri.layers.Layer")],Hn);const Zv=Hn;function mie(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function HBe(e,t,i){if(!e&&!t||!i)return;const r=_w(i);gie(e,i,r),gie(t,i,r)}function gie(e,t,i){if(e)for(const r of e)qBe(r.geometry,t,i)}function qBe(e,t,i){if(M(e)||!e.spatialReference||Cc(e.spatialReference,t))return;const r=_w(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)mie(e,e.rings,r);else if("paths"in e)mie(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let WBe=0;const T6=de.getLogger("esri.layers.graphics.sources.MemorySource");let lg=class extends $u.LoadableMixin(yE(Jh(ct))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);m7(e,this.layer.spatialReference,i);const r=oU.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new q("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return m7(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:Xt.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new q("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}HBe(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||M(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new q("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(WBe++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return M(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?la.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await dme("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{T6.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:VK.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)T6.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&T6.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=VK.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([Vq({Type:Ga,ensureType:Ss(Ga)})],lg.prototype,"itemType",void 0),u([d()],lg.prototype,"type",void 0),u([d({constructOnly:!0})],lg.prototype,"layer",void 0),u([d({readOnly:!0})],lg.prototype,"workerGeometryType",null),u([d()],lg.prototype,"sourceJSON",void 0),lg=u([P("esri.layers.graphics.sources.MemorySource")],lg);function XBe(e){return"portalItem"in e}const Sve=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):XBe(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},Eve={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Cve=Object.values(Eve),Ave=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Cve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),YBe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Cve.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),ZBe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function QBe(e){return!!Ave.test(e)}function Qv(e){if(M(e))return null;const t=ho(e),i=t.path.match(Ave)||t.path.match(YBe);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:xY(a!==-1?s.slice(a+1):s),serverType:Eve[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function JBe(e){const t=ho(e).path.match(ZBe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function xY(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function KBe(e,t){const i=[];if(e){const r=Qv(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=xY(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function TY(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function e8e(e,t){return e&&Ohe(Rhe(e,t))}function t8e(e){let{url:t}=e;if(!t)return{url:t};t=Rhe(t,e.logger);const i=ho(t),r=Qv(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=JBe(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Ohe(t),layerId:s}}function i8e(e,t,i,r,s){jv(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=ow(r.url,i,e.layerId.toString()))}function Zxt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const SY=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=Qv(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",e8e(i,de.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t},yie={read:{reader:zX},write:{allowNull:!0,writer:VX}},fU=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":yie,"portal-item":yie}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},Mve=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t};var bj;const S6=new Mi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),E6=new Mi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ef=bj=class extends xe{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new mu(F({geometry:te(i),objectIds:te(n),spatialRelationship:r,timeExtent:te(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new bj({geometry:te(t),objectIds:te(s),spatialRelationship:i,timeExtent:te(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],ef.prototype,"where",void 0),u([d({types:Qw,json:{write:!0}})],ef.prototype,"geometry",void 0),u([d({type:S6.apiValues,json:{name:"spatialRel",read:{reader:S6.read},write:{allowNull:!1,writer:S6.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],ef.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],ef.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],ef.prototype,"objectIds",void 0),u([d({type:E6.apiValues,json:{read:E6.read,write:{writer:E6.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],ef.prototype,"units",void 0),u([d({type:om,json:{write:!0}})],ef.prototype,"timeExtent",void 0),ef=bj=u([P("esri.layers.support.FeatureFilter")],ef);const r8e=ef;var wj;const vie={read:{reader:zX},write:{writer:VX,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},_ie={read:{reader:zX},write:{writer:VX,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},bie={name:"showExcludedLabels",default:!0};let z1=wj=class extends xe{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t!=null&&t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new q("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new q("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new wj({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:r8e,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?_c(i,s,t):_c(i,null,t)}}}})],z1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":vie,"portal-item":vie}}})],z1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":_ie,"portal-item":_ie}}})],z1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":bie,"portal-item":bie}}})],z1.prototype,"excludedLabelsVisible",void 0),z1=wj=u([P("esri.layers.support.FeatureEffect")],z1);const s8e=z1,wie={write:{allowNull:!0}},n8e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:s8e,json:{origins:{"web-map":wie,"portal-item":wie}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t},o8e={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function a8e(e){if(!e)return e;const{start:t,end:i}=e;return new om({start:_(t)?Kb(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?Kb(i,-i.getTimezoneOffset(),"minutes"):i})}function l8e(e){if(!e)return e;const{start:t,end:i}=e;return new om({start:_(t)?Kb(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?Kb(i,i.getTimezoneOffset(),"minutes"):i})}var xj;let KA=xj=class extends xe{async collectRequiredFields(e,t){return Rl(e,t,this.expression)}clone(){return new xj({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],KA.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],KA.prototype,"title",void 0),KA=xj=u([P("esri.layers.support.FeatureExpressionInfo")],KA);const xie=KA;function c8e(e){return D2[e]!=null}function u8e(e){return 1/(D2[e]||1)}function h8e(){const e=Object.keys(D2);return e.sort(),e}const d8e=h8e();var Tj;const uI=da()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Tie=new Mi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let jm=Tj=class extends xe{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new Tj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&lCe(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:xie,json:{write:!0}})],jm.prototype,"featureExpressionInfo",void 0),u([Ie("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],jm.prototype,"readFeatureExpressionInfo",null),u([He("featureExpressionInfo",{featureExpressionInfo:{type:xie},"featureExpression.value":{type:[0]}})],jm.prototype,"writeFeatureExpressionInfo",null),u([d({type:uI.apiValues,nonNullable:!0,json:{type:uI.jsonValues,read:uI.read,write:{writer:uI.write,isRequired:!0}}})],jm.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],jm.prototype,"offset",void 0),u([d({type:d8e,json:{type:String,read:Tie.read,write:Tie.write}})],jm.prototype,"unit",null),jm=Tj=u([P("esri.layers.support.ElevationInfo")],jm);const Ove=jm,p8e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},mU={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},EY={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},CY={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:jv}}},f8e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},m8e={value:null,type:Ove,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function Qxt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const AL={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},g8e=ye(F({},AL),{json:ye(F({},AL.json),{origins:{"web-document":ye(F({},AL.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?GO(t.layerDefinition.drawingInfo.transparency):void 0:GO(t.drawingInfo.transparency)}})}),Jxt={type:om,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=l8e(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=a8e(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},Kxt={type:Xt,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=Xt.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=Ze.fromJSON(t.spatialReference)),i}}}},read:!1}},Rve={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},y8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},v8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},Pve={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},AY=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&JPe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),XPe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=o8e[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new q("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,ye(F({},r),{layer:this})),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof q&&l.name==="web-document-write:property-required").length;return d2(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new q("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(Pve)],t.prototype,"listMode",void 0),u([He("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([He("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(AL)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([He([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};var Sj;const C6=new Mi({asc:"ascending",desc:"descending"});let FT=Sj=class extends xe{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Sj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],FT.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],FT.prototype,"valueExpression",void 0),u([d({type:C6.apiValues,json:{read:C6.read,write:C6.write}})],FT.prototype,"order",void 0),FT=Sj=u([P("esri.layers.support.OrderByInfo")],FT);const Ive=FT;function _8e(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new Ive;return s.read(r,i),[s]}function b8e(e,t,i,r){const s=e.find(n=>!!n.field);s&&_c(i,[s.toJSON()],t)}const w8e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[Ive],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:_8e},write:{target:"layerDefinition.orderBy",writer:b8e}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t},x8e=de.getLogger("esri.portal.PortalItemResource");let b0=class extends Ae{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?ye(F({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&Su(e)?x8e.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(M(i))throw new q("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:en(t,"signal")})}async update(e,t){return(await import("./resourceUtils.6fa53b6a.js")).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return M(e)?e:(e=e.replace(/^\/+/,""),_(t)&&Su(e)&&(e=c5(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],b0.prototype,"portalItem",void 0),u([d({type:String,value:null})],b0.prototype,"path",null),u([Nt("path")],b0.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],b0.prototype,"url",null),u([d({type:String,readOnly:!0})],b0.prototype,"itemRelativeUrl",null),b0=u([P("esri.portal.PortalItemResource")],b0);const T8e=b0;let eM=class extends Ae{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],eM.prototype,"created",void 0),u([d()],eM.prototype,"rating",void 0),eM=u([P("esri.portal.PortalRating")],eM);const A6=eM;var UT;let li=UT=class extends h3($u){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return kv(UT,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new Xt(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?Ni(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Pl.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof A6&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new A6({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:te(this.applicationProxies),avgRating:this.avgRating,categories:te(this.categories),created:te(this.created),culture:this.culture,description:this.description,extent:te(this.extent),groupCategories:te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:te(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new UT({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",ye(F({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",F({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new A6(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",F({query:ye(F({},e),{token:this.apiKey})},t),UT)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")em(t)?r.query={data:t}:r.query={url:_u(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new q("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await import("./resourceUtils.6fa53b6a.js")).fetchResources(this,e,t)}async addResource(e,t,i){const r=await import("./resourceUtils.6fa53b6a.js");return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await import("./resourceUtils.6fa53b6a.js");if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new q("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await import("./resourceUtils.6fa53b6a.js")).removeAllResources(this,e)}resourceFromPath(e){return new T8e({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:te(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};return Iue(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new UT({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],li.prototype,"access",void 0),u([d()],li.prototype,"accessInformation",void 0),u([d({type:String})],li.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],li.prototype,"applicationProxies",void 0),u([d()],li.prototype,"avgRating",void 0),u([d()],li.prototype,"categories",void 0),u([d({type:Date})],li.prototype,"created",void 0),u([d()],li.prototype,"culture",void 0),u([d()],li.prototype,"description",void 0),u([d({readOnly:!0})],li.prototype,"displayName",null),u([d({type:Xt})],li.prototype,"extent",void 0),u([Ie("extent")],li.prototype,"readExtent",null),u([d()],li.prototype,"groupCategories",void 0),u([d({readOnly:!0})],li.prototype,"iconUrl",null),u([d()],li.prototype,"id",void 0),u([d({readOnly:!0})],li.prototype,"isLayer",null),u([d()],li.prototype,"itemControl",void 0),u([d({readOnly:!0})],li.prototype,"itemUrl",null),u([d()],li.prototype,"licenseInfo",void 0),u([d({type:Date})],li.prototype,"modified",void 0),u([d()],li.prototype,"name",void 0),u([d()],li.prototype,"numComments",void 0),u([d()],li.prototype,"numRatings",void 0),u([d()],li.prototype,"numViews",void 0),u([d()],li.prototype,"owner",void 0),u([d()],li.prototype,"ownerFolder",void 0),u([d({type:Pl})],li.prototype,"portal",void 0),u([d()],li.prototype,"screenshots",void 0),u([d()],li.prototype,"size",void 0),u([d()],li.prototype,"snippet",void 0),u([d()],li.prototype,"sourceJSON",void 0),u([d({type:String})],li.prototype,"spatialReference",void 0),u([d()],li.prototype,"tags",void 0),u([d()],li.prototype,"thumbnail",void 0),u([d({readOnly:!0})],li.prototype,"thumbnailUrl",null),u([d()],li.prototype,"title",void 0),u([d()],li.prototype,"type",void 0),u([d()],li.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],li.prototype,"url",void 0),u([d({readOnly:!0})],li.prototype,"userItemUrl",null),li=UT=u([P("esri.portal.PortalItem")],li);const NF=li;var $ve=Object.freeze(Object.defineProperty({__proto__:null,default:NF},Symbol.toStringTag,{value:"Module"}));const S8e=de.getLogger("esri.layers.mixins.PortalLayer"),MY=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new NF({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.416f2ee5.js").then(function(n){return n.l});return Wt(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Br(s)||S8e.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(bp(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?Fs==null?void 0:Fs.findCredential(this.url):null;if(!r)return!0;const s=hI.credential===r?hI.user:await this._fetchEditingUser(i);return hI.credential=r,hI.user=s,M(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Fs.findServerInfo(this.url);if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Pl.getDefault();if(o&&o.loaded&&sp(o.restUrl)===sp(n))return o.user;const a=`${n}/community/self`,l=_(i)?i.signal:null,c=await mp(_i(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?YW.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Pl.getDefault());return s&&n&&!She(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new q("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,ye(F({},r),{layer:this}))}};return u([d({type:NF})],t.prototype,"portalItem",null),u([Ie("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([He("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},hI={credential:null,user:null},tR=new ct,iO=new WeakMap;function E8e(e){Dve(e)&&tR.push(e)}function C8e(e){Dve(e)&&tR.includes(e)&&tR.remove(e)}function Dve(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function Lve(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:Lve(t,e%t):0}let M6=0,dI=0;function A8e(){var t;const e=Date.now();for(const i of tR)i.refreshInterval&&e-((t=iO.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(iO.set(i,e),i.refresh(e))}Zhe(()=>{const e=Date.now();let t=0;for(const i of tR)t=Lve(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?iO.get(i)||iO.set(i,e):iO.delete(i);if(t!==dI){if(dI=t,clearInterval(M6),dI===0)return void(M6=0);M6=setInterval(A8e,dI)}});function M8e(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const Nve=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=yhe(()=>this.hasDataChanged()),this.when().then(()=>{E8e(this)},()=>{})}destroy(){C8e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){N8(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{de.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},gU=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&O8e(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function O8e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const Lb=da()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var Ej;let tM=Ej=class extends xe{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return qUe(this.value,this.unit,"milliseconds")}clone(){return new Ej({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],tM.prototype,"value",void 0),u([d({type:Lb.apiValues,json:{type:Lb.jsonValues,read:Lb.read,write:Lb.write},nonNullable:!0})],tM.prototype,"unit",void 0),tM=Ej=u([P("esri.TimeInterval")],tM);const iR=tM;var Cj;let kT=Cj=class extends xe{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new Cj({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],kT.prototype,"respectsDaylightSaving",void 0),u([Ie("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],kT.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],kT.prototype,"timezone",void 0),kT=Cj=u([P("esri.layers.support.TimeReference")],kT);const R8e=kT;var Aj;let wa=Aj=class extends xe{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new om({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new iR({value:t.timeInterval,unit:Lb.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new iR({value:t.defaultTimeInterval,unit:Lb.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new Aj({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:te(n),fullTimeExtent:te(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],wa.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],wa.prototype,"endField",void 0),u([d({type:om,json:{write:{enabled:!0,allowNull:!0}}})],wa.prototype,"fullTimeExtent",void 0),u([Ie("fullTimeExtent",["timeExtent"])],wa.prototype,"readFullTimeExtent",null),u([He("fullTimeExtent")],wa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],wa.prototype,"hasLiveData",void 0),u([d({type:iR,json:{write:{enabled:!0,allowNull:!0}}})],wa.prototype,"interval",void 0),u([Ie("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],wa.prototype,"readInterval",null),u([He("interval")],wa.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],wa.prototype,"startField",void 0),u([d({type:R8e,json:{write:{enabled:!0,allowNull:!0}}})],wa.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],wa.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],wa.prototype,"useTime",void 0),wa=Aj=u([P("esri.layers.support.TimeInfo")],wa);const Fve=wa,P8e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Lb.fromJSON(s.timeOffsetUnits);return n&&o?new iR({value:n,unit:o}):null}set timeInfo(i){Jpe(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:om,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:iR})],t.prototype,"timeOffset",void 0),u([Ie("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:Fve,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t};var Mj;let cg=Mj=class extends xe{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Mj({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],cg.prototype,"name",void 0),u([d({constructOnly:!0})],cg.prototype,"fields",void 0),u([d({constructOnly:!0})],cg.prototype,"isAscending",void 0),u([d({constructOnly:!0})],cg.prototype,"isUnique",void 0),u([d({constructOnly:!0})],cg.prototype,"description",void 0),cg=Mj=u([P("esri.layers.support.FeatureIndex")],cg);let Ov=class extends xe{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Ov.prototype,"type",void 0),Ov=u([P("esri.layers.support.FeatureReduction")],Ov);var Oj;let zT=Oj=class extends xe{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new Oj({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],zT.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"onStatisticValueExpression",void 0),zT=Oj=u([P("esri.layers.support.OutStatistic")],zT);const I8e=zT;var Rj;let iM=Rj=class extends xe{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new Rj({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],iM.prototype,"name",void 0),u([d({type:I8e,json:{write:!0}})],iM.prototype,"outStatistic",void 0),iM=Rj=u([P("esri.layers.support.AggregateField")],iM);const Uve=iM,OY="__begin__",RY="__end__",$8e=new RegExp(OY,"ig"),D8e=new RegExp(RY,"ig"),Sie=new RegExp("^"+OY,"i"),Eie=new RegExp(RY+"$","i"),FF='"',L8e=FF+" + ",N8e=" + "+FF;function F8e(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function U8e(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function yU(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=F8e(e.labelExpression),t.type="conventional"),t}function k8e(e){const t=yU(e);if(!t)return null;switch(t.type){case"conventional":return Pj(t.expression);case"arcade":return t.expression}return null}function z8e(e){const t=yU(e);if(!t)return null;switch(t.type){case"conventional":return B8e(t.expression);case"arcade":return PY(t.expression)}return null}function Pj(e){let t;return e?(t=zf(e,i=>OY+'$feature["'+i+'"]'+RY),t=Sie.test(t)?t.replace(Sie,""):FF+t,t=Eie.test(t)?t.replace(Eie,""):t+FF,t=t.replace($8e,L8e).replace(D8e,N8e)):t='""',t}const V8e=/^\s*\{([^}]+)\}\s*$/i;function B8e(e){const t=e.match(V8e);return t&&t[1].trim()||null}const G8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,j8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,H8e=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function PY(e){if(!e)return null;let t=G8e.exec(e)||j8e.exec(e);return t?t[1]||t[3]:(t=H8e.exec(e),t?t[2]:null)}var Ij;let w0=Ij=class extends xe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Pj(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=Pj(this.value)),e!=null&&(t[i]=e)}clone(){return new Ij({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],w0.prototype,"expression",void 0),u([Ie("expression",["expression","value"])],w0.prototype,"readExpression",null),u([He("expression")],w0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],w0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],w0.prototype,"value",void 0),w0=Ij=u([P("esri.layers.support.LabelExpressionInfo")],w0);const kve=w0,zve=[252,146,31,255],eTt=[153,153,153,255],q8e={type:"esriSMS",style:"esriSMSCircle",size:6,color:zve,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},W8e={type:"esriSLS",style:"esriSLSSolid",width:.75,color:zve},X8e={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Y8e={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Z8e={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Q8e={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},J8e={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},tTt=m_.fromJSON(q8e),iTt=Qh.fromJSON(W8e),rTt=f_.fromJSON(X8e),K8e=ME.fromJSON(Y8e);m_.fromJSON(Z8e);Qh.fromJSON(Q8e);f_.fromJSON(J8e);var $j;const pI=new Mi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function Vve(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function e9e(e){return(e==null?void 0:e.type)==="map-image"}function Bve(e){var t,i;return!!e9e(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function t9e(e){return Vve(e)||Bve(e.layer)}let qs=$j=class extends xe{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=K8e,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=U8e(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=PY(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&Vve(r))e=new kve({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return yU(this)}getLabelExpressionArcade(){return k8e(this)}getLabelExpressionSingleField(){return z8e(this)}hash(){return JSON.stringify(this)}clone(){return new $j({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:te(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:te(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],qs.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],qs.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],qs.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&Bve(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],qs.prototype,"labelExpression",void 0),u([Ie("labelExpression")],qs.prototype,"readLabelExpression",null),u([He("labelExpression")],qs.prototype,"writeLabelExpression",null),u([d({type:kve,json:{write:{overridePolicy:(e,t,i)=>t9e(i)?{allowNull:!0}:{enabled:!1}}}})],qs.prototype,"labelExpressionInfo",void 0),u([He("labelExpressionInfo")],qs.prototype,"writeLabelExpressionInfo",null),u([d({type:pI.apiValues,json:{type:pI.jsonValues,read:pI.read,write:pI.write}})],qs.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],qs.prototype,"labelPosition",void 0),u([d({type:Number})],qs.prototype,"maxScale",void 0),u([He("maxScale")],qs.prototype,"writeMaxScale",null),u([d({type:Number})],qs.prototype,"minScale",void 0),u([He("minScale")],qs.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],qs.prototype,"repeatLabel",void 0),u([d({type:Number,cast:er,json:{write:!0,origins:{"web-scene":{write:!1}}}})],qs.prototype,"repeatLabelDistance",void 0),u([d({types:FDe,json:{origins:{"web-scene":{types:UDe,write:tie,default:null}},write:tie,default:null}})],qs.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],qs.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],qs.prototype,"where",void 0),qs=$j=u([P("esri.layers.support.LabelClass")],qs);const P3=qs;var Dj;let Ed=Dj=class extends Ov{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new Dj({fields:te(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate),renderer:te(this.renderer)})}};u([mt({binning:"binning"})],Ed.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ed.prototype,"fixedBinLevel",void 0),u([d({type:[P3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ed.prototype,"labelingInfo",void 0),u([d(EY)],Ed.prototype,"labelsVisible",void 0),u([d(mU)],Ed.prototype,"popupEnabled",void 0),u([d({type:SE,json:{name:"popupInfo",write:!0}})],Ed.prototype,"popupTemplate",void 0),u([d({type:[Uve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ed.prototype,"fields",void 0),u([d({types:O3,json:{write:!0}})],Ed.prototype,"renderer",void 0),Ed=Dj=u([P("esri.layers.support.FeatureReductionBinning")],Ed);const i9e=Ed;var Lj;let Zl=Lj=class extends xe{constructor(e){super(e),this.type="cluster",this.clusterRadius=er("80px"),this.clusterMinSize=er("12px"),this.clusterMaxSize=er("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new Lj({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,fields:te(this.fields),renderer:te(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Zl.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:er(e),json:{write:!0}})],Zl.prototype,"clusterRadius",void 0),u([d({type:Number,cast:er,json:{write:!0}})],Zl.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:er,json:{write:!0}})],Zl.prototype,"clusterMaxSize",void 0),u([d(mU)],Zl.prototype,"popupEnabled",void 0),u([d({type:SE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Zl.prototype,"popupTemplate",void 0),u([d({types:O3,json:{write:!0}})],Zl.prototype,"renderer",void 0),u([d({types:LDe})],Zl.prototype,"symbol",void 0),u([d({type:[P3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Zl.prototype,"labelingInfo",void 0),u([d(EY)],Zl.prototype,"labelsVisible",void 0),u([d({type:[Uve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Zl.prototype,"fields",void 0),Zl=Lj=u([P("esri.layers.support.FeatureReductionCluster")],Zl);const Gve=Zl;var Nj;let ML=Nj=class extends Ov{constructor(e){super(e),this.type="selection"}clone(){return new Nj}};u([d({type:["selection"]})],ML.prototype,"type",void 0),ML=Nj=u([P("esri.layers.support.FeatureReductionSelection")],ML);const Cie=ML,Aie={key:"type",base:Ov,typeMap:{selection:Gve}},r9e={types:{key:"type",base:Ov,typeMap:{selection:Cie,cluster:Gve,binning:i9e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Aie},"portal-item":{types:Aie},"web-scene":{types:{key:"type",base:Ov,typeMap:{selection:Cie}}}}}},Mie=new Mi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let x0=class extends Ec(xe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],x0.prototype,"name",void 0),u([d({json:{write:!0}})],x0.prototype,"description",void 0),u([d({json:{read:Mie.read,write:Mie.write}})],x0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],x0.prototype,"prototype",void 0),u([d({json:{write:!0}})],x0.prototype,"thumbnail",void 0),x0=u([P("esri.layers.support.FeatureTemplate")],x0);const IY=x0;let Hm=class extends Ec(xe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=GX(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],Hm.prototype,"id",void 0),u([d({json:{write:!0}})],Hm.prototype,"name",void 0),u([d({json:{write:!0}})],Hm.prototype,"domains",void 0),u([Ie("domains")],Hm.prototype,"readDomains",null),u([He("domains")],Hm.prototype,"writeDomains",null),u([d({type:[IY],json:{write:!0}})],Hm.prototype,"templates",void 0),Hm=u([P("esri.layers.support.FeatureType")],Hm);const $Y=Hm;function s9e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Oie(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Rie(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class jve{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=Pie(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),s9e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):x5(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Oie(r)||Rie(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Oie(t)||Rie(t)||t.nullable||QIe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(Pie(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function Pie(e){return e.toLowerCase().trim()}const n9e=de.getLogger("esri.layers.support.fieldProperties");function o9e(){return{fields:{type:[IE],value:null},fieldsIndex:{readOnly:!0,get(){return new jve(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||n9e.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Kpe(this.fieldsIndex,e)}}}}let VT=class extends Ec(xe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],VT.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],VT.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>ALe.read(e)||MLe.read(e)}})],VT.prototype,"units",void 0),VT=u([P("esri.layers.support.GeometryFieldsInfo")],VT);const a9e=VT,l9e=/\[([^\[\]]+)\]/gi;function Iie(e,t,i){return e?e.map(r=>{const s=new P3;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(l9e,(o,a)=>`[${c9e(a,n)}]`)}return s}):null}function c9e(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var Fj;let BT=Fj=class extends xe{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ct}clone(){return new Fj({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],BT.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],BT.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],BT.prototype,"viewAllLevelIds",void 0),BT=Fj=u([P("esri.layers.support.LayerFloorInfo")],BT);const Hve=BT,$ie=new Mi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Die=new Mi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let ah=class extends Ec(xe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:$ie.read,write:$ie.write}})],ah.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],ah.prototype,"relationshipTableId",void 0),u([d({json:{read:Die.read,write:Die.write}})],ah.prototype,"role",void 0),ah=u([P("esri.layers.support.Relationship")],ah);const u9e=ah,Cd=[];function h9e(e,t){if(TY(e.url))return!0;const{wkid:i}=t;for(const r of Cd){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Cd.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Cd.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Cd.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Cd.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Cd.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Cd.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Cd.push([10.61,()=>new Set([102497])]),Cd.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Cd.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Cd.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function d9e(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await mp(r.populateFromStyle());if(Wt(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Pu("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const p9e=["oid","global-id"],f9e=["oid","global-id","guid"];function qve({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=b9e({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=T9e({titleBase:s,fields:i,displayField:e}),l=x9e();return new SE({title:a,content:l,fieldInfos:o})}const m9e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],g9e=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!Wve(e.name,t)&&(!i||e.name!==i)&&!p9e.includes(e.type)&&!m9e.some(s=>s.test(e.name));function y9e(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(v9e),e}function v9e(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Lie(e)?-1:Lie(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function Wve(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function _9e(e,t){return e.editable&&!f9e.includes(e.type)&&!Wve(e.name,t)}function b9e({editFieldsInfo:e,fields:t,objectIdField:i},r){return y9e(t,(r==null?void 0:r.ignoreFieldTypes)||S9e).map(s=>new f3({fieldName:s.name,isEditable:_9e(s,e),label:s.alias,format:w9e(s),visible:g9e(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function w9e(e){switch(e.type){case"small-integer":case"integer":case"single":return new dS({digitSeparator:!0,places:0});case"double":return new dS({digitSeparator:!0,places:2});case"date":return new dS({dateFormat:"long-month-day-year"});default:return e.type==="string"&&nfe(e.name)?new dS({digitSeparator:!0,places:0}):null}}function x9e(){return[new x2,new zO]}function T9e(e){const t=qIe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function Lie(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const S9e=["geometry","blob","raster","guid","xml"],O6=new Mi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),E9e={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Hs="FeatureLayer",Nie=de.getLogger("esri.layers.FeatureLayer");function fI(e,t){return new q("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Fie(e){return e&&e instanceof ct}function Ut(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function mI(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function C9e(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function yC(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(t.toLowerCase()))}const R6=o9e();function P6(e,t,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Le=class extends n8e(fU(w8e(P8e(gU(Nve(SY(AY(MY(R3(Mve(Sve(Ec(Zv))))))))))))){constructor(...e){super(...e),this._handles=new si,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ze.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(ct.ofType(cg)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=at(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(bp).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new q("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){r!=null&&r.writeLayerSchema&&_c(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?ho(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=ow(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=ow(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){BK(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=ABe(r,t,i)||void 0;return s||Nie.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new _Y({defaultSymbol:I6(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:I6(s.symbol,s,i)}))}):new vY({symbol:I6(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(Fie(t)&&this._resetMemorySource(t),Fie(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ct?new lg({layer:this,items:e}):e:null}readSource(e,t){const i=oU.fromJSON(t.featureSet);return new lg({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>IY.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?KBe(this.url,i):i;let n=i;if(!n&&this.url){const o=Qv(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),xY(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=$Y.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=t8e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Nie});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){i8e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new q(Hs,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new q(Hs,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.5512b4b6.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return qve(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await a5(import("./FeatureLayerSource.05a37755.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new mu,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=_ve(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new q(Hs,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new q(Hs,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=QG.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new q(Hs,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new q(Hs,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new q(Hs,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new q(Hs,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(mu.from(e)||this.createQuery(),t)).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(mu.from(e)||this.createQuery(),t);throw new q(Hs,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(mu.from(e)||this.createQuery(),t);throw new q(Hs,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(mu.from(e)||this.createQuery(),t);throw new q(Hs,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(x7.from(e),t);throw new q(Hs,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(x7.from(e),t);throw new q(Hs,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(ZP.from(e),t).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new q(Hs,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(ZP.from(e),t);throw new q(Hs,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(ZP.from(e),t);throw new q(Hs,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(ZP.from(e),t);throw new q(Hs,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t=ye(F({},t),{writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()});const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(fI(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(fI(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(fI(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(fI(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new q(Hs,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||h9e(this,e))}async save(e){return(await import("./featureLayerUtils.018f0e15.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.018f0e15.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";_c("layerDefinition.capabilities",o,t),i&&!(r!=null&&r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new q(Hs,`feature is missing the identifying attribute ${i}`)):Promise.reject(new q(Hs,"'attributes' are required on a feature to query attachments")):Promise.reject(new q(Hs,"A feature is required to add/delete/update attachments")):Promise.reject(new q(Hs,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return _i(this.url,{query:ye(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),BK(this.renderer,this.fieldsIndex),Jpe(this.timeInfo,this.fieldsIndex),d9e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=F(F({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await OBe(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new q("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new q("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:yC(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:yC(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=E9e[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:Ut(e,"isDataVersioned",!1),supportsAttachment:Ut(e,"hasAttachments",!1),supportsM:Ut(e,"hasM",!1),supportsZ:Ut(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ut(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?Qv(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Ut(t,"supportsCalculate",!1),supportsTruncate:Ut(t,"supportsTruncate",!1),supportsValidateSql:Ut(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Ut(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Ut(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!he("mapserver-pbf-enabled")&&s&&this.version<10.81,o=TY(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:Ut(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ut(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ut(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:C9e(t),supportsCentroid:Ut(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Ut(t,"supportsQueryWithDistance",!1),supportsDistinct:Ut(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ut(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ut(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(t,"supportsHavingClause",!1),supportsOrderBy:Ut(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ut(t,"supportsPagination",!1),supportsQuantization:Ut(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ut(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ut(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ut(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ut(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ut(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ut(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Ut(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ut(t,"supportsQueryWithCacheHint",!1)||yC(t,"query"),supportsDefaultSpatialReference:Ut(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:mI(e,"maxRecordCountFactor",void 0),maxRecordCount:mI(e,"maxRecordCount",void 0),standardMaxRecordCount:mI(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:mI(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Ut(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:yC(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:yC(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ut(e,"allowGeometryUpdates",!0),supportsGlobalId:Ut(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],Le.prototype,"capabilities",void 0),u([Ie("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Le.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Le.prototype,"charts",void 0),u([d({readOnly:!0})],Le.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Le.prototype,"copyright",void 0),u([d({type:Boolean})],Le.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Le.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Le.prototype,"definitionExpression",void 0),u([d({types:Wb,readOnly:!0})],Le.prototype,"defaultSymbol",void 0),u([d({type:au})],Le.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],Le.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],Le.prototype,"editingEnabled",null),u([Ie(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Le.prototype,"readEditingEnabled",null),u([Ie("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Le.prototype,"readEditingEnabledFromWebMap",null),u([He(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Le.prototype,"writeEditingEnabled",null),u([He("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Le.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Le.prototype,"editingInfo",void 0),u([Ie("editingInfo")],Le.prototype,"readEditingInfo",null),u([d((()=>{const e=te(m8e),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Le.prototype,"elevationInfo",void 0),u([d(r9e)],Le.prototype,"featureReduction",void 0),u([d(ye(F({},R6.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:P6}}}}}))],Le.prototype,"fields",void 0),u([d(R6.fieldsIndex)],Le.prototype,"fieldsIndex",void 0),u([d({type:Hve,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Le.prototype,"floorInfo",void 0),u([d({type:VBe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Le.prototype,"formTemplate",void 0),u([d({type:Xt,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Le.prototype,"fullExtent",void 0),u([d()],Le.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:a9e,json:{read:{source:"geometryProperties"}}})],Le.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:O6.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:P6,writer(e,t,i){const r=e?O6.toJSON(e):null;r&&_c(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:O6.read}}})],Le.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Le.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Le.prototype,"hasZ",void 0),u([d({readOnly:!0,type:rx})],Le.prototype,"heightModelInfo",void 0),u([d({type:Date})],Le.prototype,"historicMoment",void 0),u([d(Rve)],Le.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Le.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Le.prototype,"isTable",void 0),u([Ie("service","isTable",["type","geometryType"]),Ie("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Le.prototype,"readIsTable",null),u([He("web-map","isTable")],Le.prototype,"writeIsTable",null),u([d(EY)],Le.prototype,"labelsVisible",void 0),u([d({type:[P3],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Iie},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Iie},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Le.prototype,"labelingInfo",void 0),u([d((()=>{const e=te(g8e);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){_c(r,A5(t),i)}}},e})())],Le.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Le.prototype,"layerId",void 0),u([d(f8e)],Le.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=te(Pve.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Le.prototype,"listMode",void 0),u([d(y8e)],Le.prototype,"minScale",void 0),u([Ie("service","minScale",["minScale","effectiveMinScale"])],Le.prototype,"readMinScale",null),u([d(v8e)],Le.prototype,"maxScale",void 0),u([Ie("service","maxScale",["maxScale","effectiveMaxScale"])],Le.prototype,"readMaxScale",null),u([d({type:String})],Le.prototype,"globalIdField",void 0),u([Ie("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Ie("service","globalIdField",["globalIdField","fields"])],Le.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:P6}}}}})],Le.prototype,"objectIdField",void 0),u([Ie("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Ie("service","objectIdField",["objectIdField","fields"])],Le.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Le.prototype,"operationalLayerType",void 0),u([d(R6.outFields)],Le.prototype,"outFields",void 0),u([d({readOnly:!0})],Le.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Le.prototype,"path",void 0),u([d(mU)],Le.prototype,"popupEnabled",void 0),u([d({type:SE,json:{name:"popupInfo",write:!0}})],Le.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Le.prototype,"defaultPopupTemplate",null),u([d({type:[u9e],readOnly:!0})],Le.prototype,"relationships",void 0),u([d({types:O3,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:yve,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Le.prototype,"renderer",null),u([Ie("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ie("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Le.prototype,"readRenderer",null),u([d()],Le.prototype,"sourceJSON",void 0),u([d({type:Boolean})],Le.prototype,"returnM",void 0),u([d({type:Boolean})],Le.prototype,"returnZ",void 0),u([d((()=>{const e=te(p8e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Le.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Le.prototype,"source",null),u([Nt("source")],Le.prototype,"castSource",null),u([Ie("portal-item","source",["featureSet"]),Ie("web-map","source",["featureSet"])],Le.prototype,"readSource",null),u([d({readOnly:!0})],Le.prototype,"serviceDefinitionExpression",void 0),u([Ie("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Le.prototype,"readServiceDefinitionExpression",null),u([d({type:Ze,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Le.prototype,"spatialReference",void 0),u([d({type:Number})],Le.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],Le.prototype,"subtypeField",void 0),u([d({type:[IY]})],Le.prototype,"templates",void 0),u([Ie("templates",["editFieldsInfo","creatorField","editorField","templates"])],Le.prototype,"readTemplates",null),u([d({type:Fve})],Le.prototype,"timeInfo",void 0),u([d()],Le.prototype,"title",void 0),u([Ie("service","title",["name"]),Ie("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Le.prototype,"readTitle",null),u([Ie("web-map","title",["layerDefinition.name","title"])],Le.prototype,"readTitleFromWebMap",null),u([d({type:String})],Le.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Le.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],Le.prototype,"type",void 0),u([d({type:String})],Le.prototype,"typeIdField",void 0),u([Ie("service","typeIdField"),Ie("typeIdField",["layerDefinition.typeIdField"])],Le.prototype,"readTypeIdField",null),u([d({type:[$Y]})],Le.prototype,"types",void 0),u([Ie("service","types",["types"]),Ie("types",["layerDefinition.types"])],Le.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],Le.prototype,"serverGens",void 0),u([d({type:ct.ofType(cg),readOnly:!0})],Le.prototype,"indexes",void 0),u([d(CY)],Le.prototype,"url",null),u([He("url")],Le.prototype,"writeUrl",null),u([d({readOnly:!0})],Le.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],Le.prototype,"version",void 0),u([Ie("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Le.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Le.prototype,"visible",void 0),u([Ie("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Le.prototype,"readVisible",null),Le=u([P("esri.layers.FeatureLayer")],Le);const I6=fE({types:lme}),Xve=Le;var A9e=Object.freeze(Object.defineProperty({__proto__:null,default:Xve},Symbol.toStringTag,{value:"Module"}));const M9e=["$datastore","$map","$layer","$aggregatedfeatures"],O9e="esri.widgets.Feature.support.arcadeFeatureUtils",R9e=de.getLogger(O9e);function P9e(e){return typeof e=="string"?_3(IX(e)):Array.isArray(e)?I9e(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?$9e(e):e}function I9e(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?_3(IX(t)):t}</li>`).join("")}</ul>`}function $9e(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?_3(IX(i)):i}</td></tr>`}).join("")}</table>`}function D9e({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:b}=p,w=new Xve(ye(F({fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:b},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:w,spatialReference:s.sr,interceptor:a})}})}function Yve(){return import("./arcadeUtils.0154e3c5.js").then(function(e){return e.t})}async function L9e({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function Zve({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=M9e.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([L9e({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,D9e({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>R9e.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function N9e({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await Yve(),a={};for(const h of e)a[`expression/${h.name}`]=Zve({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Ba(a),c={};for(const h in l)c[h]=P9e(l[h].value);return c}const F9e=1;let Hc=class extends Jh(Ae){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new Z5:t==="media"?new Db:t==="text"?new CF:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=RX(this._compile,F9e,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await Yve();if(a!==this._abortController)return;const c=await Zve({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await uY(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?BO.fromJSON(h):p==="text"?T2.fromJSON(h):p==="fields"?x2.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([ae(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Ft),ae(()=>[this.contentElement],()=>this._createVM(),Ft)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],Hc.prototype,"_abortController",void 0),u([d({type:ofe})],Hc.prototype,"expressionInfo",void 0),u([d({type:Ga})],Hc.prototype,"graphic",void 0),u([d({readOnly:!0})],Hc.prototype,"contentElement",void 0),u([d({readOnly:!0})],Hc.prototype,"contentElementViewModel",void 0),u([d()],Hc.prototype,"interceptor",void 0),u([d()],Hc.prototype,"spatialReference",null),u([d({readOnly:!0})],Hc.prototype,"state",null),u([d()],Hc.prototype,"map",null),u([d()],Hc.prototype,"view",void 0),Hc=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Hc);const DY=Hc,gI={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let OL=class extends ja{constructor(e,t){super(e,t),this.viewModel=new DY}initialize(){this.own(ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Ft))}destroy(){this._destroyContentWidget()}renderLoading(){return ce("div",{key:"loading-container",class:gI.loadingSpinnerContainer},ce("span",{class:this.classes(gI.iconLoading,gI.spinner)}))}render(){var t;const{state:e}=this.viewModel;return ce("div",{class:gI.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new lye({viewModel:e}):i==="media"?new Vye({viewModel:e}):i==="text"?new aL({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:DY})],OL.prototype,"viewModel",void 0),OL=u([P("esri.widgets.Feature.FeatureExpression")],OL);const U9e=OL;class k9e{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var RL;const z9e=1,Uie="content-view-models",Qve="esri.widgets.FeatureViewModel",V9e=de.getLogger(Qve),kie={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let gs=RL=class extends Ae{constructor(e){super(e),this._handles=new si,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=RX(this._graphicChanged,z9e,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=F({},kie),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(ae(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Ft))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return v4e(Iee(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Kge(this.graphic)}castAbilities(e){return F(F({},kie),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Db&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Db&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Db&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Br(i)||(this._error=i,V9e.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new T2({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(Uie),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new DY({expressionInfo:i,graphic:r,interceptor:RL.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(ae(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),Ft),Uie),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new DX(F({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new CF({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:$b({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:$b({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=F(F({},r.global),r.content[t]),n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>tye(h)||Tg(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return F({attributes:s,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:l,description:a}))}_compileFields(e,t){const i=e.clone(),r=new Z5(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:m}=e;return F({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:F(F({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:m,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new Db(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=$b({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new CF(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?y4e(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return $b({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return SF(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return SF(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await Ba({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await w4e({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await Ba({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:N9e({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:RL.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=F(F({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=Wz({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:F(F({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=Wz({fieldInfos:e.fieldInfos,graphic:r,attributes:F(F({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:Wz({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Iee(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&Tg(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await Ake({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await Mke({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;xke((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=E7(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||wke(s,t);o&&(Oke({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};gs.interceptor=new k9e(S4e,E4e),u([d()],gs.prototype,"_error",void 0),u([d()],gs.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],gs.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],gs.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],gs.prototype,"_sourceLayer",null),u([d()],gs.prototype,"abilities",void 0),u([Nt("abilities")],gs.prototype,"castAbilities",null),u([d({readOnly:!0})],gs.prototype,"content",void 0),u([d({readOnly:!0})],gs.prototype,"contentViewModels",void 0),u([d({type:Boolean})],gs.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],gs.prototype,"state",null),u([d({readOnly:!0})],gs.prototype,"formattedAttributes",void 0),u([d({type:Ga,value:null})],gs.prototype,"graphic",null),u([d({readOnly:!0})],gs.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],gs.prototype,"relatedInfos",void 0),u([d()],gs.prototype,"spatialReference",null),u([d({readOnly:!0})],gs.prototype,"title",void 0),u([d()],gs.prototype,"map",null),u([d({readOnly:!0})],gs.prototype,"waitingForContent",null),u([d()],gs.prototype,"view",void 0),gs=RL=u([P(Qve)],gs);const LY=gs,Jve=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>spe(i)&&!i.destroyed?ce("div",{key:i},i.render()):i instanceof HTMLElement?ce("div",{key:i,bind:i,afterCreate:this._attachToNode}):ePe(i)?ce("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t},Go={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},zie={title:!0,content:!0,lastEditedInfo:!0};let Zo=class extends Jve(ja){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=F({},zie),this.map=null,this.view=null,this.viewModel=new LY}initialize(){this.own(ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Ft))}loadDependencies(){return import("./calcite-notice.d087d7df.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return F(F({},zie),e)}render(){const{state:e}=this.viewModel,t=ce("div",{class:Go.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return ce("div",{class:this.classes(Go.base,Go.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return ce("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?ce("div",{key:"error-title",slot:"title"},e.errorMessage):null,ce("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return ce("div",{key:"loading-container",class:Go.loadingSpinnerContainer},ce("span",{class:this.classes(Go.iconLoading,Go.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?ce("div",{class:Go.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?ce(LX,{level:this.headingLevel,class:Go.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?ce("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:ce("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?ce("div",{key:this._buildKey("attachments-element",e),class:this.classes(Go.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("expression-element",e),class:Go.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("custom-element",t),class:Go.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("fields-element",e),class:Go.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("media-element",e),class:Go.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=Im(n,{date:r,user:s});return ce("div",{key:"edit-info-element",class:this.classes(Go.lastEditedInfo,Go.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("text-element",t),class:this.classes(Go.contentElement,Go.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new $4e({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new lye({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new Vye({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new aL({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new aL({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new U9e({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new aL({viewModel:s}))}this.scheduleRender()}};u([ht("viewModel.graphic")],Zo.prototype,"graphic",void 0),u([ht("viewModel.defaultPopupTemplateEnabled")],Zo.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Zo.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Zo.prototype,"label",void 0),u([d(),za("esri/widgets/Feature/t9n/Feature")],Zo.prototype,"messages",void 0),u([d(),za("esri/t9n/common")],Zo.prototype,"messagesCommon",void 0),u([d(),za("esri/widgets/support/t9n/uriUtils")],Zo.prototype,"messagesURIUtils",void 0),u([ht("viewModel.spatialReference")],Zo.prototype,"spatialReference",void 0),u([ht("viewModel.title")],Zo.prototype,"title",void 0),u([d()],Zo.prototype,"visibleElements",void 0),u([Nt("visibleElements")],Zo.prototype,"castVisibleElements",null),u([ht("viewModel.map")],Zo.prototype,"map",void 0),u([ht("viewModel.view")],Zo.prototype,"view",void 0),u([d({type:LY})],Zo.prototype,"viewModel",void 0),Zo=u([P("esri.widgets.Feature")],Zo);const B9e=Zo;var Kve;const PL=Symbol("anchorHandles");let V1=class extends Zr.EventedAccessor{constructor(e){super(e),this[Kve]=new si,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[PL].add([Cl(()=>Qs(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),ae(()=>this.screenLocation,(t,i)=>{_(t)&&_(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[PL]=at(this[PL])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};Kve=PL,u([d()],V1.prototype,"location",void 0),u([d()],V1.prototype,"screenLocation",null),u([d()],V1.prototype,"screenLocationEnabled",void 0),u([d()],V1.prototype,"view",void 0),V1=u([P("esri.widgets.support.AnchorElementViewModel")],V1);const e_e=V1,G9e="esri.widgets.CompassViewModel";let IL=class extends e_e{constructor(e){super(e),this.visible=!1}};u([d()],IL.prototype,"visible",void 0),IL=u([P(G9e)],IL);const t_e=IL,$6={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let B1=class extends ja{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new t_e,this.visible=!1}initialize(){this.own([ae(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[$6.spinnerStart]:r,[$6.spinnerFinish]:s},o=this._getPositionStyles();return ce("div",{class:this.classes($6.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=h2(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(M(t)||M(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([ht("viewModel.location")],B1.prototype,"location",void 0),u([ht("viewModel.view")],B1.prototype,"view",void 0),u([d({type:t_e})],B1.prototype,"viewModel",void 0),u([ht("viewModel.visible")],B1.prototype,"visible",void 0),B1=u([P("esri.widgets.Spinner")],B1);const j9e=B1;var Vie;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Vie||(Vie={}));function H9e(e){return"r"in e&&"g"in e&&"b"in e}function i_e(e){return"h"in e&&"s"in e&&"v"in e}function r_e(e){return"l"in e&&"a"in e&&"b"in e}function s_e(e){return"l"in e&&"c"in e&&"h"in e}function q9e(e){return"x"in e&&"y"in e&&"z"in e}const W9e=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],X9e=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function n_e(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function o_e(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=n_e(W9e,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function NY(e){const t=n_e(X9e,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function a_e(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function l_e(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function Y9e(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function Z9e(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function Q9e(e){return a_e(o_e(e))}function J9e(e){return NY(l_e(e))}function K9e(e){return Y9e(a_e(o_e(e)))}function eGe(e){return NY(l_e(Z9e(e)))}function tGe(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function iGe(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function FY(e){return H9e(e)?e:s_e(e)?eGe(e):r_e(e)?J9e(e):q9e(e)?NY(e):i_e(e)?iGe(e):e}function sTt(e){return i_e(e)?e:tGe(FY(e))}function nTt(e){return r_e(e)?e:Q9e(FY(e))}function oTt(e){return s_e(e)?e:K9e(FY(e))}function c_e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function rGe(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function sGe(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function nGe(e,t){return new Float32Array(e,t,6)}function u_e(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function oGe(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)u_e(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:c_e,clone:rGe,fromValues:sGe,createView:nGe,transform:u_e,transformMany:oGe},Symbol.toStringTag,{value:"Module"}));function aGe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function lGe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function cGe(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function h_e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function uGe(e){return e[0]*e[3]-e[1]*e[2]}function d_e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*y+a,e[5]=s*m+o*y+l,e}function UY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function p_e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function kY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function hGe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function dGe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function zY(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function pGe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function fGe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function mGe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function f_e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function gGe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function yGe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function vGe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function _Ge(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(i-l)<=Ct*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Ct*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Ct*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Ct*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Ct*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=Ct*Math.max(1,Math.abs(a),Math.abs(m))}const bGe=d_e,wGe=f_e;Object.freeze(Object.defineProperty({__proto__:null,copy:aGe,identity:lGe,set:cGe,invert:h_e,determinant:uGe,multiply:d_e,rotate:UY,scale:p_e,translate:kY,fromRotation:hGe,fromScaling:dGe,fromTranslation:zY,str:pGe,frob:fGe,add:mGe,subtract:f_e,multiplyScalar:gGe,multiplyScalarAndAdd:yGe,exactEquals:vGe,equals:_Ge,mul:bGe,sub:wGe},Symbol.toStringTag,{value:"Module"}));const Bie=he("android");he("chrome")||Bie&&Bie>=4;e9();function m_e(e){return e&&"opacity"in e?e.opacity*m_e(e.parent):1}async function xGe(e,t){var b;if(!e)return;const i=e.sourceLayer,r=(b=_(t)&&t.useSourceLayer?i:e.layer)!=null?b:i,s=m_e(r);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const w=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(ye(F({},t),{cache:_(t)?t.webStyleCache:null})):e.symbol.clone();return Qz(w,null,s),w}const n=_(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol(ye(F({},t),{cache:_(t)?t.webStyleCache:null})):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return Qz(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(M(t)||M(t.arcade))){const w=F({},t);w.arcade=await jf(),t=w}const a=await Promise.resolve().then(function(){return mY}),l=[],c=[],h=[],p=[];for(const w of n.visualVariables)switch(w.type){case"color":l.push(w);break;case"opacity":c.push(w);break;case"rotation":p.push(w);break;case"size":w.target||h.push(w)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let v=y?a.getOpacity(y,e,t):null;if(s!=null&&(v=v!=null?v*s:s),Qz(o,m,v),h.length){const w=a.getAllSizes(h,e,t);await j5e(o,w)}for(const w of p)H5e(o,a.getRotationAngle(w,e,t),w.axis);return o}class Qg{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new Ghe(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Khe(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)oK(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)oK(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const TGe=he("mac")?"Meta":"Ctrl",vU={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)vU[e]=String.fromCharCode(e);for(let e=1;e<25;e++)vU[111+e]=`F${e}`;for(let e=65;e<91;e++)vU[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function SGe(e){if(e.key!==void 0)return cb(e);const t=vU[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function EGe(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class CGe{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const Gie=de.getLogger("esri.views.input.InputHandler");class Uo{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Gie.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new CGe(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new AGe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new MGe(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Gie.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class AGe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class MGe{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class OGe extends Uo{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const D6=de.getLogger("esri.views.input.InputManager");let T0=class extends Ae{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=TGe,this.latestPointerType="mouse",this._propertiesPool=new Qg({latestPointerLocation:PGe},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=Rv.INTERNAL){if(this._nameToGroup[e])return void D6.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void D6.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):D6.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)EGe(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(M(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new OGe((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],Rv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Rv.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new RGe(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new AG,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new AG;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],T0.prototype,"hasPendingInputs",null),u([d()],T0.prototype,"eventSource",void 0),u([d()],T0.prototype,"recognizers",void 0),u([d({readOnly:!0})],T0.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],T0.prototype,"latestPointerLocation",void 0),T0=u([P("esri.views.input.InputManager")],T0);class RGe{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=G0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=G0.STOPPED}shouldStopPropagation(){return(this._propagationState&G0.STOPPED)!=0}async(t){this._propagationState|=G0.PAUSED;const i=(r,s)=>{this._propagationState&=~G0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&G0.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var G0;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(G0||(G0={}));const Rv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class PGe{}function jie(e){return e&&typeof e.highlight=="function"}function IGe(e){return e&&typeof e.maskOccludee=="function"}function aTt(e,t,i){return M(e)||e>i&&(t===0||e<t)}function lTt(e,t){return e>0||t>0}function cTt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const _U={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Nb=new TE({id:"zoom-to-feature",title:"{messages.zoom}",className:_U.iconZoom}),Hie=new TE({id:"remove-selected-feature",title:"{messages.remove}",className:_U.iconTrash}),yS=new TE({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:_U.iconZoom}),vS=new TE({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:_U.iconBrowseClusteredFeatures}),$Ge="esri.widgets.Popup.PopupViewModel",UF=de.getLogger($Ge),DGe=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new q("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new q("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new q("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new q("trigger-action:invalid-action","Action is disabled"));if(o===Nb.id)return NGe(s.viewModel).catch(L8);if(o===yS.id)return FGe(s.viewModel);if(o===vS.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Hie.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new q(`trigger-action:${Hie.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function g_e(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function yb(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function LGe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new q("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});UF.error(s)}),r}return!0}async function NGe(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=g_e(e);if(!n){const c=new q("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw UF.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&LGe(i,r);Nb.active=!0,Nb.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{Nb.active=!1,Nb.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function FGe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new q("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw UF.error(a),a}if(!yb(t)){const a=new q("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw UF.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],yS.active=!0,yS.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),yS.active=!1,yS.disabled=!1}async function UGe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function kGe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],vS.active=!0,vS.disabled=!0;const{features:o}=await s.queryFeatures(n);vS.active=!1,vS.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function zGe(e){const t=e.features.filter(i=>yb(i));t.length&&(e.features=t)}const VY=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},rO=ct.ofType({key:"type",defaultKeyValue:"button",base:C5,typeMap:{button:TE,toggle:yfe}}),VGe=()=>[Nb.clone()],BGe=()=>[yS.clone(),vS.clone()],y_e="esri.widgets.Popup.PopupViewModel",yI=de.getLogger(y_e);let Oi=class extends VY(e_e){constructor(e){super(e),this._handles=new si,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new rO,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ga({symbol:new f_({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([ae(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ae(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ae(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ae(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),ae(()=>this.location,e=>this._locationChange(e)),ae(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ae(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ae(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ae(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>DGe({event:e,view:this.view})),Cl(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Qi),ae(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),ae(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Cl(()=>!this.visible,()=>this.browseClusterEnabled=!1),ae(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new rO;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new rO;return e.removeAll(),e.addMany(yb(this.selectedFeature)?BGe():VGe()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Pg(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=g_e(this);if(!t){const i=new q("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return yI.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new q("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return yI.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=ye(F({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){zGe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?yb(t)?(await UGe(this),await kGe(this)):yI.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):yI.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Nb.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(yb(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),yb(e)?void 0:(e.symbol=await xGe(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(yb(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new LY({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},Rv.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return M(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof Zv))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&jie(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof Zv))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&jie(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Oi.prototype,"featurePage",void 0),u([d()],Oi.prototype,"isLoadingFeature",null),u([d({type:rO})],Oi.prototype,"actions",void 0),u([d({readOnly:!0})],Oi.prototype,"active",null),u([d()],Oi.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Oi.prototype,"allActions",null),u([d({type:Boolean})],Oi.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Oi.prototype,"autoCloseEnabled",void 0),u([d()],Oi.prototype,"autoOpenEnabled",void 0),u([d()],Oi.prototype,"browseClusterEnabled",void 0),u([d()],Oi.prototype,"content",void 0),u([d({type:rO,readOnly:!0})],Oi.prototype,"defaultActions",null),u([d({readOnly:!0})],Oi.prototype,"featureCount",null),u([d()],Oi.prototype,"features",null),u([d()],Oi.prototype,"featuresPerPage",void 0),u([d()],Oi.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Oi.prototype,"featureViewModels",void 0),u([d()],Oi.prototype,"highlightEnabled",void 0),u([d()],Oi.prototype,"includeDefaultActions",void 0),u([d({type:qe})],Oi.prototype,"location",null),u([d({readOnly:!0})],Oi.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Oi.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Oi.prototype,"waitingForResult",null),u([d({readOnly:!0})],Oi.prototype,"promiseCount",null),u([d()],Oi.prototype,"promises",null),u([d({value:null,readOnly:!0})],Oi.prototype,"selectedFeature",null),u([d({value:-1})],Oi.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Oi.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Oi.prototype,"state",null),u([d()],Oi.prototype,"title",void 0),u([d()],Oi.prototype,"updateLocationEnabled",void 0),u([d()],Oi.prototype,"view",void 0),u([d()],Oi.prototype,"visible",void 0),u([d()],Oi.prototype,"zoomFactor",void 0),u([d()],Oi.prototype,"zoomToLocation",void 0),u([d()],Oi.prototype,"centerAtLocation",null),Oi=u([P(y_e)],Oi);const v_e=Oi,qie="selected-index",GGe=0,Wie="popup-spinner",De={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},Xie={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Yie="esri-popup";function vm(e,t){return t===void 0?`${Yie}__${e}`:`${Yie}__${e}-${t}`}const __e="esri.widgets.Popup",Zie=de.getLogger(__e),Qie={closeButton:!0,featureNavigation:!0};let St=class extends Jve(ja){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new si,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=RX(()=>this._displaySpinner(),GGe),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new v_e,this.visible=null,this.visibleElements=F({},Qie),this._addSelectedFeatureIndexHandle(),this.own([ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),ae(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),ae(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),ae(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),ae(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),ae(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),ae(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ae(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),ae(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),Cl(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),oo(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Ft),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Xie}set dockOptions(e){const t=F({},Xie),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=F(F({},t),e),n=F(F({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=F(F({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=ye(F({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new B9e({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return F(F({},Qie),e)}blur(){const{active:e}=this.viewModel;e||Zie.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Zie.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(qie);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var y,v,b,w;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(v=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:v.title,f=(w=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:w.id,m={[De.alignTopCenter]:s==="top-center",[De.alignBottomCenter]:s==="bottom-center",[De.alignTopLeft]:s==="top-left",[De.alignBottomLeft]:s==="bottom-left",[De.alignTopRight]:s==="top-right",[De.alignBottomRight]:s==="bottom-right",[De.isDocked]:c,[De.shadow]:h,[De.isDockedTopLeft]:n==="top-left",[De.isDockedTopCenter]:n==="top-center",[De.isDockedTopRight]:n==="top-right",[De.isDockedBottomLeft]:n==="bottom-left",[De.isDockedBottomCenter]:n==="bottom-center",[De.isDockedBottomRight]:n==="bottom-right",[De.isFeatureMenuOpen]:i,[De.isActionsMenuOpen]:l};return ce("div",{class:this.classes(De.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(De.icon,De.iconLoading,De.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ce("div",{key:vm("loading-container"),role:"presentation",class:De.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=nv(this.container),t={[De.iconRightTriangleArrow]:e,[De.paginationPreviousIconRTL]:e,[De.iconLeftTriangleArrow]:!e,[De.paginationPreviousIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(De.icon,t)})}renderPreviousButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(De.button,De.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=nv(this.container),t={[De.iconLeftTriangleArrow]:e,[De.paginationNextIconRTL]:e,[De.iconRightTriangleArrow]:!e,[De.paginationNextIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(De.icon,t)})}renderNextButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(De.button,De.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(De.button,De.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[De.iconUndock]:e,[De.iconDock]:!e,[De.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[De.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[De.iconDockToTop]:!e&&t==="top-center",[De.iconDockToBottom]:!e&&t==="bottom-center"};return ce("span",{"aria-hidden":"true",class:this.classes(i,De.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?ce("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(De.button,De.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[De.headerContainerButton]:i},o=ce(LX,{level:this.headingLevel,class:De.headerTitle,innerHTML:e}),a=i?ce("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(De.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):ce("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(De.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(De.icon,De.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:De.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ce("header",{class:De.header},this.renderTitle(),ce("div",{class:De.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?ce("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:De.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?ce("div",{key:vm("actions-menu-button"),class:this.classes(De.button,De.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},ce("span",{"aria-hidden":"true",class:De.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?ce("ul",{id:e,role:"menu","aria-labelledby":t,key:vm("actions"),class:De.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?ce("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:De.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ce("section",{key:vm("navigation"),class:this.classes(De.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[De.footerHasPagination]:e,[De.footerHasActions]:s,[De.footerHasActionsMenu]:n};return e||s?ce("div",{key:vm("feature-buttons"),class:this.classes(De.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=Im(e.selectedFeatures,{total:t.length});return ce("section",{key:vm("menu"),class:De.featureMenu},ce("strong",{class:De.featureMenuHeader},r),ce("nav",{bind:this,class:De.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:Z8},this.renderFeatureMenu(),ce("div",{class:De.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?ce("div",{class:De.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ce("div",{key:vm("pointer"),class:De.pointer,role:"presentation"},ce("div",{class:this.classes(De.pointerDirection,De.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[De.shadow]:e,[De.isCollapsible]:n,[De.isCollapsed]:a};return ce("div",{class:this.classes(De.main,De.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?ce("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return ce("span",{key:"text",class:De.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[De.iconLoading]:e.active,[De.rotating]:e.active,[De.icon]:!!t,[De.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),ce("span",{key:"icon","aria-hidden":"true",class:this.classes(De.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[De.action]:t.type!=="toggle",[De.actionToggle]:t.type==="toggle",[De.actionToggleOn]:t.type==="toggle"&&t.value,[De.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?ce("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(De.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):ce("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(De.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[De.featureMenuSelected]:o},l=o?ce("span",{key:vm(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:De.iconCheckMark}):null,c=ce("span",{innerHTML:e.title||r.untitled});return ce("li",{role:"menuitem",tabIndex:-1,key:vm(`feature-menu-feature-${s}`),class:this.classes(a,De.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},ce("span",{class:De.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?ce("ol",{class:De.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?Im(e.title,{messages:t}):s==="remove-selected-feature"?Im(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Im(e.title,{messages:t}):e.title;return o&&n?Im(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:De.iconDefaultAction;return n&&i?Im(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?Im(r,i):r}_createFeatureUpdatedAnimation(){return SRe("enter",De.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(ae(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new ct:t.slice(0,i),menuActions:r?new ct:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){cb(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){cb(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=cb(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=cb(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=cb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await IO(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ae(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,qie)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(M(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return b?w?"bottom-right":"top-right":v?w?"bottom-left":"top-left":w?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return nv(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=nv(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(M(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Im(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Wie),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new j9e({view:e}),e.ui.add(this._spinner,{key:Wie,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],St.prototype,"actionsMenuId",null),u([d({readOnly:!0})],St.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],St.prototype,"featureMenuId",null),u([d({readOnly:!0})],St.prototype,"titleId",null),u([d({readOnly:!0})],St.prototype,"contentId",null),u([d({readOnly:!0})],St.prototype,"hasContent",null),u([d({readOnly:!0})],St.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],St.prototype,"collapsible",null),u([d({readOnly:!0})],St.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],St.prototype,"contentCollapsed",null),u([d({readOnly:!0})],St.prototype,"dividedActions",null),u([ht("viewModel.actions")],St.prototype,"actions",void 0),u([d()],St.prototype,"actionsMenuOpen",null),u([d()],St.prototype,"alignment",void 0),u([ht("viewModel.autoCloseEnabled")],St.prototype,"autoCloseEnabled",void 0),u([ht("viewModel.autoOpenEnabled")],St.prototype,"autoOpenEnabled",void 0),u([ht("viewModel.defaultPopupTemplateEnabled")],St.prototype,"defaultPopupTemplateEnabled",void 0),u([ht("viewModel.content")],St.prototype,"content",void 0),u([d()],St.prototype,"collapsed",void 0),u([d()],St.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],St.prototype,"currentAlignment",null),u([d({readOnly:!0})],St.prototype,"currentDockPosition",null),u([d()],St.prototype,"dockOptions",null),u([d()],St.prototype,"dockEnabled",void 0),u([ht("viewModel.featureCount")],St.prototype,"featureCount",void 0),u([d()],St.prototype,"featureMenuOpen",void 0),u([ht("viewModel.features")],St.prototype,"features",void 0),u([ht("viewModel.goToOverride")],St.prototype,"goToOverride",void 0),u([d()],St.prototype,"headingLevel",void 0),u([ht("viewModel.highlightEnabled")],St.prototype,"highlightEnabled",void 0),u([ht("viewModel.location")],St.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],St.prototype,"label",void 0),u([d()],St.prototype,"maxInlineActions",void 0),u([d(),za("esri/widgets/Popup/t9n/Popup")],St.prototype,"messages",void 0),u([d(),za("esri/t9n/common")],St.prototype,"messagesCommon",void 0),u([ht("viewModel.promises")],St.prototype,"promises",void 0),u([ht("viewModel.selectedFeature")],St.prototype,"selectedFeature",void 0),u([ht("viewModel.selectedFeatureIndex")],St.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],St.prototype,"selectedFeatureWidget",null),u([d()],St.prototype,"spinnerEnabled",void 0),u([ht("viewModel.title")],St.prototype,"title",void 0),u([ht("viewModel.updateLocationEnabled")],St.prototype,"updateLocationEnabled",void 0),u([ht("viewModel.view")],St.prototype,"view",void 0),u([d({type:v_e}),epe(["triggerAction","trigger-action"])],St.prototype,"viewModel",void 0),u([ht("viewModel.visible")],St.prototype,"visible",void 0),u([d()],St.prototype,"visibleElements",void 0),u([Nt("visibleElements")],St.prototype,"castVisibleElements",null),u([iu()],St.prototype,"_close",null),u([iu()],St.prototype,"_toggleDockEnabled",null),u([iu()],St.prototype,"_toggleFeatureMenu",null),u([iu()],St.prototype,"_toggleActionsMenu",null),u([iu()],St.prototype,"_triggerAction",null),u([iu()],St.prototype,"_selectFeature",null),u([iu()],St.prototype,"_next",null),u([iu()],St.prototype,"_previous",null),St=u([P(__e)],St);const Jie=St,L6=[0,0];function jGe(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return L6[0]=i.left+t.pageXOffset,L6[1]=i.top+t.pageYOffset,L6}function Kie(e){e&&(zhe(e),e.parentNode&&e.parentNode.removeChild(e))}function HGe(e){const t=document.createElement("div");return e.appendChild(t),t}const vC=16,vI=750,qGe=512,WGe=2,XGe=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:vC,time:vI},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([ae(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),ae(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(ae(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Kie(this.root),this._set("root",null),tK(this.userContent,r),Kie(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",tK(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Mee;o.appendChild(l.surface),this._set("overlay",l),ae(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=lw({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(ae(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Ft),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new Jie({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([ae(()=>this.root,r=>{i.container=r?HGe(r):null},Ft),ae(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Ft)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=vC,i.time=vI,this.handles.add([(()=>{const r=()=>{i.freq=vC,i.time=vI};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),lw({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=vC,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?vC:Math.min(vI,n.freq*WGe),!s&&n.freq>=qGe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=jGe(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>h5(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:Jie})],t.prototype,"popup",null),u([d({type:Mee})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t};function uTt(e){return e&&"focus"in e}const BY=de.getLogger("esri.layers.support.ElevationSampler");class b_e{queryElevation(t){return w_e(t.clone(),this)}on(){return KGe}projectIfRequired(t,i){return x_e(t,i)}}class YGe extends b_e{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=M5(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=Nl(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!M(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return jW(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return BY.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return _t(this.tile.sample(t,i),this.noDataValue)}}class hTt extends b_e{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new YGe(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=M5(Lt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return BY.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function w_e(e,t){const i=x_e(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":ZGe(e,i,t);break;case"polyline":QGe(e,i,t);break;case"multipoint":JGe(e,i,t)}return e}function x_e(e,t){if(M(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=Yw(e,t);return r||BY.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function ZGe(e,t,i){e.z=i.elevationAt(t.x,t.y)}function QGe(e,t,i){Cf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Cf.x=c[0],Cf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Cf.x,Cf.y)}}e.hasZ=!0}function JGe(e,t,i){Cf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Cf.x=o[0],Cf.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Cf.x,Cf.y)}e.hasZ=!0}const Cf=new qe,KGe={remove(){}};var Uj;let tf=Uj=class extends xe{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Uj({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"cols",void 0),u([d({type:wr,json:{write:!0}})],tf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],tf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],tf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],tf.prototype,"scale",void 0),tf=Uj=u([P("esri.layers.support.LOD")],tf);const T_e=tf;var S0;const ere=new Mi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let qn=S0=class extends xe{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=Ze.WebMercator,numLODs:n=24}=e;if(!Ml(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new S0({dpi:96,lods:p,origin:new qe(0,0,s),size:[r,r],spatialReference:s})}const o=Rg(s),a=e.origin?new qe({x:e.origin.x,y:e.origin.y,spatialReference:s}):new qe(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Nl(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=Ape(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const y=p/2**t,v=y*c;h.push({level:m,scale:y,resolution:v}),p=y}}return new S0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=Rg(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return qe.fromJSON(F({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(Cc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=Yw(t,this.spatialReference);if(M(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Lt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=S0.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===S0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Lt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return S0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new T_e({level:n.level,scale:n.scale,resolution:o}))}return new S0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],qn.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],qn.prototype,"dpi",void 0),u([d({type:String,json:{read:ere.read,write:ere.write,origins:{"web-scene":{read:!1,write:!1}}}})],qn.prototype,"format",void 0),u([d({readOnly:!0})],qn.prototype,"isWrappable",null),u([d({type:qe,json:{write:!0}})],qn.prototype,"origin",void 0),u([Ie("origin")],qn.prototype,"readOrigin",null),u([d({type:[T_e],value:null,json:{write:!0}})],qn.prototype,"lods",null),u([d({readOnly:!0})],qn.prototype,"minScale",void 0),u([d({readOnly:!0})],qn.prototype,"maxScale",void 0),u([d({readOnly:!0})],qn.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],qn.prototype,"size",void 0),u([Ie("size",["rows","cols"])],qn.prototype,"readSize",null),u([He("size",{cols:{type:wr},rows:{type:wr}})],qn.prototype,"writeSize",null),u([d({type:Ze,json:{write:!0}})],qn.prototype,"spatialReference",void 0),qn=S0=u([P("esri.layers.support.TileInfo")],qn),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(qn||(qn={}));const Eg=qn,e7e=12;class Ir{constructor(t){const i=Ir.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=ww(this.spatialReference)||tm(this.spatialReference)||im(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Ir(this.toTileInfo())}toTileInfo(){return new Eg({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=NK(t[0]),i[1]=sF(t[1]),i[2]=NK(t[2]),i[3]=sF(t[3])):this._isGCS&&(i[0]=Pt(t[0]),i[1]=Pt(t[1]),i[2]=Pt(t[2]),i[3]=Pt(t[3]))}getExtentGeometry(t,i,r,s=new Xt){return this.getExtent(t,i,r,Ep),s.spatialReference=this.spatialReference,s.xmin=Ep[0],s.ymin=Ep[1],s.xmax=Ep[2],s.ymax=Ep[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Ir)){if(Ir.checkUnsupported(t))return!1;t=new Ir(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!VS(t.origin[0],this.origin[0],s)||!VS(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*e7e,VS(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(M(t)||n[0]===0||n[1]===0)return s;Ir.computeRowColExtent(t,n,this.origin,Ep);let o=Ep[1],a=Ep[3],l=Ep[0],c=Ep[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!zPe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return M(t)?GY():t.lods.length<1?new q("tilingscheme:generic","Tiling scheme must have at least one level"):Ir.isPowerOfTwo(t)?Ir.hasGapInLevels(t)?new q("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Ir.tileSizeSupported(t)?Ir.hasOriginPerLODs(t)?new q("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new q("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new q("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=Nl(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new Ir(new Eg({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new Ir(Ir.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new Ir(new Eg({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function GY(){return new q("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Ir.WebMercatorAuxiliarySphereTileInfo=new Eg({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ze.WebMercator},spatialReference:Ze.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Ir.WebMercatorAuxiliarySphere=Ir.makeWebMercatorAuxiliarySphere(19);const Ep=Lt(),_S=64,kj=512,t7e=2.5,rR=VPe(a9/10),S_e=4,i7e=4,$L=e=>e<4?3:i7e,E_e=Lt();Ir.WebMercatorAuxiliarySphere.getExtent(0,0,0,E_e);const r7e=Lt([-180,-90,180,90]),s7e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",n7e="Surface extent is too large for tile resolution at level 0.",mh=8,o7e=de.getLogger("esri.views.support.GroundViewElevationSampler");let E0=class extends Zr.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=rR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(M(e.extent)||!e.spatialReference)return null;const t=M5(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(M(this.extent)||!Ra(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return o7e.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return _t(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return w_e(e.clone(),this)}};u([d({readOnly:!0})],E0.prototype,"demResolution",void 0),u([d({readOnly:!0})],E0.prototype,"extent",null),u([d({readOnly:!0})],E0.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],E0.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],E0.prototype,"view",void 0),E0=u([P("esri.views.support.GroundViewElevationSampler")],E0);const a7e=E0;let C0=class extends Ae{constructor(e){super(e),this.handles=new si,this.view=null,this.layerViews=new ct}initialize(){this.handles.add(Cl(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new a7e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>ae(()=>e.updating,()=>this._updateUpdating(),Qi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],C0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],C0.prototype,"updating",null),u([d({constructOnly:!0})],C0.prototype,"view",void 0),u([d({type:ct,readOnly:!0})],C0.prototype,"layerViews",void 0),u([d({readOnly:!0})],C0.prototype,"suspended",null),C0=u([P("esri.views.GroundView")],C0);const l7e=C0,c7e=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:ghe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function C_e(e,t){return await e.load(),u7e(e,t)}async function u7e(e,t){const i=[],r=(...n)=>{for(const o of n)M(o)||(Array.isArray(o)?r(...o):ct.isCollection(o)?o.forEach(a=>r(a)):$u.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await z4e(i,async n=>{(await mp(h7e(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function h7e(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function d7e(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await vhe("esri/t9n/basemaps");return i[e]||i[t]}const zj={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Ni("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Ni("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ni("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ni("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Ni("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Ni("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Ni("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Ni("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Ni("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Ni("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Ni("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Ni("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Ni("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Ni("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Ni("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Ni("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},p7e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),f7e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function m7e(e){return e.layerContainerType==="basemap"?p7e:e.layerContainerType==="operational-layers"?f7e:null}function g7e(e,t){if(t.restrictedWebMapWriting){const i=m7e(t);return!_(i)||i.has(e.type)&&!OX(e)}return!0}function y7e(e,t){if(OX(e)){const i=pE("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&N6(e,r)}else e.type==="stream"?N6(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&N6(e,t)}function N6(e,t){"maxScale"in e&&(t.maxScale=kN(e.maxScale)),"minScale"in e&&(t.minScale=kN(e.minScale))}function v7e(e,t){if(y7e(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=kN(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(OX(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function tre(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new q("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(g7e(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&v7e(e,t=te(t)),t}var DL;let _7e=0;const F6=de.getLogger("esri.Basemap");let lh=DL=class extends h3($u){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+_7e++,this.baseLayers=new ct,this.referenceLayers=new ct;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&F6.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{F6.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Hv(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=ye(F({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=tre(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=tre(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Hv(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return C_e(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new DL({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=F({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=te(i);return r.url&&Gf(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Gf(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;Wt(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(d7e(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.a630ba77.js"),a=[];if(Wt(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await Ba(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=ho(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Pl.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Pl.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=zj[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),fhe(F6,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return DL.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ct}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],lh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],lh.prototype,"id",void 0),u([d({type:NF})],lh.prototype,"portalItem",void 0),u([d()],lh.prototype,"referenceLayers",null),u([d({readOnly:!0})],lh.prototype,"resourceInfo",void 0),u([d({type:Ze})],lh.prototype,"spatialReference",void 0),u([d()],lh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],lh.prototype,"title",void 0),u([He("title")],lh.prototype,"writeTitle",null),lh=DL=u([P("esri.Basemap")],lh);const kF=lh;var b7e=Object.freeze(Object.defineProperty({__proto__:null,default:kF},Symbol.toStringTag,{value:"Module"})),Vj;let LL=Vj=class extends xe{constructor(e){super(e),this.type="none"}clone(){return new Vj({type:this.type})}};u([mt({none:"none",stayAbove:"stay-above"})],LL.prototype,"type",void 0),LL=Vj=u([P("esri.ground.NavigationConstraint")],LL);var Bj;const ire=de.getLogger("esri.Ground");let qm=Bj=class extends h3($u){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ct;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&ire.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{ire.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set layers(e){this._set("layers",Hv(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=ye(F({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};NVe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new q("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return C_e(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.398449cf.js");Wt(t);const r=new i,s=this.layers.filter(rre).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.398449cf.js");Wt(t);const r=new i,s=this.layers.filter(rre).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:te(this.surfaceColor),navigationConstraint:te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new Bj({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.a630ba77.js").then(({populateOperationalLayers:o})=>{Wt(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Ba(a)}).then(()=>{})}};function w7e(e){return e&&"createElevationSampler"in e}function rre(e){return e.type==="elevation"||w7e(e)}u([d({json:{read:!1}})],qm.prototype,"layers",null),u([He("layers")],qm.prototype,"writeLayers",null),u([d({readOnly:!0})],qm.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:wr,read:{reader:GO,source:"transparency"},write:{writer:(e,t)=>{t.transparency=A5(e)},target:"transparency"}}})],qm.prototype,"opacity",void 0),u([d({type:We,json:{type:[wr],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],qm.prototype,"surfaceColor",void 0),u([d({type:LL,json:{write:!0}})],qm.prototype,"navigationConstraint",void 0),qm=Bj=u([P("esri.Ground")],qm);const zF=qm;let GT=class extends Jh(ct){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Zhe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(M(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new ct(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],GT.prototype,"getCollections",void 0),u([d()],GT.prototype,"getChildrenFunction",void 0),u([d()],GT.prototype,"itemFilterFunction",void 0),GT=u([P("esri.core.CollectionFlattener")],GT);const Ew=GT;function x7e(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const sre=de.getLogger("esri.support.basemapUtils");function T7e(){return{}}function S7e(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function E7e(e,t){let i;if(typeof e=="string"){if(!(e in zj)){const r=Object.entries(zj).filter(([s,n])=>ki.apiKey&&!n.classic||!ki.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return sre.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=kF.fromId(e),t&&(t[e]=i))}else i=Ss(kF,e);return i!=null&&i.destroyed&&(sre.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function C7e(e){return new Ew({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const A7e=de.getLogger("esri.support.groundUtils"),nre={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function M7e(e){let t=null;if(typeof e=="string")if(e in nre){const i=nre[e];t=new zF({resourceInfo:{data:{layers:[i]}}})}else A7e.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Ss(zF,e);return t}function Gj(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=Gj(r.layers,t,i),s))return s}}const ore=de.getLogger("esri.support.LayersMixin"),O7e=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new ct;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ore.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Hv(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof Zv){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Fu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):ore.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return Gj(this.layers,"id",i)}findLayerByUid(i){return Gj(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t},A_e="esri.support.TablesMixin",R7e=de.getLogger(A_e);function jj(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=jj(n.tables,t,i);if(o)return o}}}const P7e=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new ct,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&R7e.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Hv(i,this._get("tables")))}findTableById(i){return jj(this.tables,"id",i)}findTableByUid(i){return jj(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P(A_e)],t),t};let rf=class extends P7e(O7e(Zr.EventedMixin(Ae))){constructor(e){super(e),this.allLayers=new Ew({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=C7e(this),this.basemap=null,this.editableLayers=new Ew({getCollections:()=>[this.allLayers],itemFilterFunction:x7e}),this.ground=new zF,this._basemapCache=T7e()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),S7e(this._basemapCache),this._basemapCache=null}castBasemap(e){return E7e(e,this._basemapCache)}castGround(e){const t=M7e(e);return M(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],rf.prototype,"allLayers",void 0),u([d({readOnly:!0})],rf.prototype,"allTables",void 0),u([d({type:kF})],rf.prototype,"basemap",void 0),u([Nt("basemap")],rf.prototype,"castBasemap",null),u([d({readOnly:!0})],rf.prototype,"editableLayers",void 0),u([d({type:zF,nonNullable:!0})],rf.prototype,"ground",void 0),u([Nt("ground")],rf.prototype,"castGround",null),rf=u([P("esri.Map")],rf);const I7e=rf;let tw=class extends GM{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([Vq({Type:Ga,ensureType:Ss(Ga)})],tw.prototype,"itemType",void 0),tw=u([P("esri.support.GraphicsCollection")],tw);let A0=class extends Ae{constructor(e){super(e),this.view=null,this.baseLayerViews=new ct,this.referenceLayerViews=new ct,this._loadingHandle=ae(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},Ft)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],A0.prototype,"view",void 0),u([d({readOnly:!0})],A0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],A0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],A0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],A0.prototype,"updating",null),A0=u([P("esri.views.BasemapView")],A0);const $7e=de.getLogger("esri.views.LayerViewManager");class D7e{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=zv(),this._started=!1,this.done=!1,Fo(this._controller.signal,()=>{const s=new q("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new q("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);Wt(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=sn(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Fo(t,l),Wt(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new q("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new q("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let ch=class extends E2{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Df,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(M(this._workPromise)&&(this._workPromise=zv()),this.handles.remove("reschedule"),this.handles.add(gE(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),M(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new Ew({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([oo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ae(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),_s)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||Js(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new q("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new D7e(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Br(i)||i.name==="cancelled:layerview-create")||$7e.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],ch.prototype,"_workPromise",void 0),u([d({readOnly:!0})],ch.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],ch.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],ch.prototype,"_rootCollectionNames",null),u([d()],ch.prototype,"layerViewImporter",void 0),u([d()],ch.prototype,"supportsGround",void 0),u([d({readOnly:!0})],ch.prototype,"updating",null),u([d({readOnly:!0})],ch.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],ch.prototype,"view",void 0),ch=u([P("esri.views.LayerViewManager")],ch);const L7e=ch;let qc=class extends Ae{constructor(e){super(e),this.factor=1.5,this.offset=pp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],qc.prototype,"factor",void 0),u([d({nonNullable:!0})],qc.prototype,"offset",void 0),u([d()],qc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],qc.prototype,"size",void 0),u([d()],qc.prototype,"maskUrl",void 0),u([d()],qc.prototype,"maskEnabled",void 0),u([d()],qc.prototype,"overlayUrl",void 0),u([d()],qc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],qc.prototype,"version",null),u([d({type:Boolean})],qc.prototype,"visible",void 0),qc=u([P("esri.views.Magnifier")],qc);const M_e=qc;let NL=class extends Ae{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new are(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new are(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=bs(t.signal);if(i&&!t.abortCallback)t.reject(hi());else{const r=i?t.abortCallback(hi()):t.callback(e);Fu(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=hi();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],NL.prototype,"running",void 0),NL=u([P("esri.layers.support.PromiseQueue")],NL);class are{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let rM=class extends Ae{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],rM.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],rM.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),rM=u([P("esri.views.support.DebugFlags")],rM);const N7e=new rM,F7e=de.getLogger("esri.views.support.Scheduler");function U7e(){return new VF.Scheduler}var vt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(vt||(vt={}));const bf=0,lre=new Map([[vt.RESOURCE_CONTROLLER,bf],[vt.SLIDE,bf],[vt.STREAM_DATA_LOADER,bf],[vt.ELEVATION_QUERY,bf],[vt.TERRAIN_SURFACE,1],[vt.SURFACE_GEOMETRY_UPDATES,1],[vt.GRAPHICS_CORE,2],[vt.I3S_CONTROLLER,2],[vt.POINT_CLOUD_LAYER,2],[vt.FEATURE_TILE_FETCHER,2],[vt.OVERLAY,4],[vt.STAGE,4],[vt.GRAPHICS_DECONFLICTOR,4],[vt.FILTER_VISIBILITY,4],[vt.SCALE_VISIBILITY,4],[vt.FRUSTUM_VISIBILITY,4],[vt.POINT_OF_INTEREST_FREQUENT,6],[vt.POINT_OF_INTEREST_INFREQUENT,30],[vt.LABELER,8],[vt.FEATURE_QUERY_ENGINE,8],[vt.FEATURE_TILE_TREE,16],[vt.FEATURE_TILE_TREE_ACTIVE,bf],[vt.ELEVATION_ALIGNMENT,12],[vt.TEXT_TEXTURE_ATLAS,12],[vt.CLOUDS_GENERATOR,12],[vt.TEXTURE_UNLOAD,12],[vt.LINE_OF_SIGHT_TOOL,16],[vt.LINE_OF_SIGHT_TOOL_INTERACTIVE,bf],[vt.SNAPPING,bf],[vt.SHADOW_ACCUMULATOR,30]]);function cre(e){return lre.has(e)?lre.get(e):typeof e=="number"?e:1}var On;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(On||(On={}));const ure=6.5,hre=1,k7e=30,dre=1e3/30,pre=100,fre=.9;var VF,I_;(function(e){let t=class extends Ae{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new Sv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=On.INTERACTING,this._tasks=new It,this._runQueue=new It,this._load=0,this._idleStateCallbacks=new It,this._idleUpdatesStartFired=!1,this._maxReschedule=_I,this._forceTask=!1,this._debug=!1,this._debugHandle=ae(()=>N7e.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Ft);for(const o of Object.keys(vt))this.performanceInfo.tasks.set(vt[o],new Sv(vt[o]));let s;const n=this;this._test={get state(){return _t(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:ure,INTERACTING_BUDGET:dre,IDLE_BUDGET:pre,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),sn(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=_I,this._schedule(),this.frame()))}))}registerTask(s,n){const o=cre(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Sv(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===On.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===On.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==On.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return M(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=ure,o=s.frameDuration,a=hre;switch(this.state){case On.IDLE:n=0,o=Math.max(pre,s.frameDuration),a=k7e;break;case On.INTERACTING:o=Math.max(dre,s.frameDuration);case On.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==On.IDLE&&o<hre&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=_I,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case On.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case On.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return I_.SCHEDULED;let n=I_.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=I_.READY:n!==I_.READY&&(n=I_.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*fre+s*(1-fre)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===bf&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==bf&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===_I&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){F7e.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(vt))this._frameTaskTimes.set(vt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([P("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends Ae{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new NL,this._handles=new si,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(Cl(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(zE),this._scheduler.removeTask(this),this.schedule=N2.schedule,this.reschedule=N2.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=cre(s);this._basePriority!==bf&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([P("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=On.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(VF||(VF={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(I_||(I_={}));const zE=(()=>{const e=new VF.Budget;return e.enabled=!1,e})();class z7e{remove(){}processQueue(){}schedule(t,i,r){try{if(bs(i)){const s=hi();return r?Promise.resolve(r(s)):Promise.reject(s)}return F8(t(zE))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const N2=new z7e,_I=Number.MAX_SAFE_INTEGER;let bS=class extends Ae{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(vt.TEXTURE_UNLOAD))!=null?i:N2}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],bS.prototype,"_frameTask",void 0),u([d()],bS.prototype,"updating",null),bS=u([P("esri.views.3d.support.TextureCollection")],bS);var mre;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(mre||(mre={}));const O_e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],R_e={};function P_e(e){return!!R_e[e]}function V7e(e){for(const t of e)if(!P_e(t))return!1;return!0}O_e.forEach(e=>{R_e[e]=!0});class B7e{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!V7e(n))return n.some(P_e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:Rv.DEFAULT;const l=this._createUniqueGroupName(),c=new G7e(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class G7e extends Uo{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:pp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(pp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Al(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var sR,gre,yre;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(sR||(sR={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(gre||(gre={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(yre||(yre={}));const j7e=de.getLogger("esri.views.interactive.interactiveToolUtils");function H7e(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return j7e.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function BF(e){return e.visible&&e.getEditableFlag(sR.USER)&&e.getEditableFlag(sR.MANAGER)}function sf(e){return pp(e.x,e.y)}function dTt(e){return Wr(e.x,e.y)}function I_e(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return pp(t.clientX-i.left,t.clientY-i.top)}function vre(e,t){return t instanceof Event?I_e(e,t):sf(t)}function _re(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class q7e{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":bre(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!wre(t))break;const s=sf(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(M(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,bI),a=Qs(o,c=>c.manipulator),l=Qs(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!wre(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=Qs(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(M(a))break;const l=sf(t);l.x=Ne(l.x,0,i.view.width),l.y=Ne(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=sf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,bI);if(W7e(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),M(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=sf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=sf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=sf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(M(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:sf(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=Qs(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:sf(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return Js(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(M(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!BF(n))return!1;const o=n.manipulators.intersect(t,i);return!M(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(pp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!bre(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(sf(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=Qs(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,bI)?bI.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return M(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!BF(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function bre(e){return e==="mouse"}function wre(e){return e.pointerType!=="mouse"||e.button===0}function W7e(e){return!!e.native.shiftKey}const bI={manipulator:null,tool:null},X7e=de.getLogger("esri.views.ToolViewManager"),xre="attached",U6="tools";let Wm=class extends E2{constructor(e){super(e),this._manipulatorState=new q7e,this.tools=new ct,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(O_e,e=>{this._handleInputEvent(e)},Rv.TOOL),...H7e(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void X7e.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=M(this.activeTool);for(const r of this.tools){r.setEditableFlag(sR.MANAGER,i||r===this.activeTool);const s=BF(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new bS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ae(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Vh(()=>this._set("textures",at(this.textures)))],xre)):this.handles.add(ae(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(xre)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=ye(F({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(U6),this._forEachTool(e=>{if(e instanceof Ae){const t=ae(()=>[e.cursor,e.visible,e.editable],()=>{BF(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,U6)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),U6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!_(i.cursor)||!i.visible||!M(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(M(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],Wm.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Wm.prototype,"textures",void 0),u([d({value:null})],Wm.prototype,"activeTool",null),u([d({readOnly:!0,type:ct})],Wm.prototype,"tools",void 0),u([d({readOnly:!0})],Wm.prototype,"cursor",void 0),u([d({readOnly:!0})],Wm.prototype,"updating",null),Wm=u([P("esri.views.ToolViewManager")],Wm);const Y7e=Wm;let jT=class extends Ae{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Z7e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Q7e[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],jT.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],jT.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],jT.prototype,"axisThreshold",null),jT=u([P("esri.views.input.gamepad.GamepadInputDevice")],jT);const Z7e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Q7e={standard:.15,spacemouse:.025,unknown:0},jY=jT;let sM=class extends Ae{constructor(...e){super(...e),this.devices=new ct,this.enabledFocusMode="document"}};u([d({type:ct.ofType(jY),readOnly:!0})],sM.prototype,"devices",void 0),u([d({type:["document","view","none"]})],sM.prototype,"enabledFocusMode",void 0),sM=u([P("esri.views.input.gamepad.GamepadSettings")],sM);const J7e=sM;let FL=class extends Ae{constructor(){super(...arguments),this.gamepad=new J7e}};u([d({readOnly:!0})],FL.prototype,"gamepad",void 0),FL=u([P("esri.views.input.Input")],FL);const K7e=FL;let M0=class extends Ae{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],M0.prototype,"enabled",void 0),u([d({type:jY})],M0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],M0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],M0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],M0.prototype,"velocityFactor",void 0),M0=u([P("esri.views.navigation.gamepad.GamepadSettings")],M0);const $_e=M0;let G1=class extends Ae{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new $_e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],G1.prototype,"browserTouchPanEnabled",void 0),u([d({type:$_e,nonNullable:!0})],G1.prototype,"gamepad",void 0),u([d({type:Boolean})],G1.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],G1.prototype,"mouseWheelZoomEnabled",void 0),G1=u([P("esri.views.navigation.Navigation")],G1);const D_e=G1;function pTt(e,t,i){const r=L_e(e),s=t,n=eje(r,s,i);if(r){const o=rx.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new q("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!tje(e)||n===sc.Unsupported)return new q("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case sc.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new q("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sc.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new q("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sc.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new q("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new q("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function eje(e,t,i){if(!Tre(e)||!Tre(t))return sc.Unsupported;if(e==null||t==null)return sc.Ok;if(!i&&e.heightUnit!==t.heightUnit)return sc.Units;if(e.heightModel!==t.heightModel)return sc.HeightModel;switch(e.heightModel){case"gravity-related-height":return sc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?sc.Ok:sc.CRS;default:return sc.Unsupported}}var sc;function Tre(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function tje(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!U_e(e)}function L_e(e){const t=e.url&&Qv(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&N_e(e)&&e.heightModelInfo?e.heightModelInfo:U_e(e)?rx.deriveUnitFromSR(rje,e.spatialReference):null}function N_e(e){return"heightModelInfo"in e}function F_e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function U_e(e){return F_e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):k_e(e)}function ije(e){return e.layers!=null||k_e(e)||F_e(e)||N_e(e)}function k_e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(sc||(sc={}));const rje=new rx({heightModel:"gravity-related-height"});var Ge;function Sre(e){return e==="global"?Ge.Global:Ge.Local}function k6(e){return e===Ge.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ge||(Ge={}));let Hj,z6=null;async function sje(e){z6||(z6=Promise.resolve().then(function(){return eut}).then(t=>Hj=t)),await z6,Wt(e)}async function z_e(e,t,i,r){if(!e)return null;const s=e.spatialReference;return aX()||qv(s,t)?OE(e,t):Hj?Hj.projectGeometry(e,t,i,r):(await Promise.race([sje(r),bF(r)]),z_e(e,t,i,r))}let Pr=class extends Ae{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=zh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return M(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);_(a)&&(i=a)}if(_(i)&&i.length===1)break}if(t&&(M(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:_(r)?r.spatialReference:null,viewingMode:_(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(ije(o)){const a=L_e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(M(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=zh(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:a3(async s=>{try{const n=await z_e(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=ye(F({},this._projectExtentTask),{task:null,output:n})}catch{if(bs(s))return;this._projectExtentTask=ye(F({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(M(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return M(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Ge.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ge.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||M(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],Pr.prototype,"required",void 0),u([d({constructOnly:!0})],Pr.prototype,"map",void 0),u([d({constructOnly:!0})],Pr.prototype,"getSpatialReferenceSupport",void 0),u([d()],Pr.prototype,"defaultSpatialReference",void 0),u([d()],Pr.prototype,"userSpatialReference",void 0),u([d()],Pr.prototype,"sourcePreloadCount",void 0),u([d()],Pr.prototype,"priorityCollection",void 0),u([d()],Pr.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Pr.prototype,"suspended",void 0),u([d({readOnly:!0})],Pr.prototype,"ready",null),u([d({readOnly:!0})],Pr.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Pr.prototype,"spatialReference",null),u([d({readOnly:!0})],Pr.prototype,"extent",null),u([d({readOnly:!0})],Pr.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Pr.prototype,"vcsWkid",null),u([d({readOnly:!0})],Pr.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Pr.prototype,"viewingMode",null),u([d({readOnly:!0})],Pr.prototype,"tileInfo",null),u([d({readOnly:!0})],Pr.prototype,"mapCollections",null),u([d({readOnly:!0})],Pr.prototype,"_allLayers",null),u([d({readOnly:!0})],Pr.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Pr.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Pr.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Pr.prototype,"_extentCandidatesTask",null),u([d()],Pr.prototype,"_extentTask",null),u([d()],Pr.prototype,"_projectExtentTask",void 0),Pr=u([P("esri.views.support.DefaultsFromMap")],Pr);var UL;const wI=de.getLogger("esri.views.View");let Rt=UL=class extends Jh(Zr.EventedMixin(yE(Ae))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Ew({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new tw,this.analyses=new P2,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ct,this.magnifier=new M_e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new K7e,this.navigation=new D_e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new B7e(this),this.persistableViewModels=new ct,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(ae(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,UL.views.add(this)):(this._currentSpatialReference=null,UL.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Qi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,IO(()=>this.ready)))),this.basemapView=new A0({view:this}),this.layerViewManager=new L7e({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Y7e({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ae(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=ye(F({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),ae(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),ae(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([ae(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(_(e))return;const s=Vh(()=>e=zh(e));e=a3(async n=>{try{await h2(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}wI.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=at(this.graphics),this.analyses=at(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),at(this.analysisViewManager),this.toolViewManager=at(this.toolViewManager),this.layerViewManager=at(this.layerViewManager),this.basemapView=at(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return wI.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Pr(F({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||$u.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(wI.warn("#map","The provided map is already destroyed",{map:e}),e=null),$u.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!Cc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new q("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&wI.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Cl(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Rt.views=new ct,u([d()],Rt.prototype,"_userSpatialReference",void 0),u([ht("toolViewManager.activeTool")],Rt.prototype,"activeTool",void 0),u([d({readOnly:!0})],Rt.prototype,"allLayerViews",void 0),u([d()],Rt.prototype,"groundView",void 0),u([d()],Rt.prototype,"animation",void 0),u([d()],Rt.prototype,"basemapView",void 0),u([d({readOnly:!0})],Rt.prototype,"_defaultsFromMapSettings",null),u([d()],Rt.prototype,"defaultsFromMap",null),u([d()],Rt.prototype,"fatalError",void 0),u([d({type:Xt})],Rt.prototype,"extent",void 0),u([d(hF(tw,"graphics"))],Rt.prototype,"graphics",void 0),u([d(hF(P2,"analyses"))],Rt.prototype,"analyses",void 0),u([d({readOnly:!0,type:rx})],Rt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Rt.prototype,"interacting",null),u([d({readOnly:!0})],Rt.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Rt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ct,readOnly:!0})],Rt.prototype,"layerViews",void 0),u([d({type:M_e})],Rt.prototype,"magnifier",void 0),u([d({value:null,type:I7e})],Rt.prototype,"map",null),u([d()],Rt.prototype,"padding",void 0),u([d({readOnly:!0})],Rt.prototype,"ready",void 0),u([d({type:Ze})],Rt.prototype,"spatialReference",null),u([d()],Rt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Rt.prototype,"stationary",null),u([d({readOnly:!0})],Rt.prototype,"supportsGround",void 0),u([d({type:om})],Rt.prototype,"timeExtent",void 0),u([ht("toolViewManager.tools")],Rt.prototype,"tools",void 0),u([d()],Rt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Rt.prototype,"type",void 0),u([d({type:Number})],Rt.prototype,"scale",void 0),u([d({readOnly:!0})],Rt.prototype,"updating",void 0),u([d({readOnly:!0})],Rt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Rt.prototype,"initialExtent",null),u([d()],Rt.prototype,"cursor",null),u([d({readOnly:!0})],Rt.prototype,"input",void 0),u([d({type:D_e,nonNullable:!0})],Rt.prototype,"navigation",void 0),u([d()],Rt.prototype,"layerViewManager",void 0),u([d()],Rt.prototype,"analysisViewManager",void 0),u([d()],Rt.prototype,"width",void 0),u([d()],Rt.prototype,"height",void 0),u([d({readOnly:!0})],Rt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Rt.prototype,"size",null),u([d({readOnly:!0})],Rt.prototype,"suspended",void 0),u([d({readOnly:!0})],Rt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Rt.prototype,"persistableViewModels",void 0),u([d()],Rt.prototype,"_isValid",void 0),u([d()],Rt.prototype,"_readyCycleForced",void 0),u([d()],Rt.prototype,"_currentSpatialReference",void 0),Rt=UL=u([P("esri.views.View")],Rt);const nje=Rt;let O0=class extends WN{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new q("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Fu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],O0.prototype,"done",null),u([d({readOnly:!0,type:String})],O0.prototype,"state",void 0),u([d()],O0.prototype,"target",void 0),O0=u([P("esri.views.ViewAnimation")],O0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(O0||(O0={}));const F2=O0,_C=()=>import("./TileLayerView3D.818fb5b1.js"),Ere=()=>import("./ElevationLayerView3D.2720a457.js"),Cre={"base-dynamic":()=>import("./BaseDynamicLayerView3D.dd8178d5.js"),"base-elevation":Ere,"base-tile":_C,"bing-maps":_C,"building-scene":()=>import("./BuildingSceneLayerView3D.a45076d6.js"),csv:()=>import("./CSVLayerView3D.575d5d9e.js"),elevation:Ere,feature:()=>import("./FeatureLayerView3D.ce856813.js"),geojson:()=>import("./GeoJSONLayerView3D.5818fc60.js"),graphics:()=>import("./GraphicsLayerView3D.9ee2ad11.js"),group:()=>import("./GroupLayerView.1fd26ab6.js"),imagery:()=>import("./ImageryLayerView3D.39fe3052.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.75f1edae.js"),"line-of-sight":()=>import("./LineOfSightLayerView3D.c729e8b6.js"),"map-image":()=>import("./MapImageLayerView3D.3d864bf2.js"),media:()=>import("./MediaLayerView3D.ef89bc4b.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.f0a37ff1.js"),"open-street-map":_C,"point-cloud":()=>import("./PointCloudLayerView3D.ff40ff57.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.0c141b71.js"),route:()=>import("./RouteLayerView3D.90a3cca6.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.dd6b6c71.js"):import("./SceneLayerGraphicsView3D.1d3f8517.js"),stream:()=>import("./StreamLayerView3D.15095cf9.js"),tile:_C,"imagery-tile":()=>import("./ImageryTileLayerView3D.bdf7035e.js"),"vector-tile":()=>import("./VectorTileLayerView3D.60032183.js"),wcs:()=>import("./ImageryTileLayerView3D.bdf7035e.js"),"web-tile":_C,wfs:()=>import("./WFSLayerView3D.e7351c5b.js"),wms:()=>import("./WMSLayerView3D.be2dfaa1.js"),wmts:()=>import("./WMTSLayerView3D.8bdb9b2a.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function oje(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new q(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const Are={hasLayerViewModule:e=>_(Cre[e.type]),importLayerView:e=>{const t=Cre[e.type];if(M(t))throw oje(e);return t(e)}},aje=de.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Mre="analyses-owner-handles";var wS,vb;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(wS||(wS={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(vb||(vb={}));let j1=class extends E2{constructor(e){super(e),this._allAnalysisViews=new ct,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=hp(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(hi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(hi()),this._attachedToViewResolver=hp(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(M(t)||t.state.list===vb.REMOVED)throw new q("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Mre)}_disconnectOwners(){this.handles.remove(Mre),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:wS.PENDING,list:vb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=a3(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=vb.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=vb.REMOVED,this._scheduleUpdate()):aje.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=gE(()=>this._update()))}_update(){this._scheduledUpdateHandle=sn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===vb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case wS.PENDING:e.createAnalysisViewTask=zh(e.createAnalysisViewTask);break;case wS.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=at(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,M(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(bs(t))throw this._creatingViewCount-=1,hi("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(bs(t))throw this._creatingViewCount-=1,n.destroy(),hi("AnalysisView creation aborted");return e.view=n,e.state.view=wS.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.05db8794.js").then(function(t){return t.A});case"dimensioning":return import("./DimensioningAnalysisView3D.e774f95e.js").then(function(t){return t.D});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.d0221e97.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.81fd136e.js");case"slice":return import("./SliceAnalysisView3D.6324d9d7.js").then(function(t){return t.S})}}};u([d()],j1.prototype,"updating",null),u([d({constructOnly:!0})],j1.prototype,"view",void 0),u([d()],j1.prototype,"_allAnalysisViews",void 0),u([d()],j1.prototype,"_creatingViewCount",void 0),j1=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],j1);const lje=j1,cje=de.getLogger("esri.views.3d.state.Constraints");let Xm=class extends Ae{constructor(e){super(e),this.collision=new nM,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Ge.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ge.Local?this._set("altitude",e):cje.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Ne(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return Ne(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ge.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=V6)=>(i.min=Ao.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?nL([[4e3,Ao.max],[1e4,Pt(88)],[6e6,Pt(88)]]):()=>Ao.max;return(t,i=V6)=>(i.min=Ao.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?nL([[4e3,Ao.max],[5e4,Pt(88)],[6e6,Pt(88)],[2e7,Ao.min]]):nL([[3e5,Ao.max],[3e6,Pt(88)],[6e6,Pt(88)],[2e7,Ao.min]]);return(t,i=V6)=>(i.min=Ao.min,i.max=e(t),i)}};function uje(e){return{min:-2e5,max:4*e.radius}}u([d()],Xm.prototype,"altitude",null),u([d({readOnly:!0})],Xm.prototype,"collision",void 0),u([d()],Xm.prototype,"distance",void 0),u([d({readOnly:!0})],Xm.prototype,"minimumPoiDistance",void 0),u([d()],Xm.prototype,"tilt",void 0),u([d({constructOnly:!0})],Xm.prototype,"mode",void 0),Xm=u([P("esri.views.3d.state.Constraints")],Xm);const Ore=uje($i),Ao={min:Pt(.5),max:Pt(179.5)},V6={min:0,max:0};let nM=class extends Ae{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],nM.prototype,"enabled",void 0),u([d({type:Number})],nM.prototype,"elevationMargin",void 0),nM=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],nM);let xS=class extends Ae{constructor(){super(...arguments),this.min=Ore.min,this.max=Ore.max}};u([d({type:Number})],xS.prototype,"min",void 0),u([d({type:Number})],xS.prototype,"max",void 0),xS=u([P("esri.views.3d.constraints.AltitudeConstraint")],xS);let ug=class extends Ae{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],ug.prototype,"near",null),u([Nt("near")],ug.prototype,"castNear",null),u([d({type:Number,value:1e-8})],ug.prototype,"far",null),u([Nt("far")],ug.prototype,"castFar",null),u([d({type:["auto","manual"]})],ug.prototype,"mode",void 0),ug=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],ug);const qj={min:Al(Ao.min),max:Al(Ao.max)};let _b=class extends Ae{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Ne(e,qj.min,qj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],_b.prototype,"mode",void 0),u([d({type:Number,value:qj.max})],_b.prototype,"max",null),u([Nt("max")],_b.prototype,"castMax",null),_b=u([P("esri.views.3d.constraints.TiltConstraint")],_b);let bb=class extends Ae{constructor(){super(...arguments),this.tilt=new _b,this.altitude=new xS,this.clipDistance=new ug}};u([d({type:_b})],bb.prototype,"tilt",void 0),u([d({type:xS})],bb.prototype,"altitude",void 0),u([d({type:ug})],bb.prototype,"clipDistance",void 0),bb=u([P("esri.views.3d.constraints.Constraints")],bb);var Wj;let uh=Wj=class extends xe{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new Wj(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],uh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],uh.prototype,"date",void 0),u([Ie("date",["datetime"])],uh.prototype,"readDate",null),u([He("date")],uh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],uh.prototype,"directShadowsEnabled",void 0),u([Ie("directShadowsEnabled",["directShadows"])],uh.prototype,"readDirectShadowsEnabled",null),u([He("directShadowsEnabled")],uh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],uh.prototype,"displayUTCOffset",void 0),u([He("displayUTCOffset")],uh.prototype,"writeDisplayUTCOffset",null),uh=Wj=u([P("esri.webscene.SunLighting")],uh);const nR=uh;var HT;let nf=HT=class extends Zr.EventedMixin(nR){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new HT(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=HT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=HT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(B6.target=this,B6.timezoneOffset=s,this.emit("timezone-will-change",B6)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new HT(ye(F({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],nf.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],nf.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],nf.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],nf.prototype,"defaultDate",null),u([d({type:Date})],nf.prototype,"date",null),nf=HT=u([P("esri.views.3d.environment.SunLighting")],nf),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(nf||(nf={}));const B6={target:null,timezoneOffset:0},R0=nf;var Xj;let oM=Xj=class extends xe{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Xj(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],oM.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],oM.prototype,"directShadowsEnabled",void 0),oM=Xj=u([P("esri.webscene.VirtualLighting")],oM);const bU=oM;var kL;let aM=kL=class extends Zr.EventedMixin(bU){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new kL(ye(F({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(e){return new kL(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],aM.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],aM.prototype,"waterReflectionEnabled",void 0),aM=kL=u([P("esri.views.3d.environment.VirtualLighting")],aM);const lM=aM,hje={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:R0,virtual:lM}};var Yj;let sO=Yj=class extends Ae{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new Yj({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],sO.prototype,"quality",null),sO=Yj=u([P("esri.views.3d.environment.SceneViewAtmosphere")],sO);var Zj;let cM=Zj=class extends xe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new Zj({cloudCover:this.cloudCover})}};u([mt({sunny:"sunny"})],cM.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],cM.prototype,"cloudCover",void 0),cM=Zj=u([P("esri.views.3d.environment.SunnyWeather")],cM);const Qj=cM;var Jj;let uM=Jj=class extends xe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new Jj({cloudCover:this.cloudCover})}};u([mt({cloudy:"cloudy"})],uM.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],uM.prototype,"cloudCover",void 0),uM=Jj=u([P("esri.views.3d.environment.CloudyWeather")],uM);const dje=uM;var Kj;let hM=Kj=class extends xe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Kj({fogStrength:this.fogStrength})}};u([mt({foggy:"foggy"})],hM.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],hM.prototype,"fogStrength",void 0),hM=Kj=u([P("esri.views.3d.environment.FoggyWeather")],hM);const pje=hM;var eH;let qT=eH=class extends xe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new eH({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([mt({rainy:"rainy"})],qT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qT.prototype,"precipitation",void 0),qT=eH=u([P("esri.views.3d.environment.RainyWeather")],qT);const fje=qT;var tH;let H1=tH=class extends xe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new tH({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([mt({snowy:"snowy"})],H1.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H1.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H1.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],H1.prototype,"snowCover",void 0),H1=tH=u([P("esri.views.3d.environment.SnowyWeather")],H1);const mje=H1,V_e={key:"type",base:Qj,typeMap:{sunny:Qj,cloudy:dje,rainy:fje,snowy:mje,foggy:pje}},gje=Object.keys(V_e.typeMap);function yje(e,t){return!!gje.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const wh=1e4,vje={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:nR,virtual:bU}};let zL=class extends xe{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],zL.prototype,"type",void 0),zL=u([P("esri.webscene.background.Background")],zL);const B_e=zL;var iH;const _je=ye(F({},oy),{nonNullable:!0});let dM=iH=class extends B_e{constructor(e){super(e),this.type="color",this.color=new We([0,0,0,1])}clone(){return new iH(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([mt({color:"color"},{readOnly:!0})],dM.prototype,"type",void 0),u([d(_je)],dM.prototype,"color",void 0),dM=iH=u([P("esri.webscene.background.ColorBackground")],dM);const G_e=dM,Rre={base:B_e,key:"type",typeMap:{color:G_e}};function bje(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const wje={types:Rre,json:{read:bje(Rre),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var rH;const xje=de.getLogger("esri.webscene.Environment"),Pre=(e,t,i)=>({enabled:!i||!i.isPresentation});let P0=rH=class extends xe{constructor(e){super(e),this.lighting=new nR,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){yje(e==null?void 0:e.type,xje)&&this._set("weather",e)}clone(){return new rH(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?bU.prototype.clone.call(this.lighting):nR.prototype.clone.call(this.lighting),background:te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:vje,nonNullable:!0,json:{write:!0}})],P0.prototype,"lighting",void 0),u([d(wje)],P0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Pre}}})],P0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Pre}}})],P0.prototype,"starsEnabled",void 0),u([d({types:V_e,nonNullable:!0,json:{write:!0},value:new Qj})],P0.prototype,"weather",null),P0=rH=u([P("esri.webscene.Environment")],P0);const j_e=P0;var pM;let WT=pM=class extends j_e{constructor(e){super(e),this.atmosphere=new sO,this.lighting=new R0}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new pM(ye(F({},t),{lighting:t.lighting.type==="virtual"?lM.fromWebsceneLighting(t.lighting):R0.fromWebsceneLighting(t.lighting)}))}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof R0||e instanceof lM?e:e instanceof nR?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new R0(e.cloneConstructProperties()):e instanceof bU?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new lM(e.cloneConstructProperties()):up(hje,e):new R0}clone(){return new pM({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background)})}cloneWithWebsceneEnvironment(e){return new pM(ye(F({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):R0.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):lM.fromWebsceneLighting(e.lighting):R0.fromWebsceneLighting(e.lighting)}};u([d({type:sO,json:{read:!1},nonNullable:!0})],WT.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],WT.prototype,"lighting",void 0),u([Nt("lighting")],WT.prototype,"castLighting",null),WT=pM=u([P("esri.views.3d.environment.SceneViewEnvironment")],WT);const XT=WT;function co(e,t){return e[0]=t[0],e[1]=t[1],e}function fi(e,t,i){return e[0]=t,e[1]=i,e}function zd(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Af(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function H_e(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function q_e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Tje(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Sje(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Eje(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function Cje(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function Aje(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function pc(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function Mje(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function HY(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function GF(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function qY(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function W_e(e){const t=e[0],i=e[1];return t*t+i*i}function WY(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Oje(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function oR(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Xs(e,t){return e[0]*t[0]+e[1]*t[1]}function Rje(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function YT(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function Pje(e,t){t=t||1;const i=2*Yd()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function sH(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function q1(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function Ije(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function $je(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function Dje(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function Lje(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Nje(e){return"vec2("+e[0]+", "+e[1]+")"}function X_e(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fje(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Ct*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Ct*Math.max(1,Math.abs(r),Math.abs(n))}function Uje(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const kje=qY,zje=Af,Vje=H_e,Bje=q_e,Y_e=HY,Gje=GF,jje=W_e;Object.freeze(Object.defineProperty({__proto__:null,copy:co,set:fi,add:zd,subtract:Af,multiply:H_e,divide:q_e,ceil:Tje,floor:Sje,min:Eje,max:Cje,round:Aje,scale:pc,scaleAndAdd:Mje,distance:HY,squaredDistance:GF,length:qY,squaredLength:W_e,negate:WY,inverse:Oje,normalize:oR,dot:Xs,cross:Rje,lerp:YT,random:Pje,transformMat2:sH,transformMat2d:q1,transformMat3:Ije,transformMat4:$je,rotate:Dje,angle:Lje,str:Nje,exactEquals:X_e,equals:Fje,projectAndScale:Uje,len:kje,sub:zje,mul:Vje,div:Bje,dist:Y_e,sqrDist:Gje,sqrLen:jje},Symbol.toStringTag,{value:"Module"}));function Z_e(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const nH=1e4,bx=Ue(5802e-9,13558e-9,331e-7),G6=3,j6=Ue(65e-8*G6,1881e-9*G6,85e-9*G6),Hje=3996e-9,qje=.085,VL=1e5;class Bs{}function x(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(x||(x={}));var O;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(O||(O={}));var tn;function Dg(e,t){switch(t.textureCoordinateType){case tn.Default:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case tn.Atlas:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(O.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case tn.None:return void e.vertex.code.add(x`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case tn.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(tn||(tn={}));function Mc(e){e.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Lu(e){e.include(Mc),e.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function wU(e){e.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var zi;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(zi||(zi={}));class Qr{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[zi.Pass]:null,[zi.Draw]:null},_(r)&&_(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class mi extends Qr{constructor(t,i){super(t,"vec2",zi.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class Lg extends Qr{constructor(t){super(t,"vec2")}}class Tt extends Qr{constructor(t,i){super(t,"vec3",zi.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class bl extends Qr{constructor(t){super(t,"vec3")}}class Ua extends Qr{constructor(t){super(t,"vec4")}}class Ui extends Qr{constructor(t){super(t,"float")}}class xr extends Qr{constructor(t,i){super(t,"mat4",zi.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const Wje=de.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Q_e{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){Wje.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class Xi extends Q_e{constructor(){super(...arguments),this.vertex=new Ire,this.fragment=new Ire,this.attributes=new Zje,this.varyings=new Qje,this.extensions=new U2,this.constants=new ys}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?Kje:Jje,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class Xje{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new q(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class Yje{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Ire extends Q_e{constructor(){super(...arguments),this.uniforms=new Xje,this.code=new Yje,this.constants=new ys}get builder(){return this}}class Zje{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class Qje{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class U2{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?U2.ALLOWLIST_VERTEX:U2.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}U2.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],U2.ALLOWLIST_VERTEX=[];class ys{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=ys._numberToFloatStr(r);break;case"int":s=ys._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${ys._numberToFloatStr(r[0])},                            ${ys._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${ys._numberToFloatStr(r[0])},                            ${ys._numberToFloatStr(r[1])},                            ${ys._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${ys._numberToFloatStr(r[0])},                            ${ys._numberToFloatStr(r[1])},                            ${ys._numberToFloatStr(r[2])},                            ${ys._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${ys._numberToIntStr(r[0])},                             ${ys._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${ys._numberToIntStr(r[0])},                             ${ys._numberToIntStr(r[1])},                             ${ys._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${ys._numberToIntStr(r[0])},                             ${ys._numberToIntStr(r[1])},                             ${ys._numberToIntStr(r[2])},                             ${ys._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>ys._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const Jje=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Kje=`precision highp float;
precision highp sampler2D;`;class kr extends Qr{constructor(t){super(t,"sampler2D")}}function eHe(e){const t=new Xi;t.attributes.add(O.POSITION,"vec2"),t.include(Dg,{textureCoordinateType:tn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new xr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new xr("inverseViewMatrix",(s,n)=>Xr(tHe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Lg("radii"),new Ui("scaleHeight"),new bl("cameraPosition"),new Ua("heightParameters"),new Ui("innerFadeDistance"),new Ui("altitudeFade"),new kr("depthTex"),new bl("betaRayleigh"),new bl("betaCombined"),new Ui("betaMie"),new Ui("hazeStrength")]),t.include(wU),e.haze&&(r.include(Lu),r.uniforms.add(new mi("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const tHe=Ee(),iHe=Object.freeze(Object.defineProperty({__proto__:null,build:eHe},Symbol.toStringTag,{value:"Module"}));class rr{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var Ki,$t,Oe,Jg,xt,tp,k2,dt,fr,ss,it,wt,ft,ze,gt,Et,Da,Ci,du,Rn,is,Pi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Ki||(Ki={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}($t||($t={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Oe||(Oe={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Jg||(Jg={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(xt||(xt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(tp||(tp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(k2||(k2={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(dt||(dt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(fr||(fr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(ss||(ss={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(it||(it={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(wt||(wt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ft||(ft={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Et||(Et={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Da||(Da={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Ci||(Ci={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(du||(du={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Rn||(Rn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(is||(is={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Pi||(Pi={}));const H6=33984;var vn,eu;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(vn||(vn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(eu||(eu={}));const $re=33306;var ts,Dre,Lre,Nre,jF,oH,Fre;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ts||(ts={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Dre||(Dre={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Lre||(Lre={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Nre||(Nre={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(jF||(jF={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(oH||(oH={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Fre||(Fre={}));class dr{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Je(this._program),this._pipeline=this._configuration=null}reload(t){Je(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return $t.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const Vi=new Map([[O.POSITION,0],[O.NORMAL,1],[O.UV0,2],[O.COLOR,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),rHe=de.getLogger("esri/views/webgl");function sHe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const J_e=!!he("enable-feature:webgl-debug");function gh(){return J_e}function aR(){return J_e}function yv(e){if(gh()){const t=e.getError();if(t){const i=sHe(e,t),r=new Error().stack;rHe.error(new q("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class sr{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new It({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(zi.Pass,this),this.bindDraw=i.generateBind(zi.Draw,this),this._fragmentUniforms=gh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(M(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var hr,Cw,wb,yt,Ls,lc,Sl,z2,Kg,El,Pv,V2,cr,Aw;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(hr||(hr={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Cw||(Cw={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(wb||(wb={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(yt||(yt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(Ls||(Ls={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(lc||(lc={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Sl||(Sl={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(z2||(z2={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Kg||(Kg={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(El||(El={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(Pv||(Pv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(V2||(V2={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(cr||(cr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(Aw||(Aw={}));function lm(e,t,i=Jg.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function uo(e,t,i,r,s=Jg.ADD,n=Jg.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const XY={face:tp.BACK,mode:k2.CCW},K_e={face:tp.FRONT,mode:k2.CCW},xU=e=>e===hr.Back?XY:e===hr.Front?K_e:null,Dl={zNear:0,zFar:1},ri={r:!0,g:!0,b:!0,a:!0};function nHe(e){return pHe.intern(e)}function oHe(e){return fHe.intern(e)}function aHe(e){return mHe.intern(e)}function lHe(e){return gHe.intern(e)}function cHe(e){return yHe.intern(e)}function uHe(e){return vHe.intern(e)}function hHe(e){return _He.intern(e)}function dHe(e){return bHe.intern(e)}function zt(e){return wHe.intern(e)}class cy{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function uy(e){return"["+e.join(",")+"]"}const pHe=new cy(e1e,e=>F({__tag:"Blending"},e));function e1e(e){return e?uy([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const fHe=new cy(t1e,e=>F({__tag:"Culling"},e));function t1e(e){return e?uy([e.face,e.mode]):null}const mHe=new cy(i1e,e=>F({__tag:"PolygonOffset"},e));function i1e(e){return e?uy([e.factor,e.units]):null}const gHe=new cy(r1e,e=>F({__tag:"DepthTest"},e));function r1e(e){return e?uy([e.func]):null}const yHe=new cy(s1e,e=>F({__tag:"StencilTest"},e));function s1e(e){return e?uy([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const vHe=new cy(n1e,e=>F({__tag:"DepthWrite"},e));function n1e(e){return e?uy([e.zNear,e.zFar]):null}const _He=new cy(o1e,e=>F({__tag:"ColorWrite"},e));function o1e(e){return e?uy([e.r,e.g,e.b,e.a]):null}const bHe=new cy(a1e,e=>F({__tag:"StencilWrite"},e));function a1e(e){return e?uy([e.mask]):null}const wHe=new cy(xHe,e=>({blending:nHe(e.blending),culling:oHe(e.culling),polygonOffset:aHe(e.polygonOffset),depthTest:lHe(e.depthTest),stencilTest:cHe(e.stencilTest),depthWrite:uHe(e.depthWrite),colorWrite:hHe(e.colorWrite),stencilWrite:dHe(e.stencilWrite)}));function xHe(e){return e?uy([e1e(e.blending),t1e(e.culling),i1e(e.polygonOffset),r1e(e.depthTest),s1e(e.stencilTest),n1e(e.depthWrite),o1e(e.colorWrite),a1e(e.stencilWrite)]):null}class THe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class lR extends dr{initializeProgram(t){const i=lR.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return this.configuration.haze?zt({blending:uo(Oe.ONE,Oe.ZERO,Oe.ONE_MINUS_SRC_COLOR,Oe.ONE),colorWrite:ri}):zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}lR.shader=new rr(iHe,()=>import("./ChapmanAtmosphere.glsl.0071971d.js"));class Ha{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function j(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class l1e extends Ha{constructor(){super(...arguments),this.haze=!1}}u([j()],l1e.prototype,"haze",void 0);class ao{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new ao(O.POSITION,3,dt.FLOAT,0,12);new ao(O.POSITION,3,dt.FLOAT,0,20),new ao(O.UV0,2,dt.FLOAT,12,20);new ao(O.POSITION,3,dt.FLOAT,0,32),new ao(O.NORMAL,3,dt.FLOAT,12,32),new ao(O.UV0,2,dt.FLOAT,24,32);new ao(O.POSITION,3,dt.FLOAT,0,16),new ao(O.COLOR,4,dt.UNSIGNED_BYTE,12,16);const YY=[new ao(O.POSITION,2,dt.FLOAT,0,8)],I3=[new ao(O.POSITION,2,dt.FLOAT,0,16),new ao(O.UV0,2,dt.FLOAT,8,16)];var pi;function SHe(e,t,i={}){const r=c1e(e);for(;r.length>1;){const s=HF(t,r.shift(),i);if(_(s))return s}return EHe(t,r.shift(),i)}function c1e(e){const t=he("esri-force-webgl");if(t===pi.WEBGL1||t===pi.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[pi.WEBGL1,pi.WEBGL2]:[pi.WEBGL2,pi.WEBGL1];case"3d":return[pi.WEBGL2,pi.WEBGL1]}}function EHe(e,t,i={}){if(!window.WebGLRenderingContext)return Ure(e,CHe),null;const r=HF(e,t,i);return M(r)&&Ure(e,AHe),r}function HF(e,t,i={}){const r=t===pi.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function Ure(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(pi||(pi={}));const CHe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',AHe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Ic=de.getLogger("esri.views.webgl.BufferObject");function MHe(e){return hCe(e)}class ai{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(vn.BufferObject,this),this._glName=this._context.gl.createBuffer(),yv(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new ai(t,xt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new ai(t,xt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==pi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new ai(t,xt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=Ci.STREAM_READ,r){if(t.type!==pi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new ai(t,xt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=Ci.STREAM_DRAW,r){if(t.type!==pi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new ai(t,xt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===xt.ELEMENT_ARRAY_BUFFER?this._indexType===dt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===xt.ELEMENT_ARRAY_BUFFER||this.bufferType===xt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(vn.BufferObject,this),this._context=null):this._glName&&Ic.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&Ic.error("Buffer size needs to be positive!"),this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case dt.UNSIGNED_SHORT:t*=2;break;case dt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&(RN(t)&&(i/=2,this._indexType=dt.UNSIGNED_SHORT),PN(t)&&(i/=4,this._indexType=dt.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),yv(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&Ic.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&(RN(t)?(l/=2,n*=2,o*=2,a*=2):PN(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&Ic.error("end must be bigger than start!"),i+r-s>this._size&&Ic.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),yv(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&Ic.error("offset is out of range!"),r>=s&&Ic.error("end must be bigger than start!"),i+r-s>this._size&&Ic.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===pi.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}yv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==pi.WEBGL2)return void Ic.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Ic.error("Problem getting subdata: offset and length were less than zero!");const n=MHe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void Ic.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&Ic.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,xt.COPY_READ_BUFFER),o.getBufferSubData(xt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(xt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===pi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):Ic.error("Get buffer subdata is supported in WebGL2 only!")}}function Dn(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const kre=4;class ot{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(vn.Texture,this),this._descriptor=F({target:ft.TEXTURE_2D,samplingMode:it.LINEAR,wrapMode:wt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==pi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),$_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===ft.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(vn.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===ft.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=ft.TEXTURE_CUBE_MAP_POSITIVE_X;i<=ft.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=$_(i);t===null&&(s.width=s.width||kre,s.height=s.height||kre,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),ot._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(q6(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),this._texImage(i,0,l,h,p,f,t),yv(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),BL(t)){const m=t.levels,y=zre(i,h,p,f),v=Math.min(y-1,m.length-1);Dn(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&y===m.length;const b=l;if(!RHe(b))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((w,S,T,E)=>{const C=m[Math.min(w,m.length-1)];this._compressedTexImage(i,w,b,S,T,E,C)},v)}else _(t)?(this._texImage(i,0,l,h,p,f,t),yv(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,y,v,b)=>{this._texImage(i,m,l,y,v,b,null),yv(r)})}ot._applySamplingMode(r,this._descriptor),ot._applyWrapMode(r,this._descriptor),ot._applyAnisotropicFilteringParameters(this._context,this._descriptor),yv(r),this._context.bindTexture(o,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),q6(o)?a.texSubImage2D(m,t,i,r,c,p,o):BL(o)?a.compressedTexSubImage2D(m,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(m,t,i,r,s,n,c,p,o),this._context.bindTexture(y,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!Dn(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:y,internalFormat:v}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");$_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const b=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),BL(l))l=l.levels[t],c.compressedTexSubImage3D(y,t,i,r,s,n,o,a,v,l);else{const w=l;c.texSubImage3D(y,t,i,r,s,n,o,a,p,f,w)}this._context.bindTexture(b,ot.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,ot._validateTexture(this._context,t)}t.samplingMode===it.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=it.LINEAR_MIPMAP_NEAREST):t.samplingMode===it.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=it.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,ot.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,ot._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(ot._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(ot._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===pi.WEBGL1)return t;switch(i){case Et.FLOAT:switch(t){case ze.RGBA:return gt.RGBA32F;case ze.RGB:return gt.RGB32F;default:throw new Error("Unable to derive format")}case Et.UNSIGNED_BYTE:switch(t){case ze.RGBA:return gt.RGBA8;case ze.RGB:return gt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!Dn(a))throw new Error("Immutable textures are not supported in WebGL1");if(!OHe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?zre(t,s,n,o):1;$_(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===pi.WEBGL2,p=$_(t),{isImmutable:f,pixelFormat:m,dataType:y}=this._descriptor;if(h&&(c=l),h||!q6(a))if(f){if(_(a)){const v=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,m,y,v):l.texSubImage2D(t,i,0,0,s,n,m,y,v)}}else{const v=a;p?c.texImage3D(t,i,r,s,n,o,0,m,y,v):l.texImage2D(t,i,r,s,n,0,m,y,v)}else l.texImage2D(t,0,r,m,y,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=$_(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==pi.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ft.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=Dn(t.gl),s=g2(i.width)&&g2(i.height);r||!i.isImmutable&&!$_(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==wt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===wt.CLAMP_TO_EDGE&&i.wrapMode.t===wt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===it.LINEAR_MIPMAP_NEAREST||r===it.LINEAR_MIPMAP_LINEAR?(r=it.LINEAR,i.hasMipmap||(s=it.LINEAR)):r!==it.NEAREST_MIPMAP_NEAREST&&r!==it.NEAREST_MIPMAP_LINEAR||(r=it.NEAREST,i.hasMipmap||(s=it.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function OHe(e){return e in gt}function RHe(e){return e in ts}function BL(e){return _(e)&&"type"in e&&e.type==="compressed"}function PHe(e){return _(e)&&"byteLength"in e}function q6(e){return _(e)&&!BL(e)&&!PHe(e)}function $_(e){return e===ft.TEXTURE_3D||e===ft.TEXTURE_2D_ARRAY}function zre(e,t,i,r=1){let s=Math.max(t,i);return e===ft.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}ot.TEXTURE_UNIT_FOR_UPDATES=0;function Vre(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Po(e,t){return e.vertexBuffers[t].size/IHe(e.layout[t])}function IHe(e){return e[0].stride}function ZY(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function QY(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(xt.ARRAY_BUFFER)}function u1e(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case Da.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case Da.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case Da.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case Da.DEPTH_STENCIL:case Da.DEPTH_COMPONENT32F:case Da.DEPTH24_STENCIL8:return 4;case Da.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case ts.COMPRESSED_RGB_S3TC_DXT1_EXT:case ts.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ts.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ts.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ts.COMPRESSED_R11_EAC:case ts.COMPRESSED_SIGNED_R11_EAC:case ts.COMPRESSED_RGB8_ETC2:case ts.COMPRESSED_SRGB8_ETC2:case ts.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ts.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ts.COMPRESSED_RG11_EAC:case ts.COMPRESSED_SIGNED_RG11_EAC:case ts.COMPRESSED_RGBA8_ETC2_EAC:case ts.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Mw(e){if(M(e))return 0;if("descriptor"in e)return e.glName?Mw(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return u1e(t)*r*i}const D_=de.getLogger("esri.views.webgl.VertexArrayObject");class zs{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(vn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&D_.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):D_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Je(this._indexBuffer)}this._context.instanceCounter.decrement(vn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||D_.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||D_.error("Vertex buffer is uninitialized!");const a=i[n];a||D_.error("Vertex element descriptor is empty!"),ZY(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||D_.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||D_.error("Vertex buffer is uninitialized!");const n=i[r];QY(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function qa(e,t=YY,i=Vi,r=-1,s=1){let n=null;return t===I3?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new zs(e,i,{geometry:t},{geometry:ai.createVertex(e,Ci.STATIC_DRAW,n)})}function $He(e,t=YY,i=Vi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new zs(e,i,{geometry:t},{geometry:ai.createVertex(e,Ci.STATIC_DRAW,r)})}const h1e=4;function d1e(e,t=h1e){return new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:t,height:t})}function DHe(e,t,i=h1e){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:i,height:i},r)}function p1e(e){return new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class Bre{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=R(),this._heightParameters=qt(),this._betasRayleigh=R(),this._betasCombined=R(),this._scaleHeight=0,this._radii=st(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=$i.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius($i.radius)}destroy(){this._atmosphereTechnique=Hi(this._atmosphereTechnique),this._atmosphereHazeTechnique=Hi(this._atmosphereHazeTechnique),this._vao=Je(this._vao),this._handles=at(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new si,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(oo(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(oo(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new l1e;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(lR,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(lR,n),this._vao=qa(i,I3),this._scaleHeight=qje*VL,ie(this._betasRayleigh,bx[0],bx[1],bx[2]),ie(this._betasCombined,bx[0]+j6[0],bx[1]+j6[1],bx[2]+j6[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,LHe,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(M(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",Hje),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays($t.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:_t(this._view.basemapTerrain.rootTiles,[null])[0];if(M(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation($i.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation($i.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,fi(this._radii,t,t+VL),this._innerFadeDistance=2*Math.sqrt((2*t-nH)*nH)}_update(t){if(M(t))return;this._cameraHeight=Re(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/VL));this._heightParameters=vi(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),ne(this._cameraPosition,t.eye),this._altitudeFade=Z_e(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Zt(.6,1,y2(9500,10500,this._cameraHeight-$i.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const LHe=new Bs;function NHe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function qF(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function JY(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Ct?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function TU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function FHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function UHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function kHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function zHe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function GL(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],y=i[1],v=i[2],b=i[3];return c=s*m+n*y+o*v+a*b,c<0&&(c=-c,m=-m,y=-y,v=-v,b=-b),1-c>Ct?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*v,e[3]=p*a+f*b,e}function VHe(e){const t=Yd(),i=Yd(),r=Yd(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function BHe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function ey(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function f1e(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function GHe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function jHe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const $3=Zd,HHe=Ji,qHe=bW,WHe=TU,XHe=u3,YHe=ype,ZHe=_5,m1e=wW,QHe=m1e,g1e=xW,JHe=g1e,KY=gpe,KHe=LO,eqe=vpe;function tqe(e,t,i){const r=Se(t,i);return r<-.999999?(lt(Cp,iqe,t),_W(Cp)<1e-6&&lt(Cp,rqe,t),we(Cp,Cp),qF(e,Cp,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(lt(Cp,t,i),e[0]=Cp[0],e[1]=Cp[1],e[2]=Cp[2],e[3]=1+r,KY(e,e))}const Cp=R(),iqe=Ue(1,0,0),rqe=Ue(0,1,0);function sqe(e,t,i,r,s,n){return GL(Gre,t,s,n),GL(jre,i,r,n),GL(e,Gre,jre,2*n*(1-n)),e}const Gre=wp(),jre=wp();function nqe(e,t,i,r){const s=oqe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],KY(e,f1e(e,s))}const oqe=ir();Object.freeze(Object.defineProperty({__proto__:null,identity:NHe,setAxisAngle:qF,getAxisAngle:JY,multiply:TU,rotateX:FHe,rotateY:UHe,rotateZ:kHe,calculateW:zHe,slerp:GL,random:VHe,invert:BHe,conjugate:ey,fromMat3:f1e,fromEuler:GHe,str:jHe,copy:$3,set:HHe,add:qHe,mul:WHe,scale:XHe,dot:YHe,lerp:ZHe,length:m1e,len:QHe,squaredLength:g1e,sqrLen:JHe,normalize:KY,exactEquals:KHe,equals:eqe,rotationTo:tqe,sqlerp:sqe,setAxes:nqe},Symbol.toStringTag,{value:"Module"}));function VE(e=lqe){return[e[0],e[1],e[2],e[3]]}function cR(e,t){return aqe(e[0],e[1],e[2],t,yX.get())}function aqe(e,t,i,r,s=VE()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function uR(e,t,i=VE()){return lt(i,e,t),we(i,i),i[3]=bX(e,t),i}const lqe=[0,0,1,0];class cqe{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=R(),this.parallax={anchorPointClouds:R(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ee()},this.parallaxNew={anchorPointClouds:R(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ee()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:Zn.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:yh.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:Iv.FINISHED,factor:-1}}}var yh,Zn,Iv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(yh||(yh={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(Zn||(Zn={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Iv||(Iv={}));function Ri(){return new Float32Array(3)}function WF(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Li(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function y1e(e,t){return new Float32Array(e,t,3)}function eZ(){return Ri()}function v1e(){return Li(1,1,1)}function _1e(){return Li(1,0,0)}function b1e(){return Li(0,1,0)}function w1e(){return Li(0,0,1)}const uqe=eZ(),hqe=v1e(),dqe=_1e(),pqe=b1e(),fqe=w1e();Object.freeze(Object.defineProperty({__proto__:null,create:Ri,clone:WF,fromValues:Li,createView:y1e,zeros:eZ,ones:v1e,unitX:_1e,unitY:b1e,unitZ:w1e,ZEROS:uqe,ONES:hqe,UNIT_X:dqe,UNIT_Y:pqe,UNIT_Z:fqe},Symbol.toStringTag,{value:"Module"}));function x1e(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function tZ(e,t){switch(e.include(Dg,t),e.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case tn.Default:return void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case tn.Atlas:return e.include(x1e),void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case tn.None:case tn.COUNT:return}}class Va extends Qr{constructor(t,i){super(t,"vec3",zi.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class iZ extends Qr{constructor(t,i){super(t,"vec2",zi.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class rZ extends Qr{constructor(t,i){super(t,"sampler2D",zi.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function nO(e,t,i){const r=[new rZ(e,t)];if(i){const s=e+"Size";r.push(new iZ(s,(n,o)=>{const a=t(n,o);return _(a)?fi(mqe,a.descriptor.width,a.descriptor.height):Gh}))}return r}const mqe=st();class Bt extends Qr{constructor(t,i){super(t,"sampler2D",zi.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function jL(e,t,i){const r=[new Bt(e,t)];if(i){const s=e+"Size";r.push(new mi(s,(n,o)=>{const a=t(n,o);return _(a)?fi(gqe,a.descriptor.width,a.descriptor.height):Gh}))}return r}const gqe=st();class v_{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return lc.LOADED}}class sZ extends v_{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Hi(this._texture),this._textureNormal=Hi(this._textureNormal),this._textureEmissive=Hi(this._textureEmissive),this._textureOcclusion=Hi(this._textureOcclusion),this._textureMetallicRoughness=Hi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?lc.LOADED:lc.LOADING}get textureBindParameters(){return new T1e(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(M(this._texture)||t!==this._texture.id)&&(this._texture=Hi(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(M(t))return void i(null);const r=this._textureRepository.acquire(t);if(Fu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Hi(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class T1e extends Bs{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const fTt=Li(0,.6,.2);var Ot;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Ot||(Ot={}));function nZ(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Ot.Normal&&r&&e.include(tZ,t),t.pbrMode!==Ot.Schematic)if(t.pbrMode!==Ot.Disabled){if(t.pbrMode===Ot.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===zi.Pass?jL("texMetallicRoughness",o=>o.textureMetallicRoughness,s):nO("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===zi.Pass?jL("texEmission",o=>o.textureEmissive,s):nO("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===zi.Pass?jL("texOcclusion",o=>o.textureOcclusion,s):nO("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===zi.Pass?[new Tt("emissionFactor",o=>o.emissiveFactor),new Tt("mrrFactors",o=>o.mrrFactors)]:[new Va("emissionFactor",o=>o.emissiveFactor),new Va("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class oi extends Qr{constructor(t,i){super(t,"vec4",zi.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function oZ(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Tt("lightingAmbientSH0",(s,n)=>ie(Hre,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new oi("lightingAmbientSH_R",(s,n)=>Ji(_m,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new oi("lightingAmbientSH_G",(s,n)=>Ji(_m,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new oi("lightingAmbientSH_B",(s,n)=>Ji(_m,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Tt("lightingAmbientSH0",(s,n)=>ie(Hre,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new oi("lightingAmbientSH_R1",(s,n)=>Ji(_m,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new oi("lightingAmbientSH_G1",(s,n)=>Ji(_m,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new oi("lightingAmbientSH_B1",(s,n)=>Ji(_m,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new oi("lightingAmbientSH_R2",(s,n)=>Ji(_m,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new oi("lightingAmbientSH_G2",(s,n)=>Ji(_m,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new oi("lightingAmbientSH_B2",(s,n)=>Ji(_m,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Hre=R(),_m=qt();class Xe extends Qr{constructor(t,i){super(t,"float",zi.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function aZ(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new Xe("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new Tt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function SU(e){e.vertex.code.add(x`const float PI = 3.141592653589793;`),e.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class Ow extends Qr{constructor(t,i){super(t,"bool",zi.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class yqe extends Qr{constructor(t,i){super(t,"samplerCube",zi.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function S1e(e){const t=e.fragment;t.uniforms.add([new xr("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new xr("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new Tt("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new Tt("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new mi("cloudVariables",(i,r)=>_(r.clouds.data)?fi(vqe,r.clouds.data.coverage,r.clouds.data.absorption):Gh),new Xe("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new Xe("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new Xe("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===Zn.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(Ne(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(Ne(r.clouds.fadeInOut.factor,0,1))),new Xe("crossFadeAnchorFactor",(i,r)=>Ne(r.clouds.crossFade.factor,0,1)),new yqe("cubeMap",(i,r)=>_(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new Ow("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",$i.radius),t.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new Tt("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(x`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const vqe=st();function cm(e){e.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function _qe(){const e=new Xi;e.attributes.add(O.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new xr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new xr("inverseViewMatrix",(r,s)=>Xr(bqe,s.camera.viewMatrix))]),t.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(cm),i.include(Mc),e.include(oZ,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(SU),e.include(wU),e.include(aZ,{isGround:!1}),e.include(S1e,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new Tt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const bqe=Ee(),wqe=Object.freeze(Object.defineProperty({__proto__:null,build:_qe},Symbol.toStringTag,{value:"Module"}));class EU extends dr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=EU.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:lm(Oe.ONE,Oe.SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}EU.shader=new rr(wqe,()=>import("./CloudsComposition.glsl.47bf078c.js"));function xqe(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function qre(e){return _(e)&&!e.running}let W1=class extends Ae{constructor(e){super(e),this._technique=new EU(e),this._vao=qa(e.rctx)}destroy(){this._technique=Hi(this._technique),this._vao=Je(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(M(this._vao)||M(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,Mqe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays($t.TRIANGLE_STRIP,0,4),Aqe(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===yh.FINISHED&&(e.fadeIn.factor=1,ne(r,Ap),e.fadeIn.stage=yh.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=Zn.FINISHED);const s=Yre(e,t);e.fadeIn.stage===yh.CHANGE_ANCHOR&&s&&qre(e.data)&&(ne(r,Ap),e.fadeIn.stage=yh.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===yh.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/Xre),e.fadeIn.factor<=0&&e.fadeIn.stage===yh.FADE_IN&&(e.fadeIn.stage=yh.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(ne(e.parallaxNew.anchorPointClouds,Ap),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/Eqe),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,ne(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===Zn.FINISHED&&(e.startTime=i,r.factor=0,r.stage=Zn.FADE_OUT),r.factor<1&&r.stage===Zn.FADE_OUT&&(r.factor=(i-e.startTime)/Sqe),r.factor>=1&&r.stage===Zn.FADE_OUT&&(r.factor=1,ne(e.parallax.anchorPointClouds,Ap)),r.factor>=1&&r.stage===Zn.FADE_OUT&&Yre(e,t)&&(r.factor=1,r.stage=Zn.SWITCH,e.crossFade.enabled=!1,s.factor=1),qre(e.data)&&r.stage===Zn.SWITCH&&(e.startTime=i,r.factor=1,r.stage=Zn.FADE_IN,ne(e.parallax.anchorPointClouds,Ap),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===Zn.FADE_IN&&(r.factor=1-(i-e.startTime)/Xre),r.factor<=0&&r.stage===Zn.FADE_IN&&(r.stage=Zn.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===Iv.FINISHED?i:e.startTimeHeightFade))/Cqe;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=Ne(r.factor,0,1),r.stage=Iv.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Re(t)-this.planetRadius>wh?1:0),we(Ap,t),oe(Ap,Ap,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&ne(r.anchorPointClouds,Ap);const s=Re(fe(Tqe,r.anchorPointClouds,Ap));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==yh.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==Zn.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Re(t),a=o-this.planetRadius;if((a>1.7*wh||a<-wh)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>wh||a<-.35*wh)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<wh&&a>-.35*wh&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=Iv.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,uR(Wre,r.anchorPointClouds,wx),r.transform=Ee(),vl(r.transform,r.transform,wx[3],wx),n){const{parallaxNew:l}=e;uR(Wre,l.anchorPointClouds,wx),l.transform=Ee(),vl(l.transform,l.transform,wx[3],wx)}ne(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],W1.prototype,"rctx",void 0),u([d({constructOnly:!0})],W1.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],W1.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],W1.prototype,"requestRender",void 0),W1=u([P("esri.views.3d.environment.CloudsComposition")],W1);const Wre=Ue(0,0,1),wx=VE(),Ap=R(),Tqe=R(),Xre=500,Sqe=250,Eqe=500,Cqe=500;function Aqe(e){return e.crossFade.enabled||e.fadeInOut.stage!==Zn.FINISHED||e.fadeIn.stage!==yh.FINISHED||e.fadeInOutHeight.stage!==Iv.FINISHED}function Yre(e,t){return hw(e.cameraPositionLastFrame,t)}const Mqe=new Bs;function Sc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Oqe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function lZ(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function cZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Hh(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function lx(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function Rqe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function Pqe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function CU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],y=i[2],v=i[3],b=i[4],w=i[5],S=i[6],T=i[7],E=i[8];return e[0]=f*r+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=v*r+b*o+w*c,e[4]=v*s+b*a+w*h,e[5]=v*n+b*l+w*p,e[6]=S*r+T*o+E*c,e[7]=S*s+T*a+E*h,e[8]=S*n+T*l+E*p,e}function XF(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function uZ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function hZ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function Iqe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function $qe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Dqe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Lqe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Nqe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function AU(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[3]=h-w,e[6]=f+b,e[1]=h+w,e[4]=1-c-y,e[7]=m-v,e[2]=f-b,e[5]=m+v,e[8]=1-c-p,e}function E1e(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const v=1/y;return e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=f*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=m*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e}function Jv(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],b=t[14],w=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,L=h*v-p*y,D=h*b-f*y,k=h*w-m*y,z=p*b-f*v,V=p*w-m*v,X=f*w-m*b;let Y=S*X-T*V+E*z+C*k-A*D+I*L;return Y?(Y=1/Y,e[0]=(a*X-l*V+c*z)*Y,e[1]=(l*k-o*X-c*D)*Y,e[2]=(o*V-a*k+c*L)*Y,e[3]=(s*V-r*X-n*z)*Y,e[4]=(i*X-s*k+n*D)*Y,e[5]=(r*k-i*V-n*L)*Y,e[6]=(v*I-b*A+w*C)*Y,e[7]=(b*E-y*I-w*T)*Y,e[8]=(y*A-v*E+w*S)*Y,e):null}function Fqe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Uqe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function kqe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function zqe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function C1e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function Vqe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function Bqe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function Gqe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function jqe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],v=t[4],b=t[5],w=t[6],S=t[7],T=t[8];return Math.abs(i-p)<=Ct*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Ct*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=Ct*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=Ct*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=Ct*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-b)<=Ct*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=Ct*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-S)<=Ct*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=Ct*Math.max(1,Math.abs(h),Math.abs(T))}function dZ(e){const t=Ct,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const Hqe=CU,qqe=C1e;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Sc,copy:Oqe,set:lZ,identity:cZ,transpose:Hh,invert:lx,adjoint:Rqe,determinant:Pqe,multiply:CU,translate:XF,rotate:uZ,scale:hZ,scaleByVec2:Iqe,fromTranslation:$qe,fromRotation:Dqe,fromScaling:Lqe,fromMat2d:Nqe,fromQuat:AU,normalFromMat4Legacy:E1e,normalFromMat4:Jv,projection:Fqe,str:Uqe,frob:kqe,add:zqe,subtract:C1e,multiplyScalar:Vqe,multiplyScalarAndAdd:Bqe,exactEquals:Gqe,equals:jqe,isOrthoNormal:dZ,mul:Hqe,sub:qqe},Symbol.toStringTag,{value:"Module"}));function pZ(){return new Float32Array(2)}function Wqe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function La(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function Xqe(e,t){return new Float32Array(e,t,2)}function A1e(){return pZ()}function M1e(){return La(1,1)}function O1e(){return La(1,0)}function R1e(){return La(0,1)}const Yqe=A1e(),Zqe=M1e(),Qqe=O1e(),Jqe=R1e();Object.freeze(Object.defineProperty({__proto__:null,create:pZ,clone:Wqe,fromValues:La,createView:Xqe,zeros:A1e,ones:M1e,unitX:O1e,unitY:R1e,ZEROS:Yqe,ONES:Zqe,UNIT_X:Qqe,UNIT_Y:Jqe},Symbol.toStringTag,{value:"Module"}));var Hd;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Hd||(Hd={}));class P1e extends Ha{constructor(){super(...arguments),this.steps=Hd.SIXTEEN}}u([j({count:Hd.COUNT})],P1e.prototype,"steps",void 0);const xh=he("esri-mobile")?64:128,Kqe=xh/128,$d=Math.ceil(Math.sqrt(xh)),Bd=(xh+2)*$d,eWe=1e5,W6=128,tWe=Bd/1560;function __(e,t=!0){e.attributes.add(O.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class hR extends Qr{constructor(t,i){super(t,"mat3",zi.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class I1e extends Bs{constructor(){super(...arguments),this.viewMatrix=ir()}}function iWe(e){const t=new Xi;return t.include(__,!1),t.fragment.uniforms.add(new Ui("cloudRadius")),t.fragment.uniforms.add(new Ui("halfCubeMapSize")),t.fragment.uniforms.add(new Ui("power")),t.fragment.uniforms.add(new Ui("sigmaE")),t.fragment.uniforms.add(new Ui("density")),t.fragment.uniforms.add(new Ui("cloudSize")),t.fragment.uniforms.add(new Ui("detailSize")),t.fragment.uniforms.add(new Ui("smoothness")),t.fragment.uniforms.add(new Ui("cloudHeight")),t.fragment.uniforms.add(new Ui("coverage")),t.fragment.uniforms.add(new hR("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new kr("cloudShapeTexture")),t.fragment.code.add(x`
    const int STEPS = ${e.steps===Hd.SIXTEEN?x`16`:e.steps===Hd.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(Bd)};
      const float dataWidth = ${x.float(Bd)};
      const float tileRows = ${x.float($d)};
      const vec3 atlasDimensions = vec3(${x.float(xh)}, ${x.float(xh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(Kqe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(tWe)} * p) / ${x.float(Bd)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(x`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(x`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(x`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const rWe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:I1e,build:iWe},Symbol.toStringTag,{value:"Module"}));class bC{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const $1e={sunny:new bC([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Hd.SIXTEEN),cloudy:new bC([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Hd.TWOHUNDRED,.6),rainy:new bC([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Hd.TWOHUNDRED,.4),snowy:new bC([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Hd.HUNDRED,.65),foggy:new bC([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Hd.SIXTEEN)};class MU extends dr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=MU.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:uo(Oe.ONE,Oe.ONE,Oe.ZERO,Oe.ZERO),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}MU.shader=new rr(rWe,()=>import("./Clouds.glsl.523177c0.js"));var gu;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(gu||(gu={}));class aH extends Ha{constructor(){super(...arguments),this.mode=gu.Full}}u([j({count:gu.COUNT})],aH.prototype,"mode",void 0);function sWe(e){const t=new Xi;return t.include(__,!1),t.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new Lg("weatherTile")),e.mode===gu.Full&&t.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float($d)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(W6)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(W6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(eWe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(x`void main() {`),e.mode===gu.Full&&t.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(xh)} + 2.0 * padWidth;
        float tileCount = ${x.float($d)} * ${x.float($d)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(xh)};
          }

          if (startPadY) {
            pixel.y += ${x.float(xh)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(xh)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(xh)};
          }

          uv = vec2(pixel.xy / ${x.float(xh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(xh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float($d)} * ${x.float($d)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float($d)} * ${x.float($d)});
        p = p_;
        p.z /= (${x.float($d)} * ${x.float($d)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(x`
      vec2 mapUV = ${x.float(W6)} * (gl_FragCoord.xy / ${x.float(Bd)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===gu.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),t}const nWe=Object.freeze(Object.defineProperty({__proto__:null,build:sWe},Symbol.toStringTag,{value:"Module"}));class dR extends dr{initializeProgram(t){const i=dR.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:this.configuration.mode===gu.Full?lm(Oe.ONE,Oe.ZERO):uo(Oe.ZERO,Oe.ONE,Oe.ONE,Oe.ZERO),depthTest:{func:fr.ALWAYS},colorWrite:ri})}}dR.shader=new rr(nWe,()=>import("./NoiseTextureAtlas.glsl.78f12e6b.js"));class ZT{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(vn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==pi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(vn.Renderbuffer,this),this._context=null)}}const oWe=de.getLogger("esri.views.webgl.FrameBufferObject");class Cr{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=F({},i),t.instanceCounter.increment(vn.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=eu.COLOR_ATTACHMENT0+o;let c;Qre(a)?(Ym(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new ot(this._context,c))),xI(c,this._desc)):(Zre(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new ZT(this._context,c))),X6(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(Qre(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Ym(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new ot(this._context,a)),xI(a,this._desc);else{Zre(s)?(a=s.descriptor,o=s):(a=s,o=new ZT(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Pi.DEPTH_STENCIL_RENDER_BUFFER;l===Pi.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Pi.DEPTH_RENDER_BUFFER||l===Pi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),X6(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(vn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(eu.COLOR_ATTACHMENT0);return t&&Ym(t)?t:null}get colorAttachment(){return this._colorAttachments.get(eu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+Mw(r),0)+Mw(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&Ym(i)?i:null}attachColorTexture(t,i=eu.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),xI(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=eu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(Ym(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=eu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Ym(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(M(t))return;const i=t.descriptor;i.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Et.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),xI(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Pi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Pi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,$re)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$re)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(M(t))return;const i=t.descriptor;if(i.internalFormat!==Da.DEPTH_STENCIL&&i.internalFormat!==Da.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),X6(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===Da.DEPTH_STENCIL?Pi.DEPTH_STENCIL_RENDER_BUFFER:Pi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Pi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Rn.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Pi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Rn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==ft.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,ot.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(ft.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,ot.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==pi.WEBGL2)return gh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=ai.createPixelPack(this._context,Ci.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(xt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Rn.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:is.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===is.TEXTURE||o===is.CUBEMAP)this._colorAttachments.set(eu.COLOR_ATTACHMENT0,aWe(r,n,this.descriptor.colorTarget===is.CUBEMAP?ft.TEXTURE_CUBE_MAP:ft.TEXTURE_2D));else{const y=new ZT(r,{internalFormat:gt.RGBA4,width:a,height:l});this._colorAttachments.set(eu.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,v)=>{y&&(Ym(y)?this._framebufferTexture2D(y.glName,v,Jre(y),t):i.framebufferRenderbuffer(t,v,i.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Pi.NONE;switch(c){case Pi.DEPTH_RENDER_BUFFER:case Pi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new ZT(r,{internalFormat:n.depthStencilTarget===Pi.DEPTH_RENDER_BUFFER?Da.DEPTH_COMPONENT16:Da.DEPTH_STENCIL,width:a,height:l}));const y=c===Pi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,this._depthAttachment.glName);break}case Pi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new ZT(r,{internalFormat:Da.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Pi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:ft.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Et.UNSIGNED_INT_24_8,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new ot(r,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Jre(this._depthStencilTexture),t)}aR()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=eu.COLOR_ATTACHMENT0,r=ft.TEXTURE_2D,s=Rn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){gh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return Ym(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Rn.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Pi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Rn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Rn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Cr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Cr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Cr._MAX_COLOR_ATTACHMENTS=1}const i=t-eu.COLOR_ATTACHMENT0;i+1>Cr._MAX_COLOR_ATTACHMENTS&&oWe.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Cr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Ym(e){return"type"in e&&e.type==="texture"}function Zre(e){return"type"in e&&e.type==="renderbuffer"}function Qre(e){return Ym(e)||"pixelFormat"in e}function aWe(e,t,i){return new ot(e,{target:i,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function xI(e,t){e.target!==ft.TEXTURE_2D&&e.target!==ft.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function X6(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Jre(e){return e.descriptor.target===ft.TEXTURE_CUBE_MAP?ft.TEXTURE_CUBE_MAP_POSITIVE_X:ft.TEXTURE_2D}Cr._MAX_COLOR_ATTACHMENTS=-1;class D1e extends Ae{constructor(t){let i;super(t),this._weatherTile=La(0,0),this._needsRender=!0,this._frameBuffer=new Cr(t.context.renderContext.rctx,{colorTarget:is.TEXTURE,width:Bd,height:Bd},{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,hasMipmap:!1,width:Bd,height:Bd}),this._vao=qa(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(i)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,gu.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,gu.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=Hi(this._fullTechnique),this._weatherMapTechnique=Hi(this._weatherMapTechnique),this._frameBuffer=Je(this._frameBuffer),this._vao=Je(this._vao)}get fullTechnique(){if(M(this._fullTechnique)){const t=new aH;t.mode=gu.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(dR,t)}return this._fullTechnique}get weatherMapTechnique(){if(M(this._weatherMapTechnique)){const t=new aH;t.mode=gu.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(dR,t)}return this._weatherMapTechnique}_render(t,i){if(M(this._vao)||M(this._frameBuffer))return null;const r=i===gu.Full?this.fullTechnique:this.weatherMapTechnique;if(M(r))return null;const s=t.getViewport();t.setViewport(0,0,Bd,Bd),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],D1e.prototype,"context",void 0);function L1e(e){e.include(Lu),e.uniforms.add([new Bt("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new mi("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class lWe{constructor(){this.enabled=!1}}function Nu(e,t){t.hasMultipassTerrain&&(e.fragment.include(Lu),e.fragment.uniforms.add(new Bt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new mi("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new mi("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class cWe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function uWe(e,t){const i=e.fragment.uniforms;i.add(new mi("nearFar",(r,s)=>s.camera.nearFar)),i.add(new Bt("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new xr("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new xr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new Xe("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new Bt("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new xr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(Lu),e.fragment.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class hWe{constructor(){this.reprojectionMatrix=Ee()}}var Te;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Te||(Te={}));class fZ{constructor(t=R()){this.intensity=t}}class N1e{constructor(t=R(),i=Ue(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class lH{constructor(t=R(),i=Ue(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class F1e{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function dWe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function Y6(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function XS(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function U1e(e){return(e+1)*(e+1)}function pWe(e){return Ne(Math.floor(Math.sqrt(e)-1),0,2)}function k1e(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=U1e(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function fWe(e,t){const i=U1e(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function mWe(e,t){const i=pWe(t.r.length);for(const r of e)oa(cH,r.direction),k1e(cH,i,wg),dWe(wg,HL),Y6(wg,r.intensity[0],xx),XS(t.r,xx),Y6(wg,r.intensity[1],xx),XS(t.g,xx),Y6(wg,r.intensity[2],xx),XS(t.b,xx);return t}function gWe(e,t){k1e(cH,0,wg);for(const i of e)t.r[0]+=wg[0]*HL[0]*i.intensity[0]*4*Math.PI,t.g[0]+=wg[0]*HL[0]*i.intensity[1]*4*Math.PI,t.b[0]+=wg[0]*HL[0]*i.intensity[2]*4*Math.PI;return t}function yWe(e,t,i,r){fWe(t,r),ie(i.intensity,0,0,0);let s=!1;const n=vWe,o=_We,a=bWe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof lH&&!s?(ne(i.direction,l.direction),ne(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof lH||l instanceof N1e?n.push(l):l instanceof fZ?o.push(l):l instanceof F1e&&a.push(l);mWe(n,r),gWe(o,r);for(const l of a)XS(r.r,l.r),XS(r.g,l.g),XS(r.b,l.b)}const vWe=[],_We=[],bWe=[],wg=[0],xx=[0],cH=R(),HL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],BE=.4;class wWe{constructor(){this._shOrder=2,this._oldSunlight={direction:R(),ambient:{color:R(),intensity:1},diffuse:{color:R(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new F1e,this._mainLight={intensity:R(),direction:Ue(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){yWe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ne(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,oe(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),ne(TI,this._oldSunlight.diffuse.color),oe(TI,TI,BE*this.globalFactor),pe(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,TI)}get old(){return this._oldSunlight}}const TI=R();class OU{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Te.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=st(),this.lighting=new wWe,this.ssr=new hWe,this.multipassTerrain=new cWe,this.multipassGeometry=new lWe,this.clouds=new cqe,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let xa=class extends Ae{constructor(e){super(e),this._frameTask=null,this._handles=new si,this._cubeMapSize=he("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new P1e,this._bindParameters=new OU(null,null,null),this._drawParameters=new I1e,this._weatherTile=La(0,0),this._weatherTileCount=128,this.coverage=Zt(Wa.coverage[0],Wa.coverage[1],.5),this.density=Zt(Wa.density[0],Wa.density[1],.5),this.absorption=Zt(Wa.absorption[0],Wa.absorption[1],.5),this.cloudSize=Zt(Wa.cloudSize[0],Wa.cloudSize[1],.5),this.detailSize=Zt(Wa.detailSize[0],Wa.detailSize[1],.5),this.smoothness=Zt(Wa.smoothness[0],Wa.smoothness[1],.5),this.cloudHeight=Zt(Wa.cloudHeight[0],Wa.cloudHeight[1],.5),this.raymarchingStepType=Wa.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ee(),this._cameraPositionLastFrame=R(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new MU({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=La((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=La(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=qa(this.context.renderContext.rctx);const e=Ai(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(ae(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Ft))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Hi(e)),this._techniques=null,this._frameBufferCube=Je(this._frameBufferCube),this._vao=Je(this._vao),this._noiseTexture=at(this._noiseTexture)}_ensureNoiseTexture(){if(M(this._noiseTexture)){const e=this.context;this._noiseTexture=new D1e({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(M(this._frameBufferCube)){const e={target:ft.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Cr(this.context.renderContext.rctx,{colorTarget:is.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===Zn.FADE_OUT||e.fadeInOutHeight.stage!==Iv.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=Zt(s[0],s[1],i);return t<.5?Zt(s[0],n,2*t):Zt(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||M(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!hw(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void ne(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(M(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=Zt(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",Zt(0,.3,this.density)),s.setUniform1f("cloudSize",Zt(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",Zt(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",Zt(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",Zt(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=xWe[l],h=TWe[l];Pme(this._viewMatrix,SWe,c,h),Sc(this._drawParameters.viewMatrix,this._viewMatrix);const p=ft.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],xa.prototype,"context",void 0),u([d({constructOnly:!0})],xa.prototype,"view",void 0),u([d({constructOnly:!0})],xa.prototype,"requestRender",void 0),u([d()],xa.prototype,"_frameTask",void 0),u([d()],xa.prototype,"coverage",void 0),u([d()],xa.prototype,"density",void 0),u([d()],xa.prototype,"absorption",void 0),u([d()],xa.prototype,"cloudSize",void 0),u([d()],xa.prototype,"detailSize",void 0),u([d()],xa.prototype,"smoothness",void 0),u([d()],xa.prototype,"cloudHeight",void 0),u([d()],xa.prototype,"raymarchingStepType",void 0),u([d()],xa.prototype,"running",void 0),xa=u([P("esri.views.3d.environment.CloudsGenerator")],xa);const xWe=[Li(1,0,0),Li(-1,0,0),Li(0,1,0),Li(0,-1,0),Li(0,0,1)],TWe=[Li(0,1,0),Li(0,1,0),Li(0,0,-1),Li(0,0,1),Li(0,1,0)],SWe=eZ(),Wa=$1e.sunny;function EWe(e){const t=new Xi;t.attributes.add(O.POSITION,"vec2"),t.include(Dg,{textureCoordinateType:tn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new xr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new xr("inverseViewMatrix",(s,n)=>Xr(CWe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ui("atmosphereC")),r.uniforms.add(new bl("cameraPosition")),r.uniforms.add(new mi("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new kr("depthTex")),r.uniforms.add(new Ui("fogStrength")),r.uniforms.add(new Ui("fogAmount")),r.uniforms.add(new bl("fogColor")),t.include(wU),r.include(Lu),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const CWe=Ee(),AWe=Object.freeze(Object.defineProperty({__proto__:null,build:EWe},Symbol.toStringTag,{value:"Module"}));class pR extends dr{initializeProgram(t){const i=pR.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return this.configuration.haze?zt({blending:uo(Oe.ONE,Oe.ZERO,Oe.ONE_MINUS_SRC_COLOR,Oe.ONE),colorWrite:ri}):zt({blending:uo(Oe.SRC_ALPHA,Oe.ZERO,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE),colorWrite:ri})}}pR.shader=new rr(AWe,()=>import("./Fog.glsl.627fdf90.js"));class uH extends Ha{constructor(){super(...arguments),this.haze=!1}}u([j()],uH.prototype,"haze",void 0);let fM=class extends Ae{constructor(e){super(e),this._fogColor=Ri(),this._fogColorAtNight=Ri(),this._cameraDirection=Ri(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=qa(t,I3);const i=Ai(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+VL}destroy(){this._hazeFogTechnique=Hi(this._hazeFogTechnique),this._thickFogTechnique=Hi(this._thickFogTechnique),this._vao=Je(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(M(this._thickFogTechnique)){const e=new uH;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(pR,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(M(this._hazeFogTechnique)){const e=new uH;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(pR,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,MWe,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(M(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays($t.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?ie(this._fogColor,.5,.5,.5):t?ie(this._fogColor,1.5,1.5,1.5):ie(this._fogColor,.24,.44,.8),oe(this._fogColorAtNight,this._fogColor,s),we(this._cameraDirection,r.eye);const n=Math.max(0,Se(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));on(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Re(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-y2(this._foggyFadeStart*wh,this._foggyFadeEnd*wh,Math.abs(o-this._planetRadius)):1-y2(this._hazeFadeStart*wh,this._hazeFadeEnd*wh,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],fM.prototype,"context",void 0),u([d({constructOnly:!0})],fM.prototype,"view",void 0),fM=u([P("esri.views.3d.environment.Fog")],fM);const MWe=new Bs;async function yp(e,t){const{data:i}=await _i(e,F({responseType:"image"},t));return i}var Yf;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(Yf||(Yf={}));class YF extends Ha{constructor(){super(...arguments),this.geometry=Yf.Cone}}u([j({count:Yf.COUNT})],YF.prototype,"geometry",void 0);function Io(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Kv extends Qr{constructor(t){super(t,"mat4")}}class mZ extends Bs{}function OWe(e){const t=new Xi,{vertex:i,fragment:r}=t;if(e.geometry===Yf.Underground)t.attributes.add(O.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new bl("cameraPosition"),new Ui("undergroundFadeAlpha")]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{t.include(Io),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===Yf.Cylinder;i.uniforms.add([new xr("proj",(a,l)=>l.camera.projectionMatrix),new Kv("view"),new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new bl("silCircleCenter")),i.uniforms.add(new bl("silCircleV1")),i.uniforms.add(new bl("silCircleV2")),i.uniforms.add(new Lg("texV")),i.uniforms.add(new Ui("innerScale")));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Bt("tex",a=>a.texture)),s||r.uniforms.add(new Ui("altitudeFade")),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const RWe=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:mZ,build:OWe},Symbol.toStringTag,{value:"Module"}));class B2 extends dr{initializeProgram(t){const i=B2.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return this.configuration.geometry===Yf.Cylinder?zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),culling:XY,depthTest:{func:fr.LEQUAL},colorWrite:ri}):zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}B2.shader=new rr(RWe,()=>import("./SimpleAtmosphere.glsl.09383cee.js"));const z1e="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Oc(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=PWe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new ao(r,n,o,a,i,l,t)})}function PWe(e){const t=IWe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const IWe={u8:dt.UNSIGNED_BYTE,u16:dt.UNSIGNED_SHORT,u32:dt.UNSIGNED_INT,i8:dt.BYTE,i16:dt.SHORT,i32:dt.INT,f32:dt.FLOAT};class gZ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}gZ.ElementCount=9;class yZ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}yZ.ElementCount=16;class hy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}hy.ElementCount=1;class dy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,fi(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}dy.ElementCount=2;class py{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,ie(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}py.ElementCount=3;class fy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Ji(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}fy.ElementCount=4;class D3 extends hy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new D3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}D3.ElementType="f32";class qh extends dy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(qh,t,i)}static fromTypedArray(t,i){return new qh(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qh.ElementType="f32";class bi extends py{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(bi,t,i)}static fromTypedArray(t,i){return new bi(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bi.ElementType="f32";class Un extends fy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Un,t,i)}static fromTypedArray(t,i){return new Un(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Un.ElementType="f32";class vp extends gZ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(vp,t,i)}static fromTypedArray(t,i){return new vp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}vp.ElementType="f32";class e_ extends gZ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(e_,t,i)}static fromTypedArray(t,i){return new e_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}e_.ElementType="f64";class G2 extends yZ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(G2,t,i)}static fromTypedArray(t,i){return new G2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}G2.ElementType="f32";class t_ extends yZ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(t_,t,i)}static fromTypedArray(t,i){return new t_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}t_.ElementType="f64";class j2 extends hy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(j2,t,i)}static fromTypedArray(t,i){return new j2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}j2.ElementType="f64";class H2 extends dy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(H2,t,i)}static fromTypedArray(t,i){return new H2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}H2.ElementType="f64";class Mr extends py{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Mr,t,i)}static fromTypedArray(t,i){return new Mr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Mr.ElementType="f64";class Rw extends fy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Rw,t,i)}static fromTypedArray(t,i){return new Rw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Rw.ElementType="f64";class ty extends hy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(ty,t,i)}static fromTypedArray(t,i){return new ty(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ty.ElementType="u8";class Pw extends dy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Pw,t,i)}static fromTypedArray(t,i){return new Pw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Pw.ElementType="u8";class i_ extends py{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(i_,t,i)}static fromTypedArray(t,i){return new i_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}i_.ElementType="u8";class Ll extends fy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Ll,t,i)}static fromTypedArray(t,i){return new Ll(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ll.ElementType="u8";class Iw extends hy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Iw,t,i)}static fromTypedArray(t,i){return new Iw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Iw.ElementType="u16";class q2 extends dy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(q2,t,i)}static fromTypedArray(t,i){return new q2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}q2.ElementType="u16";class $w extends py{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer($w,t,i)}static fromTypedArray(t,i){return new $w(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$w.ElementType="u16";class r_ extends fy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(r_,t,i)}static fromTypedArray(t,i){return new r_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}r_.ElementType="u16";class Dw extends hy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(Dw,t,i)}static fromTypedArray(t,i){return new Dw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Dw.ElementType="u32";class W2 extends dy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(W2,t,i)}static fromTypedArray(t,i){return new W2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}W2.ElementType="u32";class fR extends py{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(fR,t,i)}static fromTypedArray(t,i){return new fR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fR.ElementType="u32";class mR extends fy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(mR,t,i)}static fromTypedArray(t,i){return new mR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}mR.ElementType="u32";class X2 extends hy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(X2,t,i)}static fromTypedArray(t,i){return new X2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}X2.ElementType="i8";class Lw extends dy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(Lw,t,i)}static fromTypedArray(t,i){return new Lw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Lw.ElementType="i8";class gR extends py{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(gR,t,i)}static fromTypedArray(t,i){return new gR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gR.ElementType="i8";class yR extends fy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(yR,t,i)}static fromTypedArray(t,i){return new yR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yR.ElementType="i8";class vR extends hy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(vR,t,i)}static fromTypedArray(t,i){return new vR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}vR.ElementType="i16";class Nw extends dy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(Nw,t,i)}static fromTypedArray(t,i){return new Nw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Nw.ElementType="i16";class _R extends py{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(_R,t,i)}static fromTypedArray(t,i){return new _R(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_R.ElementType="i16";class bR extends fy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(bR,t,i)}static fromTypedArray(t,i){return new bR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bR.ElementType="i16";class wR extends hy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(wR,t,i)}static fromTypedArray(t,i){return new wR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}wR.ElementType="i32";class xR extends dy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(xR,t,i)}static fromTypedArray(t,i){return new xR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}xR.ElementType="i32";class TR extends py{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(TR,t,i)}static fromTypedArray(t,i){return new TR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}TR.ElementType="i32";class SR extends fy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(SR,t,i)}static fromTypedArray(t,i){return new SR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}SR.ElementType="i32";function V1e(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function $We(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function DWe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function LWe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class ZF{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new ZF(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class vZ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,qh,i),this}vec2f64(t,i){return this._appendField(t,H2,i),this}vec3f(t,i){return this._appendField(t,bi,i),this}vec3f64(t,i){return this._appendField(t,Mr,i),this}vec4f(t,i){return this._appendField(t,Un,i),this}vec4f64(t,i){return this._appendField(t,Rw,i),this}mat3f(t,i){return this._appendField(t,vp,i),this}mat3f64(t,i){return this._appendField(t,e_,i),this}mat4f(t,i){return this._appendField(t,G2,i),this}mat4f64(t,i){return this._appendField(t,t_,i),this}vec4u8(t,i){return this._appendField(t,Ll,i),this}f32(t,i){return this._appendField(t,D3,i),this}f64(t,i){return this._appendField(t,j2,i),this}u8(t,i){return this._appendField(t,ty,i),this}u16(t,i){return this._appendField(t,Iw,i),this}i8(t,i){return this._appendField(t,X2,i),this}vec2i8(t,i){return this._appendField(t,Lw,i),this}vec2i16(t,i){return this._appendField(t,Nw,i),this}vec2u8(t,i){return this._appendField(t,Pw,i),this}vec4u16(t,i){return this._appendField(t,r_,i),this}u32(t,i){return this._appendField(t,Dw,i),this}_appendField(t,i,r){const s=i.ElementCount*V1e(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new ZF(this,t)}createView(t){return new ZF(this,t)}clone(){const t=new vZ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function ns(){return new vZ}var hH;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(hH||(hH={}));const pa=qt();class NWe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function pt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new NWe(t)}function Tx(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Kre(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function SI(e,t,i,r,s,n=st()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function ese(e,t,i,r,s){s||(s=e),pa[0]=e[0],pa[1]=e[1],pa[2]=e[2],pa[3]=1,bu(pa,pa,t),s.length>2&&(s[2]=-pa[2]),bu(pa,pa,i),pt(pa[3]!==0),s[0]=pa[0]/pa[3],s[1]=pa[1]/pa[3],s[2]=pa[2]/pa[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function FWe(e,t){return Math.log(e)/Math.log(t)}function B1e(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function G1e(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function UWe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function kWe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function zWe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function VWe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class RU{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=R(),pt(t.length>=1),pt(r.length%this._numIndexPerPrimitive==0),pt(r.length>=t.length*this._numIndexPerPrimitive),pt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];L_.clear(),L_.push(l),this.bbMin=Ue(n[l],n[l+1],n[l+2]),this.bbMax=rs(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],L_.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}on(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<L_.length;++h){l=L_.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],y=p*p+f*f+m*m;if(y<=c)continue;const v=Math.sqrt(y),b=.5*(v-this.radius);this.radius=this.radius+b,c=this.radius*this.radius;const w=b/v;this.center[0]+=p*w,this.center[1]+=f*w,this.center[2]+=m*w}L_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(_n(this.bbMin,this.bbMax)>1){const t=on(R(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],v=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=n[f],S=n[f+1],T=n[f+2];w<m&&(m=w),S<y&&(y=S),T<v&&(v=T)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),v<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new RU(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){L_.prune()}}const L_=new It({deallocator:null});class L3{constructor(){this.id=wl()}unload(){}}var _p;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(_p||(_p={}));function tse(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function BWe(e,t,i){return fe(Z6,t,e),fe(ise,i,e),Re(lt(Z6,Z6,ise))/2}new ay(nm);new ay(()=>({p0:null,p1:null,p2:null}));const Z6=R(),ise=R();let j0=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const j1e=new Uint16Array([0]),QF=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function Y2(e){if(e===1)return j1e;if(e<QF.length)return new Uint16Array(QF.buffer,0,e);if(e>j0.length){const t=Math.max(2*j0.length,e);j0=new Uint32Array(t);for(let i=0;i<j0.length;i++)j0[i]=i}return new Uint32Array(j0.buffer,0,e)}function mTt(e){if(e===1)return new Uint16Array(j1e);if(e<QF.length)return new Uint16Array(QF.slice(0,e));if(e>j0.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(j0.slice(0,e))}function H1e(e,t,i){if(!e)return!1;const{size:r,data:s}=e;ie(i,0,0,0),ie(vh,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;ie(Pn,s[l+0],s[l+1],s[l+2]),ie(xg,s[c+0],s[c+1],s[c+2]),ie(EI,s[h+0],s[h+1],s[h+2]);const p=BWe(Pn,xg,EI);p?(pe(Pn,Pn,xg),pe(Pn,Pn,EI),oe(Pn,Pn,1/3*p),pe(i,i,Pn),n+=p):(pe(vh,vh,Pn),pe(vh,vh,xg),pe(vh,vh,EI),o+=3)}return(o!==0||n!==0)&&(n!==0?(oe(i,i,1/n),!0):o!==0&&(oe(i,vh,1/o),!0))}function q1e(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;ie(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&oe(i,i,1/o),o>0}function _Z(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;ie(r,0,0,0),ie(vh,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,y=(t?t[f]:f)*s;Pn[0]=n[m+0],Pn[1]=n[m+1],Pn[2]=n[m+2],xg[0]=n[y+0],xg[1]=n[y+1],xg[2]=n[y+2],oe(Pn,pe(Pn,Pn,xg),.5);const v=yW(Pn,xg);v>0?(pe(r,r,oe(Pn,Pn,v)),o+=v):(pe(vh,vh,Pn),a++)}return o!==0?(oe(r,r,1/o),!0):a!==0&&(oe(r,vh,1/a),!0)}const Pn=R(),xg=R(),EI=R(),vh=R();class Nr extends L3{constructor(t,i=[],r=El.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=_p.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,F({},o));if(i==null||i.length===0){const n=GWe(this._vertexAttributes),o=Y2(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,jWe(o)),n===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new Nr([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return M(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===El.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return H1e(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return q1e(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(O.POSITION);if(t.length===0)return null;const i=this.primitiveType===El.Triangle?3:1;pt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=Y2(t.length/i),s=this.vertexAttributes.get(O.POSITION);return new RU(r,i,t,s)}}function GWe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function jWe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Sx=hH;var Q6,J6,K6,dH;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new Nr([[O.POSITION,{size:3,data:h,exclusive:!0}],[O.NORMAL,{size:3,data:r}],[O.UV0,{size:2,data:s}]],[[O.POSITION,n],[O.NORMAL,o],[O.UV0,a]])}e.createGeometry=l})(Q6||(Q6={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new Nr([[O.POSITION,{size:3,data:l,exclusive:!0}],[O.NORMAL,{size:3,data:r}]],[[O.POSITION,s],[O.NORMAL,n]])}e.createGeometry=o}(J6||(J6={})),function(e){const r=Li(-.5,0,-.5),s=Li(.5,0,-.5),n=Li(0,0,.5),o=Li(0,0+.5,0),a=Ri(),l=Ri(),c=Ri(),h=Ri(),p=Ri();fe(a,r,o),fe(l,r,s),lt(c,a,l),we(c,c),fe(a,s,o),fe(l,s,n),lt(h,a,l),we(h,h),fe(a,n,o),fe(l,n,r),lt(p,a,l),we(p,p);const f=[r,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function b(w){Array.isArray(w)||(w=[w,w,w]);const S=new Array(12);for(let T=0;T<4;T++)S[3*T]=f[T][0]*w[0],S[3*T+1]=f[T][1]*w[1],S[3*T+2]=f[T][2]*w[2];return new Nr([[O.POSITION,{size:3,data:S,exclusive:!0}],[O.NORMAL,{size:3,data:m}]],[[O.POSITION,new Uint16Array(y)],[O.NORMAL,new Uint16Array(v)]])}e.createGeometry=b}(K6||(K6={})),function(e){function t(T,E,C,A={uv:!0}){const I=-Math.PI,L=2*Math.PI,D=-Math.PI/2,k=Math.PI,z=Math.max(3,Math.floor(E)),V=Math.max(2,Math.floor(C)),X=(z+1)*(V+1),Y=new Float32Array(3*X),le=new Float32Array(3*X),re=new Float32Array(2*X),$=[];let U=0;for(let Q=0;Q<=V;Q++){const G=[],ee=Q/V,me=D+ee*k,_e=Math.cos(me);for(let Me=0;Me<=z;Me++){const ve=Me/z,ge=I+ve*L,Ce=Math.cos(ge)*_e,$e=Math.sin(me),gi=-Math.sin(ge)*_e;Y[3*U]=Ce*T,Y[3*U+1]=$e*T,Y[3*U+2]=gi*T,le[3*U]=Ce,le[3*U+1]=$e,le[3*U+2]=gi,re[2*U]=ve,re[2*U+1]=ee,G.push(U),++U}$.push(G)}const B=new Uint32Array(2*z*(V-1)*3);U=0;for(let Q=0;Q<V;Q++)for(let G=0;G<z;G++){const ee=$[Q][G],me=$[Q][G+1],_e=$[Q+1][G+1],Me=$[Q+1][G];Q===0?(B[U++]=ee,B[U++]=_e,B[U++]=Me):Q===V-1?(B[U++]=ee,B[U++]=me,B[U++]=_e):(B[U++]=ee,B[U++]=me,B[U++]=_e,B[U++]=_e,B[U++]=Me,B[U++]=ee)}const H=[[O.POSITION,B],[O.NORMAL,B]],W=[[O.POSITION,{size:3,data:Y,exclusive:!0}],[O.NORMAL,{size:3,data:le,exclusive:!0}]];return A.uv&&(W.push([O.UV0,{size:2,data:re,exclusive:!0}]),H.push([O.UV0,B])),A.offset&&(H[0][0]=O.OFFSET,W[0][0]=O.OFFSET,H.push([O.POSITION,new Uint32Array(B.length)]),W.push([O.POSITION,{size:3,data:Float64Array.from(A.offset),exclusive:!0}])),new Nr(W,H)}function i(T,E,C){const A=T;let I,L;if(C)I=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],L=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Y=A*(1+Math.sqrt(5))/2;I=[-A,Y,0,A,Y,0,-A,-Y,0,A,-Y,0,0,-A,Y,0,A,Y,0,-A,-Y,0,A,-Y,Y,0,-A,Y,0,A,-Y,0,-A,-Y,0,A],L=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Y=0;Y<I.length;Y+=3)Sx.scale(I,Y,T/Sx.length(I,Y));let D={};function k(Y,le){Y>le&&([Y,le]=[le,Y]);const re=Y.toString()+"."+le.toString();if(D[re])return D[re];let $=I.length;return I.length+=3,Sx.add(I,3*Y,I,3*le,I,$),Sx.scale(I,$,T/Sx.length(I,$)),$/=3,D[re]=$,$}for(let Y=0;Y<E;Y++){const le=L.length,re=new Uint32Array(4*le);for(let $=0;$<le;$+=3){const U=L[$],B=L[$+1],H=L[$+2],W=k(U,B),Q=k(B,H),G=k(H,U),ee=4*$;re[ee]=U,re[ee+1]=W,re[ee+2]=G,re[ee+3]=B,re[ee+4]=Q,re[ee+5]=W,re[ee+6]=H,re[ee+7]=G,re[ee+8]=Q,re[ee+9]=W,re[ee+10]=Q,re[ee+11]=G}L=re,D={}}const z=new Float32Array(I);for(let Y=0;Y<z.length;Y+=3)Sx.normalize(z,Y);const V=[[O.POSITION,L],[O.NORMAL,L]],X=[[O.POSITION,{size:3,data:new Float32Array(I),exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}]];return new Nr(X,V)}function r(T,E,C,A,I,L,D){const k=E?[E[0],E[1],E[2]]:[0,0,0],z=T?[T[0],T[1],T[2]]:[0,0,1];L=L||[0,0];const V=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],X=A!=null&&A.length===2?A:[1,1],Y=[[O.POSITION,{size:3,data:k,exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}],[O.UV0,{size:L.length,data:L}],[O.COLOR,{size:4,data:V,exclusive:!0}],[O.SIZE,{size:2,data:X}]];if(I!=null){const le=new Float32Array([I[0],I[1],I[2],I[3]]);Y.push([O.AUXPOS1,{size:4,data:le}])}if(D!=null){const le=new Float32Array([D[0],D[1],D[2],D[3]]);Y.push([O.AUXPOS2,{size:4,data:le}])}return new Nr(Y,null,El.Point)}function s(T,E,C,A,I,L,D,k){if(T!=null){const{data:z}=k.getMutableAttribute(O.NORMAL);z[0]=T[0],z[1]=T[1],z[2]=T[2]}if(E!=null){const{data:z}=k.getMutableAttribute(O.POSITION);z[0]=E[0],z[1]=E[1],z[2]=E[2]}if(C!=null){const{data:z}=k.getMutableAttribute(O.COLOR);z[0]=C[0],z[1]=C[1],z[2]=C[2],z[3]=C[3]}if(A!=null){const{data:z}=k.getMutableAttribute(O.SIZE);z[0]=A[0],z[1]=A[1]}if(I!=null){const{data:z}=k.getMutableAttribute(O.AUXPOS1);z[0]=I[0],z[1]=I[1],z[2]=I[2],z[3]=I[3]}if(L!=null){const{data:z}=k.getMutableAttribute(O.UV0);z[0]=L[0],z[1]=L[1]}if(D!=null){const{data:z}=k.getMutableAttribute(O.AUXPOS2);z[0]=D[0],z[1]=D[1],z[2]=D[2],z[3]=D[3]}}function n(T,E){const C=new Float32Array(3*T.length),A=new Float32Array(E?3*T.length:3),I=new Uint32Array(T.length),L=new Uint32Array(T.length);for(let V=0;V<T.length;V++)C[3*V]=T[V][0],C[3*V+1]=T[V][1],C[3*V+2]=T[V][2],E&&(A[3*V]=E[V][0],A[3*V+1]=E[V][1],A[3*V+2]=E[V][2]),I[V]=V,L[V]=0;E||(A[0]=0,A[1]=1,A[2]=0);const D=[0,0],k=[[O.POSITION,I],[O.NORMAL,E?I:L],[O.UV0,L]],z=[[O.POSITION,{size:3,data:C,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:D,exclusive:!0}]];return new Nr(z,k,El.Point)}function o(){const T=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],A=new Uint16Array([0,0,0]),I=[0,0],L=new Uint16Array([0,0,0]),D=[[O.POSITION,E],[O.NORMAL,A],[O.UV0,L]],k=[[O.POSITION,{size:3,data:T,exclusive:!0}],[O.NORMAL,{size:3,data:C,exclusive:!0}],[O.UV0,{size:2,data:I,exclusive:!0}]];return new Nr(k,D)}e.createBoxGeometry=Q6.createGeometry,e.createDiamondGeometry=J6.createGeometry,e.createTetrahedronGeometry=K6.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=a){const E=new Array(12);for(let V=0;V<4;V++)for(let X=0;X<3;X++)E[3*V+X]=T[V][X];const C=new Uint32Array([0,1,2,2,3,0]),A=[0,0,1],I=new Uint32Array([0,0,0,0,0,0]),L=[0,0,1,0,1,1,0,1],D=[255,255,255,255],k=[[O.POSITION,C],[O.NORMAL,I],[O.UV0,C],[O.COLOR,I]],z=[[O.POSITION,{size:3,data:E,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:L,exclusive:!0}],[O.COLOR,{size:4,data:D,exclusive:!0}]];return new Nr(z,k)}function c(T,E,C,A,I=!0,L=!0){let D=0;const k=E,z=T;let V=Li(0,D,0),X=Li(0,D+z,0),Y=Li(0,-1,0),le=Li(0,1,0);A&&(D=z,X=Li(0,0,0),V=Li(0,D,0),Y=Li(0,1,0),le=Li(0,-1,0));const re=[X,V],$=[Y,le],U=C+2,B=Math.sqrt(z*z+k*k);if(A)for(let ve=C-1;ve>=0;ve--){const ge=ve*(2*Math.PI/C),Ce=Li(Math.cos(ge)*k,D,Math.sin(ge)*k);re.push(Ce);const $e=Li(z*Math.cos(ge)/B,-k/B,z*Math.sin(ge)/B);$.push($e)}else for(let ve=0;ve<C;ve++){const ge=ve*(2*Math.PI/C),Ce=Li(Math.cos(ge)*k,D,Math.sin(ge)*k);re.push(Ce);const $e=Li(z*Math.cos(ge)/B,k/B,z*Math.sin(ge)/B);$.push($e)}const H=new Uint32Array(2*(C+2)*3),W=new Uint32Array(2*(C+2)*3);let Q=0,G=0;if(I){for(let ve=3;ve<re.length;ve++)H[Q++]=1,H[Q++]=ve-1,H[Q++]=ve,W[G++]=0,W[G++]=0,W[G++]=0;H[Q++]=re.length-1,H[Q++]=2,H[Q++]=1,W[G++]=0,W[G++]=0,W[G++]=0}if(L){for(let ve=3;ve<re.length;ve++)H[Q++]=ve,H[Q++]=ve-1,H[Q++]=0,W[G++]=ve,W[G++]=ve-1,W[G++]=1;H[Q++]=0,H[Q++]=2,H[Q++]=re.length-1,W[G++]=1,W[G++]=2,W[G++]=$.length-1}const ee=new Float32Array(3*U);for(let ve=0;ve<U;ve++)ee[3*ve]=re[ve][0],ee[3*ve+1]=re[ve][1],ee[3*ve+2]=re[ve][2];const me=new Float32Array(3*U);for(let ve=0;ve<U;ve++)me[3*ve]=$[ve][0],me[3*ve+1]=$[ve][1],me[3*ve+2]=$[ve][2];const _e=[[O.POSITION,H],[O.NORMAL,W]],Me=[[O.POSITION,{size:3,data:ee,exclusive:!0}],[O.NORMAL,{size:3,data:me,exclusive:!0}]];return new Nr(Me,_e)}function h(T,E,C,A,I,L){const D=A?WF(A):Li(1,0,0),k=I?WF(I):Li(0,0,0);L=L==null||L;const z=Ri();we(z,D);const V=Ri();oe(V,z,Math.abs(T));const X=Ri();oe(X,V,-.5),pe(X,X,k);const Y=Li(0,1,0);Math.abs(1-Se(z,Y))<.2&&ie(Y,0,0,1);const le=Ri();lt(le,z,Y),we(le,le),lt(Y,le,z);const re=2*C+(L?2:0),$=C+(L?2:0),U=new Float32Array(3*re),B=new Float32Array(3*$),H=new Float32Array(2*re),W=new Uint32Array(3*C*(L?4:2)),Q=new Uint32Array(3*C*(L?4:2));L&&(U[3*(re-2)+0]=X[0],U[3*(re-2)+1]=X[1],U[3*(re-2)+2]=X[2],H[2*(re-2)]=0,H[2*(re-2)+1]=0,U[3*(re-1)+0]=U[3*(re-2)+0]+V[0],U[3*(re-1)+1]=U[3*(re-2)+1]+V[1],U[3*(re-1)+2]=U[3*(re-2)+2]+V[2],H[2*(re-1)]=1,H[2*(re-1)+1]=1,B[3*($-2)+0]=-z[0],B[3*($-2)+1]=-z[1],B[3*($-2)+2]=-z[2],B[3*($-1)+0]=z[0],B[3*($-1)+1]=z[1],B[3*($-1)+2]=z[2]);const G=(ge,Ce,$e)=>{W[ge]=Ce,Q[ge]=$e};let ee=0;const me=Ri(),_e=Ri();for(let ge=0;ge<C;ge++){const Ce=ge*(2*Math.PI/C);oe(me,Y,Math.sin(Ce)),oe(_e,le,Math.cos(Ce)),pe(me,me,_e),B[3*ge+0]=me[0],B[3*ge+1]=me[1],B[3*ge+2]=me[2],oe(me,me,E),pe(me,me,X),U[3*ge+0]=me[0],U[3*ge+1]=me[1],U[3*ge+2]=me[2],H[2*ge+0]=ge/C,H[2*ge+1]=0,U[3*(ge+C)+0]=U[3*ge+0]+V[0],U[3*(ge+C)+1]=U[3*ge+1]+V[1],U[3*(ge+C)+2]=U[3*ge+2]+V[2],H[2*(ge+C)+0]=ge/C,H[2*ge+1]=1;const $e=(ge+1)%C;G(ee++,ge,ge),G(ee++,ge+C,ge),G(ee++,$e,$e),G(ee++,$e,$e),G(ee++,ge+C,ge),G(ee++,$e+C,$e)}if(L){for(let ge=0;ge<C;ge++){const Ce=(ge+1)%C;G(ee++,re-2,$-2),G(ee++,ge,$-2),G(ee++,Ce,$-2)}for(let ge=0;ge<C;ge++){const Ce=(ge+1)%C;G(ee++,ge+C,$-1),G(ee++,re-1,$-1),G(ee++,Ce+C,$-1)}}const Me=[[O.POSITION,W],[O.NORMAL,Q],[O.UV0,W]],ve=[[O.POSITION,{size:3,data:U,exclusive:!0}],[O.NORMAL,{size:3,data:B,exclusive:!0}],[O.UV0,{size:2,data:H,exclusive:!0}]];return new Nr(ve,Me)}function p(T,E,C,A,I){C=C||10,A=A==null||A,pt(T.length>1);const L=[[0,0,0]],D=[],k=[];for(let z=0;z<C;z++){D.push([0,-z-1,-(z+1)%C-1]);const V=z/C*2*Math.PI;k.push([Math.cos(V)*E,Math.sin(V)*E])}return e.createPathExtrusionGeometry(k,T,L,D,A,I)}function f(T,E,C,A,I,L=Li(0,0,0)){const D=T.length,k=new Float32Array(E.length*D*3+(6*C.length||0)),z=new Float32Array(E.length*D*3+(C?6:0)),V=(E.length-1)*D*6+3*A.length*2,X=new Uint32Array(V),Y=new Uint32Array(V);let le=0,re=0,$=0,U=0;const B=Ri(),H=Ri(),W=Ri(),Q=Ri(),G=Ri(),ee=Ri(),me=Ri(),_e=R(),Me=Ri(),ve=Ri(),ge=Ri(),Ce=Ri(),$e=Ri(),gi=Ei();ie(Me,0,1,0),fe(H,E[1],E[0]),we(H,H),I?(pe(_e,E[0],L),we(W,_e)):ie(W,0,0,1),S(H,W,Me,Me,G,W,rse),ne(Q,W),ne(Ce,G);for(let Qe=0;Qe<C.length;Qe++)oe(ee,G,C[Qe][0]),oe(_e,W,C[Qe][2]),pe(ee,ee,_e),pe(ee,ee,E[0]),k[le++]=ee[0],k[le++]=ee[1],k[le++]=ee[2];z[re++]=-H[0],z[re++]=-H[1],z[re++]=-H[2];for(let Qe=0;Qe<A.length;Qe++)X[$++]=A[Qe][0]>0?A[Qe][0]:-A[Qe][0]-1+C.length,X[$++]=A[Qe][1]>0?A[Qe][1]:-A[Qe][1]-1+C.length,X[$++]=A[Qe][2]>0?A[Qe][2]:-A[Qe][2]-1+C.length,Y[U++]=0,Y[U++]=0,Y[U++]=0;let wi=C.length;const Ht=C.length-1;for(let Qe=0;Qe<E.length;Qe++){let Gi=!1;Qe>0&&(ne(B,H),Qe<E.length-1?(fe(H,E[Qe+1],E[Qe]),we(H,H)):Gi=!0,pe(ve,B,H),we(ve,ve),pe(ge,E[Qe-1],Q),R2(E[Qe],ve,gi),sx(gi,Du(ge,B),_e)?(fe(_e,_e,E[Qe]),we(W,_e),lt(G,ve,W),we(G,G)):S(ve,Q,Ce,Me,G,W,rse),ne(Q,W),ne(Ce,G)),I&&(pe(_e,E[Qe],L),we($e,_e));for(let os=0;os<D;os++)if(oe(ee,G,T[os][0]),oe(_e,W,T[os][1]),pe(ee,ee,_e),we(me,ee),z[re++]=me[0],z[re++]=me[1],z[re++]=me[2],pe(ee,ee,E[Qe]),k[le++]=ee[0],k[le++]=ee[1],k[le++]=ee[2],!Gi){const ln=(os+1)%D;X[$++]=wi+os,X[$++]=wi+D+os,X[$++]=wi+ln,X[$++]=wi+ln,X[$++]=wi+D+os,X[$++]=wi+D+ln;for(let Gs=0;Gs<6;Gs++)Y[U++]=X[$-6+Gs]-Ht}wi+=D}const xi=E[E.length-1];for(let Qe=0;Qe<C.length;Qe++)oe(ee,G,C[Qe][0]),oe(_e,W,C[Qe][1]),pe(ee,ee,_e),pe(ee,ee,xi),k[le++]=ee[0],k[le++]=ee[1],k[le++]=ee[2];const Yt=re/3;z[re++]=H[0],z[re++]=H[1],z[re++]=H[2];const Ti=wi-D;for(let Qe=0;Qe<A.length;Qe++)X[$++]=A[Qe][0]>=0?wi+A[Qe][0]:-A[Qe][0]-1+Ti,X[$++]=A[Qe][2]>=0?wi+A[Qe][2]:-A[Qe][2]-1+Ti,X[$++]=A[Qe][1]>=0?wi+A[Qe][1]:-A[Qe][1]-1+Ti,Y[U++]=Yt,Y[U++]=Yt,Y[U++]=Yt;const mr=[[O.POSITION,X],[O.NORMAL,Y]],Or=[[O.POSITION,{size:3,data:k,exclusive:!0}],[O.NORMAL,{size:3,data:z,exclusive:!0}]];return new Nr(Or,mr)}function m(T,E,C){pt(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),pt(T[0].length===3,"createPolylineGeometry(): malformed vertex"),pt(E==null||E.length===T.length,"createPolylineGeometry: need same number of points and normals"),pt(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const A=new Float64Array(3*T.length),I=new Uint32Array(2*(T.length-1));let L=0,D=0;for(let V=0;V<T.length;V++){for(let X=0;X<3;X++)A[L++]=T[V][X];V>0&&(I[D++]=V-1,I[D++]=V)}const k=[],z=[];if(k.push([O.POSITION,I]),z.push([O.POSITION,{size:3,data:A,exclusive:!0}]),E){const V=new Float32Array(3*E.length);let X=0;for(let Y=0;Y<T.length;Y++)for(let le=0;le<3;le++)V[X++]=E[Y][le];k.push([O.NORMAL,I]),z.push([O.NORMAL,{size:3,data:V,exclusive:!0}])}return C&&(z.push([O.COLOR,{size:4,data:C}]),k.push([O.COLOR,Y2(C.length/4)])),new Nr(z,k,El.Line)}function y(T,E,C,A,I=0){const L=new Array(18),D=[[-E,I,A/2],[C,I,A/2],[0,T+I,A/2],[-E,I,-A/2],[C,I,-A/2],[0,T+I,-A/2]],k=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let z=0;z<6;z++)L[3*z]=D[z][0],L[3*z+1]=D[z][1],L[3*z+2]=D[z][2];return new Nr([[O.POSITION,{size:3,data:L,exclusive:!0}]],[[O.POSITION,k]])}function v(T,E){const C=T.getMutableAttribute(O.POSITION).data;for(let A=0;A<C.length;A+=3){const I=C[A],L=C[A+1],D=C[A+2];ie(Ex,I,L,D),ke(Ex,Ex,E),C[A]=Ex[0],C[A+1]=Ex[1],C[A+2]=Ex[2]}}function b(T,E=T){const C=T.vertexAttributes,A=C.get(O.POSITION).data,I=C.get(O.NORMAL).data;if(I){const L=E.getMutableAttribute(O.NORMAL).data;for(let D=0;D<I.length;D+=3){const k=I[D+1];L[D+1]=-I[D+2],L[D+2]=k}}if(A){const L=E.getMutableAttribute(O.POSITION).data;for(let D=0;D<A.length;D+=3){const k=A[D+1];L[D+1]=-A[D+2],L[D+2]=k}}return E}function w(T,E,C,A,I){return!(Math.abs(Se(E,T))>I)&&(lt(C,T,E),we(C,C),lt(A,C,T),we(A,A),!0)}function S(T,E,C,A,I,L,D){return w(T,E,I,L,D)||w(T,C,I,L,D)||w(T,A,I,L,D)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=y,e.transformInPlace=v,e.cgToGIS=b,e.makeOrthoBasisDirUp=w,e.makeOrthoBasisDirUpFallback=S}(dH||(dH={}));const rse=.99619469809,Ex=Ri(),nc=dH,HWe=de.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class qWe{constructor(){this.type="panoramic",this._techniqueConfig=new YF,this._passParameters=new mZ,this._readyResolver=hp(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Je(this._passParameters.texture),this._vao=Je(this._vao),this._readyController=zh(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=Yf.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(B2,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Po(this._vao,"geometry"),yp(z1e,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Br(r)||HWe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);WWe(sse,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",sse),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays($t.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=nc.createPolySphereGeometry(1,2,!1),r=i.indices.get(O.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(O.POSITION).data,n=nse.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new zs(t,Vi,{geometry:Oc(nse)},{geometry:ai.createVertex(t,Ci.STATIC_DRAW,n.buffer)})}}function WWe(e,t){ws(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const sse=Ee(),nse=ns().vec3f(O.POSITION);var s_;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(s_||(s_={}));class pH extends Ha{constructor(){super(...arguments),this.type=s_.Rain}}u([j({count:s_.COUNT})],pH.prototype,"type",void 0);function XWe(e){const t=new Xi;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new bl("cameraPosition")),t.vertex.uniforms.add(new bl("offset")),t.vertex.uniforms.add(new Ui("width")),t.vertex.uniforms.add(new xr("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new Kv("view")),t.vertex.uniforms.add(new Ui("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===s_.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new Ui("opacity")),t.fragment.uniforms.add(new bl("particleColor")),t.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===s_.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const YWe=Object.freeze(Object.defineProperty({__proto__:null,build:XWe},Symbol.toStringTag,{value:"Module"}));class ZWe extends Bs{constructor(){super(...arguments),this.time=0,this.radius=1}}class Cg extends dr{initializeProgram(t){const i=Cg.shader.get().build(this.configuration);return new sr(t.rctx,i,Cg.attributeLocation)}initializePipeline(){return zt({blending:uo(Oe.ONE,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}Cg.shader=new rr(YWe,()=>import("./Precipitation.glsl.a4b90118.js")),Cg.attributeLocation=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);class W1e{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let X1=class extends Ae{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=R(),this._tile=R(),this._particleColor=Ri(),this._particleColorAtNight=Ri(),this._nightMultiplier=.7,this._cameraDirection=Ri(),this._renderParameters=new ZWe,this._animation=new W1e,this._updatingTracking=new Df,this._renderParameters.time=0,this._renderParameters.radius=Ai(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=Hi(this._snowTechnique),this._rainTechnique=Hi(this._rainTechnique),this._vao=Je(this._vao),this._instanceIdBuffer=Je(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(M(this._rainTechnique)){const e=new pH;e.type=s_.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Cg,e)}return this._rainTechnique}get snowTechnique(){if(M(this._snowTechnique)){const e=new pH;e.type=s_.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Cg,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),M(s)||M(this._vao)||M(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?Zt(0,o,2*t):Zt(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*nW(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=Cg.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),ZY(n,l,this._instanceIdBuffer,ose,0),n.capabilities.instancing.drawArraysInstanced($t.TRIANGLES,0,3,this._numParticles*t),QY(n,l,this._instanceIdBuffer,ose)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?ie(this._particleColor,.85,.85,.85):ie(this._particleColor,1,1,1),oe(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,s);const n=Math.max(0,Se(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));on(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){M(this._vao)&&(this._vao=this._createVertexArrayObject(e)),M(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return ai.createVertex(e,Ci.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new zs(e,Cg.attributeLocation,{geometry:Oc(QWe)},{geometry:ai.createVertex(e,Ci.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],X1.prototype,"context",void 0),u([d({constructOnly:!0})],X1.prototype,"view",void 0),u([d({readOnly:!0})],X1.prototype,"updating",null),u([d()],X1.prototype,"_updatingTracking",void 0),X1=u([P("esri.views.3d.environment.Precipitation")],X1);const QWe=ns().vec3f(O.POSITION),ose=Oc(ns().f32(O.INSTANCEFEATUREATTRIBUTE),1),JWe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",KWe=de.getLogger("esri.views.3d.environment.SimpleAtmosphere"),CI=128,ase=-nH,lse=0,eV=50,eXe=()=>1-511/512,tXe=nL([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class iXe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:st(),silCircleCenter:R(),silCircleV1:R(),silCircleV2:R(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new mZ,this._fadeVaoCount=0,this._readyResolver=hp(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=tm(t.spatialReference);const i=Ai(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+ase)/this.planetRadius,this.middleRimFactor=(this.planetRadius+lse)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=lse/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=sn(this._cameraChangeHandle),this._passParameters.texture=Je(this._passParameters.texture),this._fadeVao=Je(this._fadeVao),this._vao=Je(this._vao),this._readyController=zh(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=ae(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),_s),this._vao=this._createRibbon(i),this._vaoCount=Po(this._vao,"geometry"),this._fadeVao=qa(i),this._fadeVaoCount=Po(this._fadeVao,"geometry");const r=this.isOnMars?JWe:z1e,s=this._readyController.signal;try{const n=await yp(r,{signal:s});Wt(s),this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Br(n)||KWe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(M(this._coneTechnique)){const t=new YF;t.geometry=Yf.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(B2,t)}return this._coneTechnique}get undergroundTechnique(){if(M(this._undergroundTechnique)){const t=new YF;t.geometry=Yf.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(B2,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays($t.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays($t.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=R(),r=this.planetRadius,s=Re(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(eV,n),a=r+ase;this._renderData.innerScale=rXe(r+o,r,a)-1,this._renderData.altitudeFade=Z_e(n),oe(i,t.eye,(r+eV)/s),cse(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=eXe(),h=tXe(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>eV){cse(t.eye,t.center,t.up,r,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),y=Ne((m-1.5)/(l-1.5),0,1);p=this.texV0+y*c*this.texVScale,f=this.texV0+Zt(this.texV1,l*h,y)*this.texVScale}fi(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*CI*3),r=new Uint32Array(3*CI*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<CI;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===CI-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=use.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new zs(t,Vi,{geometry:Oc(use)},{geometry:ai.createVertex(t,Ci.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return pe(wC,s.silCircleCenter,s.silCircleV2),oe(iV,wC,this.outerRimFactor),k5(tV,i,wC,r),ese(wC,tV,t.projectionMatrix,t.viewport),ese(iV,tV,t.projectionMatrix,t.viewport),ur(wC,iV)/t.height}}function cse(e,t,i,r,s){const n=Re(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return oe(s.silCircleCenter,e,a/n),lt(l,e,t),Fa(l)<1&&lt(l,e,i),oe(l,l,o/Re(l)),lt(c,l,e),oe(c,c,o/Re(c)),o}const tV=Ee(),wC=R(),iV=R();function rXe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const use=ns().vec3f(O.POSITION);function bZ(e){const t=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function sXe(){const e=new Xi;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new xr("transform",(t,i)=>nXe(t,i)),new oi("viewport",(t,i)=>i.camera.fullViewport),new Xe("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(bZ),e.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function nXe(e,t){return ws(My,t.camera.projectionMatrix),My[10]=24e-8-1,My[11]=-1,My[14]=(24e-8-2)*t.camera.near,Dr(My,My,t.camera.viewMatrix),Dr(My,My,e.modelMatrix)}const My=Ee(),oXe=Object.freeze(Object.defineProperty({__proto__:null,build:sXe},Symbol.toStringTag,{value:"Module"}));class aXe extends Bs{constructor(){super(...arguments),this.modelMatrix=Ee()}}class PU extends dr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=PU.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),depthTest:{func:fr.LEQUAL},colorWrite:ri})}}PU.shader=new rr(oXe,()=>import("./Stars.glsl.c72dbaba.js"));const lXe=de.getLogger("esri.views.3d.environment.Stars");let I0=class extends Ae{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new aXe,this._updatingTracking=new Df}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=zh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Hi(this._technique),this._vao=Je(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),M(this._technique)||M(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays($t.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||M(Cx))return;this._technique=new PU({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Cx.byteLength/hse;const t=new Float32Array(Cx,0,2*this._numPoints),i=new Uint8Array(Cx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),Ft)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=ws(this._renderParameter.modelMatrix,hXe);A2(r,r,-i*Math.PI),Dr(r,uXe,r),A2(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=dse.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(cXe[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new zs(e,Vi,{geometry:Oc(dse)},{geometry:ai.createVertex(e,Ci.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(Cx))return null;const e=a3(async t=>{const{data:i}=await PMe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),Cx=i});return e.promise.catch(t=>{Br(t)||lXe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new q("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/hse;if(t%1!=0||t>5e4||t<5e3)throw new q("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],I0.prototype,"view",void 0),u([d({constructOnly:!0})],I0.prototype,"requestRender",void 0),u([d({readOnly:!0})],I0.prototype,"updating",null),u([d()],I0.prototype,"_loadDataTask",void 0),u([d()],I0.prototype,"_updatingTracking",void 0),I0=u([P("esri.views.3d.environment.Stars")],I0);const cXe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],uXe=mX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),hXe=mX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),hse=9,dse=ns().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let Cx=null;var Be;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(Be||(Be={}));var mM;const dXe=[Te.POSTPROCESSING_ENVIRONMENT_OPAQUE,Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let pse,Ta=mM=class extends Ae{constructor(e){super(e),this._handles=new si,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(dXe,this)}destroy(){var e;this._pendingAtmosphere=at(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=at(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Re(this.view.state.camera.eye)-Ai(this.view.spatialReference).radius<=wh}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||M(this._context)?(at(i),null):_(i)?i:new I0({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||M(this._context))return at(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(at(e),new X1({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||M(this._context))return at(e),null;if(_(e))return e;const t=this.view,i=this._context;return at(e),new xa({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||M(this._context))return at(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Ai(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===r?e:(at(e),new W1({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||M(this._context))return at(e),null;if(_(e))return e;const t=this.view,i=this._context;return at(e),new fM({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Cl(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),_s),ae(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),_s),ae(()=>this._stars,()=>this._setNeedsRender()),ae(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Ft),ae(()=>this._precipitation,()=>this._setNeedsRender()),ae(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Ft),ae(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},_s)])}uninitializeRenderContext(){this._context=null,this._atmosphere=at(this._atmosphere),this._set("_stars",at(this._stars)),this._set("_precipitation",at(this._precipitation)),this._set("_clouds",at(this._clouds)),this._set("_cloudsComposition",at(this._cloudsComposition)),this._set("_fog",at(this._fog))}prepareRender(e){e.bindParameters.clouds.data=xqe(this._clouds)?this._clouds:null}render(e){if(e.pass===Be.MATERIAL)switch(e.bindParameters.slot){case Te.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return M(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){M(e)||M(this._clouds)||(this._clouds.applyPreset($1e[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!M(this._fog)&&!M(e))switch(e.type){case"foggy":this._fog.strength=Zt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=Zt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),M(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return Bre;case"panoramic":return qWe;case"simple":return iXe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||im(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&Bre.isSupported(this._context)&&NO(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{pse=mM.prototype._getAtmosphereClass,mM.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{mM.prototype._getAtmosphereClass=pse}}}};u([d({constructOnly:!0})],Ta.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Ta.prototype,"updating",null),u([d({readOnly:!0})],Ta.prototype,"weatherVisible",null),u([d()],Ta.prototype,"_context",void 0),u([d()],Ta.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Ta.prototype,"_stars",null),u([d({readOnly:!0})],Ta.prototype,"_precipitation",null),u([d({readOnly:!0})],Ta.prototype,"_clouds",null),u([d({readOnly:!0})],Ta.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Ta.prototype,"_fog",null),u([d({readOnly:!0})],Ta.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Ta.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Ta.prototype,"_weatherUpdateParameters",null),Ta=mM=u([P("esri.views.3d.environment.EnvironmentRenderer")],Ta);function fse(e,t,i){return pXe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function pXe(e,t,i,r,s){const n=Pt(i),o=Pt(s),a=n-o,l=Pt(t)-Pt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*dp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function fXe(e,t,i){const r=t.spatialReference,s=Ai(r),n=new qe(t.x,e.y,r),o=new qe(i.x,e.y,r),a=new qe(e.x,t.y,r),l=new qe(e.x,i.y,r);return{lon:fse(s.radius,n,o),lat:fse(s.radius,a,l)}}function mXe(e,t,i){const r=t/i,s=Pt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*dp(Math.sqrt(n*n/(o*o)));return Al(a)}function gXe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function mse(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=gXe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var gse,yse,vse,X1e={exports:{}};gse=X1e,yse=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function m($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var v=23.4397*a;function b($,U){return n(t($)*i(v)-r(U)*t(v),i($))}function w($,U){return s(t(U)*i(v)+i(U)*t(v)*t($))}function S($,U,B){return n(t($),i($)*t(U)-r(B)*i(U))}function T($,U,B){return s(t(U)*t(B)+i(U)*i(B)*i($))}function E($,U){return a*(280.16+360.9856235*$)-U}function C($){return a*(357.5291+.98560028*$)}function A($){return a*(1.9148*t($)+.02*t(2*$)+3e-4*t(3*$))}function I($,U){return $+U+102.9372*a+e}function L($,U){var B=C($),H=I(B,A(B));return U||(U={dec:0,ra:0}),U.dec=w(H,0),U.ra=b(H,0),U}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,U,B,H){var W=a*-B,Q=a*U,G=y($),ee=L(G,p),me=E(G,W)-ee.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=S(me,Q,ee.dec),H.altitude=T(me,Q,ee.dec),H}},k=[[-.83,"sunrise","sunset"]];D.addTime=function($,U,B){k.push([$,U,B])};var z=9e-4;function V($,U){return Math.round($-z-U/(2*e))}function X($,U,B){return z+($+U)/(2*e)+B}function Y($,U,B){return h+$+.0053*t(U)-.0069*t(2*B)}function le($,U,B){return o((t($)-t(U)*t(B))/(i(U)*i(B)))}function re($){var U=a*(134.963+13.064993*$),B=a*(93.272+13.22935*$),H=a*(218.316+13.176396*$)+6.289*a*t(U),W=5.128*a*t(B),Q=385001-20905*i(U);return{ra:b(H,W),dec:w(H,W),dist:Q}}return D.getTimes=function($,U,B){var H=a*-B,W=a*U,Q=V(y($),H),G=X(0,H,Q),ee=C(G),me=A(ee),_e=I(ee,me),Me=w(_e,0),ve=Y(G,ee,_e);function ge(Ti){return Y(X(le(Ti,W,Me),H,Q),ee,_e)}function Ce(Ti){var mr=(t(Ti)-t(W)*t(Me))/(i(W)*i(Me));return mr<-1?D.PolarException.MIDNIGHT_SUN:mr>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var $e,gi,wi,Ht,xi,Yt={solarNoon:m(ve),nadir:m(ve-.5),polarException:D.PolarException.NORMAL};for($e=0,gi=k.length;$e<gi;$e+=1)xi=ve-((Ht=ge((wi=k[$e])[0]*a))-ve),Yt[wi[1]]=m(xi),Yt[wi[2]]=m(Ht);return Yt.polarException=Ce(k[0][0]*a),Yt},D.getMoonPosition=function($,U,B){var H=a*-B,W=a*U,Q=y($),G=re(Q),ee=E(Q,H)-G.ra,me=T(ee,W,G.dec);return me+=.017*a/r(me+10.26*a/(me+5.1*a)),{azimuth:S(ee,W,G.dec),altitude:me,distance:G.dist}},D.getMoonFraction=function($){var U=y($),B=L(U),H=re(U),W=149598e3,Q=o(t(B.dec)*t(H.dec)+i(B.dec)*i(H.dec)*i(B.ra-H.ra)),G=n(W*t(Q),H.dist-W*i(Q));return(1+i(G))/2},D},(vse=yse())!==void 0&&(gse.exports=vse);const Fw=X1e.exports,wf={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function yXe(e,t,i,r,s,n,o){ie(o.ambient.color,1,1,1),o.ambient.intensity=wf.global.ambient,ie(o.direct.color,1,1,1),o.direct.intensity=wf.global.direct;const a=t[2],l=Ne((Math.abs(a)-wf.local.altitude)/(wf.global.altitude-wf.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=Fw.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=EXe(e,c,r);else{const p=Z1e(r);h={direct:{intensity:wf.local.directAtNoon*p.direct,color:Ue(1,1,1)},ambient:{intensity:wf.local.ambientAtNoon*p.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}on(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=Zt(h.ambient.intensity,o.ambient.intensity,l),on(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=Zt(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?SXe(e,c):1,n==="sun"?_Xe(e,t,i,o.direct.directionToLightSource):vXe(s,i,o.direct.directionToLightSource)}function vXe(e,t,i){t===Ge.Global?we(rV,e.eye):ie(rV,0,0,1),oe(sV,e.viewForward,-1);const r=sL(sV,rV),s=Math.max(r-2*nV,0),n=.85*s/(s+1),o=Math.max(nV,r-nV-n);Tc(bse,-o,e.viewRight),ke(i,sV,bse),pe(i,i,oe(CXe,e.viewRight,AXe)),we(i,i)}function _Xe(e,t,i,r){const s=TXe,n=Wf(xXe);if(i===Ge.Global)Fw.getPosition(e,0,0,s),ie(r,0,0,-1),C2(n,n,-s.azimuth),F5(n,n,-s.altitude),ke(r,r,n);else{const o=wf.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Ne(c,0,1),c<1?(Fw.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ie(r,0,-1,0),A2(n,n,-s.azimuth),C2(n,n,-s.altitude),ke(r,r,n)}}function bXe(e,t){if(t===Ge.Global)return!0;const i=wf.planarDirection;return Math.abs(e)<i.localAltitude}const wXe=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);class Y1e{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:rs(wXe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const xXe=Ee(),TXe={azimuth:0,altitude:0};function SXe(e,t){const i=e.valueOf();let r,s;t.polarException===Fw.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===Fw.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-Ne(Math.abs(i-n)/432e5,0,1)}function Z1e(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function _se(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function EXe(e,t,i){const r=e.valueOf();let s,n;t.polarException===Fw.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===Fw.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,v=n+p/2,b=wf.local,w=[.01,b.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],I=[.9*b.directAtNoon,b.ambientAtNoon],L=[1,.98,.98],D=[.98,.98,1],k=[b.directAtNoon,b.ambientAtNoon],z=[1,1,1],V=[1,1,1],X=I,Y=L,le=D,re=E,$=C,U=A;let B,H,W=[0,0],Q=[0,0,0],G=[0,0,0];r<f||r>v?(W=w,Q=T,G=S,H="night"):r<m?(B=m-f,W=go(r-f,B,w,E),Q=go(r-f,B,T,C),G=go(r-f,B,S,A),H="sun rising"):r<c?(B=c-m,W=go(r-m,B,E,I),Q=go(r-m,B,C,L),G=go(r-m,B,A,D),H="early morning"):r<a?(B=a-c,W=go(r-c,B,I,k),Q=go(r-c,B,L,z),G=go(r-c,B,D,V),H="late morning"):r<h?(B=h-a,W=go(r-a,B,k,X),Q=go(r-a,B,z,Y),G=go(r-a,B,V,le),H="early afternoon"):r<y?(B=y-h,W=go(r-h,B,X,re),Q=go(r-h,B,Y,$),G=go(r-h,B,le,U),H="late afternoon"):r<v&&(B=v-y,W=go(r-y,B,re,w),Q=go(r-y,B,$,T),G=go(r-y,B,U,S),H="sun setting");let ee=0;switch(i){case"rainy":case"foggy":ee=.9;case"snowy":ee=.5}ee>0&&(Q=_se(Q,ee),G=_se(G,ee));const me=Ue(Q[0],Q[1],Q[2]),_e=Ue(G[0],G[1],G[2]),Me=Z1e(i);return{direct:{intensity:W[0]*Me.direct,color:me},ambient:{intensity:W[1]*Me.ambient,color:_e},timeOfDay:H}}function go(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const bse=Ee(),rV=R(),sV=R(),CXe=R(),nV=.25,AXe=.2;let Ad=class extends Zr.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new si,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new lH,this._ambientLight=new fZ,this._moonLight=new N1e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===Ge.Global&&NO(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ta({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([ae(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Qi),ae(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Qi),ae(()=>e.stationary,()=>this._interactingStationaryHandler()),ae(()=>e.environment.lighting.directShadowsEnabled,t,Qi),ae(()=>e.environment.lighting.ambientOcclusionEnabled,t,Qi),ae(()=>e.environment.lighting.waterReflectionEnabled,t,Qi),ae(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Qi),ae(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Qi),ae(()=>e.environment.weather.type,r,Qi),ae(()=>this.weatherEnabled,r,Qi),ae(()=>e.viewingMode,()=>this._resetReferencePosition(!0),_s),ae(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),_s),ae(()=>e.state.camera,i,_s),ae(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=at(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!ww(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=mse(this._referencePosWGS84Comparable,wse);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=NO(this._view.spatialReference);if(i&&!ww(this._view.spatialReference))return!1;const r=e.position;return M(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=R()),i?uNe(r,this._referencePosWGS84Comparable):ie(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=_(r)?MXe:OXe;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";yXe(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;oe(n.intensity,o.color,o.intensity*Math.PI),ne(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;oe(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;on(l.intensity,PXe,IXe,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));oe(l.intensity,l.intensity,c),ne(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||M(e))return!1;const i=RXe;i.setTime((t||this._view.environment.lighting.date).getTime());const r=mse(e,wse);if(M(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=uu(this._referencePosWGS84Comparable,!0,s=>bXe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof G_e?{type:"color",color:gX(We.toUnitRGBA(i.color))}:{type:"color",color:vi(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=h2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=h2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Ad.prototype,"updating",null),u([d()],Ad.prototype,"disableQueries",void 0),u([d()],Ad.prototype,"_disableWeather",void 0),u([d()],Ad.prototype,"weatherEnabled",null),u([d()],Ad.prototype,"weatherVisible",null),u([d()],Ad.prototype,"referencePositionWGS84Comparable",null),u([d()],Ad.prototype,"_renderer",void 0),u([d()],Ad.prototype,"_referencePosWGS84Comparable",void 0),Ad=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Ad);const MXe=new Y1e,OXe=new Y1e,RXe=new Date,wse={hours:0,minutes:0,seconds:0},PXe=Ue(.22,.22,.33),IXe=Ue(.22,.22,.22);function ER(e,t){return(e&t)!=0}function JF(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var Vt,_r,Fn;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Vt||(Vt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(_r||(_r={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(Fn||(Fn={}));const n_={selection:_r.NONE,interactionType:Vt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Fn.TUMBLE};function Q1e(e,t,i,r){return t=t||e.viewForward,ne(r,t),oe(r,r,Math.sign(Se(t,i))),r}function $Xe(e,t,i,r){return UXe(e,t,i,NXe(r,t,i,!0))}function DXe(e,t,i,r){const s=Se(i,fe(e,r,t));return pe(e,t,oe(e,i,s))}const LXe={dir:R(),len:0,clip:st()};function NXe(e,t,i,r){const s=LXe;return e?(i&&r&&(s.len=ur(t,i)),ne(s.dir,e)):r?(s.len=ur(t,i),fe(s.dir,i,t),oe(s.dir,s.dir,1/s.len)):(fe(s.dir,i,t),we(s.dir,s.dir)),s}function FXe(e,t,i){const r=Se(e,i.dir),s=-lr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function UXe(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!FXe(e[s],t,r))return!1;return!0}function kXe(e,t,i=n_){const r=wZ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=Q1e(t,i.interactionDirection,BXe(e,t,Math.sign(r),qXe),HXe),a=ne(WXe,t.viewForward),l=s.intersectInfiniteManifold(Du(t.eye,o),n,oV);return t.eye=_(l)?l:s.setAltitude(oV,n,t.eye),t.center=DXe(oV,t.eye,a,t.center),!0}function wZ(e,t,i=n_){if(!zXe(e,i))return 0;const r=GXe(e.state.constraints.altitude,jXe);VXe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=Ne(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function zXe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==Vt.TUMBLE||!ER(t.selection,_r.TILT))}function VXe(e,t,i){const r=t.interactionType;if(r===Vt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===Vt.TUMBLE||r===Vt.ZOOM,c=wZ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,JF(c,h,l,a,.05*h,i)}function BXe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),oe(r,r,i),r}function GXe(e,t){return t.min=e.min,t.max=e.max,t}const jXe={min:0,max:0},HXe=R(),qXe=R(),WXe=R(),oV=R();function xZ(e,t,i=n_){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;AI.min=0,AI.max=r,YXe(e,i,AI);const s=TZ(e,t),n=AI.max-s;return n>=-1e-6?0:n}function XXe(e,t,i=n_){const r=xZ(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=TZ(e,t)+r,o=ne(QXe,t.eye),a=Q1e(t,i.interactionDirection,ZXe(e,t,eYe),KXe);if(!g_(xge(s.renderLocation,n),Du(t.eye,a),MI))return!1;t.eye=MI;const l=fe(JXe,t.eye,o);t.center=pe(MI,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,MI);return _(h)&&(t.center=h),!0}function YXe(e,t,i){const r=t.interactionType;if(r===Vt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===Vt.ZOOM||r===Vt.PAN,c=xZ(e,o),h=c===0?0:TZ(e,o);i.min=s,i.max=n,JF(c,h,l,a,.05*h,i)}function TZ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return ur(t.eye,i.renderLocation)}function ZXe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return ny(i,t.eye,r.renderLocation)}const AI={min:0,max:0},QXe=R(),JXe=R(),KXe=R(),eYe=R(),MI=R();var zr,lo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(zr||(zr={}));class tYe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=lo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(lo||(lo={}));function um(e){return _(e)&&_(e.dist)}function xse(e){return(t,i,r)=>(on(Tse,t,i,r),!EX(e,Tse))}function IU(e){return um(e)&&e.intersector===zr.OBJECT&&!!e.target}function $U(e){return um(e)&&e.intersector===zr.HUD&&!!e.target&&_(e.target.center)}const Tse=R();class iYe{constructor(){this._transform=Ee(),this._transformInverse=new OI({value:this._transform},Xr,Ee),this._transformInverseTranspose=new OI(this._transformInverse,$l,Ee),this._transformTranspose=new OI({value:this._transform},$l,Ee),this._transformInverseRotation=new OI({value:this._transform},E1e,ir)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){ws(this._transform,t)}multiplyTransform(t){Dr(this._transform,this._transform,t)}set(t){ws(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class OI{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class rYe{constructor(t=0){this.offset=t,this.tmpVertex=R()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)Oy[n]=t[0+n]+this.localOrigin[n],RI[n]=t[3+n]+this.localOrigin[n],Ax[n]=Oy[n];const i=this.applyToVertex(Oy[0],Oy[1],Oy[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Ax[o]=(n&1<<o)==0?Oy[o]:RI[o];r(Ax)}let s=0;for(let n=0;n<3;++n)Oy[n]*RI[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?Ax[o]=0:Ax[o]=(n&1<<o)!=0?Oy[o]:RI[o];r(Ax)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const Oy=R(),RI=R(),Ax=R();class sYe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=R(),this._mbs=bn(),this._obb={center:R(),halfSize:Ri(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),v=Math.sqrt(f*f+m*m+y*y),b=this._totalOffset/v,w=this._totalOffset/p;return t[0]+=i*(i>0?b:w),t[1]+=r*(r>0?b:w),t[2]+=s*(s>0?b:w),t[3]+=n*(n<0?b:w),t[4]+=o*(o<0?b:w),t[5]+=a*(a<0?b:w),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Eu(this._obb.halfSize,t.halfSize,t.quaternion),pe(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,fe(this._obb.halfSize,this._obb.halfSize,t.center),ey(Ase,t.quaternion),Eu(this._obb.halfSize,this._obb.halfSize,Ase),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class nYe{constructor(t=0){this.offset=t,this.sphere=bn(),this.tmpVertex=R()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Sse=new nYe;function fH(e){return _(e)?(Sse.offset=e,Sse):null}const Ese=new sYe;function oYe(e){return _(e)?(Ese.offset=e,Ese):null}const Cse=new rYe;function aYe(e){return _(e)?(Cse.offset=e,Cse):null}const qd="terrain",Ase=wp();function mH(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function lYe(e,t){const i=e.length;for(let r=0;r<i;++r)TS[0]=e[r],t[r]=TS[0];return t}function cYe(e,t){const i=e.length;for(let r=0;r<i;++r)TS[0]=e[r],TS[1]=e[r]-TS[0],t[r]=TS[1];return t}const TS=new Float32Array(2);function gH(e,t){return M(e)&&(e=[]),e.push(t),e}function yH(e,t){if(M(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function N3(e){return!!_(e)&&!e.visible}function uYe(e,t,i){const r=e.origin.vec3;B1e(aV,-r[0],-r[1],-r[2]),_(e.transformation)?Dr(t,aV,e.transformation):ws(t,aV),i&&(Xr(i,t),$l(i,i))}function hYe(e,t,i,r,s){PI[0]=e.get(t,0),PI[1]=e.get(t,1),PI[2]=e.get(t,2),mH(PI,N_,3),i.set(s,0,N_[0]),r.set(s,0,N_[1]),i.set(s,1,N_[2]),r.set(s,1,N_[3]),i.set(s,2,N_[4]),r.set(s,2,N_[5])}const PI=new Float64Array(3),N_=new Float32Array(6),aV=Ee(),Z2=1e-5;class dYe{constructor(t){this.options=new tYe,this._results=new pYe,this.transform=new iYe,this.tolerance=Z2,this.verticalOffset=null,this._ray=io(),this._rayEnd=R(),this._rayBeginTransformed=R(),this._rayEndTransformed=R(),this.viewingMode=t==null?Ge.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(UNe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&xF(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ge.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,pe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?Z2:r;const o=fH(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=fH(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(N3(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,y,v,b)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const w=y?this._results.hud:this._results,S=y?T=>{const E={object:t,geometryId:c,triangleNr:m,center:_(b)?[b[0],b[1],b[2]]:null};T.set(zr.HUD,E,p,f,Us,v)}:T=>T.set(zr.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,v);if((w.min.drapedLayerOrder==null||v>=w.min.drapedLayerOrder)&&(w.min.dist==null||p<w.min.dist)&&S(w.min),this.options.store!==lo.MIN&&(w.max.drapedLayerOrder==null||v<w.max.drapedLayerOrder)&&(w.max.dist==null||p>w.max.dist)&&S(w.max),this.options.store===lo.ALL)if(y){const T=new vH(this._ray);S(T),this._results.hud.all.push(T)}else{const T=new YS(this._ray);S(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?_t(i.dist,0)-_t(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?_t(i.drapedLayerOrder,Number.MAX_VALUE)-_t(r.drapedLayerOrder,Number.MAX_VALUE):_t(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-_t(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function Wh(e){return new dYe(e)}class pYe{constructor(){this.min=new YS(io()),this.max=new YS(io()),this.hud={min:new vH(io()),max:new vH(io()),all:new Array},this.ground=new YS(io()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class YS{constructor(t){this.intersector=zr.OBJECT,this.normal=R(),this.transformation=Ee(),this._ray=io(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(oe(II,this.ray.direction,this.dist),Re(II)):null}getIntersectionPoint(t){return!!um(this)&&(oe(II,this.ray.direction,this.dist),pe(t,this.ray.origin,II),!0)}getTransformedNormal(t){return ne(xC,this.normal),xC[3]=0,bu(xC,xC,this.transformation),ne(t,xC),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=zr.OBJECT,xF(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,ne(this.normal,_t(s,cpe)),ws(this.transformation,_t(n,Us)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){xF(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ne(this.normal,t.normal),ws(this.transformation,t.transformation)}}class vH extends YS{constructor(){super(...arguments),this.intersector=zr.HUD}}function SZ(e){return new YS(e)}const II=R(),xC=qt();function J1e(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,KF,r))&&Pfe(i,KF)}function DU(e,t){return e.elevationProvider?_t(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function cx(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),fYe(e,s.ray,Ry)||ne(Ry,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(_n(s.eye,Ry)<o){const a=n.collision.enabled;ne(F_,s.viewForward),oe(F_,F_,o),a?s.eye=fe(KF,Ry,F_):pe(Ry,s.eye,F_);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(fe(F_,Ry,s.eye),s.eye=l.setAltitude(KF,h,s.eye),pe(Ry,s.eye,F_))}return s.center=Ry,s}function Mse(e,t,i){if(!e.state.isGlobal)return!1;const r=DU(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,gYe),o=n*n;return _n(t,i)>o}function fYe(e,t,i){let r=Ose[e.viewingMode];r||(r=Wh(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Ose[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||Mse(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||Mse(e,t.origin,i))||!!s&&mYe(t,i,Ai(e.spatialReference).radius)}function mYe(e,t,i){const r=Se(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return oe(t,e.direction,s/Re(e.direction)),pe(t,t,e.origin),!0}const Ose={},KF=R(),Ry=R(),F_=R(),gYe={near:0,far:0};function GE(e,t,i=Fh.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=DU(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Re(t.eye);if(fe($I,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(yYe,o,t.eye),i===Fh.EYE_AND_CENTER)t.center=pe($I,t.eye,$I);else if(i===Fh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=oe($I,t.center,l)}return!0}var Fh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Fh||(Fh={}));const $I=R(),yYe=R();function o_(e,t,i){e.worldUpAtPosition(t,Rse),fe(lV,i,t);const r=Re(lV);return r===0?0:an(Se(lV,Rse)/r)}const Rse=R(),lV=R();function K1e(e,t,i=n_,r=!0){TC.eyeCenterDistance=0,TC.requiresTwoSteps=!1;const s=EZ(e,t,i,void 0,TC);if(s===0)return!1;switch(Tc(DI,-s,t.viewRight),i.tiltMode){case Fn.LOOK_AROUND:ke(Py,t.viewForward,DI),oe(Py,Py,TC.eyeCenterDistance),t.center=pe(J0,t.eye,Py);break;case Fn.TUMBLE:fe(Py,t.center,t.eye),ke(Py,Py,DI),t.eye=fe(J0,t.center,Py);break;default:i.tiltMode}return t.up=ke(J0,t.up,DI),!TC.requiresTwoSteps||!r||K1e(e,t,i,!1)}function EZ(e,t,i=n_,r=n_,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,AYe);return CYe(e,i,o),r.interactionType===Vt.TUMBLE&&ER(r.selection,_r.ALTITUDE)&&ebe(e,r.interactionStartCamera,o),i.tiltMode===Fn.LOOK_AROUND||r.tiltMode===Fn.LOOK_AROUND?_Ye(e,t,o,s):vYe(e,t,o)}function vYe(e,t,i){const r=o_(e.renderCoordsHelper,t.center,t.eye),s=r-Ne(r,i.min,i.max);return CR(s)?s:0}function _Ye(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return wYe(e,t,i,r);case"local":return bYe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function bYe(e,t,i,r){const s=o_(e.renderCoordsHelper,t.center,t.eye),n=Ne(s,i.min,i.max),o=s-n;if(!CR(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function wYe(e,t,i,r){const s=xYe(e,t,MYe),n=Ne(s.tiltAtCenter,i.min,i.max);if(!CR(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=TYe(s),a=SYe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=EYe(s,o)),r&&(r.eyeCenterDistance=_H(s,o)),a}function xYe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+Ai(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,J0);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=ur(t.eye,n),i.tiltAtCenter=o_(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=o_(e.renderCoordsHelper,t.center,t.eye):(RE(G5(j5,s),t.ray,J0),i.eyeCenterDistance=ur(t.eye,J0),i.tiltAtCenter=an(-Se(t.viewForward,we(J0,J0)))),i.radius=s,i.eyeRadius=Re(t.eye),i.constraints=e.state.constraints,i}function CR(e){return Math.abs(e)>1e-9}function TYe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=_H(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&CR(n-s);){const l=(s+n)/2,c=_H(e,l);CR(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function _H(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-Ne(t,0,Math.PI),r=dp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function SYe(e,t){const i=dp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=dp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function EYe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function CYe(e,t,i){if(t.interactionType===Vt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=EZ(e,r,n_,t),l=a===0?0:o_(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===Vt.TUMBLE?(ER(t.selection,_r.ALTITUDE)&&ebe(e,r,i),JF(a,l,!0,s,Pse,i)):JF(a,l,!1,s,Pse,i)}function ebe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=Fa(t.center),n=Math.sqrt(s),o=t.distance,a=Ai(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-an(p),i.max)),i.max=Math.min(i.max,Math.PI-an(h))}const Py=R(),DI=Ee(),J0=R(),Pse=Pt(5),AYe={min:0,max:0},MYe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},TC={eyeCenterDistance:0,requiresTwoSteps:!1};function OYe(e){return e}const LU=e=>e*e,CZ=e=>1-LU(1-e),RYe=e=>e<.5?LU(2*e)/2:(CZ(2*(e-.5))+1)/2,AZ=e=>e*e*e,tbe=e=>1-AZ(1-e),ibe=e=>e<.5?AZ(2*e)/2:(tbe(2*(e-.5))+1)/2,MZ=e=>e*e*e*e,rbe=e=>1-MZ(1-e),PYe=e=>e<.5?MZ(2*e)/2:(rbe(2*(e-.5))+1)/2,OZ=e=>e*e*e*e*e,sbe=e=>1-OZ(1-e),IYe=e=>e<.5?OZ(2*e)/2:(sbe(2*(e-.5))+1)/2,RZ=e=>1-Math.cos(e*Math.PI/2),nbe=e=>1-RZ(1-e),$Ye=e=>e<.5?RZ(2*e)/2:(nbe(2*(e-.5))+1)/2,PZ=e=>2**(10*(e-1)),F3=e=>1-PZ(1-e),DYe=e=>e<.5?PZ(2*e)/2:(F3(2*(e-.5))+1)/2,IZ=e=>-(Math.sqrt(1-e*e)-1),obe=e=>1-IZ(1-e),LYe=e=>e<.5?IZ(2*e)/2:(obe(2*(e-.5))+1)/2;function Kh(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function ed(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const NYe=ed(Kh(1),1),FYe=ed(Kh(1),0),abe=ed(Kh(1),.5),UYe=ed(Kh(2),1),kYe=ed(Kh(2),0),zYe=ed(Kh(2),.5),VYe=ed(Kh(3),1),BYe=ed(Kh(3),0),GYe=ed(Kh(3),.5),jYe=ed(Kh(4),1),HYe=ed(Kh(4),0),qYe=ed(Kh(4),.5),WYe={linear:OYe,"in-quad":LU,"out-quad":CZ,"in-out-quad":RYe,"in-coast-quad":NYe,"out-coast-quad":FYe,"in-out-coast-quad":abe,"in-cubic":AZ,"out-cubic":tbe,"in-out-cubic":ibe,"in-coast-cubic":UYe,"out-coast-cubic":kYe,"in-out-coast-cubic":zYe,"in-quart":MZ,"out-quart":rbe,"in-out-quart":PYe,"in-coast-quart":VYe,"out-coast-quart":BYe,"in-out-coast-quart":GYe,"in-quint":OZ,"out-quint":sbe,"in-out-quint":IYe,"in-coast-quint":jYe,"out-coast-quint":HYe,"in-out-coast-quint":qYe,"in-sine":RZ,"out-sine":nbe,"in-out-sine":$Ye,"in-expo":PZ,"out-expo":F3,"in-out-expo":DYe,"in-circ":IZ,"out-circ":obe,"in-out-circ":LYe};function ps(e,t,i=QYe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<JYe;a++){let l=0;for(const c of ZYe)if(ER(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=ER(i.selection,_r.COLLISION),o=XYe(i.interactionType,e);return n&&GE(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function XYe(e,t){switch(e){case Vt.PAN:return Fh.EYE_AND_CENTER;case Vt.ASCEND:return t.state.isGlobal?Fh.EYE_AND_CENTER_SCALE:Fh.EYE_AND_CENTER;default:return Fh.EYE}}function Gd(e,t){const i=typeof e=="number"?e:HY(e,t),r=Math.min(1,i/150);return ibe(r)}function YYe(e,t,i){return EZ(e,t,i)*t.distance}const ZYe=[{type:_r.TILT,error:YYe,apply:K1e},{type:_r.ALTITUDE,error:wZ,apply:kXe},{type:_r.DISTANCE,error:xZ,apply:XXe}],QYe={selection:_r.ALL,interactionType:Vt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Fn.TUMBLE},JYe=5,$c=R(),Ul=R(),Iy=R(),jo=R(),U_=R(),KYe=R(),Dc={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},Ise=ir();class $se{constructor(t=Ge.Global){this.viewingMode=t,this.center=R(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=rs(Dc.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ge.Global){const n=(Re(this.center)+Re(t.center))/2;i.pan=sL(this.center,t.center)*n}else i.pan=ur(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===Ge.Global?iFe(t.center,i.center,r.pan,this.center):on(this.center,t.center,i.center,r.pan),this.distance=Zt(t.distance,i.distance,r.zoom),this.pitch=Zt(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Zt(s,n,r.rotate)}copyFrom(t){ne(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ne(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,Ise);ne(this.center,t.center),fe(jo,t.center,t.eye),Oo(jo,jo,i),Oo(U_,t.up,i),this.distance=Re(jo),jo[0]/=this.distance,jo[1]/=this.distance,jo[2]/=this.distance,this.pitch=this._eyeUpToPitch(jo),this.yaw=this._eyeUpToYaw(jo,U_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,Ise);Hh(i,i),this._axisAngleVec3(Dc.sideway,this.pitch-Math.PI/2,Dc.forward,jo),this._axisAngleVec3(Dc.upward,this.yaw,jo),this._axisAngleVec3(Dc.sideway,this.pitch-Math.PI/2,Dc.upward,U_),this._axisAngleVec3(Dc.upward,this.yaw,U_),oe(jo,jo,this.distance),Oo(jo,jo,i),Oo(U_,U_,i),t.center=this.center,t.eye=fe(jo,this.center,jo),t.up=U_}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return oe($c,r,n),lt(Ul,t,r),oe(Ul,Ul,o),oe(Iy,t,(1-n)*Se(t,r)),pe(s,pe(s,$c,Ul),Iy)}_lookAtOrientation(t,i=ir()){return this._upAtLookAt(t,Iy),lt($c,this.lookAtDirection,Iy),we($c,$c),$c[0]===0&&$c[1]===0&&$c[2]===0&&ne($c,Dc.sideway),lt(Ul,Iy,$c),we(Ul,Ul),i[0]=$c[0],i[1]=Ul[0],i[2]=Iy[0],i[3]=$c[1],i[4]=Ul[1],i[5]=Iy[1],i[6]=$c[2],i[7]=Ul[2],i[8]=Iy[2],i}_upAtLookAt(t,i){return this.viewingMode===Ge.Local?ne(i,Dc.upward):we(i,t)}_eyeUpToPitch(t){return Math.PI-sL(Dc.upward,t)}_eyeUpToYaw(t,i){const r=KYe;return Math.abs(i[2])<.5?(ne(r,i),t[2]>0&&oe(r,r,-1)):ne(r,t),lt(Ul,r,Dc.upward),we(Ul,Ul),sL(Dc.sideway,Ul,Dc.upward)}}function $Z(e){return e?{ray:io(e.ray),c0:e.c0,c1:e.c1}:{ray:io(),c0:0,c1:Number.MAX_VALUE}}function eZe(e,t=$Z()){return xF(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function tZe(e,t,i=$Z()){const r=Re(e.vector);return wge(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function gTt(e,t){return lbe(e,e.c0,t)}function yTt(e,t){return lbe(e,e.c1,t)}function lbe(e,t,i){return pe(i,e.ray.origin,oe(i,e.ray.direction,t))}new ay(()=>({c0:0,c1:0,ray:null}));function AR(e){return e?[Ei(e[0]),Ei(e[1]),Ei(e[2]),Ei(e[3]),Ei(e[4]),Ei(e[5])]:[Ei(),Ei(),Ei(),Ei(),Ei(),Ei()]}function cbe(){return[R(),R(),R(),R(),R(),R(),R(),R()]}function e4(e,t){for(let i=0;i<iy.NUM;i++)H5(e[i],t[i])}function ube(e,t,i,r=aZe){const s=Dr(vX.get(),t,e);Xr(s,s);for(let n=0;n<bH.NUM;++n){const o=bu(yX.get(),oZe[n],s);ie(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}hbe(i,r)}function hbe(e,t){ia(t[tt.FAR_BOTTOM_LEFT],t[tt.NEAR_BOTTOM_LEFT],t[tt.NEAR_TOP_LEFT],e[ar.LEFT]),ia(t[tt.NEAR_BOTTOM_RIGHT],t[tt.FAR_BOTTOM_RIGHT],t[tt.FAR_TOP_RIGHT],e[ar.RIGHT]),ia(t[tt.FAR_BOTTOM_LEFT],t[tt.FAR_BOTTOM_RIGHT],t[tt.NEAR_BOTTOM_RIGHT],e[ar.BOTTOM]),ia(t[tt.NEAR_TOP_LEFT],t[tt.NEAR_TOP_RIGHT],t[tt.FAR_TOP_RIGHT],e[ar.TOP]),ia(t[tt.NEAR_BOTTOM_LEFT],t[tt.NEAR_BOTTOM_RIGHT],t[tt.NEAR_TOP_RIGHT],e[ar.NEAR]),ia(t[tt.FAR_BOTTOM_RIGHT],t[tt.FAR_BOTTOM_LEFT],t[tt.FAR_TOP_LEFT],e[ar.FAR])}function vv(e,t){for(let i=0;i<iy.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function iZe(e,t){return pbe(e,eZe(t,fbe.get()))}function vTt(e,t){for(let i=0;i<iy.NUM;i++){const r=e[i];if(!uFe(r,t))return!1}return!0}function rZe(e,t,i){return pbe(e,tZe(t,i,fbe.get()))}function dbe(e,t){for(let i=0;i<iy.NUM;i++)if(lr(e[i],t)>0)return!1;return!0}function sZe(e,t){for(let i=0;i<iy.NUM;i++)if(lFe(e[i],t))return!1;return!0}function pbe(e,t){for(let i=0;i<iy.NUM;i++)if(!cFe(e[i],t))return!1;return!0}var ar,tt;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(ar||(ar={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(tt||(tt={}));const nZe={bottom:[tt.FAR_BOTTOM_RIGHT,tt.NEAR_BOTTOM_RIGHT,tt.NEAR_BOTTOM_LEFT,tt.FAR_BOTTOM_LEFT],near:[tt.NEAR_BOTTOM_LEFT,tt.NEAR_BOTTOM_RIGHT,tt.NEAR_TOP_RIGHT,tt.NEAR_TOP_LEFT],far:[tt.FAR_BOTTOM_RIGHT,tt.FAR_BOTTOM_LEFT,tt.FAR_TOP_LEFT,tt.FAR_TOP_RIGHT],right:[tt.NEAR_BOTTOM_RIGHT,tt.FAR_BOTTOM_RIGHT,tt.FAR_TOP_RIGHT,tt.NEAR_TOP_RIGHT],left:[tt.FAR_BOTTOM_LEFT,tt.NEAR_BOTTOM_LEFT,tt.NEAR_TOP_LEFT,tt.FAR_TOP_LEFT],top:[tt.FAR_TOP_LEFT,tt.NEAR_TOP_LEFT,tt.NEAR_TOP_RIGHT,tt.FAR_TOP_RIGHT]};var iy,bH;(function(e){e[e.NUM=6]="NUM"})(iy||(iy={})),function(e){e[e.NUM=8]="NUM"}(bH||(bH={}));const oZe=[vi(-1,-1,-1,1),vi(1,-1,-1,1),vi(1,1,-1,1),vi(-1,1,-1,1),vi(-1,-1,1,1),vi(1,-1,1,1),vi(1,1,1,1),vi(-1,1,1,1)],fbe=new ay($Z),aZe=cbe(),lZe=de.getLogger("esri.views.3d.webgl-engine.lib.Camera");class qi{constructor(t=null,i=null,r=null){this._viewUp=R(),this._viewForward=R(),this._viewRight=R(),this._ray=io(),this._viewport=vi(0,0,1,1),this._padding=vi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Fi(1,1e3),this._viewDirty=!0,this._viewMatrix=Ee(),this._projectionDirty=!0,this._projectionMatrix=Ee(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ee(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ee(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=AR(),this._fullViewport=qt(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&ne(this._ray.origin,t),this._center=_(i)?rs(i):R(),this._up=_(r)?rs(r):Ue(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return fe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){ws(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[At.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[At.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[At.RIGHT]+this._padding[At.LEFT]}set fullWidth(t){this.width=t-(this._padding[At.RIGHT]+this._padding[At.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[At.TOP]+this._padding[At.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[At.TOP]+this._padding[At.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[At.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[At.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[At.TOP]===t[At.TOP]&&this._padding[At.RIGHT]===t[At.RIGHT]&&this._padding[At.BOTTOM]===t[At.BOTTOM]&&this._padding[At.LEFT]===t[At.LEFT]||(this._viewport[0]+=t[At.LEFT]-this._padding[At.LEFT],this._viewport[1]+=t[At.BOTTOM]-this._padding[At.BOTTOM],this._viewport[2]-=t[At.RIGHT]+t[At.LEFT]-(this._padding[At.RIGHT]+this._padding[At.LEFT]),this._viewport[3]-=t[At.TOP]+t[At.BOTTOM]-(this._padding[At.TOP]+this._padding[At.BOTTOM]),Zd(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Dr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;Rme(this._projectionMatrix,-s*(1+2*this._padding[At.LEFT]/t),s*(1+2*this._padding[At.RIGHT]/t),-r*(1+2*this._padding[At.BOTTOM]/i),r*(1+2*this._padding[At.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return M(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ee()),this._inverseProjectionDirty&&Xr(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){ws(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return zWe(this._fov,this.width,this.height)}set fovX(t){this._fov=UWe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return VWe(this._fov,this.width,this.height)}set fovY(t){this._fov=kWe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return ur(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Xr(this._viewInverseTransposeMatrix,this.viewMatrix),$l(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ne(this._ray.origin,t.eye),ne(this._center,t.center),ne(this._up,t.up),Zd(this._viewport,t.viewport),Zd(this._padding,t.padding),co(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(ws(this._viewMatrix,t.viewMatrix),ne(this._viewRight,t.viewRight),ne(this._viewUp,t.viewUp),ne(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(ws(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(e4(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(ws(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Zd(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new qi().copyFrom(this)}equals(t){return ka(this.eye,t.eye)&&ka(this._center,t.center)&&ka(this._up,t.up)&&LO(this._viewport,t.viewport)&&LO(this._padding,t.padding)&&X_e(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;bc(Ho,t.eye,t.center),bc(cV,this.eye,this._center);const s=Se(Ho,cV),n=n9(Ho),o=n9(cV);return s*s>=r*n*o&&vW(t.eye,this.eye)<Math.max(n,o)*i*i&&rF(t.padding,this._padding)<.5&&rF(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(qM(this.viewForward,fe(Ho,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Wr()){return t[0]=(this.padding[At.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[At.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[At.LEFT]+this.width*i,t[1]=this.padding[At.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==Gt&&ne(Gt,t),Gt[3]=1,bu(Gt,Gt,this.projectionMatrix);const r=Math.abs(Gt[3]);oe(Gt,Gt,1/r);const s=this.fullViewport;i[0]=Zt(0,s[0]+s[2],.5+.5*Gt[0]),i[1]=Zt(0,s[1]+s[3],.5+.5*Gt[1]),i[2]=.5*(Gt[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;Gt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Gt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Gt[2]=(2*t[2]-1)*t[3],Gt[3]=t[3],bu(Gt,Gt,this.inverseProjectionMatrix),i[0]=Gt[0],i[1]=Gt[1],i[2]=Gt[2]}projectToScreen(t,i){this.projectToRenderScreen(t,uV),this.renderToScreen(uV,i)}projectToRenderScreen(t,i){if(Gt[0]=t[0],Gt[1]=t[1],Gt[2]=t[2],Gt[3]=1,bu(Gt,Gt,this.viewProjectionMatrix),Gt[3]===0)return null;oe(Gt,Gt,1/Math.abs(Gt[3]));const r=this.fullViewport;return"x"in i?(i.x=Zt(0,r[0]+r[2],.5+.5*Gt[0]),i.y=Zt(0,r[1]+r[3],.5+.5*Gt[1])):(i[0]=Zt(0,r[0]+r[2],.5+.5*Gt[0]),i[1]=Zt(0,r[1]+r[3],.5+.5*Gt[1]),i.length>2&&(i[2]=.5*(Gt[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,uV),i)}unprojectFromRenderScreen(t,i){if(Dr(LI,this.projectionMatrix,this.viewMatrix),!Xr(LI,LI))return null;const r=this.fullViewport;return Gt[0]=2*(t[0]-r[0])/r[2]-1,Gt[1]=2*(t[1]-r[1])/r[3]-1,Gt[2]=2*t[2]-1,Gt[3]=1,bu(Gt,Gt,LI),Gt[3]===0?null:(i[0]=Gt[0]/Gt[3],i[1]=Gt[1]/Gt[3],i[2]=Gt[2]/Gt[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===Ge.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){fe(Ho,this.center,this.eye);const t=Re(this.center);t<1?(ie(this._up,0,0,1),this._markViewDirty()):Math.abs(Se(Ho,this.center))>.9999*Re(Ho)*t||(lt(this._up,Ho,this.center),lt(this._up,this._up,Ho),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){ny(Ho,this.eye,this.center),Math.abs(Ho[2])<=.9999&&(oe(Ho,Ho,Ho[2]),ie(this._up,-Ho[0],-Ho[1],1-Ho[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ka(t,i)||(ne(i,t),this._markViewDirty()):lZe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(ube(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(k5(this._viewMatrix,this.eye,this._center,this._up),ie(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ie(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ie(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Gt=qt(),LI=Ee(),Ho=R(),cV=R(),uV=Ro();var At;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(At||(At={}));const t4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class DZ{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:t4.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new DZ(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:t4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class cZe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class hV{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function uZe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function hZe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function dZe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function pZe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function fZe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function mZe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function gZe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function yZe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function vZe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function _Ze(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function bZe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function wZe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function xZe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function TZe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function SZe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function EZe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function CZe(e,t){let i=AZe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?pZe:uZe,a=s?fZe:hZe,l=s?mZe:dZe,c=n?xZe:_Ze,h=n?TZe:bZe,p=n?SZe:wZe,f=E=>o(e,E,r)+gZe(e,E,r)+c(e,E,r),m=E=>a(e,E,r)+yZe(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+vZe(e,E,r)+p(e,E,r);let v=f(i);const b=EZe(e);let w;const S=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(w=0;w<S;w++){const C=(m(i)+1e-6)/y(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,v=f(i);break}if(i-=C,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-v)/v<=.005)break;v=A}return v>b*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function AZe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class MZe extends cZe{constructor(t,i){super(),this._preallocSegments=[new hV,new hV,new hV],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=CZe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=CZ(r.zoom):t===this._descensionSegment&&(r.zoom=LU(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const OZe={zoom:0,pan:0,rotate:0};class RZe{constructor(t){this.createCamera=t,this._time=0,this.definition=new DZ(t),this.path=new MZe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(jhe(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?abe:F3}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,OZe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:t4.minDuration/r,n=i.maxDuration!=null?i.maxDuration:t4.maxDuration/r;return Math.min(Math.max(s,t),n)}}const PZe=R();class IZe{constructor(t){this.currentTime=0,this._animation=new RZe(()=>new $se(t)),this._current=new $se(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=fe(PZe,i.center,t.center),a=Re(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ne(s.lookAtDirection,o),ne(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new qi,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+jhe(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var Ur;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Ur||(Ur={}));let Fb=class extends Ae{constructor(){super(...arguments),this.state=Ur.Ready}get active(){return this.state===Ur.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ur.Stopped,!0)}finishController(){this.state=Ur.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],Fb.prototype,"active",null),u([d()],Fb.prototype,"state",void 0),Fb=u([P("esri.views.3d.state.controllers.CameraController")],Fb);let MR=class extends Fb{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(hi()),this._asyncResult=null),this.state===Ur.Finished||this.state===Ur.Stopped?this.state===Ur.Finished?e.resolve():e.reject(hi()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ur.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==Ur.Ready&&this.state!==Ur.Running||(this.viewAnimation.state===F2.State.FINISHED?this.finish():this.viewAnimation.state===F2.State.STOPPED&&(this.state=Ur.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Ur.Finished?this.viewAnimation.finish():this.state===Ur.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ur.Finished?this._asyncResult.resolve():this._asyncResult.reject(hi()))}finish(){this.finishController()}};MR=u([P("esri.views.3d.state.controllers.AnimationController")],MR);let Ag=class extends MR{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new IZe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new F2}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);NI.copyFrom(this.view.state.camera);const r=Wh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(NI.ray,r,Dse)&&(NI.center=Dse),this.animation.update(NI,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return ye(F({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?WYe[e.easing]:e.easing})}};u([d({constructOnly:!0})],Ag.prototype,"view",void 0),u([d({constructOnly:!0})],Ag.prototype,"mode",void 0),Ag=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Ag);const NI=new qi,Dse=R();function mbe(e,t,i){return $Ze(e,e.screenToRender(t,je.get()),i)}function $Ze(e,t,i){const r=co(je.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=co(je.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,je.get());return M(n)?null:(fe(i.direction,n,i.origin),i)}function jE(e,t,i){return LZ(e,e.screenToRender(t,je.get()),i)}function LZ(e,t,i){ne(i.origin,e.eye);const r=ie(je.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,je.get());return M(s)?null:(fe(i.direction,s,i.origin),i)}function NZ(e,t,i,r){const s=jE(t,i,DZe);return g_(e,s,r)}const DZe=io();var Q2;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(Q2||(Q2={}));const gbe=30,i4=[1,3e8],ybe=70;function iw(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function wH(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function a_(e,t,i){const r=Tc(vX.get(),i[3],i);M(r)||(fe(ji,e.eye,t),ke(ji,ji,r),e.eye=pe(ji,ji,t),fe(ji,e.center,t),ke(ji,ji,r),e.center=pe(ji,ji,t),e.up=ke(ji,e.up,r))}function LZe(e,t,i,r){return sx(e,mbe(t,i,kZ),r)}function xH(e,t,i,r){return sx(e,jE(t,i,kZ),r)}function FZ(e,t,i,r){const s=je.get();let n=1-i;fe(s,t,e.eye);const o=Re(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(oe(s,s,n),e.eye=pe(ji,e.eye,s),e.center=on(ji,e.center,t,n))}function vbe(e,t,i){t.getScreenCenter(Lse),NZ(e,t,Lse,ji)&&(t.center=ji);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=oe(je.get(),t.viewForward,s);t.eye=fe(ji,t.center,n)}const Lse=Wr();function dV(e,t){ie(t,0,0,0);for(const i of e)pe(t,t,i);oe(t,t,1/e.length)}function qL(e,t,i,r){return Math.sin(e/Re(t))*(i+r.radius)}function Nse(e,t,i,r){return qL(Math.PI/2,t,i,r)+(e-Math.PI/2)}var ro;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(ro||(ro={}));const Fse={Elevation:3e4,Angle:Pt(6)},oO={Pole:.95,Angle:Pt(18),Tilt:45},_be=Pt(80);function bbe(e,t,i,r,s,n){const o=R(),a=bn();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Re(o):(c=!1,t.aboveGround&&s!==Q2.Ellipsoid?a[3]=Math.max(Re(t.center),.9*r.radius):a[3]=Re(t.eye)-t.relativeElevation,s===Q2.Silhouette?OR(a,t,i,o):l=NZ(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function NU(e,t,i,r){return Re(e.eye)-r.radius>Fse.Elevation?ro.Horizontal:i?(jE(e,t,Hse),-Math.sign(e.relativeElevation)*(.5*Math.PI+bX(e.eye,Hse.direction))<Fse.Angle?ro.Vertical:ro.Horizontal):ro.Vertical}function wbe(e,t,i){fe(pV,i,t),e.eye=fe(ji,e.eye,pV),e.center=fe(ji,e.center,pV)}const pV=R();function OR(e,t,i,r){const s=jE(t,i,kZ);return!M(s)&&(RE(e,s,FI),g_(e,s,r)?!(_n(FI,s.origin)<_n(r,s.origin))||(ne(r,FI),!1):(fe(Mx,t.eye,t.center),we(Mx,Mx),Rge(Mx,-Se(we(Mx,Mx),FI),Use),sx(Use,s,r),!1))}const FI=R(),Mx=R(),Use=Ei();function xbe(e,t,i,r,s,n){let o;if(lt(n4,e,t),fe(VI,e,t),Re(e)<=s||!r.aboveGround){lt(i,VI,r.eye);const a=Se(e,t)/(Re(e)*Re(t)),l=Math.cos(Ne(Bv.normalize(Pt(n)),0,_be));o=-an(a)-Math.max(0,Re(t)-s)/(l*s)}else fe(kse,r.eye,r.center),lt(i,VI,kse),o=-Re(VI)/s;return we(i,i),oe(i,i,Re(n4)),o}const kse=R();function zse(e,t,i,r){let s,n;const o=Math.cos(Ne(Bv.normalize(Pt(r)),0,_be));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):an(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):an(e/i),(n-s)*i}function NZe(e,t,i,r,s,n,o,a,l,c){const h=zse(e[2],t[2],o[3],l),p=c?zse(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;we(ji,s);const y=c?f/Math.sqrt(Math.abs(o[3]**2-Se(i,ji)**2)):f/o[3],v=m/Math.sqrt(Math.abs(o[3]**2-Se(i,r)**2));fi(n,y,v)}function Tbe(e,t,i,r,s,n,o,a,l,c){lt(n4,e,t),WG(n.up,n.eye,UI,kI,zI),WG([0,0,1],n.eye,Ng,$v,Abe),ne(i,$v),ne(r,Ng),we(i,i),oe(i,i,Re(n4)),Eee(e,we(kI,kI),we(zI,zI),we(UI,UI),Vse),Eee(t,kI,zI,UI,Bse),NZe(Vse,Bse,e,Ng,$v,s,o,a,l,c)}function FZe(e,t,i,r,s,n,o){Tc(r4,s,r),Tc(s4,o,n),Dr(SS,r4,s4),fe(t,e,i),ke(t,t,SS),pe(t,t,i)}function Sbe(e,t,i,r,s,n){Tc(r4,r,i),Tc(s4,n,s),Dr(SS,r4,s4),fe(ji,e.eye,t),ke(ji,ji,SS),e.eye=pe(ji,ji,t),fe(ji,e.center,t),ke(ji,ji,SS),e.center=pe(ji,ji,t),fe(ji,e.up,t),ke(ji,ji,SS),e.up=pe(ji,ji,t)}function UZ(e,t,i,r,s,n,o=oO.Pole,a=oO.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<oO.Tilt)}function Ebe(e,t,i,r,s,n){if(n)uR(i,r,Gse),a_(t,e,Gse);else{const o=xbe(i,r,jse,t,e[3],s);a_(t,e,cR(jse,o))}}function Cbe(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ne(k_,r),BI.copyFrom(t);for(let p=0;p<a&&_n(i,k_)>l&&(c=_n(i,k_),Tbe(i,k_,$v,Ng,SC,BI,e,s,n,o),Sbe(BI,e,Ng,SC[1],$v,SC[0]),FZe(k_,k_,e,Ng,SC[1],$v,SC[0]),h=_n(i,k_),h<c||p===0);p++)t.copyFrom(BI)}function UZe(e,t,i,r,s,n,o){UZ(i,Se(t.up,i),e[3],-Bv.normalize(Pt(s)),n,t,oO.Pole,oO.Angle)?Cbe(e,t,i,r,-Bv.normalize(Pt(s)),n,o):Ebe(e,t,i,r,n,o)}function kZe(e,t,i,r,s,n){const{eye:o}=e;WG([0,0,1],o,Ng,$v,Abe);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Se(e.center,Ng)**2/Re(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(vl(r.pan.matrix,r.pan.matrix,h,Ng),r.pan.enabled=!0,s.mode){case"pan":vl(r.pan.matrix,r.pan.matrix,p,$v),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function zZe(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=lt(je.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(vl(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(vl(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function VZe(e,t,i,r,s,n,o,a,l){UZ(e.center,Se(e.up,e.center),Re(e.center),-Bv.normalize(Pt(n)),o,t)?kZe(t,i,r,a,l,-Bv.normalize(Pt(s))):zZe(t,i,r,a,l)}const Ng=R(),$v=R(),Abe=R(),UI=R(),kI=R(),zI=R(),Vse=R(),Bse=R(),SC=st(),Gse=VE(),r4=Ee(),s4=Ee(),SS=Ee(),k_=R(),ji=R(),VI=R(),BI=new qi,n4=R(),jse=R(),kZ={origin:R(),direction:R()},Hse={origin:R(),direction:R()},qse=.6,fV=4,BZe=12,GZe=60,jZe=200;let o4=class extends Ag{constructor(){super(...arguments),this.zoomLocation=R(),this.tmpCamera=new qi,this.tmpViewDir=R(),this.tmpRayDir={origin:R(),direction:R()},this.targetOnSphere=R(),this.tmpCenter=R(),this.constraintOptions={selection:_r.ALL_EXCEPT_COLLISION,interactionType:Vt.ZOOM,interactionFactor:null,interactionStartCamera:new qi,interactionDirection:null,tiltMode:Fn.TUMBLE},this.sphere=bn()}initialize(){this.intersector=Wh(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?HZe:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ne(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:F3}}_updateCamera(e,t,i,r,s){const n=Ai(this.view.spatialReference),o=NU(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),we(jI,e.eye),oe(jI,jI,-1),jE(e,r,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(BZe,1/Math.abs(Se(jI,this.tmpRayDir.direction)))*a,jZe);if(o===ro.Horizontal){let c=qse**t;this.sphere[3]=Re(i),fe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Re(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<fV&&(p=fV,c=p/h),Math.abs(h-p)<1e-6)return;const f=Re(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=oe(GI,e.center,m/f)}oe(this.tmpViewDir,this.tmpViewDir,-c),e.eye=pe(GI,e.center,this.tmpViewDir),ps(this.view,e,this.constraintOptions),_n(i,e.center)>1e-12&&NZ(this.sphere,e,r,this.targetOnSphere)&&UZe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=qse**Math.abs(t);const h=t>0?1:-1;fe(this.tmpViewDir,i,e.eye);const p=Re(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,GZe);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,oe(this.tmpRayDir.direction,this.tmpRayDir.direction,m),pe(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let y=m*c;const v=Math.max(fV,1.01*e.nearFar[0]);if(t>0&&y<v&&(y=v,c=y/m),Math.abs(m-y)<1e-6)return;oe(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=pe(GI,e.eye,this.tmpRayDir.direction),e.center=pe(GI,e.center,this.tmpRayDir.direction)}GE(this.view,e)}};o4=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],o4);const GI=R(),jI=R(),HZe={exclude:new Set([qd])},qZe=.6,WZe=4,XZe=60,YZe=14,ZZe=200;let a4=class extends Ag{constructor(){super(...arguments),this.zoomLocation=R(),this.tmpCamera=new qi,this.tmpRayDir=R(),this.tmpCenter=R(),this.constraintOptions={selection:_r.ALL,interactionType:Vt.ZOOM,interactionFactor:null,interactionStartCamera:new qi,interactionDirection:null,tiltMode:Fn.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=Wh(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,JZe):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ne(this.zoomLocation,this.tmpCamera.center);const n=qZe**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,XZe);fe(HI,this.tmpCamera.eye,this.zoomLocation),we(HI,HI);const a=Math.max(Math.min(YZe,1/Math.abs(Se(QZe,HI)))*Math.abs(this.view.camera.position.z),ZZe);if(o=o?Math.min(o,a):a,o){const l=R();fe(l,this.zoomLocation,this.tmpCamera.eye),o<Re(l)&&(we(l,l),pe(this.zoomLocation,this.tmpCamera.eye,oe(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:F3}}_updateCamera(e,t,i){fe(this.tmpRayDir,i,e.eye);const r=Re(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(WZe,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),e.eye=fe(Wse,i,this.tmpRayDir),e.center=on(Wse,e.center,i,1-t),ps(this.view,e,this.constraintOptions))}};a4=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],a4);const Wse=R(),QZe=Ue(0,0,1),HI=R(),JZe={exclude:new Set([qd])};function KZe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function zZ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class eQe extends Uo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(KZe(i,"primary")){const r=this.view.state.isGlobal?new o4({view:this.view,mode:"animation"}):new a4({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Wr(i.x,i.y)),t.stopPropagation()}}}let l_=class extends Fb{constructor(){super(...arguments),this.startCamera=new qi,this.currentCamera=new qi}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ur.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};l_=u([P("esri.views.3d.state.controllers.InteractiveController")],l_);var oc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(oc||(oc={}));const tQe=7,mV=90;let ES=class extends l_{constructor(e){super(e),this.view=null,this.pivot=oc.CENTER,this.lastPoint=st(),this.tmpWorldUp=R(),this.tmpViewDir=R(),this.tmpRotCurPoint=st(),this.tmpTransf=Ee(),this.tmpAxis=R(),this.tmpPivotPoint=R(),this.pivotPos=R(),this.constraintOptions={selection:_r.ALL,interactionType:Vt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Fn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===oc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case oc.EYE:ne(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=Vt.LOOK_AROUND,this.constraintOptions.tiltMode=Fn.LOOK_AROUND,this.constraintOptions.selection=_r.NONE;break;case oc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||ne(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=Vt.TUMBLE,this.constraintOptions.tiltMode=Fn.TUMBLE,this.constraintOptions.selection=_r.ALL&~_r.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,iw(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=R();fe(r,this.pivotPos,i.eye);const s=Re(r);let n=Math.min(s,tQe*Math.abs(this.view.camera.position.z));const o=Ai(this.view.spatialReference),a=Wr(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=NU(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*mV,mV),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,mV);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===ro.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),we(r,r),ne(this.pivotPos,pe(this.tmpPivotPoint,i.eye,oe(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case oc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case oc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}ps(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),iw(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;fe(this.tmpViewDir,i,r);const o=Re(this.tmpViewDir),a=an(Se(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===oc.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=Ne(s+a,Ao.min,Ao.max)-a,lt(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===oc.CENTER&&(n=-n),Tc(this.tmpTransf,n,this.tmpWorldUp),vl(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),ke(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=ke(gV,e.up,this.tmpTransf),pe(gV,r,this.tmpViewDir),co(this.lastPoint,this.tmpRotCurPoint),gV}};u([d({constructOnly:!0})],ES.prototype,"view",void 0),u([d()],ES.prototype,"pivot",void 0),ES=u([P("esri.views.3d.state.controllers.RotateController")],ES);const gV=R();class yV extends Uo{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!zZ(t.data,this.pointerAction))return;const r=Wr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new ES({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let WL=class extends l_{constructor(e){super(e),this.view=null,this.pickPoint=R(),this.tmpP0=st(),this.panAxisAngle=VE(),this.tmpRayDir=R(),this.tmpRayDirPick=R(),this.targetOnSphere=R(),this.tmpRay={origin:R(),direction:R()},this.dragBeginPoint=Wr(),this.normalizedAnchorPoint=st(),this.constraintOptions={selection:_r.ALL_EXCEPT_COLLISION,interactionType:Vt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Fn.TUMBLE},this.sphere=bn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;co(this.dragBeginPoint,e),iw(this.startCamera,e,this.normalizedAnchorPoint);const t=Ai(this.view.spatialReference),i=bbe(this.intersectionHelper,this.startCamera,e,t,Q2.Ellipsoid,this.view.map.ground.opacity===0?iQe:{});if(this.navMode=NU(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===ro.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;jE(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(fe(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Re(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=Ne(gbe*r,i4[0],i4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,ybe);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,oe(this.tmpRay.direction,this.tmpRay.direction,n),pe(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===ro.Horizontal){fe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Re(this.tmpRayDir);iw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Re(this.currentCamera.center));this.currentCamera.center=oe(qI,this.currentCamera.center,n)}oe(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=pe(qI,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Gd(this.dragBeginPoint,e),ps(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(OR(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),uR(this.pickPoint,this.targetOnSphere,this.panAxisAngle),a_(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Re(this.tmpRay.direction);iw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;oe(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=pe(qI,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=pe(qI,this.currentCamera.center,this.tmpRayDir)}GE(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],WL.prototype,"view",void 0),WL=u([P("esri.views.3d.state.controllers.global.ZoomController")],WL);const qI=R(),iQe={exclude:new Set([qd])};let XL=class extends l_{constructor(e){super(e),this.view=null,this.tmpP=R(),this.tmpDir=R(),this.tmpN=R(),this.tmpP0=st(),this.tmpPoi=R(),this.tmpRayDir=R(),this.dragBeginPoint=Wr(),this.normalizedAnchorPoint=st(),this.constraintOptions={selection:_r.ALL,interactionType:Vt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:R(),tiltMode:Fn.TUMBLE},this.plane=Ei()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;co(this.dragBeginPoint,e),iw(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?rQe:{});fe(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Re(this.tmpDir);let r;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=Ne(gbe*r,i4[0],i4[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,ybe);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,oe(this.tmpDir,this.tmpDir,s),pe(this.tmpP,this.startCamera.eye,this.tmpDir),fe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&oa(this.tmpN,this.tmpN),R2(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;LZe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ne(this.tmpPoi,this.currentCamera.center),iw(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);co(this.normalizedAnchorPoint,this.tmpP0),fe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Re(this.tmpRayDir);let r=i*(1-t);ne(this.constraintOptions.interactionDirection,this.tmpRayDir),oe(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=pe(z_,this.currentCamera.eye,this.tmpRayDir),on(z_,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?z_[2]=Math.max(this.startCamera.center[2],z_[2]):z_[2]=Math.min(this.startCamera.center[2],z_[2]),this.currentCamera.center=z_,this.constraintOptions.interactionFactor=Gd(this.dragBeginPoint,e),ps(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],XL.prototype,"view",void 0),XL=u([P("esri.views.3d.state.controllers.local.ZoomController")],XL);const z_=R(),rQe={exclude:new Set([qd])};class sQe extends Uo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!zZ(t.data,this.pointerAction))return;const r=Wr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new WL({view:this.view}):this.cameraController=new XL({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const nQe=R(),WI=R();function VZ(){return{direction:R(),up:R()}}function Mbe(e,t,i,r,s){let n=we(nQe,e),o=Se(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Se(t,r)),o<.99?(ne(n,t),a&&oe(n,n,-1)):n=null);let l=0;if(n){oe(WI,r,Se(r,n)),fe(n,n,WI);const h=Se(n,s)/(Re(n)*Re(s));lt(WI,n,s),l=(Se(WI,r)>0?1:-1)*Al(an(h))}const c=Al(an(-Se(r,e)/Re(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const Obe=Ue(0,1,0),Rbe=Ue(0,0,1),EC=Ee(),bm=R(),wm=R();function Pbe(e,t,i,r=VZ()){const{direction:s,up:n}=r;return Ame(EC,-Pt(t)),C2(EC,EC,Pt(i)),ke(s,Rbe,EC),oe(s,s,-1),ke(n,Obe,EC),r}function oQe(e,t,i,r){return Mbe(t,i,r,Rbe,Obe)}function aQe(e,t,i,r){const s=Pbe(e,i,r),n=R();return oe(n,s.direction,-t),pe(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function lQe(e){return Al(e)}function cQe(e){return Pt(e)}function Ibe(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Gr(t,bm,n),Gr(t,wm,n),bm[0]-=i/2,wm[0]+=i/2,bm[1]-=r/2,wm[1]+=r/2,nn(bm,n,bm,o),nn(wm,n,wm,o),s?(s.xmin=bm[0],s.ymin=bm[1],s.xmax=wm[0],s.ymax=wm[1],s.spatialReference=o):s=new Xt(bm[0],bm[1],wm[0],wm[1],o),s}const uQe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Pbe,directionToHeadingTilt:oQe,eyeForCenterWithHeadingTilt:aQe,lookAtTiltToEyeTilt:lQe,eyeTiltToLookAtTilt:cQe,toExtent:Ibe},Symbol.toStringTag,{value:"Module"})),$be=Ue(0,0,1),Dbe=we(R(),Ue(1,1,1)),hQe=new Vv(-180,180),CC=Ee(),H0=R(),Ox=R();function Lbe(e,t,i,r=VZ()){lt(H0,e,$be),Se(H0,H0)===0&&lt(H0,e,Dbe),Tc(CC,-Pt(t),e),vl(CC,CC,-Pt(i),H0);const{up:s,direction:n}=r;return lt(s,H0,e),we(s,s),ke(s,s,CC),we(n,e),oa(n,n),ke(n,n,CC),r}function dQe(e,t,i,r){const s=H0,n=Ox;return we(s,e),lt(Ox,s,$be),Se(Ox,Ox)===0&&lt(Ox,s,Dbe),lt(n,Ox,s),Mbe(t,i,r,s,n)}function pQe(e,t,i,r){const s={eye:R(),up:null,tilt:r,heading:i},n=H0;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Pt(i),l=Pt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Re(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const re=m/p,$=dp(o/re),U=Math.PI-l-$;y=re*Math.sin(U)}const v=f*o,b=o*o*(p*p),w=h*h*b,S=y-v,T=S*S,E=w*(w+T-n[1]*n[1]);if(E<0)return oe(s.eye,n,y/m),s.tilt=0,s;const C=Math.sqrt(E),A=n[1]*S,I=w+T;let L;if(L=h>0?-C+A:C+A,Math.abs(I)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):oe(s.eye,n,y/m),s.tilt=0,vV(s.eye),_V(s,e);s.eye[1]=L/I;const D=c*c*b,k=p*o,z=h*k*s.eye[1],V=s.eye[1]*s.eye[1],X=1-V,Y=Math.sqrt(X),le=w*V+D-2*z*Y*S+X*T;return Math.abs(le)<1e-8?(oe(s.eye,n,y/m),s.tilt=0,vV(s.eye),_V(s,e)):(s.eye[0]=(X*(y*n[0]-v*n[0])-k*Y*(n[0]*s.eye[1]*h+n[2]*c))/le,s.eye[2]=(X*(y*n[2]-v*n[2])-k*Y*(n[2]*s.eye[1]*h-n[0]*c))/le,oe(s.eye,s.eye,y),vV(s.eye),_V(s,e))}function vV(e){const t=e[1];e[1]=-e[2],e[2]=t}function _V(e,t){const i=Lbe(t,e.heading,e.tilt);return e.up=i.up,e}function fQe(e,t,i){const r=Re(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=dp(i/(s/Math.sin(e)));return Al(e-n)}function mQe(e,t,i){const r=Pt(e),s=Re(t);return dp(i/(s/Math.sin(r)))+r}function Nbe(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=Ai(e.spatialReference).radius,p=t.longitude,f=mXe(c,i,h)/2;n=p-f,o=p+f;const m=Pt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),v=(y+1)*Math.tan(r/h/2),b=v*v;function w(T){const E=Math.PI/2;return(T=BPe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+b))),l=a+r/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Al(a),-90),l=Math.min(Al(l),90),o=hQe.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new Xt(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&Pg(s,!1,s),s}const gQe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Lbe,directionToHeadingTilt:dQe,eyeForCenterWithHeadingTilt:pQe,lookAtTiltToEyeTilt:fQe,eyeTiltToLookAtTilt:mQe,toExtent:Nbe},Symbol.toStringTag,{value:"Module"}));function l4(e){return e.type==="point"}class Fbe{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function Ube(e){return"array"in e}function If(e,t,i="ground"){if(l4(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(Ube(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,_t(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function c4(e,t){return e!=null&&(t==null||(t===Ge.Local?!e.isGeographic||e.isWGS84||e.wkid===Rh.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Rh.CGCS2000||e.wkid===Rh.GCSMARS2000||e.wkid===Rh.GCSMARS2000_SPHERE||e.wkid===Rh.GCSMOON2000))}const kbe=de.getLogger("esri.views.3d.support.cameraUtils"),zbe=39.37,Vbe=96,TH=1,yQe=8,vQe=5,Bbe=1,Xse=R(),XI=R(),_Qe={heading:0,tilt:0},yg=new qe,bQe=new Vv(-20037508342788905e-9,20037508342788905e-9),wQe=new Vv(-180,180);var $o;function U3(e){return e.spatialReference||Ze.WGS84}function HE(e){return e.viewingMode==="global"?gQe:uQe}function xQe(e,t,i,r,s){return HE(e).headingTiltToDirectionUp(t,i,r,s)}function hg(e,t){if(M(t))return null;const i=e.renderSpatialReference,r=HE(e).headingTiltToDirectionUp,s=R();if(!Gr(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);oe(n.direction,n.direction,e.state.camera.distance),pe(n.direction,n.direction,s);const o=cx(e,s,n.direction,n.up);return o.fov=Pt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})($o||($o={}));const Rx=R();function J2(e,t,i){const r=e.renderSpatialReference,s=FU(e,t.eye,t.viewForward,t.up,_Qe);let n=U3(e);return nn(t.eye,r,Rx,n)||(n=Ze.WGS84,nn(t.eye,r,Rx,n)),M(i)?new wc(new qe(Rx,n),s.heading,s.tilt,Al(t.fov)):(i.position.x=Rx[0],i.position.y=Rx[1],i.position.z=Rx[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Al(t.fov),i)}function BZ(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===Ge.Global&&i!=null&&(t*=Math.cos(Pt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(Vbe*zbe/t)/Math.tan(r.fovX/2)}function Uw(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=Vbe*zbe/(n/s);return e.renderCoordsHelper.viewingMode===Ge.Global&&(o/=Math.cos(Pt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function Gbe(e,t,i,r,s,n){return jbe(e,t,BZ(e,i,t.latitude),r,s,n)}function jbe(e,t,i,r,s,n){if(rw(n)){const a=new qE(n.signal);return RR(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=h4(e,l,r.fov);if(!M(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=RR(e,r.heading,r.tilt,t,i,s);return h4(e,o,r.fov,n)}function FU(e,t,i,r,s){return HE(e).directionToHeadingTilt(t,i,r,s)}function TQe(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,yg,e.spatialReference)&&_t(If(e.elevationProvider,yg),0)>yg.z-Bbe)}async function SQe(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,yg,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(yg.x,yg.y,yg.z,yg.spatialReference,"ground",i);return _t(r,0)>yg.z-Bbe}async function EQe(e,t,i){const r=R();if(t)if(t instanceof qe){if(Gr(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else ne(r,t);else ne(r,e.state.camera.center);return r}function CQe(e,t){const i=R();if(t&&t instanceof qe){if(Gr(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=If(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else ne(i,t||e.state.camera.center);return i}function RR(e,t,i,r,s,n,o){const a=r&&r instanceof qe?r:null;if(rw(o))return EQe(e,r,o.signal).then(c=>{SH(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=CQe(e,r);return SH(e,t,i,a,l,s,n,o)}function SH(e,t,i,r,s,n,o,a){if(M(r)){const p=e.renderSpatialReference;if(r=Wv(s,p,U3(e)),M(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=OQe(e,t,i,s,n,o),c=(0,HE(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===$o.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=Hbe(e,s,n,PQe(e,n,i,s));return o=i-m<1?$o.LOCKED:$o.ADJUST,SH(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(TQe(e,c.eye))return p();if(rw(a))return SQe(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:rs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||rw(a)?{center:R(),eye:R(),up:R(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=rs(s),h.heading=c.heading,h.tilt=c.tilt,rw(a)&&a.resolver.resolve(h),h}function aO(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!c4(t.spatialReference,Ge.Global))return rw(n)&&n.resolver.reject(),null;const w=new qe(t.xmin,t.ymin,t.spatialReference),S=new qe(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?wQe:bQe;a=new qe({x:T.center(w.x,S.x),y:(S.y+w.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Ai(t.spatialReference),C=fXe(a,w,S);l=C.lon,c=C.lat,T.diff(w.x,S.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const w=_t(e.renderSpatialReference,t.spatialReference);w.equals(t.spatialReference)||(t=OE(t,w)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new qe({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:w})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),y=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*m,.5*h*y)/TH;if(rw(n)){const w=new qE(n.signal);return RR(e,i,r,a,v,s,w),void w.resolver.promise.then(S=>{const T=h4(e,S,e.camera.fov);if(!M(T))return n.resolver.resolve(T);n.resolver.reject()},S=>n.resolver.reject(S))}const b=RR(e,i,r,a,v,s);return h4(e,b,e.camera.fov,n)}function AQe(e,t,i){const r=e.renderSpatialReference,s=Wv(i,r,U3(e));if(M(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=yW(t.eye,i),l=2*a*n*TH,c=2*a*o*TH;return e.viewingMode==="global"?Nbe(e,s,l,c):Ibe(e,s,l,c)}function MQe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>yQe)return!0;const s=e.renderSpatialReference,n=U3(e),o=Wv(t,s,n),a=Wv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(M(o)||M(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>vQe}function OQe(e,t,i,r,s,n){let o=0;return n===$o.ADJUST&&MQe(e,r,s)?(t=0,o=RQe(e,s,i,r)):o=GZ(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=Hbe(e,r,s,o)}}const u4=.7;function RQe(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-u4)+s.max*u4,o=GZ(e,r,t,i);return Math.min(o,n)}function PQe(e,t,i,r){const s=e.state.constraints.tilt(t);let n=GZ(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-u4)+n*u4}function Hbe(e,t,i,r){return HE(e).lookAtTiltToEyeTilt(r,t,i)}function GZ(e,t,i,r){return HE(e).eyeTiltToLookAtTilt(r,t,i)}function h4(e,t,i,r){if(M(t))return null;const s=e.renderSpatialReference,n=Wv(t.eye,s,U3(e));return M(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new wc(n,t.heading,t.tilt,i)}function qbe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);kbe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Wbe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);kbe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function IQe(e,t){return e.spatialReference?Yge(t,e.spatialReference):void 0}function Xbe(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ze.WGS84;return t instanceof wc?(s=t.position.latitude,Gr(t.position,Xse,r),Gr(i,XI,r),n=ur(Xse,XI)):(nn(t.center,r,XI,o),s=XI[1],n=t.distance),Uw(e,n,s)}class qE{constructor(t){this.signal=t,this.resolver=hp()}}function rw(e){return e&&"resolver"in e}function ad(e){let t=e*e;return e<0&&(t*=-1),t}function Yse(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=ad(s.axes[0]),r.translation[1]=ad(s.axes[1]),r.translation[2]=ad(s.buttons[7])-ad(s.buttons[6]),r.heading=ad(s.axes[2]),r.tilt=ad(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*ad(s.axes[0]),r.translation[1]=1.2*ad(s.axes[1]),r.translation[2]=2*-ad(s.axes[2]),r.heading=1.2*ad(s.axes[5]),r.tilt=1.2*ad(s.axes[3])),r.tilt*=o,oe(r.translation,r.translation,a),r}function Zse(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function bV(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let K0=class extends l_{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new qi,this.constraintOptions={selection:_r.ALL,interactionType:Vt.NONE,interactionStartCamera:new qi,interactionFactor:0,interactionDirection:null,tiltMode:Fn.LOOK_AROUND}}handleEventGamepad(e){const t=Yse(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||bV(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,Zse(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=Zse(this.keysButtonState,this.transformation);bV(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,V_),this._applyDisabledMovementTypes(V_),this._applyPan(V_.pan),this._applyRotate(V_.rotate),this._applyZoom(V_.zoom),this._applyAscend(V_.ascend),this.constraintOptions.interactionType=Vt.NONE,this.constraintOptions.selection=_r.COLLISION,ps(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;fe(Xa,t.center,t.eye),ke(Xa,Xa,e.matrix),t.center=pe(Xa,Xa,t.eye),t.up=ke(Xa,t.up,e.matrix),this.constraintOptions.interactionType=Vt.LOOK_AROUND,this.constraintOptions.selection=_r.ALL_EXCEPT_COLLISION,ps(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=ke(Xa,t.eye,e.matrix),t.center=ke(Xa,t.center,e.matrix),this.view.state.isGlobal&&(t.up=ke(Xa,t.up,e.matrix)),this.constraintOptions.interactionType=Vt.PAN,this.constraintOptions.selection=_r.ALL,ps(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=pe(Xa,this.currentCamera.eye,oe(je.get(),t,e)),ne(AC,t),oa(AC,AC),this.constraintOptions.interactionDirection=AC,this.constraintOptions.interactionType=Vt.ZOOM,this.constraintOptions.selection=_r.ALL_EXCEPT_COLLISION,ps(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,je.get());if(this.constraintOptions.interactionDirection=ne(AC,t),this.view.state.isGlobal){const i=Re(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=oe(Xa,this.currentCamera.eye,r),this.currentCamera.center=oe(Xa,this.currentCamera.center,r)}else{const i=oe(je.get(),t,e);this.currentCamera.eye=pe(Xa,this.currentCamera.eye,i),this.currentCamera.center=pe(Xa,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=Vt.ASCEND,this.constraintOptions.selection=_r.COLLISION,ps(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=_r.ALL_EXCEPT_COLLISION,ps(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){kQe(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Xa)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=ie(je.get(),s[0],s[1],0);we(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=oe(je.get(),r,l);ca(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=oe(je.get(),a,y);ca(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(vl(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,je.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=o_(this.view.renderCoordsHelper,t.center,t.eye),m=Ne(f+p,Ao.min,Ao.max)-f;m&&(vl(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=lt(je.get(),s,r);we(a,a),oa(a,a),VZe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(V_.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(vl(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(vl(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=Ai(this.view.spatialReference),s=qL(Ao.min,t.origin,i,r);let n=0,o=0;const a=je.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=o_(this.view.renderCoordsHelper,a,t.origin);n=qL(l,t.origin,i,r),o=qL(Ao.max,t.origin,i,r)}else{RE(G5(j5,i+r.radius),t,a);const l=an(-Se(t.direction,we(a,a)));n=Nse(l,t.origin,i,r),o=Nse(Ao.max,t.origin,i,r)}return Ne(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=xQe(this.view,t,0,Ybe,UQe),n=i.intersectManifoldClosestSilhouette(Du(t,s),e,je.get()),o=ur(t,n),a=i.intersectManifoldClosestSilhouette(Du(t,ny(je.get(),t,r.center)),e,je.get()),l=ur(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,je.get());if(s){const o=fe(je.get(),e,n),a=Re(o);oe(o,o,1/a);const l=we(je.get(),e),c=an(Se(l,o));return a*Math.sin(Math.min(DQe,c))}{const o=ne(je.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),ur(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:LQe}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+Ai(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=je.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=Qse*r.width,h=Qse*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:Ne(m*h,NQe,FQe)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Wf(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Wf(e.rotate.matrix))}static activatesFor(e,t){const i=Yse(t,e.navigation.gamepad,$Qe);return!(t.action==="end"||bV(i))}};u([d({constructOnly:!0})],K0.prototype,"view",void 0),u([d({constructOnly:!0})],K0.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],K0.prototype,"disableMovements",void 0),K0=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],K0);const $Qe={translation:[0,0,0],heading:0,tilt:0,zoom:0},Ybe=80,DQe=Pt(Ybe),Qse=.75,LQe=5,NQe=Pt(30),FQe=Pt(80),V_={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ee()},rotate:{enabled:!1,matrix:Ee()}},Xa=R(),AC=R(),UQe=VZ();function kQe(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Wf(e.pan.matrix),e.rotate.enabled=!1,Wf(e.rotate.matrix)}class zQe extends Uo{constructor(t){super(!0),this.view=t,this.watchHandles=new si,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([ae(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Ft),ae(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||K0.activatesFor(this.view,t.data)){if(!r){const s=new K0({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var ec;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(ec||(ec={}));class VQe extends Uo{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ge.Local},this.keyToNumber={[i.left]:ec.LEFT,[i.right]:ec.RIGHT,[i.forward]:ec.FORWARD,[i.backward]:ec.BACKWARD,[i.up]:ec.UP,[i.down]:ec.DOWN,[i.headingLeft]:ec.HEADINGLEFT,[i.headingRight]:ec.HEADINGRIGHT,[i.tiltUp]:ec.TILTUP,[i.tiltDown]:ec.TILTDOWN,[i.zoomIn]:ec.ZOOMIN,[i.zoomOut]:ec.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new K0({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class BQe extends Uo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new o4({view:this.view,mode:"interaction"}):new a4({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Wr(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class d4{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let Dv=class extends MR{constructor(e){super(e),this.view=null,this.beginCamera=new qi,this.elapsedTimeSec=0,this.constraintOptions={selection:_r.ALL,interactionType:Vt.PAN,interactionFactor:0,interactionStartCamera:new qi,interactionDirection:null,tiltMode:Fn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new F2}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),ps(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],Dv.prototype,"view",void 0),Dv=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Dv);let lO=class extends Dv{constructor(e){super(e),this.interactionType=Vt.PAN,this.tmpPan=R()}momentumStep(e,t){const i=this.momentum.value(e);oe(this.tmpPan,this.momentum.direction,i),t.eye=fe(Jse,t.eye,this.tmpPan),t.center=fe(Jse,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],lO.prototype,"momentum",void 0),lO=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],lO);const Jse=R(),GQe=R(),YI=R();let YL=class extends Dv{constructor(e){super(e),this.interactionType=Vt.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);ne(YI,t.eye),we(YI,YI),lt(this.momentum.axis2,YI,this.momentum.axis1),Sbe(t,GQe,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],YL.prototype,"momentum",void 0),YL=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],YL);let xb=class extends Dv{constructor(e){super(e),this.interactionType=Vt.TUMBLE}set center(e){this._set("center",rs(e))}set axis(e){this._set("axis",rs(e))}momentumStep(e,t){const i=this.momentum.value(e);a_(t,this.center,cR(this.axis,i))}};u([d({constructOnly:!0})],xb.prototype,"momentum",void 0),u([d({constructOnly:!0})],xb.prototype,"center",null),u([d({constructOnly:!0})],xb.prototype,"axis",null),xb=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],xb);let CS=class extends Dv{constructor(e){super(e),this.interactionType=Vt.ZOOM,this.constraintOptions.interactionDirection=R()}set zoomCenter(e){this._set("zoomCenter",rs(e))}momentumStep(e,t){ne(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);FZ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=ny(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],CS.prototype,"momentum",void 0),u([d({constructOnly:!0})],CS.prototype,"zoomCenter",null),CS=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],CS);let Y1=class extends Dv{constructor(e){super(e),this.interactionType=Vt.ZOOM,this.radius=0,this.tmpSceneCenter=R(),this.tmpZoomAxisAngle=VE(),this.sphere=bn()}set screenCenter(e){this._set("screenCenter",Wr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",rs(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);vbe(this.sphere,t,i),this.constraintOptions.interactionType=Vt.ZOOM,ps(this.view,t,this.constraintOptions),OR(this.sphere,t,this.screenCenter,this.tmpSceneCenter),uR(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),a_(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=Vt.PAN}};u([d({constructOnly:!0})],Y1.prototype,"momentum",void 0),u([d({constructOnly:!0})],Y1.prototype,"screenCenter",null),u([d({constructOnly:!0})],Y1.prototype,"sceneCenter",null),u([d({constructOnly:!0})],Y1.prototype,"radius",void 0),Y1=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Y1);class jd{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class UU{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class jQe extends UU{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class Zbe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new jd(.6),this.screen=[new jd(.4),new jd(.4)],this.scene=[new jd(.6),new jd(.6),new jd(.6)],this.tmpDirection=R()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){ie(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Re(this.tmpDirection);s>0&&oe(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new jQe(t,i,r,n,this.tmpDirection)}}class Kse{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const ene=1e-5;class HQe extends UU{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class qQe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=R(),this.tmpAxis2=R(),this.tmpAngles=st(),this.time=new jd(.3),this.screen=[new jd(.4),new jd(.4)],this.angle1=new Kse(.6),this.angle2=new Kse(.6),this.axis1=R(),this.axis2=R(),this.lastScene=R()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=xbe(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),Fa(this.tmpAxis2)<ene?a=0:we(this.axis1,this.tmpAxis2),this.angle1.update(a),ne(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;Tbe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),Fa(this.tmpAxis2)<ene?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),ne(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new HQe(t,i,r,s,this.axis1,n,this.axis2)}}class Qbe{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new jd(.8),this.time=new jd(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=Ne(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new UU(t,i,r)}}class Jbe extends Qbe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class WQe extends UU{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class Kbe extends Qbe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new WQe(t,i,r)}}let ZL=class extends l_{constructor(e){super(e),this.view=null,this.smoothRotation=new d4(.05),this.rotationAxis=R(),this.panningPlane=Ei(),this.smoothScaling=new d4(.05),this.zoomCenterScreen=Wr(),this.zoomMomentumEstimator=new Kbe,this.rotationMomentumEstimator=new Jbe,this.panSphericalMomentumEstimator=new qQe,this.panPlanarMomentumEstimator=new Zbe,this.adjustedSphere=bn(),this.tmp3d=R(),this.tmpScreenPointArray=Wr(),this.beginScreenPoint=Wr(),this.beginScenePoint=R(),this.screenPickPoint=Wr(),this.navMode=ro.Horizontal,this.tmpInteractionDirection=R(),this.constraintOptions={selection:_r.ALL,interactionType:Vt.NONE,interactionFactor:0,interactionStartCamera:new qi,interactionDirection:null,tiltMode:Fn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Bv.normalize(Pt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),vg(e.center,this.screenPickPoint),co(this.beginScreenPoint,this.screenPickPoint);const i=Ai(this.view.spatialReference),r=bbe(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,Q2.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,ne(this.beginScenePoint,this.scenePickPoint),this.navMode=NU(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===ro.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=oa(this.tmp3d,this.startCamera.viewForward);R2(this.scenePickPoint,t,this.panningPlane);const i=Wr(this.screenPickPoint[0],0),r=R(),s=Re(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],OR(this.adjustedSphere,this.startCamera,i,r);const n=Ro();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&R2(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=R(),c=R(),h=R(),p=80,f=5,m=50;fe(l,this.scenePickPoint,this.currentCamera.eye);const y=Re(l);we(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),m),b=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let w=b?Math.min(b,v):v;w=a?Math.min(w,y):w,ne(h,pe(c,this.currentCamera.eye,oe(c,l,w))),this.panningPlane[3]=-Se(this.panningPlane,h),this.startCamera.center=pe(c,this.startCamera.eye,oe(c,this.startCamera.viewForward,w));const S=vg(e.center,this.tmpScreenPointArray);xH(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===ro.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===ro.Horizontal?new Y1({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new CS({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new xb({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===ro.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new YL({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new lO({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),vbe(this.sphere,this.currentCamera,this.smoothScaling.value),vg(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=Vt.ZOOM,this.constraintOptions.interactionFactor=Gd(e.radius-this.beginRadius),ps(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=vg(e.center,this.tmpScreenPointArray);OR(this.sphere,this.currentCamera,t,this.tmp3d),UZ(this.beginScenePoint,Se(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Cbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Ebe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=Vt.PAN,this.constraintOptions.interactionFactor=Gd(this.screenPickPoint,t),ps(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||oa(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+wH(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),a_(this.currentCamera,this.sphere,cR(this.rotationAxis,s)),this.constraintOptions.interactionType=Vt.TUMBLE,this.constraintOptions.interactionFactor=Gd(e.radius*i),ps(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=vg(e.center,this.tmpScreenPointArray);xH(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(wbe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=Vt.PAN,this.constraintOptions.interactionFactor=Gd(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),ps(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),FZ(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=Vt.ZOOM,this.constraintOptions.interactionFactor=Gd(e.radius-this.beginRadius),ps(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ne(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||oa(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=wH(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),a_(this.currentCamera,this.sphere,cR(this.rotationAxis,n)),this.constraintOptions.interactionType=Vt.TUMBLE,this.constraintOptions.interactionFactor=Gd(e.radius*n),ps(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],ZL.prototype,"view",void 0),ZL=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],ZL);const tne=Ue(0,0,1),XQe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},YQe=80;let QL=class extends l_{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new d4(.05),this.scalingValueSmooth=new d4(.05),this.planeHorizontal=Ei(),this.planeVertical=Ei(),this.rotationMomentumEstimator=new Jbe,this.panMomentumEstimator=new Zbe(300,12,.9),this.zoomMomentumEstimator=new Kbe,this.beginCenter=R(),this.tmpPoints=[],this.beginCenterScreen=Wr(),this.tmpCentroid3d=R(),this.tmpCentroid2d=Wr(),this.tmp2d=Wr(),this.constraintOptions={selection:_r.ALL,interactionType:Vt.NONE,interactionFactor:0,interactionStartCamera:new qi,interactionDirection:null,tiltMode:Fn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),vg(e.center,this.beginCenterScreen),Rge(tne,0,this.planeHorizontal);const i=R(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=R();oa(s,this.startCamera.viewForward);const n=R();ne(n,tne);const o=Se(s,n),a=dp(o<0?-o:o);if(this.panMode=a>=XQe.ANGLE_THRESHOLD?ro.Horizontal:ro.Vertical,jG(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||HG(this.planeHorizontal,this.planeHorizontal),this.panMode===ro.Vertical){oe(n,n,o),fe(this.planeVertical,s,n),we(this.planeVertical,this.planeVertical),jG(this.planeVertical,this.planeVertical,i);const l=R(),c=R(),h=R();fe(l,i,this.currentCamera.eye);const p=Re(l);we(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,YQe);let y=m?Math.min(m,f):f;y=r?Math.min(y,p):y,ne(h,pe(c,this.currentCamera.eye,oe(c,l,y))),this.planeVertical[3]=-Se(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),dV(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),dV(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===ro.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),FZ(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=Vt.ZOOM,this.constraintOptions.interactionFactor=Gd(Math.abs(e.radius-this.beginRadius)),ps(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),dV(this.tmpPoints,this.tmpCentroid3d),vg(e.center,this.tmpCentroid2d),wbe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=Vt.PAN,this.constraintOptions.interactionFactor=Gd(this.beginCenterScreen,this.tmpCentroid2d),ps(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+wH(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),a_(this.currentCamera,n,cR(s,c)),this.constraintOptions.interactionType=Vt.TUMBLE,this.constraintOptions.interactionFactor=Gd(Math.abs(e.radius*c)),ps(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new CS({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new xb({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new lO({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=R()),xH(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],QL.prototype,"view",void 0),QL=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],QL);class ine extends Uo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!zZ(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new ZL({view:this.view}):new QL({view:this.view})}}class ZQe extends Uo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class ewe extends Uo{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class QQe extends ewe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class JQe extends ewe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class KQe extends Uo{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=Wr(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new ES({view:this.view,pivot:oc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function rne(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>iJe(i,e.axisThreshold))}:{buttons:[],axes:[]}}function eJe(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function tJe(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function iJe(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class rJe{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,rne(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new jY(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=lw({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=rne(n),l=r||tJe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||eJe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const sne=he("trident"),nne=he("edge"),sJe=he("chrome"),nJe=he("ff"),oJe=he("safari"),Px={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class kU{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new rJe(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(wV[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&wV[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(wV[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Px.touchNone:Px.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Px.touchPan:Px.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Px.touchNone),this._element.classList.remove(Px.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=I_e(this._element,t);return kU.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=SGe(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(sne||nne)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}sne||nne?r*=.7:sJe||oJe?r*=.6:nJe&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}kU.test={disableSubpixelCoordinates:!1};const wV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class aJe extends Uo{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function twe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function lJe(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function cJe(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:pp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[C,A]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(C*C+A*A)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let i=0,r=0;for(let T=0;T<e.length;T++)i+=e[T].x,r+=e[T].y;i/=e.length,r/=e.length;const s=e.map(T=>T.x-i),n=e.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],C=n[T],A=E*E,I=C*C;o+=A,a+=I,l+=E*C,c+=A*E,h+=I*C,p+=E*I,f+=C*A}const m=.5*(c+p),y=.5*(h+f),v=o*a-l*l,b=(m*a-y*l)/v,w=(o*y-l*m)/v,S=pp(b+i,w+r);return{radius:Math.sqrt(b*b+w*w+(o+a)/e.length),center:S}}class uJe extends Uo{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:hJe(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=ZI(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=JL(s,iwe(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=ZI(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=ZI(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=JL(r,i)-t,r.lastAngle=JL(r,i)-t})}_emitEvent(t,i,r){const s=ZI(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function iwe(e){const t=[];return e.forEach(i=>{t.push(pp(i.event.x,i.event.y))}),cJe(t)}function ZI(e){const t=iwe(e);let i=0;return e.forEach(r=>{let s=JL(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function hJe(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function JL(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var one;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(one||(one={}));const _v={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class dJe extends Uo{constructor(t=_v.maximumDoubleClickDelay,i=_v.maximumDoubleClickDistance,r=_v.maximumDoubleTouchDelay,s=_v.maximumDoubleTouchDistance,n=s5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=sn(t.doubleClickTimeout))}get hasPendingInputs(){return Js(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;twe(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class pJe extends Uo{constructor(t=_v.maximumDoubleClickDelay,i=_v.maximumDoubleClickDistance,r=_v.maximumDoubleTouchDelay,s=_v.maximumDoubleTouchDistance,n=s5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;twe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const MC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class fJe extends Uo{constructor(t=MC.maximumClickDelay,i=MC.movementUntilMouseDrag,r=MC.movementUntilPenDrag,s=MC.movementUntilTouchDrag,n=MC.holdDelay,o=s5){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):lJe(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class mJe{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class gJe extends Uo{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new mJe({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(v=>{r=Math.max(r,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let of=class extends Ae{constructor(){super(...arguments),this._handles=new si}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new kU(this.view.surface,e.input);const t=[new pJe,new fJe,new dJe,new uJe(this.view.navigation),new gJe],i=new T0({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new aJe],Rv.INTERNAL),this._modeDragPan=new ine(e,"primary"),this._modeDragRotate=new yV(e,"secondary",oc.CENTER),this._modeDragZoom=new sQe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new ZQe(e),new eQe(e),new zQe(e),new VQe(e,r.pan),new BQe(e),new JQe(e,r.resetTilt),new QQe(e,r.resetHeading),new yV(e,"primary",oc.EYE,[r.lookAround]),new yV(e,"secondary",oc.CENTER,[r.lookAround]),new ine(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new KQe(e)],Rv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ae(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Ft))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=EH.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],of.prototype,"view",void 0),u([d({value:"pan"})],of.prototype,"primaryDragAction",null),u([d({value:"default"})],of.prototype,"mode",null),u([d({readOnly:!0})],of.prototype,"hasPendingInputs",null),u([d()],of.prototype,"latestPointerType",null),u([d()],of.prototype,"latestPointerLocation",null),u([d()],of.prototype,"_inputManager",void 0),of=u([P("esri.views.3d.input.SceneInputManager")],of);const EH=new Map,xV=new Map,TV=new Map;xV.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),xV.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),TV.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),TV.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),EH.set("default",xV),EH.set("pro",TV);const yJe=of;let ls=class extends Ae{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],ls.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],ls.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],ls.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],ls.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],ls.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],ls.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],ls.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],ls.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],ls.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],ls.prototype,"SHOW_POI",void 0),u([d()],ls.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],ls.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],ls.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],ls.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],ls.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],ls.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],ls.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],ls.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],ls.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],ls.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],ls.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],ls.prototype,"LINE_WIREFRAMES",void 0),ls=u([P("esri.views.3d.support.DebugFlags")],ls);const Wi=new ls;let ru,ZS,CH=!1,AH=!1,MH=!1,OH=!1,cO=null;function vJe(e,t){if(!AH||!ZS)return;rwe();const i=ZS;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),swe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function _Je(e){MH=Wi.DECONFLICTOR_SHOW_VISIBLE,OH=Wi.DECONFLICTOR_SHOW_INVISIBLE,CH=MH||OH,AH=Wi.DECONFLICTOR_SHOW_GRID,cO=null,CH||AH?cO=()=>bJe(e):ru&&(ru.parentElement.removeChild(ru),ru=null)}function rwe(){cO&&(cO(),cO=null)}function bJe(e){ru==null&&(ru=document.createElement("canvas"),ru.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(ru));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;ru.setAttribute("width",`${o}px`),ru.setAttribute("height",`${a}px`),ru.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),ZS=ru.getContext("2d"),ZS.clearRect(0,0,s,n),ZS.font="12px Arial"}function swe(e,t,i,r,s){rwe();const n=ru.height,o=ZS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function wJe(e,t){CH&&(t&&MH||!t&&OH)&&swe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var eo,yu;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(eo||(eo={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(yu||(yu={}));function nwe(e,t){return new zU(e,cwe,t)}function xJe(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=cwe;return new zU(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:SV.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:SV.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:SV.minPixelSize},t)}function TJe(e){return Math.abs(e*e*e)}function owe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return OC.scale=Math.min(r.divisor/(t-r.offset),1),OC.factor=TJe(e),OC.minPixelSize=r.minPixelSize,OC.paddingPixels=s,OC}function awe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function jZ(e,t){return Math.max(Zt(e*t.scale,e,t.factor),awe(e,t))}function SJe(e,t,i){const r=owe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,jZ(1,r)}function ane(e,t,i,r){r.scale=SJe(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function lwe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,awe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function EJe(e,t,i,r){return jZ(e,owe(t,i,r))}class zU{constructor(t,i,r,s=CJe(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===Ge.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new zU(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),v=m/Math.cos(y),b=y+a*n*h,w=(v-f*(m/Math.cos(b)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=w,r.divisor=v-w,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=lne){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=lne){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Ne((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=Zt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Zt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const cwe={curvatureDependent:{min:{curvature:Pt(10),tiltAngle:Pt(12),scaleFallOffFactor:.5},max:{curvature:Pt(70),tiltAngle:Pt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},SV={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function CJe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const OC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},lne={tiltAngle:0,scaleFallOffFactor:0};function AJe(e){return e instanceof Float32Array&&e.length>=16}function MJe(e){return Array.isArray(e)&&e.length>=16}function OJe(e){return AJe(e)||MJe(e)}var K;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(K||(K={}));function HZ(e){e.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function RJe(e){e.uniforms.add(new oi("screenSizePerspective",t=>uwe(t.screenSizePerspective)))}function VU(e){e.uniforms.add(new oi("screenSizePerspectiveAlignment",t=>uwe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function uwe(e){return Ji(PJe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const PJe=qt();class RH extends Qr{constructor(t,i){super(t,"mat4",zi.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function Zf(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",No):e.uniforms.add(new Va("cameraPosition",(i,r)=>ie(hwe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Ou(e,t){if(e.vertex.uniforms.add(new xr("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>ie(hwe,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new xr("view",(n,o)=>ca(cne,o.camera.viewMatrix,r(n,o))));const s=new Tt("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new RH("view",(r,s)=>ca(cne,s.camera.viewMatrix,r.origin)));const i=new Va("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const cne=b3(),hwe=R();function dwe(e,t){const i=e.vertex;t.hasVerticalOffset?(pwe(i),t.hasScreenSizePerspective&&(e.include(HZ),VU(i),Zf(e.vertex,t)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const IJe=qt();function pwe(e){e.uniforms.add(new oi("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Ji(IJe,n*a,o,r,s)}))}var _h;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(_h||(_h={}));var yl;function fwe(e,t){e.include(HZ),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.NORMAL,"vec3"),e.attributes.add(O.AUXPOS1,"vec4");const i=e.vertex;Ou(e,t),Zf(i,t),i.uniforms.add([new oi("viewport",(r,s)=>s.camera.fullViewport),new Xe("polygonOffset",r=>r.shaderPolygonOffset),new Xe("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new Xe("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===_h.Occluded?1:s.renderTransparentlyOccludedHUD===_h.NotOccluded?0:.75),new Bt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&pwe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new xr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new Xe("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===yl.Screen&&i.uniforms.add(new Xe("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&VU(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===yl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==yl.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===yl.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===yl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(yl||(yl={}));const QI=ks();function BU(e,t,i,r,s,n,o){if(!N3(t))if(e.boundingInfo){pt(e.primitiveType===El.Triangle);const a=i.tolerance;mwe(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(O.POSITION),l=e.vertexAttributes.get(O.POSITION);k3(r,s,0,a.length/3,a,l,void 0,n,o)}}const $Je=R();function mwe(e,t,i,r,s,n){if(M(e))return;const o=ywe(t,i,$Je);if(Dfe(QI,e.getBBMin()),Lfe(QI,e.getBBMax()),_(s)&&s.applyToAabb(QI),WZ(QI,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>UJe){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&mwe(p[f],t,i,r,s,n);return}}k3(t,i,0,h,l,c,a,s,n)}}const gwe=R();function k3(e,t,i,r,s,n,o,a,l){if(o)return DJe(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,b=t[2]-m;for(let w=i,S=3*i;w<r;++w){let T=h*s[S++],E=c[T++],C=c[T++],A=c[T];T=h*s[S++];let I=c[T++],L=c[T++],D=c[T];T=h*s[S++];let k=c[T++],z=c[T++],V=c[T];_(a)&&([E,C,A]=a.applyToVertex(E,C,A,w),[I,L,D]=a.applyToVertex(I,L,D,w),[k,z,V]=a.applyToVertex(k,z,V,w));const X=I-E,Y=L-C,le=D-A,re=k-E,$=z-C,U=V-A,B=v*U-$*b,H=b*re-U*y,W=y*$-re*v,Q=X*B+Y*H+le*W;if(Math.abs(Q)<=Number.EPSILON)continue;const G=p-E,ee=f-C,me=m-A,_e=G*B+ee*H+me*W;if(Q>0){if(_e<0||_e>Q)continue}else if(_e>0||_e<Q)continue;const Me=ee*le-Y*me,ve=me*X-le*G,ge=G*Y-X*ee,Ce=y*Me+v*ve+b*ge;if(Q>0){if(Ce<0||_e+Ce>Q)continue}else if(Ce>0||_e+Ce<Q)continue;const $e=(re*Me+$*ve+U*ge)/Q;$e>=0&&l($e,qZ(X,Y,le,re,$,U,gwe),w,!1)}}function DJe(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,b=t[2]-m;for(let w=i;w<r;++w){const S=o[w];let T=3*S,E=h*s[T++],C=c[E++],A=c[E++],I=c[E];E=h*s[T++];let L=c[E++],D=c[E++],k=c[E];E=h*s[T];let z=c[E++],V=c[E++],X=c[E];_(a)&&([C,A,I]=a.applyToVertex(C,A,I,w),[L,D,k]=a.applyToVertex(L,D,k,w),[z,V,X]=a.applyToVertex(z,V,X,w));const Y=L-C,le=D-A,re=k-I,$=z-C,U=V-A,B=X-I,H=v*B-U*b,W=b*$-B*y,Q=y*U-$*v,G=Y*H+le*W+re*Q;if(Math.abs(G)<=Number.EPSILON)continue;const ee=p-C,me=f-A,_e=m-I,Me=ee*H+me*W+_e*Q;if(G>0){if(Me<0||Me>G)continue}else if(Me>0||Me<G)continue;const ve=me*re-le*_e,ge=_e*Y-re*ee,Ce=ee*le-Y*me,$e=y*ve+v*ge+b*Ce;if(G>0){if($e<0||Me+$e>G)continue}else if($e>0||Me+$e<G)continue;const gi=($*ve+U*ge+B*Ce)/G;gi>=0&&l(gi,qZ(Y,le,re,$,U,B,gwe),S,!1)}}const une=R(),hne=R();function qZ(e,t,i,r,s,n,o){return ie(une,e,t,i),ie(hne,r,s,n),lt(o,une,hne),we(o,o),o}function ywe(e,t,i){return ie(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function WZ(e,t,i,r){return XZ(e,t,i,r,1/0)}function XZ(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function vwe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=EJe(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Ne(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function _we(e,t){const i=t?_we(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=FJe(s)),s==null&&r in i||(i[r]=s)}return i}function LJe(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):$q(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function NJe(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(O.POSITION).data,a=e.vertexAttributes.get(O.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],b=o[y+1],w=c-v,S=h-b,T=o[y+3]-v,E=o[y+4]-b,C=Ne((T*w+E*S)/(T*T+E*E),0,1),A=T*C-w,I=E*C-S,L=A*A+I*I;L<f&&(f=L,m=y/3)}f<p*p&&n(i.dist,i.normal,m,!1)}function FJe(e){const t=[];return e.forEach(i=>t.push(i)),t}const bwe={multiply:1,ignore:2,replace:3,tint:4},UJe=1e3;class hm extends L3{constructor(t,i){super(),this.type=_p.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Vi,this._parameters=_we(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){LJe(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var $r;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})($r||($r={}));class WE extends Bs{constructor(){super(...arguments),this.renderOccluded=$r.Occlude}}function _Tt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function kJe(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function wwe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function K2(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function GU(e,t,i,r,s,n=1){if(!i)return void wwe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],v=i[8],b=i[9],w=i[10],S=i[12],T=i[13],E=i[14];if(s*=a,n===1)for(let C=0;C<l;++C){const A=3*e[C],I=t[A],L=t[A+1],D=t[A+2];o[s]=c*I+f*L+v*D+S,o[s+1]=h*I+m*L+b*D+T,o[s+2]=p*I+y*L+w*D+E,s+=a}else for(let C=0;C<l;++C){const A=3*e[C],I=t[A],L=t[A+1],D=t[A+2],k=c*I+f*L+v*D+S,z=h*I+m*L+b*D+T,V=p*I+y*L+w*D+E;for(let X=0;X<n;++X)o[s]=k,o[s+1]=z,o[s+2]=V,s+=a}}function YZ(e,t,i,r,s,n=1){if(!i)return void wwe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],b=o[8],w=o[9],S=o[10],T=!oX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=3*e[A],L=t[I],D=t[I+1],k=t[I+2];let z=h*L+m*D+b*k,V=p*L+y*D+w*k,X=f*L+v*D+S*k;if(T){const Y=z*z+V*V+X*X;if(Y<C&&Y>E){const le=1/Math.sqrt(Y);z*=le,V*=le,X*=le}}a[s+0]=z,a[s+1]=V,a[s+2]=X,s+=l}else for(let A=0;A<c;++A){const I=3*e[A],L=t[I],D=t[I+1],k=t[I+2];let z=h*L+m*D+b*k,V=p*L+y*D+w*k,X=f*L+v*D+S*k;if(T){const Y=z*z+V*V+X*X;if(Y<C&&Y>E){const le=1/Math.sqrt(Y);z*=le,V*=le,X*=le}}for(let Y=0;Y<n;++Y)a[s+0]=z,a[s+1]=V,a[s+2]=X,s+=l}}function zJe(e,t,i,r,s,n=1){if(!i)return void K2(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],b=o[8],w=o[9],S=o[10],T=!oX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=4*e[A],L=t[I],D=t[I+1],k=t[I+2],z=t[I+3];let V=h*L+m*D+b*k,X=p*L+y*D+w*k,Y=f*L+v*D+S*k;if(T){const le=V*V+X*X+Y*Y;if(le<C&&le>E){const re=1/Math.sqrt(le);V*=re,X*=re,Y*=re}}a[s+0]=V,a[s+1]=X,a[s+2]=Y,a[s+3]=z,s+=l}else for(let A=0;A<c;++A){const I=4*e[A],L=t[I],D=t[I+1],k=t[I+2],z=t[I+3];let V=h*L+m*D+b*k,X=p*L+y*D+w*k,Y=f*L+v*D+S*k;if(T){const le=V*V+X*X+Y*Y;if(le<C&&le>E){const re=1/Math.sqrt(le);V*=re,X*=re,Y*=re}}for(let le=0;le<n;++le)a[s+0]=V,a[s+1]=X,a[s+2]=Y,a[s+3]=z,s+=l}}function p4(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function jU(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case O.POSITION:{pt(a.size===3);const c=s.getField(o,bi);c&&GU(l,a.data,i,c,n);break}case O.NORMAL:{pt(a.size===3);const c=s.getField(o,bi);c&&YZ(l,a.data,r,c,n);break}case O.UV0:{pt(a.size===2);const c=s.getField(o,qh);c&&kJe(l,a.data,c,n);break}case O.COLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,Ll);c&&p4(l,a.data,a.size,c,n);break}case O.SYMBOLCOLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,Ll);c&&p4(l,a.data,a.size,c,n);break}case O.TANGENT:{pt(a.size===4);const c=s.getField(o,Un);c&&zJe(l,a.data,r,c,n);break}}}}function PR(e,t,i=0){const r=Ne(e,0,GJe);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*jJe(r*VJe[s]))}function ZZ(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*BJe[r];return i}const VJe=[1,256,65536,16777216],BJe=[1/256,1/65536,1/16777216,1/4294967296],GJe=ZZ(new Uint8ClampedArray([255,255,255,255]));function jJe(e){return e-Math.floor(e)}function HJe(){if(M(EV)){const e=t=>Ni(`esri/libs/basisu/${t}`);EV=import("./basis_transcoder.2437f1d5.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return EV}let EV;var Tb;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(Tb||(Tb={}));let ap=null,JI=null;async function xwe(){return M(JI)&&(JI=HJe(),ap=await JI),JI}function qJe(e,t){if(M(ap))return e.byteLength;const i=new ap.BasisFile(new Uint8Array(e)),r=Swe(i)?Twe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function WJe(e,t){if(M(ap))return e.byteLength;const i=new ap.KTX2File(new Uint8Array(e)),r=Ewe(i)?Twe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function Twe(e,t,i,r,s){const n=u1e(t?ts.COMPRESSED_RGBA8_ETC2_EAC:ts.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function Swe(e){return e.getNumImages()>=1&&!e.isUASTC()}function Ewe(e){return e.getFaces()>=1&&e.isETC1S()}async function XJe(e,t,i){M(ap)&&(ap=await xwe());const r=new ap.BasisFile(new Uint8Array(i));if(!Swe(r))return null;r.startTranscoding();const s=Cwe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function YJe(e,t,i){M(ap)&&(ap=await xwe());const r=new ap.KTX2File(new Uint8Array(i));if(!Ewe(r))return null;r.startTranscoding();const s=Cwe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function Cwe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[Tb.ETC2_RGBA,ts.COMPRESSED_RGBA8_ETC2_EAC]:[Tb.ETC1_RGB,ts.COMPRESSED_RGB8_ETC2]:c?r?[Tb.BC3_RGBA,ts.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Tb.BC1_RGB,ts.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Tb.RGBA32,ze.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let w=0;w<f;w++)m.push(new Uint8Array(o(w,h))),a(w,h,m[w]);const y=m.length>1,v=y?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,b=ye(F({},t),{samplingMode:v,hasMipmap:y,internalFormat:p,width:s,height:n});return new ot(e,b,{type:"compressed",levels:m})}const RC=de.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),ZJe=542327876,QJe=131072,JJe=4;function QZ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function KJe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const eKe=QZ("DXT1"),tKe=QZ("DXT3"),iKe=QZ("DXT5"),rKe=31,sKe=0,nKe=1,oKe=2,aKe=3,lKe=4,cKe=7,uKe=20,hKe=21;function dKe(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=pKe(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new ot(e,t,r)}function pKe(e,t){const i=new Int32Array(e,0,rKe);if(i[sKe]!==ZJe)return RC.error("Invalid magic number in DDS header"),null;if(!(i[uKe]&JJe))return RC.error("Unsupported format, must contain a FourCC code"),null;const r=i[hKe];let s,n;switch(r){case eKe:s=8,n=ts.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case tKe:s=16,n=ts.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case iKe:s=16,n=ts.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return RC.error("Unsupported FourCC code:",KJe(r)),null}let o=1,a=i[lKe],l=i[aKe];(3&a)==0&&(3&l)==0||(RC.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[oKe]&QJe&&t!==!1&&(o=Math.max(1,i[cKe])),o===1||g2(a)&&g2(l)||(RC.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[nKe]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class $s extends L3{constructor(t,i){super(),this.data=t,this.type=_p.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Zr,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:wt.REPEAT,t:wt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Pv.STRETCH,this.estimatedTexMemRequired=$s._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;M(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(d2(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){em(t.src)||d2(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(M(t))return 0;if(ZE(t)||lb(t))return i.encoding===$s.KTX2_ENCODING?WJe(t,i.mipmap):i.encoding===$s.BASIS_ENCODING?qJe(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?$s._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?it.LINEAR_MIPMAP_LINEAR:it.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return M(r)?(this._glTexture=new ot(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(ZE(r)||lb(r))&&this.params.encoding===$s.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(ZE(r)||lb(r))&&this.params.encoding===$s.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(ZE(r)||lb(r))&&this.params.encoding===$s.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):lb(r)?this._loadFromPixelData(t,r):ZE(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||M(this._glTexture)||this.data.readyState<uO.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=dKe(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>YJe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>XJe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){pt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new ot(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await yp(r,{signal:s});return Wt(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await Nhe(r,r.src,!1,s);return Wt(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=uO.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),sn(h)},l=()=>{r.readyState>=uO.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new q("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=Fo(s,()=>c(hi()))}))}_loadFromImage(t,i,r){const s=$s._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||g2(s.width)&&g2(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new ot(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=wt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!Dn(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=m2(o),c=m2(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Pv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new ot(t,s),h.updateData(0,0,0,o,a,i);break;case Pv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new ot(t,r),o=new Cr(t,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},n),a=new ot(t,{target:ft.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=qa(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays($t.TRIANGLE_STRIP,0,Po(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var uO;$s.DDS_ENCODING="image/vnd-ms.dds",$s.KTX2_ENCODING="image/ktx2",$s.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(uO||(uO={}));const IR=128,JZ=.5;function Awe(e,t=IR,i=t*JZ,r=0){const s=fKe(e,t,i,r);return new $s(s,{mipmap:!1,wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function fKe(e,t=IR,i=t*JZ,r=0){switch(e){case"circle":default:return mKe(t,i);case"square":return gKe(t,i);case"cross":return vKe(t,i,r);case"x":return _Ke(t,i,r);case"kite":return yKe(t,i);case"triangle":return bKe(t,i);case"arrow":return wKe(t,i)}}function mKe(e,t){const i=e/2-.5;return z3(e,Rwe(i,i,t/2))}function gKe(e,t){return Mwe(e,t,!1)}function yKe(e,t){return Mwe(e,t,!0)}function vKe(e,t,i=0){return Owe(e,t,!1,i)}function _Ke(e,t,i=0){return Owe(e,t,!0,i)}function bKe(e,t){return z3(e,Pwe(e/2,t,t/2))}function wKe(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=Rwe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=Pwe(s,i,r);return z3(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function Mwe(e,t,i){return i&&(t/=Math.SQRT2),z3(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function Owe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return z3(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function Rwe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function Pwe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function z3(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,PR(o,i,4*n)}return i}class bTt extends Bs{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function xKe(e,t){Iwe(e,t,[new Tt("slicePlaneOrigin",(i,r)=>Nwe(t,i,r)),new Tt("slicePlaneBasis1",(i,r)=>{var s;return f4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Tt("slicePlaneBasis2",(i,r)=>{var s;return f4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function fs(e,t){Iwe(e,t,[new Va("slicePlaneOrigin",(i,r)=>Nwe(t,i,r)),new Va("slicePlaneBasis1",(i,r)=>{var s;return f4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Va("slicePlaneBasis2",(i,r)=>{var s;return f4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function Iwe(e,t,i){if(!t.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function $we(e,t,i){return e.instancedDoublePrecision?ie(TKe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function Dwe(e,t){return _(e)?fe(m4,t.origin,e):t.origin}function Lwe(e,t,i){return e.hasSliceTranslatedView?_(t)?ca(SKe,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function Nwe(e,t,i){if(M(i.slicePlane))return No;const r=$we(e,t,i),s=Dwe(r,i.slicePlane),n=Lwe(e,r,i);return _(n)?ke(m4,s,n):s}function f4(e,t,i,r){if(M(r)||M(i.slicePlane))return No;const s=$we(e,t,i),n=Dwe(s,i.slicePlane),o=Lwe(e,s,i);return _(o)?(pe(PC,r,n),ke(m4,n,o),ke(PC,PC,o),fe(PC,PC,m4)):r}const TKe=R(),m4=R(),PC=R(),SKe=Ee();function EKe(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(L1e),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(Lu),t.hasMultipassTerrain&&r.uniforms.add([new Bt("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new mi("nearFar",(s,n)=>n.camera.nearFar),new mi("inverseViewport",(s,n)=>n.inverseViewport)]),r.include(Mc),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const CKe=vi(1,1,0,1),Fwe=vi(1,0,1,1);function my(e){e.fragment.uniforms.add(new Bt("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new mi("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",CKe).add("unoccludedHighlightFlag","vec4",Fwe),e.fragment.code.add(x`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class HU extends Qr{constructor(t,i,r){super(t,"vec4",zi.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class sa extends Qr{constructor(t,i,r){super(t,"float",zi.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class V3 extends Qr{constructor(t,i){super(t,"mat3",zi.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class KZ extends WE{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ue(1,1,1),this.vvSizeMaxSize=Ue(100,100,100),this.vvSizeOffset=Ue(0,0,0),this.vvSizeFactor=Ue(1,1,1),this.vvSizeValue=Ue(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ir()}}const lp=8;function QS(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new V3("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Tt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",lp),t.hasVvInstancing&&i.uniforms.add([new sa("vvColorValues",r=>r.vvColorValues,lp),new HU("vvColorColors",r=>r.vvColorColors,lp)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const g4=.1,Do=.001;function AKe(e){const t=new Xi,i=e.signedDistanceFieldEnabled;if(t.include(bZ),t.include(fwe,e),t.include(fs,e),e.output===K.Occlusion)return t.include(EKe,e),t;const{vertex:r,fragment:s}=t;t.include(HZ),s.include(Mc),s.include(cm),t.include(QS,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new oi("viewport",(c,h)=>h.camera.fullViewport),new mi("screenOffset",(c,h)=>fi(Uwe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new mi("anchorPosition",c=>y4(c)),new oi("materialColor",c=>c.color),new Xe("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new oi("outlineColor",c=>c.outlineColor)),s.uniforms.add([new oi("outlineColor",c=>dne(c)?c.outlineColor:Lf),new Xe("outlineSize",c=>dne(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(RJe(r),VU(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"vec2"),t.attributes.add(O.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new HU("vvColorColors",c=>c.vvColorColors,lp),new sa("vvColorValues",c=>c.vvColorValues,lp)]),r.uniforms.add(new mi("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:hge)),r.code.add(x`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.float(Do)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(Do)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Bt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(g4)})`:x.float(g4),l=x`
    ${e.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(IR)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(Do)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===K.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===K.Color&&s.code.add(x`
    void main() {
      ${l}
      ${e.transparencyPassType===yt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===K.Highlight&&(t.include(my),s.code.add(x`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function dne(e){return e.outlineColor[3]>0&&e.outlineSize>0}function y4(e,t=Uwe){return e.textureIsSignedDistanceField?MKe(e.anchorPosition,e.distanceFieldBoundingBox,t):co(t,e.anchorPosition),t}function MKe(e,t,i){_(t)?fi(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):fi(i,0,0)}const Uwe=st(),OKe=Object.freeze(Object.defineProperty({__proto__:null,build:AKe,calculateAnchorPosForRendering:y4},Symbol.toStringTag,{value:"Module"})),Ru=uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),RKe=lm(Oe.ONE,Oe.ONE),kwe=lm(Oe.ZERO,Oe.ONE_MINUS_SRC_ALPHA);function gy(e){return e===yt.FrontFace?null:e===yt.Alpha?kwe:RKe}function qU(e){return e===yt.FrontFace?Dl:null}const WU=5e5,XU={factor:-1,units:-2};function YU(e){return e?XU:null}function b_(e,t=fr.LESS){return e===yt.NONE||e===yt.FrontFace?t:fr.LEQUAL}class B3 extends dr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=B3.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}_setPipelineState(t){const i=this.configuration,r=t===yt.NONE,s=t===yt.FrontFace,n=this.configuration.hasPolygonOffset&&PKe,o=(r||s)&&i.output!==K.Highlight?(i.depthEnabled||i.output===K.Occlusion)&&Dl:null;return zt({blending:i.output===K.Color||i.output===K.Alpha||i.output===K.Highlight?r?IKe:gy(t):null,depthTest:{func:fr.LEQUAL},depthWrite:o,colorWrite:ri,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===K.Occlusion?$t.POINTS:$t.TRIANGLES}}B3.shader=new rr(OKe,()=>import("./HUDMaterial.glsl.d325edce.js"));const PKe={factor:0,units:-4},IKe=lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA);class na extends Ha{}u([j({constValue:!0})],na.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],na.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],na.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],na.prototype,"isGround",void 0),u([j({constValue:zi.Pass})],na.prototype,"pbrTextureBindType",void 0);class Ms extends na{constructor(){super(...arguments),this.output=K.Color,this.screenCenterOffsetUnitsEnabled=yl.World,this.transparencyPassType=yt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Ms.prototype,"output",void 0),u([j({count:yl.COUNT})],Ms.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:yt.COUNT})],Ms.prototype,"transparencyPassType",void 0),u([j()],Ms.prototype,"spherical",void 0),u([j()],Ms.prototype,"occlusionTestEnabled",void 0),u([j()],Ms.prototype,"signedDistanceFieldEnabled",void 0),u([j()],Ms.prototype,"vvSize",void 0),u([j()],Ms.prototype,"vvColor",void 0),u([j()],Ms.prototype,"hasVerticalOffset",void 0),u([j()],Ms.prototype,"hasScreenSizePerspective",void 0),u([j()],Ms.prototype,"debugDrawLabelBorder",void 0),u([j()],Ms.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],Ms.prototype,"hasSlicePlane",void 0),u([j()],Ms.prototype,"hasPolygonOffset",void 0),u([j()],Ms.prototype,"depthEnabled",void 0),u([j()],Ms.prototype,"pixelSnappingEnabled",void 0),u([j()],Ms.prototype,"isDraped",void 0),u([j()],Ms.prototype,"hasMultipassGeometry",void 0),u([j()],Ms.prototype,"hasMultipassTerrain",void 0),u([j()],Ms.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Ms.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Ms.prototype,"hasVvInstancing",void 0);class eE extends hm{constructor(t){super(t,new BKe),this.techniqueConfig=new Ms}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?yl.Screen:yl.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===K.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===K.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(O.POSITION),a=t.vertexAttributes.get(O.SIZE),l=this.parameters,c=y4(l);let h=1,p=1;if(_(s)){const m=s(mne);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=zKe*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const y=m*o.size,v=o.data[y],b=o.data[y+1],w=m*a.size;let S;$y[0]=a.data[w]*h,$y[1]=a.data[w+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),pne(i,v,b,$y,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||N3(i))return;const a=this.parameters;let l=1,c=1;if(Sc(AV,r),_(o)){const S=o(mne);l=S[0],c=S[5],LKe(AV)}const h=t.vertexAttributes.get(O.POSITION),p=t.vertexAttributes.get(O.SIZE),f=t.vertexAttributes.get(O.NORMAL),m=t.vertexAttributes.get(O.AUXPOS1);pt(h.size>=3);const y=s.point,v=s.camera,b=y4(a);l*=v.pixelRatio,c*=v.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;ie(qo,h.data[T],h.data[T+1],h.data[T+2]),ke(qo,qo,r);const E=S*p.size;$y[0]=p.data[E]*l,$y[1]=p.data[E+1]*c,ke(qo,qo,v.viewMatrix);const C=S*m.size;if(ie(Lc,m.data[C+0],m.data[C+1],m.data[C+2]),!w&&(qo[0]+=Lc[0],qo[1]+=Lc[1],Lc[2]!==0)){const I=Lc[2];we(Lc,qo),fe(qo,qo,oe(Lc,Lc,I))}const A=S*f.size;if(ie(IC,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(IC,AV,v,MV),this._applyVerticalOffsetTransformationView(qo,MV,v,CV),v.applyProjection(qo,fa),fa[0]>-1){fa[0]=Math.floor(fa[0]),fa[1]=Math.floor(fa[1]),w&&(Lc[0]||Lc[1])&&(fa[0]+=Lc[0],Lc[1]!==0&&(fa[1]+=jZ(Lc[1],CV.factorAlignment)),v.unapplyProjection(fa,qo)),fa[0]+=this.parameters.screenOffset[0],fa[1]+=this.parameters.screenOffset[1],lwe($y,CV.factor,$y);const I=kKe*v.pixelRatio;let L;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*v.pixelRatio/2),pne(y,fa[0],fa[1],$y,I,L,a,b)){const D=s.ray;if(ke(fne,qo,Xr(UKe,v.viewMatrix)),fa[0]=y[0],fa[1]=y[1],v.unprojectFromRenderScreen(fa,qo)){const k=R();ne(k,D.direction);const z=1/Re(k);oe(k,k,z),n(ur(D.origin,qo)*z,k,-1,!0,1,fne)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(O.POSITION),n=t.indices.get(O.POSITION);return q1e(s,n,i)}createBufferWriter(){return new jKe(this)}_normalAndViewAngle(t,i,r,s){return OJe(i)&&(i=Sc(FKe,i)),Oo(s.normal,t,i),ke(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=Se(Vwe,VKe),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?ane(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?ane(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,MV);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&ne(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ne(n,t);const c=Ne(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return oe(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Re(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=oe(qo,i.normal,o*a);return pe(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Re(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Re(t),a=_t(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=vwe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),oe(i.normal,i.normal,l),pe(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&ne(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(we(IC,r),pe(r,r,oe(IC,IC,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ne(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ne(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Te.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?Te.LABEL_MATERIAL:Te.HUD_MATERIAL)||r&&t===Te.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha?new $Ke(t):t.output===K.Highlight?new zwe(t):null}calculateRelativeScreenBounds(t,i,r=Lt()){return DKe(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class zwe extends sZ{constructor(t){super(F(F({},t),t.material.parameters))}selectProgram(t){return this.ensureTechnique(B3,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class $Ke extends zwe{_isOcclusionSlot(t){return t.slot===Te.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===K.Color||this._output===K.Alpha)}selectProgram(t){return this.ensureTechnique(B3,t,this._isOcclusionSlot(t)?K.Occlusion:this._output)}}function DKe(e,t,i,r=NKe){return co(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function LKe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function pne(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const CV={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},NKe=st(),qo=R(),IC=R(),fa=qt(),Vwe=R(),fne=R(),AV=ir(),FKe=ir(),UKe=Ee(),Lc=R(),MV={normal:Vwe,cosAngle:0},mne=Ee(),kKe=1,zKe=2,$y=[0,0],VKe=Ue(0,0,1);class BKe extends T1e{constructor(){super(...arguments),this.renderOccluded=$r.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Fi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const GKe=ns().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2);class jKe{constructor(t){this.material=t,this.vertexBufferLayout=GKe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,i,r,s){GU(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,t.transformation,r.position,s,6),YZ(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(O.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(O.POSITION).length,p=r.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}p4(i.indices.get(O.COLOR),i.vertexAttributes.get(O.COLOR).data,4,r.color,s,6);{const n=i.indices.get(O.SIZE),o=i.vertexAttributes.get(O.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(O.AUXPOS1)&&i.vertexAttributes.get(O.AUXPOS1)&&K2(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(O.AUXPOS2)&&i.vertexAttributes.get(O.AUXPOS2)&&K2(i.indices.get(O.AUXPOS2),i.vertexAttributes.get(O.AUXPOS2).data,r.auxpos2,s,6)}}const Mp=R(),Ix=qt(),$C=qt(),OV=R(),HKe=Ee(),qKe=bn(),RV=io(),WKe=R(),XKe=Lt();class YKe{constructor(){this.aabr=Lt(),this.distance=0,this.culled=!1,this.visible=!1}}class ZKe{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class QKe{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class JKe{}class KKe{constructor(){this.sortArray=new It({allocator:t=>t||new JKe})}}var ic;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(ic||(ic={}));class Bwe{constructor(){this.camera=new qi,this.slicePlane=y_(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),nx(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let AS=class extends Ae{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new Bwe,this._state=ic.Idle,this.graphics=new QKe,this.iterators=new KKe,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ic.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/ic.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case ic.Idle:this._startUpdate(),e.madeProgress();case ic.Process:if(this._state=ic.Process,!this._processActiveGraphics(e))return;case ic.Sort:if(this._state=ic.Sort,!this._sortVisibleGraphics(e))return;case ic.Deconflict:if(this._state=ic.Deconflict,!this._deconflictVisibleGraphics(e))return;default:vJe(this,this.graphics.visible),this._state=ic.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(M(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof eE}_startUpdate(){_Je(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new YKe,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),eet(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=Xr(HKe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?qKe:null;let s=0;for(_(r)&&(ke(r,No,this._runningViewState.camera.viewMatrix),r[3]=Ai(this.view.spatialReference).radius,s=Cge(r,No));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===eo.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),wJe(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=gne(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=gne(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=tet(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(eo.GRAPHIC,yu.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);xc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(M(a)){if(a=this._getProjectionInfo(l,t,set),a.isOutsideScreen||this._isCulledBySlice(e,Mp)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!Wi.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}M(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ke(Mp,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(O.NORMAL).data,h=l.get(O.AUXPOS1).data;return o.applyShaderOffsetsView(Mp,c,s.transformation,h,r,i.scaleInfo,Mp),Ji(Ix,Mp[0],Mp[1],Mp[2],1),bu($C,Ix,r.projectionMatrix),oe(i.positionNDC,$C,1/$C[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,OV),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(OV[2]),i.distance=OV[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Ji($C,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),bu(Ix,$C,t),u3(Ix,Ix,1/Ix[3]),ie(i.positionView,Mp[0],Mp[1],Mp[2]),i}_isCulledByHorizon(e,t,i){return ne(RV.direction,e.positionView),ie(RV.origin,0,0,0),!!g_(t,RV,WKe)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&EX(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(iet);lwe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=cF(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,XKe),Zt(0,n.fullWidth,.5+.5*r[0]),Zt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(fu(a),fp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Hb(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,m3(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new It)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(yu.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===eo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function eet(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(yu.DECONFLICTION,t)}function*gne(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*tet(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],AS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],AS.prototype,"updating",null),AS=u([P("esri.views.3d.layers.graphics.Deconflictor")],AS);const iet=st();class ret{constructor(){this.positionView=R(),this.positionNDC=R(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const set=new ret,net=2e3;let KL=class extends AS{constructor(){super(...arguments),this.visibilityGroup=eo.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===On.IDLE||t-this._lastDeconfliction>net)&&(super.runTask(e),this.state===ic.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],KL.prototype,"parent",void 0),KL=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],KL);let PH=class extends AS{constructor(){super(...arguments),this._handles=new si,this._contexts=new Map,this._viewState=new Bwe,this.visibilityGroup=eo.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ae(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),ae(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),ae(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ft)]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.GRAPHICS_DECONFLICTOR,this),this._labels=new KL({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&PV(e));t.setVisibilityFlag(yu.DECONFLICTION,i,eo.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&Vge(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){Js(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new ZKe(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),PV(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=PV(e);i||oet(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function PV(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function oet(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(yu.DECONFLICTION))}PH=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],PH);const eQ=(e,t,i)=>[t,i],tE=(e,t,i)=>[t,i,e[2]],tQ=(e,t,i)=>[t,i,e[2],e[3]];function wTt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function aet({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function cet({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function Gwe({scale:e,translate:t},i){return i*e[0]+t[0]}function jwe({scale:e,translate:t},i){return t[1]-i*e[1]}function Hwe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=Gwe(e,i[0][0]),a=jwe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function qwe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=Hwe(e,t,i[s]);return r}function uet(e,t,i,r){return Hwe(e,i?r?tQ:tE:r?tE:eQ,t)}function het(e,t,i,r){return qwe(e,i?r?tQ:tE:r?tE:eQ,t)}function det(e,t,i,r){return qwe(e,i?r?tQ:tE:r?tE:eQ,t)}function xTt(e,t,i,r,s){return t.x=aet(e,i.x),t.y=cet(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function Wwe(e,t,i,r,s){return _(i)&&(t.points=uet(e,i.points,r,s)),t}function Xwe(e,t,i,r,s){return M(i)||(t.x=Gwe(e,i.x),t.y=jwe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function Ywe(e,t,i,r,s){return _(i)&&(t.rings=det(e,i.rings,r,s)),t}function Zwe(e,t,i,r,s){return _(i)&&(t.paths=het(e,i.paths,r,s)),t}function Qwe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function Jwe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Qwe(e[i],t[i]))return!1;return!0}function pet(e,t){return!!G3(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function fet(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!G3(e.spatialReference,t.spatialReference)&&Jwe(e.paths,t.paths)}function met(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!G3(e.spatialReference,t.spatialReference)&&Jwe(e.rings,t.rings)}function get(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!G3(e.spatialReference,t.spatialReference)&&Qwe(e.points,t.points)}function yet(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!G3(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function G3(e,t){return e===t||e&&t&&e.equals(t)}function vet(e,t){if(e===t)return!0;if(M(e)||M(t)||e.type!==t.type)return!1;switch(e.type){case"point":return pet(e,t);case"extent":return yet(e,t);case"polyline":return fet(e,t);case"polygon":return met(e,t);case"multipoint":return get(e,t);case"mesh":return!1;default:return}}function _et(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function TTt(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!vet(e.geometry,t.geometry)&&!!_et(e.attributes,t.attributes)}class STt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function ETt(e){return _(e.geometry)}class CTt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function ATt(e){const t=Zpe.fromJSON(e.geometryType),i=Ze.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=bet(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=Xwe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=Wwe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=Ywe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=Zwe(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>IE.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function bet(e,t,i,r){return{uid:wl(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:wet(e.geometry,t,i),visible:!0}}function wet(e,t,i){if(M(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function yy(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function xet(e){if(M(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=bP(e.vertexAttributes.position),t+=bP(e.vertexAttributes.normal),t+=bP(e.vertexAttributes.uv),t+=bP(e.vertexAttributes.tangent)}return t}function MTt(e){let t=32;return t+=ige(e.attributes),t+=3,t+=8+xet(e.geometry),t}function Tet(e){if(M(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function OTt(e){if(M(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function RTt(e,t){switch(pr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Pz(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Pz(t,e.rings[i],e.hasZ);break;case"multipoint":Pz(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function Eet(e,t){switch(xc(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Rz(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Rz(t,e.rings[i]);break;case"multipoint":Rz(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function PTt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}ks();Lt();function Kwe(e){return"declaredClass"in e}function yne(e){return"declaredClass"in e}function Cet(e){return"declaredClass"in e}function Aet(e,t){if(!e)return null;if(Cet(e))return e;const i=new Ga({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=te(e.symbol),i.attributes=te(e.attributes),i.geometry=exe(e.geometry),i}function exe(e){return M(e)?null:Kwe(e)?e:Wg(Met(e))}function Met(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:vne(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:vne(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:ixe(i)?txe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function vne(e){return Oet(e)?e.map(t=>txe(t)):e}function txe(e){return e.map(t=>wCe(t))}function Oet(e){for(const t of e)if(t.length!==0)return ixe(t);return!1}function ixe(e){return e.length&&(Rue(e[0])||Pue(e[0]))}function Ret(e,t){if(!e)return null;let i;if(yne(e)){if(t==null)return e.clone();if(yne(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=yy(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const IV=de.getLogger("esri.layers.support.labelFormatUtils"),_ne={type:"simple",evaluate:()=>null},Pet={getAttribute:(e,t)=>e.field(t)};async function rxe(e,t,i){if(!e||!e.symbol)return _ne;const r=e.where,s=yU(e),n=r?await import("./WhereClause.b4219540.js"):null;let o;if(s.type==="arcade"){const a=await VIe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{IV.error(new q("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>PY(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":sxe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return IV.error(new q("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),_ne}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Pet;try{if(a.testFeature(c,h))return l(c)}catch(p){IV.error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function sxe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Vf(r,r5("short-date")):x5(t)&&(r=Bf(+r)),r||""}var ITt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:rxe,formatField:sxe},Symbol.toStringTag,{value:"Module"}));function iQ(e,t){if(e.type==="point")return Dy(e,t,!1);if(Kwe(e))switch(e.type){case"extent":return Dy(e.center,t,!1);case"polygon":return Dy(e.centroid,t,!1);case"polyline":return Dy(bne(e),t,!0);case"mesh":return Dy(e.origin,t,!1)}else switch(e.type){case"extent":return Dy(Iet(e),t,!0);case"polygon":return Dy($et(e),t,!0);case"polyline":return Dy(bne(e),t,!0)}}function bne(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Lpe(t,Dpe(t)/2);return yy(i[0],i[1],i[2],e.spatialReference)}function Iet(e){const t=isFinite(e.zmin);return yy(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function $et(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=Npe(e.rings,e.hasZ);return yy(i[0],i[1],i[2],e.spatialReference)}function Dy(e,t,i){const r=i?e:Ret(e);return t&&e?oNe(e,r,t)?r:null:r}function $Tt(e,t,i,r=0){if(e){t||(t=Lt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ji(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function nxe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(O.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function hO(e,t){const i=B5(Ph);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function DTt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function wne(e=Rf,t,i,r=1){const s=new Array(3);if(M(t)||M(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return dl(s)}function Det(e){return e.isPrimitive!=null}function ZU(e){return Det(e)&&(e=[e.width,e.depth,e.height]),v4(e)?null:"Symbol sizes may not be negative values"}function v4(e){if(Array.isArray(e)){for(const t of e)if(!v4(t))return!1;return!0}return e==null||e>=0}function Let(e,t,i,r=Ee()){const s=e||0,n=t||0,o=i||0;return s!==0&&A2(r,r,-s/180*Math.PI),n!==0&&C2(r,r,n/180*Math.PI),o!==0&&F5(r,r,o/180*Math.PI),r}function rQ(e,t){return t.minDemResolution!=null?t.minDemResolution:R5(e)?t.minDemResolutionForPoints:.01*W$e(e)}function oxe(e,t,i,r,s,n,o,a,l,c,h){const p=Get[h.mode];let f,m,y=0;if(tr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),tr(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function ry(e,t,i,r,s){const n=(l4(e)?e.z:Ube(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=_t(If(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=_t(If(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=_t(If(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=_t(If(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function Net(e,t,i,r){return ry(e,t,i,r,MS),MS.z}function j3(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Yr.UPDATE:e.onTheGroundChanged}function Xh(e){return e==="relative-to-ground"||e==="relative-to-scene"}function c_(e){return e!=="absolute-height"}function Fet(e,t,i,r,s){ry(t,i,s,r,MS),nxe(e,MS.verticalDistanceToGround);const n=MS.sampledElevation,o=ws(jet,e.transformation);return KI[0]=t.x,KI[1]=t.y,KI[2]=MS.z,ua(t.spatialReference,KI,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Uet(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=_t(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function ket(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],b=_t(n.getElevation(m,y,v,p,"ground"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+b+c:b+c,t+=3,r+=3}return l/s}function zet(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],b=_t(n.getElevation(m,y,v,p,"scene"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+b+c:b+c,t+=3,r+=3}return l/s}function Vet(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function Bet(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class H3{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Yr;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Yr||(Yr={}));const Get={"absolute-height":{applyElevationAlignmentBuffer:Bet,requiresAlignment:Vet},"on-the-ground":{applyElevationAlignmentBuffer:Uet,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:ket,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:zet,requiresAlignment:()=>!0}},jet=Ee(),MS=new H3,KI=R();function axe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=cxe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function $R(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(ry(n,i,t,r,gl),nxe(s,gl.verticalDistanceToGround),o=gl.sampledElevation):(ry(n,i,t,r,gl),t.mode!=="absolute-height"&&(o=gl.sampledElevation));const a=ws(Het,s.transformation),l=ie(lxe,a[12],a[13],a[14]);Wi.TESTS_DISABLE_OPTIMIZATIONS?(ml[0]=n.x,ml[1]=n.y,ml[2]=gl.z,ua(n.spatialReference,ml,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(gl.z,a);const c=sQ/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const Het=Ee();function qet(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(M(s))return 0;const n=t.centerPointInElevationSR;ry(n,i,t,r,gl);const o=t.mode!=="absolute-height"?gl.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=Xet;a.getGlobalTransform(l,c);const h=ie(lxe,c[12],c[13],c[14]);Wi.TESTS_DISABLE_OPTIMIZATIONS?(ml[0]=n.x,ml[1]=n.y,ml[2]=gl.z,ua(n.spatialReference,ml,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(gl.z,c);const p=sQ/r.unitInMeters;return(Wi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function Wet(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(O.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=cxe(h,t,i,r);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const sQ=.01,ml=R(),ju=R(),$x=R(),Xet=Ee(),lxe=R(),gl=new H3;function cxe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;ju[0]=a[12],ju[1]=a[13],ju[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(O.POSITION),h=c.data,p=o.vertexAttributes.get(O.MAPPOS).data,f=c.size,m=h.length/f,y=new Fbe(p,n);let v=0,b=0;for(let w=0;w<m;w++){if($x[0]=h[v],$x[1]=h[v+1],$x[2]=h[v+2],ry(y,i,t,r,gl),l&&(b+=gl.sampledElevation),Wi.TESTS_DISABLE_OPTIMIZATIONS)h[v]=y.array[y.offset],h[v+1]=y.array[y.offset+1],h[v+2]=gl.z,tr(h,n,v,h,r.spatialReference,v,1),h[v]-=ju[0],h[v+1]-=ju[1],h[v+2]-=ju[2],s=!0;else{ml[0]=h[v]+ju[0],ml[1]=h[v+1]+ju[1],ml[2]=h[v+2]+ju[2],r.setAltitude(ml,gl.z),h[v]=ml[0]-ju[0],h[v+1]=ml[1]-ju[1],h[v+2]=ml[2]-ju[2];const S=sQ/r.unitInMeters;(Math.abs($x[0]-h[v])>=S||Math.abs($x[1]-h[v+1])>=S||Math.abs($x[2]-h[v+2])>=S)&&(s=!0)}v+=f,y.offset+=3}return b/=m,{update:s,averageGeometrySampledElevation:b}}const Yet=de.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Zet(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function LTt(e){const t=e&&e.expression;if(typeof t=="string"){const i=dxe(t);if(i!=null)return{cachedResult:i}}return null}async function NTt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=dxe(r);if(s!=null)return{cachedResult:s};const n=await jf(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function uxe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function nQ(e,t){if(e!=null&&!hxe(e)){if(!t||!e.arcade)return void Yet.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=exe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Qet(e){if(e!=null){if(hxe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function FTt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const Jet={cachedResult:0};function hxe(e){return e.cachedResult!=null}function dxe(e){return e==="0"?0:null}class Uu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=u8e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Qet(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=c8e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=_t(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(M(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=Zet(t),nQ(this._featureExpressionInfoContext,uxe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new Uu;return _(t)&&i.setFromElevationInfo(t),i}}var Dt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Dt||(Dt={}));class dm{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(M(this._edgeState))return;const r=xne(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){M(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&nQ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=R()){return ne(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=ks()){const i=this.stageObject.boundingVolumeObjectSpace;return Dfe(t,i.min),Lfe(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(xm)&&(ke(xm,xm,this.stageObject.transformation),pe(t.render.origin,t.render.origin,xm),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Ket,l=R5(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Ly[0]=o[p[0]],Ly[1]=o[p[1]],Ly[2]=o[p[2]],ke(Ly,Ly,this.stageObject.transformation),B_[3*h+0]=Ly[0],B_[3*h+1]=Ly[1],B_[3*h+2]=Ly[2]}if(!t(B_,0,l))return null;pr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],B_[h+p]),o[p+3]=Math.max(o[p+3],B_[h+p]);c&&r.push({location:B_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Qd(o,xm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=_t(i.service.getElevation(xm[0],xm[1],h),0);else try{const f=rQ(o,i);p=_t(await i.service.queryElevation(xm[0],xm[1],s,f,h),0)}catch{}$fe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===Kg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===Kg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(M(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(M(r))return;const s=xne(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function xne(e){return e.isVisible?e.parameters.transparent?Dt.TRANSPARENT:Dt.OPAQUE:Dt.INVISIBLE}const B_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ly=R(),xm=R(),Ket=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var rn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(rn||(rn={}));class oQ{constructor(t){this.schedule=t,this._loadStatus=cu.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===cu.LOADED?(t&&t(),this._loader):this._loadStatus===cu.FAILED?(i&&i(this._loadError),this._loader):(M(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=cu.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=cu.FAILED,!Br(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=zh(this._abortController):this._loadStatus===cu.LOADING&&(this._loadStatus=cu.FAILED),this._loader=null}}var cu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(cu||(cu={}));function ett(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function pxe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&nc.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>nc.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createBoxGeometry(1));case"cone":return i($V,r=>nc.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i($V,r=>nc.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i($V,r=>nc.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createDiamondGeometry(1),!0);default:return}}const $V=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function ttt(e){return e.type==="fill"}function itt(e){return e.type==="extrude"}function rtt(e){return e&&e.enabled&&(itt(e)||ttt(e))&&_(e.edges)}function stt(e){return e&&e.enabled&&e.edges||null}function fxe(e,t){return mxe(stt(e),t)}function mxe(e,t){if(M(e))return null;const i=_(e.color)?gX(We.toUnitRGBA(e.color)):vi(0,0,0,0),r=no(e.size),s=no(e.extensionLength);switch(e.type){case"solid":return gxe(F({color:i,size:r,extensionLength:s},t));case"sketch":return ntt(F({color:i,size:r,extensionLength:s},t));default:return}}function gxe(e){return ye(F(F({},ott),e),{type:"solid"})}function ntt(e){return ye(F(F({},att),e),{type:"sketch"})}const ott={color:vi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Dt.OPAQUE,hasSlicePlane:!1},att={color:vi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Dt.OPAQUE,hasSlicePlane:!1};function e$(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),i3(t)}function ltt(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),i3(t)}function aQ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),i3(t)}function ctt(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),i3(t)}function utt(e){return aQ(e).reduce((t,i)=>t+i.indexCount/3,0)}const lQ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function UTt(e){return e.type==="web-style"?lQ:cQ(e.symbolLayers.toArray().map(t=>yxe(e,t)))}function cQ(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)M(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function kTt(e){const t=cQ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Tne={};function yxe(e,t){const i=vxe(e,t),r=rtt(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:ye(F({},htt(t.resource&&t.resource.primitive||jfe)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function vxe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Ya.EXTRUDE_EDGES:Ya.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?Ya.FILL_OUTLINE:Ya.FILL;case"water":return Ya.FILL;case"line":return t.join==="round"?Ya.LINE_ROUND:Ya.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Ya.PATH_ROUND_CIRCLE;case"quad":return Ya.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Ya.PATH_MITER_CIRCLE;case"quad":return Ya.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?Ya.OBJECT_POINT:Ya.OBJECT_POLYGON;case"icon":case"text":return i?Ya.ICON_POINT:Ya.ICON_POLYGON;default:return}}function htt(e){let t=Tne[e];if(t)return t;const i=pxe(e,null);return t={primitivesPerFeature:aQ(i.levels[0]).reduce((r,s)=>r+s.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Tne[e]=t,t}const Ya={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},t$=de.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class pm extends oQ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=t$,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Uu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Sne(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Sne(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&t$.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return t$.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return dtt}_defaultElevationInfoZ(){return ptt}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=_t(this._elevationContext.meterUnitOffset,_t(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Jet:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=Ene){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=Ene){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return hO(null,r);const s=_(t)?We.toUnitRGB(t):Rf;return hO(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=hO(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return yxe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Yr.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Yr.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Yr.RECREATE}),s}applyRendererDiff(t,i){return rn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?Fg(i.size.field,t):0,s=i.color?Fg(i.color.field,t):0,n=i.opacity?Fg(i.opacity.field,t):0;return vi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&t$.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,y,v,b,w;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(w=(b=(v=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:v.rotation)==null?void 0:b.field)!=null?w:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Fg(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Sne(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const dtt={mode:"on-the-ground",offset:0,unit:"meters"},ptt={mode:"absolute-height",offset:0,unit:"meters"},Ene={hasIntrinsicColor:!1};class kw{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=wl(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(ke(t,t,this.getStaticTransformation()),!0)}}kw.pool=new Ts(kw);class _4{constructor(t){this.channel=t,this.id=wl()}}class vy extends L3{constructor(t={}){super(),this.type=_p.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ee(),this._bvObjectSpace=new Cne,this._bvWorldSpace=new Cne,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new _xe),this.transformation=Ee();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){pt(r.length===i.length,"Object3D: materials don't match geometries"),pt(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=kw.pool.acquire(i[o],r[o],Zb(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){ws(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){pt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||Us,this._geometries.push(t);const o=kw.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new _4(Kg.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=gH(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=yH(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new _4(Kg.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=gH(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=yH(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return Dr(_t(i,Ee()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ee(),Dr(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}on(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),on(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=R(),i=R(),r=Tw(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(M(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=Tw(o);ke(t,n.getCenter(),o);const l=ur(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ke(i,t,this.transformation);const h=ur(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=rs(s),a=rs(n);ke(o,o,r),ke(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){ne(o,s),ne(a,n),o[l]=n[l],a[l]=s[l],ke(o,o,r),ke(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class _xe{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Cne extends _xe{constructor(){super(...arguments),this.bounds=bn()}init(){ie(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ie(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Tge(this.bounds)}}const bv=R();function uQ(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(Gr(t,bv,e.elevationProvider.spatialReference),_(c)&&!HW(c,bv))return null;Gr(t,bv,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(bv),p=new vy({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=Us;p.addGeometry(i[f],r[f],m,h,a)}return{object:p,sampledElevation:Fet(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function DR(e,t,i){const r=e.elevationContext,s=i.spatialReference;Gr(t,bv,s),r.centerPointInElevationSR=yy(bv[0],bv[1],t.hasZ?bv[2]:0,s)}function LR(e){switch(e.type){case"point":return e;case"polygon":case"extent":return iQ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Lpe(t,Dpe(t)/2);return yy(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function ftt(e){const t=new Xi;t.include(bZ),t.include(fwe,e),t.include(fs,e),t.attributes.add(O.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new oi("viewport",(s,n)=>n.camera.fullViewport),new Xe("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new mi("pixelToNDC",(s,n)=>fi(Mne,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Xe("borderSize",(s,n)=>_(s.borderColor)?n.camera.pixelRatio:0),new mi("screenOffset",(s,n)=>fi(Mne,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&VU(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new oi("uColor",s=>Ane(s.color)),new oi("borderColor",s=>Ane(s.borderColor))]),e.hasMultipassGeometry&&(r.include(L1e,e),r.uniforms.add(new mi("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Ane(e){return _(e)?e:Lf}const Mne=st(),mtt=Object.freeze(Object.defineProperty({__proto__:null,build:ftt},Symbol.toStringTag,{value:"Module"}));class QU extends dr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=QU.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}setPipelineState(t){const i=t?fr.ALWAYS:fr.LESS;return this.configuration.depthHudEnabled?zt({depthTest:{func:i},depthWrite:Dl}):zt({blending:uo(Oe.ONE,Oe.SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ri})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}QU.shader=new rr(mtt,()=>import("./LineCallout.glsl.66009c9c.js"));class hh extends na{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=yl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([j({count:yl.COUNT})],hh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],hh.prototype,"spherical",void 0),u([j()],hh.prototype,"occlusionTestEnabled",void 0),u([j()],hh.prototype,"hasVerticalOffset",void 0),u([j()],hh.prototype,"hasScreenSizePerspective",void 0),u([j()],hh.prototype,"depthHudEnabled",void 0),u([j()],hh.prototype,"depthHudAlignStartEnabled",void 0),u([j()],hh.prototype,"hasSlicePlane",void 0),u([j()],hh.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],hh.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],hh.prototype,"isDraped",void 0);class Ub extends hm{constructor(t){super(t,new ytt),this.techniqueConfig=new hh,this._uniqueMaterialIdentifier=Ub.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Te.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?yl.Screen:yl.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Te.LINE_CALLOUTS:case Te.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===K.Color?new gtt(t):null}createBufferWriter(){return new _tt}validateParameters(t){const i=Ub.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class gtt extends v_{beginSlot(t){return this.ensureTechnique(QU,t)}}class ytt extends WE{constructor(){super(...arguments),this.screenOffset=Gh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const vtt=ns().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),One=[La(0,0),La(1,0),La(0,1),La(1,0),La(1,1),La(0,1)];class _tt{constructor(){this.vertexBufferLayout=vtt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,i,r,s){GU(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,t.transformation,r.position,s,6),YZ(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,r.normal,s,6),K2(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<One.length;++n)r.uv0.setVec(s+n,One[n])}}class JU extends pm{constructor(t,i){super(t,null,i,xtt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Ub(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||Gh,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?We.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=no(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:no(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=_(i.border)&&_(i.border.color)?We.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:$r.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return wtt}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new Uu,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Zfe(l)))return null;const a=iQ(r.geometry);return M(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return M(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j3(JU.elevationModeChangeTypes,r,s);return n!==Yr.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return M(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Xh(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:lQ.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[O.POSITION,s],[O.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[O.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=Ub.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return M(s)&&(s=new Ub(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Ub(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new Nr(this._createVertexData(r),btt,El.Point)],o=this._getOrCreateMaterial(r),a=uQ(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new dm(this,a.object,n,o.isUnique?[o.material]:null,null,$R,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=Xh(i.mode),DR(l,t,this._context.elevationProvider),l}}JU.elevationModeChangeTypes={definedChanged:Yr.UPDATE,staysOnTheGround:Yr.UPDATE,onTheGroundChanged:Yr.RECREATE};const DV=new Uint16Array([0]),btt=[[O.POSITION,DV],[O.NORMAL,DV],[O.AUXPOS1,DV]],wtt={mode:"relative-to-ground",offset:0},xtt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Rne=de.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Ttt(e,t){if(!KW(e))return Rne.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=Stt[e.callout.type];return i?new i(e,t):(Rne.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Stt={line:JU};class Ett{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const Pne=new Ts(Array,e=>O5(e,Nfe),null,10,5),Ctt=Lt();class Att{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=Mtt(eo._COUNT,yu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?uxe(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(eo.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=eo.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===eo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(eo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=eo.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(M(i))return!1;this._extent=Lt(),Eet(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!z5(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=la.fromExtent(s.type==="mesh"?s.extent:s)),hke(s,i,r)}get usedMemory(){let t=ige(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(M(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=Tet(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:R(),num:0},draped:{origin:st(),num:0}};for(const i of this.graphics)M(i)||i.computeAttachmentOrigin(t);return t.render.num&&oe(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&pc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?pr(n.boundingBox):n.boundingBox=pr(),n.requiresDrapedElevation=!1,await Q5(this.graphics,async o=>{if(M(o))return;const a=o.type==="draped"?i:t,l=Pne.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&S2(n.boundingBox,l),Pne.release(l)}),q$e(n.boundingBox)||W9(qW(n.boundingBox,Ctt))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function Mtt(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Ine,$ne,Dne,bxe={exports:{}};Ine=bxe,$ne=function(){function e($,U,B){B=B||2;var H,W,Q,G,ee,me,_e,Me=U&&U.length,ve=Me?U[0]*B:$.length,ge=t($,0,ve,B,!0),Ce=[];if(!ge||ge.next===ge.prev)return Ce;if(Me&&(ge=l($,U,ge,B)),$.length>80*B){H=Q=$[0],W=G=$[1];for(var $e=B;$e<ve;$e+=B)(ee=$[$e])<H&&(H=ee),(me=$[$e+1])<W&&(W=me),ee>Q&&(Q=ee),me>G&&(G=me);_e=(_e=Math.max(Q-H,G-W))!==0?1/_e:0}return r(ge,Ce,B,H,W,_e),Ce}function t($,U,B,H,W){var Q,G;if(W===re($,U,B,H)>0)for(Q=U;Q<B;Q+=H)G=X(Q,$[Q],$[Q+1],G);else for(Q=B-H;Q>=U;Q-=H)G=X(Q,$[Q],$[Q+1],G);if(G&&C(G,G.next)){var ee=G.next;Y(G),G=ee}return G}function i($,U){if(!$)return $;U||(U=$);var B,H=$;do if(B=!1,H.steiner||!C(H,H.next)&&E(H.prev,H,H.next)!==0)H=H.next;else{var W=H.prev;if(Y(H),(H=U=W)===H.next)break;B=!0}while(B||H!==U);return U}function r($,U,B,H,W,Q,G){if($){!G&&Q&&y($,H,W,Q);for(var ee,me,_e=$;$.prev!==$.next;)if(ee=$.prev,me=$.next,Q?n($,H,W,Q):s($))U.push(ee.i/B),U.push($.i/B),U.push(me.i/B),Y($),$=me.next,_e=me.next;else if(($=me)===_e){G?G===1?r($=o(i($),U,B),U,B,H,W,Q,2):G===2&&a($,U,B,H,W,Q):r(i($),U,B,H,W,Q,1);break}}}function s($){var U=$.prev,B=$,H=$.next;if(E(U,B,H)>=0)return!1;for(var W=$.next.next;W!==$.prev;){if(S(U.x,U.y,B.x,B.y,H.x,H.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n($,U,B,H){var W=$.prev,Q=$,G=$.next;if(E(W,Q,G)>=0)return!1;for(var ee=W.x<Q.x?W.x<G.x?W.x:G.x:Q.x<G.x?Q.x:G.x,me=W.y<Q.y?W.y<G.y?W.y:G.y:Q.y<G.y?Q.y:G.y,_e=W.x>Q.x?W.x>G.x?W.x:G.x:Q.x>G.x?Q.x:G.x,Me=W.y>Q.y?W.y>G.y?W.y:G.y:Q.y>G.y?Q.y:G.y,ve=b(ee,me,U,B,H),ge=b(_e,Me,U,B,H),Ce=$.prevZ,$e=$.nextZ;Ce&&Ce.z>=ve&&$e&&$e.z<=ge;){if(Ce!==$.prev&&Ce!==$.next&&S(W.x,W.y,Q.x,Q.y,G.x,G.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,$e!==$.prev&&$e!==$.next&&S(W.x,W.y,Q.x,Q.y,G.x,G.y,$e.x,$e.y)&&E($e.prev,$e,$e.next)>=0))return!1;$e=$e.nextZ}for(;Ce&&Ce.z>=ve;){if(Ce!==$.prev&&Ce!==$.next&&S(W.x,W.y,Q.x,Q.y,G.x,G.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;$e&&$e.z<=ge;){if($e!==$.prev&&$e!==$.next&&S(W.x,W.y,Q.x,Q.y,G.x,G.y,$e.x,$e.y)&&E($e.prev,$e,$e.next)>=0)return!1;$e=$e.nextZ}return!0}function o($,U,B){var H=$;do{var W=H.prev,Q=H.next.next;!C(W,Q)&&A(W,H,H.next,Q)&&k(W,Q)&&k(Q,W)&&(U.push(W.i/B),U.push(H.i/B),U.push(Q.i/B),Y(H),Y(H.next),H=$=Q),H=H.next}while(H!==$);return i(H)}function a($,U,B,H,W,Q){var G=$;do{for(var ee=G.next.next;ee!==G.prev;){if(G.i!==ee.i&&T(G,ee)){var me=V(G,ee);return G=i(G,G.next),me=i(me,me.next),r(G,U,B,H,W,Q),void r(me,U,B,H,W,Q)}ee=ee.next}G=G.next}while(G!==$)}function l($,U,B,H){var W,Q,G,ee=[];for(W=0,Q=U.length;W<Q;W++)(G=t($,U[W]*H,W<Q-1?U[W+1]*H:$.length,H,!1))===G.next&&(G.steiner=!0),ee.push(w(G));for(ee.sort(c),W=0;W<ee.length;W++)B=i(B=p(ee[W],B),B.next);return B}function c($,U){return $.x-U.x}function h($){if($.next.prev===$)return $;let U=$;for(;;){const B=U.next;if(B.prev===U||B===U||B===$)break;U=B}return U}function p($,U){var B=f($,U);if(!B)return U;var H=V(B,$),W=i(B,B.next);let Q=h(H);return i(Q,Q.next),W=h(W),h(U===B?W:U)}function f($,U){var B,H=U,W=$.x,Q=$.y,G=-1/0;do{if(Q<=H.y&&Q>=H.next.y&&H.next.y!==H.y){var ee=H.x+(Q-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(ee<=W&&ee>G){if(G=ee,ee===W){if(Q===H.y)return H;if(Q===H.next.y)return H.next}B=H.x<H.next.x?H:H.next}}H=H.next}while(H!==U);if(!B)return null;if(W===G)return B;var me,_e=B,Me=B.x,ve=B.y,ge=1/0;H=B;do W>=H.x&&H.x>=Me&&W!==H.x&&S(Q<ve?W:G,Q,Me,ve,Q<ve?G:W,Q,H.x,H.y)&&(me=Math.abs(Q-H.y)/(W-H.x),k(H,$)&&(me<ge||me===ge&&(H.x>B.x||H.x===B.x&&m(B,H)))&&(B=H,ge=me)),H=H.next;while(H!==_e);return B}function m($,U){return E($.prev,$,U.prev)<0&&E(U.next,$,$.next)<0}function y($,U,B,H){var W=$;do W.z===null&&(W.z=b(W.x,W.y,U,B,H)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==$);W.prevZ.nextZ=null,W.prevZ=null,v(W)}function v($){var U,B,H,W,Q,G,ee,me,_e=1;do{for(B=$,$=null,Q=null,G=0;B;){for(G++,H=B,ee=0,U=0;U<_e&&(ee++,H=H.nextZ);U++);for(me=_e;ee>0||me>0&&H;)ee!==0&&(me===0||!H||B.z<=H.z)?(W=B,B=B.nextZ,ee--):(W=H,H=H.nextZ,me--),Q?Q.nextZ=W:$=W,W.prevZ=Q,Q=W;B=H}Q.nextZ=null,_e*=2}while(G>1);return $}function b($,U,B,H,W){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-B)*W)|$<<8))|$<<4))|$<<2))|$<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=32767*(U-H)*W)|U<<8))|U<<4))|U<<2))|U<<1))<<1}function w($){var U=$,B=$;do(U.x<B.x||U.x===B.x&&U.y<B.y)&&(B=U),U=U.next;while(U!==$);return B}function S($,U,B,H,W,Q,G,ee){return(W-G)*(U-ee)-($-G)*(Q-ee)>=0&&($-G)*(H-ee)-(B-G)*(U-ee)>=0&&(B-G)*(Q-ee)-(W-G)*(H-ee)>=0}function T($,U){return $.next.i!==U.i&&$.prev.i!==U.i&&!D($,U)&&(k($,U)&&k(U,$)&&z($,U)&&(E($.prev,$,U.prev)||E($,U.prev,U))||C($,U)&&E($.prev,$,$.next)>0&&E(U.prev,U,U.next)>0)}function E($,U,B){return(U.y-$.y)*(B.x-U.x)-(U.x-$.x)*(B.y-U.y)}function C($,U){return $.x===U.x&&$.y===U.y}function A($,U,B,H){var W=L(E($,U,B)),Q=L(E($,U,H)),G=L(E(B,H,$)),ee=L(E(B,H,U));return W!==Q&&G!==ee||!(W!==0||!I($,B,U))||!(Q!==0||!I($,H,U))||!(G!==0||!I(B,$,H))||!(ee!==0||!I(B,U,H))}function I($,U,B){return U.x<=Math.max($.x,B.x)&&U.x>=Math.min($.x,B.x)&&U.y<=Math.max($.y,B.y)&&U.y>=Math.min($.y,B.y)}function L($){return $>0?1:$<0?-1:0}function D($,U){var B=$;do{if(B.i!==$.i&&B.next.i!==$.i&&B.i!==U.i&&B.next.i!==U.i&&A(B,B.next,$,U))return!0;B=B.next}while(B!==$);return!1}function k($,U){return E($.prev,$,$.next)<0?E($,U,$.next)>=0&&E($,$.prev,U)>=0:E($,U,$.prev)<0||E($,$.next,U)<0}function z($,U){var B=$,H=!1,W=($.x+U.x)/2,Q=($.y+U.y)/2;do B.y>Q!=B.next.y>Q&&B.next.y!==B.y&&W<(B.next.x-B.x)*(Q-B.y)/(B.next.y-B.y)+B.x&&(H=!H),B=B.next;while(B!==$);return H}function V($,U){var B=new le($.i,$.x,$.y),H=new le(U.i,U.x,U.y),W=$.next,Q=U.prev;return $.next=U,U.prev=$,B.next=W,W.prev=B,H.next=B,B.prev=H,Q.next=H,H.prev=Q,H}function X($,U,B,H){var W=new le($,U,B);return H?(W.next=H.next,W.prev=H,H.next.prev=W,H.next=W):(W.prev=W,W.next=W),W}function Y($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function le($,U,B){this.i=$,this.x=U,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function re($,U,B,H){for(var W=0,Q=U,G=B-H;Q<B;Q+=H)W+=($[G]-$[Q])*($[Q+1]+$[G+1]),G=Q;return W}return e.deviation=function($,U,B,H){var W=U&&U.length,Q=W?U[0]*B:$.length,G=Math.abs(re($,0,Q,B));if(W)for(var ee=0,me=U.length;ee<me;ee++){var _e=U[ee]*B,Me=ee<me-1?U[ee+1]*B:$.length;G-=Math.abs(re($,_e,Me,B))}var ve=0;for(ee=0;ee<H.length;ee+=3){var ge=H[ee]*B,Ce=H[ee+1]*B,$e=H[ee+2]*B;ve+=Math.abs(($[ge]-$[$e])*($[Ce+1]-$[ge+1])-($[ge]-$[Ce])*($[$e+1]-$[ge+1]))}return G===0&&ve===0?0:Math.abs((ve-G)/G)},e.flatten=function($){for(var U=$[0][0].length,B={vertices:[],holes:[],dimensions:U},H=0,W=0;W<$.length;W++){for(var Q=0;Q<$[W].length;Q++)for(var G=0;G<U;G++)B.vertices.push($[W][Q][G]);W>0&&(H+=$[W-1].length,B.holes.push(H))}return B},e},(Dne=$ne())!==void 0&&(Ine.exports=Dne);const iE=bxe.exports,KU=de.getLogger("esri.views.3d.support.buffer.math");function sy(e,t,i){if(e.count!==t.count)return void KU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],v=i[14],b=e.typedBuffer,w=e.typedBufferStride,S=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<r;E++){const C=E*w,A=E*T,I=S[A],L=S[A+1],D=S[A+2];b[C]=s*I+a*L+h*D+m,b[C+1]=n*I+l*L+p*D+y,b[C+2]=o*I+c*L+f*D+v}}function Yh(e,t,i){if(e.count!==t.count)return void KU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,T=w*b,E=v[T],C=v[T+1],A=v[T+2];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A}}function IH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function hQ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function Ott(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:sy,transformMat3:Yh,scale:IH,normalize:hQ,shiftRight:Ott},Symbol.toStringTag,{value:"Module"}));function ek(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function Rtt(e,t){if(_(e.symbol))return e.symbol;const i=ek(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function zTt(e,t){const i=ek(e,t),r=Rtt(e,t);if(M(r))return null;const s={renderer:i,symbol:r};if(M(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=pY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Ptt(e,t){if(_(e.symbol))return e.symbol;const i=ek(e,t);return _(i)&&i.getSymbolAsync(e,t)}async function VTt(e,t){const i=ek(e,t),r=await Ptt(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=pY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=We.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Itt(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function $tt(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function wxe(e,t,i){var C;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(C=i==null?void 0:i.minReduction)!=null?C:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=r;const p=Math.floor(1.1*h)+1;(Op==null||Op.length<2*p)&&(Op=new Uint32Array(m2(2*p)));for(let A=0;A<2*p;A++)Op[A]=0;let f=0;const m=!!c&&!!a,y=m?l:r,v=m?new Uint32Array(l):null,b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):y,S=1,T=c?c[1]:y;for(let A=0;A<y;A++){if(A===w){const V=1-f/A;if(V+b*Math.sqrt(V*(1-V)/A)<o)return null;w*=2}if(A===T){for(let V=0;V<2*p;V++)Op[V]=0;if(a)for(let V=c[S-1];V<c[S];V++)v[V]=n[a[V]];T=c[++S]}const I=m?a[A]:A,L=I*t,D=Ntt(s,L,t);let k=D%p,z=f;for(;Op[2*k+1]!==0;){if(Op[2*k]===D){const V=Op[2*k+1]-1;if(Dtt(s,L,V*t,t)){z=n[V];break}}k++,k>=p&&(k-=p)}z===f&&(Op[2*k]=D,Op[2*k+1]=I+1,f++),n[I]=z}if(o!==0&&1-f/r<o)return null;if(m){for(let A=c[S-1];A<v.length;A++)v[A]=n[a[A]];n=v}const E=new Uint32Array(t*f);f=0;for(let A=0;A<y;A++)n[A]===f&&(Ltt(s,(m?a[A]:A)*t,E,f*t,t),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=n[a[I]];n=A}return{buffer:E.buffer,indices:n,uniqueCount:f}}function Dtt(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function Ltt(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function Ntt(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Op=null;function Ftt(e){const t=q3(e.rings,e.hasZ,Qf.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(iE(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=Utt(i,r,s),o=wxe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function Utt(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function q3(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=e[m],v=i===Qf.CCW_IS_HOLE&&ktt(y);if(v&&r!==1)s[a++]=y;else{let b=y.length;for(let S=0;S<a;++S)b+=s[S].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=v?i$(y,y.length-1,-1,p,f,y.length,t):i$(y,0,1,p,f,y.length,t);for(let S=0;S<a;++S){const T=s[S];w.holeIndices[S]=f,w.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=i$(T,0,1,p,f,T.length,t)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=i$(y,0,1,p,f,y.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function i$(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function ktt(e){return!PW(e,!1,!1)}var Qf;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Qf||(Qf={}));var dO,$H;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(dO||(dO={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}($H||($H={}));var Fr,Ch,kt,rE,vs,Ln;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Fr||(Fr={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ch||(Ch={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(kt||(kt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(rE||(rE={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(vs||(vs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Ln||(Ln={}));class ztt{constructor(t,i){this.vec3=t,this.id=i}}function pO(e,t,i,r){return new ztt(Ue(e,t,i),r)}var Ia;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(Ia||(Ia={}));class Lne{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=Lt(),this.resolution=0,this.renderLocalOrigin=pO(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Btt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Ia.ColorAndWater?this.renderTargets.getTarget(vs.Color):t===Ia.Highlight?this.renderTargets.getTarget(vs.Highlight):this.renderTargets.getTarget(vs.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(vs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(vs.Color):null}getNormalTexture(t){const i=t===Ia.ColorAndWater?this.renderTargets.getTarget(vs.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==vs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?V2.CHANGED:V2.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[vs.Color]|+t[vs.ColorNoRasterImage]<<1|+t[vs.Highlight]<<2|+t[vs.Water]<<3|+t[vs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];cF(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];cF(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Xg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Fr.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function Vtt(e,t,i){return Math.min(m2(Math.max(e,t)+256),i)}class Btt{constructor(){this.extents=[Lt(),Lt(),Lt()],this.numViews=0}}class xxe{constructor(t,i){this.size=pZ(),this._fbo=null,this._fbo=new Cr(t,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Je(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class Gtt{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new xxe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(Be.MATERIAL,vs.Color),i(Be.MATERIAL,vs.ColorNoRasterImage),i(Be.MATERIAL_HIGHLIGHT,vs.Highlight,!1),i(Be.MATERIAL_NORMAL,vs.Water),i(Be.MATERIAL,vs.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>jtt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const jtt=1e3;class dQ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class Txe{constructor(t){this._context=t,this._perConstructorInstances=new dQ,this._frameCounter=0,this._keepAliveFrameCount=Nne}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(M(s)){const n=new t(this._context,i,()=>this.release(n));s=new Htt(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(M(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);M(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Nne&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class Htt{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const Nne=-1,tk=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class ik extends tk(class{}){}function So(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const qtt=de.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class Sxe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new dQ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(M(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new Wtt(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(Je(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&qtt.error("Material is already owned by a different material repository"),t.repository=this}}class Wtt{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,pt(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const Xtt={orderedRepackingEnabled:!1},Ytt={rootOrigin:null},Ztt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class sE{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new es,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),es.clearPool(),DH[0]=null,G_.prune(),Z1.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=es.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}es.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=es.acquire();for(const s of t){const n=_(i)?i:O2(this._objectToBoundingSphere(s),tit);gM(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}es.release(r),this._shrink()}update(t,i){if(!gM(i[3])&&this._isDegenerate(t))return;const r=eit(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=Du(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=Du(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=LV(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!vv(r,f))return;const m=q0(t,i,f),y=m-f[3],v=m+f[3];y<o&&(o=y,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!vv(r,p.bounds)||(oe(Hu,c,p.halfSize),pe(Hu,Hu,p.bounds),q0(t,i,Hu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===sE.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=q0(i,r,t),f=LV(i,r),m=LV(i,-r),y=v=>{if(!a(v))return;const b=this._objectToBoundingSphere(v),w=b,S=q0(i,r,w)-p,T=S-b[3],E=S+b[3];T>c||E<l||!vv(o,b)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!vv(o,v.bounds)||(oe(Hu,f,v.halfSize),pe(Hu,Hu,v.bounds),q0(i,r,Hu)-p>c)||(oe(Hu,m,v.halfSize),pe(Hu,Hu,v.bounds),q0(i,r,Hu)-p<l))return!1;const b=v.node;return b.terminals.forAll(w=>y(w)),b.residents!==null&&b.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=Ig(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=Ig(a),c=r+l;_n(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Ig(o.bounds),l=r+a;if(_n(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return r$(i.bounds,2*-i.halfSize,su),r$(i.bounds,2*i.halfSize,nu),Kre(t.origin,t.direction,su,nu)}_intersectsNodeWithOffset(t,i,r){return r$(i.bounds,2*-i.halfSize,su),r$(i.bounds,2*i.halfSize,nu),r.applyToMinMax(su,nu),Kre(t.origin,t.direction,su,nu)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||BG(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||BG(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=es.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(es.acquire().init(r).advance(n));es.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=sE.DepthOrder.FRONT_TO_BACK){let n=es.acquire().init(t);const o=[n];for(Ktt(r,s,kne);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=kne[a];n.node.children[l]&&o.push(es.acquire().init(n).advance(l))}es.release(n)}}_remove(t,i,r){G_.clear();const s=r.advanceTo(i,(n,o)=>{G_.push(n.node),G_.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=G_.length-2;n>=0;n-=2){const o=G_.data[n],a=G_.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new It({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=es.acquire().init(t);this._add(i.getItemAt(r),s),es.release(s)}}_grow(t,i){if(i!==0&&(Fne(t,i,r=>this._objectToBoundingSphere(r),Rp),gM(Rp[3])&&!this._fitsInsideTree(Rp)))if(this._nodeIsEmpty(this._root.node))O2(Rp,this._root.bounds),this._root.halfSize=1.25*Rp[3];else{const r=this._rootBoundsForRootAsSubNode(Rp);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Rp,r):this._growRootAsSubNode(r),es.release(r)}}_rebuildTree(t,i){ne(FV,i.bounds),FV[3]=i.halfSize,Fne([t,FV],2,s=>s,UV);const r=es.acquire().init(this._root);this._root.initFrom(null,UV,1.25*UV[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),es.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),s$[a].min=h,s$[a].max=p}for(let a=0;a<3;a++){let l=s$[a].min,c=s$[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;NV[a]=p+(c+l)*o}return NV[3]=s*o*Cxe,es.acquire().initFrom(null,NV,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;ne(Rp,this._root.bounds),Rp[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Rp,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!gM(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class es{constructor(){this.bounds=bn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:es.createEmptyNode(),_(i)&&O2(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=es.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=Exe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*Cxe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new It({shrink:!0}),residents:new It({shrink:!0})}}static acquire(){return es._pool.acquire()}static release(t){es._pool.release(t)}static clearPool(){es._pool.prune()}}function Qtt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Jtt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function r$(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Fne(e,t,i,r){if(t===1){const s=i(e[0]);O2(s,r)}else{su[0]=1/0,su[1]=1/0,su[2]=1/0,nu[0]=-1/0,nu[1]=-1/0,nu[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);gM(n[3])&&(Qtt(su,n),Jtt(nu,n))}on(r,su,nu,.5),r[3]=Math.max(nu[0]-su[0],nu[1]-su[1],nu[2]-su[2])/2}}function Ktt(e,t,i){if(!Z1.length)for(let r=0;r<8;++r)Z1.push({index:0,distance:0});for(let r=0;r<8;++r){const s=Exe[r];Z1.data[r].index=r,Z1.data[r].distance=q0(e,t,s)}Z1.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Z1.data[r].index}function LV(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=q0(e,t,Une[s]);n<i&&(i=n,r=Une[s])}return r}function q0(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function gM(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}es._pool=new Ts(es),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(sE||(sE={}));const Exe=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],Une=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],Cxe=Math.sqrt(3),DH=[null];function eit(e){return DH[0]=e,DH}const NV=bn(),Hu=R(),su=R(),nu=R(),G_=new It,tit=bn(),Rp=bn(),FV=bn(),UV=bn(),s$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Z1=new It,kne=[0,0,0,0,0,0,0,0],ip=sE;class Axe extends L3{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=_p.Layer,this.events=new Zr,this.isSliceable=!1,this._objects=new It,this._stageHandles=new si,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:z2.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of Ztt)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==z2.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return M(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=at(this._octree)}_createOctree(){this._octree=new ip(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function b4(e){return _(e)&&e.type===_p.Layer}class Mxe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,zw(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,zw(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===lc.LOADED)return r;this._repository.requestRender()}return null}}function zw(e){switch(e){case Be.MATERIAL:return K.Color;case Be.MATERIAL_ALPHA:return K.Alpha;case Be.MATERIAL_DEPTH:return K.Depth;case Be.MATERIAL_NORMAL:return K.Normal;case Be.MATERIAL_DEPTH_SHADOWMAP_ALL:return K.Shadow;case Be.MATERIAL_HIGHLIGHT:return K.Highlight;case Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return K.Shadow}}const zne=8;function Oxe(e,t){const i=e.vertex;i.uniforms.add(new Xe("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(O.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new sa("vvOpacityValues",r=>r.vvOpacityValues,zne),new sa("vvOpacityOpacities",r=>r.vvOpacityOpacities,zne)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",lp),i.uniforms.add(new sa("vvColorValues",r=>r.vvColorValues,lp)),i.uniforms.add(new HU("vvColorColors",r=>r.vvColorColors,lp)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(O.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function w_(e,t){e.fragment.include(Mc),t.output===K.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===K.Depth&&e.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function iit(e){return M(e)?Lf:e.length===4?e:Ji(rit,e[0],e[1],e[2],1)}const rit=qt();function Rxe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?sit(e,t):nit(e)}function sit(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(Mc),r.uniforms.add(new Ui("stipplePatternPixelSize")),t.draped||(Zf(r,t),r.uniforms.add(new Xe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${oit};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new Xe("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new kr("stipplePatternTexture")),s.uniforms.add(new Ui("stipplePatternSDFNormalizer")),s.uniforms.add(new Ui("stipplePatternTextureSize")),s.uniforms.add(new Ui("stipplePatternPixelSizeInv")),s.code.add(x`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new oi("stippleOffColor",n=>iit(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function nit(e){e.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const oit=x.float(.4);var kh;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(kh||(kh={}));class jr extends na{constructor(){super(...arguments),this.output=K.Color,this.capType=kh.BUTT,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([j({count:K.COUNT})],jr.prototype,"output",void 0),u([j({count:kh.COUNT})],jr.prototype,"capType",void 0),u([j({count:yt.COUNT})],jr.prototype,"transparencyPassType",void 0),u([j()],jr.prototype,"occluder",void 0),u([j()],jr.prototype,"hasSlicePlane",void 0),u([j()],jr.prototype,"hasPolygonOffset",void 0),u([j()],jr.prototype,"writeDepth",void 0),u([j()],jr.prototype,"draped",void 0),u([j()],jr.prototype,"stippleEnabled",void 0),u([j()],jr.prototype,"stippleOffColorEnabled",void 0),u([j()],jr.prototype,"stippleScaleWithLineWidth",void 0),u([j()],jr.prototype,"stipplePreferContinuous",void 0),u([j()],jr.prototype,"roundJoins",void 0),u([j()],jr.prototype,"vvSize",void 0),u([j()],jr.prototype,"vvColor",void 0),u([j()],jr.prototype,"vvOpacity",void 0),u([j()],jr.prototype,"falloffEnabled",void 0),u([j()],jr.prototype,"innerColorEnabled",void 0),u([j()],jr.prototype,"hasOccludees",void 0),u([j()],jr.prototype,"hasMultipassTerrain",void 0),u([j()],jr.prototype,"cullAboveGround",void 0),u([j()],jr.prototype,"wireframe",void 0),u([j({constValue:!0})],jr.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],jr.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],jr.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],jr.prototype,"hasSliceTranslatedView",void 0);const w4=1;function ait(e){const t=new Xi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(SU),t.include(Oxe,e),t.include(Rxe,e),e.output===K.Depth&&t.include(w_,e),Ou(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new xr("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new mi("nearFar",(f,m)=>m.camera.nearFar),new Xe("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new oi("viewport",(f,m)=>m.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.SUBDIVISIONFACTOR,"float"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.attributes.add(O.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===kh.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new Xe("pixelRatio",(f,m)=>m.camera.pixelRatio)),r.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?x`vLineWidth = lineWidth;`:""}
      ${a?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((w4+2)/(w4+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==kh.BUTT;return r.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new Xe("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):r.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(x`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(Nu,e),t.include(fs,e),s.include(cm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(Do)}) {
        discard;
      }
    `),c?s.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(Do)}, stippleCoverage);
      `):s.code.add(x`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new oi("intrinsicColor",f=>f.color)),s.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new oi("innerColor",f=>_t(f.innerColor,f.color))),s.uniforms.add(new Xe("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new Xe("falloff",f=>f.falloff)),s.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(x`
    if (finalColor.a < ${x.float(Do)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const lit=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:w4,build:ait},Symbol.toStringTag,{value:"Module"})),pQ={func:fr.LESS},x4={func:fr.ALWAYS},Jf={mask:255},Pxe={mask:0},cit=e=>({function:{func:fr.NOTEQUAL,ref:e,mask:e},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}}),uit=e=>({function:{func:fr.ALWAYS,ref:e,mask:e},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.REPLACE}}),x_={function:{func:fr.ALWAYS,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.ZERO}},u_={function:{func:fr.ALWAYS,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.REPLACE}},Ixe={function:{func:fr.EQUAL,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}},$xe={function:{func:fr.NOTEQUAL,ref:Sl.OutlineVisualElementMask,mask:Sl.OutlineVisualElementMask},operation:{fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP}},Dxe=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);class rk extends dr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=rk.shader.get().build(this.configuration);return new sr(t.rctx,i,Dxe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return zt({blending:r.output===K.Color||r.output===K.Alpha?s?Ru:gy(t):null,depthTest:{func:b_(t)},depthWrite:s?r.writeDepth&&Dl:qU(t),colorWrite:ri,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?u_:x_:null,polygonOffset:s||n?r.hasPolygonOffset&&Vne:XU})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&Vne;this._occluderPipelineTransparent=zt({blending:Ru,polygonOffset:i,depthTest:x4,depthWrite:null,colorWrite:ri,stencilWrite:null,stencilTest:$xe}),this._occluderPipelineOpaque=zt({blending:Ru,polygonOffset:i,depthTest:x4,depthWrite:null,colorWrite:ri,stencilWrite:Pxe,stencilTest:Ixe}),this._occluderPipelineMaskWrite=zt({blending:null,polygonOffset:i,depthTest:pQ,depthWrite:null,colorWrite:null,stencilWrite:Jf,stencilTest:u_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?$t.LINES:$t.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Te.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Te.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}rk.shader=new rr(lit,()=>import("./RibbonLine.glsl.218cbe0a.js"));const Vne={factor:0,units:-4},hit=de.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var tc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(tc||(tc={}));class OS extends hm{constructor(t){super(t,new pit),this._vertexAttributeLocations=Dxe,this.techniqueConfig=new jr,this.layout=this.createLayout()}isClosed(t,i){return Lxe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Te.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==K.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===$r.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(O.POSITION).data,a=t.vertexAttributes.get(O.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=t.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Ne(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],b=o[y+1],w=c-v,S=h-b,T=o[y+3]-v,E=o[y+4]-b,C=Ne((T*w+E*S)/(T*T+E*E),0,1),A=T*C-w,I=E*C-S,L=A*A+I*I;L<f&&(f=L,m=y/3)}f<p*p&&n(r.dist,r.normal,m,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||N3(i))return;if(!G1e(r))return void hit.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(O.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const w=o.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Ne(this.parameters.vvSizeOffset[0]+w*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(O.SIZE)&&(l*=o.get(O.SIZE).data[0]);const c=s.camera,h=mit;co(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;ie(DC[0],h[0]-p,h[1]+p,0),ie(DC[1],h[0]+p,h[1]+p,0),ie(DC[2],h[0]+p,h[1]-p,0),ie(DC[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!c.unprojectFromRenderScreen(DC[w],Tm[w]))return;ia(c.eye,Tm[0],Tm[1],zV),ia(c.eye,Tm[1],Tm[2],VV),ia(c.eye,Tm[2],Tm[3],BV),ia(c.eye,Tm[3],Tm[0],GV);let f=Number.MAX_VALUE,m=0;const y=LH(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let w=0;w<y;w+=3){Za[0]=a[w]+r[12],Za[1]=a[w+1]+r[13],Za[2]=a[w+2]+r[14];const S=(w+3)%a.length;if(Qa[0]=a[S]+r[12],Qa[1]=a[S+1]+r[13],Qa[2]=a[S+2]+r[14],lr(zV,Za)<0&&lr(zV,Qa)<0||lr(VV,Za)<0&&lr(VV,Qa)<0||lr(BV,Za)<0&&lr(BV,Qa)<0||lr(GV,Za)<0&&lr(GV,Qa)<0)continue;if(c.projectToRenderScreen(Za,H_),c.projectToRenderScreen(Qa,q_),H_[2]<0&&q_[2]>0){fe(Pp,Za,Qa);const E=c.frustum,C=-lr(E[ar.NEAR],Za)/Se(Pp,E[ar.NEAR]);oe(Pp,Pp,C),pe(Za,Za,Pp),c.projectToRenderScreen(Za,H_)}else if(H_[2]>0&&q_[2]<0){fe(Pp,Qa,Za);const E=c.frustum,C=-lr(E[ar.NEAR],Qa)/Se(Pp,E[ar.NEAR]);oe(Pp,Pp,C),pe(Qa,Qa,Pp),c.projectToRenderScreen(Qa,q_)}else if(H_[2]<0&&q_[2]<0)continue;H_[2]=0,q_[2]=0;const T=_X(Qb(H_,q_,jne),h);T<f&&(f=T,ne(Bne,Za),ne(Gne,Qa),m=w/3)}const v=s.rayBegin,b=s.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(_ge(Qb(Bne,Gne,jne),Qb(v,b,git),j_)){fe(j_,j_,v);const S=Re(j_);oe(j_,j_,1/S),w=S/ur(v,b)}n(w,j_,m,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(O.POSITION);return _Z(n,s?s.get(O.POSITION):null,s&&LH(this.parameters,r,s),i)}createLayout(){const t=ns().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new fit(this.layout,this.parameters)}requiresSlot(t,i){if(t===Te.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===$r.OccludeAndTransparentStencil)return t===Te.OPAQUE_MATERIAL||t===Te.OCCLUDER_MATERIAL||t===Te.TRANSPARENT_OCCLUDER_MATERIAL;const r=zw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Te.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new dit(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class dit extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(rk,t)}}class pit extends KZ{constructor(){super(...arguments),this.width=0,this.color=Ph,this.join="miter",this.cap=kh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class fit{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=w4+r}}_isClosed(t){return LH(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(O.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var V;const n=yit,o=vit,a=_it,l=i.vertexAttributes.get(O.POSITION).data,c=i.indices&&i.indices.get(O.POSITION),h=(V=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:V.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(p=i.vertexAttributes.get(O.SIZE).data[0]);let m=[1,1,1,1],y=0;this.parameters.vvColorEnabled?y=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(m=i.vertexAttributes.get(O.COLOR).data);let v=0;this.parameters.vvOpacityEnabled&&(v=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const b=l.length/3,w=t.transformation,S=new Float32Array(r.buffer),T=this.vertexBufferLayout.stride/4;let E=s*T;const C=E;let A=0;const I=h?(X,Y,le)=>A=h[le]:(X,Y,le)=>A+=ur(X,Y),L=(X,Y,le,re,$,U,B)=>{if(S[E++]=Y[0],S[E++]=Y[1],S[E++]=Y[2],S[E++]=re,S[E++]=B,S[E++]=$,S[E++]=X[0],S[E++]=X[1],S[E++]=X[2],S[E++]=le[0],S[E++]=le[1],S[E++]=le[2],this.parameters.vvSizeEnabled?S[E++]=f:S[E++]=p,this.parameters.vvColorEnabled)S[E++]=y;else{const H=Math.min(4*U,m.length-4);S[E++]=m[H+0],S[E++]=m[H+1],S[E++]=m[H+2],S[E++]=m[H+3]}this.parameters.vvOpacityEnabled&&(S[E++]=v)};E+=T,ie(o,l[0],l[1],l[2]),w&&ke(o,o,w);const D=this._isClosed(i);if(D){const X=l.length-3;ie(n,l[X],l[X+1],l[X+2]),w&&ke(n,n,w)}else ie(a,l[3],l[4],l[5]),w&&ke(a,a,w),L(o,o,a,1,tc.LEFT_CAP_START,0,0),L(o,o,a,1,tc.RIGHT_CAP_START,0,0),ne(n,o),ne(o,a);const k=D?0:1,z=D?b:b-1;for(let X=k;X<z;X++){const Y=(X+1)%b*3;ie(a,l[Y+0],l[Y+1],l[Y+2]),w&&ke(a,a,w),I(n,o,X),L(n,o,a,0,tc.LEFT_JOIN_END,X,A),L(n,o,a,0,tc.RIGHT_JOIN_END,X,A);const le=this.numJoinSubdivisions;for(let re=0;re<le;++re){const $=(re+1)/(le+1);L(n,o,a,$,tc.LEFT_JOIN_END,X,A),L(n,o,a,$,tc.RIGHT_JOIN_END,X,A)}L(n,o,a,1,tc.LEFT_JOIN_START,X,A),L(n,o,a,1,tc.RIGHT_JOIN_START,X,A),ne(n,o),ne(o,a)}D?(ie(a,l[3],l[4],l[5]),w&&ke(a,a,w),A=I(n,o,z),L(n,o,a,0,tc.LEFT_JOIN_END,k,A),L(n,o,a,0,tc.RIGHT_JOIN_END,k,A)):(A=I(n,o,z),L(n,o,o,0,tc.LEFT_CAP_END,z,A),L(n,o,o,0,tc.RIGHT_CAP_END,z,A)),kV(S,C+T,S,C,T),E=kV(S,E-T,S,E,T),this.parameters.wireframe&&this._addWireframeVertices(r,C,E,T)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=kV(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function kV(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function LH(e,t,i){return Lxe(e,t.get(O.POSITION).data,i?i.get(O.POSITION):null)}function Lxe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const Za=R(),Qa=R(),Pp=R(),j_=R(),mit=R(),H_=Ro(),q_=Ro(),Bne=R(),Gne=R(),jne=nm(),git=nm(),yit=R(),vit=R(),_it=R(),DC=[Ro(),Ro(),Ro(),Ro()],Tm=[R(),R(),R(),R()],zV=Ei(),VV=Ei(),BV=Ei(),GV=Ei();class fQ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+wl()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=Ytt.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,pO(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=pO(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(fe(kn,t,i.vec3),kn[0]=Math.abs(kn[0]),kn[1]=Math.abs(kn[1]),kn[2]=Math.abs(kn[2]),kn[0]<c&&kn[1]<c&&kn[2]<c){if(l){const h=Math.max(...kn);if(fe(kn,t,l.vec3),kn[0]=Math.abs(kn[0]),kn[1]=Math.abs(kn[1]),kn[2]=Math.abs(kn[2]),Math.max(...kn)<h)return l}return i}return l||(l=pO(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=vi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new OS({width:2,color:i}),s.add(this._material);const m=new Axe({isPickable:!1}),y=new vy({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);tr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Nr([[O.POSITION,{size:3,data:c,exclusive:!0}]],[[O.POSITION,h]],El.Line);s.add(f),o.addGeometry(f,this._material,Us)}}const kn=R();class Nxe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new qi,this.pass=Be.MATERIAL,this.renderOccludedMask=Hne,this.bindParameters=new OU(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=Hne}get isHighlightPass(){return this.pass===Be.MATERIAL_HIGHLIGHT}}class bit extends Nxe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const Hne=$r.Occlude|$r.OccludeAndTransparent|$r.OccludeAndTransparentStencil;var nE;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(nE||(nE={}));class n${constructor(){this.camera=new qi,this.lightMat=Ee()}}class mQ{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=qt(),this._cascades=[new n$,new n$,new n$,new n$],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Ji(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=Ne(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)HV[t]=this._cascades[t];return HV.length=this.numCascades,HV}start(t,i,r){pt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){pt(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!ka(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||R(),ne(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){ca(toe,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)ioe[16*i+r]=toe[r]}}return ioe}takeCascadeSnapshotTo(t,i){pt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,ot.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(ft.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,ot.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(Ki.COLOR_BUFFER_BIT|Ki.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ot(this.rctx,t),this._fbo=new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new ot(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=Je(this._fbo),this._depthTexture=Je(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Je(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);pt(l<c);for(let p=0;p<8;++p){Ji(Yne,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),bu(Ql[p],Yne,Xne);for(let f=0;f<3;++f)Ql[p][f]/=Ql[p][3]}oa(jV,Ql[0]),ca(qne,eoe,jV),n.camera.viewMatrix=qne;for(let p=0;p<8;++p)ke(Ql[p],Ql[p],n.camera.viewMatrix);ne(Ip,Ql[0]),ne($p,Ql[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)Ip[f]=Math.min(Ip[f],Ql[p][f]),$p[f]=Math.max($p[f],Ql[p][f]);Ip[2]-=200,$p[2]+=200,n.camera.near=-$p[2],n.camera.far=-Ip[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),Dr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){sX(t.camera.projectionMatrix,Ip[0],$p[0],Ip[1],$p[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/Ql[0][3],n=1/Ql[4][3];pt(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(an(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,xit(Ql,o,a,Zne,Qne,wit,Jne,Kne),Tit(Zne,Qne,Jne,Kne,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(Ip[2]-$p[2]),r.camera.projectionMatrix[14]=-(Ip[2]+$p[2])/(Ip[2]-$p[2])}_setupMatrices(t,i){Dr(Wne,t.projectionMatrix,t.viewMatrix),Xr(Xne,Wne);const r=this.viewingMode===Ge.Global?t.eye:ie(jV,0,0,1);k5(eoe,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(FWe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=Zt(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+Mw(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const qne=Ee(),Wne=Ee(),Xne=Ee(),Yne=qt(),Ql=[];for(let e=0;e<8;++e)Ql.push(qt());const Ip=R(),$p=R(),Zne=st(),Qne=st(),wit=st(),Jne=st(),Kne=st(),eoe=Ee(),jV=R(),HV=[],toe=Ee(),ioe=new Float32Array(64),Nc=st(),Dx=st(),W_=[st(),st(),st(),st()],cn=st(),qV=st(),Ny=st(),LC=st(),Lx=st(),Nx=st(),o$=st();function xit(e,t,i,r,s,n,o,a){fi(Nc,0,0);for(let C=0;C<4;++C)zd(Nc,Nc,e[C]);pc(Nc,Nc,.25),fi(Dx,0,0);for(let C=4;C<8;++C)zd(Dx,Dx,e[C]);pc(Dx,Dx,.25),YT(W_[0],e[4],e[5],.5),YT(W_[1],e[5],e[6],.5),YT(W_[2],e[6],e[7],.5),YT(W_[3],e[7],e[4],.5);let l=0,c=GF(W_[0],Nc);for(let C=1;C<4;++C){const A=GF(W_[C],Nc);A<c&&(c=A,l=C)}Af(cn,W_[l],e[l+4]);const h=cn[0];let p,f;cn[0]=-cn[1],cn[1]=h,Af(qV,Dx,Nc),Xs(qV,cn)<0&&WY(cn,cn),YT(cn,cn,qV,i),oR(cn,cn),p=f=Xs(Af(Ny,e[0],Nc),cn);for(let C=1;C<8;++C){const A=Xs(Af(Ny,e[C],Nc),cn);A<p?p=A:A>f&&(f=A)}co(r,Nc),pc(Ny,cn,p-t),zd(r,r,Ny);let m=-1,y=1,v=0,b=0;for(let C=0;C<8;++C){Af(LC,e[C],r),oR(LC,LC);const A=cn[0]*LC[1]-cn[1]*LC[0];A>0?A>m&&(m=A,v=C):A<y&&(y=A,b=C)}Tx(m>0,"leftArea"),Tx(y<0,"rightArea"),pc(Lx,cn,p),zd(Lx,Lx,Nc),pc(Nx,cn,f),zd(Nx,Nx,Nc),o$[0]=-cn[1],o$[1]=cn[0];const w=SI(r,e[b],Nx,zd(Ny,Nx,o$),1,s),S=SI(r,e[v],Nx,Ny,1,n),T=SI(r,e[v],Lx,zd(Ny,Lx,o$),1,o),E=SI(r,e[b],Lx,Ny,1,a);Tx(w,"rayRay"),Tx(S,"rayRay"),Tx(T,"rayRay"),Tx(E,"rayRay")}function di(e,t){return 3*t+e}const roe=st();function kl(e,t){return fi(roe,e[t],e[t+3]),roe}const Ja=st(),et=ir();function Tit(e,t,i,r,s){Af(Ja,i,r),pc(Ja,Ja,.5),et[0]=Ja[0],et[1]=Ja[1],et[2]=0,et[3]=Ja[1],et[4]=-Ja[0],et[5]=0,et[6]=Ja[0]*Ja[0]+Ja[1]*Ja[1],et[7]=Ja[0]*Ja[1]-Ja[1]*Ja[0],et[8]=1,et[di(0,2)]=-Xs(kl(et,0),e),et[di(1,2)]=-Xs(kl(et,1),e);let n=Xs(kl(et,0),i)+et[di(0,2)],o=Xs(kl(et,1),i)+et[di(1,2)],a=Xs(kl(et,0),r)+et[di(0,2)],l=Xs(kl(et,1),r)+et[di(1,2)];n=-(n+a)/(o+l),et[di(0,0)]+=et[di(1,0)]*n,et[di(0,1)]+=et[di(1,1)]*n,et[di(0,2)]+=et[di(1,2)]*n,n=1/(Xs(kl(et,0),i)+et[di(0,2)]),o=1/(Xs(kl(et,1),i)+et[di(1,2)]),et[di(0,0)]*=n,et[di(0,1)]*=n,et[di(0,2)]*=n,et[di(1,0)]*=o,et[di(1,1)]*=o,et[di(1,2)]*=o,et[di(2,0)]=et[di(1,0)],et[di(2,1)]=et[di(1,1)],et[di(2,2)]=et[di(1,2)],et[di(1,2)]+=1,n=Xs(kl(et,1),t)+et[di(1,2)],o=Xs(kl(et,2),t)+et[di(2,2)],a=Xs(kl(et,1),i)+et[di(1,2)],l=Xs(kl(et,2),i)+et[di(2,2)],n=-.5*(n/o+a/l),et[di(1,0)]+=et[di(2,0)]*n,et[di(1,1)]+=et[di(2,1)]*n,et[di(1,2)]+=et[di(2,2)]*n,n=Xs(kl(et,1),t)+et[di(1,2)],o=Xs(kl(et,2),t)+et[di(2,2)],a=-o/n,et[di(1,0)]*=a,et[di(1,1)]*=a,et[di(1,2)]*=a,s[0]=et[0],s[1]=et[1],s[2]=0,s[3]=et[2],s[4]=et[3],s[5]=et[4],s[6]=0,s[7]=et[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=et[6],s[13]=et[7],s[14]=0,s[15]=et[8]}class Fxe{constructor(){this.adds=new It,this.removes=new It,this.updates=new It({allocator:t=>t||new Sit,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Sit{}class Eit{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var ti;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(ti||(ti={}));function Uxe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new Eit,t.set(r,s)),s};return e.removes.forAll(r=>{WV(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{WV(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{WV(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function WV(e){return e.data.indexCount>=1}function Cit(e){const t=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function sk(e,t){t.normalType===Ar.Attribute&&(e.attributes.add(O.NORMAL,"vec3"),e.vertex.code.add(x`vec3 normalModel() {
return normal;
}`)),t.normalType===Ar.CompressedAttribute&&(e.include(Cit),e.attributes.add(O.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Ar.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Ar;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Ar||(Ar={}));function nk(e){e.attributes.add(O.POSITION,"vec3"),e.vertex.code.add(x`vec3 positionModel() { return position; }`)}function T4({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function W3(e){return!!he("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function JS(e,t){e.include(nk);const i=e.vertex;i.include(T4,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Tt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new V3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new xr("transformProjFromView",r=>r.transformProjFromView),new hR("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Va("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Va("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class kxe extends Bs{constructor(){super(...arguments),this.transformWorldFromViewTH=R(),this.transformWorldFromViewTL=R(),this.transformViewFromCameraRelativeRS=ir(),this.transformProjFromView=Ee()}}class zxe extends Bs{constructor(){super(...arguments),this.transformWorldFromModelRS=ir(),this.transformWorldFromModelTH=Ri(),this.transformWorldFromModelTL=Ri()}}function ok(e,t){t.normalType===Ar.Attribute||t.normalType===Ar.CompressedAttribute?(e.include(sk,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new hR("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new V3("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Ar.Ground?(e.include(JS,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(x`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(x`void forwardNormal() {}`)}class Vxe extends kxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ir()}}class Bxe extends zxe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ir(),this.toMapSpace=qt()}}class NH extends Bxe{constructor(t=R()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function X3(e,t){t.output===K.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===K.Depth||t.output===K.Shadow?(e.include(JS,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new mi("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(x`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(x`void forwardLinearDepth() {}`)}function wv(e,t){t.spherical?e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class Y3 extends Qr{constructor(t,i){super(t,"int",zi.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class Gxe extends Qr{constructor(t,i,r,s){switch(i){case zi.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case zi.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class jxe extends Bs{constructor(){super(...arguments),this.origin=R()}}function ak(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new Gxe("shadowMapMatrix",zi.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Hxe(e))}function Vw(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new Gxe("shadowMapMatrix",zi.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Hxe(e))}function Hxe(e){const t=e.fragment;t.include(Mc),t.uniforms.add([new Bt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new Y3("numCascades",(i,r)=>r.shadowMap.numCascades),new oi("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new Xe("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function Ait(e){e.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Mit(e){e.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Oit(e){const t=e.fragment.code;t.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function lk(e,t){const i=e.fragment.code;e.include(SU),t.pbrMode===Ot.Water||t.pbrMode===Ot.WaterOnIntegratedMesh?(i.add(x`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(e.include(Oit),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function qxe(e,t){e.include(lk,t),e.include(wU),e.include(Mit),t.hasCloudsReflections&&e.include(S1e,t),t.hasScreenSpaceReflections&&e.include(uWe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new Xe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Xe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function soe(e){e.fragment.uniforms.add(new kr("texWaveNormal")),e.fragment.uniforms.add(new kr("texWavePerturbation")),e.fragment.uniforms.add([new oi("waveParams",t=>Ji(Rit,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new mi("waveDirection",t=>fi(Pit,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(Ait),e.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Rit=qt(),Pit=st();function Iit(e){const t=new Xi,{vertex:i,fragment:r}=t,s=Ou(t,e);return t.include(Io),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),i.uniforms.add(new oi("waterColor",n=>n.color)),e.output!==K.Color&&e.output!==K.Alpha||(t.include(wv,e),t.include(X3,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Do)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===K.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Nu,e),e.output===K.Alpha&&(t.include(fs,e),r.uniforms.add(new Ua("waterColor")),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===K.Color&&(t.include(aZ,{isGround:!1}),t.include(oZ,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(soe),t.include(fs,e),t.include(Vw,e),t.include(qxe,e),r.uniforms.add([new Ua("waterColor"),new Tt("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new Xe("timeElapsed",n=>n.timeElapsed),new Kv("view")]),Zf(r,e),r.include(cm),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===K.Normal&&(t.include(wv,e),t.include(soe,e),t.include(fs,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Do)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Xe("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===K.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Do)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ua("waterColor")),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`)),e.output===K.Highlight&&(t.include(my),t.varyings.add("vpos","vec3"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Do)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(fs,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const $it=Object.freeze(Object.defineProperty({__proto__:null,build:Iit},Symbol.toStringTag,{value:"Module"}));class ck extends dr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=W3(t.rctx)}initializeProgram(t){const i=ck.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==K.Color&&this.configuration.output!==K.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===yt.NONE,s=t===yt.FrontFace;return zt({blending:i.output!==K.Normal&&i.output!==K.Highlight&&i.transparent?r?Ru:gy(t):null,depthTest:{func:b_(t)},depthWrite:r?i.writeDepth&&Dl:qU(t),colorWrite:ri,polygonOffset:r||s?null:YU(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}ck.shader=new rr($it,()=>import("./WaterSurface.glsl.a237a02b.js"));class Wn extends na{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Wn.prototype,"output",void 0),u([j({count:yt.COUNT})],Wn.prototype,"transparencyPassType",void 0),u([j()],Wn.prototype,"spherical",void 0),u([j()],Wn.prototype,"receiveShadows",void 0),u([j()],Wn.prototype,"hasSlicePlane",void 0),u([j()],Wn.prototype,"transparent",void 0),u([j()],Wn.prototype,"enableOffset",void 0),u([j()],Wn.prototype,"writeDepth",void 0),u([j()],Wn.prototype,"hasScreenSpaceReflections",void 0),u([j()],Wn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Wn.prototype,"hasCloudsReflections",void 0),u([j()],Wn.prototype,"isDraped",void 0),u([j()],Wn.prototype,"hasMultipassTerrain",void 0),u([j()],Wn.prototype,"cullAboveGround",void 0),u([j({constValue:Ot.Water})],Wn.prototype,"pbrMode",void 0),u([j({constValue:!0})],Wn.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],Wn.prototype,"highStepCount",void 0),u([j({constValue:!1})],Wn.prototype,"useFillLights",void 0);class noe extends v_{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=_(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===lc.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===K.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(ck,t)}}const Dit=ns().vec3f(O.POSITION),Lit=ns().vec3f(O.POSITION).vec2f(O.UV0),Wxe=ns().vec3f(O.POSITION).vec4u8(O.COLOR);class uk{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){jU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class Xxe extends hm{constructor(t){super(t,new Yxe),this._techniqueConfig=new Wn,this.animation=new W1e}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<WU,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<Nit;const r=this.animation.advance(t);return this.setParameters({timeElapsed:nW(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){BU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(zw(i)){case K.Normal:return t===Te.DRAPED_WATER;case K.Color:if(this.parameters.isDraped)return t===Te.DRAPED_MATERIAL;break;case K.Highlight:return t===Te.OPAQUE_MATERIAL||t===Te.DRAPED_MATERIAL}let r=Te.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===K.Color&&this.parameters.isDraped)return t.output=K.Draped,new noe(t);switch(t.output){case K.Color:case K.Normal:case K.Highlight:case K.Alpha:return new noe(t)}return null}createBufferWriter(){return new uk(Lit)}}class Yxe extends WE{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Fi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=vi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const Nit=35e3;class ooe{constructor(t){this.first=t.from,this.count=t.to-t.from}}class QT{constructor(t=0,i=0){this.from=t,this.to=i}}class Fit extends QT{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function aoe(e){return Array.from(e.values()).sort(Uit)}function Uit(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function a$(e,t){if(e.length===0)return void e.push(new ooe(t));const i=e[e.length-1];if(kit(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new ooe(t))}function kit(e,t){return e.first+e.count>=t.from}class zit{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(FH(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=Vit(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const loe=65536;function FH(e){return Math.ceil(e/loe)*loe}function Vit(e,t,i){return t<=i?e>=i?e:FH(Math.max(2*e,i)):e<=2*i?e:FH(i)}class Bit{constructor(t,i,r,s){this.vao=new zs(t,i,{geometry:r},{geometry:ai.createVertex(t,Ci.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Git=lL+1;class jit{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${wl()}`,Hit)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,Git),s}return new Bit(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function Hit(e,t){if(t===gg.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class Zxe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new It,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Mxe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new jit(t,r.vertexAttributeLocations,Oc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof Xxe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==$r.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=Wit(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((w,S)=>w+r.elementCount(S.data),0);let h=n.get(l);if(h==null)pt(a.toRemove.length===0),h=new Yit(a.origin,new zit(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(w=>p+=w.to-w.from);const f=a.toRemove.reduce((w,S)=>w+r.elementCount(S.data),0),m=h.buffer.size,y=(p+c-f)*s,v=Qit;if(y<m/2?this._removeAndRebuild(h,a.toRemove,s,y,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const w=Jit;B1e(w,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,w,v)}const b=h.buffer.vao.vertexBuffers.geometry;hoe(v),v.forAll(({from:w,to:S})=>{if(w<S){const T=h.buffer.array,E=4,C=w*E,A=S*E;b.setSubData(T,C,C,A)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&ti.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(ti.State.HIGHLIGHTS|ti.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&ti.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(ti.State.VERTEXATTRS|ti.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;uYe(n,XV,NC),i.write({transformation:XV,invTranspTransformation:NC},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),pt(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Js(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!uoe(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=aoe(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?a$(i.drawCommandsOccludees,s):a$(i.drawCommandsDefault,s),s.hasHighlights?a$(i.drawCommandsHighlight,s):a$(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===Be.MATERIAL_HIGHLIGHT||t===Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&uoe(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new Zit(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(M(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;_(p)&&this._renderCommands(o,m,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=aoe(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new QT(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new QT(a.from,a.to)),t.instances.delete(o),s.push(new QT(l,c))}hoe(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?Dr(XV,s,p.transformation):s;Xr(NC,f);const m=$l(NC,NC),y=o.elementCount(p.data),v=y*r;let b=Xit(t.holes,y);M(b)&&(b=t.buffer.size/r,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,b);const w=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&w,T=!!p.instanceParameters.occludees,E=new Fit(p.id,b,b+y,w,S,T);pt(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new QT(E.from*r,E.to*r)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new QT(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class qit{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function Wit(e,t){const i=new Map;for(const r of e)coe(i,r,!0);for(const r of t)coe(i,r,!1);return i}function coe(e,t,i){const r=t.origin;if(M(r))return;let s=e.get(r.id);s==null&&(s=new qit(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function uoe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Xit(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function hoe(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class Yit{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new It({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Zit extends NH{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const Qit=new It({deallocator:null}),Jit=Ee(),XV=Ee(),NC=Ee();let yf=class extends Ae{constructor(e){super(e),this._pending=new Kit,this._changes=new Fxe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new It,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Js(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Uxe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new Zxe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Js(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=Js(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===ti.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===ti.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ti.State.TRANSFORMATION:case ti.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case ti.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),l$[0]=i[0]-r,l$[1]=i[1]-o,l$[2]=1,c$[0]=i[0]-r,c$[1]=i[1]-o,c$[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,l$,c$,(a,l,c)=>{ert(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(M(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(M(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return M(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],yf.prototype,"drapeSource",void 0),u([d()],yf.prototype,"updating",null),u([d()],yf.prototype,"rctx",null),u([d()],yf.prototype,"rendererContext",void 0),u([d()],yf.prototype,"_materialRepository",null),u([d()],yf.prototype,"_localOriginFactory",null),yf=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],yf);class Kit{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function ert(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(zr.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==lo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===lo.ALL){const c=SZ(s.ray);l(c),s.results.all.push(c)}}const l$=R(),c$=R();function hk(e){e.fragment.uniforms.add(new oi("projInfo",(t,i)=>trt(i))),e.fragment.uniforms.add(new mi("zScale",(t,i)=>Qxe(i))),e.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function trt(e){const t=e.camera.projectionMatrix;return t[11]===0?Ji(doe,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Ji(doe,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const doe=qt();function Qxe(e){return e.camera.projectionMatrix[11]===0?fi(poe,0,1):fi(poe,1,0)}const poe=st();var h_;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(h_||(h_={}));class Jxe extends Ha{constructor(){super(...arguments),this.output=h_.SSAO}}u([j({count:h_.COUNT})],Jxe.prototype,"output",void 0);const FC={samples:16,filterRadius:4};function irt(e){const t=new Xi,i=t.fragment;if(t.include(__),e.output===h_.Blur){const r=(FC.filterRadius+1)/2,s=1/(2*r*r);i.include(Lu),i.uniforms.add([new kr("normalMap"),new kr("depthMap"),new kr("tex"),new Lg("blurSize"),new Ui("projScale"),new mi("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(x`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${x.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(x`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${x.int(FC.filterRadius)}; r <= ${x.int(FC.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===h_.SSAO&&(i.include(Lu),t.include(hk),i.uniforms.add(new kr("normalMap")),i.uniforms.add(new kr("depthMap")),i.uniforms.add(new kr("rnm")),i.uniforms.add(new Ui("intensity")),i.uniforms.add(new Ui("projScale")),i.uniforms.add(new Ui("radius")),i.uniforms.add(new mi("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Lg("screenSize")),i.uniforms.add(new Lg("rnmScale")),i.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new mi("zScale",(r,s)=>Qxe(s))),i.code.add(x`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${x.int(FC.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${x.int(FC.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const rrt=Object.freeze(Object.defineProperty({__proto__:null,build:irt},Symbol.toStringTag,{value:"Module"}));class NR extends dr{initializeProgram(t){const i=NR.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({colorWrite:ri})}}NR.shader=new rr(rrt,()=>import("./SSAO.glsl.8fc20d62.js"));class Kxe{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new Jxe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Je(this.quadVAO)}disposeOffscreenBuffers(){Qs(this._ssaoFBO,t=>t.resize(0,0)),Qs(this._blur0FBO,t=>t.resize(0,0)),Qs(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||M(i)||M(r)||M(this._noiseTexture)||M(this._ssaoFBO)||M(this._blur0FBO)||M(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,y=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,foe,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let b=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",b*p),v.setUniform2f("screenSize",m,y);const w=ur(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(w);S=Math.max(.1,S),v.setUniform1f("radius",S),v.setUniform1f("intensity",4*this._attenuation/S**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",r),v.bindTexture("depthMap",i),M(this.quadVAO)&&(this.quadVAO=qa(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays($t.TRIANGLE_STRIP,0,Po(this.quadVAO,"geometry"));const T=s.bindTechnique(this._blurTechnique,foe,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",r),T.bindTexture("depthMap",i),s.setViewport(0,0,m/this._blurSizePx,y/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,y),T.setUniform2f("blurSize",0,this._blurSizePx*p/y),w>5e4&&(b=Math.max(0,b-(w-5e4))),T.setUniform1f("projScale",b),s.drawArrays($t.TRIANGLE_STRIP,0,Po(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays($t.TRIANGLE_STRIP,0,Po(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=h_.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(NR,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=h_.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(NR,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE};yp(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new Cr(this._rctx,i,t),this._blur0FBO=new Cr(this._rctx,i,t),this._blur1FBO=new Cr(this._rctx,i,t),this._noiseTexture=new ot(this._rctx,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Je(this._noiseTexture),this._blur1FBO=Je(this._blur1FBO),this._blur0FBO=Je(this._blur0FBO),this._ssaoFBO=Je(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const foe=new Bs;function srt(){const e=new Xi;return e.include(__),e.fragment.uniforms.add([new kr("tex"),new Ua("uColor")]),e.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const nrt=Object.freeze(Object.defineProperty({__proto__:null,build:srt},Symbol.toStringTag,{value:"Module"}));class Z3 extends dr{initializeProgram(t){const i=Z3.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return this.configuration.hasAlpha?zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri}):zt({colorWrite:ri})}}Z3.shader=new rr(nrt,()=>import("./TextureOnly.glsl.220559fe.js"));class gQ extends Ha{constructor(){super(...arguments),this.hasAlpha=!1}}u([j()],gQ.prototype,"hasAlpha",void 0);class eTe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Je(t.texture)),this.cache.clear()}_acquire(t){if(M(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=ort(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(M(h.texture)&&(h.texture=new ot(this._rctx,{width:l,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(M(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function ort(e,t){const i=e.map(y=>Math.round(y*t)),r=1/t,s=Math.floor(i.reduce((y,v)=>y+v)),n=i.reduce((y,v)=>Math.max(y,v)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const y of i){for(let v=0;v<y;v++){const b=l*(Math.min(v,y-1-v)+.5)*r/o*.5+.5;a.push(b)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const y of h)PR(y,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var fc,Mo;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(fc||(fc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(Mo||(Mo={}));class eN extends Ha{constructor(){super(...arguments),this.function=fc.Standard,this.alphaMode=Mo.None,this.hasOpacityFactor=!1}}u([j({count:fc.COUNT})],eN.prototype,"function",void 0),u([j({count:Mo.COUNT})],eN.prototype,"alphaMode",void 0),u([j()],eN.prototype,"hasOpacityFactor",void 0);let Md=class extends tk(Ae){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new si,this._frameTask=N2,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new It,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new Zr,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new eTe(e.renderingContext),this._shaderTechniqueRepository=new Txe({rctx:this._rctx,viewingMode:Ge.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new Nxe(this._rctx,new mQ(this._rctx,this.view.state.viewingMode),new Kxe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ae(()=>t.updating,()=>this.events.emit("content-changed"),_s),ae(()=>this.spatialReference,i=>this._localOriginFactory=new fQ(i),_s),oo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new Sxe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&S4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Te.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=p1e(this._rctx),this._bindParameters.camera=kb,this._bindParameters.transparencyPassType=yt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new fZ(Ue(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=Hi(this._debugTextureTechnique),this._debugPatternTexture=Je(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Je(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository),this._temporaryFBO=Je(this._temporaryFBO),this._quadVAO=Je(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Js(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,yf)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(ye(F({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ae(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(M(e))return;const t=this._drapeSourceRenderers.get(e);M(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return _t(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=ID(e,i=>i.drapeTargetType===$H.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=ID(e,i=>i.drapeSourceType===dO.Features),t.hasDrapedRasterSource=ID(e,i=>i.drapeSourceType===dO.RasterImage)})}ensureOverlays(e,t){M(this._overlays)&&(this._overlayRenderTarget=new Gtt(this._rctx),this._overlays=[new Lne(Fr.INNER,this._overlayRenderTarget),new Lne(Fr.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Je(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(zE,e=>e.updatePolicy===z2.SYNC)}isEmpty(){if(Wi.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===Be.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===Be.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;kb.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===Be.MATERIAL_NORMAL?Te.DRAPED_WATER:Te.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===Fr.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(Ki.COLOR_BUFFER_BIT));const c=t.type===vs.ColorNoRasterImage?W0.ExcludeRasterImage:t.type===vs.Occluded?W0.OccludedOnly:W0.Normal;if(c===W0.OccludedOnly&&(this._renderContext.renderOccludedMask=S4),Wi.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==W0.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,kb),this._drawDebugTexture(e.resolution,lrt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===W0.ExcludeRasterImage&&h.drapeSourceType===dO.RasterImage)return;const{fullOpacity:f}=h,m=_(f)&&f<1&&s===Be.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(Ki.COLOR_BUFFER_BIT));for(let y=0;y<r.numViews;y++)this._setViewParameters(r.extents[y],e,kb),p.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),Mo.PremultipliedAlpha,f,fc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){M(this._temporaryFBO)&&(this._temporaryFBO=new xxe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new art(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,sX(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),U5(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Js(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Js(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Js(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays($t.TRIANGLE_STRIP,0,Po(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new ot(this._rctx,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:e,height:t},i);const s=new gQ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Z3,s),this._quadVAO=qa(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var W0;u([d()],Md.prototype,"_frameTask",void 0),u([d()],Md.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([So()],Md.prototype,"_shaderTechniqueRepository",void 0),u([So()],Md.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Md.prototype,"view",void 0),u([d()],Md.prototype,"worldToPCSRatio",void 0),u([d()],Md.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Md.prototype,"updating",null),Md=u([P("esri.views.3d.terrain.OverlayRenderer")],Md),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(W0||(W0={}));class art{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const lrt=[[1,.5,.5],[.5,.5,1]],kb=new qi;kb.near=1,kb.far=1e4,kb.relativeElevation=null;const yQ=-2,S4=$r.OccludeAndTransparent;function moe(e){const t=[[O.POSITION,e.indices]],i=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([O.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([O.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([O.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([O.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([O.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([O.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Nr(i,t)}function goe(e){const t=[[O.POSITION,e.indices],[O.UV0,e.indices]],i=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[O.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Nr(i,t)}function FR(e){switch(e.type){case"extent":if(e instanceof Xt)return la.fromExtent(e);break;case"polygon":return e}return null}function vQ(e,t,i,r){const s=q3(e.rings,e.hasZ,Qf.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=oxe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:rTe(s.polygons,s.position,n),outlines:iTe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function tTe(e,t){const i=q3(e.rings,!1,Qf.CCW_IS_HOLE),r=tr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=yQ;return{position:i.position,polygons:rTe(i.polygons,i.position),outlines:iTe(i.outlines,i.position),projectionSuccess:r}}function iTe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function rTe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function sTe(e,t){const i=e.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Vr.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Vr.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Vr.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Vr.COUNT:}}var Vr;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Vr||(Vr={}));function nTe(e){e.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function oTe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(O.MODELORIGINHI,"vec3"),e.attributes.add(O.MODELORIGINLO,"vec3"),e.attributes.add(O.MODEL,"mat3"),e.attributes.add(O.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(T4,t),i.uniforms.add(new Va("viewOriginHi",(r,s)=>lYe(ie(u$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),u$))),i.uniforms.add(new Va("viewOriginLo",(r,s)=>cYe(ie(u$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),u$)))),i.code.add(x`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===K.Normal&&(i.uniforms.add(new xr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const u$=R();var xs;function aTe(e){switch(e){case"multiply":default:return xs.Multiply;case"ignore":return xs.Ignore;case"replace":return xs.Replace;case"tint":return xs.Tint}}function lTe(e,t,i){if(M(e)||t===xs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Ne(Math.round(e[3]*E4),0,E4),s=r===0||t===xs.Tint?0:t===xs.Replace?crt:urt;i[0]=Ne(Math.round(e[0]*Fx),0,Fx),i[1]=Ne(Math.round(e[1]*Fx),0,Fx),i[2]=Ne(Math.round(e[2]*Fx),0,Fx),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(xs||(xs={}));const Fx=255,E4=85,crt=E4,urt=2*E4;function cTe(e){e.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(xs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(xs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(xs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(xs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function uTe(e,t){t.hasSymbolColors?(e.include(cTe),e.attributes.add(O.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new Y3("colorMixMode",i=>bwe[i.colorMixMode])),e.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function ux(e,t){t.hasVertexColors?(e.attributes.add(O.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function hrt(e){e.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(Do)}) { discard; } }
  `)}class hTe extends Qr{constructor(t,i){super(t,"float",zi.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function sw(e,t){dTe(e,t,new Xe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function drt(e,t){dTe(e,t,new hTe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function dTe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==cr.Mask&&t.alphaDiscardMode!==cr.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case cr.Blend:return e.include(hrt);case cr.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case cr.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case cr.MaskBlend:e.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function pTe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==K.Depth&&t.output!==K.Shadow||(Ou(e,t),e.include(Io,{linearDepth:!0,hasModelTransformation:s}),e.include(Dg,t),e.include(QS,t),e.include(w_,t),e.include(fs,t),e.vertex.uniforms.add(new mi("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new Bt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(sw,t),r.add(x`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===K.Normal&&(Ou(e,t),e.include(Io,{linearDepth:!1,hasModelTransformation:s}),e.include(sk,t),e.include(ok,t),e.include(Dg,t),e.include(QS,t),t.hasColorTexture&&e.fragment.uniforms.add(new Bt("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Ar.Attribute?x`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(fs,t),e.include(sw,t),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Ar.ScreenDerivative?x`
            vec3 normal = screenDerivativeNormal(vPositionView);`:x`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===K.Highlight&&(Ou(e,t),e.include(Io,{linearDepth:!1,hasModelTransformation:s}),e.include(Dg,t),e.include(QS,t),t.hasColorTexture&&e.fragment.uniforms.add(new Bt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(fs,t),e.include(sw,t),e.include(my),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function fTe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(O.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Vr.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==tn.None){e.include(tZ,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===zi.Pass?jL("normalTexture",s=>s.textureNormal,r):nO("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function Q3(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new Bt("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new oi("viewportPixelSz",(r,s)=>Ji(prt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(x`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(x`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const prt=qt();function Bw(e,t){const i=e.fragment;e.include(Q3,t),t.pbrMode!==Ot.Disabled&&e.include(lk,t),e.include(oZ,t),i.constants.add("ambientBoostFactor","float",BE),e.include(SU),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new Tt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new Xe("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new Tt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Ot.Disabled||t.pbrMode===Ot.WaterOnIntegratedMesh?(e.include(aZ,t),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new Ow("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new Xe("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Xe("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Ot.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function mTe(e,t){const i=x`
  /*
  *  ${t.name}
  *  ${t.output===K.Color?"RenderOutput: Color":t.output===K.Depth?"RenderOutput: Depth":t.output===K.Shadow?"RenderOutput: Shadow":t.output===K.Normal?"RenderOutput: Normal":t.output===K.Highlight?"RenderOutput: Highlight":""}
  */
  `;aR()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function UR(e){e.include(cm),e.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(xs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(xs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(xs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function frt(e){const t=new Xi,i=t.vertex.code,r=t.fragment.code;t.include(mTe,{name:"Default Material Shader",output:e.output});const s=Ou(t,e);return t.include(nk),t.varyings.add("vpos","vec3"),t.include(QS,e),t.include(oTe,e),t.include(dwe,e),e.output!==K.Color&&e.output!==K.Alpha||(Zf(t.vertex,e),t.include(sk,e),t.include(Io,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Ar.Attribute&&e.offsetBackfaces&&t.include(nTe),t.include(fTe,e),t.include(ok,e),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(Dg,e),t.include(X3,e),t.include(uTe,e),t.include(ux,e),t.vertex.uniforms.add(new oi("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new xr("model",n=>_(n.modelTransformation)?n.modelTransformation:Us)),i.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(Do)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Ar.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Ar.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===K.Alpha&&(t.include(fs,e),t.include(sw,e),t.include(Nu,e),t.fragment.uniforms.add([new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new Bt("tex",n=>n.texture)),t.fragment.include(UR),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(fs,e),t.include(Bw,e),t.include(Q3,e),t.include(sw,e),t.include(e.instancedDoublePrecision?ak:Vw,e),t.include(Nu,e),Zf(t.fragment,e),t.fragment.uniforms.add([s,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",BE),e.hasColorTexture&&t.fragment.uniforms.add(new Bt("tex",n=>n.texture)),t.include(nZ,e),t.include(lk,e),t.fragment.include(UR),t.include(sTe,e),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Ar.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?x`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?x`normalize(vpos + localOrigin);`:x`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(pTe,e),t}const mrt=Object.freeze(Object.defineProperty({__proto__:null,build:frt},Symbol.toStringTag,{value:"Module"}));class grt extends Vxe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=hr.Back,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=vi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=R(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ir(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Cw.Less,this.textureAlphaMode=cr.Blend,this.textureAlphaCutoff=g4,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=$r.Occlude}}class yrt extends Bxe{constructor(){super(...arguments),this.origin=R(),this.slicePlaneLocalOrigin=this.origin}}class J3 extends dr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=W3(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?tn.Default:tn.None}initializeProgram(t){return this._initializeProgram(t,J3.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new sr(t.rctx,r,Vi)}_convertDepthTestFunction(t){return t===Cw.Lequal?fr.LEQUAL:fr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return zt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?Ru:gy(t),culling:vrt(r)&&xU(r.cullFace),depthTest:{func:b_(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&Dl:null,colorWrite:ri,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?u_:x_:null,polygonOffset:s||n?null:YU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function vrt(e){return e.cullFace!==hr.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}J3.shader=new rr(mrt,()=>import("./DefaultMaterial.glsl.fbed0e5a.js"));class Kt extends na{constructor(){super(...arguments),this.output=K.Color,this.alphaDiscardMode=cr.Opaque,this.doubleSidedMode=Vr.None,this.pbrMode=Ot.Disabled,this.cullFace=hr.None,this.transparencyPassType=yt.NONE,this.normalType=Ar.Attribute,this.textureCoordinateType=tn.None,this.customDepthTest=Cw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([j({count:K.COUNT})],Kt.prototype,"output",void 0),u([j({count:cr.COUNT})],Kt.prototype,"alphaDiscardMode",void 0),u([j({count:Vr.COUNT})],Kt.prototype,"doubleSidedMode",void 0),u([j({count:Ot.COUNT})],Kt.prototype,"pbrMode",void 0),u([j({count:hr.COUNT})],Kt.prototype,"cullFace",void 0),u([j({count:yt.COUNT})],Kt.prototype,"transparencyPassType",void 0),u([j({count:Ar.COUNT})],Kt.prototype,"normalType",void 0),u([j({count:tn.COUNT})],Kt.prototype,"textureCoordinateType",void 0),u([j({count:Cw.COUNT})],Kt.prototype,"customDepthTest",void 0),u([j()],Kt.prototype,"spherical",void 0),u([j()],Kt.prototype,"hasVertexColors",void 0),u([j()],Kt.prototype,"hasSymbolColors",void 0),u([j()],Kt.prototype,"hasVerticalOffset",void 0),u([j()],Kt.prototype,"hasSlicePlane",void 0),u([j()],Kt.prototype,"hasSliceHighlight",void 0),u([j()],Kt.prototype,"hasColorTexture",void 0),u([j()],Kt.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([j()],Kt.prototype,"hasEmissionTexture",void 0),u([j()],Kt.prototype,"hasOcclusionTexture",void 0),u([j()],Kt.prototype,"hasNormalTexture",void 0),u([j()],Kt.prototype,"hasScreenSizePerspective",void 0),u([j()],Kt.prototype,"hasVertexTangents",void 0),u([j()],Kt.prototype,"hasOccludees",void 0),u([j()],Kt.prototype,"hasMultipassTerrain",void 0),u([j()],Kt.prototype,"hasModelTransformation",void 0),u([j()],Kt.prototype,"offsetBackfaces",void 0),u([j()],Kt.prototype,"vvSize",void 0),u([j()],Kt.prototype,"vvColor",void 0),u([j()],Kt.prototype,"receiveShadows",void 0),u([j()],Kt.prototype,"receiveAmbientOcclusion",void 0),u([j()],Kt.prototype,"textureAlphaPremultiplied",void 0),u([j()],Kt.prototype,"instanced",void 0),u([j()],Kt.prototype,"instancedColor",void 0),u([j()],Kt.prototype,"instancedDoublePrecision",void 0),u([j()],Kt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Kt.prototype,"writeDepth",void 0),u([j()],Kt.prototype,"transparent",void 0),u([j()],Kt.prototype,"enableOffset",void 0),u([j()],Kt.prototype,"cullAboveGround",void 0),u([j()],Kt.prototype,"snowCover",void 0),u([j({constValue:!0})],Kt.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],Kt.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Kt.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],Kt.prototype,"useFillLights",void 0);function _rt(e){const t=new Xi,i=t.vertex.code,r=t.fragment.code,s=Ou(t,e);return t.include(nk),t.varyings.add("vpos","vec3"),t.include(QS,e),t.include(oTe,e),t.include(dwe,e),e.output!==K.Color&&e.output!==K.Alpha||(Zf(t.vertex,e),t.include(sk,e),t.include(Io),e.offsetBackfaces&&t.include(nTe),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(Dg,e),t.include(X3,e),t.include(uTe,e),t.include(ux,e),t.vertex.uniforms.add(new oi("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(Do)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===K.Alpha&&(t.include(fs,e),t.include(sw,e),t.include(Nu,e),t.fragment.uniforms.add([new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new Kv("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new Bt("tex",n=>n.texture)),t.fragment.include(UR),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(fs,e),t.include(Bw,e),t.include(Q3,e),t.include(sw,e),t.include(e.instancedDoublePrecision?ak:Vw,e),t.include(Nu,e),Zf(t.fragment,e),t.fragment.uniforms.add([s,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new Xe("opacity",n=>n.opacity),new Xe("layerOpacity",n=>n.layerOpacity),new Kv("view"),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",BE),e.hasColorTexture&&t.fragment.uniforms.add(new Bt("tex",n=>n.texture)),t.include(nZ,e),t.include(lk,e),t.fragment.include(UR),t.extensions.add("GL_OES_standard_derivatives"),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?e.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),t.include(pTe,e),t}const brt=Object.freeze(Object.defineProperty({__proto__:null,build:_rt},Symbol.toStringTag,{value:"Module"}));class dk extends J3{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Ar.Attribute,i.doubleSidedMode=Vr.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,dk.shader)}}dk.shader=new rr(brt,()=>import("./RealisticTree.glsl.7ada1294.js"));class Gw extends hm{constructor(t){super(t,Trt),this.supportsEdges=!0,this.techniqueConfig=new Kt,this.vertexBufferLayout=Ert(this.parameters),this.instanceBufferLayout=t.instanced?gTe(this.parameters):null}isVisibleInPass(t){return t!==Be.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Ar.ScreenDerivative:Ar.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?hr.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==K.Color&&t!==K.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Vr.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Vr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Vr.WindingOrder:Vr.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ot.Schematic:Ot.Normal:Ot.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<WU,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;ie(ZV,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case Ge.Global:c=we(yoe,ZV);break;case Ge.Local:c=ne(yoe,Mrt)}let h=0;const p=fe(Ort,ZV,l.eye),f=Re(p),m=oe(p,p,1/f);let y=null;this.parameters.screenSizePerspective&&(y=Se(c,m)),h+=vwe(l,f,this.parameters.verticalOffset,y,this.parameters.screenSizePerspective),oe(c,c,h),Oo(YV,c,s.transform.inverseRotation),n=fe(Crt,n,YV),o=fe(Art,o,YV)}BU(t,i,s,n,o,fH(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Te.OPAQUE_MATERIAL)||t===Te.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Shadow||t.output===K.Highlight?new wrt(t):null}createBufferWriter(){return new Srt(this.vertexBufferLayout,this.instanceBufferLayout)}}class wrt extends sZ{constructor(t){super(F(F({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return ie(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?dk:J3,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class xrt extends grt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const Trt=new xrt;class Srt{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){jU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function Ert(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=ns().vec3f(O.POSITION).vec3f(O.NORMAL);return e.hasVertexTangents&&i.vec4f(O.TANGENT),t&&i.vec2f(O.UV0),e.hasVertexColors&&i.vec4u8(O.COLOR),e.hasSymbolColors&&i.vec4u8(O.SYMBOLCOLOR),i}function gTe(e){let t=ns();return t=e.instancedDoublePrecision?t.vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL):t.mat4f(O.MODEL).mat4f(O.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(O.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t}const Crt=R(),Art=R(),Mrt=Ue(0,0,1),yoe=R(),YV=R(),ZV=R(),Ort=R(),Rrt=["polygon","extent"];class Prt extends pm{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=ZU(this._getSymbolSize());if(a)throw new q("graphics3dextrudesymbollayer:invalid-size",a)}const t=en(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=dl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?hr.None:hr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Gw(o),this._bottomMaterial=new Gw(ye(F({},o),{cullFace:hr.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Rrt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Uu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=en(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,c_)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=Itt(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?rn.Recreate_Symbol:rn.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=FR(t.geometry);if(M(o))return null;const a=vQ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(le=>le.length>0))return null;const l=iQ(o);if(M(l))return null;const c=new Array,h=new Array,p=new Array,f=ks(),m=Ee(),y=R(),v=this._context.renderCoordsHelper.viewingMode===Ge.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),ua(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const b=Ee();Xr(b,m);const w=ir();Jv(w,b);const{polygons:S,mapPosition:T,position:E}=a,C=E.length/3,A=new Float64Array(3*C*6),I=new Float64Array(3*C*6),L=new Float64Array(3*C*6),D=new Float64Array(1*C*6);let k=0;for(let le=0;le<S.length;++le){const re=S[le],$=re.count;if(this._context.clippingExtent&&(pr(f),xu(f,re.mapPosition),!Jd(f,this._context.clippingExtent)))continue;const U=iE(re.mapPosition,re.holeIndices,3);if(U.length===0)continue;const B=3*$*2+U.length,H=new Uint32Array(B),W=new Uint32Array(U.length),Q=6*$,G=3*A.BYTES_PER_ELEMENT,ee=new Mr(A.buffer,k*G,G,(k+Q)*G),me=3*I.BYTES_PER_ELEMENT,_e=new Mr(I.buffer,k*me,me,(k+Q)*me),Me=new Float64Array(L.buffer,3*k*L.BYTES_PER_ELEMENT,3*Q),ve=new Float64Array(D.buffer,1*k*D.BYTES_PER_ELEMENT,1*Q),ge=this._getExtrusionSize(i);Irt(E,T,U,re,ee.typedBuffer,Me,_e.typedBuffer,ve,0,H,W,ge,y,v),sy(ee,ee,b),Yh(_e,_e,w),k+=6*$;const Ce=voe(H,H.length-W.length,{positions:ee.typedBuffer,elevation:Me,normals:_e.typedBuffer,heights:ve},r);c.push(Ce),h.push(this._material),p.push(Us);const $e=voe(W,0,{positions:ee.typedBuffer,elevation:Me,normals:_e.typedBuffer,heights:ve},r);c.push($e),h.push(this._bottomMaterial),p.push(Us)}if(c.length===0)return null;const z=new vy({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});z.transformation=m;const V=fxe(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=_(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Y=new dm(this,z,c,null,null,Lrt,s,X);return Y.alignedSampledElevation=a.sampledElevation,Y.needsElevationUpdates=c_(s.mode),Y}}function voe(e,t,i,r){const s=new Uint32Array(e.length),n=[[O.POSITION,{size:3,data:i.positions,exclusive:!0}],[O.NORMAL,{size:3,data:i.normals,exclusive:!0}],[O.COLOR,{size:4,data:r,exclusive:!0}],[O.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[O.POSITION,e],[O.NORMAL,e],[O.COLOR,s]];return i.elevation&&(n.push([O.MAPPOS,{size:3,data:i.elevation}]),o.push([O.MAPPOS,e])),new Nr(n,o,El.Triangle,t)}function Irt(e,t,i,r,s,n,o,a,l,c,h,p,f,m){const y=i.length/3;let v=0,b=2*r.count;$rt(e,t,r.index,r.count,i,0,y,s,n,o,a,l,c,h,b,p,f,m),l+=2*r.count,b=0,_oe(s,n,a,o,v,r.pathLengths[0],r.count,l,c,b,p),l+=4*r.pathLengths[0],b+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)_oe(s,n,a,o,v,r.pathLengths[w],r.count,l,c,b,p),l+=4*r.pathLengths[w],b+=2*r.pathLengths[w],v+=r.pathLengths[w]}function $rt(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,b,w){ne(Ka,b);const S=v>0?1:-1;let T=3*i,E=p,C=3*E,A=p+r,I=3*A;for(let k=0;k<r;++k)w&&(Ka[0]=e[T+0],Ka[1]=e[T+1],Ka[2]=e[T+2],we(Ka,Ka)),a[C+0]=e[T+0],a[C+1]=e[T+1],a[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-S*Ka[0],c[C+1]=-S*Ka[1],c[C+2]=-S*Ka[2],h[E]=0,a[I+0]=e[T+0]+v*Ka[0],a[I+1]=e[T+1]+v*Ka[1],a[I+2]=e[T+2]+v*Ka[2],l[I+0]=t[T+0],l[I+1]=t[T+1],l[I+2]=t[T+2],c[I+0]=S*Ka[0],c[I+1]=S*Ka[1],c[I+2]=S*Ka[2],h[A]=v,C+=3,I+=3,T+=3,E+=1,A+=1;T=3*n,C=0,I=3*y;const L=v<0?Eoe:Soe,D=v<0?Soe:Eoe;for(let k=0;k<o;++k)m[C+0]=s[T+L[0]],m[C+1]=s[T+L[1]],m[C+2]=s[T+L[2]],f[I+0]=s[T+D[0]]+r,f[I+1]=s[T+D[1]]+r,f[I+2]=s[T+D[2]]+r,C+=3,I+=3,T+=3}function h$(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const UC=R();function _oe(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,v=a,b=a+1,w=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),Drt(e,p,f,m,UC),h$(e,t,r,i,UC,v,p),h$(e,t,r,i,UC,b,f),h$(e,t,r,i,UC,w,m),h$(e,t,r,i,UC,S,y),l[c++]=v,l[c++]=w,l[c++]=S,l[c++]=v,l[c++]=S,l[c++]=b,p++,f++,m++,y++,v+=2,b+=2,w+=2,S+=2}const QV=R(),boe=R(),woe=R(),xoe=R(),Toe=R();function Drt(e,t,i,r,s){t*=3,i*=3,r*=3,ie(QV,e[t++],e[t++],e[t++]),ie(boe,e[i++],e[i++],e[i++]),ie(woe,e[r++],e[r++],e[r++]),fe(xoe,boe,QV),fe(Toe,woe,QV),lt(s,Toe,xoe),we(s,s)}const Ux=R();function Lrt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=Xr(Ee(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(O.POSITION).data,y=f.vertexAttributes.get(O.SIZE).data,v=f.vertexAttributes.get(O.MAPPOS).data,b=new Fbe(v),w=m.length/3;let S=0,T=!1,E=0;const C=i.spatialReference;for(let A=0;A<w;A++){Ux[0]=m[S],Ux[1]=m[S+1],Ux[2]=m[S+2],ry(b,i,t,r,d$),a&&(E+=d$.sampledElevation),Wi.TESTS_DISABLE_OPTIMIZATIONS?(ie(zl,b.array[b.offset+0],b.array[b.offset+1],d$.z+y[S/3]),r.toRenderCoords(zl,C,zl),ke(zl,zl,h)):(ie(zl,m[S+0],m[S+1],m[S+2]),ke(zl,zl,c),r.setAltitude(zl,d$.z+y[S/3]),ke(zl,zl,h)),m[S]=zl[0],m[S+1]=zl[1],m[S+2]=zl[2];const I=Nrt/r.unitInMeters;(Math.abs(Ux[0]-m[S])>=I||Math.abs(Ux[1]-m[S+1])>=I||Math.abs(Ux[2]-m[S+2])>=I)&&(T=!0),b.offset+=3,S+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/w}return l/o}const zl=R(),Ka=R(),d$=new H3,Soe=[0,2,1],Eoe=[0,1,2],Nrt=.01;function Frt(e,t,i,r,s){const n=e.referencesGeometry()&&s?Urt(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(ye(F({},i),{$feature:o}))}catch(a){return de.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const JV=new Map;function Urt(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;JV.has(t)||JV.set(t,krt(t));const o=JV.get(t)(e.geometry,r,s,n);return ye(F({},e),{geometry:o})}function krt(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>Xwe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>Ywe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>Zwe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>Wwe(r,t,i,s,n);default:return de.getLogger("esri.views.2d.support.arcadeOnDemand").error(new q("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const BTt=1.2,zrt=Lf,Vrt=Ph;class pk{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ti.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ti.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=R()){return ie(t,0,0,0)}getBoundingBoxObjectSpace(t=ks()){return pr(t)}addObjectState(t,i){t===Kg.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(kx)&&(t.draped.origin[0]+=kx[0],t.draped.origin[1]+=kx[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){pr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Coe,r),H$e(n,Coe)}if(i){let o;Qd(n,kx);const a=rQ(n,i);try{o=await i.service.queryElevation(kx[0],kx[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)O5(Dp,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Dp[0]=n[0]-o,Dp[1]=n[1]-o,Dp[2]=n[2]-o,Dp[3]=n[0]+o,Dp[4]=n[1]+o,Dp[5]=n[2]+o}return i(Dp,0,2),this.calculateRelativeScreenBounds&&s.push({location:Qd(Dp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),qW(Dp,r)}}const Coe=Lt(),Dp=ks(),kx=R();class yTe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*Brt}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(M(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case Lv.Left:return this.backgroundHorizontalPadding;case Lv.Center:return(this.displayWidth-this._lineWidths[t])/2;case Lv.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(Wi.TEXT_SHOW_BASELINE){t.strokeStyle=Aoe,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(Wi.TEXT_SHOW_BORDER&&(t.strokeStyle=Aoe,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Ne(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=tN(KV,Math.max(o,zx),Math.max(a,zx)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of vTe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=tN(KV,zx,zx).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(M(this._heightMetrics)){const t=tN(KV,zx,zx).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+Grt),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const vTe=[];for(let t=0;t<360;t+=360/16)vTe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var Lv;function tN(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(Lv||(Lv={}));const KV={canvas:null},Brt=.2,zx=512,Aoe="rgb(255, 0, 255, 0.5)",Grt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),jrt={left:0,center:.5,right:1},iN={"bottom-left":Fi(0,0),bottom:Fi(.5,0),"bottom-right":Fi(1,0),left:Fi(0,.5),center:Fi(.5,.5),right:Fi(1,.5),"top-left":Fi(0,1),top:Fi(.5,1),"top-right":Fi(1,1)};function _Te(e){switch(e){case"left":return Lv.Left;case"right":return Lv.Right;default:return Lv.Center}}function Moe(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Hrt(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function qrt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Wrt(e){return e==="middle"?"center":e}var ra,Ooe,C4;function kC(e){return e!=null}function Vx(e){return typeof e=="number"}function fk(e){return typeof e=="string"}function Xrt(e){return e==null||fk(e)}function Ks(e,t){e&&e.push(t)}function Yrt(e,t,i,r=Ee()){const s=e||0,n=t||0,o=i||0;return s!==0&&A2(r,r,-s/180*Math.PI),n!==0&&C2(r,r,n/180*Math.PI),o!==0&&F5(r,r,o/180*Math.PI),r}function Fy(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return Ks(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=ra.DefinedSize,!0}if(kC(e.field))return kC(e.stops)?e.stops.length===2&&Vx(e.stops[0].size)&&Vx(e.stops[1].size)?(Roe(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=ra.DefinedSize,!0):(Ks(s,"Could not convert size info: stops only supported with 2 elements"),!1):Vx(n)&&Vx(o)&&kC(e.minDataValue)&&kC(e.maxDataValue)?(Roe(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=ra.DefinedSize,!0):D2[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/D2[e.valueUnit],t.type[i]=ra.DefinedSize,!0):e.valueUnit==="unknown"?(Ks(s,"Could not convert size info: proportional size not supported"),!1):(Ks(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!kC(e.field)){if(e.stops&&e.stops[0]&&Vx(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=ra.DefinedSize,!0;if(Vx(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=ra.DefinedSize,!0}return Ks(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Roe(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function Zrt(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return Ks(r,"Could not convert size info: unsupported property"),null;if(!Xrt(e.field))return Ks(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Ks(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[ra.Undefined,ra.Undefined,ra.Undefined]};let s;switch(e.axis){case"width":return s=Fy(e,t.size,0,i,r),s?t:null;case"height":return s=Fy(e,t.size,2,i,r),s?t:null;case"depth":return s=Fy(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=Fy(e,t.size,0,i,r),s&&Fy(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=Fy(e,t.size,0,i,r),s=s&&Fy(e,t.size,1,i,r),s=s&&Fy(e,t.size,2,i,r),s?t:null;default:return Ks(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Qrt(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===ra.DefinedSize&&(n*=t.modelSize[s],e.type[s]=ra.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==ra.Undefined)r=0;else if(e.type[1]!==ra.Undefined)r=1;else{if(e.type[2]===ra.Undefined)return Ks(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===ra.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function Poe(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function Jrt(e,t,i){if(e.normalizationField)return Ks(i,"Could not convert color info: unsupported property"),null;if(fk(e.field)){if(!e.stops)return Ks(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Ks(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,Poe(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Ks(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Poe(t.color.colors,s,r)}}return t}function Krt(e,t,i){if(e.normalizationField)return Ks(i,"Could not convert opacity info: unsupported property"),null;if(fk(e.field)){if(!e.stops)return Ks(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Ks(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Ks(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function eB(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function est(e,t,i){if(!fk(e.field))return Ks(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Ks(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return eB(e,t.rotation,0),t;case"roll":return eB(e,t.rotation,1),t;case null:case void 0:case"heading":return eB(e,t.rotation,2),t;default:return Ks(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function bTe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Ks(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Zrt(c,l,t,i):l;case"color":return s?Jrt(c,l,i):l;case"opacity":return o?Krt(c,l,i):null;case"rotation":return n?est(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Qrt(a.size,t,i)?null:a:null}function _Q(e){return e&&e.size!=null}function kR(e,t){if(!e)return{enabled:!1};if(Wi.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=bTe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:wTe(i,t),requiresShaderTransformation:_Q(i)}:{enabled:!1}}function zR(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=bTe(t.visualVariables,i);return!!s&&!!(p$(r.size,s.size,"size")&&p$(r.color,s.color,"color")&&p$(r.rotation,s.rotation,"rotation")&&p$(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=wTe(s,i),e.requiresShaderTransformation=_Q(s),!0)}function p$(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function wTe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=_Q(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=ir(),Wf(fO),Yrt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],fO),Sc(i.vvSymbolRotationMatrix,fO)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(ra||(ra={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Ooe||(Ooe={})),function(e){const t=Ee(),i=R();function r(n,o,a){if(!n.vvSizeEnabled)return a;ws(t,a);const l=n.vvSymbolRotationMatrix;sm(fO,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Dr(t,t,fO);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=Ne(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return v3(t,t,i),ca(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return ie(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=Ne(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(C4||(C4={}));const fO=Ee(),UH=C4.evaluateModelTransform,tst=C4.evaluateModelTransformScale;class ist{constructor(){this.visible=!0}}class oE{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=qt(),this.instanceParameters=new ist,this._transformation=Ee(),this._shaderTransformationDirty=!0,this.layerUid=_t(r.layerUid,null),this.graphicUid=_t(r.graphicUid,null),this.id=r.id?r.id:wl(),this.boundingInfo=_t(r.boundingInfo,null),this.calculateShaderTransformation=_t(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=Tw(t)){M(this.boundingInfo)||(ke(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return M(this.calculateShaderTransformation)?_t(this.transformation,Us):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ee()),ws(this._shaderTransformation,this.calculateShaderTransformation(_t(this.transformation,Us))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0);const i=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return!!H1e(r,i,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new _4(Kg.Highlight),i=this.instanceParameters;return i.highlights=gH(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=yH(i.highlights,t)}}const rst=Ee(),Ioe=Ue(0,0,1),sst=16,nst=1.5,zb=JZ,ost=[zb/2,zb/2,1-zb/2,1-zb/2],ast=[IR*zb,IR*zb];class VR extends pm{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=I5e(this.symbol,this.symbolLayer),n=u5(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=ZU(this._getIconSize());if(t)throw new q("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?no(t.size):sst);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Pv.PAD};r=new $s(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(lst(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:no(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(tB(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>Awe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=ost,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/zb,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!he("esri-canvas-svg-support")&&iW(i))throw new q("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await mp(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw bp(o.error),new q("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new EE({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.457021d1.js")).CIMSymbolRasterizer;Wt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await BIe(p,this._context.layer.spatialReference,n);a=(m,y,v)=>{const b=Frt(f,m,{$view:v},"esriGeometryPoint",y);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Wt(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||hDe}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max(no(i.outline.size),0):(t=tB(this._getPrimitive())?nst:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=en(i,"outline","color");if(_(r)){const s=We.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(tB(this._getPrimitive()))return zrt;const t=M(this._getPrimitive()),i=en(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?Fi((i.x||0)+.5,.5-(i.y||0)):t in iN?iN[t]:iN.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=kR(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new eE(t),this._cimSymbolMaterials.set(_t(t.textureId,0),r),i.add(r)),r}return this._material=new eE(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Hi(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=no(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=F({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=LR(i.geometry);if(M(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new Uu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j3(VR.elevationModeChangeTypes,r,s);if(n!==Yr.UPDATE)return n;const o=Xh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!zR(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return rn.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return rn.Fast_Update}_defaultElevationInfoNoZ(){return cst}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>UH(this._fastUpdates.materialParameters,l,m):null,h=[nc.createPointGeometry(Ioe,null,s,n,ust,null,l)],p=uQ(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new dm(this,p.object,h,null,null,$R,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Xh(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,m),DR(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=qt();Gr(i,a,this._context.overlaySR),a[2]=yQ;const l=this._context.clippingExtent;if(_(l)&&!HW(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?y=>UH(this._fastUpdates.materialParameters,c,y):null,p=nc.createPointGeometry(Ioe,a,s,n,null,null,c),f=new oE(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,Zd(f.boundingSphere,a);const m=new pk(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=st())=>{const a=i(rst);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=st())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ue(t,t,t),r=Iu(1),s=t*r;return{modelSize:i,symbolSize:Ue(s,s,s),unitInMeters:r,transformation:{anchor:No,scale:Rf,rotation:No}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return ye(F({},super.test()),{material:this._material})}}function lst(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function tB(e){return!M(e)&&(e==="cross"||e==="x")}VR.PRIMITIVE_SIZE=ast,VR.elevationModeChangeTypes={definedChanged:Yr.UPDATE,staysOnTheGround:Yr.NONE,onTheGroundChanged:Yr.RECREATE};const cst={mode:"relative-to-ground",offset:0},ust=vi(0,0,0,1);function kH(e){const t=[],i=[];pst(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return fst(e,i,t),mst(e,i,t,n),yst(e,i,t,n),gst(e,i,t,n),vst(e,i,t,n),_st(e,i,t,n),bst(e,i,t,r),new Nr(i,t,El.Line)}function hst(e,t,i,r){const s=e.type==="polygon"?Qf.CCW_IS_HOLE:Qf.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=q3(n,e.hasZ,s),l=new Float64Array(o.length),c=oxe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?xTe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function xTe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function dst(e,t){const i=e.type==="polygon"?Qf.CCW_IS_HOLE:Qf.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=q3(r,!1,i),o=tr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=yQ;return{lines:o?xTe(n,s):[],projectionSuccess:o}}function pst(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=wst(r)&&s===jw.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?Nq(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([O.POSITION,{size:3,data:l,exclusive:n}]),i.push([O.POSITION,a])}function fst(e,t,i){const r=e.attributeData.mapPosition;M(r)||(i.push([O.MAPPOS,i[0][1]]),t.push([O.MAPPOS,{size:3,data:r}]))}function mst(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([O.COLOR,{size:4,data:_t(s,Vrt)}]),i.push([O.COLOR,r])}function gst(e,t,i,r){const s=e.attributeData.colorFeature;M(s)||(t.push([O.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.COLOR,r]))}function yst(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([O.SIZE,{size:1,data:[_t(s,1)]}]),i.push([O.SIZE,r])}function vst(e,t,i,r){const s=e.attributeData.sizeFeature;M(s)||(t.push([O.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.SIZEFEATUREATTRIBUTE,r]))}function _st(e,t,i,r){const s=e.attributeData.opacityFeature;M(s)||(t.push([O.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([O.OPACITYFEATUREATTRIBUTE,r]))}function bst(e,t,i,r){if(M(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ge.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=Ai(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)cX(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=xst,c=Tst,h=0,p=0;ie(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),ie(c,s[p++],s[p++],s[p++]),h+=Y_e(l,c),a[f]=h,[l,c]=[c,l];t.push([O.DISTANCETOSTART,{size:1,data:a}]),i.push([O.DISTANCETOSTART,i[0][1]])}function wst(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var jw;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(jw||(jw={}));const xst=R(),Tst=R();function zH(e){switch(e){case"butt":return kh.BUTT;case"square":return kh.SQUARE;case"round":return kh.ROUND;default:return null}}const A4=64,TTe=A4/2,STe=TTe/5;function Sst(e,t){return _(t)?Est(e,Cst(t.style)):null}function Est(e,t){return e.fromData(t,()=>Awe(t,A4,TTe,STe))}function Cst(e){return e==="diamond"?"kite":e}function Ast(e){const t=new Xi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(Oxe,e),e.output===K.Depth&&t.include(w_,e);const{vertex:r,fragment:s}=t;return s.include(Mc),Ou(t,e),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new mi("nearFar",(n,o)=>o.camera.nearFar),new oi("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new xr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new Xe("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new Xe("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${x.float(A4/STe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(x`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(Nu,e),t.include(fs,e),s.uniforms.add([new oi("intrinsicColor",n=>n.color),new Bt("tex",n=>n.texture)]),s.include(cm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${x.float(1/A4)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${x.float(Do)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const Mst=Object.freeze(Object.defineProperty({__proto__:null,build:Ast},Symbol.toStringTag,{value:"Module"})),ETe=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,7]]);class mk extends dr{initializeProgram(t){const i=mk.shader.get().build(this.configuration);return new sr(t.rctx,i,ETe)}_makePipelineState(t,i){const r=this.configuration,s=t===yt.NONE;return zt({blending:r.output===K.Color||r.output===K.Alpha?s?Ru:gy(t):null,depthTest:{func:b_(t)},depthWrite:s?r.writeDepth&&Dl:qU(t),colorWrite:ri,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?u_:x_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=zt({blending:Ru,depthTest:x4,depthWrite:null,colorWrite:ri,stencilWrite:null,stencilTest:$xe}),this._occluderPipelineOpaque=zt({blending:Ru,depthTest:x4,depthWrite:null,colorWrite:ri,stencilWrite:Pxe,stencilTest:Ixe}),this._occluderPipelineMaskWrite=zt({blending:null,depthTest:pQ,depthWrite:null,colorWrite:null,stencilWrite:Jf,stencilTest:u_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Te.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Te.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}mk.shader=new rr(Mst,()=>import("./LineMarker.glsl.54df04b0.js"));class Sa extends na{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Sa.prototype,"output",void 0),u([j({count:yt.COUNT})],Sa.prototype,"transparencyPassType",void 0),u([j()],Sa.prototype,"occluder",void 0),u([j()],Sa.prototype,"hasSlicePlane",void 0),u([j()],Sa.prototype,"writeDepth",void 0),u([j()],Sa.prototype,"draped",void 0),u([j()],Sa.prototype,"hasCap",void 0),u([j()],Sa.prototype,"vvSize",void 0),u([j()],Sa.prototype,"vvColor",void 0),u([j()],Sa.prototype,"vvOpacity",void 0),u([j()],Sa.prototype,"hasOccludees",void 0),u([j()],Sa.prototype,"hasMultipassTerrain",void 0),u([j()],Sa.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Sa.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],Sa.prototype,"hasSliceTranslatedView",void 0);class Ost extends hm{constructor(t){super(t,new Pst),this._vertexAttributeLocations=ETe,this.techniqueConfig=new Sa,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Te.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==kh.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===$r.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=ns().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Ist(this.layout,this.parameters)}requiresSlot(t,i){if(t===Te.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===$r.OccludeAndTransparentStencil)return t===Te.OPAQUE_MATERIAL||t===Te.OCCLUDER_MATERIAL||t===Te.TRANSPARENT_OCCLUDER_MATERIAL;const r=zw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Te.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new Rst(t):null}}class Rst extends sZ{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(mk,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Pst extends KZ{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=kh.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class Ist{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(O.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(a=i.vertexAttributes.get(O.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(c=i.vertexAttributes.get(O.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(r.buffer);let y=s*(this.vertexBufferLayout.stride/4);const v=(T,E,C,A)=>{if(m[y++]=T[0],m[y++]=T[1],m[y++]=T[2],m[y++]=C[0],m[y++]=C[1],m[y++]=E[0],m[y++]=E[1],m[y++]=E[2],this.parameters.vvSizeEnabled?m[y++]=l:m[y++]=a,this.parameters.vvColorEnabled)m[y++]=h;else{const I=Math.min(4*A,c.length-4);m[y++]=c[I+0],m[y++]=c[I+1],m[y++]=c[I+2],m[y++]=c[I+3]}this.parameters.vvOpacityEnabled&&(m[y++]=p)};let b;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(b||(b={}));const w=(T,E)=>{const C=ie($st,n[3*T],n[3*T+1],n[3*T+2]),A=Dst;let I=T+E;do ie(A,n[3*I],n[3*I+1],n[3*I+2]),I+=E;while(hw(C,A)&&I>=0&&I<o);f&&(ke(C,C,f),ke(A,A,f)),v(C,A,[-1,-1],T),v(C,A,[1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,1],T)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||w(0,b.ASCENDING),S!=="end"&&S!=="begin-end"||w(o-1,b.DESCENDING)}}const $st=R(),Dst=R(),Wo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Lst={dash:Wo.dash,"dash-dot":[...Wo.dash,...Wo.dot],dot:Wo.dot,"long-dash":Wo["long-dash"],"long-dash-dot":[...Wo["long-dash"],...Wo.dot],"long-dash-dot-dot":[...Wo["long-dash"],...Wo.dot,...Wo.dot],none:null,"short-dash":Wo["short-dash"],"short-dash-dot":[...Wo["short-dash"],...Wo["short-dot"]],"short-dash-dot-dot":[...Wo["short-dash"],...Wo["short-dot"],...Wo["short-dot"]],"short-dot":Wo["short-dot"],solid:null},Nst=8;function Fst(e,t=2){return M(e)?e:{pattern:e.slice(),pixelRatio:t}}function GTt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function CTe(e){return _(e)&&e.type==="style"?Ust(e.style):null}function Ust(e){return _(e)?Fst(Lst[e],Nst):null}const kst=["polyline","polygon","extent"];class gk extends pm{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kR(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:Iu(1);if(t<0)throw new q("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=Sst(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:zH(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:CTe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?F(F({},s),this._fastUpdates.materialParameters):s}get _materialColor(){return Qs(this.symbolLayer.material,t=>t.color)}get _markerColor(){return Qs(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return M(this._lineMaterial)&&(this._lineMaterial=new OS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return M(this._ringMaterial)&&(this._ringMaterial=new OS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return M(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new OS(ye(F({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return M(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new OS(ye(F({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return M(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new Ost(ye(F({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=Hi(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?no($tt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Fg(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=vi(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Fg(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Fg(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,kst,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Uu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!zR(this._fastUpdates,i,this._vvConvertOptions))return rn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return rn.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=zH(_t(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=en(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=vi(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j3(gk.elevationModeChangeTypes,r,s);if(n!==Yr.UPDATE)return n;const o=Xh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Xt)return la.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=ks(),p=hst(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:b,mapPosition:w}=p.lines[v];if(_(this._context.clippingExtent)&&(pr(h),xu(h,w),!Jd(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,b,w,n.type,mO.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Us),Wi.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Us));const T=this.markerMaterial;_(T)&&(a.push(S.cloneShallow()),l.push(T),c.push(Us))}if(a.length===0)return null;const m=new vy({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new dm(this,m,a,null,null,Wet,i);return y.alignedSampledElevation=p.sampledElevation,y.needsElevationUpdates=Xh(i.mode),y}_createGeometry(t,i,r,s,n){const o=s==="polygon"?jw.REMOVE:jw.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return kH({overlayInfo:n===mO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Wi.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=ks(),p=pr(),f=dst(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(pr(h),xu(h,y.position),!Jd(h,this._context.clippingExtent))continue;S2(p,h);const v=this._createGeometry(t,y.position,null,s.type,mO.DRAPED),b=S=>{const T=new oE(v,S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(_(l)){const S=b(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||xu(h,y.position,0,1),T!=="end"&&T!=="begin-end"||xu(h,y.position,y.position.length-3,1),this._updateBoundingSphere(S,h)}const w=b(o);if(this._updateBoundingSphere(w,h),Wi.LINE_WIREFRAMES){const S=b(a);this._updateBoundingSphere(S,h)}}return new pk(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){Ji(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=_t(t,Iu(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?no(1):1:no(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(M(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?Qs(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(B5(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(M(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:M(this._markerColor)};const s=r.diff.color;if(M(s))return delete i.marker,{changed:!1,useMaterialColor:M(this._markerColor)};const n=s.newValue;return M(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){M(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var mO;gk.elevationModeChangeTypes={definedChanged:Yr.RECREATE,staysOnTheGround:Yr.NONE,onTheGroundChanged:Yr.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(mO||(mO={}));const $oe=2048,zst=1.5,Vst=8;function Bst(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=bQ(e,t.padding),a=Kst(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=Jst(e,a),h=int(i),p=ant[h];return{format:h,quality:Ne(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Gst(e,t){const i=Bst(e,t),r=i.area,s=i.width/r.width,n=bQ(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y}}function jst(e,t,i){const{ctx:r,canvas:s}=ATe(e,i),n=r.getImageData(0,0,e.width,e.height),o=Wst(s,t);return MTe(s),{dataUrl:o,data:n}}function Hst(e,t){const{ctx:i,canvas:r}=ATe(e,t),s=i.getImageData(0,0,e.width,e.height);return MTe(r),s}function ATe(e,t){const i=qst();t.premultipliedAlpha&&snt(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&rnt(r),{ctx:r,canvas:i}}function MTe(e){e.width=0,e.height=0}function qst(){return M(iB)&&(iB=document.createElement("canvas")),iB}let iB=null;function Wst(e,t){const i=nnt[t.format],r=t.quality/100;return e.toDataURL(i,r)}function rB(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(M4)try{return new ImageData(e,t)}catch{M4=!1}return OTe(e,t,i)}function Xst(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(M4)try{return new ImageData(e,t,i)}catch{M4=!1}const s=OTe(t,i,r);return s.data.set(e,0),s}function Yst(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),v=Math.ceil(m/2),b=e.width;for(let w=0;w<h;w++)for(let S=0;S<c;S++){const T=4*(S+(a?h-w-1:w)*c);let E=0,C=0,A=0,I=0,L=0,D=0;const k=(w+.5)*m;for(let z=Math.floor(w*m);z<(w+1)*m;z++){const V=Math.abs(k-(z+.5))/v,X=(S+.5)*f,Y=V*V;for(let le=Math.floor(S*f);le<(S+1)*f;le++){const re=Math.abs(X-(le+.5))/y,$=Math.sqrt(Y+re*re);if($>=1)continue;let U=2*$*$*$-3*$*$+1;const B=4*(r+le+(s+z)*b);D+=U*l[B+3],C+=U,!i&&l[B+3]<255&&(U=U*l[B+3]/255),A+=U*l[B],I+=U*l[B+1],L+=U*l[B+2],E+=U}}p[T]=A/E,p[T+1]=I/E,p[T+2]=L/E,p[T+3]=D/C}return t}function Zst(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=bQ(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(Vst,Math.min(($oe-l)/h,($oe-c)/p));return f<zst?e:ye(F({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function OTe(e,t,i){return i||(i=Qst()),i.getContext("2d").createImageData(e,t)}let zC=null,M4=!0;function Qst(){return zC||(zC=document.createElement("canvas"),zC.width=1,zC.height=1),zC}function Jst(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Kst(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return ent(tnt(i,e),t)}function ent(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function tnt(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function bQ(e,t){return!t||e&&e.ignorePadding?lnt:t}function int(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return ont}}function rnt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function snt(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const nnt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Doe=98,ont="png",ant={png:100,jpg:Doe,jpeg:Doe},lnt={top:0,right:0,bottom:0,left:0};var JT;const sB=new WeakMap;let cnt=0,af=JT=class extends xe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:yw(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:yw(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(sB.has(this.data)||sB.set(this.data,++cnt),t(sB.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new JT(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return Xst(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new JT({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new JT({data:e}):kv(JT,e)}};u([d({type:String,json:{write:jv}})],af.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],af.prototype,"data",null),u([He("data")],af.prototype,"writeData",null),u([Ie("data")],af.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],af.prototype,"transparent",null),u([d({json:{write:!0}})],af.prototype,"wrap",void 0),u([d({readOnly:!0})],af.prototype,"contentHash",null),af=JT=u([P("esri.geometry.support.MeshTexture")],af);const gO=af;var VH;let Zm=VH=class extends xe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new VH(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:We,json:{write:!0}})],Zm.prototype,"color",void 0),u([d({type:gO,json:{write:!0}})],Zm.prototype,"colorTexture",void 0),u([d({type:gO,json:{write:!0}})],Zm.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zm.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zm.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zm.prototype,"doubleSided",void 0),Zm=VH=u([P("esri.geometry.support.MeshMaterial")],Zm);const wQ=Zm;var BH;let Qm=BH=class extends wQ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new BH(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return ye(F({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:We,json:{write:!0}})],Qm.prototype,"emissiveColor",void 0),u([d({type:gO,json:{write:!0}})],Qm.prototype,"emissiveTexture",void 0),u([d({type:gO,json:{write:!0}})],Qm.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Qm.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Qm.prototype,"roughness",void 0),u([d({type:gO,json:{write:!0}})],Qm.prototype,"metallicRoughnessTexture",void 0),Qm=BH=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],Qm);const RTe=Qm;var rN;const Bx=de.getLogger("esri.geometry.support.MeshVertexAttributes");let Pa=rN=class extends xe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return KT(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Bx)}castPosition(e){return e&&e instanceof Float32Array&&Bx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),KT(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Bx)}castUv(e){return KT(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Bx)}castNormal(e){return KT(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Bx)}castTangent(e){return KT(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Bx)}clone(){const e={position:te(this.position),uv:te(this.uv),normal:te(this.normal),tangent:te(this.tangent),color:te(this.color)};return new rN(e)}clonePositional(){const e={position:te(this.position),normal:te(this.normal),tangent:te(this.tangent),uv:this.uv,color:this.color};return new rN(e)}};function nB(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function KT(e,t,i,r,s){if(!e)return e;if(e instanceof t)return nB(e,r,t,s);for(const n of i)if(e instanceof n)return nB(new t(e),r,t,s);if(Array.isArray(e))return nB(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function VC(e,t,i){t[i]=unt(e)}function unt(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:VC}})],Pa.prototype,"color",void 0),u([Nt("color")],Pa.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:VC}})],Pa.prototype,"position",void 0),u([Nt("position")],Pa.prototype,"castPosition",null),u([d({json:{write:VC}})],Pa.prototype,"uv",void 0),u([Nt("uv")],Pa.prototype,"castUv",null),u([d({json:{write:VC}})],Pa.prototype,"normal",void 0),u([Nt("normal")],Pa.prototype,"castNormal",null),u([d({json:{write:VC}})],Pa.prototype,"tangent",void 0),u([Nt("tangent")],Pa.prototype,"castTangent",null),Pa=rN=u([P("esri.geometry.support.MeshVertexAttributes")],Pa);var yM;const hnt=de.getLogger("esri.geometry.support.MeshComponent");let Jm=yM=class extends xe{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return kv(yM,e)}castFaces(e){return KT(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},hnt)}castMaterial(e){return kv(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?RTe:wQ,e)}clone(){return new yM({faces:te(this.faces),shading:this.shading,material:te(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:te(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new yM(i)}};u([d({json:{write:!0}})],Jm.prototype,"faces",void 0),u([Nt("faces")],Jm.prototype,"castFaces",null),u([d({type:wQ,json:{write:!0}})],Jm.prototype,"material",void 0),u([Nt("material")],Jm.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Jm.prototype,"shading",void 0),u([d({type:Boolean})],Jm.prototype,"trustSourceNormals",void 0),Jm=yM=u([P("esri.geometry.support.MeshComponent")],Jm);const Hw=Jm,yk=de.getLogger("esri.geometry.support.meshUtils.normalProjection");function K3(e,t,i,r,s){return Tk(r)?(xk(Ug.TO_PCPF,bi.fromTypedArray(e),Mr.fromTypedArray(t),Mr.fromTypedArray(i),r,bi.fromTypedArray(s)),s):(yk.error("Cannot convert spatial reference to PCPF"),s)}function vk(e,t,i,r,s){return Tk(r)?(xk(Ug.FROM_PCPF,bi.fromTypedArray(e),Mr.fromTypedArray(t),Mr.fromTypedArray(i),r,bi.fromTypedArray(s)),s):(yk.error("Cannot convert to spatial reference from PCPF"),s)}function _k(e,t,i){return tr(e,t,0,i,Il(t),0,e.length/3),i}function bk(e,t,i){return tr(e,Il(i),0,t,i,0,e.length/3),t}function PTe(e,t,i){if(M(e))return t;const r=Mr.fromTypedArray(e),s=Mr.fromTypedArray(t);return sy(s,r,i),t}function ITe(e,t,i){if(M(e))return t;Jv(Mn,i);const r=bi.fromTypedArray(e),s=bi.fromTypedArray(t);return Yh(s,r,Mn),dZ(Mn)||hQ(s,s),t}function $Te(e,t,i){if(M(e))return t;Jv(Mn,i);const r=bi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=bi.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Yh(s,r,Mn),dZ(Mn)||hQ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function eP(e,t,i,r,s){if(!Tk(r))return yk.error("Cannot convert spatial reference to PCPF"),s;xk(Ug.TO_PCPF,bi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Mr.fromTypedArray(t),Mr.fromTypedArray(i),r,bi.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function wk(e,t,i,r,s){if(!Tk(r))return yk.error("Cannot convert to spatial reference from PCPF"),s;xk(Ug.FROM_PCPF,bi.fromTypedArray(e,16),Mr.fromTypedArray(t),Mr.fromTypedArray(i),r,bi.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function xk(e,t,i,r,s,n){if(!t)return;const o=i.count,a=Il(s);if(DTe(s))for(let l=0;l<o;l++)r.getVec(l,f$),t.getVec(l,Lp),ua(a,f$,m$,a),Sc(Mn,m$),e===Ug.FROM_PCPF&&Hh(Mn,Mn),Oo(Lp,Lp,Mn),n.setVec(l,Lp);else for(let l=0;l<o;l++){r.getVec(l,f$),t.getVec(l,Lp),ua(a,f$,m$,a),Sc(Mn,m$);const c=sF(i.get(l,1));let h=Math.cos(c);e===Ug.TO_PCPF&&(h=1/h),Mn[0]*=h,Mn[1]*=h,Mn[2]*=h,Mn[3]*=h,Mn[4]*=h,Mn[5]*=h,e===Ug.FROM_PCPF&&Hh(Mn,Mn),Oo(Lp,Lp,Mn),we(Lp,Lp),n.setVec(l,Lp)}return n}function Tk(e){return DTe(e)||dnt(e)}function DTe(e){return e.isWGS84||Mpe(e)||tm(e)||im(e)}function dnt(e){return e.isWebMercator}var Ug;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Ug||(Ug={}));const f$=R(),Lp=R(),m$=Ee(),Mn=ir();function pnt(e){const t=new Xi;t.include(Io),t.include(ux,e),t.include(Rxe,e),Ou(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),i.uniforms.add(new oi("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new Xe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),e.output===K.Highlight&&t.include(my),t.include(fs,e),r.uniforms.add(new Xe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new oi("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${x.float(Do)}) {
      discard;
    }

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""}
  }
  `),t}const fnt=Object.freeze(Object.defineProperty({__proto__:null,build:pnt},Symbol.toStringTag,{value:"Module"}));class Sk extends dr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==K.Highlight}initializeProgram(t){const i=Sk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>zt({blending:n,depthTest:pQ,depthWrite:o,colorWrite:ri,stencilWrite:t.hasOccludees?Jf:null,stencilTest:t.hasOccludees?s?u_:x_:null});return t.output===K.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,Dl),r(!1,t.transparent||this.stippleEnabled?i:null,Dl)):r(!1)}get primitiveType(){return $t.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}Sk.shader=new rr(fnt,()=>import("./NativeLine.glsl.c6d7f3eb.js"));class Wc extends na{constructor(){super(...arguments),this.output=K.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([j({count:K.COUNT})],Wc.prototype,"output",void 0),u([j()],Wc.prototype,"hasSlicePlane",void 0),u([j()],Wc.prototype,"hasVertexColors",void 0),u([j()],Wc.prototype,"transparent",void 0),u([j()],Wc.prototype,"draped",void 0),u([j()],Wc.prototype,"stippleEnabled",void 0),u([j()],Wc.prototype,"stippleOffColorEnabled",void 0),u([j()],Wc.prototype,"stipplePreferContinuous",void 0),u([j()],Wc.prototype,"hasOccludees",void 0),u([j({constValue:!1})],Wc.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],Wc.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],Wc.prototype,"stippleRequiresStretchMeasure",void 0);const mnt=de.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var O4;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(O4||(O4={}));class Loe extends hm{constructor(t){super(t,new vnt),this._techniqueConfig=new Wc}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===Te.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?NJe(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||N3(i))return;if(!G1e(r))return void mnt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(O.POSITION).data,a=s.camera,l=bnt;co(l,s.point);const c=2;ie(BC[0],l[0]-c,l[1]+c,0),ie(BC[1],l[0]+c,l[1]+c,0),ie(BC[2],l[0]+c,l[1]-c,0),ie(BC[3],l[0]-c,l[1]-c,0);for(let y=0;y<4;y++)if(!a.unprojectFromRenderScreen(BC[y],Sm[y]))return;ia(a.eye,Sm[0],Sm[1],oB),ia(a.eye,Sm[1],Sm[2],aB),ia(a.eye,Sm[2],Sm[3],lB),ia(a.eye,Sm[3],Sm[0],cB);let h=Number.MAX_VALUE,p=0;for(let y=0;y<o.length-5;y+=3){if(Ea[0]=o[y]+r[12],Ea[1]=o[y+1]+r[13],Ea[2]=o[y+2]+r[14],Ca[0]=o[y+3]+r[12],Ca[1]=o[y+4]+r[13],Ca[2]=o[y+5]+r[14],lr(oB,Ea)<0&&lr(oB,Ca)<0||lr(aB,Ea)<0&&lr(aB,Ca)<0||lr(lB,Ea)<0&&lr(lB,Ca)<0||lr(cB,Ea)<0&&lr(cB,Ca)<0)continue;if(a.projectToRenderScreen(Ea,Y_),a.projectToRenderScreen(Ca,Z_),Y_[2]<0&&Z_[2]>0){fe(Np,Ea,Ca);const b=a.frustum,w=-lr(b[ar.NEAR],Ea)/Se(Np,b[ar.NEAR]);oe(Np,Np,w),pe(Ea,Ea,Np),a.projectToRenderScreen(Ea,Y_)}else if(Y_[2]>0&&Z_[2]<0){fe(Np,Ca,Ea);const b=a.frustum,w=-lr(b[ar.NEAR],Ca)/Se(Np,b[ar.NEAR]);oe(Np,Np,w),pe(Ca,Ca,Np),a.projectToRenderScreen(Ca,Z_)}else if(Y_[2]<0&&Z_[2]<0)continue;Y_[2]=0,Z_[2]=0;const v=_X(Qb(Y_,Z_,Uoe),l);v<h&&(h=v,ne(Noe,Ea),ne(Foe,Ca),p=y/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let y=Number.MAX_VALUE;if(_ge(Qb(Noe,Foe,Uoe),Qb(f,m,_nt),X_)){fe(X_,X_,f);const v=Re(X_);oe(X_,X_,1/v),y=v/ur(f,m)}n(y,X_,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(O.POSITION);return _Z(s,null,!1,i)}requiresSlot(t){return t===Te.OPAQUE_MATERIAL||t===Te.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Highlight?new gnt(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?Wxe:Dit;return M(this.parameters.stipplePattern)?new uk(t):new ynt(t.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}}class gnt extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===K.Color&&this._updateOccludeeState(t),this.ensureTechnique(Sk,t)}}class ynt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){jU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(O.AUXPOS1,bi),o=i.indices.get(O.POSITION),a=i.vertexAttributes.get(O.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],v=a[m+1],b=a[m+2],w=l[0]*y+l[4]*v+l[8]*b+l[12],S=l[1]*y+l[5]*v+l[9]*b+l[13],T=l[2]*y+l[6]*v+l[10]*b+l[14];h[s]=w,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(t,i,r,s){var E;const n=r.getField(O.UV0,qh),o=i.indices.get(O.POSITION),a=i.vertexAttributes.get(O.POSITION).data,l=(E=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=O4.START,p[s+1]=f,s+=h;const m=3*o[0],y=ie(Ea,a[m],a[m+1],a[m+2]);c&&ke(y,y,c);const v=Ca,b=o.length-1;let w=1;const S=l?(C,A,I)=>f=l[I]:(C,A,I)=>f+=ur(C,A);for(let C=1;C<b;C+=2){const A=3*o[C];ie(v,a[A],a[A+1],a[A+2]),c&&ke(v,v,c),S(y,v,w++);for(let I=0;I<2;++I)p[s]=1-I,p[s+1]=f,s+=h;ne(y,v)}const T=3*o[b];ie(v,a[T],a[T+1],a[T+2]),c&&ke(v,v,c),S(y,v,w),p[s]=O4.END,p[s+1]=f}}class vnt extends WE{constructor(){super(...arguments),this.color=Ph,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Ea=R(),Ca=R(),Np=R(),X_=R(),Y_=Ro(),Z_=Ro(),Noe=R(),Foe=R(),Uoe=nm(),_nt=nm(),bnt=R(),BC=[Ro(),Ro(),Ro(),Ro()],Sm=[R(),R(),R(),R()],oB=Ei(),aB=Ei(),lB=Ei(),cB=Ei(),wnt=["mesh"];class xnt extends pm{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Wi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Loe({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Loe({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,wnt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Uu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,c_)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return M(t)?"-":t instanceof We?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof RTe){const{metallic:y,roughness:v,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:S,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(b),C=this._colorOrTextureUid(w),A=this._colorOrTextureUid(S),I=this._colorOrTextureUid(T);s.metallic=y,s.roughness=v,s.metallicRoughnessTexture=b,s.emissiveColor=w,s.emissiveTexture=S,s.occlusionTexture=T,s.uid=`${s.uid},mrm:${y},mrr:${v},mrt:${E},emuid:${C},etmuid:${A},otmuid:${I}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=We.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,cr.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new $s(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==cr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return wt.CLAMP_TO_EDGE;case"mirror":return wt.MIRRORED_REPEAT;default:return wt.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=We.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=Ph;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=We.toUnitRGBA(s):(r=null,t.externalColor=Ph)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(M(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var y,v,b;const r=(y=i.material)==null?void 0:y.color,s=(v=i.material)==null?void 0:v.colorTexture,n=(b=i.material)==null?void 0:b.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||_(r)&&r.a<1||_(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:No,diffuse:Rf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:hr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?hr.None:hr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Gw(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?cr.MaskBlend:cr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?cr.Opaque:i.alphaMode==="mask"?cr.Mask:cr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let y=0;y<n;y++){const v=i[y],b=v.vertexAttributes.get(O.POSITION),w=v.vertexAttributes.get(O.NORMAL),S=v.indices.get(O.POSITION),T=v.indices.get(O.NORMAL),E=b.data,C=w.data;for(let A=0;A<S.length;A++){const I=3*S[A],L=3*T[A];for(let D=0;D<3;D++)l.push(E[I+D]);for(let D=0;D<3;D++)l.push(E[I+D]+C[L+D]*a);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,S,A,Hx),this._getFaceVertices(E,S,A,yo,Gx,jx),pe(yo,yo,Gx),pe(yo,yo,jx),oe(yo,yo,1/3);for(let D=0;D<3;D++)h.push(yo[D]);for(let D=0;D<3;D++)h.push(yo[D]+Hx[D]*a);p.push(p.length),p.push(p.length)}}}const f=new Nr([[O.POSITION,{data:l,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(c)]],El.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(Zb(s[0]));const m=new Nr([[O.POSITION,{data:h,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(p)]],El.Line);i.push(m),r.push(this._debugFaceNormalMaterial),s.push(Zb(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;Wi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new vy({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,y=new dm(this,p,a,null,null,$R,r,m);return y.needsElevationUpdates=c_(r.mode),y.useObjectOriginAsAttachmentOrigin=!0,y.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),y.alignedSampledElevation=$R(y,y.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),y}_getCenterPointInElevationSR(t){const i=yy(0,0,0,this._context.elevationProvider.spatialReference);return Gme([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(M(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,Hx);for(let a=0;a<3;a++){const l=3*s[o+a];yo[0]=i[l+0],yo[1]=i[l+1],yo[2]=i[l+2],Se(Hx,yo)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,Hx);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,Hx);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:R(),count:0},r[c]=h),pe(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,yo,Gx,jx),fe(Gx,Gx,yo),fe(jx,jx,yo),lt(yo,Gx,jx),we(s,yo),s}_getOrCreateComponents(t){return _t(t.components,Tnt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===Qc.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=PTe(r,new Float64Array(r.length),s)),i.reprojection===Qc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return tr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(M(s))return null;const n=r.reprojection===Qc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=ITe(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Qc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return K3(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(M(s))return null;const n=r.reprojection===Qc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=$Te(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Qc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return eP(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=aTe(en(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return lTe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Qc.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===Qc.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ee()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ge.Local?Qc.NONE:Qc.ECEF;if(i){if(r===Qc.NONE){const n=Ee();return ua(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:Zb(t.transform.localMatrix),needsBufferCopy:!1}}const s=U5(Ee(),t.transform.origin);return Dr(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;g$[0]=o.x,g$[1]=o.y,g$[2]=o.z;const a=Ee();ua(t.spatialReference,g$,a,n);const l=Mr.fromTypedArray(i);if(Xr(koe,a),sy(l,l,koe),_(r)||_(s)){if(Sc(GC,a),Hh(GC,GC),_(r)){const c=bi.fromTypedArray(r);Yh(c,c,GC)}if(_(s)){const c=bi.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);Yh(c,c,GC)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:Y2(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),tr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),pr(uB),xu(uB,s,0,n),!Jd(uB,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!qv(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(M(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),m=[],y=[],v=[];let b=!1;for(const w of f){if(!this._validateFaces(t,w))return null;const S=this._getOrCreateFaces(t,w);if(S.length===0)continue;const T=this._createComponentNormals(s,l,w,S);T.didFlipNormals&&(b=!0);const E=[[O.POSITION,{size:3,data:s,exclusive:!0}],[O.NORMAL,{size:3,data:T.normals,exclusive:!0}]],C=[[O.POSITION,S],[O.NORMAL,T.indices]];_(o)&&(E.push([O.COLOR,{size:4,data:o,exclusive:!0}]),C.push([O.COLOR,S])),_(a)&&(E.push([O.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),C.push([O.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(E.push([O.UV0,{size:2,data:n,exclusive:!0}]),C.push([O.UV0,S])),_(c)&&(E.push([O.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([O.TANGENT,S]));const A=new Nr(E,C);m.push(A),y.push(p),v.push(this._getOrCreateMaterial(t,w))}return b&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:y,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return fxe(this.symbolLayer,t)}}const g$=R(),yo=R(),Gx=R(),jx=R(),Hx=R(),koe=Ee(),GC=ir(),uB=ks(),Tnt=[new Hw];var Qc;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(Qc||(Qc={}));class Snt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){nQ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=R()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Fp),ke(t,this.lodRenderer.baseBoundingSphere.center,Fp)}getBoundingBoxObjectSpace(t=ks()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Fp);const i=this.lodRenderer.baseBoundingBox;pr(t);for(let r=0;r<8;++r)ie(qu,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),ke(qu,qu,Fp),qf(t,qu);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Fp),t.render.origin[0]+=Fp[12],t.render.origin[1]+=Fp[13],t.render.origin[2]+=Fp[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Ent,l=R5(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Fp);for(let h=0;h<l;h++){const p=a[h];qu[0]=o[p[0]],qu[1]=o[p[1]],qu[2]=o[p[2]],ke(qu,qu,Fp),Q_[3*h+0]=qu[0],Q_[3*h+1]=qu[1],Q_[3*h+2]=qu[2]}if(!t(Q_,0,l))return null;pr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Q_[h+p]),o[p+3]=Math.max(o[p+3],Q_[h+p]);c&&r.push({location:Q_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(Qd(o,hB),this.elevationContext.mode!=="absolute-height")){let h;const p=rQ(o,i);try{h=await i.service.queryElevation(hB[0],hB[1],s,p,"ground")}catch{}_(h)&&$fe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===Kg.Highlight){const r=new _4(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Q_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],qu=R(),hB=R(),Ent=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Fp=Ee();function Cnt(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function Ant(e){return{levels:e.map(t=>Cnt(t))}}function Mnt(e,t=Rnt){const i=utt(e);return Math.sqrt(i/(t*Math.PI))}function Ont(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=Mnt(t))})}const Rnt=.05;function jTt(e){return e=e||globalThis.location.hostname,Int.some(t=>(e==null?void 0:e.match(t))!=null)}function Pnt(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(LTe)!=null||t.match(FTe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(NTe)!=null||t.match(UTe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const LTe=/^devext.arcgis.com$/,NTe=/^qaext.arcgis.com$/,FTe=/^[\w-]*\.mapsdevext.arcgis.com$/,UTe=/^[\w-]*\.mapsqa.arcgis.com$/,Int=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,LTe,NTe,/^jsapps.esri.com$/,FTe,UTe];function $nt(e,t,i){if(e.count!==t.count)return void KU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],v=i[11],b=i[12],w=i[13],S=i[14],T=i[15],E=e.typedBuffer,C=e.typedBufferStride,A=t.typedBuffer,I=t.typedBufferStride;for(let L=0;L<r;L++){const D=L*C,k=L*I,z=A[k],V=A[k+1],X=A[k+2],Y=A[k+3];E[D]=s*z+l*V+f*X+b*Y,E[D+1]=n*z+c*V+m*X+w*Y,E[D+2]=o*z+h*V+y*X+S*Y,E[D+3]=a*z+p*V+v*X+T*Y}}function kTe(e,t,i){if(e.count!==t.count)return void KU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,T=w*b,E=v[T],C=v[T+1],A=v[T+2],I=v[T+3];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A,m[S+3]=I}}function Dnt(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function GH(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function Lnt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:$nt,transformMat3:kTe,normalize:Dnt,scale:GH,shiftRight:Lnt},Symbol.toStringTag,{value:"Module"}));function Nnt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Nnt},Symbol.toStringTag,{value:"Module"}));function Fnt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Fnt},Symbol.toStringTag,{value:"Module"}));function Unt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function sN(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:Unt,makeDense:sN},Symbol.toStringTag,{value:"Module"}));function zTe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function VTe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(DWe(t.elementType)){const h=LWe(t.elementType);if($We(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else zTe(e,t,i);return e}function knt(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:zTe,normalizeIntegerBuffer:VTe,fill:knt},Symbol.toStringTag,{value:"Module"}));function tP(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function znt(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:tP,fill:znt},Symbol.toStringTag,{value:"Module"}));function BTe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function GTe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:BTe,fill:GTe},Symbol.toStringTag,{value:"Module"}));function Sb(e,t){return new e(new ArrayBuffer(t*e.ElementCount*V1e(e.ElementType)))}class jTe{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return em(t)?(Wt(i),Che(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(M(this.streamDataRequester))return(await _i(i,{responseType:Vnt[t]})).data;const s=await mp(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw bp(s.error),new q("",`Request for resource failed: ${s.error}`)}}const Vnt={image:"image",binary:"array-buffer",json:"json"},Bnt=de.getLogger("esri.views.3d.glTF");class Gnt{error(t){throw new q("gltf-loader-error",t)}errorUnsupported(t){throw new q("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){Bnt.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function jnt(e={}){return F({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function Hnt(e,t={}){return{data:e,parameters:F({wrap:F({s:wt.REPEAT,t:wt.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class d_{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new q(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new d_(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new q((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new q((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new d_(o,a,i)}}class zoe{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var yO,Voe;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(yO||(yO={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Voe||(Voe={}));const HTe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},qnt={pbrMetallicRoughness:HTe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Wnt={ESRI_externalColorMixMode:"tint"},Boe=(e={})=>{const t=F(F({},HTe),e.pbrMetallicRoughness),i=Xnt(F(F({},Wnt),e.extras));return ye(F(F({},qnt),e),{pbrMetallicRoughness:t,extras:i})};function Xnt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Ynt={magFilter:it.LINEAR,minFilter:it.LINEAR_MIPMAP_LINEAR,wrapS:wt.REPEAT,wrapT:wt.REPEAT},Znt=e=>F(F({},Ynt),e);function Qnt(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const y$={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class dg{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Qnt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(em(r)){const a=u5(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new dg(t,i,r,c)}catch{}const l=Che(r);if(dg._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new dg(t,i,r,a)}const n=await t.loadBinary(r,s);if(dg._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new dg(t,i,r,o)}static _isGLBData(t){const i=new zoe(t);return i.remainingBytes()>=4&&i.readUint32()===y$.MAGIC}static async _fromGLBData(t,i,r,s){const n=await dg._parseGLBData(i,s);return new dg(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new zoe(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===y$.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===y$.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await rot(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==y$.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[yO.MAT2,yO.MAT3,yO.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=eot[s.type],l=tot[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case dt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case dt.UNSIGNED_BYTE:return sN(this._wrapAccessor(ty,r));case dt.UNSIGNED_SHORT:return sN(this._wrapAccessor(Iw,r));case dt.UNSIGNED_INT:return sN(this._wrapAccessor(Dw,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+_$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(bi,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+_$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(bi,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+_$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new Un(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===dt.FLOAT?this._wrapAccessor(qh,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),iot(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===dt.FLOAT)return this._wrapAccessor(Un,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(Ll,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(r_,s)}else if(s.componentCount===3){if(s.componentType===dt.FLOAT)return this._wrapAccessor(bi,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(i_,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor($w,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+_$[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?Boe(this.json.materials[t.material]):Boe(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=Znt(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return kq(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Knt;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=Dr(Ee(),r,s.matrix):s.translation||s.rotation||s.scale?(i=Zb(r),s.translation&&ca(i,i,s.translation),s.rotation&&(v$[3]=JY(v$,s.rotation),vl(i,i,v$[3],v$)),s.scale&&v3(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return _u(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=d_.parse(this.json.asset.version,"glTF");Jnt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),sot(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const Jnt=new d_(2,0,"glTF"),Knt=Cme(Ee(),Math.PI/2),v$=wp(),eot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},tot={[dt.BYTE]:1,[dt.UNSIGNED_BYTE]:1,[dt.SHORT]:2,[dt.UNSIGNED_SHORT]:2,[dt.FLOAT]:4,[dt.UNSIGNED_INT]:4};function iot(e){switch(e.componentType){case dt.BYTE:return new Lw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_BYTE:return new Pw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.SHORT:return new Nw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_SHORT:return new q2(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_INT:return new W2(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.FLOAT:return new qh(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function rot(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function sot(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const _$={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let not=0;async function qTe(e,t,i={},r=!0){const s=await dg.load(e,nN,t,i),n="gltf_"+not++,o={lods:[],materials:new Map,textures:new Map,meta:oot(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await aot(s,async(c,h,p,f)=>{var D;const m=(D=l.get(p))!=null?D:0;l.set(p,m+1);const y=c.mode!==void 0?c.mode:$t.TRIANGLES,v=y===$t.TRIANGLES||y===$t.TRIANGLE_STRIP||y===$t.TRIANGLE_FAN?y:null;if(M(v))return void nN.warnUnsupported("Unsupported primitive mode ("+hot[y]+"). Skipping primitive.");if(!s.hasPositions(c))return void nN.warn("Skipping primitive without POSITION vertex attribute.");const b=s.getPositionData(c,i),w=s.getMaterial(c,i,r),S=s.hasNormals(c)?s.getNormalData(c,i):null,T=s.hasTangents(c)?s.getTangentData(c,i):null,E=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,C=s.hasVertexColors(c)?s.getVertexColors(c,i):null,A=s.getIndexData(c,i),I={transform:Zb(h),attributes:{position:await b,normal:S?await S:null,texCoord0:E?await E:null,color:C?await C:null,tangent:T?await T:null},indices:await A,primitiveType:v,material:cot(o,await w,n)};let L=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(L=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:L},o.lods[p].parts[m]=I});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function oot(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function aot(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),lot(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(nN.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function lot(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function cot(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=Hnt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:uot.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=jnt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const nN=new Gnt,uot=[it.LINEAR_MIPMAP_LINEAR,it.LINEAR_MIPMAP_NEAREST],hot=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function dot(e,t=Y2){return typeof e=="number"?t(e):RN(e)||lb(e)?new Uint32Array(e):e}function pot(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function fot(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const Km=de.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function WTe(e,t){const i=await mot(e,t);return{resource:i,textures:await bot(i.textureDefinitions,t)}}async function mot(e,t){const i=_(t)&&t.streamDataRequester;if(i)return got(e,i,t);const r=await mp(_i(e,t));if(r.ok===!0)return r.value.data;bp(r.error),XTe(r.error)}async function got(e,t,i){const r=await mp(t.request(e,"json",i));if(r.ok===!0)return r.value;bp(r.error),XTe(r.error.details.url)}function XTe(e){throw new q("",`Request for object resource failed: ${e}`)}function yot(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(Km.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Km.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Km.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Km.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Km.warn("Indexed geometries must specify faces"),r=!1;break}default:Km.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(Km.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Km.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function vot(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=d_.parse(o.version||"1.0","wosr");xot.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!yot(v))continue;const b=wot(v),w=v.params.vertexAttributes,S=[];for(const D in w){const k=w[D],z=k.values;S.push([D,{data:z,size:k.valuesPerElement,exclusive:!0}])}const T=[];if(v.params.topology!=="PerAttributeArray"){const D=v.params.faces;for(const k in D)T.push([k,new Uint32Array(D[k].values)])}const E=p&&p[b.texture];if(E&&!m.has(b.texture)){const{image:D,params:k}=E,z=new $s(D,k);n.push(z),m.set(b.texture,z)}const C=m.get(b.texture),A=C?C.id:void 0;let I=s[b.material]?s[b.material][b.texture]:null;if(!I){const D=h[b.material.substring(b.material.lastIndexOf("/")+1)].params;D.transparency===1&&(D.transparency=0);const k=E&&E.alphaChannelUsage,z=D.transparency>0||k==="transparency"||k==="maskAndTransparency",V=E?YTe(E.alphaChannelUsage):void 0,X={ambient:dl(D.diffuse),diffuse:dl(D.diffuse),opacity:1-(D.transparency||0),transparent:z,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:hr.None,colorMixMode:D.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(X,t.materialParamsMixin),I=new Gw(X),s[b.material]||(s[b.material]={}),s[b.material][b.texture]=I}r.push(I);const L=new Nr(S,T);f+=T.position?T.position.length:0,i.push(L)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:_ot(i),numberOfVertices:f,lodThreshold:null}}function _ot(e){const t=pr();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(qf(t,r.getBBMin()),qf(t,r.getBBMax()))}),t}async function bot(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){Km.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:wt.REPEAT,t:wt.REPEAT},preMultiplyAlpha:YTe(h)!==cr.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):yp(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function YTe(e){switch(e){case"mask":return cr.Mask;case"maskAndTransparency":return cr.MaskBlend;case"none":return cr.Opaque;default:return cr.Blend}}function wot(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const xot=new d_(1,2,"wosr"),qx=2.1;async function ZTe(e,t){const i=QTe(Pnt(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):WTe(i.url,t)),c=vot(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):qTe(new jTe(t.streamDataRequester),i.url,t,t.usePBR)),s=en(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&Eot(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=ye(F({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=oN(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=oN(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=oN(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function QTe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function oN(e,t,i,r){const s=e.model,n=ir(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:pr()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),y=s.materials.get(f.material),v=_(f.attributes.texCoord0),b=_(f.attributes.normal),w=Tot(y.alphaMode);if(!a.has(m)){if(v){if(_(y.textureColor)&&!l.has(y.textureColor)){const re=s.textures.get(y.textureColor),$=ye(F({},re.parameters),{preMultiplyAlpha:w!==cr.Opaque});l.set(y.textureColor,new $s(re.data,$))}if(_(y.textureNormal)&&!l.has(y.textureNormal)){const re=s.textures.get(y.textureNormal);l.set(y.textureNormal,new $s(re.data,re.parameters))}if(_(y.textureOcclusion)&&!l.has(y.textureOcclusion)){const re=s.textures.get(y.textureOcclusion);l.set(y.textureOcclusion,new $s(re.data,re.parameters))}if(_(y.textureEmissive)&&!l.has(y.textureEmissive)){const re=s.textures.get(y.textureEmissive);l.set(y.textureEmissive,new $s(re.data,re.parameters))}if(_(y.textureMetallicRoughness)&&!l.has(y.textureMetallicRoughness)){const re=s.textures.get(y.textureMetallicRoughness);l.set(y.textureMetallicRoughness,new $s(re.data,re.parameters))}}const D=y.color[0]**(1/qx),k=y.color[1]**(1/qx),z=y.color[2]**(1/qx),V=y.emissiveFactor[0]**(1/qx),X=y.emissiveFactor[1]**(1/qx),Y=y.emissiveFactor[2]**(1/qx),le=_(y.textureColor)&&v?l.get(y.textureColor):null;a.set(m,new Gw(F(ye(F({},t),{transparent:w===cr.Blend,customDepthTest:Cw.Lequal,textureAlphaMode:w,textureAlphaCutoff:y.alphaCutoff,diffuse:[D,k,z],ambient:[D,k,z],opacity:y.opacity,doubleSided:y.doubleSided,doubleSidedType:"winding-order",cullFace:y.doubleSided?hr.None:hr.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:b?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(le)?le.id:void 0,colorMixMode:y.colorMixMode,normalTextureId:_(y.textureNormal)&&v?l.get(y.textureNormal).id:void 0,textureAlphaPremultiplied:_(le)&&!!le.params.preMultiplyAlpha,occlusionTextureId:_(y.textureOcclusion)&&v?l.get(y.textureOcclusion).id:void 0,emissiveTextureId:_(y.textureEmissive)&&v?l.get(y.textureEmissive).id:void 0,metallicRoughnessTextureId:_(y.textureMetallicRoughness)&&v?l.get(y.textureMetallicRoughness).id:void 0,emissiveFactor:[V,X,Y],mrrFactors:[y.metallicFactor,y.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=Sot(f.indices||f.attributes.position.count,f.primitiveType),T=f.attributes.position.count,E=Sb(bi,T);sy(E,f.attributes.position,f.transform);const C=[[O.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],A=[[O.POSITION,S]];if(_(f.attributes.normal)){const D=Sb(bi,T);Jv(n,f.transform),Yh(D,f.attributes.normal,n),C.push([O.NORMAL,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.NORMAL,S])}if(_(f.attributes.tangent)){const D=Sb(Un,T);Jv(n,f.transform),kTe(D,f.attributes.tangent,n),C.push([O.TANGENT,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.TANGENT,S])}if(_(f.attributes.texCoord0)){const D=Sb(qh,T);VTe(D,f.attributes.texCoord0),C.push([O.UV0,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.UV0,S])}if(_(f.attributes.color)){const D=Sb(Ll,T);if(f.attributes.color.elementCount===4)f.attributes.color instanceof Un?GH(D,f.attributes.color,255):f.attributes.color instanceof Ll?BTe(D,f.attributes.color):f.attributes.color instanceof r_&&GH(D,f.attributes.color,1/256);else{GTe(D,255,255,255,255);const k=new i_(D.buffer,0,4);f.attributes.color instanceof bi?IH(k,f.attributes.color,255):f.attributes.color instanceof i_?tP(k,f.attributes.color):f.attributes.color instanceof $w&&IH(k,f.attributes.color,1/256)}C.push([O.COLOR,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),A.push([O.COLOR,S])}const I=new Nr(C,A);p.stageResources.geometries.push(I),p.stageResources.materials.push(a.get(m)),v&&(_(y.textureColor)&&p.stageResources.textures.push(l.get(y.textureColor)),_(y.textureNormal)&&p.stageResources.textures.push(l.get(y.textureNormal)),_(y.textureOcclusion)&&p.stageResources.textures.push(l.get(y.textureOcclusion)),_(y.textureEmissive)&&p.stageResources.textures.push(l.get(y.textureEmissive)),_(y.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(y.textureMetallicRoughness))),p.numberOfVertices+=T;const L=I.boundingInfo;_(L)&&(qf(p.boundingBox,L.getBBMin()),qf(p.boundingBox,L.getBBMax()))})}),o}function Tot(e){switch(e){case"BLEND":return cr.Blend;case"MASK":return cr.Mask;case"OPAQUE":case null:case void 0:return cr.Opaque}}function Sot(e,t){switch(t){case $t.TRIANGLES:return dot(e);case $t.TRIANGLE_STRIP:return pot(e);case $t.TRIANGLE_FAN:return fot(e)}}function Eot(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(M(n))return;const o=s.attributes.position,a=o.count,l=R(),c=R(),h=R(),p=Sb(Ll,a),f=Sb(bi,a),m=Xr(Ee(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),ke(c,c,s.transform),fe(h,c,t.center),iF(h,h,t.radius);const v=h[2],b=Re(h),w=Math.min(.45+.55*b*b,1);iF(h,h,t.radius),ke(h,h,m),we(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&on(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(y,h),p.set(y,0,255*w),p.set(y,1,255*w),p.set(y,2,255*w),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var HTt=Object.freeze(Object.defineProperty({__proto__:null,fetch:ZTe,gltfToEngineResources:oN,parseUrl:QTe},Symbol.toStringTag,{value:"Module"})),Er;function Cot(e){let t=ns().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(O.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(O.FEATUREATTRIBUTE)),t=t.u8(O.STATE).u8(O.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Er||(Er={}));class Aot{constructor(t){this.localTransform=t.getField(O.LOCALTRANSFORM,t_),this.globalTransform=t.getField(O.GLOBALTRANSFORM,t_),this.modelOrigin=t.getField(O.MODELORIGIN,Mr),this.model=t.getField(O.MODEL,vp),this.modelNormal=t.getField(O.MODELNORMAL,vp),this.modelScaleFactors=t.getField(O.MODELSCALEFACTORS,qh),this.boundingSphere=t.getField(O.BOUNDINGSPHERE,Rw),this.color=t.getField(O.COLOR,Un),this.featureAttribute=t.getField(O.FEATUREATTRIBUTE,Un),this.state=t.getField(O.STATE,ty),this.lodLevel=t.getField(O.LODLEVEL,ty)}}class Mot extends Zr{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=Cot(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Er.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Er.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Er.ACTIVE)?this._setStateFlags(t,Er.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Er.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=Uy,s=ld;i.localTransform.getMat(t,Goe),i.globalTransform.getMat(t,dB);const n=Dr(dB,dB,Goe);ie(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Sc(s,n),i.model.setMat(t,s);const o=tFe(Uy,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),lx(s,s),Hh(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,Er.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,ld),r.modelOrigin.getVec(t,Uy),i[0]=ld[0],i[1]=ld[1],i[2]=ld[2],i[3]=0,i[4]=ld[3],i[5]=ld[4],i[6]=ld[5],i[7]=0,i[8]=ld[6],i[9]=ld[7],i[10]=ld[8],i[11]=0,i[12]=Uy[0],i[13]=Uy[1],i[14]=Uy[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(Uy,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(Uy,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,Er.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Er.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,Er.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Er.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(Oot,Math.floor(this._capacity*Rot)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new Aot(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&Er.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const Oot=1024,Rot=2,Uy=R(),ld=ir(),Goe=Ee(),dB=Ee();class Pot extends ip{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=bn(),this._tmpMat4=Ee(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);ke(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Tw(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class Iot{constructor(t,i){this.thresholdScale=1,this._camera=new qi,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class $ot{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new Mxe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=ai.createVertex(r,Ci.STATIC_DRAW,c.buffer),this.vao=new zs(r,Vi,{geometry:Oc(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const v={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(zr.LOD,v,h,p,t.transform.transform,y),t.options.store!==lo.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(zr.LOD,v,h,p,t.transform.transform,y),t.options.store===lo.ALL){const b=SZ(t.results.min.ray);b.set(zr.LOD,v,h,p,t.transform.transform,y),t.results.all.push(b)}}})}}class xQ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new $ot(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(bs(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Wt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new xQ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(M(this._boundingBox)){const t=pr();this.components.forEach(i=>{_(i.boundingInfo)&&(qf(t,i.boundingInfo.bbMin),qf(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(M(this._boundingSphere)){const t=this.boundingBox,i=R();Qd(t,i),this._boundingSphere={center:i,radius:.5*Ife(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class Dot{constructor(t,i,r){this._elementSize=i,this._buffer=ai.createVertex(t,Ci.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class Lot{constructor(t){this.modelOriginHi=t.getField(O.MODELORIGINHI,bi),this.modelOriginLo=t.getField(O.MODELORIGINLO,bi),this.model=t.getField(O.MODEL,vp),this.modelNormal=t.getField(O.MODELNORMAL,vp),this.color=t.getField(O.INSTANCECOLOR,Un),this.featureAttribute=t.getField(O.INSTANCEFEATUREATTRIBUTE,Un)}}class joe{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){pt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){pt(this._updating,"not updating"),this.size<Fot*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){pt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),pt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){pt(this._updating,"not updating"),pt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(Hoe,Math.floor(this._capacity*Not));this._resize(t)}_shrink(){const t=Math.max(Hoe,Math.floor(this._capacity*Uot));this._resize(t)}_resize(t){if(pt(this._updating,"not updating"),t===this._capacity)return;const i=new Dot(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);pt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new Lot(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const Hoe=1024,Not=2,Fot=.3,Uot=.5;let kot=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new Iot(t,i)};class zot{constructor(t,i,r,s){this.type=zr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new qi,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=gTe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Oc(this._instanceBufferLayout,1),this._instanceData=new Mot(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new joe(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new joe(r,this._instanceBufferLayout)),xQ.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(bs(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Wt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=kot(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(Te.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(Wi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==Be.MATERIAL_HIGHLIGHT&&t.pass!==Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=R();fe(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Xoe),t.transform.set(Xoe),ke(Yoe,r,t.transform.inverse),ke(Zoe,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;pt(l&Er.ACTIVE,"invalid instance state"),pt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,Yoe,Zoe,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new Pot(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&Er.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,ip.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,ip.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Up),fe(Up,Up,i);const o=Se(Up,r)-Up[3];this._instanceData.view.boundingSphere.getVec(n,Up),fe(Up,Up,i);const a=Se(Up,r)+Up[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Er.ALLOCATED)){c=(c+1)%l,i++;continue}const m=o.lodLevel.get(c);if(p&Er.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Er.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Er.REMOVE)n.freeInstance(c);else if(p&Er.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Woe),y=s.selectLevel(Woe,n.getCombinedMedianScaleFactor(c))),f=p&~(Er.ACTIVE|Er.TRANSFORM_CHANGED),y>=0&&(p&Er.HIGHLIGHT?(qoe(this._highlightRenderInstanceData[y],o,c),f|=Er.HIGHLIGHT_ACTIVE):(qoe(this._defaultRenderInstanceData[y],o,c),f|=Er.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Er.ACTIVE|Er.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const y=!!(p&Er.ACTIVE),v=!!(f&Er.ACTIVE);!y&&v?this._octree.addInstance(c):y&&!v?this._octree.removeInstance(c):y&&v&&p&Er.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(M(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(Bot,n),Wi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===Be.MATERIAL&&(h.setUniform4fv("externalColor",Qoe[Math.min(s,Qoe.length-1)]),h.setUniform1i("colorMixMode",bwe.replace));const p=o.capabilities.instancing,f=i.capacity,m=i.headIndex,y=i.tailIndex,v=i.firstIndex,b=this._glInstanceBufferLayout,w=(S,T)=>{ZY(o,Vi,i.buffer,b,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,T-S),QY(o,Vi,i.buffer,b)};r.material.parameters.transparent&&v!=null?m>y?(pt(v>=y&&v<=m,"invalid firstIndex"),w(v,m),w(y,v)):m<y&&(v<=m?(pt(v>=0&&v<=m,"invalid firstIndex"),w(v,m),w(y,f),w(0,v)):(pt(v>=y&&v<=f,"invalid firstIndex"),w(v,f),w(0,m),w(y,v))):m>y?w(y,m):m<y&&(w(0,m),w(y,f)),o.bindVAO(null)}}function qoe(e,t,i){const r=e.allocateHead();Vot(t,i,e.view,r)}function Vot(e,t,i,r){hYe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const Woe=R(),Up=qt(),Xoe=Ee(),Yoe=R(),Zoe=R(),Qoe=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Bot=new yrt;class Got extends pm{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&ZU(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:jfe;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return en(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=en(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?hr.None:hr.Back,t}async _createResourcesForPrimitive(t,i){if(!ett(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=ks(eDe(t)),n=dl(NP(s)),o=dl(Iz(n,r)),a=Re(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Rf,diffuse:Rf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:w,minWorldLength:S,maxWorldLength:T}=f.verticalOffset;h.verticalOffset={screenLength:no(w),minWorldLength:S||0,maxWorldLength:T!=null?T:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Ph;else{const w=_(r.material)&&r.material.color,S=_(w)?We.toUnitRGBA(w):Ph;h.externalColor=S}this._fastUpdates=kR(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,f1)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new Gw(h),y=pxe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const v=e$(y).map(w=>({opacity:1,transparent:w.parameters.transparent})),b=await this._createStageResources(y,p);return{lodResources:y,lodRenderer:await this._createLodRenderer(y,i),stageResources:b,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:f1}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=kR(this._context.renderer,this._fastVisualVariableConvertOptions(f1,f1,f1,f1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:D,minWorldLength:k,maxWorldLength:z}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:no(D),minWorldLength:k||0,maxWorldLength:z!=null?z:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await ZTe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=Ant(a.lods);Ont(h),h.levels.sort((D,k)=>D.minScreenSpaceRadius-k.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=en(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=e$(h),S=e$(h).map(D=>({opacity:D.parameters.opacity||1,transparent:D.parameters.transparent}));w.forEach(D=>{const k=D.parameters;D.setParameters(m);const z=k.opacity*v,V=z<1||b||k.transparent;D.setParameters({opacity:z,transparent:V}),p.screenSizePerspectiveEnabled&&D.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=dl(NP(T)),C=dl(h.levels[0].pivotOffset),A=dl(Iz(E,this.symbolLayer)),I=Re(A);zR(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&w.forEach(D=>D.setParameters(this._fastUpdates.materialParameters));const L=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:L,symbolSize:A,extentPadding:I,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=e$(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=ltt(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=ctt(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,b$),ws(c,UH(this._fastUpdates.materialParameters,b$,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,b$),tst(a,this._fastUpdates.materialParameters,b$))}:null,o=new zot(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=Ph:_(t)&&_(t.color)?i.externalColor=We.toUnitRGBA(t.color):(i.externalColor=Ph,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=LR(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new Uu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(M(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=en(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?hr.None:hr.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,c_)}slicePlaneEnabledChanged(){if(M(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(M(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(M(this._resources))return rn.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!zR(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return rn.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return rn.Fast_Update}computeComplexity(){return M(this._resources)?super.computeComplexity():{primitivesPerFeature:aQ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(O.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:vxe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||M(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?hO(r.color,r.opacity):null,l=this._context.clippingExtent;if(Gr(i,Wx,this._context.elevationProvider.spatialReference),_(l)&&!HW(l,Wx))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,pB,w$),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,Joe),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const y=new Snt(this,m,qet,s);return c&&(y.alignedSampledElevation=w$.sampledElevation),y.needsElevationUpdates=c_(s.mode),DR(y,i,this._context.elevationProvider),y}_computeGlobalTransform(t,i,r,s){return ry(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),Wx[0]=t.x,Wx[1]=t.y,Wx[2]=s.z,ua(t.spatialReference,Wx,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return Wf(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=wne(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||v3(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(M(this._resources))return!0;const r=i&&LR(i);if(M(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,pB,w$),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=w$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,pB,!0),DR(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||M(this._resources))return;const r=(y,v,b)=>_t(y!=null&&y.type==="complete"?y.newValue:v,b),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===cu.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=dl(Iz(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,v)=>{const b=this._computeLocalTransform(m,f,v,Joe),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?We.toUnitRGBA(s):Ph;delete r.color;const o=this._resources;M(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return Let(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=R();switch(r.anchor){case"center":ne(s,Qd(t)),oa(s,s);break;case"top":{const n=Qd(t);ie(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=Qd(t);ie(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=Qd(t),o=NP(t),a=r.anchorPosition,l=a?Ue(a.x,a.y,a.z):No;v5(s,o,l),pe(s,s,n),oa(s,s);break}default:_(i)?oa(s,i):ne(s,No)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&ca(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?dl(NP(t)):Rf,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):No,a=this._context.renderCoordsHelper.unitInMeters,l=wne(_(i)?i:void 0,i,r,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:Rf,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const Wx=R(),Joe=Ee(),pB=Ee(),b$=qt(),w$=new H3;function jot(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Hot(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function TQ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function qot(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Wot(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function Xot(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Yot(e){return e[0]*e[3]-e[2]*e[1]}function JTe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function Zot(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function Qot(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function Jot(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Kot(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function eat(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function tat(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function iat(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function rat(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function KTe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function sat(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function nat(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ct*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ct*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ct*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ct*Math.max(1,Math.abs(n),Math.abs(c))}function oat(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function aat(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const lat=JTe,cat=KTe;Object.freeze(Object.defineProperty({__proto__:null,copy:jot,identity:Hot,set:TQ,transpose:qot,invert:Wot,adjoint:Xot,determinant:Yot,multiply:JTe,rotate:Zot,scale:Qot,fromRotation:Jot,fromScaling:Kot,str:eat,frob:tat,LDU:iat,add:rat,subtract:KTe,exactEquals:sat,equals:nat,multiplyScalar:oat,multiplyScalarAndAdd:aat,mul:lat,sub:cat},Symbol.toStringTag,{value:"Module"}));class uat extends Nr{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function eSe(e){return"upVectorAlignment"in e}function tSe(){return[1,0,0,1]}function hat(e){return[e[0],e[1],e[2],e[3]]}function dat(e,t,i,r){return[e,t,i,r]}function pat(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:tSe,clone:hat,fromValues:dat,createView:pat},Symbol.toStringTag,{value:"Module"}));function jH(){return{up:R(),right:R()}}function fat(e,t,i){ke(e.up,t.up,i),ke(e.right,t.right,i)}function mat(e,t,i){fi(e,Se(i,t.right),Se(i,t.up))}class gat{constructor(){this.pos=R(),this.posES=R(),this.posGS=R(),this.vRight=R(),this.vLeft=R(),this.frame=jH(),this.rotationFrame=jH(),this.rotationRight=st(),this.rotationAngle=0,this.miterStretch=tSe()}setFrameFromUpVector(t){ne(this.frame.up,t),pe(dh,this.vLeft,this.vRight),we(dh,dh),oe(Od,this.frame.up,Se(dh,this.frame.up)),fe(T$,dh,Od),we(T$,T$),lt(this.frame.right,T$,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ne(this.rotationFrame.up,this.frame.up),ne(this.rotationFrame.right,this.frame.right),fi(this.rotationRight,1,0),oe(Od,this.frame.up,Se(this.frame.up,this.vLeft)),fe(Od,this.vLeft,Od),oa(Od,Od),we(Od,Od),oe(dh,this.frame.up,Se(this.frame.up,this.vRight)),fe(dh,this.vRight,dh),we(dh,dh),lt(HH,this.rotationFrame.up,this.vLeft);const t=Math.sign(Se(HH,this.vRight));if(this.rotationAngle=t*(Math.PI-an(Se(Od,dh))),Math.abs(this.rotationAngle)>0){const r=o9(Math.cos(.5*this.rotationAngle));TQ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class BR{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(kA(t)),this.vertexNormals.push(kA(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:kA(t),normal:i?kA(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new BR,s={v0:0,v1:0};r.addPole(Fi(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Fi(c*.5,h*.5),f=Fi(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new BR,s=Fi(.5*-1,.5*-1),n=Fi(.5*1,.5*-1),o=Fi(.5*1,.5*1),a=Fi(.5*-1,.5*1),l=Fi(0,-1),c=Fi(1,0),h=Fi(0,1),p=Fi(-1,0);r.addUV(0),r.addUV(1),r.addPole(Fi(0,.5*1),h),r.addPole(Fi(0,.5*1)),r.addPole(Fi(0,.5*-1)),r.addPole(Fi(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class yat{constructor(t){this.vertices=[],this.offset=R(),this.xform=Ee(),this.vertices=t;const i=Math.floor((t.length-1)/2);ne(this.offset,this.vertices[i].pos);for(const r of this.vertices)fe(r.pos,r.pos,this.offset);ca(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,ie(i.vLeft,0,0,0),i.vLeftLength=0,fe(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Re(i.vRight),we(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,ne(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(fe(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Re(i.vRight),we(i.vRight,i.vRight)):(ne(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function vat(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=R(),o=R(),a=R(),l=R(),c=R(),h=R(),p=Ei();let f=e.vertices[0];ne(o,t),ie(n,0,1,0),nc.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),ne(f.frame.up,o),ne(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],pe(c,f.vLeft,f.vRight);let y=Re(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),pe(h,i.pos,i.frame.up),R2(f.pos,c,p),sx(p,Du(h,f.vLeft),l)?(fe(l,l,f.pos),we(o,l),lt(a,c,o),we(a,a)):nc.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),ne(f.frame.up,o),ne(f.frame.right,a),i=f}}class _at{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class fB{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=Cat;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Tc(tae,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),fat(s,t.frame,tae);for(let o=0;o<i.vertices.length;++o)Xs(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(sH(Vb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Vb,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Xs(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;sH(Vb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Vb,i.vertexNormals[o],!a)}}}const bat={generateUV:!1};class SQ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class Koe extends SQ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class x$ extends SQ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=EQ;fi(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class eae extends SQ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=Vb,o=EQ;fi(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Af(n,this.profile.vertices[p],f.position),pc(n,n,c),f.normal?(zd(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(oR(o,n),pc(o,o,c),zd(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class wat{constructor(t,i,r,s,n,o=bat){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class iSe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class rSe extends iSe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Tat;ie(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=Od,l=Vb,c=dh,h=HH,p=Eat;let f=0,m=0;if(ie(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),ie(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),fi(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)lt(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const v=EQ,b=Sat;fi(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=qY(v);oR(v,v);const S=Xs(l,v);if(Math.abs(S)>w){fi(b,-v[1],v[0]);const T=Xs(l,b);pc(v,v,w*Math.sign(S)),pc(b,b,T),zd(l,v,b)}ie(c,0,0,0)}ie(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=Vb;fi(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[O.POSITION,this.builder.vertexIndices],[O.NORMAL,this.builder.normalIndices]],i=[[O.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[O.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([O.COLOR,new Uint32Array(r)]),i.push([O.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;k3(t,i,0,o,s,n,void 0,void 0,r)}}class xat extends iSe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new rSe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[O.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[O.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[O.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[O.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[O.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Tat=R(),Vb=st(),EQ=st(),Sat=st(),Od=R(),dh=R(),HH=R(),Eat=R(),T$=R(),Cat=jH(),tae=Ee(),mB=8;function Aat(e,t){e.attributes.add(O.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(x`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new mi("size",r=>r.size)),t.vvSize?(i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(x`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",mB),i.uniforms.add([new sa("vvOpacityValues",r=>r.vvOpacityValues,mB),new sa("vvOpacityOpacities",r=>r.vvOpacityOpacities,mB)]),i.code.add(x`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",lp),i.uniforms.add([new sa("vvColorValues",r=>r.vvColorValues,lp),new HU("vvColorColors",r=>r.vvColorColors,lp)]),i.code.add(x`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(nk),e.attributes.add(O.PROFILERIGHT,"vec4"),e.attributes.add(O.PROFILEUP,"vec4"),e.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class Mat extends KZ{constructor(){super(...arguments),this.size=Fi(1,1)}}function Oat(e){const t=new Xi,i=Ou(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(Aat,e),e.output!==K.Color&&e.output!==K.Alpha||(t.include(Io),t.include(Vw,e),t.include(X3,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===K.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Nu,e),e.output===K.Alpha&&(t.include(fs,e),s.uniforms.add(new Xe("opacity",n=>n.opacity)),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===K.Color&&(t.include(fs,e),t.include(Bw,e),t.include(Q3,e),t.include(Vw,e),t.include(sTe,e),Zf(s,e),s.uniforms.add([i,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new Tt("specular",n=>n.specular),new Xe("opacity",n=>n.opacity),new Xe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",BE),s.include(cm),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Io,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new mi("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(fs,e),t.include(w_,e),s.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===K.Normal&&(t.include(Io),t.include(wv,e),r.uniforms.add(new xr("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(fs,e),s.uniforms.add(new Ua("waterColor")),s.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===K.Highlight&&(t.include(Io),t.include(wv,e),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(fs,e),t.include(my),s.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Rat=Object.freeze(Object.defineProperty({__proto__:null,build:Oat},Symbol.toStringTag,{value:"Module"})),sSe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);class Pat extends Mat{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1}}class Ek extends dr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=W3(t.rctx)}initializeProgram(t){const i=Ek.shader.get().build(this.configuration);return new sr(t.rctx,i,sSe)}_setPipelineState(t){const i=this.configuration,r=t===yt.NONE,s=t===yt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Vr.None);return zt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:r?Ru:gy(t),culling:n(i)&&K_e,depthTest:{func:b_(t)},depthWrite:r||s?Dl:null,colorWrite:ri,stencilWrite:i.hasOccludees?Jf:null,stencilTest:i.hasOccludees?x_:null,polygonOffset:r||s?null:XU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Ek.shader=new rr(Rat,()=>import("./Path.glsl.3d1ebdf0.js"));class Cn extends na{constructor(){super(...arguments),this.output=K.Color,this.doubleSidedMode=Vr.None,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([j({count:K.COUNT})],Cn.prototype,"output",void 0),u([j({count:Vr.COUNT})],Cn.prototype,"doubleSidedMode",void 0),u([j({count:yt.COUNT})],Cn.prototype,"transparencyPassType",void 0),u([j()],Cn.prototype,"spherical",void 0),u([j()],Cn.prototype,"receiveShadows",void 0),u([j()],Cn.prototype,"receiveAmbientOcclusion",void 0),u([j()],Cn.prototype,"vvSize",void 0),u([j()],Cn.prototype,"vvColor",void 0),u([j()],Cn.prototype,"vvOpacity",void 0),u([j()],Cn.prototype,"hasSlicePlane",void 0),u([j()],Cn.prototype,"transparent",void 0),u([j()],Cn.prototype,"hasOccludees",void 0),u([j()],Cn.prototype,"hasMultipassTerrain",void 0),u([j()],Cn.prototype,"cullAboveGround",void 0),u([j()],Cn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:Ot.Disabled})],Cn.prototype,"pbrMode",void 0),u([j({constValue:!0})],Cn.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],Cn.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Cn.prototype,"useFillLights",void 0);class CQ extends hm{constructor(t){super(t,new $at),this.supportsEdges=!0,this._vertexAttributeLocations=sSe,this._configuration=new Cn,this.vertexBufferLayout=CQ.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==K.Color&&t!==K.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Vr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Vr.WindingOrder:Vr.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==Be.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!eSe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const w=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;h[0]*=Ne(w[0]+C*S[0],T[0],E[0]),h[1]*=Ne(w[2]+C*S[2],T[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(M(f))return void this._intersectTriangles(c,h,n,o,a);const m=gw(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),y=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),b=[v/y[0],v/y[1],v/y[2]];WZ(m,n,b,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(O.POSITION);return _Z(s,null,!1,i)}createBufferWriter(){return new Dat(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Te.TRANSPARENT_MATERIAL:Te.OPAQUE_MATERIAL)||t===Te.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Highlight||t.output===K.Shadow&&this.parameters.castShadows?new Iat(t):null}static getVertexBufferLayout(t){let i=ns().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(O.FEATUREVALUE)),i}}class Iat extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(M(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(Ek,t)}}class $at extends Pat{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class Dat{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);pt(a.size===4);const c=r.getField(o,Un);if(!c)throw new Error("unable to acquire view for "+o);K2(l,a.data,c,s)}};n(O.PROFILERIGHT),n(O.PROFILEUP),n(O.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(O.FEATUREVALUE)&&n(O.FEATUREVALUE),jU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const Lat=["polyline"];class Nat extends pm{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=Fi(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kR(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=BR.circle(Vat);break;case"quad":this._profile=BR.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new fB(0,zat);break;case"bevel":this._extruder=new fB(0,1);break;case"miter":this._extruder=new fB(.8*Math.PI,1);break;default:this._extruder=new _at}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Koe,this._endCap=new Koe;break;case"butt":default:this._startCap=new x$(this._profile,0),this._endCap=new x$(this._profile,0,!0);break;case"square":this._startCap=new x$(this._profile,-.5),this._endCap=new x$(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new eae({profile:this._profile,flip:!1,breakNormals:m,subdivisions:sae}),this._endCap=new eae({profile:this._profile,flip:!0,breakNormals:m,subdivisions:sae});break}}const a=en(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=dl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?hr.None:hr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(fi(this._intrinsicSize,t,i),!v4(this._intrinsicSize[0])||!v4(this._intrinsicSize[1])))throw new q("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||pc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m=ye(F(F({},f),this._fastUpdates.materialParameters),{size:nge(this._intrinsicSize)});this._material=new CQ(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Gw(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Lat,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Uu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=en(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,c_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!zR(this._fastUpdates,i,this._vvConvertOptions))return rn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return rn.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of r)i+=m.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const m of r){s.push({index:p,numVertices:m.length});for(const y of m)l[p++]=y[0],l[p++]=y[1],l[p++]=t.hasZ?y[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=tr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):tr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=ks(),p=this._context.renderCoordsHelper;oSe.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const y=f.pathVertexDataInfos[m],v=y.index,b=y.numVertices;if(b<2||_(this._context.clippingExtent)&&(pr(h),xu(h,f.vertexDataES,3*v,b),!Jd(h,this._context.clippingExtent)))continue;const w=[];for(let L=v;L<v+3*b;){const D=L++,k=L++,z=L++,V=new gat;ie(V.posGS,f.vertexDataGS[D],f.vertexDataGS[k],f.vertexDataGS[z]),ie(V.posES,f.vertexDataES[D],f.vertexDataES[k],f.vertexDataES[z]);const X=Net(V.posES,this._context.elevationProvider,r,p);ie(Ih,f.vertexDataRS[D],f.vertexDataRS[k],f.vertexDataRS[z]),p.setAltitude(Ih,X),ie(V.pos,Ih[0],Ih[1],Ih[2]),w.push(V)}const S=new yat(w);nSe(S,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new wat(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const L=this._fastUpdates.visualVariables,D=L.size?Fg(L.size.field,t):0,k=L.color?Fg(L.color.field,t):0,z=L.opacity?Fg(L.opacity.field,t):0;E=new xat(T,D,k,z)}else{const L=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(L[0]*=iae(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),L[1]*=iae(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let D=null;this._drivenProperties.color&&(D=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(D=D?[D[0],D[1],D[2],i.opacity]:[1,1,1,i.opacity]);const k=new rSe(T);k.bake(L),D&&k.bakeVertexColors(D),E=k}const{vertexAttributes:C,indices:A}=E.createGeometryData(),I=new uat(C,A,E,c,this.upVectorAlignment,this.stencilWidth);o.push(I),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},y=new vy({geometries:o,materials:a,transformations:l,metadata:m}),v=new dm(this,y,o,null,null,Uat,r);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=c_(r.mode),v}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function nSe(e,t,i){switch(t){case"world":for(const r of e.vertices)pe(kp,r.pos,e.offset),i.worldUpAtPosition(kp,Ih),r.setFrameFromUpVector(Ih),r.computeRotationAxisAndAngleFromUpVector();break;case"path":pe(kp,e.vertices[0].pos,e.offset),i.worldUpAtPosition(kp,Ih),vat(e,Ih);for(const r of e.vertices){const s=Math.sign(Se(r.frame.right,r.vRight));lt(r.rotationFrame.up,r.vRight,r.vLeft),oe(r.rotationFrame.up,r.rotationFrame.up,s),we(r.rotationFrame.up,r.rotationFrame.up);const n=Se(r.rotationFrame.up,r.frame.up),o=Se(r.rotationFrame.up,r.frame.right);if(oe(kp,r.frame.up,-o),oe(rae,r.frame.right,n),pe(kp,kp,rae),we(r.rotationFrame.right,kp),mat(r.rotationRight,r.frame,r.rotationFrame.right),oa(kp,r.vLeft),r.rotationAngle=-s*(Math.PI-an(Se(kp,r.vRight))),Math.abs(r.rotationAngle)>0){const l=o9(Math.cos(.5*r.rotationAngle));TQ(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*o9(Math.cos(.5*a)))}}}function iae(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Fat(e,t,i,r){let s=0;for(const n of e.vertices)ry(n.posES,i,t,r,gB),s+=gB.sampledElevation,pe(Ih,n.pos,e.offset),r.setAltitude(Ih,gB.z),fe(n.pos,Ih,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Uat(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;kat.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!eSe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;oSe.spatialReference=p,o+=Fat(h,t,i,r),l.upVectorAlignment!=="world"&&nSe(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const kat=yy(0,0,0,null),oSe=yy(0,0,0,null),Ih=R(),kp=Ri(),rae=Ri(),gB=new H3,zat=3,sae=3,Vat=10;function Bat(e,t,i,r,s=1){if(i.isGeographic&&r===Ge.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ai(i);for(let h=0;h<l;h+=3)cX(t.typedBuffer,h,a,h,c);t=Mr.fromTypedArray(a)}fi(Zs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,hc),Zs[0]=Math.min(Zs[0],hc[0]),Zs[1]=Math.min(Zs[1],hc[1]);const n=Zs[0]%s,o=Zs[1]%s;Ah[0]=Zs[0]-n,Ah[1]=Zs[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,hc),e.setValues(a,(hc[0]-Ah[0])/s,(hc[1]-Ah[1])/s,Ah[0]/s,Ah[1]/s)}function aSe(e,t,i,r,s=1){ie(J_,1,0,0),ie(K_,0,1,0),ie(Xx,0,0,1),Hat(yB,t),Gat(t,nae)&&jat(nae,J_,K_,Xx,i,yB),fi(Zs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),fi(e1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,hc);const c=Se(J_,hc),h=Se(K_,hc);Zs[0]=Math.min(Zs[0],c),Zs[1]=Math.min(Zs[1],h),e1[0]=Math.max(e1[0],c),e1[1]=Math.max(e1[1],h)}const n=Se(Xx,yB);_B(ky,Zs[0],Zs[1],n,J_,K_,Xx),_B(t1,e1[0],Zs[1],n,J_,K_,Xx),_B(i1,Zs[0],e1[1],n,J_,K_,Xx),fe(t1,t1,ky),oe(t1,t1,.5),fe(i1,i1,ky),oe(i1,i1,.5),pe(ky,ky,t1),pe(ky,ky,i1);const o=Zs[0]%s,a=Zs[1]%s;Ah[0]=Zs[0]-o,Ah[1]=Zs[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,hc),e.setValues(l,(Se(J_,hc)-Ah[0])/s,(Se(K_,hc)-Ah[1])/s,Ah[0]/s,Ah[1]/s);for(let c=0;c<3;c++)r.set(l,c,ky[c]),r.set(l,c+3,t1[c]),r.set(l,c+6,i1[c])}}const yB=R(),hc=R(),nae=Ei(),J_=R(),K_=R(),Xx=R(),Zs=st(),e1=st(),Ah=st(),ky=R(),t1=R(),i1=R();function Gat(e,t){const i=e.count-1;return Pge(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function jat(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,zp),ie(S$,zp[0],zp[1],zp[2]),ie(E$,zp[4],zp[5],zp[6]),ie(vB,zp[8],zp[9],zp[10])):(ie(S$,1,0,0),ie(E$,0,1,0),ie(vB,0,0,1));const o=e;Se(o,vB)<0&&oe(o,o,-1),ne(r,o);const a=Se(o,E$),l=Se(o,S$);Math.abs(a)<Math.abs(l)?(Mb(t,S$,o,-l),we(t,t),lt(i,t,o),we(i,i),oe(i,i,-1)):(Mb(i,E$,o,-a),we(i,i),lt(t,i,o),we(t,t))}const zp=Ee(),S$=R(),E$=R(),vB=R();function Hat(e,t){ie(C$,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,hc),pe(C$,C$,hc);oe(e,C$,1/(t.count-1))}const C$=R();function _B(e,t,i,r,s,n,o){ie(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function qat(e){const t=new Xi,i=e.output===K.Depth,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);Ou(t,e),t.include(Io,{hasModelTransformation:!1,linearDepth:i}),t.include(ux,e),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(w_,e),s.uniforms.add(new mi("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(fs,e),r&&t.include(Nu,e),n.include(cm),n.uniforms.add(new oi("eColor",o=>o.color)),e.output===K.Highlight&&t.include(my),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${x.float(Do)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""};
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
  }
  `),t}const Wat=Object.freeze(Object.defineProperty({__proto__:null,build:qat},Symbol.toStringTag,{value:"Module"}));class Ck extends dr{initializeProgram(t){const i=Ck.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}_createPipeline(t,i){const r=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return zt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?Ru:gy(t),culling:xU(r.cullFace),depthTest:{func:b_(t)},depthWrite:s||n?r.writeDepth&&Dl:null,colorWrite:ri,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?u_:x_:null,polygonOffset:s||n?r.polygonOffset&&Xat:YU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}Ck.shader=new rr(Wat,()=>import("./ColorMaterial.glsl.7e2cfe8a.js"));const Xat={factor:1,units:1};class Xc extends na{constructor(){super(...arguments),this.output=K.Color,this.cullFace=hr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=yt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Xc.prototype,"output",void 0),u([j({count:hr.COUNT})],Xc.prototype,"cullFace",void 0),u([j()],Xc.prototype,"hasSlicePlane",void 0),u([j()],Xc.prototype,"hasVertexColors",void 0),u([j()],Xc.prototype,"transparent",void 0),u([j()],Xc.prototype,"polygonOffset",void 0),u([j()],Xc.prototype,"enableOffset",void 0),u([j()],Xc.prototype,"writeDepth",void 0),u([j()],Xc.prototype,"hasOccludees",void 0),u([j({count:yt.COUNT})],Xc.prototype,"transparencyPassType",void 0),u([j()],Xc.prototype,"hasMultipassTerrain",void 0),u([j()],Xc.prototype,"cullAboveGround",void 0);class oae extends hm{constructor(t){super(t,new Zat),this.supportsEdges=!0,this._configuration=new Xc}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<WU,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){BU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Te.DRAPED_MATERIAL?!0:zw(i)===K.Highlight?t===Te.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Te.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new Yat(t):null}createBufferWriter(){return new uk(Wxe)}}class Yat extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(Ck,t)}}class Zat extends WE{constructor(){super(...arguments),this.color=Lf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=hr.None,this.hasOccludees=!1}}var to;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(to||(to={}));const qH=.70710678118,aae=qH,Qat=.08715574274;function Jat(e){const t=new Xi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===K.Depth,{vertex:s,fragment:n}=t;Ou(t,e),t.include(Io,{hasModelTransformation:!1,linearDepth:r}),t.include(ux,e),r&&(t.include(w_,e),s.uniforms.add(new mi("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new Xe("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(O.BOUNDINGRECT,"mat3"),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===to.ForwardDiagonal||e.style===to.BackwardDiagonal||e.style===to.DiagonalCross;return o&&s.code.add(x`
      const mat2 rotate45 = mat2(${x.float(qH)}, ${x.float(-aae)},
                                 ${x.float(aae)}, ${x.float(qH)});
    `),e.draped||(Zf(s,e),s.uniforms.add(new Xe("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(Qat)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(fs,e),n.include(cm),e.draped&&n.uniforms.add(new Xe("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===K.Highlight&&t.include(my),i&&t.include(Nu,e),e.output!==K.Highlight&&(n.code.add(x`
      const float lineWidth = ${x.float(e.lineWidth)};
      const float spacing = ${x.float(e.patternSpacing)};
      const float spacingINV = ${x.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new oi("uColor",a=>a.color)),n.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==K.Highlight?x`color.a *= ${Kat(e)};`:""}

      if (color.a < ${x.float(Do)}) {
        discard;
      }

      ${e.output===K.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${e.output===K.Color?x`gl_FragColor = color; ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===K.Highlight?x`outputHighlight();`:""}
      ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),t}function Kat(e){function t(i){return e.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(e.style){case to.ForwardDiagonal:case to.Horizontal:return t("y");case to.BackwardDiagonal:case to.Vertical:return t("x");case to.DiagonalCross:case to.Cross:return x`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const elt=Object.freeze(Object.defineProperty({__proto__:null,build:Jat},Symbol.toStringTag,{value:"Module"}));class Ak extends dr{initializeProgram(t){const i=Ak.shader.get().build(this.configuration);return new sr(t.rctx,i,lSe)}_setPipelineState(t,i){const r=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return zt({blending:r.output===K.Color||r.output===K.Alpha?s?Ru:gy(t):null,culling:xU(r.cullFace),depthTest:{func:b_(t)},depthWrite:s?r.writeDepth&&Dl:qU(t),colorWrite:ri,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?u_:x_:null,polygonOffset:s||n?r.polygonOffset&&tlt:YU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}Ak.shader=new rr(elt,()=>import("./Pattern.glsl.8f5608ca.js"));const tlt={factor:1,units:1};class Aa extends na{constructor(){super(...arguments),this.output=K.Color,this.cullFace=hr.None,this.transparencyPassType=yt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:K.COUNT})],Aa.prototype,"output",void 0),u([j({count:hr.COUNT})],Aa.prototype,"cullFace",void 0),u([j({count:to.COUNT})],Aa.prototype,"style",void 0),u([j({count:yt.COUNT})],Aa.prototype,"transparencyPassType",void 0),u([j()],Aa.prototype,"hasSlicePlane",void 0),u([j()],Aa.prototype,"hasVertexColors",void 0),u([j()],Aa.prototype,"polygonOffset",void 0),u([j()],Aa.prototype,"writeDepth",void 0),u([j()],Aa.prototype,"hasOccludees",void 0),u([j()],Aa.prototype,"patternSpacing",void 0),u([j()],Aa.prototype,"lineWidth",void 0),u([j()],Aa.prototype,"enableOffset",void 0),u([j()],Aa.prototype,"draped",void 0),u([j()],Aa.prototype,"hasMultipassTerrain",void 0),u([j()],Aa.prototype,"cullAboveGround",void 0);const lSe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.BOUNDINGRECT,5]]);class AQ extends hm{constructor(t){super(t,new slt),this.supportsEdges=!0,this._vertexAttributeLocations=lSe,this.techniqueConfig=new Aa}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<WU,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){BU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Te.DRAPED_MATERIAL?!0:zw(i)===K.Highlight?t===Te.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new ilt(t):null}createBufferWriter(){const t=ns().vec3f(O.POSITION).vec4u8(O.COLOR).vec4f(O.UVMAPSPACE);return this.parameters.draped||t.mat3f(O.BOUNDINGRECT),new rlt(t)}}class ilt extends v_{_updateParameters(t){return this.ensureTechnique(Ak,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class rlt extends uk{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case O.POSITION:{pt(o.size===3);const l=r.getField(n,bi);l&&GU(a,o.data,t.transformation,l,s);break}case O.COLOR:{pt(o.size===3||o.size===4);const l=r.getField(n,Ll);l&&p4(a,o.data,o.size,l,s);break}case O.UVMAPSPACE:{pt(o.size===4);const l=r.getField(n,Un);l&&K2(a,o.data,l,s);break}case O.BOUNDINGRECT:{pt(o.size===9);const l=r.getField(n,vp);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let v=3;v<9;++v)a[n+v]=i[p+v];n+=l}}}class slt extends WE{constructor(){super(...arguments),this.color=vi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=hr.None,this.hasOccludees=!1,this.style=to.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function nlt(e,t,i){return alt(olt(e),t,i)}function olt(e){return e&&e.pattern||null}function alt(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=vi(0,0,0,0),t.transparent=!0),new oae(t)):(t.style=llt(e.style),t.draped=i.isDraped,new AQ(t)):new oae(t)}function llt(e){switch(e){case"horizontal":return to.Horizontal;case"vertical":return to.Vertical;case"cross":return to.Cross;case"forward-diagonal":return to.ForwardDiagonal;case"backward-diagonal":return to.BackwardDiagonal;case"diagonal-cross":return to.DiagonalCross;default:return}}function clt(e){return e.material instanceof AQ&&!e.material.parameters.draped}function ult(e,t){if(clt(e)){const i=e.geometry.vertexAttributes,r=i.get(O.POSITION).data,s=i.get(O.UVMAPSPACE).data,n=i.get(O.BOUNDINGRECT).data;aSe(Un.fromTypedArray(s),Mr.fromTypedArray(r),t,e_.fromTypedArray(n))}}function hlt(e,t,i,r){const s=axe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)ult(n[o],r);return s}const dlt=["polyline","polygon","extent"];class Mk extends pm{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=en(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=nlt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof AQ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=CTe(t.pattern);return new OS({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:zH(t.patternCap||"butt")})};this._outlineMaterial=i(no(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(M(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,dlt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Uu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=en(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j3(Mk.elevationModeChangeTypes,r,s);if(n!==Yr.UPDATE)return n;const o=Xh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=FR(t.geometry);if(M(s))return null;un.renderData=vQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),un.color=i;const n=un.renderData.position.length/3;if(this._needsUV&&(un.uvMapSpace=new Float32Array(4*n),un.boundingRect=new Float64Array(9*n)),un.outNum=0,un.outGeometries=[],un.outTransforms=[],un.outMaterials=[],this._createAs3DShapeFill(un),this._hasOutline&&this._createAs3DShapeOutline(un),this._logGeometryCreationWarnings(un.renderData,s.rings,"rings","FillSymbol3DLayer"),un.outNum===0)return null;this._needsUV&&aSe(Un.fromTypedArray(un.uvMapSpace),Mr.fromTypedArray(un.renderData.position),this._context.renderCoordsHelper,e_.fromTypedArray(un.boundingRect));const o=new vy({geometries:un.outGeometries,materials:un.outMaterials,transformations:un.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new dm(this,o,un.outGeometries,null,null,hlt,r);return a.alignedSampledElevation=un.renderData.sampledElevation,a.needsElevationUpdates=Xh(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(pr(ma),xu(ma,s),!Jd(ma,this._context.clippingExtent)))continue;const l=iE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=moe({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(Us),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(pr(ma),xu(ma,s),!Jd(ma,this._context.clippingExtent)))continue;const o=kH({overlayInfo:null,removeDuplicateStartEnd:jw.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(O.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Us),t.outNum++}}_createAsOverlay(t,i){const r=FR(t.geometry);if(M(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),vo.renderData=tTe(r,this._context.overlaySR),vo.color=i;const s=vo.renderData.position.length/3;return this._needsUV&&(vo.uvMapSpace=new Float32Array(4*s)),vo.outNum=0,vo.outGeometries=[],vo.outBoundingBox=pr(),vo.layerUid=this._context.layer.uid,vo.graphicsUid=t.uid,this._createAsOverlayFill(vo),this._hasOutline&&this._createAsOverlayOutline(vo),this._logGeometryCreationWarnings(vo.renderData,r.rings,"rings","FillSymbol3DLayer"),vo.outNum===0?null:(this._needsUV&&Bat(Un.fromTypedArray(vo.uvMapSpace),Mr.fromTypedArray(vo.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),vo.outNum>0?new pk(this,vo.outGeometries,vo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(pr(ma),xu(ma,r),!Jd(ma,this._context.clippingExtent))continue;const a=iE(r,s,3);if(a.length===0)continue;S2(t.outBoundingBox,ma);const l=new Uint32Array(a),c=moe({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new oE(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=ma;Ji(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(pr(ma),xu(ma,s),!Jd(ma,this._context.clippingExtent))continue;S2(t.outBoundingBox,ma);const n=kH({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:jw.REMOVE,attributeData:{position:s}}),o=new oE(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=ma;Ji(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=en(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=en(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return hO(_(t)?We.toUnitRGB(t):null,i)}test(){return ye(F({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}Mk.elevationModeChangeTypes={definedChanged:Yr.RECREATE,staysOnTheGround:Yr.NONE,onTheGroundChanged:Yr.RECREATE};const ma=ks(),un={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},vo={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},plt=de.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class Ok{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=en(t,"material","color"),s=uu(r,Lf,We.toUnitRGBA),n=uu(t.size,12,no),o=t.lineHeight,a=_(t.background)?We.toUnitRGBA(t.background.color):Lf,l={family:uu(t.font,"sans-serif",m=>m.family),decoration:uu(t.font,"none",m=>m.decoration),weight:uu(t.font,"normal",m=>m.weight),style:uu(t.font,"normal",m=>m.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:no(c.size),color:We.toUnitRGBA(c.color)}:{size:0,color:Lf},p=new Ok({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{plt.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class flt{constructor(t,i,r){this._renderer=new yTe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=tN(mlt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new $s(t,{wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Pv.PAD})}}const mlt={canvas:null},glt=[0,0,1];class ylt extends pm{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=ZU(this.symbolLayer.size);if(t)throw new q("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await Ok.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=LR(i.geometry);if(M(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(M(s)||s==="")return null;const n=KW(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!Zfe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=ye(F({},blt),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:Wrt(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=LR(n.geometry);if(M(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return lae(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Yr.UPDATE}slicePlaneEnabledChanged(t,i){return lae(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Xh(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return _lt}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new Uu,s.elevationOffset),l=en(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(M(o)){const V=_Te(s.horizontalPlacement);h=new flt(r,V,this._textRenderParameters);let X=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(X)&&X.release()});const Y=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(M(Y)||Fu(Y))return p.release(),null;X=Y}const f=vlt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(m.textureId=p.texture.id),_(o)&&(m.textureId=o.id),_(s.verticalOffset)){const{screenLength:V,minWorldLength:X,maxWorldLength:Y}=s.verticalOffset;m.verticalOffset={screenLength:no(V),minWorldLength:X||0,maxWorldLength:Y!=null?Y:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;m.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=V}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const V=JSON.stringify(m);y=n.get(V),M(y)&&(y=new eE(m),n.add(V,y))}else y=new eE(m);const v=[y],b=s.translation,w=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,T=glt,E=[0,0],C=[nc.createPointGeometry(T,b,null,w,S,E,null)],A=this._context.layer.uid,I=uQ(this._context,i,C,v,a,A,c);if(I===null)return null;const L=new dm(this,I.object,C,M(n)?v:null,p,$R,a);L.alignedSampledElevation=I.sampledElevation,L.needsElevationUpdates=Xh(a.mode)||a.mode==="absolute-height";const{displayWidth:D,displayHeight:k}=_(h)?h:s;L.getScreenSize=(V=st())=>(V[0]=D,V[1]=k,V);const z={labelText:r,elevationOffset:s.elevationOffset};return L.metadata=z,DR(L,i,this._context.elevationProvider),L}}function lae(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function vlt(e,t){if(t.verticalPlacement==="baseline"){const r=jrt[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return Fi(r,s)}const i=qrt(t.horizontalPlacement,t.verticalPlacement);return iN[i]}const _lt={mode:"relative-to-ground",offset:0},blt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},wlt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},xlt=["polyline","polygon","extent"];class Tf extends pm{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,xlt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Uu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new Yxe,i=this.symbolLayer.color;_(i)&&(t.color=We.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?Tf.headingVectorFromAngle(this.symbolLayer.waveDirection):Fi(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=wlt[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new Xxe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(M(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j3(Tf.elevationModeChangeTypes,r,s);if(n!==Yr.UPDATE)return n;const o=Xh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=FR(t.geometry);if(M(s))return null;Xo.renderData=vQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=Xo.renderData.position.length/3;if(Xo.uvCoords=new Float64Array(2*n),Xo.outNum=0,Xo.outGeometries=[],Xo.outTransforms=[],Xo.outMaterials=[],this._create3DShapeGeometries(Xo),this._logGeometryCreationWarnings(Xo.renderData,s.rings,"rings","WaterSymbol3DLayer"),Xo.outNum===0)return null;this._createUVCoordsFromVertices(Xo.uvCoords,Xo.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new vy({geometries:Xo.outGeometries,materials:Xo.outMaterials,transformations:Xo.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new dm(this,o,Xo.outGeometries,null,null,axe,i);return a.alignedSampledElevation=Xo.renderData.sampledElevation,a.needsElevationUpdates=Xh(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=Nl(s);xc(zy);for(let l=0;l<r;l++)fi(cae,i[3*l+0],i[3*l+1]),BS(zy,cae);u3(zy,zy,n);const o=zy[0]%Tf.unitSizeOfTexture,a=zy[1]%Tf.unitSizeOfTexture;A$[0]=zy[0]-o,A$[1]=zy[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-A$[0])/Tf.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-A$[1])/Tf.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(pr(Vy),xu(Vy,a),!Jd(Vy,this._context.clippingExtent)))continue;const c=iE(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=goe({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(Us),t.outNum++}}_createAsOverlay(t){const i=FR(t.geometry);if(M(i))return null;this._material.renderPriority=this._renderPriority,ga.renderData=tTe(i,this._context.overlaySR);const r=ga.renderData.position.length/3;return ga.uvCoords=new Float64Array(2*r),ga.outNum=0,ga.outGeometries=[],ga.outBoundingBox=pr(),ga.layerUid=this._context.layer.uid,ga.graphicsUid=t.uid,this._createAsOverlayWater(ga),this._logGeometryCreationWarnings(ga.renderData,i.rings,"rings","WaterSymbol3DLayer"),ga.outNum===0?null:(this._createUVCoordsFromVertices(ga.uvCoords,ga.renderData.position,r,this._context.overlaySR),ga.outNum>0?new pk(this,ga.outGeometries,ga.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(pr(Vy),xu(Vy,s),!Jd(Vy,this._context.clippingExtent))continue;S2(t.outBoundingBox,Vy);const l=iE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=goe({indices:c,attributeData:{position:s,uv0:h}}),f=new oE(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=Vy;Ji(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=st(),r=c3(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return ye(F({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}Tf.unitSizeOfTexture=100,Tf.elevationModeChangeTypes={definedChanged:Yr.RECREATE,staysOnTheGround:Yr.NONE,onTheGroundChanged:Yr.RECREATE};const A$=st(),zy=Lt(),cae=st(),Vy=ks(),Xo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ga={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Tlt=de.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Slt(e,t,i,r){const s=uae[e.type]&&uae[e.type][t.type]||Elt[t.type];return s?new s(e,t,i,r):(Tlt.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const Elt={icon:VR,object:Got,line:gk,path:Nat,fill:Mk,extrude:Prt,text:ylt,water:Tf},uae={"mesh-3d":{fill:xnt}};class Clt extends oQ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];M(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;M$.renderPriority=1-(1+n)/r,M$.renderPriorityStep=1/r,M$.ignoreDrivers=o._ignoreDrivers;const a=Slt(this.symbol,o,this._context,M$);s.push(Yq(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await Q5(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,Wt(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Att(r,i||this,s,t.layer,n)}get complexity(){return cQ(this.symbolLayers.map(t=>en(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof dm?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==cu.LOADED?rn.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==rn.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,rn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===cu.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(M(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(M(s))continue;const n=t.graphics[r];if(M(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(M(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{M(s)||(s.loadStatus===cu.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const M$={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Alt extends oQ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:lQ}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):rn.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function MQ(e){return e instanceof Alt?e.graphics3DSymbol:e instanceof Clt?e:null}const GR=de.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Mlt(e){const t=Flt(e);if(M(t))return null;const i=Olt(e,t);if(M(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return Plt({anchor:r,verticalOffset:t.verticalOffset,screenOffset:st(),centerOffset:vi(0,0,0,-1),centerOffsetUnits:"world",translation:R(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function Olt(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=rp[i],s=r||R4(e);return i&&!r&&GR.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),Rlt(s,e)}function OQ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=MQ(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function Rlt(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(M(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(GR.warnOncePerTick(hae(e.placement,t.disablePlacement.logEntityDescription)),R4(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return GR.warnOncePerTick(hae(e.placement,`'${r}' geometries`)),R4(t);break;case"point":case"mesh":return e}return e}function hae(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function R4(e){const t=e.graphics3DGraphic.graphic.geometry;if(M(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=OQ(e);return _(i)&&i.type==="extrude"?rp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return rp["above-center"];default:return}}function Plt(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(M(r))return null;switch(r.type){case"point":$lt(e,t,i);break;case"polygon":Ilt(e,t,i);break;case"mesh":RQ(e,t,i.graphics3DGraphic.graphics[0])}return e}function Ilt(e,t,i){const r=OQ(i);if(!M(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(vO),Qd(vO,e.translation),e.translation[2]=p_(vO)/2):ie(e.translation,0,0,0),RQ(e,t,s);break}}}function $lt(e,t,i){const r=OQ(i);if(M(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):ie(e.translation,0,0,0),r.type){case"icon":case"text":Dlt(e,t,i,s);break;case"object":RQ(e,t,s)}}function Dlt(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=Llt(i);jC[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),jC[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=jC[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=jC[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=jC[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(rp[i.labelClass.labelPlacement]&&GR.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function Llt(e,t=Ult){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof eE){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function RQ(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(vO):vO,s=Ue(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Re(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function Nlt(e){return e==="above-center"}function Flt(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=MQ(r.graphics3DSymbol),n=Qs(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=rp[t]||R4(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:dae(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(M(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?Nlt(o.placement)?{placement:"above-center",verticalOffset:dae(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(GR.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function dae(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const rp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},pae={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in pae){const t=pae[e],i=rp[e];t.forEach(r=>{rp[r]=i})}Object.freeze&&(Object.freeze(rp),Object.keys(rp).forEach(e=>{Object.freeze(rp[e]),Object.freeze(rp[e].normalizedOffset)}));const jC=[0,0],Ult=[0,0],vO=ks();class fae{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const bB=512,wB=4096,klt=.85,zlt=.95;let vM=class extends Ae{constructor(e){super(e),this.type=_p.Texture,this.id=wl(),this.events=new Zr,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Je(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,flipped:!0,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new ot(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(vt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=sn(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Je(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",bB.toString()),e.setAttribute("height",bB.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=bB){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=m2(i),i=Math.min(i,wB),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=HC,e.cursor.y=HC+mae,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(O.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+HC,a=n+HC+mae;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>klt&&i.size.width<wB;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>zlt&&i.size.width===wB?(this._processRemovals(),RS.OK):(this._repack(),RS.REPACK)}i.cursor.x=HC,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return RS.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(O.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(O.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(Js(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(O.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(O.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===RS.REPACK&&(i=!0,!0)}),i)return void this.runTask(zE,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Js(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Xtt.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],vM.prototype,"view",void 0),u([d({type:Boolean})],vM.prototype,"updating",void 0),vM=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],vM);const HC=2,mae=2;var RS;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(RS||(RS={}));const gae=de.getLogger("esri.views.3d.layers.graphics.Labeler");let Q1=class extends Ae{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new si,this._handles.add([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(vt.LABELER,this)]),this._textTextureAtlas=new vM({view:this.view}),this._hudMaterialCollection=new fae(this.view._stage),this._calloutMaterialCollection=new fae(this.view._stage)}dispose(){this._handles=at(this._handles),this._textTextureAtlas=Je(this._textTextureAtlas),this._hudMaterialCollection=Je(this._hudMaterialCollection),this._calloutMaterialCollection=Je(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(yu.USER_SETTING,!0,eo.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(yu.USER_SETTING,!1,eo.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Vlt(t)){if(!yae(t)){if(Blt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),xB(t)){this._dirty=!0;continue}if(!yae(t))continue}Js(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Wt(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await Q5(s,async(a,l)=>{const c=a.symbol,h=MQ(i.getOrCreateGraphics3DSymbol(c));if(M(h))return void gae.error("Failed to create Graphics3DSymbol for label");await h.load(),Wt(t);let p=null;KW(c)&&c.hasVisibleCallout()&&(p=Ttt(c,i.symbolCreationContext),await p.load(),Wt(t));const f=await mp(rxe(a,e.layer.fieldsIndex,this.view.spatialReference));if(Wt(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);Wt(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else gae.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),Wt(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Br(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?Ok.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:Moe(i.anchor),verticalPlacement:Hrt(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:Wi.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return By.graphic=t,By.renderingInfo=null,By.layer=r,s.createLabel(By,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return By.graphic=e,By.renderingInfo=n,By.layer=s,i.createGraphics3DGraphic(By)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=XG(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(M(p)||M(f))continue;const m=s[h],y=m.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,b);if(!w)return!1;w._labelClass=m.labelClass,w._labelIndex=h,t.addLabelGraphic(w,c,r.stageLayer),t.setVisibilityFlag(yu.USER_SETTING,l,eo.LABEL),t.clearVisibilityFlag(yu.SCALE_RANGE,eo.LABEL),t.setVisibilityFlag(yu.DECONFLICTION,!1,eo.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,v,S,f,a);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?Aet(s,i.layer):s;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(s);if(M(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,y=Mlt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(M(y))continue;const v=Moe(y.anchor),b=_Te(v);t.textRenderers[n]=new yTe(l,b,o.textRenderParameters),t.labelPlacements[n]=y}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new Axe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>XG(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>xB(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(xB(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Vlt(e){return e.active&&XG(e.layer)}function xB(e){return e.labelClassPromise&&!!e.labelClassAbortController}function yae(e){return e.labelClassContexts&&e.labelClassContexts.length}function Blt(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],Q1.prototype,"view",void 0),u([d({constructOnly:!0})],Q1.prototype,"deconflictor",void 0),u([d()],Q1.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],Q1.prototype,"updating",null),Q1=u([P("esri.views.3d.layers.graphics.Labeler")],Q1);const By=new Ett(null,null,null);class Glt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new si}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>qTe(new jTe(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>WTe(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(bs(s))return void o(hi());const a=Fo(s,()=>{this._remove(t,i),o(hi())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=ye(F({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(NCe(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},Hlt),i))}}const jlt=1e4;let Hlt=jlt;class Wd{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Lt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ea.VISIBLE_ON_SURFACE,screenRect:Lt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=Wd.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new Wd(i,r,s,this.tilingScheme),new Wd(i,r+1,s,this.tilingScheme),new Wd(i,r,s+1,this.tilingScheme),new Wd(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Xg(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var ea;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ea||(ea={}));class ev{constructor(t){this.renderCoordsHelper=t,this.frustum=AR(),this._points=cbe(),this.lines=new Array(12),this._origin=R(),this._direction=R(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:R(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){ube(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ne(this._origin,t.eye),ne(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)ne(this._points[i],t[i]);hbe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return vv(this.frustum,t)}intersectsRay(t){return iZe(this.frustum,t)}intersectsLineSegment(t,i){return rZe(this.frustum,t,i)}intersectsPoint(t){return dbe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;TB(this.lines[i],t[i],t[r]),TB(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),TB(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function TB(e,t,i){e.origin=t,e.endpoint=i,ny(e.direction,t,i)}ev.planePointIndices=nZe,ev.nearFarLineIndices=[[tt.NEAR_BOTTOM_LEFT,tt.FAR_BOTTOM_LEFT],[tt.NEAR_BOTTOM_RIGHT,tt.FAR_BOTTOM_RIGHT],[tt.NEAR_TOP_RIGHT,tt.FAR_TOP_RIGHT],[tt.NEAR_TOP_LEFT,tt.FAR_TOP_LEFT]];const cSe=.5*Math.PI,qlt=cSe/Math.PI*180;class Wlt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:R(),direction:R()};for(let i=0;i<4;i++)this.extent[i]={origin:R(),direction:R(),cap:{next:null,direction:R()}},this.planes[i]=Ei();this.planes[ar.NEAR]=Ei(),this.planes[ar.FAR]=Ei(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),pe(this.center.origin,n[0].origin,n[2].origin),oe(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||oe(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,ny(a.cap.direction,a.origin,l.origin),XO(a.direction,a.cap.direction,a.origin,this.planes[o]),s||oe(a.direction,a.direction,-1)}XO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[ar.NEAR]),s?HG(this.planes[ar.NEAR],this.planes[ar.FAR]):(H5(this.planes[ar.FAR],this.planes[ar.NEAR]),HG(this.planes[ar.NEAR],this.planes[ar.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*Ai(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Ge.Global){const n=this.maxSpanSpatialReference.isGeographic?qlt:cSe*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(Du(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(Du(o.origin,o.direction))||t.intersectsLineSegment(Qb(o.origin,o.cap.next,Ylt),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if($Xe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){GW(t,cd),cd[2]=r,ua(i,cd,SB,this.renderCoordsHelper.spatialReference),Xr(vae,SB),pr(Vl);for(const{x0:n,x1:o,y0:a,y1:l}of Xlt)for(let c=0;c<5;c++){const h=c/4;cd[0]=Zt(t[n],t[o],h),cd[1]=Zt(t[a],t[l],h),cd[2]=r,nn(cd,i,cd,this.renderCoordsHelper.spatialReference),ke(cd,cd,vae),qf(Vl,cd)}ie(this.extent[0].origin,Vl[0],Vl[1],Vl[2]),ie(this.extent[1].origin,Vl[3],Vl[1],Vl[2]),ie(this.extent[2].origin,Vl[3],Vl[4],Vl[2]),ie(this.extent[3].origin,Vl[0],Vl[4],Vl[2]);for(let n=0;n<4;++n)ke(this.extent[n].origin,this.extent[n].origin,SB)}_toRenderBoundingExtentLocal(t,i,r){z5(t,i,Em,this.renderCoordsHelper.spatialReference),ie(this.extent[0].origin,Em[0],Em[1],r),ie(this.extent[1].origin,Em[2],Em[1],r),ie(this.extent[2].origin,Em[2],Em[3],r),ie(this.extent[3].origin,Em[0],Em[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case Ge.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case Ge.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(lr(t.planes[ar.NEAR],this.center.origin)<0&&Se(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(lr(t.planes[ar.NEAR],r.origin)<0&&Se(r.direction,t.direction)<0)return!0}return!1}}const Xlt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],cd=R(),SB=Ee(),vae=Ee(),Vl=ks(),Em=Lt(),Ylt=nm();class Zlt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new ev(t),this.extendedFrustum=new ev(t),this.intersector=new Wlt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return ea.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]>=Qlt&&t.lij[0]<Jlt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==ea.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=ev.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];fe(Fc,l,a),oe(Fc,Fc,ect),pe(r[o],a,Fc)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=ea.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=xae.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ea.INVISIBLE&&(i=o,o===ea.VISIBLE_ON_SURFACE))break}return xae.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]<Klt?this._calculateSingleTileVisibilitySided(t,!1)===ea.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=Ai(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?ea.VISIBLE_ON_SURFACE:ea.VISIBLE_WHEN_EXTENDED:ea.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,Fc);this.aboveGround||oa(i,i);const r=an(-Se(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,Fc),a){case tt.FAR_BOTTOM_LEFT:case tt.FAR_TOP_LEFT:case tt.NEAR_BOTTOM_LEFT:case tt.NEAR_TOP_LEFT:qG(this.extendedFrustum.planes[ar.LEFT],Fc,Fc);break;case tt.FAR_BOTTOM_RIGHT:case tt.FAR_TOP_RIGHT:case tt.NEAR_BOTTOM_RIGHT:case tt.NEAR_TOP_RIGHT:qG(this.extendedFrustum.planes[ar.RIGHT],Fc,Fc)}oe(Fc,Fc,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(Du(l,Fc),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),ia(n[tt.NEAR_BOTTOM_LEFT],n[tt.NEAR_BOTTOM_RIGHT],n[tt.NEAR_TOP_RIGHT],bae),ia(n[tt.NEAR_BOTTOM_RIGHT],n[tt.NEAR_TOP_RIGHT],n[tt.NEAR_TOP_LEFT],wae),Se(bae,wae)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[tt.NEAR_BOTTOM_LEFT],o[tt.NEAR_BOTTOM_RIGHT]]=[o[tt.NEAR_BOTTOM_RIGHT],o[tt.NEAR_BOTTOM_LEFT]]:[o[tt.NEAR_TOP_LEFT],o[tt.NEAR_TOP_RIGHT]]=[o[tt.NEAR_TOP_RIGHT],o[tt.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-_ae;return{zWithMargin:t,pointIndices:ev.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+_ae;return{zWithMargin:t,pointIndices:ev.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Qlt=2,Jlt=6,Klt=12,ect=.95,_ae=1,Fc=R(),bae=Ei(),wae=Ei(),xae=new Ts(Array,e=>{e.length!==4&&(e[0]=new Wd,e[1]=new Wd,e[2]=new Wd,e[3]=new Wd)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class tct{constructor(t){this.camera=new qi,this.focusOnMap=[0,0],this.screenRect=Lt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Zlt(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,BW(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=B$e(t.extent,this.focusOnMap),t.measures.visibility!==ea.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=ict,r=1<<i,s=t.measures.screenRect;xc(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===ea.VISIBLE_WHEN_EXTENDED?this.tileSize*rct:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===ea.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,Gy),xc(EB);for(let a=0;a<4;a++)BS(EB,Gy[a]);return Hb(n,EB,n),tse(Gy[0],Gy[1],Gy[2])+tse(Gy[0],Gy[2],Gy[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,qC),this._toRenderCoords(qC,0,3,jy[0]),this._toRenderCoords(qC,2,3,jy[1]),this._toRenderCoords(qC,2,1,jy[2]),this._toRenderCoords(qC,0,1,jy[3]),s&&(this._projectToPlane(jy,this.camera.frustum[ar.NEAR]),this._projectToPlane(jy,this.camera.frustum[ar.TOP]),this._projectToPlane(jy,this.camera.frustum[ar.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(jy[o],Tae),this.camera.renderToScreen(Tae,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)XC[s]=lr(i,t[s]);const r=Math.max(XC[0],XC[1],XC[2],XC[3]);if(r>0){const s=oe(WC,i,-r);for(let n=0;n<4;n++)pe(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return WC[0]=t[i],WC[1]=t[r],WC[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(WC,this.tilingScheme.spatialReference,s),s}}const EB=Lt(),ict=2,rct=5,Gy=[Wr(),Wr(),Wr(),Wr()],qC=Lt(),WC=R(),jy=[R(),R(),R(),R()],XC=[0,0,0,0],Tae=Ro();function qTt(e,t,i){if(M(e)||M(i))return!1;let r=!0;return Ys[0]=e.xmin!=null?e.xmin:0,Ys[1]=e.ymin!=null?e.ymin:0,Ys[2]=e.zmin!=null?e.zmin:0,r=r&&tr(Ys,e.spatialReference,0,t,i,0,1),Ys[0]=e.xmax!=null?e.xmax:0,Ys[1]=e.ymax!=null?e.ymax:0,Ys[2]=e.zmax!=null?e.zmax:0,r=r&&tr(Ys,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function uSe(e,t,i){if(M(e)||M(i))return!1;let r=!0;return Ys[0]=e.xmin!=null?e.xmin:0,Ys[1]=e.ymin!=null?e.ymin:0,Ys[2]=e.zmin!=null?e.zmin:0,r=r&&tr(Ys,e.spatialReference,0,Ys,i,0,1),t[0]=Ys[0],t[1]=Ys[1],Ys[0]=e.xmax!=null?e.xmax:0,Ys[1]=e.ymax!=null?e.ymax:0,Ys[2]=e.zmax!=null?e.zmax:0,r=r&&tr(Ys,e.spatialReference,0,Ys,i,0,1),t[2]=Ys[0],t[3]=Ys[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Ys=R(),sct=de.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let Yn=class extends Ae{constructor(e){super(e),this.tiles=new ct,this.tileSize=512,this._idToTile=new Map,this._handles=new si,this._clients=new Set,this._dirty=!1,this._newTiles=new It}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void sct.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(M(this.filterExtent)||!this.tilingScheme)return null;const e=Lt();return uSe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([ae(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Qi),ae(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),_s)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(vt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=sn(this._frameWorker),this._handles=at(this._handles)}addClient(){const e=oct();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(zE))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new tct({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Wd(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),xc(O$);for(let t=0;t<e.length;t++)if(Hb(O$,e.data[t].measures.screenRect,O$),fp(O$)>act)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!m3(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==ea.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===ea.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],Yn.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Yn.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Yn.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],Yn.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],Yn.prototype,"focus",void 0),u([d({constructOnly:!0})],Yn.prototype,"viewState",void 0),u([d({constructOnly:!0})],Yn.prototype,"terrain",void 0),u([d()],Yn.prototype,"tiles",void 0),u([d()],Yn.prototype,"tileSize",void 0),u([d({readOnly:!0})],Yn.prototype,"tilingScheme",null),u([d()],Yn.prototype,"filterExtent",null),u([d({readOnly:!0})],Yn.prototype,"filterExtentRect",null),u([d({readOnly:!0})],Yn.prototype,"rootTileIds",null),u([d({value:!1})],Yn.prototype,"suspended",null),u([d({readOnly:!0})],Yn.prototype,"updating",null),Yn=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],Yn);let nct=0;function oct(){return nct++}const O$=Lt(),act=10;let Xn=class extends Ae{constructor(){super(...arguments),this._propertiesPool=new Qg({camera:qi},this),this._lastSeenCameraProjectionValues=new qi,this.events=new Zr,this.viewingMode=Ge.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new Xm({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Qg({camera:qi},this)}createInitialCamera(){if(this.viewingMode===Ge.Global){const e=Ai(this.spatialReference).radius;this.camera=new qi(Ue(4*e,0,0),Ue(e,0,0),Ue(0,0,1))}else this.camera=new qi(Ue(0,0,100),Ue(0,0,0),Ue(0,1,0))}get animation(){return this.cameraController instanceof MR&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Wu&&Wu.copyFrom(e),Wu.computeUp(this.viewingMode),Sae.camera=Wu,this.events.emit("before-camera-change",Sae);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Wu)&&(this._lastSeenCameraProjectionValues.copyFrom(Wu),Eae.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Eae)),(!t||!t.equals(Wu))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Wu)),this._cameraChanged=!t||!t.almostEquals(Wu),this._cameraChanged)){const i=Khe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Ge.Global}get isLocal(){return this.viewingMode===Ge.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(ae(()=>e.state,t=>{t!==Ur.Finished&&t!==Ur.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Qi)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ur.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ur.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Wu.copyFrom(this._get("camera")),e(Wu),this.camera=Wu,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[At.TOP]!==t.padding[At.TOP]||e.padding[At.RIGHT]!==t.padding[At.RIGHT]||e.padding[At.BOTTOM]!==t.padding[At.BOTTOM]||e.padding[At.LEFT]!==t.padding[At.LEFT]}};u([d({readOnly:!0,type:F2})],Xn.prototype,"animation",null),u([d({type:qi})],Xn.prototype,"camera",null),u([d()],Xn.prototype,"pixelRatio",null),u([d({})],Xn.prototype,"_contentCamera",void 0),u([d({type:qi})],Xn.prototype,"contentCamera",null),u([d({readOnly:!0})],Xn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Xn.prototype,"constraints",void 0),u([d({readOnly:!0})],Xn.prototype,"events",void 0),u([d({readOnly:!0})],Xn.prototype,"isGlobal",null),u([d({readOnly:!0})],Xn.prototype,"isLocal",null),u([d({readOnly:!0})],Xn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Xn.prototype,"spatialReference",void 0),u([d({readOnly:!0})],Xn.prototype,"navigating",null),u([d({readOnly:!0})],Xn.prototype,"stationary",null),u([d()],Xn.prototype,"_cameraChanged",void 0),u([d()],Xn.prototype,"cameraController",null),Xn=u([P("esri.views.3d.state.ViewState")],Xn);const lct=Xn,Wu=new qi,Sae={camera:null},Eae={camera:null};function cct(e,t,i){return e===Ge.Global?new hct(i):new uct(t,i)}class uct{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=Ai(i),this.unitInMeters=Nl(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new Xt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);fe(r1,i,t),Yx[0]=r1[0]>0?r.xmax:r.xmin,Yx[1]=r1[1]>0?r.ymax:r.ymin,Yx[2]=r1[2]>0?p/2:-p/2,fe(Yx,Yx,t),we(r1,r1);const f=1.1*Se(Yx,r1)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*fct*this.unitInMeters,b=y*mct*this.unitInMeters;let w=Ne((o-b)/(v-b),0,1);w*=w*w;let S=Zt(m,f,w);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,hSe(S,dct,this.unitInMeters,n)}}class hct{constructor(t){this._referenceEllipsoid=Ai(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Re(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return hSe(1.2*Math.sqrt(c*(c+2*a)),Ne(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function hSe(e,t,i,r){const s=pct/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const dct=2e4,pct=2,fct=.001,mct=1e-4,Yx=R(),r1=R();let aN=class extends Ae{constructor(e){super(e),this.handles=new si}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;J1e(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{GE(this.view,e,Fh.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],aN.prototype,"view",void 0),aN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],aN);let _M=class extends Ae{constructor(e){super(e),this._handles=new si,this.nearFarHeuristic=cct(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([ae(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),ae(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Qi),ae(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),Qi),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Qi),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Qi),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Qi),ae(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),Qi)]),this.view.state.isLocal&&this._handles.add(ae(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ft)),this._updateNearFar(),this.view.state.viewingMode!==Ge.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new aN({view:this.view}))}destroy(){this._handles=at(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,DU(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(_r.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ge.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Pt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Al(i))}}_updateLocalSurfaceDistance(e){if(M(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=_r.ALL){this.view.state.updateCamera(t=>ps(this.view,t,{selection:e,interactionType:Vt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Fn.TUMBLE}))}};u([d({constructOnly:!0})],_M.prototype,"view",void 0),u([d({readOnly:!0})],_M.prototype,"surfaceCollisionConstraint",void 0),_M=u([P("esri.views.3d.state.ConstraintsManager")],_M);let PS=class extends Fb{constructor(e){super(e),this.handles=new si}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ur.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){J1e(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),GE(this.view,e,Fh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ur.Stopped)})}};u([d({constructOnly:!0})],PS.prototype,"view",void 0),u([d({constructOnly:!0})],PS.prototype,"desiredCamera",null),PS=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],PS);const gct=.66;function dSe(e){return 360-SW.normalize(e)}function Rk(e){return SW.normalize(360-e)}function R$(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function yct(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function pSe(e,t,i,r=null){if(!t)return R$(r);const s=e.spatialReference||Ze.WGS84;if(_(t.camera)){const c=Yw(t.camera.position,s);if(M(c))return R$(r);const h=t.camera.clone();return h.position=c,yct(r,h)}if(M(t.targetGeometry))return R$(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Ev(n,s))return R$(r);const o=J2(e,e.state.camera);let a=$o.ADJUST;if(t.rotation!=null&&(o.heading=dSe(t.rotation),a=$o.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?BZ(e,t.scale,c.latitude):e.state.camera.distance,jbe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return aO(e,l,o.heading,o.tilt,a,r)}function vct(e,t,i=null){return M(i)&&(i=new Bh),$Q(e,null,t.clone(),i)}async function _ct(e,t,i){const r=Oct(e,t);if(!r)throw new q("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new wc({fov:e.camera.fov}),n=new Bh({camera:s});if(r.target instanceof Bh)return s1(await xct(e,r.target,r,i,n));if(r.target instanceof wc)return s1(mSe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Xt){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return s1(o||c?await WH(e,r,r.target.center,s,i,n):await Cct(e,r,r.target,s,i,n))}const a={boundingBox:pr(),hasZ:!1,screenSpaceObjects:[]},l=o?bct(e,r):void 0;if(await fSe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Qd(a.boundingBox,ds),ou.x=ds[0],ou.y=ds[1],ou.z=ds[2],ou.spatialReference=e.spatialReference,isFinite(ou.z)&&a.hasZ?c=R5(a.boundingBox):(ou.z=void 0,c=G$e(qW(a.boundingBox,Pct))),o||c)return s1(await WH(e,r,ou,s,i,n));const h=Rct(e,a.screenSpaceObjects);return s1(await Mct(e,r,ou,a.boundingBox,h,s,i,n))}return r.position?s1(Sct(e,r,s,n)):s1(await Ect(e,r,s,i,n))}function PQ(e,t){return t.scale==null&&t.zoom!=null?Wbe(e,t.zoom):t.scale}function bct(e,t){return IQe(e,PQ(e,t))}function IQ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=dSe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function $Q(e,t,i,r){const s=e.spatialReference||Ze.WGS84;return t=_(t)?t:hg(e,i),M(t)||(r.targetGeometry=Wv(t.center,e.renderSpatialReference,s),r.scale=Xbe(e,t),r.rotation=Rk(i.heading),r.camera=i),r}function P4(e,t,i){if(!t)return;if(!Ev(t.spatialReference,e.spatialReference))throw new q("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&Ev(o,e.basemapTerrain.spatialReference)?ds[2]=_t(If(e.elevationProvider,o),0):ds[2]=0}(0,Ict[t.type])(t,o=>{r.push(o[0],o[1],o[2])},ds);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(tr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(ds[0]=n[o+0],ds[1]=n[o+1],ds[2]=n[o+2]):(ds[0]=n[o+0],ds[1]=n[o+1]),qf(i.boundingBox,ds)}}async function wct(e,t,i,r){const s=await mp(e.whenViewForGraphic(t));if(s.ok===!1||M(s.value)||!("whenGraphicBounds"in s.value))return void P4(e,t.geometry,r);const n=s.value,o=await mp(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void P4(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;S2(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function fSe(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return ou.x=s,ou.y=n,ou.z=void 0,ou.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84,void P4(e,ou,r)}t&&typeof t.map=="function"?await Ba(t.map(s=>fSe(e,s,i,r))):t instanceof Ol?P4(e,t,r):t instanceof Ga&&await wct(e,t,i,r)}async function xct(e,t,i,r,s){if(_(t.camera))return mSe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=Rk(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=PQ(e,i);n!=null&&(s.scale=n);const o=new qE(r);return pSe(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function mSe(e,t,i){const r=e.spatialReference,s=Yw(t.position,r);return M(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,$Q(e,null,t,i))}function Tct(e,t,i,r,s,n){const o=e.renderSpatialReference;return Gr(i.position,I$,o),Gr(t,CB,o),n.targetGeometry=new qe(t),s.position=new qe(i.position),fe(I4,CB,I$),FU(e,I$,I4,r.up,s),n.scale=Uw(e,ur(I$,CB),n.targetGeometry.latitude),n.rotation=Rk(s.heading),n.camera=s,n}async function WH(e,t,i,r,s,n){if(M(i))throw new q("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=cx(e);if(t.position)return Tct(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=oe(ds,o.viewForward,-l);o.eye=pe(ds,o.center,c),n.scale=Uw(e,l,i.latitude)}J2(e,o,r);const a=IQ(r,t)?$o.LOCKED:$o.ADJUST;if(!t.zoomFactor){n.scale=PQ(e,t),n.scale==null&&(Gr(i,ds,e.renderSpatialReference),dbe(o.frustum,ds)?n.scale=Uw(e,ur(o.eye,ds),i.latitude):n.scale=Xbe(e,o));const l=new qE(s);Gbe(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function Sct(e,t,i,r){const s=cx(e);return ne(I4,s.viewForward),FU(e,s.eye,I4,s.up,AB),i.position=new qe(t.position),i.heading=t.heading!=null?t.heading:AB.heading,i.tilt=t.tilt!=null?t.tilt:AB.tilt,$Q(e,null,i,r)}async function Ect(e,t,i,r,s){const n=cx(e);return WH(e,t,Wv(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function Cct(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=cx(e);J2(e,o,r);const a=IQ(r,t)?$o.LOCKED:$o.ADJUST,l=new qE(s);return aO(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function Act(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=If(e.elevationProvider,i)),ie(ds,i.x,i.y,n),ua(e.spatialReference,ds,Cae,e.renderSpatialReference),Sc(P$,Cae),Hh(P$,P$),pr(YC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let b=r[v[2]];isFinite(b)||(b=n),ie(ds,r[v[0]],r[v[1]],b),nn(ds,e.spatialReference,ds,e.renderSpatialReference),qf(YC,Oo(ds,ds,P$))}const a=Kw(YC),l=p_(YC),c=ex(YC),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function Mct(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=cx(e),c=Act(e,l,i,r,s);J2(e,l,n);const h=IQ(n,t)?$o.LOCKED:$o.ADJUST;a.scale=Uw(e,c,a.targetGeometry.latitude);const p=new qE(o);return Gbe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function Oct(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function s1(e){return e&&_(e.camera)&&(e.rotation=Rk(e.camera.heading)),e}function Rct(e,t){const i=gct;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const ds=R(),Cae=Ee(),P$=ir(),YC=ks(),Pct=Lt(),I4=R(),I$=R(),CB=R(),AB={heading:0,tilt:0},ou=new qe,Ict={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(ie(i,e.xmin,e.ymin,e.zmin)),t(ie(i,e.xmax,e.ymin,e.zmin)),t(ie(i,e.xmin,e.ymax,e.zmin)),t(ie(i,e.xmax,e.ymax,e.zmin)),t(ie(i,e.xmin,e.ymin,e.zmax)),t(ie(i,e.xmax,e.ymin,e.zmax)),t(ie(i,e.xmin,e.ymax,e.zmax)),t(ie(i,e.xmax,e.ymax,e.zmax))):(t(ie(i,e.xmin,e.ymin,i[2])),t(ie(i,e.xmax,e.ymin,i[2])),t(ie(i,e.xmin,e.ymax,i[2])),t(ie(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(ie(i,r[s+0],r[s+1],r[s+2]))}};class $ct{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&Fo(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(hi());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(hi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await IO(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,_ct(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!M(i))if(this.options.animate){if(M(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Bh&&this.target.camera||this.target instanceof wc),r=t.camera;if(M(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new q("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=hg(this.view,r);return M(s)?(this.reject(new q("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(M(r))return void this.reject(new q("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||M(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new PS({view:this.view,desiredCamera:t.camera}),GE(this.view,t.camera,Fh.EYE_AND_CENTER)):ps(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Ag&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!M(this.view.state))switch(i.state){case Ur.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ur.Ready:case Ur.Rejected:case Ur.Running:case Ur.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof Ag&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new Ag({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new q("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Xu=de.getLogger("esri.views.3d.state.ViewStateManager");let dn=class extends Ae{constructor(e){super(e),this.propertiesPool=new Qg({frustum:ev},this),this.handles=new si,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=J2(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(hg(this.view,e),{applyConstraints:!1})||Xu.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=J2(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=hg(this.view,e);M(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=dl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([ae(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),ae(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),ae(()=>this.view.state.camera,n=>{const o=_n(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Xu.error("#center=","Invalid center",e):Xu.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Xu.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=AQe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Xu.error("#extent=","Invalid extent",e):Xu.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Xu.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Uw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Xu.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[At.TOP]/i),n=Math.round(t[At.RIGHT]/i),o=Math.round(t[At.BOTTOM]/i),a=Math.round(t[At.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,$$),this.view.state.updateCamera(t=>t.padding=$$))}_paddingToArray(e,t,i){e?Ji(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Ji(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return pp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?vct(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Xu.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;Xu.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Xu.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?qbe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Xu.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return M(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([oo(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),ae(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(lw({prepare:()=>this._prepareFrame()})),this.handles.add(ae(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(D$)})),this.handles.add(oo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new _M({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ge.Local&&this.handles.add(Cl(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(D$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),D$)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(D$),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=F({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new $ct(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(cx(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Nct){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(M(e)||this.cameraSetByUser)return;if(e instanceof wc)return void this.setStateCamera(hg(this.view,e),{applyConstraints:!1});if(e instanceof Bh){if(e.targetGeometry instanceof Xt){const s=aO(this.view,e.targetGeometry,0,.5,$o.LOCKED);return void(_(s)&&this.setStateCamera(hg(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=aO(this.view,e,0,.5,$o.LOCKED);_(t)&&this.setStateCamera(hg(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Lct.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!M(e)&&(e instanceof Bh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof wc?this.isCompatible(e.position):e.spatialReference&&Ev(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Fct){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Hy){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=RR(this.view,r,s,e,t,$o.ADJUST);return M(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=aO(this.view,e,t,i,$o.ADJUST,Uct);return _(r)?hg(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=BZ(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(Wbe(this.view,e))}_viewpointToCamera(e){return hg(this.view,pSe(this.view,e))}setStateCamera(e,t){return!(M(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&ps(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new PS({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(Hy.copyFrom(n),Hy.pixelRatio!==i&&(this._paddingToArray(this.padding,i,$$),Hy.padding=$$),Hy.fullWidth=r,Hy.fullHeight=s,Hy.pixelRatio=i,this.view.state.camera=Hy)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?DU(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:wc,dependsOn:["view.state.camera","ready"]})],dn.prototype,"camera",null),u([d({type:wc,dependsOn:["view.state.contentCamera","ready"]})],dn.prototype,"contentCamera",null),u([d({type:qe})],dn.prototype,"center",null),u([d({type:Xt})],dn.prototype,"extent",null),u([d({readOnly:!0})],dn.prototype,"frustum",null),u([d({readOnly:!0})],dn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],dn.prototype,"ready",void 0),u([d({type:Number})],dn.prototype,"scale",null),u([d()],dn.prototype,"padding",null),u([d({readOnly:!0})],dn.prototype,"screenCenter",null),u([d({constructOnly:!0})],dn.prototype,"view",void 0),u([d({type:Bh})],dn.prototype,"viewpoint",null),u([d({type:Number})],dn.prototype,"zoom",null),u([d()],dn.prototype,"maximumPixelRatio",null),u([d()],dn.prototype,"_devicePixelRatio",null),u([d()],dn.prototype,"_windowDevicePixelRatio",void 0),u([d()],dn.prototype,"_devicePixelRatioOverride",void 0),u([d()],dn.prototype,"_maximumPixelRatioOverride",void 0),dn=u([P("esri.views.3d.state.ViewStateManager")],dn);const Dct=dn,Lct=["camera","viewpoint","extent","scale","center","zoom"],Nct=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Fct={heading:0,tilt:0},Uct=new wc,Hy=new qi,$$=qt(),D$="pending-initial-view";class kct{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new It,this.tolerance=Z2,this.tmpRay=io(),this.tmpRegion=Lt(),this.validateHUDIntersector=Wh(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),Aae(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Aae(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=lo.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(F$,r,s),F$[0]+=.0466,F$[1]-=.0123,LZ(t,F$,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||um(s)&&s.intersector!==zr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=Z2){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===zr.TERRAIN?1:r.type===zr.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===zr.TERRAIN?1:r.type===zr.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return mbe(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==Ge.Local||M(t))return!1;const r=this.view.renderDataExtent;if(M(r))return pe(i,t.origin,we(je.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return pe(i,t.origin,we(je.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=oe(je.get(),t.direction,f/Re(t.direction));return pe(i,t.origin,m),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(M(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?_t(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,N$)){const S=this.view.computeMapPointFromVec3d(N$);return S.z-=o,S}return null}const c=this.view.state.camera,h=je.get();c.projectToRenderScreen(t.origin,h);const p=new Mae(null,this._forEachLayer),f=this.view.slicePlane,m=_(f)?xse(f):null,y=Wh(this.viewingMode);y.options.store=lo.MIN,y.options.verticalOffset=l;const v=t.origin,b=pe(je.get(),v,t.direction);y.reset(v,b,c),y.point=h;const w=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=T=>(M(w)||w(T))&&T.metadata&&T.metadata.isElevationSource;y.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(T=>{if(T.type===zr.I3S||T.type===zr.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(N$)){const S=this.view.computeMapPointFromVec3d(N$);return S.z=r,S}return null}computeIntersection(t,i,r){if(M(t))return;const s=this.view.state.camera,n=je.get();s.projectToRenderScreen(t.origin,n);const o=new Mae(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=pe(je.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?xse(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(i.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!i.options.isFiltered){const y=m.slicePlaneEnabled?h:null;m.intersect(i,y,a,l,n)}});const f=je.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,y=m.overlayManager.renderer,v=this.view.renderCoordsHelper.spatialReference,b=je.get();this.view.renderCoordsHelper.fromRenderCoords(f,b,m.spatialReference),b[2]=_t(this.view.elevationProvider.getElevation(f[0],f[1],f[2],v,"ground"),0),y.intersect(i,b,i.results.ground,w=>o.filterRenderGeometry(w))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;Xg(this.tmpRegion,Y9);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=w=>{const S=new Vct(w);r.projectToRenderScreen(w.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),BS(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-bM),h=Math.max(0,n[1]-bM),p=Math.min(fu(n)+2*bM,a-c),f=Math.min(fp(n)+2*bM,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let y=!0;const v=M(t.results.max.dist);let b=0;for(const w of s)for(const S of zct)if(m[4*(Math.min(w.screenPoint[0]+S[0],a)-n[0]+(Math.min(w.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(t.results.min.copy(w.result),y=!1),v&&t.results.max.copy(w.result),t.options.store===lo.ALL&&t.results.all.splice(b++,0,w.result);break}}}const bM=1,zct=(()=>{const e=[],t=bM;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class Vct{constructor(t){this.result=t,this.screenPoint=Ro()}}let L$;function Aae(e){return L$&&L$.viewingMode===e||(L$=Wh(e)),L$}class Mae{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return M(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Oae(e){return typeof e=="object"&&"intersect"in e}const N$=R(),F$=Ro();class WTt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Bct{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=ye(F({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(vt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),Fo(r,()=>{Lq(this._queries,a),o(hi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new Zw({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>Fo(h.signal,()=>{c++,h.result.reject(hi()),c===t.length&&o.abort()}))}const l=ye(F({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(hi()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let wM=class extends Zr.EventedMixin(Ae){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=at(this._elevationQuery)}get elevationQuery(){return M(this._elevationQuery)&&(this._elevationQuery=new Bct(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=U$(n,this.im,e,t,i,r,s),M(n)&&(n=U$(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=U$(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=hp();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=U$(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Br(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function U$(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],wM.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],wM.prototype,"spatialReference",void 0),wM=u([P("esri.views.3d.support.CombinedElevationProvider")],wM);class xv{static isValidProfile(t){return t in xv.profiles}static getDefaultProfile(){return he("trident")||he("esri-iPhone")?"low":"medium"}static apply(t,i){const r=xv.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Rae(){const e=!!he("esri-mobile"),t=!!he("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}xv.debug={reset(){const e=Rae();for(const t in e)xv.profiles[t]=e[t]}},function(e){e.profiles=Rae()}(xv||(xv={}));const lN=xv;function DQ(){return new Float32Array(4)}function Gct(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Zh(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function jct(e,t){return new Float32Array(e,t,4)}function gSe(){return DQ()}function ySe(){return Zh(1,1,1,1)}function vSe(){return Zh(1,0,0,0)}function _Se(){return Zh(0,1,0,0)}function bSe(){return Zh(0,0,1,0)}function wSe(){return Zh(0,0,0,1)}const Hct=gSe(),qct=ySe(),Wct=vSe(),Xct=_Se(),Yct=bSe(),Zct=wSe();Object.freeze(Object.defineProperty({__proto__:null,create:DQ,clone:Gct,fromValues:Zh,createView:jct,zeros:gSe,ones:ySe,unitX:vSe,unitY:_Se,unitZ:bSe,unitW:wSe,ZEROS:Hct,ONES:qct,UNIT_X:Wct,UNIT_Y:Xct,UNIT_Z:Yct,UNIT_W:Zct},Symbol.toStringTag,{value:"Module"}));let lf=class extends Ae{constructor(){super(...arguments),this.color=new We([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new We([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=We.toUnitRGBA(e.color),i=_(e.haloColor)?We.toUnitRGBA(e.haloColor):t,r=We.toUnitRGBA(e.shadowColor);return{color:Zh(t[0],t[1],t[2],t[3]),haloColor:Zh(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:vi(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:We})],lf.prototype,"color",void 0),u([d({type:We})],lf.prototype,"haloColor",void 0),u([d()],lf.prototype,"haloOpacity",void 0),u([d()],lf.prototype,"fillOpacity",void 0),u([d()],lf.prototype,"shadowOpacity",void 0),u([d({type:We})],lf.prototype,"shadowColor",void 0),u([d()],lf.prototype,"shadowDifference",void 0),lf=u([P("esri.views.3d.support.HighlightOptions")],lf);const XH=lf;function Qct(e,t,i){const r=Qpe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let J1=class extends xe{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:xE(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],J1.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],J1.prototype,"outSpatialReference",void 0),u([d()],J1.prototype,"transformation",void 0),u([d()],J1.prototype,"transformForward",void 0),J1=u([P("esri.rest.support.ProjectParameters")],J1);const LQ=J1,Jct=Ss(LQ);async function xSe(e,t,i){t=Jct(t);const r=_ye(e),s=F(ye(F({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=xE(t.geometries[0]),a=aUe(s,i);return _i(r.path+"/project",a).then(({data:{geometries:l}})=>Qct(l,o,n))}async function NQ(e=null,t){var s,n;if(ki.geometryServiceUrl)return ki.geometryServiceUrl;if(!e)throw new q("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||Pl.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new q("internal:geometry-service-url-not-configured");return r}async function Kct(e,t,i=null,r){const s=await NQ(i,r),n=new LQ;n.geometries=[e],n.outSpatialReference=t;const o=await xSe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new q("internal:geometry-service-projection-failed")}var eut=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:NQ,projectGeometry:Kct},Symbol.toStringTag,{value:"Module"}));class tut{constructor(t,i){this.spatialReference=i,this.unitInMeters=Nl(this.spatialReference,Ai(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=NQ(t&&t.get("portalItem")).catch(()=>{throw new q("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof qe?l:new qe(l,this.spatialReference)),o=new LQ({geometries:n,outSpatialReference:Ze.WGS84}),a=(await xSe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let vf=class extends Ae{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],vf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],vf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],vf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],vf.prototype,"snapshotAvailable",void 0),u([d()],vf.prototype,"polygonLodFactor",void 0),u([d()],vf.prototype,"polylineLodFactor",void 0),vf=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],vf);let Ff=class extends Ae{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Ff.prototype,"lodFactor",void 0),Ff=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Ff);let $4=class extends Ff{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};$4=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],$4);let pg=class extends Ae{constructor(){super(...arguments),this["3dObject"]=new $4,this.point=new Ff,this.integratedMesh=new Ff,this.pointCloud=new Ff,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:$4})],pg.prototype,"3dObject",void 0),u([d({type:Ff})],pg.prototype,"point",void 0),u([d({type:Ff})],pg.prototype,"integratedMesh",void 0),u([d({type:Ff})],pg.prototype,"pointCloud",void 0),u([d()],pg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),pg=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],pg);let X0=class extends Ae{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],X0.prototype,"lodBias",void 0),u([d()],X0.prototype,"angledSplitBias",void 0),u([d()],X0.prototype,"reduceTileLevelDifferences",void 0),u([d()],X0.prototype,"textureFadeDuration",void 0),X0=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],X0);let IS=class extends Ae{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],IS.prototype,"pixelRatio",void 0),u([d()],IS.prototype,"maxTotalNumberOfFeatures",void 0),IS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],IS);let sl=class extends Ae{constructor(){super(...arguments),this.graphics3D=new vf,this.sceneService=new pg,this.tiledSurface=new X0,this.heatmap=new IS,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:vf})],sl.prototype,"graphics3D",void 0),u([d({type:pg})],sl.prototype,"sceneService",void 0),u([d({type:X0})],sl.prototype,"tiledSurface",void 0),u([d({type:IS})],sl.prototype,"heatmap",void 0),u([d()],sl.prototype,"antialiasingEnabled",void 0),u([d()],sl.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],sl.prototype,"highQualityTransparency",void 0),u([d()],sl.prototype,"memoryLimit",void 0),u([d()],sl.prototype,"additionalCacheMemory",void 0),u([d()],sl.prototype,"frameRate",void 0),u([d()],sl.prototype,"maximumRenderResolution",void 0),u([d()],sl.prototype,"maximumPixelRatio",void 0),sl=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],sl);const Pae=sl;class D4{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=MFe(s)}set extent(t){t&&OFe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return FFe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return qge(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){UFe(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return $Fe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return DFe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Au.X,je.get()),s=this.worldBasisAtPosition(t,Au.Y,je.get()),n=this.worldBasisAtPosition(t,Au.Z,je.get());return sm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return jz(this.coordinateSystem,i,this._coordinateSystem),NFe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){jz(this.coordinateSystem,i,this._coordinateSystem);const s=je.get();return LFe(this._coordinateSystem,t,s)?ne(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===Ge.Global)return this.intersectManifold(t,i,r);jz(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=je.get();return sx(s.plane,t,n)?ne(r,n):null}toRenderCoords(t,i,r){return l4(t)?Gr(t,i,this.spatialReference):nn(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return l4(i)?(_(r)&&(i.spatialReference=r),Gme(t,this.spatialReference,i)):i instanceof Ze?Wv(t,this.spatialReference,i):nn(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case Ge.Local:return new D4(Ge.Local,i,Nl(i),IFe());case Ge.Global:return new D4(Ge.Global,i,1,PFe(i))}}static renderUnitScaleFactor(t,i){return Iae(t)/Iae(i)}}function Iae(e){if(c4(e,Ge.Global))return 1;const t=Wge(!1,e);return Nl(t)}var Mf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Mf||(Mf={}));const iut=(()=>{const e=new Array;return e[Mf.ELEVATION]=10,e[Mf.BASEMAP]=10,e[Mf.I3S_INDEX]=10,e[Mf.I3S_DATA]=10,e[Mf.SYMBOLOGY]=5,e})(),rut=30;function TSe(e){return typeof e.getUsedMemory=="function"}const sut=de.getLogger("esri.views.3d.support.MemoryController");function nut(e){return new nl({view:e})}const k$=1,MB=1,out=.75,aut=.6,$ae=1.3;let nl=class extends Ae{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new BX,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(k$),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new T5e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<aut&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(k$);else if(e)(this._memoryPredicted>1.1*MB||this._memoryUsed>MB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/$ae),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>MB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/$ae),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<out&&this._quality<k$){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),k$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(TSe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);sut.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],nl.prototype,"view",void 0),u([d()],nl.prototype,"maxMemory",null),u([d()],nl.prototype,"additionalCacheMemory",null),u([d()],nl.prototype,"memoryFactor",null),u([d()],nl.prototype,"updating",null),u([d()],nl.prototype,"usedMemory",null),u([d()],nl.prototype,"_quality",void 0),u([d()],nl.prototype,"_memoryUsed",void 0),u([d()],nl.prototype,"_updating",void 0),u([d()],nl.prototype,"_stableQuality",void 0),u([d()],nl.prototype,"_maxMemory",void 0),u([d()],nl.prototype,"_additionalCacheMemory",void 0),nl=u([P("esri.views.3d.support.MemoryController")],nl);class lut{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class cut{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new uut}}class uut{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class hut{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new cut(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,pt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let cN=class extends Ae{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new hut((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(vt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=sn(this._frameTask),this._tasks.forEach(e=>zh(e.abortController)),this._loadQueue=at(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=hp();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return Fo(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new fut(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){J4(e.resolvers,t),t.reject(hi()),e.resolvers.length===0&&(e.status===fh.DOWNLOADING&&(e.status=fh.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=fh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=mut(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(pt(e.status===fh.DOWNLOADING),e.status=fh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Wt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==fh.DOWNLOADED&&(t.err=t.err||hi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Br(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Br(t)?r.reject(t):r.reject(new q("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:te(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===fh.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=fh.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=_i(e.url,ye(F({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===fh.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=put(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=_i(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=_i(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new Pk(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],cN.prototype,"updating",void 0),cN=u([P("esri.views.3d.support.StreamDataLoader")],cN);const dut={numRetries:0};function put(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class Pk{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class fut extends lut{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=fh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=dut.numRetries}}function mut(e,t,i){return`${e}:${t}:${i}`}var fh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(fh||(fh={}));let z$=class extends Ae{constructor(){super(...arguments),this.updating=!1}};function gut(e){return new YH.ResourceController({view:e})}var YH;u([d({readOnly:!0})],z$.prototype,"updating",void 0),z$=u([P("esri.views.3d.support.ResourceController")],z$),function(e){let t=class extends z${constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=N2,this._cameraChangeTime=0,this._handles=new si,this._frameTask=null,this._state=On.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=U7e(),this._memoryController=nut(this.view),this._streamDataLoader=new cN,this._streamDataLoader.setup(rut,iut,this._scheduler),this._handles.add([ae(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Qi),ae(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=lw({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER)}destroy(){this._handles=at(this._handles),this._scheduleTask.remove(),this._frameTask=sn(this._frameTask),this._streamDataLoader=at(this._streamDataLoader),this._memoryController=at(this._memoryController),this._scheduler=at(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(nW(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=On.ANIMATING:this.view.interacting?this._state=On.INTERACTING:(this._state===On.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=On.INTERACTING:this._state=On.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([P("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(YH||(YH={}));function yut(e){return"performanceInfo"in e}const Zx=R(),vut=R(),Cm=R(),Am=R();function _ut(e,t,i=0){const r=e.extent;if(M(r))return!1;if(i===0)return Pfe(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return V$e(r,t,i*s)}function V$(e,t,i,r){ne(Zx,i),Zx[r]=t[r];const s=fe(Zx,Zx,t),n=fe(vut,e,t),o=Se(n,s),a=Se(s,s);let l;l=o<=0?t:a<=o?i:pe(Zx,t,oe(s,s,o/a));const c=fe(Zx,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function but(e,t,i){const r=e.extent;if(M(r))return 0;Cm[0]=r[0],Cm[1]=r[1],Cm[2]=i,Am[0]=r[2],Am[1]=r[3],Am[2]=i;let s=1/0,n=1/0;return t[0]<Cm[0]?s=V$(t,Cm,Am,0):t[0]>Am[0]&&(s=V$(t,Am,Cm,0)),t[1]<Cm[1]?n=V$(t,Cm,Am,1):t[1]>Am[1]&&(n=V$(t,Am,Cm,1)),Math.min(s,n)}function wut(e,t,i){if(M(e))return GY();if(e.spatialReference.isGeographic&&!ww(e.spatialReference))return new q("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Ir.checkUnsupported(e);if(_(r))return r;if(M(i))return new q("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=xut(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function xut(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=jO(t),a=Lt();Ir.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>_S){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new q("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:_S})}return null}const Tut=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:_ut,tiltToExtentEdge:but,checkIfTileInfoSupportedForViewSR:wut},Symbol.toStringTag,{value:"Module"}));function Sut(){return!0}function Eut(){return 0}function Cut(e,t){if(M(e))return GY();const i=e.lods.length-1,r=e.spatialReference,s=ww(r)||tm(r)||im(r);if(r.isWebMercator){if(!Ir.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new q("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new q("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Ir.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new q("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new q("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new q("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Aut=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Sut,tiltToExtentEdge:Eut,checkIfTileInfoSupportedForViewSR:Cut},Symbol.toStringTag,{value:"Module"})),Mut={[Ge.Global]:Aut,[Ge.Local]:Tut};function xf(e,t){e||console.warn("Terrain: "+t)}function ZH(e){return Ik(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function L4(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function Ik(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function FQ(e){return(e==null?void 0:e.type)==="tile-3d"}function jR(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function SSe(e){return(e==null?void 0:e.type)==="wmts-3d"}function QH(e){return(e==null?void 0:e.type)==="elevation-3d"}function ESe(e){return(e==null?void 0:e.type)==="group"}function N4(e){return e&&(FQ(e)||SSe(e)||Ik(e)||jR(e))}function JH(e){return e&&(FQ(e)||Ik(e)||jR(e)||SSe(e))}function HR(e){return JH(e)||QH(e)}function XTt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function Out(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function Rut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function Put(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function Iut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof Pk||t instanceof HTMLCanvasElement||t instanceof ImageData}function KS(e){return _(e)&&"release"in e&&e.release(),null}function Dae(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function UQ(e,t,i,r){return Mut[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function $k(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=$ut(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=L4(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===Ge.Local;if(L4(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!Dut(t)||Lut.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&UQ(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function $ut(e,t,i){const r=kFe(e);if(_(r)){if(!ct.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>UQ(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Dut(e){return e.isWGS84||e.isWebMercator||Mpe(e)||!NO(e)}const Lut={force512VTL:!1};function F4(e){return e===kt.NORTH_EAST?kt.SOUTH_WEST:e===kt.NORTH_WEST?kt.SOUTH_EAST:e===kt.SOUTH_WEST?kt.NORTH_EAST:kt.NORTH_WEST}function uN(e){return e===kt.NORTH?kt.SOUTH:e===kt.EAST?kt.WEST:e===kt.SOUTH?kt.NORTH:kt.EAST}function Nut(e){return e===kt.NORTH_WEST||e===kt.SOUTH_WEST}function Fut(e){return e===kt.NORTH_WEST||e===kt.NORTH_EAST}function Lae(e){return e===kt.NORTH_WEST||e===kt.WEST||e===kt.SOUTH_WEST}function Nae(e){return e===kt.NORTH_EAST||e===kt.EAST||e===kt.SOUTH_EAST}function Fae(e){return e===kt.SOUTH_EAST||e===kt.SOUTH||e===kt.SOUTH_WEST}function Uae(e){return e===kt.NORTH_EAST||e===kt.NORTH||e===kt.NORTH_WEST}const tv=[kt.NORTH,kt.EAST,kt.SOUTH,kt.WEST],U4=[kt.NORTH_EAST,kt.SOUTH_EAST,kt.SOUTH_WEST,kt.NORTH_WEST];class Uut{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=HR(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),yut(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class kut{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*xw.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(TSe(s)||HR(s))&&this.layerPerformanceInfos.push(new Uut(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class zut extends bS{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){Wt(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{Fo(s,()=>{l(hi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=ye(F({},this._parameters),{powerOfTwoResizeMode:Pv.PAD});if(iW(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new $s(i,s)}}class Vut{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Mf.SYMBOLOGY),this.textures=new zut(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=Ai(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=nwe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=xJe(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Vh();this.graphicsOwners.push(t);const i=ae(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Vh(()=>{i.remove(),J4(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new si;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([ae(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Qi),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;B$.distance=t.centerOnSurfaceInfrequent.distance,B$.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(B$),this.screenSizePerspectiveSettingsLabels.update(B$),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const B$={distance:0,fovY:0};class $0{constructor(t,i,r=""){this.graphics=t,this._symbol=new uv({symbolLayers:[new cv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new tx({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(M(i))return;this.hide();const r=new qe({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Ga({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let iv=class extends Ae{constructor(e){super(e),this.handles=new si}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],iv.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],iv.prototype,"surface",void 0),u([d({constructOnly:!0})],iv.prototype,"state",void 0),iv=u([P("esri.views.3d.support.PointOfInterest")],iv);const But=Array;let Jc=class extends iv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Qg({location:qe,renderLocation:But},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=R(),this.tmpPoint=new qe}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(oo(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=ur(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Uw(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Br(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(OB,this._estimatedSurfaceAltitude,this._camera.eye),ka(this._get("renderLocation"),OB)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),OB))}};u([d({constructOnly:!0})],Jc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Jc.prototype,"cache",void 0),u([d({constructOnly:!0})],Jc.prototype,"task",void 0),u([d({constructOnly:!0})],Jc.prototype,"cameraName",void 0),u([d({readOnly:!0})],Jc.prototype,"location",null),u([d({constructOnly:!0})],Jc.prototype,"map",void 0),u([d({readOnly:!0})],Jc.prototype,"renderLocation",void 0),u([d({readOnly:!0})],Jc.prototype,"scale",null),u([d({readOnly:!0})],Jc.prototype,"updating",null),Jc=u([P("esri.views.3d.support.CameraOnSurface")],Jc);const OB=R(),Gut=Array;let rc=class extends iv{constructor(e){super(e),this._propertiesPool=new Qg({location:qe,renderLocation:Gut},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=R(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=sn(this._frameWorker),this._propertiesPool=at(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Hut;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=qut;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ne(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=ur(this._camera.eye,e):(oe(e,this._camera.viewForward,this._get("distance")),pe(e,e,this._camera.eye)),ka(this._get("renderLocation"),e)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=Ai(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=Fa(i.eye),o=n<s*s,a=ur(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return oe(t,i.viewForward,l),pe(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&z5(r,this.surface.spatialReference,ZC,this.renderCoordsHelper.spatialReference)&&(t[0]=Ne(t[0],ZC[0],ZC[2]),t[1]=Ne(t[1],ZC[1],ZC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Wi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=ur(i,e),s=ur(i,t);if(Math.abs(s-r)/r>jut)return!0}return!1}};u([d({constructOnly:!0})],rc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],rc.prototype,"task",void 0),u([d({constructOnly:!0})],rc.prototype,"cameraName",void 0),u([d()],rc.prototype,"distance",void 0),u([d({constructOnly:!0})],rc.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],rc.prototype,"location",null),u([d({readOnly:!0})],rc.prototype,"renderLocation",void 0),u([d()],rc.prototype,"updating",void 0),rc=u([P("esri.views.3d.support.CenterOnSurface")],rc);const jut=.05,Hut=R(),qut=R(),ZC=Lt();class Wut{constructor(t){this.handles=new si,this.events=new Zr,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Xut)}}const Xut={},Yut=Array;let cf=class extends iv{constructor(e){super(e),this._propertiesPool=new Qg({location:qe,renderLocation:Yut},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ae(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ae(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(vt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,kae);const s=Math.max(0,(Math.acos(Se(kae,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!hw(e,t)){const l=this._propertiesPool.get("renderLocation");ne(l,t),this._set("renderLocation",l)}return}const n=1-Ne(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(zae);const a=this._propertiesPool.get("renderLocation");on(a,t,zae,o),e&&hw(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(Ro());if(i[1]=t.aboveGround?t.padding[At.BOTTOM]:t.fullHeight-t.padding[At.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,QC)){fe(QC,QC,t.eye);const s=we(QC,QC);if(this.renderCoordsHelper.intersectManifold(Du(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],cf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],cf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],cf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],cf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],cf.prototype,"updating",null),u([d({readOnly:!0})],cf.prototype,"location",null),u([d({readOnly:!0})],cf.prototype,"renderLocation",void 0),cf=u([P("esri.views.3d.support.CenterOnSurface")],cf);const kae=R(),QC=R(),zae=R();let eg=class extends Ae{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new si}get renderLocation(){if(!this.location)return null;const e=R();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([ae(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),oo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||M(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=GW(this.surfaceView.extent),t=new qe({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Br(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],eg.prototype,"view",void 0),u([d({constructOnly:!0})],eg.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],eg.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],eg.prototype,"surfaceView",void 0),u([d({readOnly:!0})],eg.prototype,"location",void 0),u([d({readOnly:!0})],eg.prototype,"renderLocation",null),eg=u([P("esri.views.3d.terrain.StableSurfaceCenter")],eg);let tg=class extends Ae{constructor(){super(...arguments),this.handles=new si,this._tileGeometryUpdateExtent=xc(),this._tileGeometryUpdateSpatialReference=null,this.events=new Zr,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(vt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=at(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Zut),xc(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Hb(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Qut,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,n1,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,o1,t),n1[0]<o1[0]?(r[0]=n1[0],r[2]=o1[0]):(r[0]=o1[0],r[2]=n1[0]),n1[1]<o1[1]?(r[1]=n1[1],r[3]=o1[1]):(r[1]=o1[1],r[3]=n1[1]),m3(r,e)}};u([d({constructOnly:!0})],tg.prototype,"state",void 0),u([d({constructOnly:!0})],tg.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],tg.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],tg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],tg.prototype,"surface",void 0),u([d({readOnly:!0})],tg.prototype,"updating",void 0),tg=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],tg);const Zut={},n1=R(),o1=R(),Qut=xc();let Ko=class extends Ae{constructor(e){super(e),this._handles=new si,this._tmpRay=io(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Qg({renderPointOfView:Jut},this),this.renderPointOfView=R(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=Wh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=lo.MIN,this._contentIntersector=Wh(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new rc(ye(F({},a),{task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new rc(ye(F({},a),{task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("contentCenterOnSurface",new rc(ye(F({},a),{task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"}))),this._set("centerOnContent",new rc(ye(F({},a),{task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new Jc(ye(F({},a),{cache:o,task:vt.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("contentCameraOnSurface",new Jc(ye(F({},a),{cache:o,task:vt.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new tg(ye(F({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new Wut({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new eg({cache:o,view:this.view})),this._set("focus",new cf({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new $0(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new $0(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new $0(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new $0(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new $0(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new $0(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new $0(l,"green","Focus")),this._handles.add([ae(()=>e.camera,h=>this._cameraChanged(h),Qi),ae(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Cl(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Qi),oo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),oo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Cl(()=>Wi.SHOW_POI,h=>this._setDebug(h),Ft)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return M(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Qx,eht)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Qx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(M(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=pe(Qx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Qx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Qx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=LZ(t,e,Kut);if(M(r))return null;const s=r.origin,n=pe(Qx,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;ka(this.renderPointOfView,t)||this._set("renderPointOfView",ne(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(ae(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),Ft),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Ko.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Ko.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Ko.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Ko.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],Ko.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Ko.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],Ko.prototype,"focus",void 0),u([d({readOnly:!0})],Ko.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Ko.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Ko.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Ko.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Ko.prototype,"view",void 0),u([d({readOnly:!0})],Ko.prototype,"updating",null),Ko=u([P("esri.views.3d.support.PointsOfInterest")],Ko);const Jut=Array,Qx=R(),Kut=io(),eht={exclude:new Set([qd])};class tht{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const iht=de.getLogger("esri.core.workers.WorkerHandle");class CSe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=dme(t,ye(F({},n),{schedule:s})).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>iht.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Vh(()=>{r.removed=!0,Lq(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(Wt(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Vae extends CSe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(_O.forEach((t,i)=>{t===this&&_O.delete(i)}),this.destroy())}}const _O=new Map;function ASe(e=null){let t=_O.get(e);return t||(_(e)?(t=new Vae(i=>e.schedule(i)),_O.set(e,t)):(t=new Vae,_O.set(null,t))),++t.ref,t}function kg(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function MSe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rht(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function sht(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:kg,clone:MSe,fromValues:rht,createView:sht},Symbol.toStringTag,{value:"Module"}));var Bae,cc,Gae,jae,Hae;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(Bae||(Bae={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(cc||(cc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Gae||(Gae={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(jae||(jae={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Hae||(Hae={}));class nht{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class YTt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function ZTt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class QTt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function oht(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new nht(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],y=t[r++],v=t[r++],b=t[r++],w=!!t[r++],S=t[r++],T=i[r++],E=i[r++],C=t[r++],A=t[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:S,width:C,height:A,minLod:T,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function JTt(e,t,i){for(const[r,s]of e.symbols)aht(e,t,i,s,r)}function aht(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===cc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class Dk{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return M(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){M(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class lht extends Dk{constructor(t,i){super(t,i),this.type=cc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new zs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class cht extends Dk{constructor(t,i){super(t,i),this.type=cc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new zs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new zs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class uht extends Dk{constructor(t,i,r){super(t,i),this.type=cc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],v=s[a++];this.iconPerPageElementsMap.set(m,[y,v])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(m,[y,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=oht(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=ai.createVertex(t,Ci.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=ai.createVertex(t,Ci.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new zs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new zs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class hht extends Dk{constructor(t,i){super(t,i),this.type=cc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=ai.createVertex(t,Ci.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=ai.createIndex(t,Ci.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new zs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const KTt=!0,eSt=32,qae=200,dht=1/he("mapview-transitions-duration");class pht extends Zr{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return M(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=hp(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=hp(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*dht;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Sf{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Sf(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Sf(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Sf(t,i,r,s),new Sf(t,i,r+1,s),new Sf(t,i+1,r,s),new Sf(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Sf.pool=new Ts(Sf,null,null,25,50);class fht extends pht{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Sf(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;lZ(s,a,0,0,0,l,0,n,o,1),CU(this.transforms.dvs,t.displayViewMat3,s)}}class bO extends fht{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<qae}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<qae)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===cc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(OSe.delete(this),bO._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===cc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===cc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;cZ(a),XF(a,a,o),uZ(a,a,Math.PI*t.rotation/180),hZ(a,a,[s,n,1])}_createTransforms(){return{dvs:kg(),tileMat3:kg(),tileUnitsToPixels:kg()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case cc.FILL:r=new cht(t,this.styleRepository);break;case cc.LINE:r=new lht(t,this.styleRepository);break;case cc.SYMBOL:r=new uht(t,this.styleRepository,this);break;case cc.CIRCLE:r=new hht(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const OSe=new Map;function mht(){OSe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const tSt={value:.5,readOnly:!0},ght={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class kQ{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class yht{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*rR;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),b=Math.floor(y),w=v+b*c,S=h[w],T=h[w+1],E=h[w+c],C=h[w+c+1];if(S+T+E+C<p){const A=m-v,I=y-b,L=qP(S,T,E,C,A,I),D=qP(S,T,E,C,A+f,I),k=qP(S,T,E,C,A,I+f),z=qP(S,T,E,C,A+f,I+f);return s.min=Math.min(L,D,k,z),s.max=Math.max(L,D,k,z),s}m=v,y=b,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let b=y;b<=y+f;b++){const w=h[v+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function RSe(e,t,i){if(M(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Ne(r.dy*(r.y1-t),0,s),o=Ne(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],m=p[h+1],y=h+c,v=p[y],b=p[y+1];if(f+v+m+b<.5*rR){n-=a,o-=l;const w=f+(m-f)*o;return w+(v+(b-v)*o-w)*n}}return null}function br(e,t,i){const r=RSe(e,t,i);return _(r)?r:0}let ph=class extends Ae{constructor(e){super(e),this._handles=new si}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=PSe(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(jO(r))}}),e}};function vht(e,t){return e===Ge.Global?new KH(t):new eq(t)}u([d({readOnly:!0})],ph.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],ph.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],ph.prototype,"stencilEnabledExtents",null),u([d()],ph.prototype,"viewSpatialReference",void 0),u([d()],ph.prototype,"tilingScheme",void 0),u([d()],ph.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],ph.prototype,"layers",void 0),u([d({constructOnly:!0})],ph.prototype,"layerViews",void 0),ph=u([P("esri.views.3d.terrain.ExtentHelper")],ph);let KH=class extends ph{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?E_e:r7e}};KH=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],KH);let eq=class extends ph{_computeLayerViewsExtent(){const e=xc(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=PSe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);Hb(e,o,e)}});const i=W9(e)?e:null,r=this._get("layerViewsExtent");return qb(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=xc();this.layers.forEach(n=>{if(n.loaded&&WM(n)){const o=$k(n,t,Ge.Local);if(M(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(L4(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&Hb(i,l,i)}}),Hb(i,this.defaultTiledLayersExtent,i);const r=W9(i)?i:null,s=this._get("tiledLayersExtent");return qb(r,s)?s:r}};function PSe(e,t){return _(e)&&!e.spatialReference.equals(t)?zme(e,e.spatialReference,t):e}eq=u([P("esri.views.3d.terrain.ExtentHelperLocal")],eq);var Qt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Qt||(Qt={}));const K1=[Qt.ELEVATION,Qt.MAP];function ISe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const _ht=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let qy,ol=class extends Ae{constructor(e){super(e),this._handles=new si,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Wi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ai(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Md({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Wh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ae(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),ae(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Qi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),lw({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,Ls.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(vt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,Ls.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Ls.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(qy)&&(qy.hide(),qy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Vv(-20037508342787e-6,20037508342787e-6):new Vv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,yf)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Ls.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=Vtt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Mm);const r=fu(Mm.inner)/fu(Mm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Fr.INNER,Mm.inner,i,1*Mm.pixelRatioAdjustment,Mm.mapUnitsPerPixel),n=this._updateOverlay(Fr.OUTER,Mm.outer,i,r*Mm.pixelRatioAdjustment,Mm.mapUnitsPerPixel);s!==_f.EXTENT&&n!==_f.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===_f.NONE&&n===_f.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return _f.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,bht(t,n.extent)&&i===n.resolution)return o===s?_f.NONE:_f.RERENDER_ONLY;Xg(n.extent,t),n.resolution=i;const a=GW(n.extent);return n.renderLocalOrigin=pO(a[0],a[1],0,"OV_"+this._latestOriginId++),_f.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Fr.INNER],r=this.renderer.overlays[Fr.OUTER],s=XD(e.extent,this.surface.extent,Wae);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,Fr.INNER,t),this._setTileOverlayData(s,Fr.OUTER,t)):(this._clearTileOverlayData(Fr.INNER,t),this._clearTileOverlayData(Fr.OUTER,t))}else this._clearTileOverlayData(Fr.INNER,t),this._clearTileOverlayData(Fr.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Fr.INNER],i=this.renderer.overlays[Fr.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=fu(r),n=fp(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,fu(e)/s,fp(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){ISe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,xht,t,i);if(M(s))return!1;const n=s.origin,o=pe(G$,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=Ne(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=G$;RE(G5(j5,Ai(this.view.spatialReference).radius+a),Du(e.eye,e.viewForward),c),fe(c,c,e.eye);const h=Bv.normalize(GNe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=vi(0,h,1,0),f=bu(p,p,e.projectionMatrix)[1],m=Ne(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&vW(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=R();this._findHorizonBasedPointOfInterest(e,s)||ne(s,r);const n=Math.max(.1,ur(e.eye,s)),o=o_(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Wi.OVERLAY_SHOW_CENTER?(M(qy)&&(qy=new $0(this.view.graphics,"red")),qy.show(s,this._renderSR)):_(qy)&&qy.hide(),this._overlaySREqualsRenderSR||nn(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/Ai(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,y=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(sF(s[1])),y=l[3]):(m=!0,f/=Ai(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;m&&(v=1/Math.max(.2,Math.cos(Math.abs(Pt(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,S=32,T=.5*t/(S*w),E=.5*t/(S*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*E)/E;const C=i.inner;C[0]=s[0]-w,C[1]=s[1]-f,C[2]=s[0]+w,C[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,y);const A=i.outer;if(6*w>fu(l))Xg(A,l);else if(a<=.25*Math.PI)A[0]=C[0]-w,A[1]=C[1]-f,A[2]=C[2]+w,A[3]=C[3]+f;else{nn(e.eye,this._renderSR,G$,this._spatialReference),Af(a1,s,G$);let L=-Math.atan2(a1[1],a1[0])+.125*Math.PI;L<0&&(L+=2*Math.PI);const D=Math.floor(L/(.25*Math.PI));u3(a1,_ht[D],2*f),a1[0]*=v,a1[2]*=v,bW(A,C,a1)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-y),A[3]=Math.min(A[3],y);else{const L=XD(C,l,Wae),D=XD(A,l,wht);WK(L,D)&&(A[2]=A[0],A[3]=A[1])}const I=Math.abs(C[2]-C[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Fr.INNER],i),n=this._drawOverlay(e[Fr.OUTER],i);s!==V2.CHANGED&&n!==V2.CHANGED||this.surface.updateTileOverlayParams(Ls.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===Ls.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Ls.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!M(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):m3(e,t))}_rectInsideRect(e,t){return!M(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:WK(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),cF(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function bht(e,t){const r=Wi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],ol.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],ol.prototype,"running",null),u([d()],ol.prototype,"_placementDirty",void 0),u([d()],ol.prototype,"_contentUpdated",void 0),u([d()],ol.prototype,"_isSpherical",null),u([d()],ol.prototype,"_worldToPCSRatio",null),u([d()],ol.prototype,"renderer",void 0),u([d({constructOnly:!0})],ol.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],ol.prototype,"suspended",void 0),u([d({readOnly:!0})],ol.prototype,"updating",null),u([d({type:Boolean})],ol.prototype,"hasHighlights",null),u([d({type:Boolean})],ol.prototype,"rendersOccluded",null),ol=u([P("esri.views.3d.terrain.OverlayManager")],ol);const a1=qt(),G$=R(),Mm={inner:Lt(),outer:Lt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Wae=Lt(),wht=Lt(),xht=io();var _f;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(_f||(_f={}));class qR{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!qR.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(qR.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new It({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}qR.test={disabled:!1};class Tht{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=pr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=qt(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class Xae{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*mh;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*mh;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*mh;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*mh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*mh;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*mh;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*mh;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*mh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const Sht=ns().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.NORMAL),zQ=new qR(e=>Sht.createBuffer(e),e=>e.count);function Eht(){zQ.clear()}function $Se(e){return zQ.acquire(e)}function Cht(e){zQ.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class Aht{constructor(){this.sinLonLUT=new Array(kj+1),this.cosLonLUT=new Array(kj+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class j${constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class Mht{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new j$,new j$,new j$,new j$],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class Oht{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Mht}}class e2{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=at(this._current),this._next=at(this._next),this._waiting=at(this._waiting),this._delayed=at(this._delayed)}get current(){if(M(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=e2.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,zg.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Ln.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(at(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(M(this._next))return 1;const t=e2.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=zg.Immediate){this._delayed=at(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),M(this._current))return void(this._current=t);const r=e2.test.fadeMoment||performance.now();return i!==zg.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):M(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(M(t)||(at(this._waiting),this._waiting=t))}get _fadeDuration(){return M(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var zg;e2.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(zg||(zg={}));class DSe{constructor(){this._queue=new It,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class Rht{constructor(){this.q=new It}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!M(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function wO(e,t,i){if(M(t)||M(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function LSe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function NSe(e,t){t.sort((i,r)=>FSe(i,r,e))}function FSe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:LSe(e,t)}function Pht(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||LSe(r,s))}function Iht(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function $ht(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function iSt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class VQ{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Ln.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=ZH(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?wO:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=_(m)?m.tile.level:-1,v=!!_(m)&&y-p>=a,b=en(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const w=h.level,S=p-w,T=h.layerInfo[i][t];if(T.data&&S>=a){(!v||w>y)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((M(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&w<=o&&!T.data&&!T.dataMissing&&((M(f)||h.level===n||w%S_e==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Ln.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class Dht extends VQ{get _desiredMinLevelDelta(){throw Yae}get _progressiveLevelModulo(){throw Yae}dispose(){}}const Yae=new Error("Abstract method called on TileAgent"),Bl=new Dht;class USe extends VQ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return $L(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class kSe extends VQ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return S_e}}var nw,qw;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(nw||(nw={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(qw||(qw={}));var Zae,Fe;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(Zae||(Zae={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Fe||(Fe={}));const hN={normal:Fe.Normal,average:Fe.Average,lighten:Fe.Lighten,lighter:Fe.Lighter,screen:Fe.Screen,plus:Fe.Plus,"color-dodge":Fe.ColorDodge,darken:Fe.Darken,multiply:Fe.Multiply,"color-burn":Fe.ColorBurn,overlay:Fe.Overlay,"soft-light":Fe.SoftLight,"hard-light":Fe.HardLight,"vivid-light":Fe.VividLight,hue:Fe.Hue,saturation:Fe.Saturation,luminosity:Fe.Luminosity,color:Fe.Color,difference:Fe.Difference,exclusion:Fe.Exclusion,minus:Fe.Minus,invert:Fe.Invert,reflect:Fe.Reflect,"destination-over":Fe.DestinationOver,"destination-atop":Fe.DestinationAtop,"destination-in":Fe.DestinationIn,"destination-out":Fe.DestinationOut,"source-atop":Fe.SourceAtop,"source-in":Fe.SourceIn,"source-out":Fe.SourceOut,xor:Fe.Xor};function Lht(e){return e===Fe.DestinationOver||e===Fe.DestinationAtop||e===Fe.DestinationIn||e===Fe.DestinationOut||e===Fe.SourceAtop||e===Fe.SourceIn||e===Fe.SourceOut||e===Fe.Xor}function Nht(e){e.fragment.uniforms.add([new Bt("u_colormap",t=>t.u_colormap),new Xe("u_colormapOffset",t=>t.colormap.u_colormapOffset),new Xe("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new Xe("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function Fht(e){e.fragment.uniforms.add(new Bt("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new mi("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new mi("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new mi("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class zSe extends Bs{constructor(){super(...arguments),this.scale=1,this.offset=Gh}}function VSe(e){e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.vertex.uniforms.add(new Xe("scale",t=>t.scale)),e.vertex.uniforms.add(new mi("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class Uht extends zSe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function kht(e){e.include(Fht),e.fragment.uniforms.add([new Bt("u_image",t=>t.u_image),new Ow("u_flipY",t=>t.common.u_flipY),new Ow("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function BQ(e){e.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var Lo;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Lo||(Lo={}));function BSe(e,t){const i=t.blendMode;i!==Fe.Normal&&(i===Fe.Reflect&&e.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Fe.ColorDodge&&i!==Fe.VividLight||e.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Fe.ColorBurn&&i!==Fe.VividLight||e.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Fe.Overlay&&e.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Fe.HardLight&&e.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Fe.SoftLight&&e.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Fe.VividLight&&e.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Fe.Hue&&i!==Fe.Saturation&&i!==Fe.Color&&i!==Fe.Luminosity||(e.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Fe.Hue&&i!==Fe.Saturation||e.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Fe.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Fe.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Fe.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Fe.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Fe.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Fe.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Fe.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Fe.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Fe.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Fe.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Fe.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Fe.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Fe.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Fe.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var so,yn;function zht(e){const t=new Xi,i=e.output===so.GridOnly,r=e.output===so.GridComposite,s=r||i,n=e.output===so.ColorOnly,o=e.output===so.ColorComposite,a=o||n,l=r||o;if(t.include(VSe),a&&t.fragment.uniforms.add(new Tt("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==yn.One&&t.fragment.uniforms.add(new Xe("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(BQ)),i||n)return t.fragment.code.add(x`
    void main() {
      gl_FragColor = ${n?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Fe.Normal,h=e.baseOpacityMode===yn.OnBaseLayer,p=e.baseOpacityMode===yn.OnBackground||e.baseOpacityMode===yn.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new Bt("tex",m=>m.texture)),t.fragment.uniforms.add(new Xe("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new Bt("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new Xe("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(BSe,e),t.fragment.code.add(x`
    void main() {
      ${l||h||f?x`
      vec4 bgColor = ${o?x`vec4(backgroundColor, 1.0)`:r?x`gridColor(uv)`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?x`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?x`
          vec4 fboTex = ${l?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:x`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?x`mix(bgColor, pmColorLayer, composeAlpha);`:x`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(so||(so={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(yn||(yn={}));const Vht=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return so},get BaseOpacityMode(){return yn},build:zht},Symbol.toStringTag,{value:"Module"}));class Lk extends Uht{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=No,this.fboTexture=null,this.baseOpacity=1}}class Bht extends Lk{}class Ght extends Lk{}function jht(e){const t=new Xi;t.include(VSe),t.include(kht),t.include(Nht),e.tileBlendInput===Lo.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(BQ));const i=e.tileBlendInput===Lo.ColorComposite;i&&t.fragment.uniforms.add(new Tt("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==yn.One&&t.fragment.uniforms.add(new Xe("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===yn.OnBaseLayer,s=e.baseOpacityMode===yn.OnBackground||e.baseOpacityMode===yn.OnBaseLayer,n=e.blendMode!==Fe.Normal;t.fragment.include(BSe,e);const o=e.tileBlendInput!==Lo.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new Bt("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new Xe("tileSize",a=>_(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(x`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?x`
          vec4 bgColor = ${r?x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?x`vec4(backgroundColor, 1.0)`:x`gridColor(vuv)`};
          ${s?x`bgColor *= baseOpacity;`:""}`:""}
      ${n?x`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?x`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:x`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===nw.Stretch?qht(t,e):e.colorizerType===nw.Lut?Hht(t):e.colorizerType===nw.Hillshade&&Wht(t,e),t}function Hht(e){e.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function qht(e,t){e.fragment.uniforms.add([new Y3("u_bandCount",r=>r.symbolizer.u_bandCount),new sa("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new sa("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new sa("u_factor",r=>r.symbolizer.u_factor,3),new Xe("u_minOutput",r=>r.symbolizer.u_minOutput),new Xe("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Ow("u_useGamma",r=>r.symbolizer.u_useGamma),new sa("u_gamma",r=>r.symbolizer.u_gamma,3),new sa("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Xe("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===qw.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Wht(e,t){const i=e.fragment;i.uniforms.add([new Bt("u_image",s=>s.u_image),new Y3("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new sa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new sa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new sa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new sa("u_weights",s=>s.symbolizer.u_weights,6),new mi("u_factor",s=>s.symbolizer.u_factor),new Xe("u_minValue",s=>s.symbolizer.u_minValue),new Xe("u_maxValue",s=>s.symbolizer.u_maxValue),new mi("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(cm),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Xht=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:Lk,ColorizerStretchUniforms:Bht,ColorizerHillshadeUniforms:Ght,build:jht},Symbol.toStringTag,{value:"Module"}));function Yht(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?Et.FLOAT:Et.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===pi.WEBGL2&&s?gt.RGBA32F:ze.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?it.NEAREST:it.LINEAR,dataType:n,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,l,o)}function Zht(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===pi.WEBGL2?gt.RGBA32F:ze.RGBA,dataType:Et.FLOAT,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new ot(e,l,c)}function Qae(e,t){const i={width:t.length/4,height:1,target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,i,t)}function Qht(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Gh,u_transformGridSize:e?e.size:Gh,u_targetImageSize:t,u_srcImageSize:i}}function Jht(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function Kht(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function edt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const Jae={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class tdt{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Je(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?ye(F({},Jae),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||Jae}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?it.LINEAR:it.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Je(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((M(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&M(this._transformGridTexture)&&(this._transformGridTexture=Zht(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=Qht(i,[r,s],[this.source.width,this.source.height],n),a=Jht(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Kht(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?edt(this.symbolizerParameters):null;return new Lk(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(M(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Je(this._rasterTexture),this._transformGridTexture=Je(this._transformGridTexture),this._colormapTexture=Je(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=Je(this._rasterTexture));const s=M(i)&&M(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=Je(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Yht(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=Je(this._colormapTexture),this._colormapTexture=Qae(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=Qae(t,r),void(this._colormap=r)):(this._colormapTexture=Je(this._colormapTexture),void(this._colormap=null))}}class dN{constructor(){this.waitingAgents=new It,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=RB.acquire();return i._init(t),i}release(){this.dispose(),pN.delete(this),RB.release(this)}dispose(){this.loadingAgent=Je(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=KS(this._data)}static prune(){RB.prune(0)}_init(t){this.waitingAgents.clear(),this._data=KS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=zh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||M(i))this._unsetUpsampleInfo();else{if(M(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),Iht(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){KS(this._data),this._data=t}}const RB=new Ts(dN,null,()=>{}),pN=new Map;function idt(){pN.size>0&&(console.log(`${pN.size} live TilePerLayerInfo allocations:`),pN.forEach(e=>console.log(e,`
`)))}class eS{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var bt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(bt||(bt={}));const PB=R(),Jx=R(),zn=R(),rdt=.1;class sdt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class GQ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Lt(),this._elevationBounds=st(),this.layerInfo=[[],[]],this.extentInRadians=Lt(),this.centerAtSeaLevel=R(),this._center=[R(),bn(),R()],this.up=gW(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){jQ.prune(0),HQ.prune(0),dN.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Oa.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===rE.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ai(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Oa.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?co(this._elevationBounds,i.elevationBounds):fi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of K1){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=dN.acquire(this._surface.upsampleInfoPool),s===Qt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,kj)}release(){xf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of K1){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Qt.MAP].reduce((t,i)=>t+(i instanceof bO?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[Qt.MAP])r instanceof bO?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[Qt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Mw(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return r!=null&&r.data?t===Qt.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===Qt.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof eS?Mw(t.texture):t instanceof HTMLImageElement||t instanceof Pk?this.cpuImageMemorySize:t instanceof bO||t instanceof tdt?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[Oa.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return bt.NONE;const s=this.level;fe(PB,this._center[Oa.MIDDLE],i);let n=Fa(PB),o=Oa.MIDDLE;fe(Jx,this._center[Oa.TOP],i);const a=Fa(Jx);a<n&&(n=a,o=Oa.TOP),fe(Jx,this._center[Oa.BOTTOM],i);const l=Fa(Jx);if(l<n&&(n=l,o=Oa.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return bt.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,bt.VSPLITMERGE):bt.NONE_HIT_MAXLOD};if(r===rE.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():bt.SPLIT;const m=Se(this.up,PB),y=this._elevationBounds[1]-this._elevationBounds[0],v=y/this.edgeLen;if(t.aboveGround&&m>0&&v<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return bt.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,bt.VSPLITMERGE):bt.NONE;if(s>=t.maxLod)return f();if(s>6){fe(Jx,this._center[o],i),oe(zn,this.up,m),fe(zn,zn,Jx);const b=Fa(zn);if(b>this.radius*this.radius){oe(zn,zn,this.radius/Math.sqrt(b)),pe(zn,zn,this._center[o]),fe(zn,i,zn);const w=Math.min(1,(Math.abs(Se(zn,this.up))+.5*y+this._curvatureHeight)/Re(zn)),S=rdt/t.angledSplitBias,T=t.fovY*c*2;if(w*(this._edgeLen/T)<S*t.relativeHeightLimit)return bt.NONE}}return bt.SPLIT}setChildren(t,i,r,s){xf(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of K1)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of K1){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Bl&&(H$(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(bt.GEOMETRY),this.resetPendingUpdate(bt.TEXTURE_NOFADING),this.resetPendingUpdate(bt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Qt.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==Bl&&(H$(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(qb(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(bt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of K1){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Bl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(bt.SPLIT)||t!==Qt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===bt.SPLIT||t===bt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;zh(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Fa(fe(zn,this._center[Oa.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;xf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case Qt.MAP:return this._updateTexture(i);case Qt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Ln.FADING?bt.TEXTURE_NOFADING:bt.TEXTURE_FADING),this.setPendingUpdate(t===Ln.FADING?bt.TEXTURE_FADING:bt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(bt.GEOMETRY);for(const t of this.layerInfo[Qt.ELEVATION])t.pendingUpdates|=bt.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;fi(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[Qt.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);oe(zn,this.up,i),pe(this._center[Oa.MIDDLE],this.centerAtSeaLevel,zn),oe(zn,this.up,t[0]),pe(this._center[Oa.TOP],this.centerAtSeaLevel,zn),oe(zn,this.up,t[1]),pe(this._center[Oa.BOTTOM],this.centerAtSeaLevel,zn)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Qt.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Qt.ELEVATION),n=ZH(s);if(!wO(this,n,!1))return;const o=odt;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<$L(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Qt.ELEVATION][t].data,!(!c&&l&&h>=$L(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(M(r.elevationBounds)&&(r.elevationBounds=new kQ),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Bl&&(H$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:dN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Ln.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===Bl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of K1){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Bl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Bl&&this.updateRenderData(t,Ln.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Bl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=Bl,!r.data&&M(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(N4(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=ZH(c);if(a.loadingAgent?wO(this,h,!1)?(a.loadingAgent!==Bl&&a.loadingAgent.setSuspension(n),a.loadingAgent!==Bl&&(l=a.loadingAgent.update())):a.dispose():wO(this,h,!1)&&(a.loadingAgent=ndt(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===Bl&&this.setPendingUpdate(bt.GEOMETRY):(H$(a.loadingAgent),a.loadingAgent=Bl)),a.loadingAgent===Bl&&this.updateRenderData(i,Ln.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,$L(this.level)-i);return Ne(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(adt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?ldt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===kt.NORTH_EAST?1:t===kt.NORTH_WEST?0:t===kt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(F4(t),i)}forAllSubtreeOnSide(t,i){const r=t===kt.NORTH?[0,1]:t===kt.NORTH_EAST?[1]:t===kt.EAST?[1,3]:t===kt.SOUTH_EAST?[3]:t===kt.SOUTH?[2,3]:t===kt.SOUTH_WEST?[2]:t===kt.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){U4.forEach(i=>this.findNeighborCornerTileExact(i,t)),tv.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(uN(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(tv[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=tv[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=uN(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),tv.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;tv.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide(uN(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),U4.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(F4(s),a=>a.isLoaded);!n||cdt(this,n,s),n!=null&&n.isLoaded&&t(n)})}_updateNeighbor(t){t!=null&&t.isLoaded&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=Uae(i)?-1:Fae(i)?1:0,s=Lae(i)?-1:Nae(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Ct>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Uae(t)&&i[3]+s>=r[3]||Fae(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Lae(t)&&i[0]-s<=r[0])&&!(!n&&Nae(t)&&i[2]+s>=r[2])}}function ndt(e,t,i,r){const s=i===Qt.ELEVATION?HQ.acquire():jQ.acquire();return s.init(e,t,i,r),s}function H$(e){e.dispose(),e instanceof USe?HQ.release(e):e instanceof kSe&&jQ.release(e)}const jQ=new Ts(kSe),HQ=new Ts(USe),odt=new kQ;var Oa;function adt(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function ldt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function IB(e,t,i){return Math.abs(e-t)<=i}function cdt(e,t,i){return!M(e)&&!M(t)&&t!==e&&(e.level>=t.level?Kae(e,t,i):Kae(t,e,F4(i)))}function Kae(e,t,i){e.level>=t.level;const r=Nut(i),s=Fut(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=IB(a[0],l[0],c)||e.surface.isGlobal&&IB(a[0],-l[0],c),p=IB(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?ele(o[1],o[3],n[1],n[3],c):ele(o[0],o[2],n[0],n[2],c)}function ele(e,t,i,r,s=Ct){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Oa||(Oa={}));class udt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class Mg{constructor(){this.geometryInfo=new Tht,this.intersectionData=null,this.geometryState=null,this._textureRef=new e2(()=>this.tile.surface.textureFadeDuration),this.overlay=new udt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,pr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Oht,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=tv[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return M((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const m=2**f,y=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,y)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(uN(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(tv[c],i);s[c]=h,n[c]=h!=null&&h.isLoaded?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(U4[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var w,S;const y=f.reduce((T,E)=>{var C;return Math.min(T,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let T=0;T<4;++T){const E=f[(T+3)%4],C=f[T];if(E&&E.level<t.level&&E===C){const A=E,I=(1&T)==1,L=(t.getNeighborEdgeStartVertexIndex(T,A)+(m===0||m===1&&!I||m===3&&I?1:0))/2**(t.level-A.level),D=I?m===0||m===1?A.extent[0]:A.extent[2]:Zt(A.extent[0],A.extent[2],L),k=I?Zt(A.extent[1],A.extent[3],L):m===0||m===3?A.extent[1]:A.extent[3];return br(D,k,A.renderData.geometryState.samplerData)}}let v=0,b=0;for(let T=0;T<4;++T){const E=f[T];if(E&&E.level===y){const C=T===0||T===1,A=T===0||T===3,I=E.extent;b+=br(I[C?0:2],I[A?1:3],(S=(w=E.renderData)==null?void 0:w.geometryState)==null?void 0:S.samplerData),v++}}return v?b/v:0},h=a.cornerNeighborData,p=(f,m)=>{var w;const y=h[f],v=y.cornerTiles;for(let S=0;S<4;++S){const T=U4[S],E=(w=m[S])==null?void 0:w.findCorner(F4(T),C=>(C==null?void 0:C.isLoaded)||C===t);v[S]=E}const b=c(v,f);return y.elevation!==b&&(y.elevation=b,!0)};for(let f=0;f<4;++f){const m=o[f],y=n[f],v=[m,n[(f+1)%4],t,y],b=v.map((w,S)=>v[(S+4-f)%4]);p(f,b)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f!=null&&f.isLoaded)||f.lij[0]>t.lij[0])return null;const y=f.renderData.geometryState;return{neighborSamplerData:y.samplerData,neighborEdgeOverlapResolution:y.neighborData.edgeResolutions[m+2],version:y.samplerDataVersion,neighborVerticesPerSide:y.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const y=h[f],v=y==null?void 0:y.version,b=c(m,f),w=(p=b==null?void 0:b.version)!=null?p:null,S=y!=null!=(b!=null),T=y&&b&&v!==w,E=y&&b&&(y==null?void 0:y.neighborTile)!==(b==null?void 0:b.neighborTile),C=S||T||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&v||(h[f]=b)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,Mg.deferTileNeighborUpdate?Mg.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=Mg.updatedGeometryTiles.get(r)||0;Mg.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),M(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),Uv(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new zs(t,Vi,{geometry:Oc(i.layout)},{geometry:ai.createVertex(t,s.STATIC_DRAW,i.buffer)},ai.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,Cht(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=zg.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Qt.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(_(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[Qt.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Qt.ELEVATION);if(wO(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=uu(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}Mg.updatedGeometryTiles=new Map,Mg.deferTileNeighborUpdate=!1,Mg.neighborTilesToUpdate=new Set;const hdt=65536;function ddt(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===Ch.HAS_SOUTH_POLE||t===Ch.HAS_BOTH_POLES),y=l&&(t===Ch.HAS_NORTH_POLE||t===Ch.HAS_BOTH_POLES),v=6,b=((m?1:0)+(y?1:0))*v*(p+1),w=a.neighborData,S=w.edgeResolutions.reduce((Q,G)=>Q+G+1,0),T=$Se(f+b+S),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T,Ji(E.uvOffsetAndScale,0,0,1,1);const C=T.position.typedBuffer,A=T.uv0.typedBuffer,I=T.normal.typedBuffer,L=E.boundingBox;pr(L);const D=o[0],k=o[1],z=o[2];l1.update(p,s);let V=0;const X=a.samplerData,Y=i.ellipsoid.radius,le=WQ(e),re=h-2,$=r[0],U=r[2],B=r[1],H=r[3];(()=>{for(let Q=1;Q<=re;Q++){const G=Q/p,ee=B*(1-G)+H*G,me=le(G),_e=Math.cos(me),Me=Math.sin(me);for(let ve=1;ve<=re;ve++){const ge=ve/p,Ce=$*(1-ge)+U*ge,$e=l1.sinLonLUT[ve],gi=l1.cosLonLUT[ve],wi=Y+br(Ce,ee,X),Ht=gi*_e*wi-D,xi=$e*_e*wi-k,Yt=Me*wi-z;Vg(Ht,xi,Yt,L);const Ti=mh*V;C[Ti+0]=Ht,C[Ti+1]=xi,C[Ti+2]=Yt,A[Ti+0]=ge,A[Ti+1]=G,++V}}})(),c&&(()=>{const Q=ve=>(fe(Bg,ve,$B),lt(aE,Bg,Nv),lt(lE,aE,Bg),lE),G=T.position,ee=T.normal;V=0;const me=ve=>{G.getVec(ve,gc),pe(hs,hs,Q(gc))},_e=(ve,ge)=>{{const Ce=ve/p,$e=$*(1-Ce)+U*Ce,gi=l1.sinLonLUT[ve],wi=l1.cosLonLUT[ve],Ht=ge/p,xi=B*(1-Ht)+H*Ht,Yt=le(Ht),Ti=Math.cos(Yt),mr=Math.sin(Yt),Or=Y+br($e,xi,X);ie(gc,wi*Ti*Or-D,gi*Ti*Or-k,mr*Or-z)}pe(hs,hs,Q(gc))},Me=(ve,ge,Ce)=>{ve>1&&ge>1&&ve<re&&ge<re?me(V+Ce):_e(ve,ge)};for(let ve=1;ve<=re;ve++)for(let ge=1;ge<=re;ge++)G.getVec(V,$B),pe(Of,$B,e.localOrigin),we(Nv,Of),ie(hs,0,0,0),Me(ge-1,ve,-1),Me(ge+1,ve,1),Me(ge,ve-1,-re),Me(ge,ve+1,+re),we(hs,hs),ee.setVec(V,hs),++V})(),V=f,jSe(e,f),ZSe(e),V=f+S;const W=[];(()=>{const Q=(G,ee)=>{const me=ee*h;Vg(-D,-k,G*Y-z,L),W.push({connectedRowOffset:me,connectedOuterEdgeOffset:G===1?0:2,rowOffset:V,latitudeResolution:v});const _e=JSe(G===-1?B:H,Y),Me=G*Math.PI/2-_e,ve=.99*(G===1?1:-1),ge=Y+0;for(let Ce=1;Ce<=v;++Ce){const $e=_e+Me*(Ce/v),gi=Math.cos($e),wi=Math.sin($e);for(let Ht=0;Ht<=p;Ht++){const xi=Ht/p,Yt=l1.sinLonLUT[Ht],Ti=l1.cosLonLUT[Ht]*gi*ge-D,mr=Yt*gi*ge-k,Or=wi*ge-z;Vg(Ti,mr,Or,L);const Qe=mh*V;if(C[Qe+0]=Ti,C[Qe+1]=mr,C[Qe+2]=Or,A[Qe+0]=xi,A[Qe+1]=ve,c){const Gi=1/Math.sqrt(Ti*Ti+mr*mr+Or*Or);I[Qe+0]=Gi*Ti,I[Qe+1]=Gi*mr,I[Qe+2]=Gi*Or}++V}}};m&&Q(-1,0),y&&Q(1,p)})(),GSe(E,a.numVerticesPerSide,W,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let Q=0;Q<4;++Q)E.outerEdges[Q].count,w.edgeResolutions[Q]+1}function pdt(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,f=r[3]-h,m=n.clippingArea,y=_(m)?Math.max(0,(m[0]-r[0])/p):0,v=_(m)?Math.max(0,(m[1]-r[1])/f):0,b=_(m)?Math.min(1,(m[2]-r[0])/p):1,w=_(m)?Math.min(1,(m[3]-r[1])/f):1,S=b-y,T=w-v,E=S>0?1/S:1,C=T>0?1/T:1,A=-y*E,I=-v*C,L=n.numVerticesPerSide,D=L-1,k=(L-2)**2+n.neighborData.edgeResolutions.reduce((_e,Me)=>_e+Me+1,0),z=$Se(k),V=z.position.typedBuffer,X=z.uv0.typedBuffer,Y=z.normal.typedBuffer,le=e.geometryInfo,re=le.boundingBox;pr(re);let $=0;const U=i.ellipsoid.radius,B=n.samplerData,H=_(m)?m:i2e,W=BW(Math.max(r[0],H[0]),Math.max(r[1],H[1]),Math.min(r[2],H[2]),Math.min(r[3],H[3])),Q=s[0],G=s[1],ee=s[2],me=iP(a,U,t);(()=>{for(let _e=1;_e<=D-1;_e++){const Me=_e/D,ve=I+Me*C,ge=Ne(h+Me*f,W[1],W[3]),Ce=Ne(ve,0,1),$e=me(ge)-G,gi=p/D;for(let wi=1;wi<=D-1;wi++){const Ht=wi/D,xi=A+Ht*E,Yt=Ne(c+Ht*p,W[0],W[2]),Ti=Ne(xi,0,1),mr=br(Yt,ge,B),Or=Yt*t-Q,Qe=mr-ee;Vg(Or,$e,Qe,re);const Gi=mh*$;if(V[Gi+0]=Or,V[Gi+1]=$e,V[Gi+2]=Qe,X[Gi+0]=Ti,X[Gi+1]=Ce,l){const os=br(Yt+gi,ge,B),ln=br(Yt-gi,ge,B),Gs=br(Yt,ge+gi,B),ko=.25*(ln-os),zo=.25*(br(Yt,ge-gi,B)-Gs),js=gi,Rc=Math.sqrt(ko*ko+zo*zo+js*js);Y[Gi+0]=ko/Rc,Y[Gi+1]=zo/Rc,Y[Gi+2]=js/Rc}++$}}})(),le.numVerticesPerSide=n.numVerticesPerSide,le.vertexAttributes=z,Ji(e.geometryInfo.uvOffsetAndScale,y,v,b-y,w-v),jSe(e,$),HSe(e,t),$=k,GSe(le,n.numVerticesPerSide,[],[0,L-1],[0,L-1],n.wireframe),e.intersectionData=null}function GSe(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=tv.map((w,S)=>S===0&&s[1]<t-2||S===1&&r[1]<t-2||S===2&&s[0]>1||S===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((w,S,T)=>w+(c[T]?0:o-2+S.count-1),0)+i.reduce((w,S)=>w+o*(2*(S.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>hdt?Uint32Array:Uint16Array)(h);let f=0;const m=n?(w,S,T)=>{p[f++]=w,p[f++]=S,p[f++]=S,p[f++]=T,p[f++]=T,p[f++]=w}:(w,S,T)=>{p[f++]=w,p[f++]=S,p[f++]=T},y=t-2,v=o-2;(()=>{for(let w=Math.max(s[0],1)-1;w<Math.min(s[1],t-2)-1;++w)for(let S=Math.max(r[0],1)-1;S<Math.min(r[1],t-2)-1;++S){const T=w*y+S,E=T+1,C=E+y,A=C-1;m(T,E,C),m(C,A,T)}})(),(()=>{for(let w=0;w<4;++w){if(c[w])continue;const S=e.outerEdges[w],T=e.innerEdges[w];let E=0,C=0;const A=S.count,I=T.count;S.count;const L=w===1||w===2?(D,k,z)=>m(D,k,z):(D,k,z)=>m(D,z,k);for(;E<A-1||C<I-1;){const D=T.getVertexOffset(C),k=S.getVertexOffset(E),z=E<A-1,V=C<I-1,X=z?0+o*(E+.5)/(A-1):0,Y=V?1+v*(C+.5)/(I-1):0;z&&(!V||X<=Y)?(++E,L(D,k,S.getVertexOffset(E))):(++C,L(D,k,T.getVertexOffset(C)))}}})();const b=w=>{let S=e.outerEdges[w.connectedOuterEdgeOffset].offset0;for(let T=0;T<w.latitudeResolution;++T){const E=T===0?w.rowOffset:S+t;for(let C=0;C<o;C++)m(S,S+1,E+C),T<w.latitudeResolution-1&&m(S+1,E+C+1,E+C),++S;S=E}};i.forEach(b),e.indices=p,e.indexCount=h}function jSe(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new Xae(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new Xae(o,i,c,1,h),a+=h}}}function fdt(e){var r,s;WSe(e),KSe(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function mdt(e){ZSe(e),qQ(e)}function gdt(e,t){XSe(e,t),e2e(e,t),qQ(e)}function ydt(e,t){HSe(e,t),qQ(e)}function HSe(e,t){XSe(e,t),Sdt(e,t),e2e(e,t)}function qSe(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function vdt(e,t,i,r,s,n){const o=s[i===0?1:3];qSe(e,s[t===0?0:2],o,r,n)}function _dt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function bdt(e,t){return e*t}function iP(e,t,i){return e?r=>_dt(r,t):r=>bdt(r,i)}function wdt(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function xdt(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=_t(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],y=f>0?1/f:1,v=m>0?1/m:1,b=-h*y,w=-p*v,S=r.surface.isWebMercatorOnPlateeCarree,T=iP(S,S?r.ellipsoid.radius:0,t),E=i.samplerData,C=i.neighborData.edgeNeighbours,A=e.localOrigin,I=(L,D,k,z,V)=>{const X=s[0]*(1-z)+s[2]*z,Y=s[1]*(1-V)+s[3]*V,le=Ne(X,n[0],n[2]),re=Ne(Y,n[1],n[3]),$=[re===s[3],le===s[2],re===s[1],le===s[0]],U=!$[3]&&!$[1]||!$[0]&&!$[2],B=U?$[0]&&_(C[0])?C[0]:$[1]&&_(C[1])?C[1]:$[2]&&_(C[2])?C[2]:$[3]&&_(C[3])?C[3]:null:null,H=U?B?B.neighborTile.level===r.level?.5*(br(le,re,E)+br(le,re,B.neighborSamplerData)):br(le,re,B.neighborSamplerData):br(le,re,E):c[k].elevation,W=le*t-A[0],Q=T(re)-A[1],G=H-A[2];Vg(W,Q,G,a);const ee=Ne(b+z*y,0,1),me=Ne(w+V*v,0,1);L.setVertexRawXYZUV(D,W,Q,G,ee,me)};for(let L=0;L<4;++L){const D=l[L];I(D,0,L===0?3:L===1?1:2,L===1?1:0,L===0?1:0);const k=L===2?1:L===3?3:0,z=L===3?0:1,V=L===2?0:1;I(D,D.count-1,k,z,V)}}function WSe(e){YSe(e,(t,i,r,s)=>vdt(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function XSe(e,t){const i=e.tile;_(i.renderData.geometryState.clippingArea)?xdt(e,t):YSe(e,(r,s,n,o)=>wdt(r,s,n,o,e.tile.extent,t,iP(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function YSe(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(Wy,h,p,s[c].elevation);for(let m=0;m<3;++m)Wy[m]-=o[m];Vg(Wy[0],Wy[1],Wy[2],n),l.setVertexRawXYZUV(f,Wy[0],Wy[1],Wy[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function qQ(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function ZSe(e){WSe(e);for(let t=0;t<4;++t)Tdt(e,t);KSe(e)}function Tdt(e,t){var lP,cP,uP;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=WQ(e),m=Di=>{if(!Di)return 0;const Vo=v,po=b?0:1,Fl=Di.lij[po+1]*D,S_=s.lij[po+1]-Fl;return(b?D-1-S_:S_)*Vo},y=r.edgeNeighbours[t],v=r.edgeResolutions[t],b=t===1||t===3,w=t===1?1:0,S=t===0?1:0,T=n[0]+w*o,E=n[1]+S*a,C=c*(1-w)+h*w,A=f(S),I=y==null?void 0:y.neighborTile,L=s.level-((lP=I==null?void 0:I.level)!=null?lP:s.level),D=2**L,k=v*D,z=m(I),V=I==null?void 0:I.extent,X=(t+2)%4,Y=i.samplerData,le=(uP=(cP=I==null?void 0:I.renderData)==null?void 0:cP.geometryState)==null?void 0:uP.samplerData,re=I&&L===0,$=(Di,Vo,po,Fl)=>.5*(br(Di,Vo,le)+br(po,Fl,Y)),U=(Di,Vo)=>br(Di,Vo,le),B=re?$:U;let H=V?X===1?V[2]:V[0]:T,W=V?X===0?V[3]:V[1]:E;const Q=(Di,Vo,po)=>{const Fl=(z+Di)/k;return W=V[1]*(1-Fl)+V[3]*Fl,B(H,W,Vo,po)},G=(Di,Vo,po)=>{const Fl=(z+Di)/k;return H=V[0]*(1-Fl)+V[2]*Fl,B(H,W,Vo,po)},ee=I?b?Q:G:(Di,Vo,po)=>br(Vo,po,Y),me=(Di,Vo,po)=>ee(Di,Vo,po);let _e=w,Me=T,ve=C,ge=S,Ce=E,$e=A,gi=Math.sin(ve),wi=Math.cos(ve),Ht=Math.cos($e),xi=Math.sin($e);const Yt=b?()=>f(ge):()=>A,Ti=b?Di=>{ge=Di,Ce=n[1]*(1-Di)+n[3]*Di,$e=Yt(),Ht=Math.cos($e),xi=Math.sin($e)}:Di=>{_e=Di,Me=n[0]*(1-Di)+n[2]*Di,ve=c*(1-_e)+h*_e,gi=Math.sin(ve),wi=Math.cos(ve)},mr=e.geometryInfo,Or=mr.boundingBox,Qe=mr.vertexAttributes,Gi=Qe.position.typedBuffer,os=Qe.uv0.typedBuffer,ln=Qe.normal.typedBuffer,Gs=mr.outerEdges[t];let ko=Gs.getVertexOffset(1);const zo=v+1,js=e.localOrigin,Rc=js[0],fm=js[1],Lr=js[2],sP=s.surface.shadingEnabled,nP=t===1?-1:t===3?1:0,oP=t===0?-1:t===2?1:0,aP=o/v,nz=nP*aP,oz=oP*aP,az=nP*(1/v),lz=oP*(1/v),XE=Di=>{bc(Bg,Di,Of),lt(aE,Bg,Nv),lt(lE,aE,Bg),pe(hs,hs,lE)};for(let Di=1;Di<zo-1;++Di){Ti(Di/v);const Vo=me(Di,Me,Ce),po=p+Vo,Fl=wi*Ht*po,S_=gi*Ht*po,hP=xi*po,dP=Fl-Rc,pP=S_-fm,fP=hP-Lr;Vg(dP,pP,fP,Or);const xp=mh*ko;if(Gi[xp+0]=dP,Gi[xp+1]=pP,Gi[xp+2]=fP,os[xp+0]=_e,os[xp+1]=ge,sP){ie(hs,0,0,0),ie(Of,Fl,S_,hP),we(Nv,Of);const ue=(Rr,hx)=>{const ku=br(Me+Rr*nz,Ce+Rr*oz,hx),E_=p+ku,ut=_e+Rr*az,C_=c*(1-ut)+h*ut,wn=Math.sin(C_),A_=Math.cos(C_),mP=f(ge+Rr*lz),td=Math.sin(mP),YE=Math.cos(mP),gP=Ue(A_*YE*E_,wn*YE*E_,td*E_);XE(gP)};I&&ue(-1,le),I&&!re||ue(1,Y),ln[xp+0]=hs[0],ln[xp+1]=hs[1],ln[xp+2]=hs[2]}++ko}if(sP)for(let Di=1;Di<zo-1;++Di)Gs.getVertexRawNormal(hs,Di),Gs.getVertex(Of,Di),we(Nv,Of),Gs.getVertex(gc,Di-1),XE(gc),Gs.getVertex(gc,Di+1),XE(gc),we(hs,hs),Gs.setVertexRawNormal(Di,hs[0],hs[1],hs[2])}function Sdt(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=_(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?Cdt:Edt;for(let n=0;n<4;++n)s(e,n,t)}function QSe(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>br(a,l,i):null:o===n&&e?(a,l)=>br(a,l,r):null}function k4(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function Edt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=p+1,v=c,b=e.localOrigin,w=m.samplerData,S=(G,ee)=>br(G,ee,w),T=(G,ee)=>.5*(br(G,ee,v.neighborSamplerData)+br(G,ee,w)),E=(G,ee)=>br(G,ee,v.neighborSamplerData),C=(v==null?void 0:v.neighborTile.level)===o,A=C?T:E,I=_(v)?A:S,L=e.geometryInfo,D=L.outerEdges[t],k=iP(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),z=L.boundingBox,V=t===1||t===3,X=t===1?f[2]:f[0],Y=t===0?f[3]:f[1],le=t===1?1:0,re=t===0?1:0,$=(f[2]-f[0])/h,U=v==null?void 0:v.neighborSamplerData,B=_(v),H=(G,ee)=>QSe(B,C,w,U,G,ee,t),W=k4(V,!0,$,H),Q=k4(V,!1,$,H);for(let G=1;G<y-1;++G){const ee=G/p,me=V?X:f[0]*(1-ee)+f[2]*ee,_e=V?f[1]*(1-ee)+f[3]*ee:Y,Me=V?le:ee,ve=V?ee:re,ge=I(me,_e),Ce=me*i-b[0],$e=k(_e)-b[1],gi=ge-b[2];if(Vg(Ce,$e,gi,z),l){const wi=W(me,_e,ge),Ht=Q(me,_e,ge),xi=$;D.setVertexRawXYZUVN(G,Ce,$e,gi,Me,ve,wi,Ht,xi)}else D.setVertexRawXYZUV(G,Ce,$e,gi,Me,ve)}if(l){const G=V?0:1,ee=V?1:0;for(let me=1;me<y-1;++me){D.getNormal(t2,me);const _e=D.getVertexZ(me-1)-D.getVertexZ(me+1),Me=t2[0]+.5*G*_e,ve=t2[1]+.5*ee*_e,ge=2*$,Ce=1/Math.sqrt(Me*Me+ve*ve+ge*ge);D.setVertexRawNormal(me,Ce*Me,Ce*ve,Ce*ge)}}}function Cdt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=_t(m.clippingArea,i2e),v=e.geometryInfo,b=v.uvOffsetAndScale[0],w=v.uvOffsetAndScale[1],S=b+v.uvOffsetAndScale[2],T=w+v.uvOffsetAndScale[3],E=S>b?1/(S-b):1,C=T>w?1/(T-w):1,A=-b*E,I=-w*C,L=p+1,D=[f[3]>y[3],f[2]>y[2],f[1]<y[1],f[0]<y[0]],k=c,z=m.samplerData,V=(Ht,xi)=>br(Ht,xi,z),X=(k==null?void 0:k.neighborTile.level)===o,Y=(Ht,xi)=>{const Yt=br(Ht,xi,k.neighborSamplerData);return X?.5*(Yt+br(Ht,xi,z)):Yt},le=V,re=_(k)?Y:V,$=D[t]?le:re,U=v.outerEdges[t],B=v.boundingBox,H=t===1||t===3,W=Ne(t===1?f[2]:f[0],y[0],y[2]),Q=Ne(t===0?f[3]:f[1],y[1],y[3]),G=t===1?1:0,ee=t===0?1:0,me=e.localOrigin,_e=iP(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),Me=(f[2]-f[0])/h,ve=k==null?void 0:k.neighborSamplerData,ge=_(k),Ce=(k==null?void 0:k.neighborTile.level)===o,$e=(Ht,xi)=>QSe(ge,Ce,z,ve,Ht,xi,t),gi=k4(H,!0,Me,$e),wi=k4(H,!1,Me,$e);for(let Ht=1;Ht<L-1;++Ht){const xi=Ht/p,Yt=H?W:Ne(f[0]*(1-xi)+f[2]*xi,y[0],y[2]),Ti=H?Ne(f[1]*(1-xi)+f[3]*xi,y[1],y[3]):Q,mr=H?G:Ne(A+xi*E,0,1),Or=H?Ne(I+xi*C,0,1):ee,Qe=$(Yt,Ti),Gi=Yt*i-me[0],os=_e(Ti)-me[1],ln=Qe-me[2];if(Vg(Gi,os,ln,B),l){const Gs=gi(Yt,Ti,Qe),ko=wi(Yt,Ti,Qe),zo=Me;U.setVertexRawXYZUVN(Ht,Gi,os,ln,mr,Or,Gs,ko,zo)}else U.setVertexRawXYZUV(Ht,Gi,os,ln,mr,Or)}if(l){const Ht=H?0:1,xi=H?1:0;for(let Yt=1;Yt<L-1;++Yt){U.getNormal(t2,Yt);const Ti=U.getVertexZ(Yt-1)-U.getVertexZ(Yt+1),mr=t2[0]+.5*Ht*Ti,Or=t2[1]+.5*xi*Ti,Qe=2*Me,Gi=1/Math.sqrt(mr*mr+Or*Or+Qe*Qe);U.setVertexRawNormal(Yt,Gi*mr,Gi*Or,Gi*Qe)}}}function JSe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Adt(e,t,i,r){return JSe(e+r*(t-e),i)}function Mdt(e,t,i){return e*(1-i)+t*i}function WQ(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>Adt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>Mdt(i[1],i[3],r)}function KSe(e){e.tile.surface.shadingEnabled&&t2e(e,(t,i,r,s,n,o,a)=>Odt(i,t,r,s,n,o,a))}function e2e(e,t){e.tile.surface.shadingEnabled&&t2e(e,(i,r,s,n,o,a,l)=>Rdt(Idt(e,t),i,s,o,a,l))}function Odt(e,t,i,r,s,n,o){Pdt(e,gc,s,n,o),bc(Bg,gc,i),lt(aE,Bg,r),lt(t,aE,Bg)}function Rdt(e,t,i,r,s,n){e(gc,r,s,n);const o=gc[0]-i[0],a=gc[1]-i[1],l=gc[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function Pdt(e,t,i,r,s){const n=WQ(e),o=e.tile,a=o.extent;OA(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;qSe(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function Idt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>Ddt(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>$dt(t,i,r,s,n)}function $dt(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function Ddt(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function t2e(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&ie(Nv,0,0,1);{const a=(v,b,w,S)=>{t(lE,v.renderData,Of,Nv,b,w,S),pe(hs,hs,lE)},c=(v,b,w,S,T,E)=>{const C=E===1?T.extent[0]:E===3?T.extent[2]:v,A=E===0?T.extent[1]:E===2?T.extent[3]:b,I=C+Kx[w][0]*S,L=A+Kx[w][1]*S;OA(T.extent,I,L,1);const D=br(I,L,T.renderData.geometryState.samplerData);a(T,I,L,D)},h=(v,b,w)=>v.extent[b===0||b===1?2:0]+w,p=(v,b,w)=>v.extent[b===0||b===3?3:1]+w,f=(v,b,w,S)=>{const T=h(w,S,Kx[v][0]*b),E=p(w,S,Kx[v][1]*b);OA(w.extent,T,E,1);const C=br(T,E,w.renderData.geometryState.samplerData);a(w,T,E,C)},m=(v,b,w,S,T,E)=>{const C=Kx[v][0]*b,A=Kx[v][1]*b,I=h(w,S,C),L=p(w,S,A),D=h(T,E,C),k=p(T,E,A);OA(w.extent,I,L,1),OA(T.extent,D,k,1);const z=br(I,L,w.renderData.geometryState.samplerData),V=br(D,k,T.renderData.geometryState.samplerData);a(w,I,L,.5*(z+V))},y=v=>{const b=v===0||v===1?s[2]:s[0],w=v===0||v===3?s[3]:s[1],S=i[v].cornerTiles,T=S.reduce((E,C)=>{var A;return Math.min(E,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let E=0;E<4;++E){const C=S[E];Xy[E]=(C==null?void 0:C.level)===T?C:null}for(let E=0;E<4;++E){const C=Xy[(E+3)%4],A=Xy[E];if(C!=null&&C!==r&&C===A){const I=C,L=(E+2)%4,D=I.renderData.geometryState.neighborData.edgeResolutions[L],k=Math.max(D,2**(r.level-I.level)),z=(I.extent[2]-I.extent[0])/k,V=(E+0)%4,X=(E+1)%4;return c(b,w,(E+3)%4,z,I,E),c(b,w,V,z,I,E),c(b,w,X,z,I,E),hs}}{Xy.some(C=>(C==null?void 0:C.isLoaded)||C===r);const E=Xy.reduce((C,A)=>A?A.extent[2]-A.extent[0]:C,0)/Xy.reduce((C,A)=>{var I;return Math.max(C,(I=A==null?void 0:A.renderData.geometryState.numVerticesPerSide)!=null?I:1)},1);for(let C=0;C<4;++C){const A=Xy[(C+3)%4],I=Xy[(C+0)%4];if(!A&&!I)continue;const L=C===0?1:C===1?2:C===2?3:0,D=C===0?2:C===1?3:C===2?0:1;A&&I?m(C,E,A,L,I,D):f(C,E,A!=null?A:I,A?L:D)}}return hs};for(let v=0;v<4;++v){const b=e.geometryInfo.outerEdges[v],w=v===1||v===2?0:b.count-1;b.getVertex(Of,w),n||we(Nv,Of),ie(hs,0,0,0);const S=y(v);we(DB[v],S)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=DB[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=DB[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function Vg(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const Kx=[[0,1],[1,0],[0,-1],[-1,0]],l1=new Aht,i2e=BW(-1/0,-1/0,1/0,1/0),Wy=R(),gc=R(),Bg=R(),aE=R(),lE=R(),Of=R(),$B=R(),Nv=R(),hs=R(),t2=R(),DB=[R(),R(),R(),R()],Xy=[null,null,null,null];class Ldt extends GQ{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=Lt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&UO(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ue(c[0],c[1],0);nn(h,Ze.WebMercator,h,Ze.PlateCarree);const p=Ue(c[2],c[3],0);nn(p,Ze.WebMercator,p,Ze.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Oa.MIDDLE][3]=o}_isVisible(t){return sZe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return Y$e(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return q$[0]=1/i[0],q$[1]=1/i[1],q$[2]=1/i[2],XZ(this._aabb(),t,q$,r,s)}createGeometry(){pdt(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){gdt(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){ydt(this.renderData,this.horizontalScaleFactor)}}const q$=R();var WR;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(WR||(WR={}));class Ndt extends GQ{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=R();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=Zt(o,l,.5),p=Zt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),aC(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=dl(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)ie(this._center[Dd.MIDDLE],0,0,0),ie(this._center[Dd.TOP],0,0,0),ie(this._center[Dd.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ai(this.surface.spatialReference)),this._center[Dd.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(_n(this._center[Dd.MIDDLE],this.obb[0]),_n(this._center[Dd.MIDDLE],this.obb[1]));this._center[Dd.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!vv(t,this._center[Dd.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<iy.NUM;r++){const s=r===ar.NEAR,n=t[r];s&&(JC[0]=n[0],JC[1]=n[1],JC[2]=n[2],JC[3]=n[3]-this.surface.view.state.camera.near);const o=s?JC:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);ddt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;aC(i[n++],t[0],t[1],this.ellipsoid.radius+s),aC(i[n++],t[0],t[3],this.ellipsoid.radius+s),aC(i[n++],t[2],t[3],this.ellipsoid.radius+s),aC(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ch.HAS_NORTH_POLE:ie(i[1],0,0,this.ellipsoid.radius),ie(i[2],0,0,this.ellipsoid.radius),ie(i[5],0,0,this.ellipsoid.radius),ie(i[6],0,0,this.ellipsoid.radius);break;case Ch.HAS_SOUTH_POLE:ie(i[0],0,0,-this.ellipsoid.radius),ie(i[3],0,0,-this.ellipsoid.radius),ie(i[4],0,0,-this.ellipsoid.radius),ie(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?Ch.HAS_BOTH_POLES:Ch.HAS_SOUTH_POLE:t===0?Ch.HAS_NORTH_POLE:Ch.REGULAR}intersectsRay(t,i,r,s){const n=this._center[Dd.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<tle.length?tle[this.level]+1:2}updateCornerElevations(){fdt(this.renderData)}updateEdgeElevations(){mdt(this.renderData)}}const tle=[128,64,32,16,16,8,8,4],JC=Ei();var Dd;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Dd||(Dd={}));class Fdt{constructor(){this.extent=qt(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class Udt{constructor(){this._queries=new It({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new It({initialSize:30}),this._queryPool=new Ts(Fdt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();Zd(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class XQ extends Ha{constructor(){super(...arguments),this.blendMode=Fe.Normal}}u([j({count:Fe.COUNT})],XQ.prototype,"blendMode",void 0);class kdt extends zSe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Fe.Normal,this.backgroundColor=No}}class Nk extends dr{initializeProgram(t){const i=Nk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}Nk.shader=new rr(Vht,()=>import("./BlendLayers.glsl.cba3f5cb.js"));class fN extends XQ{constructor(){super(...arguments),this.output=so.Composite,this.baseOpacityMode=yn.One,this.premultipliedSource=!1}}u([j({count:so.COUNT})],fN.prototype,"output",void 0),u([j({count:yn.COUNT})],fN.prototype,"baseOpacityMode",void 0),u([j()],fN.prototype,"premultipliedSource",void 0);class LB{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=vi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ue(s,o,n)}destroy(){this.texture.release()}}function mN(){return[1,0,0,1,0,0]}function zdt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Vdt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function Bdt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:mN,clone:zdt,fromValues:Vdt,createView:Bdt},Symbol.toStringTag,{value:"Module"}));function Gdt(e){return e instanceof Float32Array&&e.length>=2}function jdt(e){return Array.isArray(e)&&e.length>=2}function NB(e){return Gdt(e)||jdt(e)}const Hdt=96,qdt=39.37;function YQ(e,t){return t.type?fi(e,t.x,t.y):co(e,t)}function Wdt(e){return Nl(e)}function Xdt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Ydt=function(){const e=st();return function(t,i,r){const s=i.targetGeometry;YQ(e,s);const n=.5*Fk(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function Fk(e){return e.scale*Zdt(e.targetGeometry)}function Zdt(e){return _(e)&&Ml(e.spatialReference)?1/(Wdt(e.spatialReference)*qdt*Hdt):1}function Qdt(e){return c3(e.rotation)||0}const ZQ=function(){const e=st(),t=st(),i=st();return function(r,s,n,o,a,l){return WY(e,s),pc(t,n,.5*l),fi(i,1/o*l,-1/o*l),zY(r,t),a&&UY(r,r,a),p_e(r,r,i),kY(r,r,e),r}}(),Jdt=function(){const e=st();return function(t,i,r,s){const n=Fk(i),o=Qdt(i);return YQ(e,i.targetGeometry),ZQ(t,e,r,n,o,s)}}(),Kdt=function(){const e=st();return function(t,i,r,s){const n=Fk(i);return YQ(e,i.targetGeometry),ZQ(t,e,r,n,0,s)}}();function ept(e){const t=Rg(e);return t?t.valid[1]-t.valid[0]:0}function tpt(e,t){return Math.round(ept(e)/t)}var tq;const Om=[0,0];let D0=tq=class extends xe{constructor(e){super(e),this._viewpoint2D={center:st(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Xt,this.id=0,this.inverseTransform=mN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=mN(),this.transformNoRotation=mN(),this.displayMat3=kg(),this.displayViewMat3=kg(),this.viewMat3=kg(),this.viewMat2d=c_e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Xdt(i,e.viewpoint),this._set("size",co(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new tq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return NB(t)?q1(e,t,this.inverseTransform):(Om[0]=t,Om[1]=i,q1(e,Om,this.inverseTransform))}toScreen(e,t,i){return NB(t)?q1(e,t,this.transform):(Om[0]=t,Om[1]=i,q1(e,Om,this.transform))}toScreenNoRotation(e,t,i){return NB(t)?q1(e,t,this.transformNoRotation):(Om[0]=t,Om[1]=i,q1(e,Om,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return ZQ(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Bh({targetGeometry:new qe(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=Fk(o),this.rotation=r,this.scale=i,this.spatialReference=t,co(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;lZ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=cZ(this.viewMat3),h=La(n[0]/2,n[1]/2),p=La(-n[0]/2,-n[1]/2),f=c3(r);XF(c,c,h),uZ(c,c,f),XF(c,c,p),CU(this.displayViewMat3,this.displayMat3,c);const m=zY(this.viewMat2d,h);return UY(m,m,f),kY(m,m,p),Ydt(this.extent,o,n),Jdt(this.transform,o,n,s),h_e(this.inverseTransform,this.transform),Kdt(this.transformNoRotation,o,n,s),this.worldScreenWidth=tpt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],D0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],D0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],D0.prototype,"size",null),u([d()],D0.prototype,"spatialReference",void 0),u([d({type:Bh,json:{write:!0}})],D0.prototype,"viewpoint",null),D0=tq=u([P("esri.views.2d.ViewState")],D0);const ipt=D0,rpt=.125;class spt{constructor(){this._renderParams={context:null,drawPhase:1,state:new ipt({viewpoint:new Bh({targetGeometry:new qe(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,v]=o.getShift(i,a*m),b=rpt*a*m/c,w=r.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-y-l[0]*a*2,w[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class Uk extends dr{initializeProgram(t){const i=Uk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}Uk.shader=new rr(Xht,()=>import("./RasterColorizer.glsl.1782f2a7.js"));class tS extends XQ{constructor(){super(...arguments),this.colorizerType=nw.Stretch,this.stretchType=qw.Noop,this.tileBlendInput=Lo.LayerOnly,this.baseOpacityMode=yn.One,this.applyColormap=!0}}u([j({count:nw.COUNT})],tS.prototype,"colorizerType",void 0),u([j({count:qw.COUNT})],tS.prototype,"stretchType",void 0),u([j({count:Lo.COUNT})],tS.prototype,"tileBlendInput",void 0),u([j({count:yn.COUNT})],tS.prototype,"baseOpacityMode",void 0),u([j()],tS.prototype,"applyColormap",void 0);class ile{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=rle.bind(rle,this._rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new Ts(r,null,()=>{}),this._pools.set(t,i)}return i}}class rle extends Cr{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const npt=de.getLogger("esri.views.3d.terrain");class opt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new spt,this._bindParameters=new OU(null,null,null),this._blendLayersTechniqueConfig=new fN,this._poolToWrite=0,this._vaoQuad=qa(this._rctx,I3),this._fboPools.push(new ile(this._rctx)),this._fboPools.push(new ile(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Je(t)),this._vaoQuad=Je(this._vaoQuad),this._vectorTileHelper=Je(this._vectorTileHelper),this._backgroundTechnique=Hi(this._backgroundTechnique),this._applyOpacityTechnique=Hi(this._applyOpacityTechnique),this._blendLayersTechnique=Hi(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===so.Composite?yn.OnBaseLayer:yn.OnBackground:yn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Nk,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Fe.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays($t.TRIANGLE_STRIP,0,Po(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(M(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==Fe.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Qt.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==Fe.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return M(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new tS,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===so.ColorComposite?Lo.ColorComposite:i===so.GridComposite?Lo.GridComposite:Lo.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===so.Composite?yn.OnBaseLayer:yn.OnBackground:yn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?qw.Noop:qw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Uk,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,Qt.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Fe.Normal||a!==so.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(Ki.COLOR_BUFFER_BIT|Ki.DEPTH_BUFFER_BIT)):o&&l.clearSafe(Ki.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(m){npt.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=Gh,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,ot.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(ft.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,ot.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Ki.COLOR_BUFFER_BIT|Ki.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class apt{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new kdt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new opt(this._rctx,this._techniqueRepository),this._blackTex=new eS(DHe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Je(this._composition),this._backgroundTexture=Hi(this._backgroundTexture),this._blackTex=Hi(this._blackTex)}get backgroundIsGrid(){return M(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[Qt.MAP];let p=h.length,f=0;for(;f<h.length;f++){const v=r.layerViewByIndex(f,Qt.MAP),b=v.fullOpacity;if(UB[f]=b,Zge(v.layer)&&p>=h.length&&(p=f),b===0){h[f].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING);continue}++n;const w=FB(t,f);if(w){if(h[f].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING),N4(v)){const S=ESe(v.layer.parent)?"normal":v.layer.blendMode;sle[f]=S;const T=S!=="normal";T&&(c=T,a=!1)}jR(v)?o=Math.max(o,this.tileSize*l):s===1&&b===1&&(v.isOpaque||this._dataToTexture(w)&&w.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=lpt(o);const m=o/this.tileSize,y=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,y,p,UB[y])||this._composeMapLayers(t,i,y,p,UB,sle,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){M(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Gh,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Fe.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?so.ColorOnly:so.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=zg.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=zg.Delayed),this._backgroundTexture&&M(t.renderData.textureReference)&&(r=zg.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new LB(this._backgroundTexture,Ln.FADING,nle,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=FB(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new LB(l.sourceLayerInfo.data,Ln.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=it.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let b=r;b>=0;b--){const w=FB(t,b);if(!w||n[b]===0)continue;const S=b<s&&h<1&&!p;this._passParameters.baseOpacity=S?h:1,S&&(p=!0);const T=y===0,E=c&&T?this.backgroundIsGrid?so.GridComposite:so.ColorComposite:so.Composite;Rut(w)?(this._passParameters.opacity=n[b],this._passParameters.blendMode=hN[o[b]],m=this._composition.drawVectorData(this._passParameters,w,l,this.tileSize,a,m,E)):Out(w)?(this._passParameters.opacity=n[b],this._passParameters.blendMode=hN[o[b]],this._composition.drawImageryTileData(w,E,this._passParameters),this._hasNearestInterpolation(w)&&(f=it.NEAREST)):this._dataToTexture(w)&&(this._passParameters.texture=w.sourceLayerInfo.data.texture,this._passParameters.offset=w.offset,this._passParameters.scale=w.scale,this._passParameters.opacity=n[b],this._passParameters.blendMode=hN[o[b]],this._composition.drawRasterData(E,this._passParameters)),y++}const v=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(v),this._composition.releasePool(),t.renderData.setTextureReference(new LB(v,i,nle,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return Iut(t)&&this._rasterDataToTexture(t),Put(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=it.LINEAR_MIPMAP_LINEAR){if(M(t))return null;const r={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new eS(new ot(s,r));else if(t instanceof Pk)r.isOpaque=t.isOpaque,n=new eS(new ot(s,r,t.image)),t.release();else try{n=new eS(new ot(s,r,t))}catch{n=new eS(d1e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,ot.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,ot.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function lpt(e){const t=m2(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function FB(e,t){Uc.layerIndex=t;const i=e.layerInfo[Qt.MAP][t];if(_(i.data))return fi(Uc.offset,0,0),Uc.tile=e,Uc.scale=1,Uc.sourceLod=e.lij,Uc.sourceLayerInfo=i,Uc;const r=i.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[Qt.MAP][t];return Uc.tile=r.tile,co(Uc.offset,r.offset),Uc.scale=r.scale,Uc.sourceLod=r.tile.lij,Uc.sourceLayerInfo=s,Uc}return null}const UB=new Array,sle=new Array,Uc={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},nle={offset:[0,0],scale:1},r2e=200,kB=40,cpt=.8,upt=10,xM=1e-6;function hpt(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=xM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-xM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-xM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=xM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class ole{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class cE{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=R(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=s2e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=gpt(t,i,r,s.data,s.stride),l=Ne(Math.log2(n/kB),2,upt),c=(h,p,f)=>{const m=fpt(o,a,h,p),y=p-h;if(y<=kB){const E=new ole(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:v,midValue:b}=mpt(m),w=ppt(o,a,h,p,v,b),S=(E,C)=>{if(f>l)return;const A=C-E;return A<kB||A>=cpt*y?void 0:c(E,C,f+1)},T=new ole(m,v,b,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,w.next),T.rightNode=S(w.mid,p),T};c(0,n,0),this.triangleVertexIndices=ypt(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,v=3*t;y<i;++y){const b=r[v]*n,w=s[b],S=s[b+1],T=s[b+2],E=r[v+1]*n,C=s[E],A=s[E+1],I=s[E+2],L=r[v+2]*n,D=s[L],k=s[L+1],z=s[L+2];v+=3;const V=C-w,X=A-S,Y=I-T,le=D-w,re=k-S,$=z-T,U=f*$-re*m,B=m*le-$*p,H=p*re-le*f,W=V*U+X*B+Y*H;if(Math.abs(W)<=Number.EPSILON)continue;const Q=a-w,G=l-S,ee=c-T,me=Q*U+G*B+ee*H;if(W>0){if(me<0||me>W)continue}else if(me>0||me<W)continue;const _e=G*Y-X*ee,Me=ee*V-Y*Q,ve=Q*X-V*G,ge=p*_e+f*Me+m*ve;if(W>0){if(ge<0||me+ge>W)continue}else if(ge>0||me+ge<W)continue;const Ce=(le*_e+re*Me+$*ve)/W;if(Ce>=0){const $e=this.indices[y]+this.firstTriangleIndex,gi=qZ(V,X,Y,le,re,$,dpt);this.callback(Ce,gi,$e,!1)}}}cE.numFacesTested+=i-t}intersectRay(t,i){cE.numFacesTested=0;const r=Ue(t.r0[0],t.r0[1],t.r0[2]),s=Ue(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<xM)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!hpt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}cE.numFacesTested=0;const dpt=R(),eT=[1/0,1/0,1/0],tT=[-1/0,-1/0,-1/0];function ppt(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function fpt(e,t,i,r){if(r<=i)return gw(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)eT[n]=t[s+0+n],tT[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)eT[o]=Math.min(eT[o],t[n+0+o]),tT[o]=Math.max(tT[o],t[n+3+o])}return gw(eT[0],eT[1],eT[2],tT[0],tT[1],tT[2])}function mpt(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function gpt(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],v=r[p+f];o[6*a+f]=Math.min(m,y,v),o[6*a+3+f]=Math.max(m,y,v)}}return o}function ypt(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=s2e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const s2e=65535;class QQ extends Vxe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=R(),this.origin=this.slicePlaneLocalOrigin}}var vu,Jn;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(vu||(vu={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(Jn||(Jn={}));class vpt extends QQ{constructor(){super(...arguments),this.identifier=vu.Material,this.transparent=!1,this.integratedMesh=!1}}class _pt extends QQ{constructor(){super(...arguments),this.identifier=vu.ShadowMap}}class bpt extends QQ{constructor(){super(...arguments),this.identifier=vu.Highlight}}class z4 extends Qr{constructor(t,i){super(t,"vec4",zi.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var Gg;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Gg||(Gg={}));class wpt extends Bs{constructor(){super(...arguments),this.overlayOpacity=1}}function ale(e,t){e.vertex.uniforms.add([new Ua("overlayTexOffset"),new Ua("overlayTexScale")]),e.fragment.uniforms.add([new Xe("overlayOpacity",i=>i.overlayOpacity),new Bt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[Fr.INNER].getColorTexture(i.overlaySource))]),n2e(e,t)}function xpt(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new z4("overlayTexOffset",(s,n)=>Tpt(s,n)),new z4("overlayTexScale",(s,n)=>Spt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Bt("ovColorTex",(s,n)=>iq(s,n))),n2e(e,t)}function n2e(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||e.include(qxe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||(r.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function iq(e,t){return t.overlays.length===0?null:e.identifier===vu.Material&&e.subPass===Jn.Color?t.overlays[Fr.INNER].getColorTextureNoRasterImage():e.identifier===vu.Highlight?t.overlays[Fr.INNER].getValidTexture(vs.Highlight):null}function Tpt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Rfe(s)>0&&(i2[2*r]=e.toMapSpace[0]/fu(s)-s[0]/fu(s),i2[2*r+1]=e.toMapSpace[1]/fp(s)-s[1]/fp(s))}return i2}function Spt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Rfe(s)>0&&(i2[2*r]=e.toMapSpace[2]/fu(s),i2[2*r+1]=e.toMapSpace[3]/fp(s))}return i2}const i2=qt();function Ept(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function Cpt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new Ua("texOffsetAndScale")),e.fragment.uniforms.add(new kr("tex")),e.fragment.uniforms.add(new bl("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new Ua("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new kr("texNext")),e.fragment.uniforms.add(new bl("nextTexOpacities")),e.fragment.uniforms.add(new Ui("fadeFactor")));const r=t.tileBlendInput===Lo.ColorComposite,s=t.tileBlendInput===Lo.GridComposite;s&&e.fragment.include(BQ),r&&e.fragment.uniforms.add(new bl("backgroundColor")),e.vertex.code.add(x`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),e.fragment.code.add(x`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:x`return color;`}
    }`),i?e.fragment.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class o2e extends wpt{}function Apt(e){const t=new Xi;t.include(mTe,{name:"Terrain Shader",output:e.output}),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new xr("proj",(s,n)=>n.camera.projectionMatrix),new RH("view",(s,n)=>ca(lle,n.camera.viewMatrix,s.origin)),new Va("origin",s=>s.origin)]),r.uniforms.add(new Va("origin",s=>s.origin)),e.output===K.Color){t.include(Io),t.include(wv,e),t.include(Cpt,e),t.include(Bw,e);const s=e.overlayMode!==Gg.Disabled,n=e.overlayMode===Gg.EnabledWithWater;s&&t.include(ale,ye(F({},e),{pbrMode:Ot.Water})),n&&t.include(Ept,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new xr("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(x`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?x`normal`:x`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?x`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?x`vuv = uv;`:""}
        ${e.screenSizePerspective?x`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?x`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?x`setOverlayVTC(uv);`:""}
        ${n?x`forwardVertexTangent(vnormal);`:x``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(fs,e),t.include(Bw,e),t.include(Q3,e),t.include(Vw,e),r.uniforms.add([new Va("cameraPosition",(a,l)=>fe(zB,l.camera.eye,a.origin)),new Tt("viewDirection",(a,l)=>we(zB,ie(zB,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new Xe("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",BE),n&&r.uniforms.add([new Bt("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[Fr.INNER].getNormalTexture(a.overlaySource)),new RH("view",(a,l)=>ca(lle,l.camera.viewMatrix,a.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(x`
      void main() {
        ${o?x`float shadow = readShadowMap(vpos, linearDepth);`:x`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?x`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?x`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":x`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":x`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?x`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?x`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?x`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Io,{hasModelTransformation:!1,linearDepth:!0}),t.include(w_,{output:e.output}),t.include(wv,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new mi("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(Io),t.include(wv,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new xr("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(x`
        void main(void) {
          vec3 normal = ${e.shading?x`normal`:x`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(x`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===K.Highlight&&(t.include(Io),t.include(wv,e),t.include(ale,e),i.code.add(x`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(my),r.code.add(x`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const lle=Ee(),zB=R(),Mpt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:o2e,build:Apt},Symbol.toStringTag,{value:"Module"}));class kk extends dr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=kk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return zt({blending:i.renderOccluded?lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA):null,culling:r&&XY,depthTest:!i.renderOccluded&&{func:fr.LESS},depthWrite:!i.renderOccluded&&Dl,colorWrite:ri,stencilTest:t?cit(Sl.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}kk.shader=new rr(Mpt,()=>import("./Terrain.glsl.f88e4461.js"));class Os extends na{constructor(){super(...arguments),this.output=K.Color,this.overlayMode=Gg.Disabled,this.tileBlendInput=Lo.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=he("enable-feature:terrain-shading")}}u([j({count:K.COUNT})],Os.prototype,"output",void 0),u([j({count:Gg.COUNT})],Os.prototype,"overlayMode",void 0),u([j({count:Lo.COUNT})],Os.prototype,"tileBlendInput",void 0),u([j()],Os.prototype,"spherical",void 0),u([j()],Os.prototype,"atmosphere",void 0),u([j()],Os.prototype,"receiveShadows",void 0),u([j()],Os.prototype,"hasSlicePlane",void 0),u([j()],Os.prototype,"backfaceCullingEnabled",void 0),u([j()],Os.prototype,"stencilEnabled",void 0),u([j()],Os.prototype,"textureFadingEnabled",void 0),u([j()],Os.prototype,"renderOccluded",void 0),u([j()],Os.prototype,"hasScreenSpaceReflections",void 0),u([j()],Os.prototype,"hasCloudsReflections",void 0),u([j()],Os.prototype,"tileBorders",void 0),u([j()],Os.prototype,"screenSizePerspective",void 0),u([j()],Os.prototype,"receiveAmbientOcclusion",void 0),u([j()],Os.prototype,"shading",void 0),u([j({constValue:!0})],Os.prototype,"isGround",void 0),u([j({constValue:Ot.Disabled})],Os.prototype,"pbrMode",void 0),u([j({constValue:!1})],Os.prototype,"highStepCount",void 0),u([j({constValue:!1})],Os.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Os.prototype,"useFillLights",void 0);const VB=7,Opt=10,BB=ks(),W$=qt();let Yc=class extends Ae{constructor(e){super(e),this.type=zr.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Os,this._passParameters=new o2e,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new Udt,this.renderDataPool=new Ts(Mg),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new DSe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=$r.Occlude}get isGlobal(){return this.stage.viewingMode===Ge.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Te.OPAQUE_TERRAIN,Te.TRANSPARENT_TERRAIN,Te.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),Eht()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return qd}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?S4:$r.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,bt.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===bt.TEXTURE_FADING?Ln.FADING:Ln.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Qt.ELEVATION])t.pendingUpdates&=~bt.GEOMETRY;e.resetPendingUpdate(bt.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=Opt-VB,i=Math.max(0,Math.floor((e.level-t)/VB)*VB);if(this.isGlobal&&i===0)return No;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=Ls.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new apt(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=d1e(this.rctx)}uninitializeRenderContext(){this.emptyTex=Je(this.emptyTex),this.tileRenderer=Je(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=Ppt,n=Ipt;fe(s,r,i),ie(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===lo.MIN,h=!!e.results.ground.target,p=aYe(e.verticalOffset),f=e.tolerance;let m,y=c&&_(o.dist)?o.dist:1/0;const v=w=>{const S=w.renderData;if(!(S!=null&&S.vao))return;const T=S.geometryInfo;O5(BB,T.boundingBox);const E=S.localOrigin;_(p)&&(p.localOrigin=E,p.applyToAabb(BB));const C=BB;if(iT[0]=i[0]-E[0],iT[1]=i[1]-E[1],iT[2]=i[2]-E[2],!XZ(C,iT,n,f,y))return;const A=(X,Y,le)=>{X.set(this.type,w,Y,le,Us),y=c&&_(o.dist)?o.dist:1/0},I=(X,Y)=>{if(_(Y)&&X>=0&&(e.options.backfacesTerrain||Se(Y,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,X))){if((l.dist==null||X<l.dist)&&A(l,X,Y),e.options.isFiltered)return;e.options.store===lo.ALL&&(M(m)?(m=SZ(e.ray),A(m,X,Y),e.results.all.push(m)):X<m.dist&&A(m,X,Y)),(o.dist==null||X<o.dist)&&A(o,X,Y),e.options.store!==lo.MIN&&(a.dist==null||X>a.dist)&&A(a,X,Y)}},L=$pt;fe(L,r,E);const D=T.indices,k=T.vertexAttributes,z={data:k.getField(O.POSITION,bi).typedBuffer,size:3,stride:k.stride/4},V=T.indexCount/3;if(M(p)&&V>r2e){const X=w.renderData;M(X.intersectionData)&&(X.intersectionData=new cE(D,0,V,z)),X.intersectionData.intersectRay({r0:iT,r1:L},I)}else k3(iT,L,0,V,D,z,null,p,I)},b=this._rootTiles;_(b)&&(()=>{const w=this.tileIterator;w.reset(b);const S=e.options.invisibleTerrain;for(;!w.done;){const T=w.next();!(T.visible||S&&T.intersectsClippingArea)||!_(p)&&!T.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(T)?w.skipSubtree():v(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Te.OCCLUDED_TERRAIN){if((e.renderOccludedMask&S4)==0)return null}else{const t=this.opaque?Te.OPAQUE_TERRAIN:Te.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case Be.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?Gg.Disabled:this.overlayRenderer.hasWater?Gg.EnabledWithWater:Gg.Enabled;const t=e.bindParameters.slot===Te.OCCLUDED_TERRAIN?Ia.Occluded:Ia.ColorAndWater;return this._updateTechnique(K.Color,t===Ia.Occluded)}case Be.MATERIAL_DEPTH_SHADOWMAP_ALL:case Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Shadow,!1)):null;case Be.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Depth,!1));case Be.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Normal,!1);case Be.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case Be.MATERIAL:{const s=e.bindParameters.slot===Te.OCCLUDED_TERRAIN?Ia.Occluded:Ia.ColorAndWater;this._renderMaterialPass(e,t,s);break}case Be.MATERIAL_DEPTH_SHADOWMAP_ALL:case Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Ia.None);break;case Be.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,Ia.None);break;case Be.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,Ia.None);break;case Be.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,Ia.Highlight),e.rctx.clearSafe(Ki.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(M(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(_(e)){const r=We.toUnitRGBA(e);i=Ue(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,Ln.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Lo.GridComposite:_(t.backgroundColor)?Lo.ColorComposite:Lo.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==WR.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>NSe(this.renderOrder,t)),e.sort((t,i)=>FSe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!M(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new NH(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],$t.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=nwe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===Ia.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",Lf));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:No;this._techniqueConfiguration.tileBlendInput===Lo.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?$t.LINES:$t.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new NH(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],y=m.renderData.textureReference;if(!M(y)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),cle(m.renderData.geometryInfo.uvOffsetAndScale,y.offsetAndScale,W$),n.setUniform4fv("texOffsetAndScale",W$),n.bindTexture("tex",y.texture.texture);const v=m.renderData.textureFadeFactor,b=v<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(b)&&v<1?(cle(m.renderData.geometryInfo.uvOffsetAndScale,b.offsetAndScale,W$),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",W$),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,m,c,o,i),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(M(l))return;const c=t.program;n!==Ia.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===K.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(kk,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],Yc.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],Yc.prototype,"stage",void 0),u([d({readOnly:!0})],Yc.prototype,"isGlobal",null),u([d({constructOnly:!0})],Yc.prototype,"allTiles",void 0),u([d({constructOnly:!0})],Yc.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],Yc.prototype,"renderingDisabled",null),u([d()],Yc.prototype,"renderPatchBorders",null),u([d()],Yc.prototype,"cullBackFaces",null),u([d({value:WR.FRONT_TO_BACK})],Yc.prototype,"renderOrder",null),u([d()],Yc.prototype,"wireframe",null),Yc=u([P("esri.views.3d.terrain.TerrainRenderer")],Yc);const Rpt=Yc;function cle(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const Ppt=R(),Ipt=R(),iT=R(),$pt=R();class Dpt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let uf=class extends Ae{constructor(e){super(e),this._handles=new si}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ae(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=at(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!WM(t)||t.isRejected())&&!(t.isFulfilled()&&!Lpt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||L4(t)))),e)if(e.isResolved()){const t=$k(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new Ir(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ge.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Ir.makeWebMercatorAuxiliarySphere(t):ww(e.spatialReference)&&(e=Ir.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ae(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ge.Global){const e=this.extentHelper.viewSpatialReference,t=ww(e)||tm(e)||im(e);e.isWebMercator?this.tilingScheme=Ir.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Ir.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!qb(e,this.extent)&&(this.tilingScheme=Ir.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Lpt(e,t,i){return _($k(e,t,i))}u([d()],uf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],uf.prototype,"extent",void 0),u([d({value:!1})],uf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],uf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],uf.prototype,"layers",void 0),u([d({constructOnly:!0})],uf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],uf.prototype,"viewingMode",void 0),uf=u([P("esri.views.3d.terrain.TilingSchemeLogic")],uf);class Npt{constructor(){this.offset=st(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const ud=de.getLogger("esri.views.3d.terrain.TerrainSurface"),Fpt=.25;let ni=class extends Zr.EventedMixin(Ae){constructor(e){var t,i;super(e),this._elevationBounds=new kQ,this._iteratorPool=new Ts(DSe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new Rht,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new Dpt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=R(),this._eyePosSurfaceSR=R(),this._splitLimits=new sdt,this._snapLevel=1/0,this._frustum=AR(),this._viewProjectionMatrix=Ee(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new si,this._watchUpdatingTracking=new Df,this._frameTask=N2,this._allTiles=new It,this._upsampleInfoPool=new Ts(Npt),this._rootTilesExtent=Lt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=ASe(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Ts(Ldt):new Ts(Ndt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new tht(e.newCache("elevation-query")),this._set("overlayManager",new ol({surface:this})),this._handles.add([ae(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),ae(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new Rpt({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ai(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([ae(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},_s),ae(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},_s),ae(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Qi),ae(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},_s),ae(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),ae(()=>Wi.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.2cd61f0f.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&Wi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=at(this._treeDebugger))},Ft)]),this._extentHelper=vht(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new Ew({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new uf({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Mf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Mf.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(vt.TERRAIN_SURFACE,this),this._handles.add([ae(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Ft),ae(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Qi),ae(()=>this.extent,()=>this._updateRootTiles(),Ft),this.view.on("resize",()=>this._viewChangeUpdate()),ae(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),_s),ae(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Ft),ae(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Qi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Hi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=at(this._upsampleMapCache),this._elevationQueryCache=at(this._elevationQueryCache),this._set("tilingSchemeLogic",at(this.tilingSchemeLogic)),this._extentHelper=at(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",at(this.overlayManager)),this._tilePool=at(this._tilePool),GQ.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=at(this._renderer),this._iteratorPool=at(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=at(this._upsampleInfoPool),mht(),idt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=FU(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=qbe(this.view,e)-n;Math.abs(this._snapLevel-o)>Fpt&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?rE.ON:rE.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(M(t)||M(e))return null;const i=Lt(),r=uSe(t,i,e)?i:null,s=this._get("extent");return qb(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=XD(this.groundExtent,this._userClippingExtent,Lt()),t=this._get("extent");return qb(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,_o);return M(s)?null:RSe(_o[0],_o[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=_o){var o;const n=this.rootTiles;if(M(n)||!n.length||n[0].layerInfo[Qt.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!nn(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return ud.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return l&&l.geometryState.samplerData?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Gr(e,_o,this.spatialReference))return ud.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i!=null&&i.containsPoint(_o)){for(;!i.isLeaf&&!i.rendered;){let r=0;_o[0]>i.children[0].extent[2]&&(r+=1),_o[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(_o[0]=e,_o[1]=t,_o[2]=i,_o[3]=r,!nn(_o,s,_o,(c=this.tilingScheme)==null?void 0:c.spatialReference))return ud.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&qK(h.extent,_o))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(_(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Gr(e,_o,this.spatialReference))return ud.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;_o[3]=t;let i=null;const r=n=>{if(n&&qK(n.extent,_o))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?Ln.UNFADED:Ln.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(xf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return X$[0]=e,X$[1]=t,X$[2]=i,s.init(X$,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=zpt;let r=t.rootTilesInExtent(e,i,5*_S);if(_(this.rootTiles)){if(r.length>_S)return void ud.warn(s7e);const s=this.rootTiles.map(o=>o.lij),n=uCe(s,r,ule);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>ule(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>_S&&(ud.warn(n7e),r=t.rootTilesInExtent(e,i,_S)),this._setRootTiles(r.map(s=>this._newRootTile(s)));qb(i,this._rootTilesExtent)||(this._rootTilesExtent=Lt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===bt.SPLIT&&t.setPendingUpdate(bt.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(M(e))return;const t=$ht(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(bt.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(M(this._splitLimits.frustum)&&(this._splitLimits.frustum=AR()),e4(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,e4(this._frustum,e.frustum),Dr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ne(this._eyePosRenderSR,t.eye),nn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(a2e(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):kpt(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(bt.TEXTURE_FADING)?bt.TEXTURE_FADING:!!e.resetPendingUpdate(bt.TEXTURE_NOFADING)&&bt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){Y$.spatialReference=this.spatialReference,Y$.tile=e,Y$.extent=e.extent,this.emit("elevation-change",Y$)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===bt.SPLIT){i.resetPendingUpdate(bt.MERGE),i.isLeaf&&(i.setPendingUpdate(bt.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(bt.SPLIT)&&i.updateAgentSuspension(),r===bt.VSPLITMERGE&&i.updateAgents(Qt.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(bt.MERGE),i.resetPendingUpdate(bt.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Pht(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(bt.MERGE)){if(!t)return n.setPendingUpdate(bt.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(bt.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(bt.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(bt.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Ls.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*t7e}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=Ne(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){xf(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(bt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){Z$.spatialReference=this.spatialReference,Z$.extent=e.extent,Z$.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",Z$)}_createTile(e,t,i,r){xf(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===bt.SPLIT&&s.setPendingUpdate(bt.SPLIT)),s}_mergeTile(e){xf(!e.hasPendingUpdate(bt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(xf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),xf(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(bt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new yht(e.lij,e.extent,i);e.dataArrived(t,Qt.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=zE){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),HR(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);_(o)&&((o<r||M(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(JH(r)&&!Zge(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(N4(e)){const t=ESe(e.layer.parent)?"normal":e.layer.blendMode;if(Lht(hN[t]))return!0}return!1}_layerClassFromLayerView(e){return QH(e)?Qt.ELEVATION:Qt.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(ae(()=>e.suspended,()=>this._updateTiledLayers())),t.push(ae(()=>e.fullOpacity,()=>this._updateTileTextures(Ln.UNFADED))),t.push(ae(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),N4(e)&&t.push(ae(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ln.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);_(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!HR(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Qt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of K1){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Qt.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Qt.MAP),e===Ln.IMMEDIATE?this.renderer.updateTileTexture(t,bt.TEXTURE_NOFADING):t.updateRenderData(Qt.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Ls.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||jR(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],ye(F({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Br(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Qt.ELEVATION?QH(i)?this._requestElevationTileData(e,i,r):Promise.reject():JH(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(bs(i))return;const a=this._layerIndexByUid[Qt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):ud.warn("TerrainSurface: received data from unknown layer %d %s",Qt.ELEVATION,e.lij.toString())},s=o=>{Br(o)||(this._dataMissing(e,Qt.ELEVATION,t,o),this.requestUpdate())};if(Dae(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:rR,signal:i.signal}).then(o=>{if(!bs(i))return this._frameTask.schedule(()=>r(o),i.signal,s);ud.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:rR},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,KS(h),bs(i)||(this._dataMissing(e,Qt.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),bs(i)?KS(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(jR(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(Ik(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(FQ(t)&&Dae(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(bs(i))return ud.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(hi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);M8e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(Qt.MAP,t.uid);_(r)?e.dataArrived(r,Qt.MAP,i):(KS(i),ud.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);_(s)?e.dataMissing(s,t,r):ud.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(M(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return _(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(M(e)||M(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return xf(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){GB.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&GB.push(i)});const t=GB.toArray();return NSe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)!=null&&e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&UO((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],ni.prototype,"_renderer",void 0),u([d()],ni.prototype,"_hasPendingUpdates",void 0),u([d()],ni.prototype,"_asyncWorkItems",void 0),u([d()],ni.prototype,"_allTilesDirty",void 0),u([d()],ni.prototype,"_allTilesSorted",void 0),u([d()],ni.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],ni.prototype,"_watchUpdatingTracking",void 0),u([d()],ni.prototype,"_frameTask",void 0),u([d({readOnly:!0})],ni.prototype,"snapLevel",null),u([d({readOnly:!0})],ni.prototype,"lodSnapping",null),u([d({constructOnly:!0})],ni.prototype,"view",void 0),u([d()],ni.prototype,"_userClippingExtent",null),u([d()],ni.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],ni.prototype,"extent",null),u([d({readOnly:!0})],ni.prototype,"groundExtent",null),u([d({readOnly:!0})],ni.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],ni.prototype,"updating",null),u([d(ght)],ni.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],ni.prototype,"updatingProgressValue",null),u([d()],ni.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],ni.prototype,"baseOpacity",void 0),u([d()],ni.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],ni.prototype,"overlayManager",void 0),u([d({readOnly:!0})],ni.prototype,"viewingMode",null),u([d()],ni.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],ni.prototype,"ready",null),u([d({value:WR.FRONT_TO_BACK})],ni.prototype,"renderOrder",null),u([d({readOnly:!0})],ni.prototype,"rootTiles",void 0),u([d({readOnly:!0})],ni.prototype,"spatialReference",null),u([d({type:We,aliasOf:"view.map.ground.surfaceColor"})],ni.prototype,"backgroundColor",void 0),u([d({value:!1})],ni.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],ni.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],ni.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],ni.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],ni.prototype,"velvetOverground",null),u([ht("_renderer.wireframe")],ni.prototype,"wireframe",void 0),u([d({value:!1})],ni.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],ni.prototype,"textureFadeDuration",void 0),u([d()],ni.prototype,"_layerViewsDirty",void 0),u([ht("_renderer.renderPatchBorders")],ni.prototype,"renderPatchBorders",void 0),u([ht("_renderer.renderingDisabled")],ni.prototype,"renderingDisabled",void 0),ni=u([P("esri.views.3d.terrain.TerrainSurface")],ni);const Upt=ni;function ule(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function a2e(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>a2e(t)))}function kpt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const _o=qt(),zpt=Lt(),X$=[0,0,0],GB=new It,Y$={spatialReference:null,tile:null,extent:null,context:"ground"},Z$={spatialReference:null,extent:null,scale:0};let TM=class extends Ae{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&ti.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&ti.State.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&ti.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&kw.pool.release(f[0])):c===ti.Geometry.REMOVE&&pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&ti.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const m=this.model.getRenderGeometry(f,l),y=[l,m];t.adds.push(m),n.set(a,y)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(ti.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(ti.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(ti.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,ti.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,ti.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ti.Geometry.ADD,ti.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ti.Geometry.REMOVE,ti.Geometry.ADD,ti.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=_t(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&kw.pool.release(f[0])):m&n?(f[1]=r,f[2]=l):m&o?f[2]|=l:m&a||pt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return Js(this._dirtyGeomRecords,e=>Js(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:JMe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],TM.prototype,"model",void 0),u([d()],TM.prototype,"dirty",void 0),TM=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],TM);const Vpt=TM;let gN=class extends Ae{constructor(){super(...arguments),this.dirtySet=new Vpt({model:this}),this._content=new Map,this._originFactory=new fQ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;pt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),b4(e)&&this.dirtySet.layerAdded(e)}remove(e){pt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),b4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(pt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)pt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new oE(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(M(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<_p.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],gN.prototype,"dirtySet",void 0),gN=u([P("esri.views.3d.webgl-engine.parts.Model")],gN);function l2e(){const e=new Float32Array(4);return e[3]=1,e}function c2e(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Bpt(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function u2e(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:l2e,clone:c2e,fromValues:Bpt,createView:u2e},Symbol.toStringTag,{value:"Module"}));const us=!0,Bb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function JQ(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+Bb.identifierOffset,Bb.identifierLength)),version:t.getUint16(i+Bb.versionOffset,us),checksum:t.getUint32(i+Bb.checksumOffset,us)}}const Jl={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Gpt(e,t){return{sizeLo:e.getUint32(t+Jl.sizeLo,us),sizeHi:e.getUint32(t+Jl.sizeHi,us),minX:e.getFloat64(t+Jl.minX,us),minY:e.getFloat64(t+Jl.minY,us),minZ:e.getFloat64(t+Jl.minZ,us),maxX:e.getFloat64(t+Jl.maxX,us),maxY:e.getFloat64(t+Jl.maxY,us),maxZ:e.getFloat64(t+Jl.maxZ,us),errorX:e.getFloat64(t+Jl.errorX,us),errorY:e.getFloat64(t+Jl.errorY,us),errorZ:e.getFloat64(t+Jl.errorZ,us),count:e.getUint32(t+Jl.count,us),reserved:e.getUint32(t+Jl.reserved,us)}}function rSt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=JQ(e,t,i);if(i+=Bb.byteCount,r!=="LEPCC     ")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=Gpt(t,i);if(i+=Jl.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=Q$(e,i,a),i=Q$(e,i,l),i=Q$(e,i,c),i=Q$(e,i,h),i!==e.byteLength)throw new q("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let v=0;v<l[m];v++){y+=c[p];const b=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*b),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function Q$(e,t,i){const r=[];t=rq(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=rq(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function rq(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,us),t+=5;else if(a===1)l=r.getUint16(1,us),t+=3;else{if(a!==2)throw new q("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new q("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let v=0;v<l;v++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;i[v]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const eb={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function jpt(e,t){return{sizeLo:e.getUint32(t+eb.sizeLo,us),sizeHi:e.getUint32(t+eb.sizeHi,us),count:e.getUint32(t+eb.count,us),colorMapCount:e.getUint16(t+eb.colorMapCount,us),lookupMethod:e.getUint8(t+eb.lookupMethod),compressionMethod:e.getUint8(t+eb.compressionMethod)}}function Hpt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=JQ(e,t,i);if(i+=Bb.byteCount,r!=="ClusterRGB")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=jpt(t,i);if(i+=eb.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new q("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new q("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new q("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new q("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const tb={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function qpt(e,t){return{sizeLo:e.getUint32(t+tb.sizeLo,us),sizeHi:e.getUint32(t+tb.sizeHi,us),count:e.getUint32(t+tb.count,us),scaleFactor:e.getUint16(t+tb.scaleFactor,us),bitsPerPoint:e.getUint8(t+tb.bitsPerPoint),reserved:e.getUint8(t+tb.reserved)}}function Wpt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=JQ(e,t,i);if(i+=Bb.byteCount,r!=="Intensity ")throw new q("lepcc-decode-error","Bad identifier");if(s>1)throw new q("lepcc-decode-error","Unknown version");const n=qpt(t,i);if(i+=tb.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new q("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(rq(e,i,a)!==e.byteLength)throw new q("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const sq=de.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Xpt(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new q("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function h2e(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=ift[o];i.fields[n.property]=a(e,r),r+=zk[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function Ypt(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(Xpt(i,o,s-1)),i[o+s-1]!==0)throw new q("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function hle(e,t){return new zk[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function Zpt(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function Qpt(e,t,i){const r=t.header!=null?h2e(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=te(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new q("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!p2e(l.valueType))throw new q("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=yN(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function d2e(e,t,i){if(t!==e&&sq.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new q("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Jpt(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function sSt(e,t){const i=h2e(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h=ye(F({},t.vertexAttributes[c]),{byteOffset:r,count:o}),p=dle[c]?dle[c]:"_"+c;s.vertexAttributes[p]=h,r+=yN(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h=ye(F({},t.faces[c]),{byteOffset:r,count:a});s.faces[c]=h,r+=yN(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h=ye(F({},t.featureAttributes[c]),{byteOffset:r,count:l});s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:yN(h.valueType))*h.valuesPerElement*l}}return d2e(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function nSt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Jpt(e):Kpt(t):eft(e.compressedAttributes.attributes)}function Kpt(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function eft(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const dle={position:O.POSITION,normal:O.NORMAL,color:O.COLOR,uv0:O.UV0,region:O.UVREGION};function tft(e,t,i){if(e.encoding==="lepcc-rgb")return Hpt(t);if(e.encoding==="lepcc-intensity")return Wpt(t);if(e.encoding!=null&&e.encoding!=="")throw new q("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(sq.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(sq.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=Qpt(t,e,i);d2e(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=hle(t,n),a=Zpt(t,s);return Ypt(n.count,o,a)}return hle(t,s)}throw new q("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const zk={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},ift={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function p2e(e){return zk.hasOwnProperty(e)}function yN(e){return p2e(e)?zk[e].BYTES_PER_ELEMENT:0}function rft(e,t,i,r){const s=sft(e,t,i),n=Ee();return ua(i,s,n,r),n}const f2e=1,ple=5-f2e;function sft(e,t,i){const r=R(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/ple)*ple+f2e);if(i.isGeographic){const l=n/Ai(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;r[0]=f,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const uE=1e-6,KC=[0,0,0],J$=[0,0,0];function nft(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new fft(e);vN(KC,n.minProj,n.maxProj),Eb(KC,KC,.5),Mh(J$,n.maxProj,n.minProj);const o=nq(J$),a=new mft;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(oft(n,e,y,l,c,h,p,f,m,a)){case 1:return void yle(KC,J$,t);case 2:return void pft(e,p,t)}aft(e,y,l,c,h,p,f,m,a),m2e(e,a.b0,a.b1,a.b2,s2,n2);const v=[0,0,0];Mh(v,n2,s2),a.quality=nq(v),a.quality<o?g2e(a.b0,a.b1,a.b2,s2,n2,v,t):yle(KC,J$,t)}function oft(e,t,i,r,s,n,o,a,l,c){return lft(e,r,s),oq(r,s)<uE?1:(Mh(o,r,s),Eo(o,o),cft(t,r,o,n)<uE?2:(Mh(a,s,n),Eo(a,a),Mh(l,n,r),Eo(l,l),Oh(i,a,o),Eo(i,i),ib(t,i,o,a,l,c),0))}const eA=[0,0,0],tA=[0,0,0],Yu=[0,0,0],Zu=[0,0,0],Qu=[0,0,0],Yy=[0,0,0],Zy=[0,0,0],Qy=[0,0,0];function aft(e,t,i,r,s,n,o,a,l){uft(e,t,i,eA,tA),eA[0]!==void 0&&(Mh(Yu,eA,i),Eo(Yu,Yu),Mh(Zu,eA,r),Eo(Zu,Zu),Mh(Qu,eA,s),Eo(Qu,Qu),Oh(Yy,Zu,n),Eo(Yy,Yy),Oh(Zy,Qu,o),Eo(Zy,Zy),Oh(Qy,Yu,a),Eo(Qy,Qy),ib(e,Yy,n,Zu,Yu,l),ib(e,Zy,o,Qu,Zu,l),ib(e,Qy,a,Yu,Qu,l)),tA[0]!==void 0&&(Mh(Yu,tA,i),Eo(Yu,Yu),Mh(Zu,tA,r),Eo(Zu,Zu),Mh(Qu,tA,s),Eo(Qu,Qu),Oh(Yy,Zu,n),Eo(Yy,Yy),Oh(Zy,Qu,o),Eo(Zy,Zy),Oh(Qy,Yu,a),Eo(Qy,Qy),ib(e,Yy,n,Zu,Yu,l),ib(e,Zy,o,Qu,Zu,l),ib(e,Qy,a,Yu,Qu,l))}function lft(e,t,i){let r=oq(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=oq(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}yc(t,e.minVert[s]),yc(i,e.maxVert[s])}const Ju=[0,0,0];function cft(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Ju[0]=s[l]-t[0],Ju[1]=s[l+1]-t[1],Ju[2]=s[l+2]-t[2];const c=i[0]*Ju[0]+i[1]*Ju[1]+i[2]*Ju[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Ju[0]*Ju[0]+Ju[1]*Ju[1]+Ju[2]*Ju[2]-c*c/h;p>o&&(o=p,a=l)}return yc(r,s,a),o}const mn=[0,0];function uft(e,t,i,r,s){dft(e,t,mn,s,r);const n=v2e(i,t);mn[1]-uE<=n&&(r[0]=void 0),mn[0]+uE>=n&&(s[0]=void 0)}const fle=[0,0,0],mle=[0,0,0],gle=[0,0,0],rT=[0,0,0],sT=[0,0,0],K$=[0,0,0];function ib(e,t,i,r,s,n){if(y2e(t)<uE)return;Oh(fle,i,t),Oh(mle,r,t),Oh(gle,s,t),r2(e,t,mn),sT[1]=mn[0],rT[1]=mn[1],K$[1]=rT[1]-sT[1];const o=[i,r,s],a=[fle,mle,gle];for(let l=0;l<3;++l){r2(e,o[l],mn),sT[0]=mn[0],rT[0]=mn[1],r2(e,a[l],mn),sT[2]=mn[0],rT[2]=mn[1],K$[0]=rT[0]-sT[0],K$[2]=rT[2]-sT[2];const c=nq(K$);c<n.quality&&(yc(n.b0,o[l]),yc(n.b1,t),yc(n.b2,a[l]),n.quality=c)}}const hft=[0,0,0];function r2(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function dft(e,t,i,r,s){const{data:n,size:o}=e;yc(r,n),yc(s,r),i[0]=v2e(hft,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,yc(r,n,a)),l>i[1]&&(i[1]=l,yc(s,n,a))}}function yle(e,t,i){yc(i.center,e),Eb(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Rm=[0,0,0],nT=[0,0,0],iA=[0,0,0],s2=[0,0,0],n2=[0,0,0],vle=[0,0,0];function pft(e,t,i){yc(Rm,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Rm[0]=0:Math.abs(t[1])>Math.abs(t[2])?Rm[1]=0:Rm[2]=0,y2e(Rm)<uE&&(Rm[0]=Rm[1]=Rm[2]=1),Oh(nT,t,Rm),Eo(nT,nT),Oh(iA,t,nT),Eo(iA,iA),m2e(e,t,nT,iA,s2,n2),Mh(vle,n2,s2),g2e(t,nT,iA,s2,n2,vle,i)}function m2e(e,t,i,r,s,n){r2(e,t,mn),s[0]=mn[0],n[0]=mn[1],r2(e,i,mn),s[1]=mn[0],n[1]=mn[1],r2(e,r,mn),s[2]=mn[0],n[2]=mn[1]}const eD=[0,0,0],Vp=[1,0,0,0,1,0,0,0,1],oT=[0,0,0];function g2e(e,t,i,r,s,n,o){Vp[0]=e[0],Vp[1]=e[1],Vp[2]=e[2],Vp[3]=t[0],Vp[4]=t[1],Vp[5]=t[2],Vp[6]=i[0],Vp[7]=i[1],Vp[8]=i[2],gft(o.quaternion,Vp),vN(oT,r,s),Eb(oT,oT,.5),Eb(o.center,e,oT[0]),Eb(eD,t,oT[1]),vN(o.center,o.center,eD),Eb(eD,i,oT[2]),vN(o.center,o.center,eD),Eb(o.halfSize,n,.5)}const kc=7;class fft{constructor(t){this.minVert=new Array(kc),this.maxVert=new Array(kc);const i=64*kc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,kc),r+=8*kc,this.maxProj=new Float64Array(this.buffer,r,kc),r+=8*kc;for(let l=0;l<kc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<kc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<kc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(kc),n=new Array(kc),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<kc;++l){let c=s[l];yc(this.minVert[l],o,c),c=n[l],yc(this.maxVert[l],o,c)}}}class mft{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function nq(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function vN(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function Mh(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function Eb(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function yc(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function Oh(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function Eo(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function y2e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function oq(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function v2e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gft(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const xO=wp(),Gb=R(),yft=R(),vft=ir();class oSt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:mW(this.buffer,56*a+0),halfSize:y1e(this.buffer,56*a+24),quaternion:u2e(this.buffer,56*a+36)}}}function KQ(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:rs(e),halfSize:WF(t),quaternion:c2e(i)}}function _le(e){return KQ(e.center,e.halfSize,e.quaternion)}function aSt(e,t){ne(t.center,e.center),ne(t.halfSize,e.halfSize),$3(t.quaternion,e.quaternion)}function _2e(e,t){return t=t||KQ(),nft(e,t),t}function rb(e,t){const i=lr(t,e.center),r=Vk(e,t);return i>r?1:i<-r?-1:0}function lSt(e,t){t||(t=ks());const i=AU(vft,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function cSt(e,t){return lr(t,e.center)-Vk(e,t)}function uSt(e,t){return lr(t,e.center)+Vk(e,t)}function hSt(e,t){return rb(e,t[0])<=0&&rb(e,t[1])<=0&&rb(e,t[2])<=0&&rb(e,t[3])<=0&&rb(e,t[4])<=0&&rb(e,t[5])<=0}function dSt(e,t,i,r=0){ey(xO,e.quaternion),fe(Gb,t,e.center);const s=Eu(Gb,Gb,xO),n=Eu(yft,i,xO);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function Vk(e,t){ey(xO,e.quaternion),Eu(Gb,t,xO);const i=e.halfSize;return Math.abs(Gb[0]*i[0])+Math.abs(Gb[1]*i[1])+Math.abs(Gb[2]*i[2])}function b2e(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Eu(r,r,e.quaternion),pe(r,r,e.center)}}function _ft(e){return _W(e.halfSize)}function w2e(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function pSt(e){var t;if(he("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function fSt(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=bft,pNe(a.mbs,r,l,t)),wft(e,l)!==jb.OUTSIDE&&(n(a),!0)})}function mSt(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function gSt(e,t,i){let r=0,s=0;for(;r<i.length;)Eue(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const rA=Lt();function ySt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return rA[0]=(e[0]-t.position[0])/t.rotationScale[0],rA[1]=(e[1]-t.position[1])/t.rotationScale[4],rA[2]=(e[2]-t.position[0])/t.rotationScale[0],rA[3]=(e[3]-t.position[1])/t.rotationScale[4],rA}const bft=qt();var jb;function wft(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?jb.OUTSIDE:p>0?jb.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?jb.INSIDE:jb.INTERSECTS_CENTER_INSIDE}function xft(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function vSt(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await Sft(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=Tft(t,i,s);if(M(o))throw new q("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>Eft(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const y in f.attributes)y in m||(m[y]=f.attributes[y]);f.attributes=m}return c.graphics})));return Cue(l)}throw new q("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function Tft(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function Sft(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=xft(r,e.fields,{originalFields:n}),a=await x2e(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function x2e(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=dCe(t,r);return Promise.all(n.map(o=>x2e(e,o,i))).then(Cue)}const s=new mu({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new q("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Eft(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Ba(n.map(o=>_i(o.url,{responseType:"array-buffer"}).then(a=>tft(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=Mft(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(jb||(jb={}));const Cft=-32768,Aft=-(2**31);function Mft(e,t){if(!e)return null;const i=e[t];return Mue(e)?i===Cft?null:i:Oue(e)?i===Aft?null:i:i!=i?null:i}function Oft(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new q("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ze(w2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Rft(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new q("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new q("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ze(w2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function _St(e,t){return M(t)?"@null":t===Il(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function aq(e,t,i){if(!qv(e,t))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!Pft(e,t))throw new q("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Pft(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function Ift(e,t,i){const r=Oft(e),s=Rft(e);aq(r,t,i),aq(s,t,i)}function $ft(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function bSt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!$ft(e.store.defaultGeometrySchema))throw new q("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function wSt(e,t){Ift(e,t.spatialReference,t.viewingMode)}function Dft(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function xSt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!Dft(e.store.defaultGeometrySchema))throw new q("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function TSt(e,t){aq(e.spatialReference,t.spatialReference,t.viewingMode)}function Lft(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function Nft(e){return e.type==="mesh-3d"}function SSt(e){if(e==null||!Lft(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!Nft(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||M(r.material)||M(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const ESt=gxe({color:[0,0,0,0],opacity:0});class Fft{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function CSt(e){const t=new Fft;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(_(n)&&!i){const a=n.color,l=aTe(n.colorMixMode);_(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:xs.Multiply},t.castShadows=s.castShadows,i=!0}_(o)&&!r&&(t.edgeMaterial=mxe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:xs.Multiply}),t}function ASt(e,t){return(0|e)+(0|t)|0}function Uft(e,t,i,r,s=0){r===Il(r)?t.isGeographic?Hft(e,i,t,s):jft(e,i,t,s):t.isWGS84&&(r.isWebMercator||UO(r))?zft(t,e,r,i,s):t.isWebMercator&&UO(r)?Gft(t,e,r,i,s):e===i?(i.center[2]+=s,tr(i.center,t,0,i.center,r,0,1)):(ie(i.center,e.center[0],e.center[1],e.center[2]+s),tr(i.center,t,0,i.center,r,0,1),$3(i.quaternion,e.quaternion),ne(i.halfSize,e.halfSize))}function kft(e,t,i,r,s){if($3(s.quaternion,e.quaternion),r===Ge.Global){ey(tD,e.quaternion),Eu(Jy,e.center,tD),s9(aT,Jy),hpe(lT,aT,e.halfSize),bc(lT,aT,lT);const n=Re(lT);pe(lT,aT,e.halfSize);const o=Re(lT);if(n<i)ne(s.center,e.center),ie(Jy,i,i,i),pe(s.halfSize,e.halfSize,Jy);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;oe(s.halfSize,aT,h),Mb(s.halfSize,s.halfSize,e.halfSize,c),oe(s.center,aT,c),Mb(s.center,s.center,e.halfSize,h),upe(Jy,Jy),v5(s.center,s.center,Jy),Eu(s.center,s.center,s.quaternion)}}else{const n=ie(Jy,0,0,1);Mb(s.center,e.center,n,(i+t)/2),ey(tD,e.quaternion),Eu(n,n,tD),s9(n,n),Mb(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const Jy=R(),aT=R(),lT=R(),tD=wp();function zft(e,t,i,r,s){ne(rv,t.center),rv[2]+=s;const n=Il(i);tr(rv,e,0,rv,n,0,1),T2e(n,t,rv,i,r)}const _N=new Float64Array(24),Vft={data:_N,size:3},ble=R(),rv=R(),Bft=ir();function Gft(e,t,i,r,s){ne(rv,t.center),rv[2]+=s,T2e(e,t,rv,i,r)}function T2e(e,t,i,r,s){const n=AU(Bft,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)ble[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=ble[c]*n[3*c+a];_N[3*o+a]=l}}tr(_N,e,0,_N,r,0,8),_2e(Vft,s)}function jft(e,t,i,r){b2e(e,lq),ie(t.center,e.center[0],e.center[1],e.center[2]+r),ua(i,t.center,zc,Il(i)),ie(t.center,zc[12],zc[13],zc[14]);const s=2*Math.sqrt(1+zc[0]+zc[5]+zc[10]);fg[0]=(zc[6]-zc[9])/s,fg[1]=(zc[8]-zc[2])/s,fg[2]=(zc[1]-zc[4])/s,fg[3]=.25*s,TU(t.quaternion,fg,e.quaternion),ey(fg,t.quaternion);let n=0,o=0,a=0;for(const l of lq)l[2]+=r,tr(l,i,0,l,Il(i),0,1),bc(Si,l,t.center),Eu(Si,Si,fg),n=Math.max(n,Math.abs(Si[0])),o=Math.max(o,Math.abs(Si[1])),a=Math.max(a,Math.abs(Si[2]));ie(t.halfSize,n,o,a)}function Hft(e,t,i,r){const s=Ai(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);ie(t.center,e.center[0],e.center[1],e.center[2]+r),tr(t.center,i,0,t.center,Il(i),0,1),$3(t.quaternion,e.quaternion),ey(fg,e.quaternion),ie(Si,0,0,1),Eu(Si,Si,fg),ie(Si,e.halfSize[0]*Math.abs(Si[0]),e.halfSize[1]*Math.abs(Si[1]),e.halfSize[2]*Math.abs(Si[2])),oe(Si,Si,s.inverseFlattening),pe(t.halfSize,e.halfSize,Si),oe(t.halfSize,t.halfSize,n)}function MSt(e,t,i,r,s,n){if(!n||n.length===0||M(t))return null;const o=rft(e.mbs,s,i,t);let a;Xr(rD,o);const l=()=>{if(!a)if(a=lq,xc(iD),_(e.serviceObb)){Uft(e.serviceObb,i,wle,t,s),b2e(wle,a);for(const m of a)ke(m,m,rD),BS(iD,m)}else{const m=e.mbs,y=m[3];nn(m,i,Si,t),ke(Si,Si,rD),Si[2]+=s;for(let v=0;v<8;++v){const b=1&v?y:-y,w=2&v?y:-y,S=4&v?y:-y,T=a[v];ne(T,[Si[0]+b,Si[1]+w,Si[2]+S]),BS(iD,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y.hasZ)return;xc(jB);const v=y.spatialReference||r,b=y.rings.reduce((w,S)=>S.reduce((T,E)=>(nn(E,v,Si,t),ke(Si,Si,rD),BS(jB,Si),Math.min(Si[2],T)),w),1/0);l(),m3(iD,jB)&&(c=Math.min(c,b),h=Math.max(h,b))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,v)=>{ke(Si,v,o),m[y+0]=Si[0],m[y+1]=Si[1],m[y+2]=Si[2],y+=24,v[2]=c,ke(Si,v,o),m[y+0]=Si[0],m[y+1]=Si[1],m[y+2]=Si[2],y+=24,v[2]=h,ke(Si,v,o),m[y+0]=Si[0],m[y+1]=Si[1],m[y+2]=Si[2]};for(let m=0;m<8;++m)f(xle.data,3*m,a[m]);return _2e(xle)}function OSt(e){return _(e)&&e.halfSize[0]>=0}function RSt(e){return e[3]>=0}function PSt(e){_(e)&&(e.halfSize[0]=-1)}function ISt(e){_(e)&&(e[3]=-1)}const zc=Ee(),fg=l2e(),lq=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],jB=Lt(),iD=Lt(),wle=KQ(),Si=[0,0,0],xle={data:new Array(72),size:3},rD=Ee();class qft{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Wft(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function Wft(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class Xft extends ik{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=Nq(i);const r=this.count;this.visibility=new qft(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return M(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return M(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return M(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((M(this.cachedHighlightRanges)||M(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=Yft(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function Yft(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class cq extends ik{constructor(){super(...arguments),this.visible=o2.Hidden}}var o2;u([So()],cq.prototype,"renderable",void 0),u([So()],cq.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(o2||(o2={}));function Zft(e,t,i,r){if(i>=t)return e;e==null&&(e=Qft());const s=e.isVisibleBit;let n=e.data;const o=E2e(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),v=c+1;let b=Math.max(m,y);b=Math.min(b,v),n=new Uint32Array(b),n.set(h)}return a<n.length&&(n[a]=Kft(n[a],l,p)),e.data=n,e}function S2e(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=E2e(r);return t<r.length*s?Jft(i,r,t,s):!e.isVisibleBit}function Qft(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function Jft(e,t,i,r){const s=i/r|0,n=i-s*r;return emt(t[s],n)===e}function E2e(e){return e.BYTES_PER_ELEMENT*8}function Kft(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function emt(e,t){return(e&1<<t)!=0}class tmt{constructor(t,i){this._indices=_(t.indices)?t.indices:Y2(t.positions.length/3),this._positions=new bi(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=ywe(t,i,imt),f=t[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!S2e(this._components.pickability,y))return!0;const v=this.getComponentAabb(y,rmt);if(_(o)){const E=o[y];_(n)?n.componentOffset=E:(t[2]=f-E,i[2]=m-E)}if(_(n)&&n.applyToAabb(v),!WZ(v,t,p,r))return!0;const b=h[y]/3,w=h[y+1]/3,S=(E,C,A)=>{a(y,E,Oo(C,C,s),A)},T=w-b;return M(n)&&T>r2e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new cE(this._indices,b,w,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:i},S)):k3(t,i,b,w,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,v=-1/0;for(let b=l;b<c;b++){const w=i[b]*s,S=r[w],T=r[w+1],E=r[w+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,S),y=Math.max(y,T),v=Math.max(v,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=v}}get positions(){return this._positions}get indices(){return this._indices}}const imt=R(),rmt=ks();class smt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class C2e extends ik{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([So()],C2e.prototype,"vao",void 0);function nmt(e,t){return{near:e,far:t}}function rP(e){return e?XR(e,1/0,-1/0):nmt(1/0,-1/0)}function XR(e,t,i){return e.near=t,e.far=i,e}function hE(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function sD(e,t){return e.near<=t&&t<=e.far}const uq={near:0,far:0};function omt(e,t){const i=rP(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=_(o.offsetObb)?o.offsetObb:o.obb,l=Se(bc(Zc,a.center,r),n),c=Vk(a,n);if(sD(i,l-c)&&sD(i,l+c))return;const h=hmt(a,s);if(h===-1)return;if(h===0)return Pm.far=l+c,Pm.near=l-c,void hE(i,Pm);const p=nD.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<nD.length;o++){const a=nD.data[o];if(sD(i,a.near)&&sD(i,a.far))continue;Pm.far=a.far,Pm.near=1/0,umt(_(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,amt,c=>{let h=lmt;for(let p=0;p<A2e&&c.length>0;p++){if((a.mask&1<<p)==0)continue;cmt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){ie(ul,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Se(bc(ul,ul,r),n);Pm.near=Math.min(Pm.near,f)}})===0&&(Pm.near=0),hE(i,Pm)}return nD.length=0,i}const nD=new It({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Pm=rP(),ul=R(),c1=R(),amt=new It({deallocator:null}),lmt=new It({deallocator:null});function cmt(e,t,i){i.length=0;const r=t.length-3;HB(ul,t,r);const s=lr(e,ul);s<=0&&(i.push(ul[0]),i.push(ul[1]),i.push(ul[2]));let n=0,o=s;for(;n<r;n+=3){HB(c1,t,n);const a=lr(e,c1);o*a<0&&(on(ul,c1,ul,a/(a-o)),hl(i,ul)),a<=0&&hl(i,c1),o=a,ne(ul,c1)}o*s<0&&(HB(c1,t,r),on(ul,c1,ul,s/(s-o)),hl(i,ul))}function HB(e,t,i){return ie(e,t.data[i+0],t.data[i+1],t.data[i+2])}function hl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function umt(e,t,i,r){ey(Sle,e.quaternion),bc(Zc,t,e.center),Eu(Zc,Zc,Sle);const s=8*((Zc[0]<-e.halfSize[0]?-1:Zc[0]>e.halfSize[0]?1:0)+3*(Zc[1]<-e.halfSize[1]?-1:Zc[1]>e.halfSize[1]?1:0)+9*(Zc[2]<-e.halfSize[2]?-1:Zc[2]>e.halfSize[2]?1:0)+13),n=Tle[s];if(n===0)return n;AU(oD,e.quaternion),hZ(oD,oD,e.halfSize);const o=(a,l)=>{const c=Tle[s+l+1];return ie(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Oo(a,a,oD),pe(a,e.center,a)};return i.length=0,hl(i,o(qB,0)),hl(i,o(Ele,1)),hl(i,o(Zc,2)),hl(i,o(Cle,3)),r(i),n===1||(i.length=0,hl(i,qB),hl(i,Cle),hl(i,o(Zc,4)),hl(i,o(Ale,5)),r(i),n===2||(i.length=0,hl(i,qB),hl(i,Ale),hl(i,o(Zc,6)),hl(i,Ele),r(i))),n}const Tle=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),A2e=4;function hmt(e,t){let i=0;for(let r=0;r<A2e;r++){const s=rb(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const oD=ir(),Sle=wp(),Zc=R(),qB=R(),Ele=R(),Cle=R(),Ale=R();class dmt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?omt(t,this._objects.visibleObjects):null}}function pmt(e){const t=ns().vec3f(O.POSITION);return e.normals&&t.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===tn.Default?t.vec2f(O.UV0):e.textureCoordinates===tn.Atlas&&(t.vec2f(O.UV0),t.vec4u16(O.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(O.COLOR,{glNormalized:!0}),t.alignTo(4)}class fmt extends Qr{constructor(t,i){super(t,"int",zi.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var cp;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(cp||(cp={}));const eJ=429496.7296;function M2e(e,t){PR(e/eJ*.5+.5,t)}function mmt(e,t){switch(t.componentData){case cp.Varying:return gmt(e);case cp.Uniform:return ymt(e);case cp.COUNT:return;default:t.componentData}}function gmt(e){const{vertex:t,fragment:i}=e;t.include(Mc),t.uniforms.add([new kr("componentColorTex"),new Lg("componentColorTexInvDim")]),e.attributes.add(O.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(cTe),t.constants.add("elevationScale","float",2*eJ),t.code.add(x`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(x`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function ymt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new z4("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new fmt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(x`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var $h;function vmt(e,t){const i=e.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case $h.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case $h.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case $h.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})($h||($h={}));var Uf;function $St(e){return e&&tm(e)?Uf.Mars:e&&im(e)?Uf.Moon:Uf.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Uf||(Uf={}));var Mle,pu;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Mle||(Mle={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(pu||(pu={}));class ci extends Ha{constructor(){super(...arguments),this.output=K.Color,this.textureCoordinateType=tn.None,this.componentData=cp.Uniform,this.cullFace=hr.Back,this.vertexDiscardMode=$h.None,this.doubleSidedMode=Vr.WindingOrder,this.alphaDiscardMode=cr.Opaque,this.integratedMeshMode=pu.None,this.transparencyPassType=yt.NONE,this.ellipsoidMode=Uf.Earth,this.pbrMode=Ot.Disabled,this.normalType=Ar.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([j({count:K.COUNT})],ci.prototype,"output",void 0),u([j({count:tn.COUNT})],ci.prototype,"textureCoordinateType",void 0),u([j({count:cp.COUNT})],ci.prototype,"componentData",void 0),u([j({count:hr.COUNT})],ci.prototype,"cullFace",void 0),u([j({count:$h.COUNT})],ci.prototype,"vertexDiscardMode",void 0),u([j({count:Vr.COUNT})],ci.prototype,"doubleSidedMode",void 0),u([j({count:cr.COUNT})],ci.prototype,"alphaDiscardMode",void 0),u([j({count:pu.COUNT})],ci.prototype,"integratedMeshMode",void 0),u([j({count:yt.COUNT})],ci.prototype,"transparencyPassType",void 0),u([j({count:Uf.COUNT})],ci.prototype,"ellipsoidMode",void 0),u([j({count:Ot.COUNT})],ci.prototype,"pbrMode",void 0),u([j({count:Ar.COUNT})],ci.prototype,"normalType",void 0),u([j()],ci.prototype,"spherical",void 0),u([j()],ci.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],ci.prototype,"hasVertexColors",void 0),u([j()],ci.prototype,"hasNormals",void 0),u([j()],ci.prototype,"hasSlicePlane",void 0),u([j()],ci.prototype,"hasBaseColorTexture",void 0),u([j()],ci.prototype,"receiveAmbientOcclusion",void 0),u([j()],ci.prototype,"receiveShadows",void 0),u([j()],ci.prototype,"blendingEnabled",void 0),u([j()],ci.prototype,"hasScreenSpaceReflections",void 0),u([j()],ci.prototype,"hasPolygonOffset",void 0),u([j()],ci.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([j()],ci.prototype,"hasEmissionTexture",void 0),u([j()],ci.prototype,"hasOcclusionTexture",void 0),u([j()],ci.prototype,"hasNormalTexture",void 0),u([j()],ci.prototype,"hasOccludees",void 0),u([j()],ci.prototype,"hasMultipassTerrain",void 0),u([j()],ci.prototype,"cullAboveGround",void 0),u([j()],ci.prototype,"isGround",void 0),u([j()],ci.prototype,"hasCloudsReflections",void 0),u([j()],ci.prototype,"snowCover",void 0),u([j({constValue:zi.Draw})],ci.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],ci.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],ci.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],ci.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],ci.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],ci.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],ci.prototype,"highStepCount",void 0),u([j({constValue:!1})],ci.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],ci.prototype,"useFillLights",void 0);function Ole(e,t){e.include(ux,t),e.fragment.include(UR);const i=e.fragment;i.uniforms.add(new z4("baseColor",r=>r.baseColor)),i.uniforms.add(new hTe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Rle(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Vr.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Vr.View:e.include(JS,t),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Vr.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Vr.COUNT:}switch(t.normalType){case Ar.Attribute:case Ar.CompressedAttribute:e.include(ok,t),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ar.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(JS,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ar.Ground:t.spherical?(e.include(JS,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Ar.COUNT:}}function _mt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(tZ,t);const r=t.textureCoordinateType===tn.Atlas;i.uniforms.add(nO("baseColorTexture",s=>s.texture,r)),r?(e.include(x1e),i.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const O2e=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);function bmt(e){const t=new Xi;t.include(JS,e),t.include(ok,e),t.include(ux,e),t.include(Dg,e),t.include(X3,e),t.include(mmt,e),t.include(drt,e),t.include(xKe,e),t.include(_mt,e),t.include(vmt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new Kv("view")),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||(t.include(nZ,e),e.hasNormalTexture&&t.include(fTe,e)),e.output===K.Shadow&&e.componentData===cp.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===pu.ColorOverlay||e.integratedMeshMode===pu.ColorOverlayWithWater,n=s&&e.output===K.Color&&e.pbrMode===Ot.WaterOnIntegratedMesh;return s&&(t.include(Bw,e),t.include(xpt,e),e.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(e.ellipsoidMode===Uf.Earth?$i.radius:e.ellipsoidMode===Uf.Mars?$f.radius:qg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${x.float(Do)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===K.Alpha&&(r.include(Lu),t.include(Nu,e),t.include(Ole,e),s&&r.uniforms.add(new Bt("ovColorTex",(o,a)=>iq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===K.Color&&(r.include(Lu),t.include(Nu,e),t.include(Ole,e),t.include(Rle,e),t.include(Bw,e),e.receiveShadows?(t.include(ak,e),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new Bt("ovColorTex",(o,a)=>iq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?(r.uniforms.add(new Tt("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(x`
        ${e.pbrMode===Ot.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${e.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new Xe("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),n&&r.uniforms.add(new Bt("ovNormalTex",(o,a)=>tJ(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(w_,e),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(Rle,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Ar.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===K.Highlight&&(t.include(my),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function tJ(e){return e.overlays.length===0?null:e.overlays[Fr.INNER].getValidTexture(vs.Water)}const wmt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:O2e,build:bmt,getOverlayNormalTexture:tJ},Symbol.toStringTag,{value:"Module"}));class Bk extends dr{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===cp.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=W3(t.rctx)}initializeProgram(t){const i=Bk.shader.get(),r=i.build(this.configuration);return new sr(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==pu.None,s=t===yt.NONE,n=t===yt.FrontFace;return zt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.blendingEnabled?null:s?Ru:gy(t),culling:xU(i.cullFace),depthTest:{func:b_(t)},depthWrite:s||n?Dl:null,colorWrite:ri,stencilWrite:r||i.hasOccludees?Jf:null,stencilTest:r?uit(Sl.IntegratedMeshMaskExcluded):i.hasOccludees?x_:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:XU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Bk.shader=new rr(wmt,()=>import("./ComponentShader.glsl.36d16aa0.js"));class xmt extends Bs{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class iJ{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Hr(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Ple(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class Gk{constructor(t){this._low=Ri(),this._high=Ri(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;ne(i,t),bc(r,t,i)}setElements(t,i,r){ie(Ile,t,i,r),this.set(Ile)}get(t){return pe(t,this._low,this._high)}getLowScaled(t){return oe(t,this._low,1)}}const Ile=R();class An extends xmt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=Zh(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Li(1,1,.5),this.emissiveFactor=Li(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new bN,this.componentParameters=new TO,this.textureAlphaCutoff=g4,this.alphaDiscardMode=cr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Uf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ci;const r=new Gk(t.position),s=MSe(t.rotationScale);lx(s,s),this.transformNormalGlobalFromModel=Hh(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Hi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===vu.Material&&r.transparencyPassType!=null?r.transparencyPassType:yt.NONE,n.hasMultipassTerrain=i.identifier===vu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===vu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Vr.View:Vr.None,n.hasBaseColorTexture=_(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ma.Transparent||o===Ma.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Emt(r)?tJ(r)?pu.ColorOverlayWithWater:pu.ColorOverlay:pu.NoOverlay:pu.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&M(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===pu.ColorOverlayWithWater?Ot.WaterOnIntegratedMesh:this.usePBR?a?Ot.Schematic:Ot.Normal:Ot.Disabled,n.normalType=n.integratedMeshMode===pu.None?n.hasNormals?Ar.CompressedAttribute:Ar.ScreenDerivative:Ar.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===vu.ShadowMap?(n.output=K.Shadow,n.vertexDiscardMode=$h.None):i.identifier===vu.Highlight?(n.output=K.Highlight,n.vertexDiscardMode=$h.None):(this._computeWhichMaterialPass()===Ma.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?$h.Opaque:$h.Transparent:n.vertexDiscardMode=$h.None,n.output=Tmt(i.subPass),i.subPass===Jn.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===Jn.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(Bk,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ma.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Ma.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Ma.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Ma.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),Smt(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==gn.None;h&&t.shadowMap.submitDraw(this,s,a,o),_(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&_(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return O2e}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ma.IntegratedMesh:this.objectOpacity<1?Ma.Transparent:this.componentParameters.opaqueOverride===gn.All?Ma.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===cr.Blend||this.alphaDiscardMode===cr.MaskBlend?Ma.Transparent:this.componentParameters.transparent===gn.None?Ma.Opaque:this.componentParameters.transparent===gn.All?Ma.Transparent:Ma.OpaqueAndTransparent}}var $le,Ma,gn;u([Hr({vectorOps:_pe})],An.prototype,"baseColor",void 0),u([Hr()],An.prototype,"usePBR",void 0),u([Hr()],An.prototype,"hasParametersFromSource",void 0),u([Hr({vectorOps:RK})],An.prototype,"mrrFactors",void 0),u([Hr({vectorOps:RK})],An.prototype,"emissiveFactor",void 0),u([Hr({dispose:!0})],An.prototype,"baseColorTexture",void 0),u([Hr({dispose:!0})],An.prototype,"metallicRoughnessTexture",void 0),u([Hr({dispose:!0})],An.prototype,"emissionTexture",void 0),u([Hr({dispose:!0})],An.prototype,"occlusionTexture",void 0),u([Hr({dispose:!0})],An.prototype,"normalTexture",void 0),u([Hr()],An.prototype,"objectOpacity",void 0),u([Ple()],An.prototype,"commonMaterialParameters",void 0),u([Ple()],An.prototype,"componentParameters",void 0),u([Hr()],An.prototype,"textureAlphaCutoff",void 0),u([Hr()],An.prototype,"alphaDiscardMode",void 0),u([Hr()],An.prototype,"isIntegratedMesh",void 0),u([Hr()],An.prototype,"polygonOffsetEnabled",void 0),u([Hr()],An.prototype,"ellipsoidMode",void 0),u([Hr()],An.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}($le||($le={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Ma||(Ma={}));class bN extends iJ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=hr.Back,this.hasSlicePlane=!0}}u([Hr()],bN.prototype,"doubleSided",void 0),u([Hr()],bN.prototype,"cullFace",void 0),u([Hr()],bN.prototype,"hasSlicePlane",void 0);class TO extends iJ{constructor(){super(...arguments),this.externalColor=Zh(1,1,1,1),this.externalColorMixMode=xs.Multiply,this.castShadows=gn.All}get transparent(){return this.externalColor[3]<1?gn.All:gn.None}get opaqueOverride(){return this.externalColorMixMode===xs.Replace&&this.externalColor[3]===1?gn.All:gn.None}get visible(){return this.externalColor[3]>0?gn.All:gn.None}get type(){return cp.Uniform}}u([Hr({vectorOps:_pe})],TO.prototype,"externalColor",void 0),u([Hr()],TO.prototype,"externalColorMixMode",void 0),u([Hr()],TO.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(gn||(gn={}));class SM extends iJ{constructor(){super(...arguments),this.texture=null,this.transparent=gn.None,this.opaqueOverride=gn.None,this.castShadows=gn.None}get type(){return cp.Varying}}function Tmt(e){switch(e){case Jn.Color:return K.Color;case Jn.Alpha:return K.Alpha;case Jn.Depth:return K.Depth;case Jn.Normal:return K.Normal}}function Smt(e){return e.overlays.length!==0&&_(e.overlays[Fr.INNER].getValidTexture(vs.Highlight))}function Emt(e){return e.overlays.length!==0&&_(e.overlays[Fr.INNER].getColorTextureNoRasterImage())}u([Hr()],SM.prototype,"texture",void 0),u([Hr()],SM.prototype,"transparent",void 0),u([Hr()],SM.prototype,"opaqueOverride",void 0),u([Hr()],SM.prototype,"castShadows",void 0);const YR=ns().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),R2e=ns().vec2u8(O.SIDENESS),Dle=Oc(R2e),P2e=ns().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),hq=P2e.clone().vec3f(O.NORMAL),dq=P2e.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),pq=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function Lle(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(w,S)=>{w<S?s[w+1]++:n[S+1]++};for(let w=0;w<r;w++){const S=e[3*w],T=e[3*w+1],E=e[3*w+2];o(S,T),o(T,E),o(E,S)}let a=0,l=0;for(let w=0;w<i;w++){const S=s[w+1],T=n[w+1];s[w+1]=a,n[w+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(w,S,T)=>{if(w<S){const E=s[w+1]++;c[2*E]=S,c[2*E+1]=T}else{const E=n[S+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=T}};for(let w=0;w<r;w++){const S=e[3*w],T=e[3*w+1],E=e[3*w+2];p(S,T,w),p(T,E,w),p(E,S,w)}const f=(w,S)=>{const T=2*w,E=S-w;for(let C=1;C<E;C++){const A=c[T+2*C],I=c[T+2*C+1];let L=C-1;for(;L>=0&&c[T+2*L]>A;L--)c[T+2*L+2]=c[T+2*L],c[T+2*L+3]=c[T+2*L+1];c[T+2*L+2]=A,c[T+2*L+3]=I}};for(let w=0;w<i;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*r),y=(w,S)=>w===e[3*S]?0:w===e[3*S+1]?1:w===e[3*S+2]?2:-1,v=(w,S)=>{const T=y(w,S);m[3*S+T]=-1},b=(w,S,T,E)=>{const C=y(w,S);m[3*S+C]=E;const A=y(T,E);m[3*E+A]=S};for(let w=0;w<i;w++){let S=s[w];const T=s[w+1];let E=n[w];const C=n[w+1];for(;S<T&&E<C;){const A=c[2*S],I=c[2*h+2*E];A===I?(b(w,c[2*S+1],I,c[2*h+2*E+1]),S++,E++):A<I?(v(w,c[2*S+1]),S++):(v(I,c[2*h+2*E+1]),E++)}for(;S<T;)v(w,c[2*S+1]),S++;for(;E<C;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}function V4(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:Cmt(e.layout)}}function aD(e){return Amt(e.layout).createView(e.buffer)}function Cmt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=ye(F({},i),{constructor:I2e(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function Amt(e){const t=ns();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],ye(F({},i[1]),{constructor:Omt(i[1].constructor)}))),t}const Mmt=[D3,qh,bi,Un,vp,G2,j2,H2,Mr,Rw,e_,t_,ty,Pw,i_,Ll,Iw,q2,$w,r_,Dw,W2,fR,mR,X2,Lw,gR,yR,vR,Nw,_R,bR,wR,xR,TR,SR];function I2e(e){return`${e.ElementType}_${e.ElementCount}`}function Omt(e){return $2e.get(e)}const $2e=new Map;Mmt.forEach(e=>$2e.set(I2e(e),e));class D2e{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?Pmt:Rmt}write(t,i,r){const s=this.edgeHashFunction(r);cD.seed=s;const n=cD.getIntRange(0,255),o=cD.getIntRange(0,this.settings.variants-1),a=.7,l=cD.getFloat(),c=255*(.5*Imt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const rJ=new Float32Array(6),B4=new Uint32Array(rJ.buffer),Tv=new Uint32Array(1);function Rmt(e){const t=rJ;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Tv[0]=5381;for(let i=0;i<B4.length;i++)Tv[0]=31*Tv[0]+B4[i];return Tv[0]}function Pmt(e){const t=rJ;t[0]=cT(e.position0[0]),t[1]=cT(e.position0[1]),t[2]=cT(e.position0[2]),t[3]=cT(e.position1[0]),t[4]=cT(e.position1[1]),t[5]=cT(e.position1[2]),Tv[0]=5381;for(let i=0;i<B4.length;i++)Tv[0]=31*Tv[0]+B4[i];return Tv[0]}const Nle=1e4;function cT(e){return Math.round(e*Nle)/Nle}function Imt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class G4{constructor(){this.commonWriter=new D2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return hq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),pe(lD,r.faceNormal0,r.faceNormal1),we(lD,lD),t.normal.setVec(i,lD)}trim(t,i){return this.commonWriter.trim(t,i)}}G4.Layout=hq,G4.glLayout=Oc(hq,1);class j4{constructor(){this.commonWriter=new D2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return dq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}j4.Layout=dq,j4.glLayout=Oc(dq,1);const lD=R(),cD=new Th,sb=-1;var H4;function fq(e,t,i,r=Umt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Pt(r.anglePlanar),a=Pt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=mq.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,v=Fmt(e),b=Nmt(e),w=b.length/4,S=t.allocate(w);let T=0;const E=w,C=i.allocate(E);let A=0,I=0,L=0;const D=mCe(0,w),k=new Float32Array(w);vCe(k,(le,re,$)=>{s.getVec(b[4*re+0],p),s.getVec(b[4*re+1],f),$[re]=ur(p,f)}),D.sort((le,re)=>k[re]-k[le]);const z=new Array,V=new Array;for(let le=0;le<w;le++){const re=D[le],$=k[re],U=b[4*re+0],B=b[4*re+1],H=b[4*re+2],W=b[4*re+3],Q=W===sb;if(s.getVec(U,p),s.getVec(B,f),Q)ie(m,v[3*H+0],v[3*H+1],v[3*H+2]),ne(y,m),h.componentIndex=n.get(U),h.cosAngle=Se(m,y);else{if(ie(m,v[3*H+0],v[3*H+1],v[3*H+2]),ie(y,v[3*W+0],v[3*W+1],v[3*W+2]),h.componentIndex=n.get(U),h.cosAngle=Se(m,y),Dmt(h,c))continue;h.cosAngle<-.9999&&ne(y,m)}I+=$,L++,Q||$mt(h,l)?(t.write(S,T++,h),z.push($)):Lmt(h,o)&&(i.write(C,A++,h),V.push($))}const X=new Float32Array(z.reverse()),Y=new Float32Array(V.reverse());return{regular:{instancesData:t.trim(S,T),lodInfo:{lengths:X}},silhouette:{instancesData:i.trim(C,A),lodInfo:{lengths:Y}},averageEdgeLength:I/L}}function $mt(e,t){return e.cosAngle<t}function Dmt(e,t){return e.cosAngle>t}function Lmt(e,t){const i=an(e.cosAngle),r=mq.fwd,s=mq.ortho;return ny(r,e.position1,e.position0),i*(Se(lt(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function Nmt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===sb||p<f?1:0,s+=c===sb||f<m?1:0,s+=h===sb||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===sb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===sb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===sb||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Fmt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=WB.v0,n=WB.v1,o=WB.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),fe(n,n,s),fe(o,o,s),lt(s,n,o),we(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(H4||(H4={}));const mq={edge:{position0:R(),position1:R(),faceNormal0:R(),faceNormal1:R(),componentIndex:0,cosAngle:0},ortho:R(),fwd:R()},WB={v0:R(),v1:R(),v2:R()},Umt={anglePlanar:4,angleSignificantEdge:35};class L2e{async extract(t){const i=XB(t),r=sJ(i),s=[i.data.buffer];return{result:kmt(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=XB(t),r=gq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=fq(r,Gmt,kle),n=[];return{result:V4(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=XB(t),r=gq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=fq(r,Bmt,kle),n=[];return{result:V4(s.regular.instancesData,n),transferList:n}}}function sJ(e){const t=gq(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Fle.updateSettings(e.writerSettings),Ule.updateSettings(e.writerSettings),fq(t,Fle,Ule)}function XB(e){return{data:YR.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function kmt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:V4(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:V4(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function gq(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:Lle(i,r,e.count),vertices:e};const s=wxe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Lle(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:YR.createView(s.buffer)}}const Fle=new G4,Ule=new j4;class zmt{allocate(t){return N2e.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class Vmt{allocate(t){return nJ.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const Bmt=new zmt,Gmt=new Vmt,kle={allocate:()=>null,write:()=>{},trim:()=>null},N2e=ns().vec3f(O.POSITION0).vec3f(O.POSITION1),nJ=ns().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});function jmt(){return new L2e}var Hmt=Object.freeze(Object.defineProperty({__proto__:null,EdgeProcessingWorker:L2e,default:jmt,extract:sJ,extractComponentsEdgeLocationsLayout:nJ,extractEdgeLocationsLayout:N2e},Symbol.toStringTag,{value:"Module"}));class qmt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class Wmt{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new ot(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new Ll(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new Ll(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const F2e=65536;class Xmt{constructor(t,i=1){this.textureBuffer=new Wmt(t,i),this.indexManager=new qmt(F2e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class U2e{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>F2e)return null;const i=new Xmt(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const zle=de.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Ymt{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new It,new It],this._renderSubmit=new dmt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new U2e(t.rctx,2)}dispose(){pt(this._objects[o2.Hidden].length===0&&this._objects[o2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new cq;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=_le(t.obb),i.components=new Xft(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new tmt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=_n(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:DQ(),externalColorMixMode:xs.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,v=n.verticalOffsets,b=1/0,w=-1/0,S=!1,T=!1,E=0;for(let C=0;C<n.count;C++)i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===xs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,lTe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),S||(S=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&M(v)&&(v=new Array(C).fill(0)),_(v)&&(v[C]=l.elevationOffset),b=Math.min(b,l.elevationOffset),w=Math.max(w,l.elevationOffset),M2e(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]),l.pickable!==S2e(n.pickability,C)&&(n.pickability=Zft(n.pickability,n.count,C,l.pickable));n.verticalOffsets=T?v:null,r.offsetObb=T?kft(r.obb,b,w,this._viewingMode,_(r.offsetObb)?r.offsetObb:_le(r.obb)):null,S||T?(s.componentParameters=new SM,s.componentParameters.castShadows=YB(y,n.count),s.componentParameters.transparent=YB(f,n.count),s.componentParameters.opaqueOverride=YB(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new TO,s.componentParameters.castShadows=l.castShadows?gn.All:gn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||M(o))return r;const a=o[i];if(this._viewingMode===Ge.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=oYe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=lx(Vle,a.transform.rotationScale);bc(uD,i,a.transform.position),bc(hD,r,a.transform.position),Oo(uD,uD,l),Oo(hD,hD,l);const c=Hh(Vle,l);return a.intersectionGeometry.intersect(uD,hD,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:_ft(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:nJ.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=YR.createBuffer(a.count);tP(c.position,a),Yh(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:rs(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;M(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(M(r.highlightCounts))return void zle.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else zle.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[o2.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=ai.createVertex(r,Ci.STATIC_DRAW,s.vertices.data),a=Qs(s.indices,v=>ai.createIndex(r,Ci.STATIC_DRAW,v)),l=Oc(pmt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const b=i.offsets[v],w=i.offsets[v+1],S=i.materialDataIndices[v];if(_(s.indices))for(let T=b;T<w;T++)c[s.indices[T]]=S;else for(let T=b;T<w;T++)c[T]=S}const h=ai.createVertex(r,Ci.STATIC_DRAW,c.buffer),p=new An(t.transform,t.toMapSpace),f=new zs(r,p.attributeLocations,{data:l,componentIndices:Zmt},{data:o,componentIndices:h},a),m=new C2e(f,$t.TRIANGLES,n,_(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new smt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Zmt=Oc(ns().u16(O.COMPONENTINDEX));function YB(e,t){return e===t?gn.All:e===0?gn.None:gn.Some}const Vle=kg(),uD=R(),hD=R();class k2e extends Bs{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function Qmt(e){const t=new Xi;t.include(__);const i=t.fragment;switch(e.function){case fc.Standard:i.uniforms.add(new Bt("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new Xe("opacity",r=>r.opacity)),i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case fc.OverlayWithTransparency:i.uniforms.add(new Bt("tex",r=>r.texture)),i.uniforms.add(new Y3("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new Xe("opacity",r=>r.opacity)),i.code.add(x`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case fc.TransparentToHUDVisibility:i.uniforms.add(new Bt("tex",r=>r.texture)),i.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case fc.Transparency:i.uniforms.add([new Bt("colorTexture",r=>r.colorTexture),new Bt("alphaTexture",r=>r.alphaTexture),new Bt("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case fc.COUNT:break;default:e.function}return t}const Jmt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:k2e,build:Qmt},Symbol.toStringTag,{value:"Module"}));class ZR extends dr{initializeProgram(t){const i=ZR.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){if(this.configuration.function===fc.TransparentToHUDVisibility)return zt({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case Mo.None:return zt({colorWrite:ri});case Mo.Alpha:return zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri});default:return zt({blending:lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}}ZR.shader=new rr(Jmt,()=>import("./Compositing.glsl.6b16d716.js"));class Kmt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new eN,this._passParameters=new k2e}dispose(){this._vao=Je(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=Mo.Alpha,this._configuration.function=fc.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(ZR,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays($t.TRIANGLE_STRIP,0,Po(l,"geometry")),a.release()}composite(t,i,r=Mo.None,s=1,n=fc.Standard,o=Fr.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(ZR,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays($t.TRIANGLE_STRIP,0,Po(c,"geometry")),l.release()}_ensureVAO(){return M(this._vao)&&(this._vao=qa(this._rctx)),this._vao}}const egt=1e4,yq=100,tgt=500,igt=500,rgt=.1;function sgt(e,t,i){return ZZ(t,e)*(i[1]-i[0])+i[0]}function ngt(e,t,i){if(t.size<egt)return pgt.compute(e,t);const r=rP();return i.forAll(s=>{s.isVisible&&hE(r,ogt(e,s))}),r}function ogt(e,t){if(!t.isVisible)return;const i=rP(),r=t.getSpatialQueryAccelerator();return _(r)?agt(i,e,r):lgt(i,e,t.objects),i}function agt(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<tgt)XR(bh,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,ip.DepthOrder.FRONT_TO_BACK,bh,(l,c)=>{vq(e,t,l),bh.far=e.near,c.setRange(bh)},n,o),XR(bh,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,ip.DepthOrder.BACK_TO_FRONT,bh,(l,c)=>{vq(e,t,l),bh.near=e.far,c.setRange(bh)},n,o);else{const l=Math.max(Math.min(a,igt),Math.ceil(a*rgt)),c=i.findClosest(s,ip.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,ip.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Ble(e,t,c.boundingVolumeWorldSpace.bounds),Ble(e,t,h.boundingVolumeWorldSpace.bounds))}}function lgt(e,t,i){uT.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&uT.add(r)}),uT.empty||(uT.sort(t),XR(bh,t.near,Math.min(e.near,t.far)),uT.forEachInDepthRange(bh,ip.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&vq(e,t,r)}),XR(bh,Math.max(e.far,t.near),t.far),uT.forEachInDepthRange(bh,ip.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function vq(e,t,i){if(!i.isVisible||!vv(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=dgt;i.geometryRecords.forEach(n=>{Dr(s,r,n.getShaderTransformation());const o=Tw(s);z2e(e,t,n.geometry.boundingInfo,s,o)})}function z2e(e,t,i,r,s){if(M(i))return;const n=t.eye,o=t.viewForward;ke(Co,i.center,r);const a=o[0]*(Co[0]-n[0])+o[1]*(Co[1]-n[1])+o[2]*(Co[2]-n[2]);if(Co[3]=i.radius*s,!(a-Co[3]>e.near&&a+Co[3]<e.far)&&vv(t.frustum,Co))if(i.radius>yq&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&z2e(e,t,l[c],r,s)}else _q.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Ble(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class cgt{constructor(){this._items=new It({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===ip.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class ugt{constructor(){this.view=Ee(),this.viewProj=Ee(),this.frustum=AR(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),ws(this.view,t.viewMatrix),Dr(this.viewProj,t.projectionMatrix,this.view),e4(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),Co,1),y=Co):y=m.boundingSphere;const v=s*y[0]+n*y[1]+o*y[2]+a,b=v-y[3],w=v+y[3];this.geometries[c]=m,this.near[c]=-w,this.far[c]=-b,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,y)=>this.near[m]<this.near[y]?-1:this.near[m]>this.near[y]?1:0),this.farCandidates.sort((m,y)=>this.far[m]<this.far[y]?1:this.far[m]>this.far[y]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const y=this.nearCandidates[m];if(this.near[y]<l.near){const v=this.geometries[y],b=v.boundingInfo;this._includeNearBoundingInfoRec(b,v.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const y=this.farCandidates[m];if(this.far[y]>l.far){const v=this.geometries[y],b=v.boundingInfo;this._includeFarBoundingInfoRec(b,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(M(t))return;const r=t.getCenter();ke(Co,r,i);const s=Tw(i),n=Co[0],o=Co[1],a=Co[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>yq){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],i);return}}_q.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(M(t))return;let r=t.getBSRadius();const s=t.getCenter();ke(Co,s,i);const n=Tw(i),o=Co[0],a=Co[1],l=Co[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>yq){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}_q.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class hgt{constructor(){this.modelViewProj=Ee(),this.clipPosition=[qt(),qt(),qt(),qt(),qt(),qt(),qt(),qt()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;Dr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[ZB[l][0]],h=this.clipPosition[ZB[l][1]],p=this.clipPosition[ZB[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const v=f[y][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void pt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),_5(qt(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const ZB=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Co=bn(),dgt=Ee(),bh=rP(),uT=new cgt,pgt=new ugt,_q=new hgt;class fgt extends Bs{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function mgt(){const e=new Xi;return e.attributes.add(O.POSITION,"vec2"),e.vertex.uniforms.add(new Ua("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new kr("textureInput")),e.fragment.uniforms.add(new kr("textureMask")),e.fragment.uniforms.add(new kr("textureOverlay")),e.fragment.uniforms.add(new Ow("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new Ow("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function ggt(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=yp((await t).default,{signal:e}),s=yp((await i).default,{signal:e}),n={mask:await r,overlay:await s};return Wt(e),n}let iS=class extends Ae{constructor(){super(...arguments),this._handles=new si,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new fgt,this.events=new Zr,this.attributeLocations=new Map([[O.POSITION,0]]),this.tmpScreenPoint=Wr(),this.tmpRenderPoint=A$e()}get updating(){return M(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(ae(()=>Qs(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(M(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),M(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;vg(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=Ne(h[0],p,l-p-1),h[1]=Ne(h[1],f,c-f-1);const m=Math.floor(h[0]-p),y=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0);const v=i.offset.x*r,b=i.offset.y*r,w=(h[0]+v)/l*2-1,S=(h[1]-b)/c*2-1,T=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",w,S,T,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays($t.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(M(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:a3(async r=>{const s=M(t)||M(i)?ggt(r):null,n=_(t)?yp(t,{signal:r}):s.then(a=>a.mask),o=_(i)?yp(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(M(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);M(i)||(this._resources={textures:i,program:this._createProgram(e),vao:qa(e,YY,this.attributeLocations,0,1),pipelineState:zt({blending:lm(Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ri})})}_disposeResources(){M(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(M(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0,preMultiplyAlpha:!iW(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!0},this._imageSources.mask);return{input:new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new sr(e,mgt(),this.attributeLocations)}};u([d()],iS.prototype,"_imageSources",void 0),u([d()],iS.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],iS.prototype,"updating",null),iS=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],iS);const ygt=.5,vgt=1e3/30;var QR;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(QR||(QR={}));class Ky{constructor(t,i,r=QR.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new It({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===yt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=wN.get(c.indexType);for(let y=0;y<f;y+=2){const v=p[y],b=p[y+1];r.drawElements(h.primitiveType,b,c.indexType,v*m)}}else for(let m=0;m<f;m+=2){const y=p[m],v=p[m+1];r.drawArrays(h.primitiveType,y,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===QR.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const wN=new Map;wN.set(dt.UNSIGNED_BYTE,1),wN.set(dt.UNSIGNED_SHORT,2),wN.set(dt.UNSIGNED_INT,4);class _gt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new vpt,this._shadowPassParameters=new _pt,this._highlightPassParameters=new bpt,this._systems=new Set,this._passes={materialOpaque:new Ky(t,i),materialTransparent:new Ky(t,i,QR.BackToFront),materialIntegratedMesh:new Ky(t,i),shadowMap:new Ky(t,i),highlight:new Ky(t,i),highlightIntegratedMesh:new Ky(t,i),highlightShadowMap:new Ky(t,i),defaultShadowMap:new Ky(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Te.OPAQUE_MATERIAL:switch(t.pass){case Be.MATERIAL:return this._materialPassParameters.subPass=Jn.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Jn.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Jn.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Te.TRANSPARENT_MATERIAL:switch(t.pass){case Be.MATERIAL:return this._materialPassParameters.subPass=Jn.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Jn.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Jn.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Jn.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Te.INTEGRATED_MESH:switch(t.pass){case Be.MATERIAL:return this._materialPassParameters.subPass=Jn.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Jn.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Jn.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Be.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL,Te.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&hE(i,s,i)}),i}_configure(t){const i=t.pass===Be.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===Be.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;ie(QB,s[3],s[7],s[11]),JB.set(QB),ne(i.transformWorldFromViewTH,JB.high),ne(i.transformWorldFromViewTL,JB.low),ne(i.slicePlaneLocalOrigin,QB),Sc(i.transformViewFromCameraRelativeRS,r.viewMatrix),ws(i.transformProjFromView,r.projectionMatrix),i.identifier===vu.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Te.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Te.INTEGRATED_MESH,Hh(Gle,i.transformViewFromCameraRelativeRS),lx(i.transformNormalViewFromGlobal,Gle))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const QB=R(),Gle=ir(),JB=new Gk,bgt=8.6,wgt=.4;function xgt(){const e=new Xi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(O.UV0,"vec2"),t.uniforms.add(new Bt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Bt("tex",n=>n.blurColorTexture)),i.uniforms.add(new Bt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new oi("uColor",n=>n.color)),i.uniforms.add(new oi("haloColor",n=>n.haloColor)),i.uniforms.add(new oi("opacities",n=>Ji(Tgt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",bgt),i.constants.add("blurSize","float",wgt),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const Tgt=qt(),Sgt=Object.freeze(Object.defineProperty({__proto__:null,build:xgt},Symbol.toStringTag,{value:"Module"}));class jk extends dr{initializeProgram(t){const i=jk.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}jk.shader=new rr(Sgt,()=>import("./HighlightApply.glsl.fde88336.js"));class V2e extends Bs{constructor(){super(...arguments),this.blurSize=st()}}function Egt(){const e=new Xi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Bt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new iZ("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new rZ("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const Cgt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:V2e,build:Egt},Symbol.toStringTag,{value:"Module"}));class Hk extends dr{initializeProgram(t){const i=Hk.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({colorWrite:ri})}}Hk.shader=new rr(Cgt,()=>import("./HighlightBlur.glsl.1e379f08.js"));class B2e extends Bs{constructor(){super(...arguments),this.invFramebufferDim=st()}}function Agt(){const e=new Xi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(O.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new rZ("tex",n=>n.inputTexture)),i.uniforms.add(new iZ("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const Mgt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:B2e,build:Agt},Symbol.toStringTag,{value:"Module"}));class qk extends dr{initializeProgram(t){const i=qk.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({colorWrite:ri})}}qk.shader=new rr(Mgt,()=>import("./HighlightDownsample.glsl.4987d55e.js"));class jle extends Bs{constructor(){super(...arguments),this.color=Zh(1,0,1,1),this.haloColor=Zh(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=vi(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const Ogt=32;class Rgt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=qt(),this._passParameters=new jle,this._downsampleDrawParameters=new B2e,this._blurDrawParameters=new V2e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=qa(this._rctx);const t={colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE,width:0,height:0},i={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Cr(this._rctx,t,i),this.blur1Fbo=new Cr(this._rctx,t,i);const r=new Ha;this._blurTechnique=this._techniqueRep.acquire(Hk,r),this._downsampleTechnique=this._techniqueRep.acquire(qk,r),this._applyTechnique=this._techniqueRep.acquire(jk,r)}dispose(){if(this._blurTechnique=Hi(this._blurTechnique),this._downsampleTechnique=Hi(this._downsampleTechnique),this._applyTechnique=Hi(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Je(this.blur0Fbo),this.blur1Fbo=Je(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=F(F({},new jle),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;Zd(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,Ogt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Ki.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,fi(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,Po(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(Ki.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,fi(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,Po(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,Po(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:ft.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Et.UNSIGNED_SHORT_5_6_5,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Cr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let v=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)y[v+0]=(w-.5)*p*2-1,y[v+1]=(b-.5)*h*2-1,y[v+2]=w*p,y[v+3]=b*h,y[v+4]=(w+.5)*p*2-1,y[v+5]=(b-.5)*h*2-1,y[v+6]=w*p,y[v+7]=b*h,y[v+8]=(w-.5)*p*2-1,y[v+9]=(b+.5)*h*2-1,y[v+10]=w*p,y[v+11]=b*h,y[v+12]=(w-.5)*p*2-1,y[v+13]=(b+.5)*h*2-1,y[v+14]=w*p,y[v+15]=b*h,y[v+16]=(w+.5)*p*2-1,y[v+17]=(b-.5)*h*2-1,y[v+18]=w*p,y[v+19]=b*h,y[v+20]=(w+.5)*p*2-1,y[v+21]=(b+.5)*h*2-1,y[v+22]=w*p,y[v+23]=b*h,v+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new zs(r,Vi,{geometry:I3},{geometry:ai.createVertex(r,Ci.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,fi(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays($t.TRIANGLE_STRIP,0,Po(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const Pgt={dataType:Et.UNSIGNED_BYTE,internalFormat:ze.RGBA},Igt={};class $gt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new ot(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Et.UNSIGNED_INT_24_8,samplingMode:it.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new ZT(this.rctx,F({internalFormat:Da.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new ot(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return F(F({id:wl()},Igt),t)}registerColorTarget(t={}){return F(F({id:wl()},Pgt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.DEPTH_STENCIL_TEXTURE},o,l):new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:r?Pi.DEPTH_STENCIL_RENDER_BUFFER:Pi.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=Mw(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class Dgt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===pi.WEBGL2;this._renderTargetHelper=new $gt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Et.FLOAT,internalFormat:r?gt.RGBA32F:ze.RGBA,samplingMode:it.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:it.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?gt.RGBA4:ze.RGBA,dataType:Et.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?gt.RGBA4:ze.RGBA,dataType:Et.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Ki.COLOR_BUFFER_BIT|Ki.DEPTH_BUFFER_BIT|Ki.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,Mo.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,Lgt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,Ngt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Mo.None,1,fc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case yt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case yt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case yt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Mo.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Mo.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Ki.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=Ki.COLOR_BUFFER_BIT}return n&&(c|=Ki.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=Ki.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const Lgt=[0,0,0,0],Ngt=[0,1,0,1];class Fgt{constructor(t){this.context=t,this._renderPlugins=new It,this.slots=[];for(let i=0;i<Te.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),hi();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(Fu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(Ugt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=kgt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&hE(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Te.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function Ugt(e){return"prepareTechnique"in e}const kgt={near:0,far:0};class G2e extends jxe{}const Wk=255,zgt=1/Wk;function Vgt(){const e=new Xi,t=e.fragment;return t.include(Mc),t.include(Lu),e.include(hk),e.include(__),e.include(ak,{receiveShadows:!0}),t.uniforms.add([new Bt("depthMap",i=>i.linearDepthTexture),new xr("inverseViewMatrix",(i,r)=>Xr(Hle,ca(Hle,r.camera.viewMatrix,r.camera.center))),new mi("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",zgt),t.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Hle=Ee(),Bgt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:G2e,shadowCastMaxSamples:Wk,build:Vgt},Symbol.toStringTag,{value:"Module"}));var Ww;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(Ww||(Ww={}));class bq extends Ha{constructor(){super(...arguments),this.visualization=Ww.Gradient,this.bandsEnabled=!1}}u([j({count:Ww.COUNT})],bq.prototype,"visualization",void 0),u([j()],bq.prototype,"bandsEnabled",void 0);function Ggt(e){const t=new Xi,i=t.fragment;i.include(Mc),i.include(Lu),t.include(hk),t.include(__);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",Wk),i.uniforms.add([new Bt("shadowCastMap",a=>a.shadowCastMap),new Xe("sampleScale",a=>a.sampleScale),new Xe("opacityFromElevation",a=>a.opacityFromElevation),new oi("uColor",a=>a.color)]);const n=r===Ww.Gradient,o=r===Ww.Threshold;return n&&s?i.uniforms.add(new Xe("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Xe("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),t}const jgt=Object.freeze(Object.defineProperty({__proto__:null,build:Ggt},Symbol.toStringTag,{value:"Module"}));class Xk extends dr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=Xk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:Ru,colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Xk.shader=new rr(jgt,()=>import("./ShadowCastVisualize.glsl.f33dd282.js"));const Hgt=vi(.01,0,.25,1),qgt=4e4,Wgt=5e4,j2e=1/512;let xN=class extends Ae{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:Hgt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new bq,this._enabled=!1,this._vao=qa(t),this._techniqueConfig.visualization=Ww.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Je(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(Xk,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,Po(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>j2e}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;LO(e,t)||(Zd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],xN.prototype,"opacityFromElevation",null),xN=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],xN);class Yk extends dr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=Yk.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:uo(Oe.ONE,Oe.ONE,Oe.ONE,Oe.ONE),colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Yk.shader=new rr(Bgt,()=>import("./ShadowCastAccumulate.glsl.1b8b27a7.js"));var EM;let Qo=EM=class extends Ae{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new G2e,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=uq,this._previewing=!1,this._handles=new si,this._cameraForcedForScreenshot=!1,this._bindParameters=new OU(new mQ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new qi,this._vao=qa(e);const o={colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE,width:0,height:0},a={target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Cr(e,o,a),this._accumulationRenderer=new xN(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(vt.SHADOW_ACCUMULATOR,this)),this._handles.add(ae(()=>i.renderView,c=>{this._handles.remove(EM.renderViewHandleKey),M(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),EM.renderViewHandleKey)},_s))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(M(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new Yk(e,new Ha)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==uq&&this._opacityFromElevation>j2e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Uv(t,e,hw))return;const i=e.length;t.length=i,this._sampleCount=Math.min(Wk,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||R();ne(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(EM.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Je(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Je(this._fbo),this._vao=Je(this._vao),this._accumulationTechnique=Hi(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=Xgt;return this._fbo.readPixels(e,t,1,1,ze.RGBA,Et.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Ki.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,Po(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-y2(qgt,Wgt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};Qo.previewSamples=6,Qo.renderViewHandleKey="renderView",u([d()],Qo.prototype,"_progress",void 0),u([d()],Qo.prototype,"_sampleCount",void 0),u([d()],Qo.prototype,"_enabled",void 0),u([d()],Qo.prototype,"_depthRange",void 0),u([d()],Qo.prototype,"_previewing",void 0),u([d()],Qo.prototype,"_accumulationRenderer",void 0),u([d()],Qo.prototype,"_isRefining",null),u([d()],Qo.prototype,"_isActive",null),u([d()],Qo.prototype,"canAccumulate",null),u([d()],Qo.prototype,"_isDoneAccumulating",null),u([d()],Qo.prototype,"_opacityFromElevation",null),u([d()],Qo.prototype,"running",null),Qo=EM=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Qo);const Xgt=new Uint8Array(4),qle={highlightedThreshold:.99999,selfShadowThreshold:.025};function Ygt(){const e=new Xi;e.include(Vw,{receiveShadows:!0});const t=e.fragment;return t.include(Mc),t.include(Lu),e.include(hk),e.include(__),t.uniforms.add([new Bt("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(nE.Default)),new Bt("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(nE.Highlight)),new Bt("depthMap",(i,r)=>r.linearDepthTexture),new Bt("highlightMap",(i,r)=>r.highlightColorTexture),new oi("uColor",i=>i.shadowColor),new mi("nearFar",(i,r)=>r.camera.nearFar),new Xe("opacity",i=>i.shadowOpacity),new Xe("occludedOpacity",i=>i.occludedShadowOpacity),new Xe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Tt("lightingMainDirectionView",(i,r)=>we(Xle,ke(Xle,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new mi("texelSize",(i,r)=>_(r.linearDepthTexture)?fi(Zgt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):Gh),new xr("inverseViewMatrix",(i,r)=>Xr(Wle,ca(Wle,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",Fwe).add("highlightedThreshold","float",qle.highlightedThreshold).add("selfShadowThreshold","float",qle.selfShadowThreshold),t.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Wle=Ee(),Xle=R(),Zgt=st(),Qgt=Object.freeze(Object.defineProperty({__proto__:null,build:Ygt},Symbol.toStringTag,{value:"Module"}));class Jgt extends Bs{constructor(){super(...arguments),this.shadowColor=vi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class Zk extends dr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=Zk.shader.get().build();return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({blending:uo(Oe.SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Zk.shader=new rr(Qgt,()=>import("./ShadowHighlight.glsl.8303838b.js"));const Kgt=.001953125,eyt=4e4,tyt=5e4;class iyt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Jgt,this._drawParameters=new jxe,this._vao=qa(this._rctx)}get technique(){return M(this._technique)&&(this._technique=new Zk({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,Po(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters=F(F({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-y2(eyt,tyt,t.relativeElevation);const r=this._viewingMode===Ge.Global?we(Yle,t.center):ie(Yle,0,0,1),s=Se(r,i);this._passParameters.dayNightTerminator=y2(0,1,Ne(30*s,0,1))}dispose(){this._vao=Je(this._vao),this._technique=Hi(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=Kgt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Yle=R(),Zle=y_();class ryt{constructor(){this._plane=y_()}get isEnabled(){return!zge(this.plane,Zle)}get plane(){return this._plane}set plane(t){nx(t||Zle,this._plane)}}var kf;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(kf||(kf={}));class H2e extends Ha{constructor(){super(...arguments),this.output=kf.EdgeDetector}}u([j({count:kf.COUNT})],H2e.prototype,"output",void 0);const e0={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function syt(e){const t=new Xi;return e.output===kf.EdgeDetector&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(x`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new kr("tColor")),t.fragment.code.add(x`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${x.float(e0.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${x.float(e0.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===kf.BlendWeight&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(x`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(e0.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new kr("tEdges")),t.fragment.uniforms.add(new kr("tArea")),t.fragment.uniforms.add(new kr("tSearch")),t.fragment.uniforms.add(new kr("tColor")),t.fragment.uniforms.add(new Ua("resolution")),t.fragment.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(e0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(e0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(e0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(e0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(e0.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===kf.Blur&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Ua("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(x`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new kr("tBlendWeights")),t.fragment.uniforms.add(new kr("tColor")),t.fragment.uniforms.add(new Ua("resolution")),t.fragment.code.add(x`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const nyt=Object.freeze(Object.defineProperty({__proto__:null,build:syt},Symbol.toStringTag,{value:"Module"}));class Qk extends dr{initializeProgram(t){const i=Qk.shader.get().build(this.configuration);return new sr(t.rctx,i,Vi)}initializePipeline(){return zt({colorWrite:ri})}}Qk.shader=new rr(nyt,()=>import("./SMAA.glsl.8c26387c.js"));let CM=class extends Ae{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=zh(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Wt(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,it.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,it.NEAREST,ze.LUMINANCE)]).then(([i,r])=>{bs(t)?(i.dispose(),r.dispose(),Wt(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new H2e,i=(r,s)=>this._techniqueRep.releaseAndAcquire(Qk,r,s);t.output=kf.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=kf.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=kf.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=$He(this.rctx),this._edges=new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Et.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Cr(this.rctx,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Je(this._vao),this._areaTexture=Je(this._areaTexture),this._searchTexture=Je(this._searchTexture),this._blend=Je(this._blend),this._edges=Je(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(Ki.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays($t.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(Ki.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays($t.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(Ki.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays($t.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return yp(e).then(r=>new ot(this.rctx,{pixelFormat:i,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],CM.prototype,"_abortController",void 0),u([d({readOnly:!0})],CM.prototype,"updating",null),CM=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],CM);function oyt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function ayt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class lyt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ee(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{ws(i.viewMatrix,t),ayt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class cyt extends kxe{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=ir()}}class uyt extends zxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ir(),this.slicePlaneLocalOrigin=R(),this.transformNormalGlobalFromModel=ir()}}function hyt(e){const t=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const dyt=Fi(.5,-4e-4);function pyt(e,t){const i=e.vertex;i.include(hyt),i.constants.add("depthBias","vec2",dyt),i.uniforms.add(new mi("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new Kv("localView")),i.uniforms.add(new xr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new V3("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new xr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function fyt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function myt(e,t){const i=e.vertex;t.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function gyt(e,t){const i=e.vertex;i.include(Mc),i.uniforms.add(new Xe("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new kr("componentDataTex")),i.uniforms.add(new Lg("componentDataTexInvDim")),e.attributes.add(O.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*eJ),i.code.add(x`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new hR("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(O.NORMALA,"vec3"),e.attributes.add(O.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(O.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(T4,t),i.include(T4,t),i.uniforms.add([new V3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new hR("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Va("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Va("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Tt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new xr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function q2e(e){return e.mode===Ns.SKETCH||e.mode===Ns.MIXED}var Ns;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Ns||(Ns={}));function yyt(e,t){const i=e.vertex;switch(t.mode){case Ns.SKETCH:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Ns.MIXED:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Ns.SOLID:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function oJ(e,t){const i=e.vertex;switch(e.attributes.add(O.SIDENESS,"vec2"),t.mode===Ns.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Ns.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Ns.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ns.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ns.COUNT:break;default:t.mode}}function vyt(e,t){const i=e.vertex;switch(e.include(oJ,t),q2e(t)&&i.uniforms.add(new Ui("strokesAmplitude")),t.mode){case Ns.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Ns.SKETCH:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Ns.MIXED:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function _yt(e,t){const i=e.vertex;e.include(oJ,t);const r=e.fragment;switch(q2e(t)&&(i.uniforms.add(new Lg("strokesTextureScale")),i.uniforms.add(new Ui("strokesLog2Resolution")),i.uniforms.add(new Ui("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new kr("strokesTexture")),r.uniforms.add(new Ui("strokesNormalizationScale")),i.code.add(x`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(Mc),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Ns.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Ns.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Ns.MIXED:e.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function byt(e){const t=new Xi,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new Kv("model")),e.antialiasing&&(i.code.add(x`#define ANTIALIASING 1`),r.code.add(x`#define ANTIALIASING 1`)),t.include(pyt,e),t.include(gyt,e),t.include(vyt,e),t.include(oJ,e),t.include(_yt,e),t.include(fs,e),t.include(myt,e),t.include(fyt,e),t.include(yyt,e),t.include(Nu,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new mi("pixelToNDC",(s,n)=>fi(wyt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new oi("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new Xe("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(O.POSITION0,"vec3"),t.attributes.add(O.POSITION1,"vec3"),t.attributes.add(O.VARIANTOFFSET,"float"),t.attributes.add(O.VARIANTSTROKE,"float"),t.attributes.add(O.VARIANTEXTENSION,"float"),i.code.add(x`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const wyt=st(),xyt=Object.freeze(Object.defineProperty({__proto__:null,build:byt},Symbol.toStringTag,{value:"Module"}));class Jk extends dr{initializeProgram(t){const i=Jk.shader.get().build(this.configuration);return new sr(t.rctx,i,pq)}initializePipeline(t){return t.blendMinMax?zt({blending:uo(Oe.ONE,Oe.ONE,Oe.ZERO,Oe.ONE,Jg.ADD,t.blendMinMax.MAX),depthTest:{func:fr.LEQUAL},colorWrite:ri}):zt({depthTest:{func:fr.LEQUAL},depthWrite:Dl,colorWrite:ri})}}Jk.shader=new rr(xyt,()=>import("./EdgeShader.glsl.113ce193.js"));class hf extends na{constructor(){super(...arguments),this.mode=Ns.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([j({count:Ns.COUNT})],hf.prototype,"mode",void 0),u([j()],hf.prototype,"hasSlicePlane",void 0),u([j()],hf.prototype,"silhouette",void 0),u([j()],hf.prototype,"legacy",void 0),u([j()],hf.prototype,"antialiasing",void 0),u([j()],hf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],hf.prototype,"hasMultipassTerrain",void 0),u([j()],hf.prototype,"cullAboveGround",void 0),u([j()],hf.prototype,"spherical",void 0);const Tyt=8,KB=128,Syt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class Eyt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const Cyt={solid:Ns.SOLID,sketch:Ns.SKETCH,uber:Ns.MIXED};class SO{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new hf,this.refCount=new Eyt,this.renderables=new Set,this.sortedRenderables={[Dt.TRANSPARENT]:{[Dt.TRANSPARENT]:new It,[Dt.OPAQUE]:new It},[Dt.OPAQUE]:{[Dt.TRANSPARENT]:new It,[Dt.OPAQUE]:new It}},this._renderablesDirty=!1,this._drawParameters=new uyt,this._settings=F(F({},Syt),r),this.key=SO.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Wi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Cyt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=W3(t),this._configuration.spherical=r.spherical}dispose(){this._technique=Hi(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][Dt.TRANSPARENT].forAll(t),this.sortedRenderables[i][Dt.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(Jk,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced($t.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,Ayt,Myt),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),ne(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new Gk(i.transform.position),o=Hh(Qle,lx(Qle,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;ie(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;M(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Dt.TRANSPARENT][Dt.TRANSPARENT].clear(),this.sortedRenderables[Dt.TRANSPARENT][Dt.OPAQUE].clear(),this.sortedRenderables[Dt.OPAQUE][Dt.TRANSPARENT].clear(),this.sortedRenderables[Dt.OPAQUE][Dt.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==Dt.INVISIBLE&&i.edgeTransparency!==Dt.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[Dt.TRANSPARENT][Dt.TRANSPARENT].sort(t),this.sortedRenderables[Dt.TRANSPARENT][Dt.OPAQUE].sort(t),this.sortedRenderables[Dt.OPAQUE][Dt.TRANSPARENT].sort(t),this.sortedRenderables[Dt.OPAQUE][Dt.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const Ayt="componentDataTex",Myt="componentDataTexInvDim",Qle=kg();class Oyt extends CSe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return sJ(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return aD(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return aD(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:PN(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:aD(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:aD(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function Ryt(e){const i=sA.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=sA.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=sA.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of sA.strokes){let v=m,b=y,w=p;for(let S=0;S<c;S++){S!==0&&(v=Jle(v,JR.DISTANCE),b=Jle(b,JR.PRESSURE));for(let T=0;T<sA.resolution;T++){const E=.5+(v?v[T%v.length]/a:0),C=b?b[T%b.length]:1;PR(E,s,w),PR(C,s,w+n),w+=4}w-=l*(h+1)}p+=l}const f=new ot(e,{pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:it.LINEAR,width:i,height:i,wrapMode:wt.REPEAT},s);return new Iyt(i,a,o,h,f)}function Jle(e,t){if(!e)return null;const i=e.length/2,r=Pyt*i,s=new Array(i);let n=0;const o=t===JR.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*Kle):Math.min(r,l*Kle)}return s}var JR;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(JR||(JR={}));const Pyt=.1,Kle=.5;class Iyt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Je(this.texture)}}const sA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function ece(e){let t=null;for(const i of e){const r=i.type;if($yt(i)){if(M(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function e8(e){let t=Dt.INVISIBLE;for(const{material:i}of e)if(W2e(i)){if(i.color[3]*i.opacity<1)return Dt.TRANSPARENT;t=Dt.OPAQUE}return t}function t8(e){let t=Dt.INVISIBLE;for(const{material:i}of e)if(W2e(i)){switch(i.objectTransparency){case Dt.TRANSPARENT:case Dt.INVISIBLE:return Dt.TRANSPARENT;case Dt.OPAQUE:if(i.opacity<1)return Dt.TRANSPARENT}t=Dt.OPAQUE}return t}function W2e(e){return e.size*e.color[3]*e.opacity>0}function $yt(e){return e.size*e.color[3]>0}function Dyt(e,t){const i=Eue(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function tce(e,t,i){return e.length-Dyt(e,t*i.minimumEdgeLength)}function ice(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const Lyt=de.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let Rd=class extends Ae{constructor(e){super(e),this.updatingHandles=new Df,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Dt.TRANSPARENT]:0,[Dt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=R(),this.localOrigins=new lyt(new fQ(e.renderSR))}initialize(){this.worker=new Oyt(this.schedule),this.componentColorManager=new U2e(this.rctx,3);const e=R2e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=ai.createVertex(this.rctx,Ci.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Je(this.strokesTexture),this.componentColorManager=at(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Je(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Dt.TRANSPARENT]+this.numberOfRenderedEdges[Dt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new rce(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void Lyt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new rce(new Promise(c=>n=c),o,Ig(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Fyt(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof vy,n=!!i.hasSlicePlane,o=ece(t),a=SO.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw hi();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,M(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=R(),s=new Gk;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new cyt(a,l,t);ie(r,i[3],i[7],i[11]),s.set(r),ne(c.transformWorldFromViewTH,s.high),ne(c.transformWorldFromViewTL,s.low),Sc(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Hh(sce,c.transformViewFromCameraRelativeRS),lx(c.transformNormalViewFromGlobal,sce),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=e8(e.components.meta),i=t8(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=ie(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return oyt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=Ne(Math.round(n.size*Tyt),0,255),l=Ne(n.extensionLength,-KB,255-KB)+KB,c=n.type==="solid"?H4.SOLID:H4.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],v=255*p[3];i.textureBuffer.setData(o,0,f,m,y,v),i.textureBuffer.setData(o,1,a,l,c,h),M2e(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(M(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(M(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new zs(this.rctx,pq,{vertices:Dle,instances:G4.glLayout},{vertices:this.verticesBufferObject,instances:ai.createVertex(this.rctx,Ci.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new zs(this.rctx,pq,{vertices:Dle,instances:j4.glLayout},{vertices:this.verticesBufferObject,instances:ai.createVertex(this.rctx,Ci.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(O.POSITION),l=i.indices.get(O.POSITION),c=Ee(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(M(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=YR.createBuffer(f);for(let T=0;T<f;T++)m.position.set(T,0,p.data[T*p.size+0]),m.position.set(T,1,p.data[T*p.size+1]),m.position.set(T,2,p.data[T*p.size+2]);ice(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const{regular:v,silhouette:b}=this._createEdgeResources(y),w=(v?v.vao.size:0)+(b?b.vao.size:0),S={regular:v,silhouette:b,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:w,externalMemoryUsage:!1,averageEdgeLength:y.averageEdgeLength},components:o,visible:!0,edgeTransparency:e8(o.meta),objectTransparency:t8(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=w}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(M(a))return 0;const l=ece(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=YR.createBuffer(i.count);tP(h.position,i),ice(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:y,silhouette:v}=this._createEdgeResources(m),b=(y?y.vao.size:0)+(v?v.vao.size:0),w={regular:y,silhouette:v,transform:e,statistics:{gpuMemoryUsage:b,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:e8(a.meta),objectTransparency:t8(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(w),c.addRenderable(w),b}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<e.geometries.length;w++){const S=e.geometries[w],T=e.geometryRecords[w];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const E=S.vertexAttributes.get(O.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let w=0;w<e.geometries.length;w++){const S=e.geometries[w];if(!e.geometryRecords[w].material.supportsEdges)continue;const T=S.vertexAttributes.get(O.POSITION),E=S.indices.get(O.POSITION);let C=n.get(T.data);if(C==null){C=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A+0]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,C)}if(E)for(let A=0;A<S.edgeIndicesLength;A++)h[f++]=C+E[A]}const m=a||e.geometryRecords[0],y=Ee(),v=this._computeModelTransformWithLocalOrigin(e,m,y);for(let w=0;w<e.geometryRecords.length;w++)e.geometryRecords[w].origin=v;const b={position:{data:p,size:3},indices:h,modelTransform:y,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,b,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=SO.getKey(e,t,i);let s=this.renderers.get(r);return M(this.strokesTexture)&&(this.strokesTexture=Ryt(this.rctx)),s||(s=new SO(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===Ge.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){Nyt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=R(),s=n=>{const{center:o,radius:a}=n;bc(r,o,t);const l=Se(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=tce(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Us;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=tce(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Us;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function Nyt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function Fyt(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!Uv(t,s.transformation))return!1}else t=s.transformation;if(!i&&_(s.origin))i=s;else if(_(i==null?void 0:i.origin)&&_(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],Rd.prototype,"rctx",void 0),u([d({constructOnly:!0})],Rd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Rd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Rd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Rd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Rd.prototype,"schedule",void 0),u([d({readOnly:!0})],Rd.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],Rd.prototype,"updating",null),Rd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Rd);class rce{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const sce=ir();function Uyt(e){const t=e.capabilities.disjointTimerQuery;return M(t)?null:t.timestampBits()>0?new kyt(t):wq?null:new zyt(t)}class kyt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class zyt{constructor(t){this.timer=t,this.query=t.createQuery(),wq=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),wq=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let wq=!1;var Rs;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(Rs||(Rs={}));const Vyt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class Byt extends Sv{constructor(){super("total"),this.total=0,this.frameCount=0}}class Gyt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new Byt,this.gpuTime=new Sv("gpu",9),this.renderPassTimings=Vyt.map(t=>new Sv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:zq(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=Uyt(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const nce=.9;let ig=class extends Ae{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new Gyt,this._antialiasing=wb.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new si,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new CM(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new Dgt(this._rctx,this._compositingHelper),this._sliceHelper=new ryt,this._shadowMap=new mQ(this._rctx,l.viewingMode,2),this._ssaoHelper=new Kxe(i,this._rctx,()=>this._requestRender()),this._highlight=new Rgt(i,this._rctx),this._shadowHighlight=new iyt(this._rctx,l.viewingMode),this._shadowAccumulator=new Qo(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(Be.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new bit(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new Fgt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new _gt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ae(()=>this._stage.state.camera,()=>this._requestRender(),_s),ae(()=>Wi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Dt.TRANSPARENT):()=>{},this._requestRender()},Ft)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=at(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Je(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),RU.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===wb.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return M(this._edgeView)&&(this._edgeView=new Rd({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(ae(()=>Qs(this._edgeView,e=>e.updating),()=>this._requestRender(),Qi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return nX(this._bindParameters.ssr.reprojectionMatrix,Us)}set _reprojectionMatrix(e){$q(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?wb.SMAA:wb.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=Uxe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new Zxe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=Js(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=Js(this._materialRenderers,o=>o.hasOccludees),this._hasWater=Js(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=Js(this._materialRenderers,o=>o.requiresSlot(Te.TRANSPARENT_MATERIAL,Be.MATERIAL)),this._hasHUDElements=Js(this._materialRenderers,o=>o.requiresSlot(Te.LINE_CALLOUTS_HUD_DEPTH,Be.MATERIAL)||o.requiresSlot(Te.HUD_MATERIAL,Be.MATERIAL)||o.requiresSlot(Te.LABEL_MATERIAL,Be.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=yt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=y_(this._sliceHelper.plane);r===Aw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Rs.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(Rs.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(Rs.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(Rs.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(Rs.SSAO),this._renderContext.pass=Be.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Rs.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Dt.OPAQUE),this.performanceInfo.advance(Rs.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Te.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Rs.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Te.LINE_CALLOUTS),this.performanceInfo.advance(Rs.Hudvisibility),this._renderEdges(Dt.TRANSPARENT,a),this.performanceInfo.advance(Rs.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(_h.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(_h.Occluded,s.framebuffer),this.performanceInfo.advance(Rs.HudOccluded)),this.performanceInfo.advance(Rs.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Dt.OPAQUE),this.performanceInfo.advance(Rs.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Rs.Transparent),this._renderEdges(Dt.TRANSPARENT),this.performanceInfo.advance(Rs.TransparentEdges))),a&&this._renderLineCallouts(_h.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Te.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(Rs.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Te.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Mo.PremultipliedAlpha),this.performanceInfo.advance(Rs.Laserline),this._renderOccluded(),this.performanceInfo.advance(Rs.Occluded);const h=r===Aw.ON&&this._magnifierHelper.enabled,p=h&&M(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,Mo.None),this.performanceInfo.advance(Rs.Antialiasing),this._renderHUD(_h.NotOccluded,p),this.performanceInfo.advance(Rs.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(Rs.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Mo.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===Ls.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/ygt;this._animationTimestep=Math.max(this._animationTimestep*nce+t*(1-nce),vgt)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Ki.COLOR_BUFFER_BIT|Ki.DEPTH_BUFFER_BIT|Ki.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(Be.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,Et.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,ze.RGBA,Et.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,Mo.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,nE.Highlight)),s.clear(),this._renderShadowCascades(Be.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,nE.Default),this._renderGeometryAndTransparentTerrainPass(Be.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(Be.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(Be.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=Be.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(Be.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Be.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return uq;const t=ngt(e,this._content,this._stage.layers);return hE(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Te.INTEGRATED_MESH),this._renderSlot(Te.OPAQUE_TERRAIN),this._renderInternalSlot(Te.OPAQUE_MATERIAL),this._renderSlot(Te.OPAQUE_MATERIAL),this._renderSlot(Te.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Te.TRANSPARENT_MATERIAL),this._renderSlot(Te.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Te.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Te.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===_h.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Te.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Te.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Mo.PremultipliedAlpha)):e===_h.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(_h.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Te.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Te.HUD_MATERIAL),this._renderInternalSlot(Te.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Be.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(Ki.DEPTH_BUFFER_BIT),this._renderHUDElements(_h.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=Be.MATERIAL_ALPHA,i(yt.Alpha),this._renderContext.pass=Be.MATERIAL,i(yt.Color),i(yt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=yt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===$r.OccludeAndTransparentStencil&&(e|=o.renderOccluded,oA.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};oA.length!==0&&(this._renderInternalSlot(Te.OCCLUDER_MATERIAL,oA),i(.5,$r.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Te.TRANSPARENT_OCCLUDER_MATERIAL,oA),!1,!1),oA.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===$r.OccludeAndTransparent||o.renderOccluded===$r.Transparent||o.renderOccluded===$r.Opaque)&&(e|=o.renderOccluded,nA.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>$r.Occlude&&this._renderSlot(Te.OCCLUDED_TERRAIN),this._renderInternalSlot(Te.OPAQUE_MATERIAL,nA),this._renderInternalSlot(Te.TRANSPARENT_MATERIAL,nA),this._renderInternalSlot(Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,nA),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=Be.MATERIAL,i(.5,$r.OccludeAndTransparent,()=>s($r.OccludeAndTransparent),!0,Sl.OutlineVisualElementMask),i(.5,$r.Transparent,()=>s($r.Transparent),!0,Sl.OutlineVisualElementMask),i(1,$r.Opaque,()=>s($r.Opaque),!0,Sl.OutlineVisualElementMask),nA.length=0}_renderAntiAliasing(e,t){if(e===wb.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Us:(Xr(ace,this._bindParameters.camera.viewMatrix),Xr(oce,this._bindParameters.camera.projectionMatrix),Dr(hT,ace,oce),Dr(hT,this._renderContext.lastFrameCamera.viewMatrix,hT),Dr(hT,this._renderContext.lastFrameCamera.projectionMatrix,hT),this._reprojectionMatrix=hT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=p1e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case Y0.Color:return e._offscreenRendering.colorTexture;case Y0.LinearDepth:return e._offscreenRendering.linearDepthTexture;case Y0.Normals:return e._offscreenRendering.normalTexture;case Y0.ShadowMap:return e._shadowMap.depthTexture;case Y0.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case Y0.Highlight:return e._offscreenRendering.highlightTexture}}}}};var Y0;u([d()],ig.prototype,"_shadowAccumulator",void 0),u([d()],ig.prototype,"_smaaPass",void 0),u([d()],ig.prototype,"_antialiasing",void 0),u([d()],ig.prototype,"_edgeView",void 0),u([d()],ig.prototype,"updating",null),u([d()],ig.prototype,"isCameraFinal",null),ig=u([P("esri.views.3d.webgl-engine.lib.Renderer")],ig),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(Y0||(Y0={}));const nA=[],oA=[],oce=Ee(),ace=Ee(),hT=Ee();class lce{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Oe.ONE,dstRGB:Oe.ZERO,srcAlpha:Oe.ONE,dstAlpha:Oe.ZERO},this.blendEquation={mode:Jg.ADD,modeAlpha:Jg.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=tp.BACK,this.frontFace=k2.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=fr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:tp.FRONT_AND_BACK,func:fr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:tp.FRONT_AND_BACK,fail:ss.KEEP,zFail:ss.KEEP,zPass:ss.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class jyt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const Hyt={RECORD_ALLOCATIONS:!1};class qyt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new jyt(Hyt.RECORD_ALLOCATIONS);this._current.length<vn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<vn.COUNT;++t){const i=this._current[t];i>0&&console.log(`${vn[t]}: ${i}`)}}this._allocations.print()}}const Wyt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var cce,X2e={exports:{}};(cce=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(X2e.exports=cce);const Xyt=X2e.exports;var uce,Y2e={exports:{}};uce=Y2e,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(uce.exports=t)}();const hce=Y2e.exports;var Z2e={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(Z2e);const Yyt=Z2e.exports;var hd=999,dce=9999,i8=0,r8=1,pce=2,fce=3,mce=4,dD=5,Zyt=6,Qyt=7,Jyt=8,gce=9,Kyt=10,yce=11,e0t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function t0t(){var e,t,i,r=0,s=0,n=hd,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(V){return a=[],V!==null?v(V.replace?V.replace(/\r\n/g,`
`):V):b()};function y(V){V.length&&a.push({type:e0t[n],data:V,position:h,line:l,column:c})}function v(V){var X;for(r=0,i=(m+=V).length;e=m[r],r<i;){switch(X=r,n){case i8:r=C();break;case r8:r=E();break;case pce:r=T();break;case fce:r=A();break;case mce:r=D();break;case yce:r=L();break;case dD:r=k();break;case dce:r=z();break;case gce:r=S();break;case hd:r=w()}X!==r&&(m[X]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function b(V){return o.length&&y(o.join("")),n=Kyt,y("(eof)"),a}function w(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=i8,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=r8,t=e,r+1):e==="#"?(n=pce,h=s+r,r):/\s/.test(e)?(n=gce,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?mce:f?fce:dce,r)}function S(){return/[^\s]/g.test(e)?(y(o.join("")),n=hd,r):(o.push(e),t=e,r+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=hd,r)}function E(){return T()}function C(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=hd,r+1):(o.push(e),t=e,r+1)}function A(){if(t==="."&&/\d/.test(e))return n=dD,r;if(t==="/"&&e==="*")return n=i8,r;if(t==="/"&&e==="/")return n=r8,r;if(e==="."&&o.length){for(;I(o););return n=dD,r}if(e===";"||e===")"||e==="("){if(o.length)for(;I(o););return y(e),n=hd,r+1}var V=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||V){for(;I(o););return n=hd,r}return o.push(e),t=e,r+1}function I(V){for(var X,Y,le=0;;){if(X=hce.indexOf(V.slice(0,V.length+le).join("")),Y=hce[X],X===-1){if(le--+V.length>0)continue;Y=V.slice(0,1).join("")}return y(Y),h+=Y.length,(o=o.slice(Y.length)).length}}function L(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=hd,r):(o.push(e),t=e,r+1)}function D(){return e==="."||/[eE]/.test(e)?(o.push(e),n=dD,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=yce,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=hd,r):(o.push(e),t=e,r+1)}function k(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=hd,r):(o.push(e),t=e,r+1)}function z(){if(/[^\d\w_]/.test(e)){var V=o.join("");return n=Xyt.indexOf(V)>-1?Jyt:Yyt.indexOf(V)>-1?Qyt:Zyt,y(o.join("")),n=hd,r}return o.push(e),t=e,r+1}}function i0t(e){var t=t0t(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function r0t(e){return i0t(e)}function s0t(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const s8=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function n0t(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function o0t(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function AM(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,AM(e,t,r+"_"+t[r],r);return i}function Q2e(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function a0t(e,t,i,r="lowp"){Q2e(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function l0t(e,t,i,r,s="lowp"){Q2e(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function c0t(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function vce(e,t){const i=u0t();if(_(i))return i;const r=r0t(e);if(n0t(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===du.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===du.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===du.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=AM(r,o,"fragColor"),a0t(r,s,"vec4")),c.data=s),t===du.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=c0t(r,l+1),p=AM(r,o,"fragData");l0t(r,p,"vec4",h,"mediump"),c.data=p}else t===du.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=AM(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(Wyt.includes(c.data)){if(t===du.VERTEX_SHADER&&o0t(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=AM(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&s8.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&s8.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&s8.includes(f[1].trim())&&(c.data="#if 0")}}return h0t(e,s0t(r))}function u0t(e){return null}function h0t(e,t){return t}const d0t=4294967295;class p0t{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===pi.WEBGL2&&(i=vce(i,du.VERTEX_SHADER),r=vce(r,du.FRAGMENT_SHADER)),this._vShader=_ce(this._context,du.VERTEX_SHADER,i),this._fShader=_ce(this._context,du.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(vn.Shader,this),aR()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(M(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),aR()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===pi.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<d0t&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(vn.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(vn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(vn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Bp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Bp(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Bp(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Bp(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Bp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Bp(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Bp(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Bp(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Bp(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Bp(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function _ce(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),aR()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===du.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(f0t(i))),s}function f0t(e){let t=2;return e.replace(/\n/g,()=>`
`+m0t(t++)+":")}function m0t(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Bp(e,t,i){const r=e.get(t);return r?$q(r,i):(e.set(t,Array.from(i)),!0)}class g0t{constructor(t){this._rctx=t,this._store=new dQ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new p0t(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function bce(e,t){const i=new Cr(e,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1});function r(w,S){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(T,E,new Map([["position",0]])),A=new Float32Array(6);mH(w,A,3);const I=new Float32Array(6);return mH(S,I,3),e.useProgram(C),C.setUniform3f("u_highA",A[0],A[2],A[4]),C.setUniform3f("u_lowA",A[1],A[3],A[5]),C.setUniform3f("u_highB",I[0],I[2],I[4]),C.setUniform3f("u_lowB",I[1],I[3],I[5]),C}const s=ai.createVertex(e,Ci.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new zs(e,new Map([["position",0]]),{geometry:[new ao("position",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays($t.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);i.readPixels(0,0,1,1,ze.RGBA,Et.UNSIGNED_BYTE,y),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,b=ZZ(y);return Math.abs(v-b)}var wce,xce,Tce,J2e={exports:{}};function y0t(e){var y,v,b,w,S;if(!e.gl)return!1;if(e.type===pi.WEBGL1)return!(!((y=e.capabilities.textureFloat)!=null&&y.textureFloat)||!((v=e.capabilities.colorBufferFloat)!=null&&v.textureFloat));if(!(((b=e.capabilities.textureFloat)==null?void 0:b.textureFloat)&&((w=e.capabilities.colorBufferFloat)==null?void 0:w.textureFloat)&&((S=e.capabilities.colorBufferFloat)==null?void 0:S.floatBlend)))return!1;const t=new Cr(e,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Et.FLOAT,internalFormat:gt.RGBA32F,samplingMode:it.NEAREST,width:1,height:1}),i=ai.createVertex(e,Ci.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new zs(e,new Map([["a_pos",0]]),{geometry:[new ao("a_pos",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays($t.TRIANGLE_STRIP,0,4);const f=zt({blending:kwe});e.setPipelineState(f),e.drawArrays($t.TRIANGLE_STRIP,0,4),J2e.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}wce=J2e,xce=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(v){if(r==null)for(var b in r={},s={},v)typeof v[b]=="number"&&(r[v[b]]=b,s[b]=v[b])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),r[v]!==void 0}function l(v){o();var b=r[v];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,b,w,S){var T;if((T=i[v])!==void 0&&(T=T[b])!==void 0&&T[w]){if(typeof T[w]=="object"&&T[w].enumBitwiseOr!==void 0){for(var E=T[w].enumBitwiseOr,C=0,A=[],I=0;I<E.length;++I){var L=s[E[I]];(S&L)!=0&&(C|=L,A.push(l(L)))}return C===S?A.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(v,b){for(var w="",S=b.length,T=0;T<S;++T)w+=(T==0?"":", ")+c(v,S,T,b[T]);return w}function p(v,b,w){v.__defineGetter__(w,function(){return b[w]}),v.__defineSetter__(w,function(S){b[w]=S})}function f(v,b,w,S){S=S||v,n(v),b=b||function(L,D,k){for(var z="",V=k.length,X=0;X<V;++X)z+=(X==0?"":", ")+c(D,V,X,k[X]);t("WebGL error "+l(L)+" in "+D+"("+z+")")};var T={};function E(L,D){return function(){w&&w(D,arguments);var k=L[D].apply(L,arguments),z=S.getError();return z!=0&&(T[z]=!0,b(z,D,arguments)),k}}var C={};for(var A in v)if(typeof v[A]=="function")if(A!="getExtension")C[A]=E(v,A);else{var I=E(v,A);C[A]=function(){return f(I.apply(v,arguments),b,w,S)}}else p(C,v,A);return C.getError=function(){for(var L in T)if(T.hasOwnProperty(L)&&T[L])return T[L]=!1,L;return v.NO_ERROR},C}function m(v){var b=v.getParameter(v.MAX_VERTEX_ATTRIBS),w=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,w);for(var S=0;S<b;++S)v.disableVertexAttribArray(S),v.vertexAttribPointer(S,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(S,0);v.deleteBuffer(w);var T=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)v.activeTexture(v.TEXTURE0+S),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function y(v){var b,w,S=[],T=[],E={},C=1,A=!1,I=[],L=0,D=0,k=!1,z=0,V={};function X(G){return typeof G=="function"?G:function(ee){G.handleEvent(ee)}}v.getContext=(w=v.getContext,function(){var G=w.apply(v,arguments);if(G instanceof WebGLRenderingContext){if(G!=b){if(b)throw"got different context";E=Q(b=G)}return E}return G});var Y=function(G){S.push(X(G))},le=function(G){T.push(X(G))};function re(G){var ee=G.addEventListener;G.addEventListener=function(me,_e,Me){switch(me){case"webglcontextlost":Y(_e);break;case"webglcontextrestored":le(_e);break;default:ee.apply(G,arguments)}}}function $(){for(var G=Object.keys(V),ee=0;ee<G.length;++ee)delete V[G]}function U(){++D,A||L==D&&v.loseContext()}function B(G,ee){var me=G[ee];return function(){if(U(),!A)return me.apply(G,arguments)}}function H(){for(var G=0;G<I.length;++G){var ee=I[G];ee instanceof WebGLBuffer?b.deleteBuffer(ee):ee instanceof WebGLFramebuffer?b.deleteFramebuffer(ee):ee instanceof WebGLProgram?b.deleteProgram(ee):ee instanceof WebGLRenderbuffer?b.deleteRenderbuffer(ee):ee instanceof WebGLShader?b.deleteShader(ee):ee instanceof WebGLTexture&&b.deleteTexture(ee)}}function W(G){return{statusMessage:G,preventDefault:function(){k=!0}}}return re(v),v.loseContext=function(){if(!A){for(A=!0,L=0,++C;b.getError(););$(),V[b.CONTEXT_LOST_WEBGL]=!0;var G=W("context lost"),ee=S.slice();setTimeout(function(){for(var me=0;me<ee.length;++me)ee[me](G);z>=0&&setTimeout(function(){v.restoreContext()},z)},0)}},v.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!k)throw"can not restore. webglcontestlost listener did not call event.preventDefault";H(),m(b),A=!1,D=0,k=!1;for(var G=T.slice(),ee=W("context restored"),me=0;me<G.length;++me)G[me](ee)},0)},v.loseContextInNCalls=function(G){if(A)throw"You can not ask a lost contet to be lost";L=D+G},v.getNumCalls=function(){return D},v.setRestoreTimeout=function(G){z=G},v;function Q(G){for(var ee in G)typeof G[ee]=="function"?E[ee]=B(G,ee):p(E,G,ee);E.getError=function(){if(U(),!A)for(;Ce=b.getError();)V[Ce]=!0;for(var Ce in V)if(V[Ce])return delete V[Ce],Ce;return E.NO_ERROR};for(var me=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],_e=0;_e<me.length;++_e){var Me=me[_e];E[Me]=function(Ce){return function(){if(U(),A)return null;var $e=Ce.apply(G,arguments);return $e.__webglDebugContextLostId__=C,I.push($e),$e}}(G[Me])}var ve=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(_e=0;_e<ve.length;++_e)Me=ve[_e],E[Me]=function(Ce){return function(){return U(),A?null:Ce.apply(G,arguments)}}(E[Me]);var ge=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(_e=0;_e<ge.length;++_e)Me=ge[_e],E[Me]=function(Ce){return function(){return U(),!A&&Ce.apply(G,arguments)}}(E[Me]);return E.checkFramebufferStatus=function(Ce){return function(){return U(),A?E.FRAMEBUFFER_UNSUPPORTED:Ce.apply(G,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ce){return function(){return U(),A?-1:Ce.apply(G,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ce){return function(){return U(),A?0:Ce.apply(G,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}},(Tce=xce())!==void 0&&(wce.exports=Tce);const v0t=de.getLogger("esri.views.WebGLDriverTest");function _0t(e){const t=new Cr(e,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=ai.createVertex(e,Ci.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new zs(e,new Map([["a_position",0]]),{geometry:[new ao("a_position",2,dt.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays($t.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,ze.RGBA,Et.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&v0t.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),y}new ao("a_pos",2,dt.BYTE,0,2);new ao("a_pos",2,dt.BYTE,0,4),new ao("a_tex",2,dt.BYTE,2,4);const b0t={geometry:[new ao("a_pos",2,dt.UNSIGNED_SHORT,0,4)]};async function w0t(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new Cr(e,{colorTarget:is.TEXTURE,depthStencilTarget:Pi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:it.NEAREST,width:1,height:1}),r=ai.createVertex(e,Ci.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new zs(e,new Map([["a_pos",0]]),b0t,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{dataType:Et.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:it.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(Ki.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays($t.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,Et.UNSIGNED_BYTE,y),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",y[0]===255}class x0t{constructor(t){this.context=t,this._floatBufferBlendWorking=y0t(t),w0t(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(M(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(M(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(M(this._doublePrecisionRequiresObfuscation)){const t=bce(this.context,!1),i=bce(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return M(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=_0t(this.context)),this._ignoresSamplerPrecision}}class Sce{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function T0t(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Dn(e)?new Sce(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Sce(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function S0t(e,t){if(t.disjointTimerQuery)return null;if(Dn(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function E0t(e){if(Dn(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function C0t(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function A0t(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function M0t(e,t){if(Dn(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function O0t(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function R0t(e,t){if(Dn(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function P0t(e,t){if(Dn(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function aA(e,t,i,r,s){if(r&&Dn(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function I0t(e,t){if(!Dn(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function $0t(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function D0t(e,t){if(Dn(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class L0t{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=S0t(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=E0t(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=D0t(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=C0t(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=A0t(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=O0t(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=T0t(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=R0t(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=P0t(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=M0t(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=aA(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=aA(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=aA(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=aA(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=$0t(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=I0t(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=aA(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class N0t{constructor(t,i){this.gl=t,this.instanceCounter=new qyt,this.programCache=new g0t(this),this._state=new lce,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Dn(t)?pi.WEBGL2:pi.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new L0t(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new lce,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new THe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new x0t(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(xt.ARRAY_BUFFER),this.unbindBuffer(xt.ELEMENT_ARRAY_BUFFER),Dn(this.gl)&&(this.unbindBuffer(xt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.COPY_READ_BUFFER),this.unbindBuffer(xt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,gh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=tp.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===tp.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=tp.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(H6+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&Ki.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&Ki.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&Ki.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(gh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ece(t,r)),this.gl.drawArrays(t,i,r),gh()){const s=Vre(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(gh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ece(t,i)),this.gl.drawElements(t,i,r,s),gh()){const o=Vre(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},f=(n=Qs(l,v=>v.size))!=null?n:0,m=s+i,y=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${y}`,{args:p,vao:h})}}}logInfo(){gh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){gh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return M(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!M(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(M(t))return this.gl.bindFramebuffer(Rn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Rn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===Rn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(M(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=_t(t,null):this._state.drawFramebuffer=_t(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=Ki.COLOR_BUFFER_BIT,f=it.NEAREST){this.bindFramebufferSeparate(t,Rn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Rn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case xt.ARRAY_BUFFER:this._state.vertexBuffer=Gl(this.gl,t,i,this._state.vertexBuffer);break;case xt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Gl(this.gl,t,i,this._state.indexBuffer);break;case xt.UNIFORM_BUFFER:this._state.uniformBuffer=Gl(this.gl,t,i,this._state.uniformBuffer);break;case xt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Gl(this.gl,t,i,this._state.pixelPackBuffer);break;case xt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Gl(this.gl,t,i,this._state.pixelUnpackBuffer);break;case xt.COPY_READ_BUFFER:this._state.copyReadBuffer=Gl(this.gl,t,i,this._state.copyReadBuffer);break;case xt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Gl(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return M(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);M(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!M(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){M(i)?this.bindBufferBase(xt.UNIFORM_BUFFER,t,null):(gh()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(xt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(xt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(xt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case xt.ARRAY_BUFFER:this._state.vertexBuffer=Gl(this.gl,null,t,this._state.vertexBuffer);break;case xt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Gl(this.gl,null,t,this._state.indexBuffer);break;case xt.UNIFORM_BUFFER:this._state.uniformBuffer=Gl(this.gl,null,t,this._state.uniformBuffer);break;case xt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Gl(this.gl,null,t,this._state.pixelPackBuffer);break;case xt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Gl(this.gl,null,t,this._state.pixelUnpackBuffer);break;case xt.COPY_READ_BUFFER:this._state.copyReadBuffer=Gl(this.gl,null,t,this._state.copyReadBuffer);break;case xt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Gl(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){M(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(oH.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(vn.Sync,r),i.flush();do await h2(t),s=i.clientWaitSync(r,0,0);while(s===jF.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(vn.Sync,r),i.deleteSync(r),s===jF.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Rn.FRAMEBUFFER){return t===Rn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(xt.ARRAY_BUFFER),this.unbindBuffer(xt.ELEMENT_ARRAY_BUFFER),Dn(this.gl)&&(this.unbindBuffer(xt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.COPY_READ_BUFFER),this.unbindBuffer(xt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Oe.ONE,Oe.ZERO),this.setBlendEquation(Jg.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(tp.BACK),this.setFrontFace(k2.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(fr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(fr.ALWAYS,0,0),this.setStencilOp(ss.KEEP,ss.KEEP,ss.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(xt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,null),Dn(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(xt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(xt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(xt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(xt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(xt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(xt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(xt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(xt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Rn.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Rn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(eu.COLOR_ATTACHMENT0)),t.bindFramebuffer(Rn.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Rn.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(H6+c),t.bindTexture(ft.TEXTURE_2D,null),t.bindTexture(ft.TEXTURE_CUBE_MAP,null),Dn(t)&&(t.bindTexture(ft.TEXTURE_3D,null),t.bindTexture(ft.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(H6+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===pi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=Dn(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return ot.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function Gl(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Ece(e,t){switch(e){case $t.POINTS:return 2*t;case $t.TRIANGLES:return t/3;case $t.TRIANGLE_STRIP:case $t.TRIANGLE_FAN:return t-2;default:return 0}}class F0t extends N0t{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const K2e=de.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let rS=class extends Ae{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Zr,this._frameTask=e.resourceController.scheduler.registerTask(vt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(_p.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return M(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(Z3,new gQ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),_t(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",Ls.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(M(t))return pt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new U0t(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Br(a)||K2e.error(a),null);return Fu(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Ls.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],rS.prototype,"_loadingCount",void 0),u([d()],rS.prototype,"_frameTask",void 0),u([d()],rS.prototype,"updating",null),rS=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],rS);class U0t{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(K2e.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const k0t=de.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let MM=class extends Ae{constructor(){super(...arguments),this._data=new Array,this._state=lc.NOT_LOADED}dispose(){this._state=lc.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===lc.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[Ni("esri/images/materials/water/normals.jpg"),Ni("esri/images/materials/water/perturbation.jpg")];this._state=lc.LOADING,Promise.all(t.map(i=>yp(i))).then(i=>{i.forEach(r=>this._data.push(new ot(e,{target:ft.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.REPEAT,samplingMode:it.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=lc.LOADED}).catch(i=>{k0t.error("Failed to load textures for water material.",i),this._state=lc.NOT_LOADED})}bind(e){this._state===lc.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],MM.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],MM.prototype,"updating",null),MM=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],MM);class z0t extends ik{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(Ls.BACKGROUND);const i=hp();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=ye(F({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(M(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=rB(r,s,a);this._rctx.gl.readPixels(0,0,r,s,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,ye(F({},t),{region:null}));const c=rB(n.width,n.height,a);return Yst(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=rB(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const y=s.clone();if(i.ignorePadding){const w=B5(y.padding);for(let S=0;S<4;S++)w[S]=Math.round(w[S]/y.pixelRatio*i.pixelRatio);y.padding=w}y.fullWidth=n,y.fullHeight=o,y.pixelRatio=i.pixelRatio;const v=s.fovX-y.fovX,b=s.fovY-y.fovY;v<0&&v<b?y.fovX=s.fovX:b<0&&b<v&&(y.fovY=s.fovY),this._forceCameraHook(y),a=!0,r=new Cr(this._rctx,{width:y.fullWidth,height:y.fullHeight,colorTarget:is.TEXTURE,depthStencilTarget:Pi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,y,i.disableDecorations?Aw.OFF:Aw.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),Je(r)},m=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let y=3;y<m.data.length;y+=4)m.data[y]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Cce=de.getLogger("esri.views.3d.webgl-engine.parts.View");let To=class extends tk(Ae){constructor(e){super({}),this.events=new Zr,this.waterTextureRepository=new MM,this._magnifierHelper=new iS,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ae(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Ft),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new eTe(this._rctx),this._shaderTechniqueRepository=new Txe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new rS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new Sxe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Kmt(this._rctx,this._shaderTechniqueRepository),this._renderer=new ig(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new z0t(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=sn(this._frameTask),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Ls.UPDATE){e===Ls.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=sgt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(M(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){ISe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=Ls.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?Ls.UPDATE:Ls.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(Ls.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Aw.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(Ls.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=lw(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=SHe("3d",this._canvas,i);if(M(r)){const n=he("esri-force-webgl");Cce.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Cce.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new F0t(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return M(this._componentObjectCollection)&&(this._componentObjectCollection=new Ymt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],To.prototype,"updating",null),u([So()],To.prototype,"_rctx",void 0),u([So()],To.prototype,"_container",void 0),u([So()],To.prototype,"_canvas",void 0),u([So()],To.prototype,"_stippleTextureRepository",void 0),u([So(),d()],To.prototype,"waterTextureRepository",void 0),u([So(),d()],To.prototype,"_magnifierHelper",void 0),u([So(),d()],To.prototype,"_textureRepository",void 0),u([So()],To.prototype,"_compositingHelper",void 0),u([So()],To.prototype,"_renderer",void 0),u([So()],To.prototype,"_screenshotManager",void 0),u([So()],To.prototype,"componentObjectCollection",null),u([So()],To.prototype,"_componentObjectCollection",void 0),u([d()],To.prototype,"_needsUpdate",void 0),u([d()],To.prototype,"_needsWaterReflectionUpdate",void 0),To=u([P("esri.views.3d.webgl-engine.parts.RenderView")],To);var TN;let al=TN=class extends tk(Ae){constructor(e){super(e),this._handles=new si,this._model=new gN,this._layers=new It,this._changeSet=new Fxe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new To(this)),this._frameTask=this.resourceController.scheduler.registerTask(vt.STAGE,this),this._handles.add(this._frameTask)}destroy(){kw.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),b4(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){M(e)||(this.renderView.requestRender(),this._model.remove(e),b4(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){M(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>M(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;TN.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),TN.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===z2.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{Oae(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Fu(r))return r.then(s);s()}removeRenderPlugin(e){Oae(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};al.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],al.prototype,"resourceController",void 0),u([d({constructOnly:!0})],al.prototype,"options",void 0),u([d({constructOnly:!0})],al.prototype,"state",void 0),u([d({constructOnly:!0})],al.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],al.prototype,"viewingMode",null),u([d({constructOnly:!0})],al.prototype,"container",void 0),u([d({constructOnly:!0})],al.prototype,"renderSR",void 0),u([d({constructOnly:!0})],al.prototype,"_handles",void 0),u([d({readOnly:!0})],al.prototype,"updating",null),u([d({constructOnly:!0})],al.prototype,"_model",void 0),u([So(),d()],al.prototype,"renderView",void 0),al=TN=u([P("esri.views.3d.webgl-engine.Stage")],al);function eEe(e){return um(e)&&e.intersector===zr.PCL&&!!e.target}function Kk(e){return um(e)&&e.intersector===zr.I3S&&!!e.target}function V0t(e){return um(e)&&e.intersector===zr.TERRAIN&&!!e.target}function tEe(e){return um(e)&&e.intersector===zr.OVERLAY&&!!e.target}function aJ(e){return um(e)&&e.intersector===zr.LOD&&!!e.target}function Ace(e,t){var i;return IU(e)||$U(e)?KR(e.target.object.metadata,t):V0t(e)?(i=t.map)==null?void 0:i.ground:eEe(e)||Kk(e)||tEe(e)?KR(e.target,t):null}function DSt(e,t){const i=xq(e,t);return _(i)&&i.type==="graphic"?i.graphic:null}function xq(e,t){if(M(e))return null;if(IU(e)||$U(e))return Mce(e.target.object.metadata,t);if(eEe(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return tEe(e)||aJ(e)?Mce(e.target,t):Kk(e)?B0t(e.target,t):null}function Mce(e,t){if(M(e)||M(e.graphicUid))return null;const i=KR(e,t);if(M(i))return null;if(i===t.graphics)return M(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||M(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function B0t(e,t){const i=KR(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?j0t(r.getGraphicFromIntersectorTarget(e)):null}function G0t(e,t){const i=KR(e,t);if(M(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function j0t(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function KR(e,t){return M(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function LSt(e,t){if(IU(e)||$U(e))return Ig(e.target.object.boundingVolumeWorldSpace.bounds);if(aJ(e)){Ome(pD,e.transformation);const i=Math.max(pD[0],pD[1],pD[2]);return e.target.baseBoundingSphere.radius*i}return Kk(e)?Qs(G0t(e.target,t),i=>.5*Ife(i)):null}function NSt(e){return!IU(e)&&!$U(e)&&(aJ(e)?e.target.numLodLevels>1:!!Kk(e))}const pD=R();async function H0t(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+q0t):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const q0t=.05;let n8,o8;function W0t(e){const t=c1e(e);for(;t.length>1;){const i=Oce(t.shift());if(i.available)return i}return Oce(t.shift())}function Oce(e){switch(e){case pi.WEBGL1:return X0t();case pi.WEBGL2:return Y0t()}}function X0t(){return n8||(n8=J0t()),n8}function Y0t(){return o8||(o8=K0t()),o8}class iEe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class Z0t extends iEe{constructor(){super(...arguments),this.type=pi.WEBGL1}}class Q0t extends iEe{constructor(){super(...arguments),this.type=pi.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function rEe(e,t){var n;if(e===pi.WEBGL1&&typeof WebGLRenderingContext===void 0||e===pi.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=HF(i,e,{failIfMajorPerformanceCaveat:!0});if(M(r)&&(r=HF(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),M(r))return r;if(e===pi.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function J0t(){const e=new Z0t,t=rEe(pi.WEBGL1,e);return M(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function K0t(){const e=new Q0t,t=rEe(pi.WEBGL2,e);return M(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function evt(e){const t=W0t(e);if(!t.available)return new q("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new q("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new q("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new q("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===pi.WEBGL1){if(!t.supportsElementIndexUint)return new q("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new q("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new q("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function tvt(e){return e&&"nodeType"in e}function ivt(e){return e&&typeof e.render=="function"}const Rce={component:"esri-component"};let nb=class extends Ae{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Rce.component),t&&t.classList.remove(Rce.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||tvt(e)?(this._set("widget",null),h5(e)):(ivt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],nb.prototype,"id",null),u([d()],nb.prototype,"node",null),u([Nt("node")],nb.prototype,"castNode",null),u([d({readOnly:!0})],nb.prototype,"widget",void 0),nb=u([P("esri.views.ui.Component")],nb);const SN=nb,rvt={left:0,top:0,bottom:0,right:0},sEe={bottom:30,top:15,right:15,left:15},a8="manual",el={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function svt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function l8(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function c8(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let rg=class extends Zr.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new si,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&c8(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&c8(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([ae(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Ft),ae(()=>this.padding,this._applyUIPadding,Ft)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(el.ui),J3e(e),this._attachContainers(e)),t&&(t.classList.remove(el.ui),c8(t,{top:"",bottom:"",left:"",right:""}),zhe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:F(F({},sEe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=l8(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||a8)===a8?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(el.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=l8(e)||l8(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof SN||(e=new SN({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof SN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||rvt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(el.innerContainer),e.classList.add(el.cornerContainer);const t=document.createElement("div");t.classList.add(el.innerContainer),t.classList.add(el.manualContainer);const i=document.createElement("div");i.classList.add(el.topLeft),i.classList.add(el.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(el.topRight),r.classList.add(el.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(el.bottomLeft),s.classList.add(el.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(el.bottomRight),n.classList.add(el.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=nv();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=F({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||a8,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(svt(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?eK(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):eK(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],rg.prototype,"container",null),u([d()],rg.prototype,"height",null),u([d({value:sEe})],rg.prototype,"padding",null),u([Nt("padding")],rg.prototype,"castPadding",null),u([d()],rg.prototype,"view",void 0),u([d()],rg.prototype,"width",null),rg=u([P("esri.views.ui.UI")],rg);const nvt=rg;function Pce(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function ovt(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function fD(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function avt(e){return e.type==="bing-maps"}const t0=[];let sS=class extends E2{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ct,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>ae(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([oo(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Cl(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");t0.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)!=null&&s.attributionVisible))return;const i=t.layer;if(Pce(i,"user"))return void fD(t0,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?fD(t0,t,this._getDynamicAttribution(n,this.view,i)):Pce(i)&&fD(t0,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");fD(t0,t,r||i.copyright)}),ovt(this.items,t0)&&(this.items.removeAll(),this.items.addMany(t0)),t0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await mp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,avt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ze.WGS84},f={extent:Pg(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=Yw(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&OW(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:ct})],sS.prototype,"items",void 0),u([d({readOnly:!0})],sS.prototype,"state",null),u([d()],sS.prototype,"view",void 0),sS=u([P("esri.widgets.Attribution.AttributionViewModel")],sS);const nEe=sS,i0={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let ll=class extends ja{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=i0.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new nEe}initialize(){this.own(oo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[i0.open]:this._isOpen};return ce("div",{bind:this,class:this.classes(i0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ce("div",{class:i0.poweredBy},"Powered by"," ",ce("a",{class:i0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[i0.sourcesOpen]:e,[i0.interactive]:t};return ce("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(i0.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],ll.prototype,"_isOpen",void 0),u([d()],ll.prototype,"_isInteractive",null),u([d()],ll.prototype,"_attributionTextOverflowed",void 0),u([d()],ll.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],ll.prototype,"attributionText",null),u([d()],ll.prototype,"iconClass",void 0),u([d()],ll.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ll.prototype,"label",void 0),u([d(),za("esri/widgets/Attribution/t9n/Attribution")],ll.prototype,"messages",void 0),u([ht("viewModel.view")],ll.prototype,"view",void 0),u([d({type:nEe})],ll.prototype,"viewModel",void 0),u([iu()],ll.prototype,"_toggleState",null),ll=u([P("esri.widgets.Attribution")],ll);const lvt=ll,cvt="esri.widgets.CompassViewModel";let ob=class extends VY(Ae){constructor(e){super(e),this._handles=new si,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ae(()=>this.view,this._updateRotationWatcher,Ft))}destroy(){this._handles=sn(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ae(()=>e==null?void 0:e.rotation,this._updateForRotation,Ft):ae(()=>e==null?void 0:e.camera,this._updateForCamera,Ft))}};u([d({readOnly:!0})],ob.prototype,"canShowNorth",null),u([d()],ob.prototype,"orientation",void 0),u([d({readOnly:!0})],ob.prototype,"state",null),u([d()],ob.prototype,"view",void 0),ob=u([P(cvt)],ob);const oEe=ob,r0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let df=class extends ja{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=r0.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new oEe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[r0.disabled]:i,[r0.interactive]:!i},o={[r0.northIcon]:r,[r0.rotationIcon]:!r},{messages:a}=this;return ce("div",{bind:this,class:this.classes(r0.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},ce("span",{"aria-hidden":"true",class:this.classes(r0.icon,o),styles:this._toRotationTransform(e)}),ce("span",{class:r0.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([ht("viewModel.goToOverride")],df.prototype,"goToOverride",void 0),u([d()],df.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],df.prototype,"label",void 0),u([d(),za("esri/widgets/Compass/t9n/Compass")],df.prototype,"messages",void 0),u([ht("viewModel.view")],df.prototype,"view",void 0),u([d({type:oEe})],df.prototype,"viewModel",void 0),u([iu()],df.prototype,"_reset",null),df=u([P("esri.widgets.Compass")],df);const uvt=df;let nS=class extends Ae{constructor(e){super(e),this._handles=new si,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Cl(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],nS.prototype,"state",null),u([d()],nS.prototype,"navigationMode",void 0),u([d()],nS.prototype,"view",void 0),nS=u([P("esri.widgets.NavigationToggleViewModel")],nS);const aEe=nS,Ku={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let pf=class extends ja{constructor(e,t){super(e,t),this.iconClass=Ku.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new aEe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[Ku.disabled]:e,[Ku.isLayoutHorizontal]:this.layout==="horizontal"},r={[Ku.activeButton]:t},s={[Ku.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return ce("div",{bind:this,class:this.classes(Ku.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},ce("div",{class:this.classes(Ku.button,Ku.panButton,r)},ce("span",{class:Ku.panIcon})),ce("div",{class:this.classes(Ku.button,Ku.rotateButton,s)},ce("span",{class:Ku.rotationIcon})))}_toggle(){this.toggle()}};u([d()],pf.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],pf.prototype,"label",void 0),u([d({value:"vertical"})],pf.prototype,"layout",null),u([d(),za("esri/widgets/NavigationToggle/t9n/NavigationToggle")],pf.prototype,"messages",void 0),u([ht("viewModel.view")],pf.prototype,"view",void 0),u([d({type:aEe})],pf.prototype,"viewModel",void 0),u([iu()],pf.prototype,"_toggle",null),pf=u([P("esri.widgets.NavigationToggle")],pf);const hvt=pf,lA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let L0=class extends ja{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[lA.disabled]:!this.enabled,[lA.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return ce("div",{bind:this,class:this.classes(lA.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ce("span",{"aria-hidden":"true",role:"presentation",class:this.classes(lA.icon,i)}),ce("span",{class:lA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],L0.prototype,"action",void 0),u([d()],L0.prototype,"enabled",void 0),u([d()],L0.prototype,"iconClass",void 0),u([d()],L0.prototype,"title",void 0),u([iu()],L0.prototype,"_triggerAction",null),L0=u([P("esri.widgets.IconButton")],L0);const Ice=L0;let oS=class extends Ae{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],oS.prototype,"canZoomIn",null),u([d({readOnly:!0})],oS.prototype,"canZoomOut",null),u([d()],oS.prototype,"view",void 0),oS=u([P("esri.widgets.Zoom.ZoomConditions2D")],oS);const dvt=oS;let aS=class extends Ae{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],aS.prototype,"canZoomIn",null),u([d({readOnly:!0})],aS.prototype,"canZoomOut",null),u([d()],aS.prototype,"view",void 0),aS=u([P("esri.widgets.Zoom.ZoomConditions3D")],aS);const pvt=aS;let N0=class extends Ae{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new dvt({view:e}):e.type==="3d"&&(this._zoomConditions=new pvt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():N8(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():N8(e.goTo({zoomFactor:.5}))}};u([d()],N0.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],N0.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],N0.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],N0.prototype,"state",null),u([d()],N0.prototype,"view",null),N0=u([P("esri.widgets.Zoom.ZoomViewModel")],N0);const lEe=N0,cA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let sg=class extends ja{constructor(e,t){super(e,t),this.iconClass=cA.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new lEe}initialize(){this._zoomInButton=new Ice({action:this.zoomIn.bind(this),iconClass:cA.zoomInIcon}),this._zoomOutButton=new Ice({action:this.zoomOut.bind(this),iconClass:cA.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[cA.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,ce("div",{class:this.classes(cA.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],sg.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],sg.prototype,"label",void 0),u([d({value:"vertical"})],sg.prototype,"layout",null),u([d(),za("esri/widgets/Zoom/t9n/Zoom")],sg.prototype,"messages",void 0),u([ht("viewModel.view")],sg.prototype,"view",void 0),u([d({type:lEe})],sg.prototype,"viewModel",void 0),sg=u([P("esri.widgets.Zoom")],sg);const fvt=sg,cEe="esri.views.ui.DefaultUI";function mvt(e){return e&&e.view!==void 0}de.getLogger(cEe);let EN=class extends nvt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([ae(()=>this.components,this._componentsWatcher.bind(this),Ft),ae(()=>this.view,this._updateViewAwareWidgets.bind(this),Ft)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;mvt(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new SN({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new lvt({view:this.view})}_createCompass(){return new uvt({view:this.view})}_createNavigationToggle(){return new hvt({view:this.view})}_createZoom(){return new fvt({view:this.view})}};u([d()],EN.prototype,"components",void 0),EN=u([P(cEe)],EN);const gvt=EN;let CN=class extends gvt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],CN.prototype,"components",void 0),CN=u([P("esri.views.ui.3d.DefaultUI3D")],CN);const uEe=CN,Vc=de.getLogger("esri.views.SceneView");let nt=class extends BFe(XGe(c7e(nje))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new Qg({slicePlane:$ge},this),this._resourceController=gut(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new PH({view:this}),this.labeler=new Q1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new P2,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new bb,this.environmentManager=new Ad,this.extent=null,this.floors=new ct,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new lje({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new lct,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new uEe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new XH,this.voxelWasm=null,this.voxelWasmPromise=null,lLe(),e&&e.environment||(this._defaults.environment=new XT,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===Yi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([oo(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ae(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new yJe({view:this}),this.stateManager=new Dct({view:this})}initialize(){this.groundView=new l7e({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(oo(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Ft),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Ft),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>qMe(t>0?1e3/Math.ceil(t):0),Ft),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,_s),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),_s),this.handles.add(ae(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Qi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=at(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=at(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=at(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||M(e)?(this._clippingArea=null,null):e instanceof Xt?this.spatialReference&&(e=mD(e,this.spatialReference),M(e))?(Vc.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),M(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Vc.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?Vc.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ge.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return M(t)||M(e)||t.spatialReference.equals(e)?t:mD(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ze.WGS84,i=mD(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||Ze.WGS84;let t;const i=n=>{const o=mD(n,e);M(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new Xt({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(M(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof XT?e:e instanceof j_e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):XT.fromWebsceneEnvironment(e):Ss(XT,e):new XT}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(M(this.state)||this.state.stationary)}set qualityProfile(e){lN.isValidProfile(e)&&(lN.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||lN.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),M(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");nx(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Yge(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?rx.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||HR(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(_(e))return k6(e);const t=this.spatialReference;return t?_((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?k6(this.defaultsFromMap.viewingMode):c4(t,Ge.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Vc.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new kut(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Vc.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=_re(e)?vre(this,e):e,n=vg(s);i.enableDraped=i.include&&!i.include.has(qd)||i.exclude&&i.exclude.has(qd);const o=this.sceneIntersectionHelper,a=Wh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?lo.ALL:lo.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=xq(l,this);if(M(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return Vc.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=_t(e.z==null&&If(this.elevationProvider,e),0);return Gr(e,dT,this.renderSpatialReference,t),this.state.camera.projectToScreen(dT,u8),pp(u8[0],u8[1])}pixelSizeAt(e){return this.ready?e?(Gr(e,dT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(dT)):0:(Vc.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return Vc.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=_re(e)?vre(this,e):e,r=Wr(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Wh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=lo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Ace(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:um(a)?a.distanceInRenderSpace:0,layer:c}};return Wi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await H0t(this,e);let r=null;return!(t.length===0||Math.abs(_t(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(M(e.parent))throw new q("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return jst(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Hst(i,this._pixelFormat())}_completeSettings(e){const t=Gst(e,this);return t.pixelRatio/=this.state.pixelRatio,Zst(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Are.importLayerView(e)}hasLayerViewModule(e){return Are.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=evt(this.type);if(he("safari")&&he("safari")<9&&(e=new q("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:he("safari")})),_(e))throw Vc.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return _(e)?Sre(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,Ge.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ge.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!c4(e,i)&&(!!M(t)||!!Aee(t)||(!WM(t)||!M($k(t,e,i)))&&(!Cee(t)||i!==Ge.Global))}_makeSpatialReferenceConstraints(e,t,i){if(M(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return Aee(t)&&(r||s)?!s||i===Ge.Local||UQ(t.tileInfo,t.fullExtent,e,Ge.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Ze.WebMercator,viewingMode:i}]:[{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]:WM(t)||Cee(t)||!r&&!s?WM(t)&&r&&i!==Ge.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Ze.WGS84,viewingMode:Ge.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?Vc.warnOnce(`Spatial reference defined on view not supported in ${k6(i)} viewing mode.`):e.isGeographic&&Vc.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||Ze.WGS84;return nn(e,this.renderSpatialReference,e,i)||(i=Ze.WGS84,nn(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new qe(e,i),t}trackGraphicState(e){if(!e.graphic)return Vc.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return u2(e.map(i=>this.highlight(i)));if(ct.isCollection(e))return u2(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Vh()}maskOccludee(e){if(!e)return Vc.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&IGe(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await IO(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new q("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,EO.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,EO.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(dT)?(t=this.computeMapPointFromVec3d(dT,t),e.intersector===zr.TERRAIN&&this.basemapTerrain&&(t.z=_t(If(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Ace(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=xq(n,this);if(M(a))continue;if(a.type==="graphic"){if(M(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push(ye(F({},a),{mapPoint:l,distance:c}))}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return M(e)||(M(e.include)||e.include.has(i))&&(M(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof Ga)yvt(i,this._getGraphicFilterUid(e)),t===EO.INCLUDE&&(_(this.graphicsView)&&e.layer===this?uA(i,this.graphicsView.processor.layer.id):e.layer&&uA(i,e.layer.uid));else if(Vhe(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?uA(i,this.graphicsView.processor.layer.id):r===this.map.ground?uA(i,qd):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&uA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new Upt({view:this})),this._set("elevationProvider",new wM({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Ko({view:this})),this._set("featureTiles",new Yn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)?OE(M5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Wi.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.ae2f0ece.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&Wi.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||Wi.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},_s),this.updatingHandles.add(()=>this.clippingArea,e,_s),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,_s)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new tut(this.map,e));const t=this.state.isGlobal,i=Wge(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",D4.create(this.state.viewingMode,i)),t||this.handles.add(ae(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&z5(r,this.basemapTerrain.spatialReference,$ce,s)&&(this.renderCoordsHelper.extent=$ce)},Qi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Z2/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===Yi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(ae(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Qi),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new kct(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=h5(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new al({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=o3(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new q("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Ft),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Ft),ae(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,_s)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:XH.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Z2/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Vut({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Glt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.0cee4951.js")).default;Wt(e),await IO(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Sre(this.viewingMode);if(e===Ge.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(oo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(qd);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(qd);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return M(this.voxelWasm)?(M(this.voxelWasmPromise)&&(this.voxelWasmPromise=import("./VoxelWasmPerSceneView.6e54f580.js").then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function uA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function yvt(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function mD(e,t){return _(e)&&qv(e.spatialReference,t)?OE(e,t):null}var EO;nt.type="3d",u([d()],nt.prototype,"_userClippingArea",void 0),u([d()],nt.prototype,"_resourceController",void 0),u([d()],nt.prototype,"_stage",void 0),u([d({readOnly:!0})],nt.prototype,"deconflictor",void 0),u([d({readOnly:!0})],nt.prototype,"labeler",void 0),u([d(hF(P2,"analyses"))],nt.prototype,"analyses",void 0),u([d({type:F2,readOnly:!0,aliasOf:"state.animation"})],nt.prototype,"animation",void 0),u([d({readOnly:!0})],nt.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],nt.prototype,"elevationProvider",void 0),u([d({type:wc,aliasOf:"stateManager.camera"})],nt.prototype,"camera",void 0),u([d({type:wc,aliasOf:"stateManager.contentCamera"})],nt.prototype,"contentCamera",void 0),u([d({readOnly:!0})],nt.prototype,"canvas",void 0),u([d({type:qe,aliasOf:"stateManager.center"})],nt.prototype,"center",void 0),u([d({type:Xt})],nt.prototype,"clippingArea",null),u([d({type:bb})],nt.prototype,"constraints",void 0),u([d({type:Xt,readOnly:!0})],nt.prototype,"renderDataExtent",null),u([d({type:Xt,readOnly:!0})],nt.prototype,"dataExtent",null),u([d({type:Xt,readOnly:!0})],nt.prototype,"groundAndLayersExtent",null),u([d({value:null,type:XT})],nt.prototype,"environment",null),u([Nt("environment")],nt.prototype,"castEnvironment",null),u([d({readOnly:!0})],nt.prototype,"environmentManager",void 0),u([d({type:Xt,aliasOf:"stateManager.extent"})],nt.prototype,"extent",void 0),u([d()],nt.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],nt.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],nt.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],nt.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],nt.prototype,"graphicsView",void 0),u([d({readOnly:!0})],nt.prototype,"analysisViewManager",void 0),u([d()],nt.prototype,"groundView",void 0),u([d({type:Boolean})],nt.prototype,"initialExtentRequired",null),u([d()],nt.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],nt.prototype,"interacting",null),u([d()],nt.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],nt.prototype,"navigating",void 0),u([d()],nt.prototype,"map",void 0),u([d({readOnly:!0})],nt.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],nt.prototype,"padding",void 0),u([d({type:Ko,readOnly:!0})],nt.prototype,"pointsOfInterest",void 0),u([d({type:Yn,readOnly:!0})],nt.prototype,"featureTiles",void 0),u([d()],nt.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],nt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],nt.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],nt.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],nt.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],nt.prototype,"state",void 0),u([d({readOnly:!0})],nt.prototype,"inputManager",void 0),u([d({readOnly:!0})],nt.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],nt.prototype,"qualityProfile",null),u([d({type:Pae,get(){let e=this._get("qualitySettings");return e||(e=new Pae,lN.apply(this.qualityProfile,e)),e}})],nt.prototype,"qualitySettings",void 0),u([d()],nt.prototype,"slicePlane",null),u([d({readOnly:!0})],nt.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],nt.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],nt.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],nt.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],nt.prototype,"scale",void 0),u([d()],nt.prototype,"heightModelInfo",null),u([d()],nt.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],nt.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],nt.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],nt.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],nt.prototype,"type",void 0),u([d({type:uEe})],nt.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],nt.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],nt.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],nt.prototype,"viewingMode",null),u([d({type:Bh,aliasOf:"stateManager.viewpoint"})],nt.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],nt.prototype,"zoom",void 0),u([d({type:XH})],nt.prototype,"highlightOptions",void 0),nt=u([P("esri.views.SceneView")],nt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(EO||(EO={}));const dT=R(),u8=Wr(),$ce=Lt(),FSt=nt;function Kf(e=_vt){return[e[0],e[1],e[2],e[3]]}function h8(e,t,i=Kf()){return ne(i,e),i[3]=t,i}function Tq(e,t,i=Kf()){return qF(gD,e,q4(e)),qF(Dce,t,q4(t)),TU(gD,Dce,gD),vvt(i,Al(JY(i,gD)))}function q4(e){return Pt(e[3])}function vvt(e,t){return e[3]=t,e}const _vt=[0,0,1,0],gD=wp(),Dce=wp();Kf();var Sq;let ff=Sq=class extends xe{constructor(e){super(e),this.origin=R(),this.translation=R(),this.rotation=Kf(),this.scale=Ue(1,1,1),this.geographic=!0}get localMatrix(){const e=Ee();return Eme(e,this.scale),vl(e,e,q4(this.rotation),this.rotation),ca(e,e,this.translation),e}get localMatrixInverse(){return Xr(Ee(),this.localMatrix)}applyLocal(e,t){return ke(t,e,this.localMatrix)}applyLocalInverse(e,t){return ke(t,e,this.localMatrixInverse)}project(e,t){const i=new Float64Array(e.length),r=Mr.fromTypedArray(i),s=Mr.fromTypedArray(e);if(this.geographic){const a=Il(t),l=Ee();return ua(t,this.origin,l,a),Dr(l,l,this.localMatrix),sy(r,s,l),tr(i,a,0,i,t,0,i.length/3),i}const{localMatrix:n,origin:o}=this;nX(n,Us)?tP(r,s):sy(r,s,n);for(let a=0;a<i.length;a+=3)i[a+0]+=o[0],i[a+1]+=o[1],i[a+2]+=o[2];return i}getOriginPoint(e){const[t,i,r]=this.origin;return new qe({x:t,y:i,z:r,spatialReference:e})}equals(e){return _(e)&&this.geographic===e.geographic&&ka(this.origin,e.origin)&&$me(this.localMatrix,e.localMatrix)}clone(){const e={origin:rs(this.origin),translation:rs(this.translation),rotation:Kf(this.rotation),scale:rs(this.scale),geographic:this.geographic};return new Sq(e)}};u([d({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"origin",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"translation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"rotation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],ff.prototype,"scale",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0}})],ff.prototype,"geographic",void 0),u([d()],ff.prototype,"localMatrix",null),u([d()],ff.prototype,"localMatrixInverse",null),ff=Sq=u([P("esri.geometry.support.MeshTransform")],ff);const W4=ff;function T_(e,t){var i;return e.isGeographic||e.isWebMercator&&((i=t==null?void 0:t.geographic)!=null?i:!0)}function lJ(e,t,i){return T_(t.spatialReference,i)?Tvt(e,t,i):xvt(e,t,i)}function bvt(e,t,i){const{position:r,normal:s,tangent:n}=e;if(M(t))return{position:r,normal:s,tangent:n};const o=t.localMatrix;return lJ({position:PTe(r,new Float64Array(r.length),o),normal:_(s)?ITe(s,new Float32Array(s.length),o):null,tangent:_(n)?$Te(n,new Float32Array(n.length),o):null},t.getOriginPoint(i),{geographic:t.geographic})}function wvt(e,t,i){var r;if(i!=null&&i.useTransform){const{position:s,normal:n,tangent:o}=e;return{vertexAttributes:{position:s,normal:n,tangent:o},transform:new W4({origin:[t.x,t.y,(r=t.z)!=null?r:0],geographic:T_(t.spatialReference,i)})}}return{vertexAttributes:lJ(e,t,i),transform:null}}function hEe(e,t,i){return T_(t.spatialReference,i)?dEe(e,t,i):Eq(e,t,i)}function USt(e,t,i,r){if(M(t))return hEe(e,i,r);const s=bvt(e,t,i.spatialReference);return i.equals(t.getOriginPoint(i.spatialReference))?Eq(s,i,r):T_(i.spatialReference,r)?dEe(s,i,r):Eq(s,i,r)}function xvt(e,t,i){const r=new Float64Array(e.position.length),s=e.position,n=t.x,o=t.y,a=t.z||0,{horizontal:l,vertical:c}=cJ(i?i.unit:null,t.spatialReference);for(let h=0;h<s.length;h+=3)r[h+0]=s[h+0]*l+n,r[h+1]=s[h+1]*l+o,r[h+2]=s[h+2]*c+a;return{position:r,normal:e.normal,tangent:e.tangent}}function Tvt(e,t,i){const r=t.spatialReference,s=pEe(t,i,Cq),n=new Float64Array(e.position.length),o=Svt(e.position,s,r,n),a=Jv(fEe,s);return{position:o,normal:Evt(o,n,e.normal,a,r),tangent:Cvt(o,n,e.tangent,a,r)}}function Svt(e,t,i,r){sy(Mr.fromTypedArray(r),Mr.fromTypedArray(e),t);const s=new Float64Array(e.length);return bk(r,s,i)}function Evt(e,t,i,r,s){if(M(i))return null;const n=new Float32Array(i.length);return Yh(bi.fromTypedArray(n),bi.fromTypedArray(i),r),vk(n,e,t,s,n),n}function Cvt(e,t,i,r,s){if(M(i))return null;const n=new Float32Array(i.length);Yh(bi.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),bi.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT),r);for(let o=3;o<n.length;o+=4)n[o]=i[o];return wk(n,e,t,s,n),n}function Eq(e,t,i){const r=new Float64Array(e.position.length),s=e.position,n=t.x,o=t.y,a=t.z||0,{horizontal:l,vertical:c}=cJ(i?i.unit:null,t.spatialReference);for(let h=0;h<s.length;h+=3)r[h+0]=(s[h+0]-n)/l,r[h+1]=(s[h+1]-o)/l,r[h+2]=(s[h+2]-a)/c;return{position:r,normal:e.normal,tangent:e.tangent}}function dEe(e,t,i){const r=t.spatialReference;pEe(t,i,Cq);const s=Xr(Rvt,Cq),n=new Float64Array(e.position.length),o=Avt(e.position,r,s,n),a=Jv(fEe,s);return{position:o,normal:Mvt(e.normal,e.position,n,r,a),tangent:Ovt(e.tangent,e.position,n,r,a)}}function pEe(e,t,i){ua(e.spatialReference,[e.x,e.y,e.z||0],i,Il(e.spatialReference));const{horizontal:r,vertical:s}=cJ(t?t.unit:null,e.spatialReference);return v3(i,i,[r,r,s]),i}function Avt(e,t,i,r){const s=_k(e,t,r),n=Mr.fromTypedArray(s),o=new Float64Array(s.length),a=Mr.fromTypedArray(o);return sy(a,n,i),o}function Mvt(e,t,i,r,s){if(M(e))return null;const n=K3(e,t,i,r,new Float32Array(e.length)),o=bi.fromTypedArray(n);return Yh(o,o,s),n}function Ovt(e,t,i,r,s){if(M(e))return null;const n=eP(e,t,i,r,new Float32Array(e.length)),o=bi.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT);return Yh(o,o,s),n}function cJ(e,t){if(M(e))return Pvt;const i=t.isGeographic?1:Nl(t),r=t.isGeographic?1:_w(t),s=Is(1,e,"meters");return{horizontal:s*i,vertical:s*r}}const Cq=Ee(),Rvt=Ee(),fEe=ir(),Pvt={horizontal:1,vertical:1},Aq=de.getLogger("esri.geometry.support.meshUtils.centerAt");function Ivt(e,t,i){var s;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=(s=i==null?void 0:i.origin)!=null?s:e.origin;_(e.transform)?((i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&Aq.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),$vt(e.transform,t,r)):T_(e.spatialReference,i)?Dvt(e,t,r):Lvt(e,t,r)}function $vt(e,t,i){const r=t.x-i.x,s=t.y-i.y,n=t.hasZ&&i.hasZ?t.z-i.z:0,o=e.origin;e.origin=[o[0]+r,o[1]+s,o[2]+n]}function Dvt(e,t,i){const r=hEe(e.vertexAttributes,i,{geographic:!0}),{position:s,normal:n,tangent:o}=lJ(r,t,{geographic:!0});e.vertexAttributes.position=s,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=o,e.vertexAttributesChanged()}function Lvt(e,t,i){const r=Uvt,s=Fvt;if(Gr(t,s,e.spatialReference)){if(!Gr(i,r,e.spatialReference)){const n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,Aq.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}Nvt(e.vertexAttributes.position,s,r),e.vertexAttributesChanged()}else Aq.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function Nvt(e,t,i){if(e)for(let r=0;r<e.length;r+=3)for(let s=0;s<3;s++)e[r+s]+=t[s]-i[s]}const Fvt=R(),Uvt=R();async function kvt(e,t,i){const{loadGLTFMesh:r}=await a5(import("./loadGLTFMesh.aeb43d63.js"),i),s=await mEe(t,i),n=r(new qe({x:0,y:0,z:0,spatialReference:e.spatialReference}),s.url,{resolveFile:zvt(s),useTransform:!0,signal:_(i)?i.signal:null});n.then(()=>s.dispose(),()=>s.dispose());const{vertexAttributes:o,components:a}=await n;e.vertexAttributes=o,e.components=a}function zvt(e){const t=Mhe(e.url);return i=>{var n;const r=c5(i,t,t),s=r?r.replace(/^ *\.\//,""):null;return(n=e.files.get(s))!=null?n:i}}async function mEe(e,t){return e instanceof Blob?dE.fromBlob(e):typeof e=="string"?new dE(e):Array.isArray(e)?Vvt(e,t):Bvt(e,t)}async function Vvt(e,t){const i=new Map;let r=null;const s=await ghe(e.map(async o=>({name:o.name,source:await mEe(o instanceof Blob?o:o.source,t)}))),n=[];for(const o of s)o&&(bs(t)?o.source.dispose():n.push(o));Wt(t);for(const{name:o,source:a}of n)(M(r)||/\.(gltf|glb)/i.test(o))&&(r=a.url),i.set(o,a.url),a.files&&a.files.forEach((l,c)=>i.set(c,l));if(M(r))throw new q("mesh-load-external:missing-files","Missing files to load external mesh source");return new dE(r,()=>n.forEach(({source:o})=>o.dispose()),i)}async function Bvt(e,t){const{default:i}=await a5(Promise.resolve().then(function(){return khe}),t),r=typeof e.multipart[0]=="string"?await Promise.all(e.multipart.map(async s=>(await i(s,{responseType:"array-buffer"})).data)):e.multipart;return dE.fromBlob(new Blob(r))}class dE{constructor(t,i=()=>{},r=new Map){this.url=t,this.dispose=i,this.files=r}static fromBlob(t){const i=URL.createObjectURL(t);return new dE(i,()=>URL.revokeObjectURL(i))}}const Gvt=de.getLogger("esri.geometry.support.meshUtils.offset");function jvt(e,t,i){e.vertexAttributes&&e.vertexAttributes.position&&(_(e.transform)?((i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&Gvt.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),Hvt(e.transform,t)):T_(e.spatialReference,i)?qvt(e,t):Wvt(e,t))}function Hvt(e,t){const i=e.origin;e.origin=pe(R(),i,t)}function qvt(e,t){const i=e.spatialReference,r=e.vertexAttributes.position,s=e.vertexAttributes.normal,n=e.vertexAttributes.tangent,o=new Float64Array(r.length),a=_(s)?new Float32Array(s.length):null,l=_(n)?new Float32Array(n.length):null,c=e.extent.center,h=Xvt;ua(i,[c.x,c.y,c.z],Lce,Il(i)),Sc(Nce,Lce),Oo(h,t,Nce),_k(r,i,o),_(s)&&K3(s,r,o,i,a),_(n)&&eP(n,r,o,i,l),gEe(o,h),bk(o,r,i),_(s)&&vk(a,r,o,i,s),_(n)&&wk(l,r,o,i,n),e.vertexAttributesChanged()}function Wvt(e,t){gEe(e.vertexAttributes.position,t),e.vertexAttributesChanged()}function gEe(e,t){if(e)for(let i=0;i<e.length;i+=3)for(let r=0;r<3;r++)e[i+r]+=t[r]}const Xvt=R(),Lce=Ee(),Nce=ir();function Yvt(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:i}=r_t,r=4*e.length,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(2*e.length*3);let l=0,c=0,h=0,p=0;for(let f=0;f<e.length;f++){const m=e[f],y=l/3;for(const b of t)a[p++]=y+b;const v=m.corners;for(let b=0;b<4;b++){const w=v[b];let S=0;o[h++]=.25*i[b][0]+m.uvOrigin[0],o[h++]=m.uvOrigin[1]-.25*i[b][1];for(let T=0;T<3;T++)m.axis[T]!==0?(s[l++]=.5*m.axis[T],n[c++]=m.axis[T]):(s[l++]=.5*w[S++],n[c++]=0)}}return{position:s,normal:n,uv:o,faces:a}}function Zvt(e,t){const i=e.components[0],r=i.faces,s=s_t[t],n=6*s,o=new Uint32Array(6),a=new Uint32Array(r.length-6);let l=0,c=0;for(let h=0;h<r.length;h++)h>=n&&h<n+6?o[l++]=r[h]:a[c++]=r[h];if(_(e.vertexAttributes.uv)){const h=new Float32Array(e.vertexAttributes.uv),p=4*s*2,f=[0,1,1,1,1,0,0,0];for(let m=0;m<f.length;m++)h[p+m]=f[m];e.vertexAttributes.uv=h}return e.components=[new Hw({faces:o,material:i.material}),new Hw({faces:a})],e}function Qvt(e=0){const t=Math.round(8*2**e),i=2*t,r=(t-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*((t-1)*i*2));let l=0,c=0,h=0,p=0;for(let f=0;f<=t;f++){const m=f/t*Math.PI+.5*Math.PI,y=Math.cos(m),v=Math.sin(m);In[2]=v;const b=f===0||f===t,w=b?i-1:i;for(let S=0;S<=w;S++){const T=S/w*2*Math.PI;In[0]=-Math.sin(T)*y,In[1]=Math.cos(T)*y;for(let E=0;E<3;E++)s[l]=.5*In[E],n[l]=In[E],++l;o[c++]=(S+(b?.5:0))/i,o[c++]=f/t,f!==0&&S!==i&&(f!==t&&(a[h++]=p,a[h++]=p+1,a[h++]=p-i),f!==1&&(a[h++]=p,a[h++]=p-i,a[h++]=p-i-1)),p++}}return{position:s,normal:n,uv:o,faces:a}}function Jvt(e=0){const i=Math.round(16*2**e),r=(5-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*(4*i));let l=0,c=0,h=0,p=0,f=0;for(let m=0;m<=5;m++){const y=m===0||m===5,v=m<=1||m>=5-1,b=m===2||m===4,w=y?i-1:i;for(let S=0;S<=w;S++){const T=S/w*2*Math.PI,E=y?0:.5;In[0]=E*Math.sin(T),In[1]=E*-Math.cos(T),In[2]=m<=2?.5:-.5;for(let C=0;C<3;C++)s[l++]=In[C],n[c++]=v?C===2?m<=1?1:-1:0:C===2?0:In[C]/E;o[h++]=(S+(y?.5:0))/i,o[h++]=m<=1?1*m/3:m<=3?1*(m-2)/3+1/3:1*(m-4)/3+2/3,b||m===0||S===i||(m!==5&&(a[p++]=f,a[p++]=f+1,a[p++]=f-i),m!==1&&(a[p++]=f,a[p++]=f-i,a[p++]=f-i-1)),f++}}return{position:s,normal:n,uv:o,faces:a}}function Kvt(e,t){const i=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:i,depth:r};case"north":case"south":return{width:i,height:r};case"east":case"west":return{depth:i,height:r}}}function e_t(e){const t=hA.facingAxisOrderSwap[e],i=hA.position,r=hA.normal,s=new Float64Array(i.length),n=new Float32Array(r.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const h=t[c],p=Math.abs(h)-1,f=h>=0?1:-1;s[o]=i[l+p]*f,n[o]=r[l+p]*f,o++}}return{position:s,normal:n,uv:new Float32Array(hA.uv),faces:new Uint32Array(hA.faces),isPlane:!0}}const pT=1,fT=2,mT=3,hA={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[mT,pT,fT],west:[-mT,-pT,fT],north:[-pT,mT,fT],south:[pT,-mT,fT],up:[pT,fT,mT],down:[pT,-fT,-mT]}};function yD(e,t,i){e.isPlane||t_t(e),i_t(e,i&&i.size);const{vertexAttributes:r,transform:s}=wvt(e,t,i);return{vertexAttributes:new Pa(ye(F({},r),{uv:e.uv})),transform:s,components:[new Hw({faces:e.faces,material:i&&i.material||null})],spatialReference:t.spatialReference}}function t_t(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function i_t(e,t){if(t==null)return;const i=typeof t=="number"?[t,t,t]:[t.width!=null?t.width:1,t.depth!=null?t.depth:1,t.height!=null?t.height:1];s0[0]=i[0],s0[4]=i[1],s0[8]=i[2];for(let r=0;r<e.position.length;r+=3){for(let s=0;s<3;s++)In[s]=e.position[r+s];Oo(In,In,s0);for(let s=0;s<3;s++)e.position[r+s]=In[s]}if(i[0]!==i[1]||i[1]!==i[2]){s0[0]=1/i[0],s0[4]=1/i[1],s0[8]=1/i[2];for(let r=0;r<e.normal.length;r+=3){for(let s=0;s<3;s++)In[s]=e.normal[r+s];Oo(In,In,s0),we(In,In);for(let s=0;s<3;s++)e.normal[r+s]=In[s]}}}const r_t={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},s_t={south:0,east:1,north:2,west:3,up:4,down:5},In=R(),s0=ir(),yEe=de.getLogger("esri.geometry.support.meshUtils.rotate");function n_t(e,t,i){var s,n;if(!e.vertexAttributes||!e.vertexAttributes.position||t[3]===0)return;const r=e.spatialReference;if(_(e.transform)){(i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&yEe.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=(s=i==null?void 0:i.origin)!=null?s:e.transform.getOriginPoint(r);o_t(e.transform,t,o)}else{const o=(n=i==null?void 0:i.origin)!=null?n:e.origin;T_(e.spatialReference,i)?a_t(e,t,o):l_t(e,t,o)}}function o_t(e,t,i){const r=ie($S,i.x,i.y,i.z),s=fe($S,r,e.origin);e.applyLocalInverse(s,Fce),e.rotation=Tq(e.rotation,t,Kf()),e.applyLocalInverse(s,s),fe(s,s,Fce),e.translation=pe(R(),e.translation,s)}function a_t(e,t,i){const r=e.spatialReference,s=Il(r),n=vEe;Gr(i,n,s)||Gr(e.origin,n,s);const o=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(o.length),h=_(a)?new Float32Array(a.length):null,p=_(l)?new Float32Array(l.length):null;ua(s,n,X4,s),Sc(kce,X4);const f=Uce;Oo(Uce,t,kce),f[3]=t[3],_k(o,r,c),_(a)&&K3(a,o,c,r,h),_(l)&&eP(l,o,c,r,p),a2(c,f,3,n),bk(c,o,r),_(a)&&(a2(h,f,3),vk(h,o,c,r,a)),_(l)&&(a2(p,f,4),wk(p,o,c,r,l)),e.vertexAttributesChanged()}function l_t(e,t,i){const r=vEe;if(!Gr(i,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,yEe.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}a2(e.vertexAttributes.position,t,3,r),a2(e.vertexAttributes.normal,t,3),a2(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function a2(e,t,i,r=No){if(!M(e)){Tc(X4,q4(t),t);for(let s=0;s<e.length;s+=i){for(let n=0;n<3;n++)$S[n]=e[s+n]-r[n];ke($S,$S,X4);for(let n=0;n<3;n++)e[s+n]=$S[n]+r[n]}}}const $S=R(),Fce=R(),Uce=Kf(),X4=Ee(),kce=ir(),vEe=R(),_Ee=de.getLogger("esri.geometry.support.meshUtils.scale");function c_t(e,t,i){var s;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=e.spatialReference;if(_(e.transform)){(i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&_Ee.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const n=(s=i==null?void 0:i.origin)!=null?s:e.transform.getOriginPoint(r);u_t(e.transform,t,n)}else{const n=T_(e.spatialReference,i),o=i&&i.origin||e.origin;n?h_t(e,t,o):d_t(e,t,o)}}function u_t(e,t,i){const r=ie(DS,i.x,i.y,i.z),s=fe(DS,r,e.origin);e.applyLocalInverse(s,zce);const n=oe(R(),e.scale,t);e.scale=n,e.applyLocalInverse(s,s),fe(s,s,zce),e.translation=pe(R(),e.translation,s)}function h_t(e,t,i){const r=e.spatialReference,s=Il(r),n=wEe;Gr(i,n,s)||Gr(e.origin,n,s);const o=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(o.length),h=_(a)?new Float32Array(a.length):null,p=_(l)?new Float32Array(l.length):null;_k(o,r,c),_(a)&&K3(a,o,c,r,h),_(l)&&eP(l,o,c,r,p),bEe(c,t,n),bk(c,o,r),_(a)&&vk(h,o,c,r,a),_(l)&&wk(p,o,c,r,l),e.vertexAttributesChanged()}function d_t(e,t,i){const r=wEe;if(!Gr(i,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,_Ee.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}bEe(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function bEe(e,t,i=No){if(e)for(let r=0;r<e.length;r+=3){for(let s=0;s<3;s++)DS[s]=e[r+s]-i[s];oe(DS,DS,t);for(let s=0;s<3;s++)e[r+s]=DS[s]+i[s]}}const DS=R(),zce=R(),wEe=R();var Pd;const eh=de.getLogger("esri.geometry.Mesh");let Kl=Pd=class extends Jh($u.LoadableMixin(yE(Ol))){constructor(e){super(e),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new Pa,this.type="mesh"}initialize(){(M(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(ae(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(t=>t.clone()),transform:_(this.transform)?this.transform.clone():null}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&_(this.external)&&_(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get boundingInfo(){const e=this.vertexAttributes.position,t=this.spatialReference;if(e.length===0||this.components&&this.components.length===0)return{extent:new Xt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t}),center:new qe({x:0,y:0,z:0,spatialReference:t})};const i=_(this.transform)?this.transform.project(e,t):e;let r=1/0,s=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0,c=0,h=0,p=0;const f=i.length,m=1/(f/3);let y=0;for(;y<f;){const v=i[y++],b=i[y++],w=i[y++];r=Math.min(r,v),s=Math.min(s,b),n=Math.min(n,w),o=Math.max(o,v),a=Math.max(a,b),l=Math.max(l,w),c+=m*v,h+=m*b,p+=m*w}return{extent:new Xt({xmin:r,ymin:s,zmin:n,xmax:o,ymax:a,zmax:l,spatialReference:t}),center:new qe({x:c,y:h,z:p,spatialReference:t})}}get anchor(){if(_(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this.boundingInfo;return new qe({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}get origin(){return _(this.transform)?this.transform.getOriginPoint(this.spatialReference):this.boundingInfo.center}get extent(){return!this.loaded&&_(this.external)&&_(this.external.extent)?this.external.extent.clone():this.boundingInfo.extent}addComponent(e){this.loaded?(this.components||(this.components=[]),this.components.push(Hw.from(e)),this.notifyChange("components")):eh.error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(e){if(this.loaded){if(this.components){const t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}eh.error("removeComponent()","Provided component is not part of the list of components")}else eh.error("removeComponent()","Mesh must be loaded before applying operations")}rotate(e,t,i,r){return h8(d8.x,e,gT),h8(d8.y,t,Vce),h8(d8.z,i,Bce),Tq(gT,Vce,gT),Tq(gT,Bce,gT),n_t(this,gT,r),this}offset(e,t,i,r){return this.loaded?(vD[0]=e,vD[1]=t,vD[2]=i,jvt(this,vD,r),this):(eh.error("offset()","Mesh must be loaded before applying operations"),this)}scale(e,t){return this.loaded?(c_t(this,e,t),this):(eh.error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(e,t){return this.loaded?(Ivt(this,e,t),this):(eh.error("centerAt()","Mesh must be loaded before applying operations"),this)}load(e){return _(this.external)&&this.addResolvingPromise(kvt(this,this.external.source,e)),Promise.resolve(this)}clone(){const e=this.components?new Map:null,t=this.components?new Map:null,i={components:this.components?this.components.map(r=>r.cloneWithDeduplication(e,t)):null,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:_(this.transform)?this.transform.clone():null,external:_(this.external)?{source:this.external.source,extent:_(this.external.extent)?this.external.extent.clone():null}:null};return new Pd(i)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const{toBinaryGLTF:t}=await import("./gltfexport.3150da51.js");return t(this,e)}static createBox(e,t){if(!(e instanceof qe))return eh.error(".createBox()","expected location to be a Point instance"),null;const i=new Pd(yD(Yvt(),e,t));return t&&t.imageFace&&t.imageFace!=="all"?Zvt(i,t.imageFace):i}static createSphere(e,t){return e instanceof qe?new Pd(yD(Qvt(t&&t.densificationFactor||0),e,t)):(eh.error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(e,t){return e instanceof qe?new Pd(yD(Jvt(t&&t.densificationFactor||0),e,t)):(eh.error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(e,t){var s;if(!(e instanceof qe))return eh.error(".createPlane()","expected location to be a Point instance"),null;const i=(s=t==null?void 0:t.facing)!=null?s:"up",r=Kvt(i,t==null?void 0:t.size);return new Pd(yD(e_t(i),e,ye(F({},t),{size:r})))}static createFromPolygon(e,t){if(!(e instanceof la))return eh.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const i=Ftt(e);return new Pd({vertexAttributes:new Pa({position:i.position}),components:[new Hw({faces:i.faces,shading:"flat",material:t&&t.material||null})],spatialReference:e.spatialReference})}static async createFromGLTF(e,t,i){if(!(e instanceof qe))throw eh.error(".createfromGLTF()","expected location to be a Point instance"),new q("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:r}=await a5(import("./loadGLTFMesh.aeb43d63.js"),i);return new Pd(await r(e,t,i))}static createWithExternalSource(e,t,i){var o,a,l;const r=(o=i==null?void 0:i.extent)!=null?o:null,s=(a=i==null?void 0:i.transform.clone())!=null?a:new W4;s.origin=[e.x,e.y,(l=e.z)!=null?l:0];const n=e.spatialReference;return new Pd({external:{source:t,extent:r},transform:s,spatialReference:n})}static createIncomplete(e,t){var n,o;const i=(n=t==null?void 0:t.transform.clone())!=null?n:new W4;i.origin=[e.x,e.y,(o=e.z)!=null?o:0];const r=e.spatialReference,s=new Pd({transform:i,spatialReference:r});return s.addResolvingPromise(Promise.reject(new q("mesh-incomplete","Mesh resources are not complete"))),s}};u([d({type:[Hw],json:{write:!0}})],Kl.prototype,"components",void 0),u([d({type:W4,json:{write:!0}})],Kl.prototype,"transform",void 0),u([d({constructOnly:!0})],Kl.prototype,"external",void 0),u([d({readOnly:!0})],Kl.prototype,"hasExtent",null),u([d({readOnly:!0})],Kl.prototype,"boundingInfo",null),u([d({readOnly:!0})],Kl.prototype,"anchor",null),u([d({readOnly:!0})],Kl.prototype,"origin",null),u([d({readOnly:!0,json:{read:!1}})],Kl.prototype,"extent",null),u([d({readOnly:!0,json:{read:!1,write:!0,default:!0}})],Kl.prototype,"hasZ",void 0),u([d({readOnly:!0,json:{read:!1,write:!0,default:!1}})],Kl.prototype,"hasM",void 0),u([d({type:Pa,nonNullable:!0,json:{write:!0}})],Kl.prototype,"vertexAttributes",void 0),Kl=Pd=u([P("esri.geometry.Mesh")],Kl);const d8={x:Ue(1,0,0),y:Ue(0,1,0),z:Ue(0,0,1)},gT=Kf(),Vce=Kf(),Bce=Kf(),vD=R(),kSt=Kl,p_t={type:Eg,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:f_t}}}}};function f_t(e,t,i,r){if(!e)return null;const{minScale:s,maxScale:n,minLOD:o,maxLOD:a}=t;if(o!=null&&a!=null)return r&&r.ignoreMinMaxLOD?Eg.fromJSON(e):Eg.fromJSON(ye(F({},e),{lods:e.lods.filter(({level:l})=>l!=null&&l>=o&&l<=a)}));if(s!==0&&n!==0){const l=p=>Math.round(1e4*p)/1e4,c=s?l(s):1/0,h=n?l(n):-1/0;return Eg.fromJSON(ye(F({},e),{lods:e.lods.filter(p=>{const f=l(p.scale);return f<=c&&f>=h})}))}return Eg.fromJSON(e)}class l2{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(t,i){if(this._allAvailability!=="unknown")return this._allAvailability;const r=(t-this.location.top)*this.location.width+(i-this.location.left),s=r%8,n=r>>3,o=this._tileAvailabilityBitSet;return n<0||n>o.length?"unknown":o[n]&1<<s?"available":"unavailable"}_updateFromData(t){const i=this.location.width,r=this.location.height;let s=!0,n=!0;const o=Math.ceil(i*r/8),a=new Uint8Array(o);let l=0;for(let c=0;c<t.length;c++){const h=c%8;t[c]?(n=!1,a[l]|=1<<h):s=!1,h===7&&++l}n?this._allAvailability="unavailable":s?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)}static fromDefinition(t,i){const r=t.service.request||_i,{row:s,col:n,width:o,height:a}=t,l={query:{f:"json"}};return i=i?F(F({},l),i):l,r(m_t(t),i).then(c=>c.data).catch(c=>{if(c&&c.details&&c.details.httpStatus===422)return{location:{top:s,left:n,width:o,height:a},valid:!0,data:fCe(o*a,0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==o||c.location.height!==a))throw new q("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:o,height:a}});return l2.fromJSON(c)})}static fromJSON(t){l2._validateJSON(t);const i=new l2;return i.location=Object.freeze(te(t.location)),i._updateFromData(t.data),Object.freeze(i)}static _validateJSON(t){if(!t||!t.location)throw new q("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new q("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new q("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new q("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new q("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function Gce(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function m_t(e){let t;if(e.service.type==="vector-tile")t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const r=e.service.tileServers;t=`${r&&r.length?r[e.row%r.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}var Cb;const g_t=de.getLogger("esri.layers.support.TilemapCache");let Id=Cb=class extends Jh(Ae){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2*xw.MEGABYTES,this.request=_i,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new dve(this.cacheByteSize),this.own([ae(()=>{const{layer:e}=this;return[e==null?void 0:e.parsedUrl,e==null?void 0:e.tileServers,e==null?void 0:e.apiKey,e==null?void 0:e.customParameters]},()=>this._initializeTilemapDefinition()),ae(()=>{var e,t;return(t=(e=this.layer)==null?void 0:e.tileInfo)==null?void 0:t.lods},e=>this._initializeAvailableLevels(e),_s)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(g_t.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new q("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,s);if(n)return Promise.resolve(n);const o=r&&r.signal;return r=ye(F({},r),{signal:null}),new Promise((a,l)=>{Fo(o,()=>l(hi()));const c=Gce(s);let h=this._pendingTilemapRequests[c];if(!h){h=l2.fromDefinition(s,r).then(f=>(this._tilemapCache.put(c,f,f.byteSize),f));const p=()=>delete this._pendingTilemapRequests[c];this._pendingTilemapRequests[c]=h,h.then(p,p)}h.then(a,l)})}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(s=>s).then(s=>{if(s instanceof l2){const n=s.getAvailability(t,i);if(n==="unavailable")throw new q("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return n}if(Br(s))throw s;return"unknown"}):Promise.reject(new q("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,s).catch(a=>{if(Br(a))throw a;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw a});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,n){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this.handles.has(o))return;const a=new AbortController;n.then(()=>a.abort(),()=>a.abort());let l=!1;const c={remove(){l||(l=!0,a.abort())}};if(this.handles.add(c,o),await XMe(10,a.signal).catch(()=>{}),l||(l=!0,this.handles.remove(o)),bs(a))return;const h={id:e,level:t,row:i,col:r},p=ye(F({},s),{signal:a.signal}),f=this.layer.tileInfo;for(let m=0;Cb._prefetches.length<Cb._maxPrefetch&&f.upsampleTile(h);++m){const y=this.fetchAvailability(h.level,h.row,h.col,p);Cb._prefetches.push(y);const v=()=>{Cb._prefetches.removeUnordered(y)};y.then(v,v)}}_initializeTilemapDefinition(){var r;if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:Hg(ye(F(F({},e.query),i),{token:t!=null?t:(r=e.query)==null?void 0:r.token})),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=Gce(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach(t=>this._availableLevels[t.level]=!0)}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};Id._maxPrefetch=4,Id._prefetches=new It({initialSize:Cb._maxPrefetch}),u([d({constructOnly:!0,type:Number})],Id.prototype,"levels",void 0),u([Nt("levels")],Id.prototype,"castLevels",null),u([d({readOnly:!0,type:Number})],Id.prototype,"size",null),u([d({constructOnly:!0,type:Number})],Id.prototype,"cacheByteSize",void 0),u([d({constructOnly:!0})],Id.prototype,"layer",void 0),u([d({constructOnly:!0})],Id.prototype,"request",void 0),Id=Cb=u([P("esri.layers.support.TilemapCache")],Id);const xEe=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}readMaxScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(i,r){return r.capabilities&&r.capabilities.includes("Tilemap")?new Id({layer:this}):null}};return u([d({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d()],t.prototype,"minScale",void 0),u([Ie("service","minScale")],t.prototype,"readMinScale",null),u([d()],t.prototype,"maxScale",void 0),u([Ie("service","maxScale")],t.prototype,"readMaxScale",null),u([d({type:Ze})],t.prototype,"spatialReference",void 0),u([d({readOnly:!0})],t.prototype,"supportsBlankTile",null),u([d(p_t)],t.prototype,"tileInfo",void 0),u([d()],t.prototype,"tilemapCache",void 0),u([Ie("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),u([d()],t.prototype,"version",void 0),t=u([P("esri.layers.mixins.ArcGISCachedService")],t),t},jce=de.getLogger("esri.layers.ElevationLayer");let Jo=class extends xEe(SY(AY(MY(R3(Zv))))){constructor(...e){super(...e),this.copyright=null,this.heightModelInfo=null,this.path=null,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=ASe()}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}destroy(){this._lercDecoder=Hi(this._lercDecoder)}set minScale(e){this.constructed&&jce.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)}get minScale(){}set maxScale(e){this.constructed&&jce.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)}get maxScale(){}readVersion(e,t){let i=t.currentVersion;return i||(i=9.3),i}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:i=>{for(let r=0;r<i.typeKeywords.length;r++)if(i.typeKeywords[r].toLowerCase()==="elevation 3d layer")return!0;throw new q("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(bp).then(()=>this._fetchImageService(t))),Promise.resolve(this)}fetchTile(e,t,i,r){const s=_((r=r||{signal:null}).signal)?r.signal:r.signal=new AbortController().signal,n={responseType:"array-buffer",signal:s},o={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(e,t,i,r)).then(()=>_i(this.getTileUrl(e,t,i),n)).then(a=>this._lercDecoder.decode(a.data,o,s)).then(a=>({values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}))}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,s=Hg(ye(F({},this.parsedUrl.query),{blankTile:!r&&null}));return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${s?"?"+s:""}`}async queryElevation(e,t){const{ElevationQuery:i}=await import("./ElevationQuery.398449cf.js");return Wt(t),new i().query(this,e,t)}async createElevationSampler(e,t){const{ElevationQuery:i}=await import("./ElevationQuery.398449cf.js");return Wt(t),new i().createSampler(this,e,t)}_fetchTileAvailability(e,t,i,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,r):Promise.resolve("unknown")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;const t={query:F({f:"json"},this.parsedUrl.query),responseType:"json",signal:e},i=await _i(this.parsedUrl.path,t);i.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl})}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};u([d({json:{read:{source:"copyrightText"}}})],Jo.prototype,"copyright",void 0),u([d({readOnly:!0,type:rx})],Jo.prototype,"heightModelInfo",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Jo.prototype,"path",void 0),u([d({type:["show","hide"]})],Jo.prototype,"listMode",void 0),u([d({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],Jo.prototype,"minScale",null),u([d({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],Jo.prototype,"maxScale",null),u([d({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],Jo.prototype,"opacity",void 0),u([d({type:["ArcGISTiledElevationServiceLayer"]})],Jo.prototype,"operationalLayerType",void 0),u([d()],Jo.prototype,"sourceJSON",void 0),u([d({json:{read:!1},value:"elevation",readOnly:!0})],Jo.prototype,"type",void 0),u([d(CY)],Jo.prototype,"url",void 0),u([d()],Jo.prototype,"version",void 0),u([Ie("version",["currentVersion"])],Jo.prototype,"readVersion",null),Jo=u([P("esri.layers.ElevationLayer")],Jo),Jo.prototype.fetchTile.__isDefault__=!0;const y_t=Jo;var v_t=Object.freeze(Object.defineProperty({__proto__:null,default:y_t},Symbol.toStringTag,{value:"Module"}));let ng=class extends fU(gU(Zv)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new tw,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};u([d({type:Ove})],ng.prototype,"elevationInfo",void 0),u([d(hF(tw,"graphics"))],ng.prototype,"graphics",void 0),u([d({type:["show","hide"]})],ng.prototype,"listMode",void 0),u([d()],ng.prototype,"screenSizePerspectiveEnabled",void 0),u([d({readOnly:!0})],ng.prototype,"type",void 0),u([d({constructOnly:!0})],ng.prototype,"internal",void 0),ng=u([P("esri.layers.GraphicsLayer")],ng);const zSt=ng;de.getLogger("esri.geometry.support.triangleMeshMerge");async function VSt(e,t,i){const r=await import("./elevation.f6150c72.js");return Wt(i),r.create(e,t,i)}const __t=(e,t)=>t.some(i=>e instanceof i);let Hce,qce;function b_t(){return Hce||(Hce=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function w_t(){return qce||(qce=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const TEe=new WeakMap,Mq=new WeakMap,SEe=new WeakMap,p8=new WeakMap,uJ=new WeakMap;function x_t(e){const t=new Promise((i,r)=>{const s=()=>{e.removeEventListener("success",n),e.removeEventListener("error",o)},n=()=>{i(Fv(e.result)),s()},o=()=>{r(e.error),s()};e.addEventListener("success",n),e.addEventListener("error",o)});return t.then(i=>{i instanceof IDBCursor&&TEe.set(i,e)}).catch(()=>{}),uJ.set(t,e),t}function T_t(e){if(Mq.has(e))return;const t=new Promise((i,r)=>{const s=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",o),e.removeEventListener("abort",o)},n=()=>{i(),s()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",n),e.addEventListener("error",o),e.addEventListener("abort",o)});Mq.set(e,t)}let Oq={get(e,t,i){if(e instanceof IDBTransaction){if(t==="done")return Mq.get(e);if(t==="objectStoreNames")return e.objectStoreNames||SEe.get(e);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Fv(e[t])},set(e,t,i){return e[t]=i,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function S_t(e){Oq=e(Oq)}function E_t(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const r=e.call(f8(this),t,...i);return SEe.set(r,t.sort?t.sort():[t]),Fv(r)}:w_t().includes(e)?function(...t){return e.apply(f8(this),t),Fv(TEe.get(this))}:function(...t){return Fv(e.apply(f8(this),t))}}function C_t(e){return typeof e=="function"?E_t(e):(e instanceof IDBTransaction&&T_t(e),__t(e,b_t())?new Proxy(e,Oq):e)}function Fv(e){if(e instanceof IDBRequest)return x_t(e);if(p8.has(e))return p8.get(e);const t=C_t(e);return t!==e&&(p8.set(e,t),uJ.set(t,e)),t}const f8=e=>uJ.get(e);function BSt(e,t,{blocked:i,upgrade:r,blocking:s,terminated:n}={}){const o=indexedDB.open(e,t),a=Fv(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Fv(o.result),l.oldVersion,l.newVersion,Fv(o.transaction))}),i&&o.addEventListener("blocked",()=>i()),a.then(l=>{n&&l.addEventListener("close",()=>n()),s&&l.addEventListener("versionchange",()=>s())}).catch(()=>{}),a}const A_t=["get","getKey","getAll","getAllKeys","count"],M_t=["put","add","delete","clear"],m8=new Map;function Wce(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(m8.get(t))return m8.get(t);const i=t.replace(/FromIndex$/,""),r=t!==i,s=M_t.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!(s||A_t.includes(i)))return;const n=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[i](...a),s&&l.done]))[0]};return m8.set(t,n),n}S_t(e=>ye(F({},e),{get:(t,i,r)=>Wce(t,i)||e.get(t,i,r),has:(t,i)=>!!Wce(t,i)||e.has(t,i)}));const O_t=.5*(Math.sqrt(3)-1),dA=(3-Math.sqrt(3))/6,R_t=1/3,Gp=1/6,P_t=(Math.sqrt(5)-1)/4,Yo=(5-Math.sqrt(5))/20,bo=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),xn=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class I_t{constructor(t=Math.random){const i=typeof t=="function"?t:D_t(t);this.p=$_t(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let r=0;r<512;r++)this.perm[r]=this.p[r&255],this.permMod12[r]=this.perm[r]%12}noise2D(t,i){const r=this.permMod12,s=this.perm;let n=0,o=0,a=0;const l=(t+i)*O_t,c=Math.floor(t+l),h=Math.floor(i+l),p=(c+h)*dA,f=c-p,m=h-p,y=t-f,v=i-m;let b,w;y>v?(b=1,w=0):(b=0,w=1);const S=y-b+dA,T=v-w+dA,E=y-1+2*dA,C=v-1+2*dA,A=c&255,I=h&255;let L=.5-y*y-v*v;if(L>=0){const z=r[A+s[I]]*3;L*=L,n=L*L*(bo[z]*y+bo[z+1]*v)}let D=.5-S*S-T*T;if(D>=0){const z=r[A+b+s[I+w]]*3;D*=D,o=D*D*(bo[z]*S+bo[z+1]*T)}let k=.5-E*E-C*C;if(k>=0){const z=r[A+1+s[I+1]]*3;k*=k,a=k*k*(bo[z]*E+bo[z+1]*C)}return 70*(n+o+a)}noise3D(t,i,r){const s=this.permMod12,n=this.perm;let o,a,l,c;const h=(t+i+r)*R_t,p=Math.floor(t+h),f=Math.floor(i+h),m=Math.floor(r+h),y=(p+f+m)*Gp,v=p-y,b=f-y,w=m-y,S=t-v,T=i-b,E=r-w;let C,A,I,L,D,k;S>=T?T>=E?(C=1,A=0,I=0,L=1,D=1,k=0):S>=E?(C=1,A=0,I=0,L=1,D=0,k=1):(C=0,A=0,I=1,L=1,D=0,k=1):T<E?(C=0,A=0,I=1,L=0,D=1,k=1):S<E?(C=0,A=1,I=0,L=0,D=1,k=1):(C=0,A=1,I=0,L=1,D=1,k=0);const z=S-C+Gp,V=T-A+Gp,X=E-I+Gp,Y=S-L+2*Gp,le=T-D+2*Gp,re=E-k+2*Gp,$=S-1+3*Gp,U=T-1+3*Gp,B=E-1+3*Gp,H=p&255,W=f&255,Q=m&255;let G=.6-S*S-T*T-E*E;if(G<0)o=0;else{const Me=s[H+n[W+n[Q]]]*3;G*=G,o=G*G*(bo[Me]*S+bo[Me+1]*T+bo[Me+2]*E)}let ee=.6-z*z-V*V-X*X;if(ee<0)a=0;else{const Me=s[H+C+n[W+A+n[Q+I]]]*3;ee*=ee,a=ee*ee*(bo[Me]*z+bo[Me+1]*V+bo[Me+2]*X)}let me=.6-Y*Y-le*le-re*re;if(me<0)l=0;else{const Me=s[H+L+n[W+D+n[Q+k]]]*3;me*=me,l=me*me*(bo[Me]*Y+bo[Me+1]*le+bo[Me+2]*re)}let _e=.6-$*$-U*U-B*B;if(_e<0)c=0;else{const Me=s[H+1+n[W+1+n[Q+1]]]*3;_e*=_e,c=_e*_e*(bo[Me]*$+bo[Me+1]*U+bo[Me+2]*B)}return 32*(o+a+l+c)}noise4D(t,i,r,s){const n=this.perm;let o,a,l,c,h;const p=(t+i+r+s)*P_t,f=Math.floor(t+p),m=Math.floor(i+p),y=Math.floor(r+p),v=Math.floor(s+p),b=(f+m+y+v)*Yo,w=f-b,S=m-b,T=y-b,E=v-b,C=t-w,A=i-S,I=r-T,L=s-E;let D=0,k=0,z=0,V=0;C>A?D++:k++,C>I?D++:z++,C>L?D++:V++,A>I?k++:z++,A>L?k++:V++,I>L?z++:V++;const X=D>=3?1:0,Y=k>=3?1:0,le=z>=3?1:0,re=V>=3?1:0,$=D>=2?1:0,U=k>=2?1:0,B=z>=2?1:0,H=V>=2?1:0,W=D>=1?1:0,Q=k>=1?1:0,G=z>=1?1:0,ee=V>=1?1:0,me=C-X+Yo,_e=A-Y+Yo,Me=I-le+Yo,ve=L-re+Yo,ge=C-$+2*Yo,Ce=A-U+2*Yo,$e=I-B+2*Yo,gi=L-H+2*Yo,wi=C-W+3*Yo,Ht=A-Q+3*Yo,xi=I-G+3*Yo,Yt=L-ee+3*Yo,Ti=C-1+4*Yo,mr=A-1+4*Yo,Or=I-1+4*Yo,Qe=L-1+4*Yo,Gi=f&255,os=m&255,ln=y&255,Gs=v&255;let ko=.6-C*C-A*A-I*I-L*L;if(ko<0)o=0;else{const Lr=n[Gi+n[os+n[ln+n[Gs]]]]%32*4;ko*=ko,o=ko*ko*(xn[Lr]*C+xn[Lr+1]*A+xn[Lr+2]*I+xn[Lr+3]*L)}let zo=.6-me*me-_e*_e-Me*Me-ve*ve;if(zo<0)a=0;else{const Lr=n[Gi+X+n[os+Y+n[ln+le+n[Gs+re]]]]%32*4;zo*=zo,a=zo*zo*(xn[Lr]*me+xn[Lr+1]*_e+xn[Lr+2]*Me+xn[Lr+3]*ve)}let js=.6-ge*ge-Ce*Ce-$e*$e-gi*gi;if(js<0)l=0;else{const Lr=n[Gi+$+n[os+U+n[ln+B+n[Gs+H]]]]%32*4;js*=js,l=js*js*(xn[Lr]*ge+xn[Lr+1]*Ce+xn[Lr+2]*$e+xn[Lr+3]*gi)}let Rc=.6-wi*wi-Ht*Ht-xi*xi-Yt*Yt;if(Rc<0)c=0;else{const Lr=n[Gi+W+n[os+Q+n[ln+G+n[Gs+ee]]]]%32*4;Rc*=Rc,c=Rc*Rc*(xn[Lr]*wi+xn[Lr+1]*Ht+xn[Lr+2]*xi+xn[Lr+3]*Yt)}let fm=.6-Ti*Ti-mr*mr-Or*Or-Qe*Qe;if(fm<0)h=0;else{const Lr=n[Gi+1+n[os+1+n[ln+1+n[Gs+1]]]]%32*4;fm*=fm,h=fm*fm*(xn[Lr]*Ti+xn[Lr+1]*mr+xn[Lr+2]*Or+xn[Lr+3]*Qe)}return 27*(o+a+l+c+h)}}var GSt=I_t;function $_t(e){const t=new Uint8Array(256);for(let i=0;i<256;i++)t[i]=i;for(let i=0;i<255;i++){const r=i+~~(e()*(256-i)),s=t[i];t[i]=t[r],t[r]=s}return t}function D_t(e){let t=0,i=0,r=0,s=1;const n=L_t();return t=n(" "),i=n(" "),r=n(" "),t-=n(e),t<0&&(t+=1),i-=n(e),i<0&&(i+=1),r-=n(e),r<0&&(r+=1),function(){const o=2091639*t+s*23283064365386963e-26;return t=i,i=r,r=o-(s=o|0)}}function L_t(){let e=4022871197;return function(t){t=t.toString();for(let i=0;i<t.length;i++){e+=t.charCodeAt(i);let r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=r*4294967296}return(e>>>0)*23283064365386963e-26}}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const N_t="calcite-theme-auto",F_t="calcite-theme-dark",U_t="calcite-theme-light",k_t={autoTheme:N_t,darkTheme:F_t,lightTheme:U_t,rtl:"calcite--rtl"},z_t={loading:"Loading"};function EEe(e){const t="dir",i=`[${t}]`,r=hJ(e,i);return r?r.getAttribute(t):"ltr"}function Xce(e,t,i){const r=`[${t}]`,s=e.closest(r);return s?s.getAttribute(t):i}function CEe(e){return e.getRootNode()}function AEe(e){return e.host||null}function V_t(e,{selector:t,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=CEe(s),o=i?"getElementById"in n?n.getElementById(i):null:t?n.querySelector(t):null,a=AEe(n);return o||(a?r(a):null)}return r(e)}function hJ(e,t){function i(r){return r?r.closest(t)||i(AEe(CEe(r))):null}return i(e)}function B_t(e){return typeof(e==null?void 0:e.setFocus)=="function"}async function G_t(e){if(!!e)return B_t(e)?e.setFocus():e.focus()}const e3=":not([slot])";function Yce(e,t,i){t&&!Array.isArray(t)&&typeof t!="string"&&(i=t,t=null);const r=t?Array.isArray(t)?t.map(s=>`[slot="${s}"]`).join(","):`[slot="${t}"]`:e3;return i!=null&&i.all?j_t(e,r,i):H_t(e,r,i)}function MEe(e,t){return e?Array.from(e.children||[]).filter(i=>i==null?void 0:i.matches(t)):[]}function j_t(e,t,i){let r=t===e3?MEe(e,e3):Array.from(e.querySelectorAll(t));r=i&&i.direct===!1?r:r.filter(n=>n.parentElement===e),r=i!=null&&i.matches?r.filter(n=>n==null?void 0:n.matches(i.matches)):r;const s=i==null?void 0:i.selector;return s?r.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):r}function H_t(e,t,i){let r=t===e3?MEe(e,e3)[0]||null:e.querySelector(t);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===e?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const s=i==null?void 0:i.selector;return s?r==null?void 0:r.querySelector(s):r}function Zce(e,t,i){if(typeof t=="string"&&t!=="")return t;if(t==="")return e[i]}function q_t(e){return(!!e).toString()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const OEe="calciteInternalLabelClick",ez="calciteInternalLabelConnected",Y4="calciteInternaLabelDisconnected",Qce="calcite-label",Z4=new WeakMap,t3=new WeakMap,Q4=new WeakMap,c2=new Set,W_t=e=>{const{id:t}=e,i=t&&V_t(e,{selector:`${Qce}[for="${t}"]`});if(i)return i;const r=hJ(e,Qce);return!r||X_t(r,e)?null:r};function X_t(e,t){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(t),a.indexOf(e))};return e.addEventListener(r,s,{once:!0}),t.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),e.removeEventListener(r,s),i.filter(o=>o!==t&&o!==e).filter(o=>{var a;return(a=o.tagName)===null||a===void 0?void 0:a.includes("-")}).length>0}function dJ(e){const t=W_t(e.el);if(Z4.has(t)||!t&&c2.has(e))return;const i=Q_t.bind(e);if(t){e.labelEl=t;const r=Y_t.bind(e);Z4.set(e.labelEl,r),e.labelEl.addEventListener(OEe,r),c2.delete(e),document.removeEventListener(ez,t3.get(e)),Q4.set(e,i),document.addEventListener(Y4,i)}else c2.has(e)||(i(),document.removeEventListener(Y4,Q4.get(e)))}function REe(e){if(c2.delete(e),document.removeEventListener(ez,t3.get(e)),document.removeEventListener(Y4,Q4.get(e)),t3.delete(e),Q4.delete(e),!e.labelEl)return;const t=Z4.get(e.labelEl);e.labelEl.removeEventListener(OEe,t),Z4.delete(e.labelEl)}function Jce(e){var t,i;return e.label||((i=(t=e.labelEl)===null||t===void 0?void 0:t.textContent)===null||i===void 0?void 0:i.trim())||""}function Y_t(e){this.disabled||this.el.contains(e.detail.sourceEvent.target)||this.onLabelClick(e)}function Z_t(){c2.has(this)&&dJ(this)}function Q_t(){c2.add(this);const e=t3.get(this)||Z_t.bind(this);t3.set(this,e),document.addEventListener(ez,e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const J_t={container:"container"},K_t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:inline}:host([alignment=start]){text-align:start}:host([alignment=end]){text-align:end}:host([alignment=center]){text-align:center}:host([scale=s]) .container{margin-bottom:0.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=m]) .container{margin-bottom:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) .container{margin-bottom:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host .container{margin-top:0px;margin-right:0px;margin-left:0px;width:100%;line-height:1.375;color:var(--calcite-ui-text-1)}:host([layout=default]) .container{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;gap:0.25rem}:host([layout=inline]) .container,:host([layout=inline-space-between]) .container{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;gap:0.5rem}:host([layout=inline][scale=l]) .container{gap:0.75rem}:host([layout=inline-space-between]) .container{-ms-flex-pack:justify;justify-content:space-between}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled])>.container{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted(*){pointer-events:none}:host([disabled]) ::slotted(*[disabled]),:host([disabled]) ::slotted(*[disabled] *){--tw-bg-opacity:1}:host([disabled]) ::slotted(calcite-input-message:not([active])){--tw-bg-opacity:0}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([disable-spacing]) .container{margin:0px;gap:0px}",e1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.calciteInternalLabelClick=Ab(this,"calciteInternalLabelClick",3),this.alignment="start",this.status="idle",this.scale="m",this.layout="default",this.disableSpacing=!1,this.disabled=!1,this.labelClickHandler=e=>{this.calciteInternalLabelClick.emit({sourceEvent:e})}}connectedCallback(){document.dispatchEvent(new CustomEvent(ez))}disconnectedCallback(){document.dispatchEvent(new CustomEvent(Y4))}render(){return ui(y5,{onClick:this.labelClickHandler},ui("div",{class:J_t.container},ui("slot",null)))}get el(){return this}static get style(){return K_t}},[1,"calcite-label",{alignment:[513],status:[513],for:[513],scale:[513],layout:[513],disableSpacing:[4,"disable-spacing"],disabled:[516]}]);function t1t(){if(typeof customElements=="undefined")return;["calcite-label"].forEach(t=>{switch(t){case"calcite-label":customElements.get(t)||customElements.define(t,e1t);break}})}t1t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const Rq="hidden-form-input";function pJ(e){return"checked"in e}const Pq=new WeakMap,fJ=new WeakSet;function i1t(e,t){const i="calciteInternalFormComponentRegister";let r=!1;return e.addEventListener(i,s=>{r=s.composedPath().some(n=>fJ.has(n)),s.stopPropagation()},{once:!0}),t.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0})),r}function r1t(e){var t;(t=e.formEl)===null||t===void 0||t.requestSubmit()}function PEe(e){const{el:t,value:i}=e,r=hJ(t,"form");if(!r||i1t(r,t))return;e.formEl=r,e.defaultValue=i,pJ(e)&&(e.defaultChecked=e.checked);const s=(e.onFormReset||s1t).bind(e);r.addEventListener("reset",s),Pq.set(e.el,s),fJ.add(t)}function s1t(){if(pJ(this)){this.checked=this.defaultChecked;return}this.value=this.defaultValue}function IEe(e){const{el:t,formEl:i}=e;if(!i)return;const r=Pq.get(t);i.removeEventListener("reset",r),Pq.delete(t),e.formEl=null,fJ.delete(t)}function n1t(e,t){e.defaultValue=t}function o1t(e){const{el:t,formEl:i,name:r,value:s}=e,{ownerDocument:n}=t,o=t.querySelectorAll(`input[slot="${Rq}"]`);if(!i||!r){o.forEach(p=>p.remove());return}const a=Array.isArray(s)?s:[s],l=[],c=new Set;o.forEach(p=>{const f=a.find(m=>m==p.value);f!=null?(c.add(f),Kce(e,p,f)):l.push(p)});let h;a.forEach(p=>{if(c.has(p))return;let f=l.pop();f||(f=n.createElement("input"),f.slot=Rq),h||(h=n.createDocumentFragment()),h.append(f),Kce(e,f,p)}),h&&t.append(h),l.forEach(p=>p.remove())}function Kce(e,t,i){var r;const{defaultValue:s,disabled:n,name:o,required:a}=e;t.defaultValue=s,t.disabled=n,t.name=o,t.required=a,t.tabIndex=-1,pJ(e)?(t.defaultChecked=e.defaultChecked,t.value=e.checked?i||"on":"",!n&&!e.checked&&(t.disabled=!0)):t.value=i||"",(r=e.syncHiddenFormInput)===null||r===void 0||r.call(e,t)}const $Ee=({component:e})=>(o1t(e),ui("slot",{name:Rq}));/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */function tz(e,t,i){const r=a1t(e);return Wde.isBrowser?new r(t,i):void 0}function a1t(e){return e==="intersection"?window.IntersectionObserver:e==="mutation"?window.MutationObserver:window.ResizeObserver}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */function l1t(){}function DEe(e,t=!1){if(e.disabled){e.el.setAttribute("tabindex","-1"),e.el.setAttribute("aria-disabled","true"),e.el.contains(document.activeElement)&&document.activeElement.blur(),e.el.click=l1t;return}e.el.click=HTMLElement.prototype.click,typeof t=="function"?e.el.setAttribute("tabindex",t.call(e)?"0":"-1"):t===!0?e.el.setAttribute("tabindex","0"):t===!1&&e.el.removeAttribute("tabindex"),e.el.removeAttribute("aria-disabled")}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const c1t={icon:"icon",flipRtl:"flip-rtl"},g8={},y8={},LEe={s:16,m:24,l:32};async function u1t({icon:e,scale:t}){const i=LEe[t],r=h1t(e),s=r.charAt(r.length-1)==="F",o=`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`;if(g8[o])return g8[o];y8[o]||(y8[o]=fetch(C3e(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await y8[o];return g8[o]=a,a}function h1t(e){const t=!isNaN(Number(e.charAt(0))),i=e.split("-");return i.length===1?t?`i${e}`:e:i.map((r,s)=>s===0?t?`i${r.toUpperCase()}`:r:r.charAt(0).toUpperCase()+r.slice(1)).join("")}const d1t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:-ms-inline-flexbox;display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){height:1rem;width:1rem;min-width:1rem;min-height:1rem}:host([scale=m]){height:1.5rem;width:1.5rem;min-width:1.5rem;min-height:1.5rem}:host([scale=l]){height:2rem;width:2rem;min-width:2rem;min-height:2rem}.flip-rtl{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.svg{display:block}",p1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){var e;(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:e,flipRtl:t,pathData:i,scale:r,textLabel:s}=this,n=EEe(e),o=LEe[r],a=!!s,l=[].concat(i||"");return ui(y5,{"aria-hidden":q_t(!a),"aria-label":a?s:null,role:a?"img":null},ui("svg",{class:{[c1t.flipRtl]:n==="rtl"&&t,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?ui("path",{d:c}):ui("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:e,scale:t,visible:i}=this;!Wde.isBrowser||!e||!i||(this.pathData=await u1t({icon:e,scale:t}))}waitUntilVisible(e){if(this.intersectionObserver=tz("intersection",t=>{t.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return d1t}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function mJ(){if(typeof customElements=="undefined")return;["calcite-icon"].forEach(t=>{switch(t){case"calcite-icon":customElements.get(t)||customElements.define(t,p1t);break}})}mJ();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const v8={icon:"icon",iconContainer:"icon-container",select:"select"},f1t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:host{--calcite-icon-size:1rem;--calcite-spacing-eighth:0.125rem;--calcite-spacing-quarter:0.25rem;--calcite-spacing-half:0.5rem;--calcite-spacing-three-quarters:0.75rem;--calcite-spacing:1rem;--calcite-spacing-plus-quarter:1.25rem;--calcite-spacing-plus-half:1.5rem;--calcite-spacing-double:2rem;--calcite-menu-min-width:10rem;--calcite-header-min-height:3rem;--calcite-footer-min-height:3rem}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;display:-ms-flexbox;display:flex;-ms-flex-align:stretch;align-items:stretch;width:var(--select-width)}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([scale=s]){height:1.5rem;--calcite-select-font-size:var(--calcite-font-size--2);--calcite-select-spacing-inline:0.5rem 2rem}:host([scale=s]) .icon-container{padding-left:0.5rem;padding-right:0.5rem}:host([scale=m]){height:2rem;--calcite-select-font-size:var(--calcite-font-size--1);--calcite-select-spacing-inline:0.75rem 2.5rem}:host([scale=m]) .icon-container{padding-left:0.75rem;padding-right:0.75rem}:host([scale=l]){height:44px;--calcite-select-font-size:var(--calcite-font-size-0);--calcite-select-spacing-inline:1rem 3rem}:host([scale=l]) .icon-container{padding-left:1rem;padding-right:1rem}:host([width=auto]){width:auto}:host([width=half]){width:50%}:host([width=full]){width:100%}.select{margin:0px;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border-radius:0px;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);font-family:inherit;color:var(--calcite-ui-text-2);outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;font-size:var(--calcite-select-font-size);padding-inline:var(--calcite-select-spacing-inline);border-inline-end-width:0px}.select:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px}.select:hover{background-color:var(--calcite-ui-foreground-2)}select:disabled{border-color:var(--calcite-ui-border-input);--tw-bg-opacity:1}.icon-container{pointer-events:none;position:absolute;top:0px;bottom:0px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-width:0px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:transparent;color:var(--calcite-ui-text-2);inset-inline-end:0px;border-inline-width:0px 1px}.select:focus~.icon-container{border-color:transparent}::slotted(input[slot=hidden-form-input]){bottom:0 !important;left:0 !important;margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;right:0 !important;top:0 !important;-webkit-transform:none !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}";function _D(e){return e.tagName==="CALCITE-OPTION"}function m1t(e){return e.tagName==="CALCITE-OPTION-GROUP"}const g1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.calciteSelectChange=Ab(this,"calciteSelectChange",7),this.disabled=!1,this.required=!1,this.scale="m",this.value=null,this.width="auto",this.componentToNativeEl=new Map,this.mutationObserver=tz("mutation",()=>this.populateInternalSelect()),this.handleInternalSelectChange=()=>{const e=this.selectEl.selectedOptions[0];this.selectFromNativeOption(e),requestAnimationFrame(()=>this.emitChangeEvent())},this.populateInternalSelect=()=>{const e=Array.from(this.el.children).filter(t=>t.tagName==="CALCITE-OPTION"||t.tagName==="CALCITE-OPTION-GROUP");this.clearInternalSelect(),e.forEach(t=>{var i;return(i=this.selectEl)===null||i===void 0?void 0:i.append(this.toNativeElement(t))})},this.storeSelectRef=e=>{this.selectEl=e,this.populateInternalSelect();const t=this.selectEl.selectedOptions[0];this.selectFromNativeOption(t)},this.emitChangeEvent=()=>{this.calciteSelectChange.emit()}}valueHandler(e){this.el.querySelectorAll("calcite-option").forEach(i=>i.selected=i.value===e)}selectedOptionHandler(e){this.value=e==null?void 0:e.value}connectedCallback(){var e;const{el:t}=this;(e=this.mutationObserver)===null||e===void 0||e.observe(t,{subtree:!0,childList:!0}),dJ(this),PEe(this)}disconnectedCallback(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect(),REe(this),IEe(this)}componentDidLoad(){var e,t;n1t(this,(t=(e=this.selectedOption)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:"")}componentDidRender(){DEe(this)}async setFocus(){G_t(this.selectEl)}handleOptionOrGroupChange(e){e.stopPropagation();const t=e.target,i=this.componentToNativeEl.get(t);!i||(this.updateNativeElement(t,i),_D(t)&&t.selected&&(this.deselectAllExcept(t),this.selectedOption=t))}onLabelClick(){this.setFocus()}updateNativeElement(e,t){if(t.disabled=e.disabled,t.label=e.label,_D(e)){const i=t;i.selected=e.selected,i.value=e.value,i.innerText=e.label}}clearInternalSelect(){this.componentToNativeEl.forEach(e=>e.remove()),this.componentToNativeEl.clear()}selectFromNativeOption(e){if(!e)return;let t;this.componentToNativeEl.forEach((i,r)=>{_D(r)&&i===e&&(r.selected=!0,t=r,this.deselectAllExcept(r))}),t&&(this.selectedOption=t)}toNativeElement(e){if(_D(e)){const t=document.createElement("option");return this.updateNativeElement(e,t),this.componentToNativeEl.set(e,t),t}if(m1t(e)){const t=document.createElement("optgroup");return this.updateNativeElement(e,t),Array.from(e.children).forEach(i=>{const r=this.toNativeElement(i);t.append(r),this.componentToNativeEl.set(e,r)}),this.componentToNativeEl.set(e,t),t}throw new Error("unsupported element child provided")}deselectAllExcept(e){this.el.querySelectorAll("calcite-option").forEach(t=>{t!==e&&(t.selected=!1)})}renderChevron(){return ui("div",{class:v8.iconContainer},ui("calcite-icon",{class:v8.icon,icon:"chevron-down",scale:"s"}))}render(){return ui(M3e,null,ui("select",{"aria-label":this.label,class:v8.select,disabled:this.disabled,onChange:this.handleInternalSelectChange,ref:this.storeSelectRef},ui("slot",null)),this.renderChevron(),ui($Ee,{component:this}))}get el(){return this}static get watchers(){return{value:["valueHandler"],selectedOption:["selectedOptionHandler"]}}static get style(){return f1t}},[1,"calcite-select",{disabled:[516],label:[1],name:[1],required:[516],scale:[513],value:[1025],selectedOption:[1040],width:[513],setFocus:[64]},[[0,"calciteOptionChange","handleOptionOrGroupChange"],[0,"calciteOptionGroupChange","handleOptionOrGroupChange"]]]);function y1t(){if(typeof customElements=="undefined")return;["calcite-select","calcite-icon"].forEach(t=>{switch(t){case"calcite-select":customElements.get(t)||customElements.define(t,g1t);break;case"calcite-icon":customElements.get(t)||mJ();break}})}y1t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const v1t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:block}",_1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.calciteOptionChange=Ab(this,"calciteOptionChange",7),this.disabled=!1,this.mutationObserver=tz("mutation",()=>{this.ensureTextContentDependentProps(),this.calciteOptionChange.emit()})}handlePropChange(e,t,i){(i==="label"||i==="value")&&this.ensureTextContentDependentProps(),this.calciteOptionChange.emit()}ensureTextContentDependentProps(){const{el:{textContent:e}}=this;(!this.label||this.label===this.internallySetLabel)&&(this.label=e,this.internallySetLabel=e),(!this.value||this.value===this.internallySetValue)&&(this.value=e,this.internallySetValue=e)}connectedCallback(){var e;this.ensureTextContentDependentProps(),(e=this.mutationObserver)===null||e===void 0||e.observe(this.el,{attributeFilter:["label","value"],characterData:!0,childList:!0,subtree:!0})}disconnectedCallback(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect()}render(){return ui("slot",null,this.label)}get el(){return this}static get watchers(){return{disabled:["handlePropChange"],label:["handlePropChange"],selected:["handlePropChange"],value:["handlePropChange"]}}static get style(){return v1t}},[1,"calcite-option",{disabled:[516],label:[1025],selected:[516],value:[1032]}]);function b1t(){if(typeof customElements=="undefined")return;["calcite-option"].forEach(t=>{switch(t){case"calcite-option":customElements.get(t)||customElements.define(t,_1t);break}})}b1t();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const gJ=["0","1","2","3","4","5","6","7","8","9"];function Fd(e){return!(!e||isNaN(Number(e)))}function w1t(e){return!e||!E1t(e)?"":iz(e,t=>{let i=!1;const r=t.split("").filter((s,n)=>s.match(/\./g)&&!i?(i=!0,!0):s.match(/\-/g)&&n===0?!0:gJ.includes(s)).reduce((s,n)=>s+n);return Fd(r)?Number(r).toString():""})}function NEe(e){const t=/(?!^\.)\.$/;return e.replace(t,"")}function x1t(e){const t=/(?!^-)-/g;return e.replace(t,"")}function T1t(e){const t=/^([-0])0+(?=\d)/;return e.replace(t,"$1")}function S1t(e){return iz(e,t=>{const i=x1t(NEe(T1t(t))),r=/^-\b0\b\.?0*$/;return Fd(i)?r.test(i)?i:Number(i).toString():t})}function iz(e,t){if(!e)return e;const i=e.toLowerCase().indexOf("e")+1;return e.replace(/[eE]*$/g,"").substring(0,i).concat(e.slice(i).replace(/[eE]/g,"")).split(/[eE]/).map((r,s)=>t(s===1?r.replace(/\./g,""):r)).join("e").replace(/^e/,"1e")}function E1t(e){return gJ.some(t=>e.includes(t))}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const C1t=new RegExp("[.](?=.*[.])","g"),A1t=new RegExp("[^0-9-.]","g"),M1t=new RegExp(",","g");function rz(e){return new Intl.NumberFormat(e,{minimumFractionDigits:0,maximumFractionDigits:20})}function O1t(e,t){return iz(e,i=>{const r=i.replace(UEe(t),"-").replace(FEe(t),"").replace(yJ(t),".").replace(C1t,"").replace(A1t,"");return Fd(r)?r:i})}function FEe(e){const r=rz(e).formatToParts(1234567).find(s=>s.type==="group").value;return r.trim().length===0?" ":r}function yJ(e){return rz(e).formatToParts(1.1).find(r=>r.type==="decimal").value}function UEe(e){return rz(e).formatToParts(-9).find(r=>r.type==="minusSign").value}function eue(e,t,i=!1){return iz(e,r=>{if(r){const s=Number(NEe(r.replace(M1t,"")));if(!isNaN(s))return rz(t).formatToParts(s).map(({type:l,value:c})=>{switch(l){case"group":return i?FEe(t):"";case"decimal":return yJ(t);case"minusSign":return UEe(t);default:return c}}).reduce((l,c)=>l+c)}return r})}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const tue=e=>{const t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const R1t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;display:block;width:100%}.track,.bar{position:absolute;top:0px;height:2px}.track{z-index:0;width:100%;overflow:hidden;background:var(--calcite-ui-border-3)}.bar{z-index:0;background-color:var(--calcite-ui-brand)}@media (forced-colors: active){.track{background-color:highlightText}.bar{background-color:linkText}}.indeterminate{width:20%;-webkit-animation:looping-progress-bar-ani 2200ms linear infinite;animation:looping-progress-bar-ani 2200ms linear infinite}.reversed{animation-direction:reverse}.text{padding-left:0px;padding-right:0px;padding-top:1rem;padding-bottom:0px;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium)}@-webkit-keyframes looping-progress-bar-ani{0%{-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0)}50%{width:40%}100%{-webkit-transform:translate3d(600%, 0, 0);transform:translate3d(600%, 0, 0)}}@keyframes looping-progress-bar-ani{0%{-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0)}50%{width:40%}100%{-webkit-transform:translate3d(600%, 0, 0);transform:translate3d(600%, 0, 0)}}",P1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.type="determinate",this.value=0,this.reversed=!1}render(){const t=this.type==="determinate"?{width:`${this.value*100}%`}:{};return ui("div",{"aria-label":this.label||this.text,"aria-valuemax":1,"aria-valuemin":0,"aria-valuenow":this.value,role:"progressbar"},ui("div",{class:"track"},ui("div",{class:{bar:!0,indeterminate:this.type==="indeterminate",reversed:this.reversed},style:t})),this.text?ui("div",{class:"text"},this.text):null)}get el(){return this}static get style(){return R1t}},[1,"calcite-progress",{type:[1],value:[2],label:[1],text:[1],reversed:[4]}]);function kEe(){if(typeof customElements=="undefined")return;["calcite-progress"].forEach(t=>{switch(t){case"calcite-progress":customElements.get(t)||customElements.define(t,P1t);break}})}kEe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const ya={loader:"loader",clearButton:"clear-button",editingEnabled:"editing-enabled",inlineChild:"inline-child",inputIcon:"icon",prefix:"prefix",suffix:"suffix",numberButtonWrapper:"number-button-wrapper",buttonItemHorizontal:"number-button-item--horizontal",wrapper:"element-wrapper",inputWrapper:"wrapper",actionWrapper:"action-wrapper",resizeIconWrapper:"resize-icon-wrapper",numberButtonItem:"number-button-item"},iue={tel:"phone",password:"lock",email:"email-address",date:"calendar",time:"clock",search:"search"},I1t={action:"action"},$1t={clear:"Clear value"},D1t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:block}:host([scale=s]) input,:host([scale=s]) .prefix,:host([scale=s]) .suffix{height:1.5rem;padding:0.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s]) textarea{height:1.5rem;min-height:1.5rem}:host([scale=s]) .number-button-wrapper,:host([scale=s]) .action-wrapper calcite-button,:host([scale=s]) .action-wrapper calcite-button button{height:1.5rem}:host([scale=s]) input[type=file]{height:1.5rem}:host([scale=s]) .clear-button{min-height:1.5rem;min-width:1.5rem}:host([scale=s]) textarea{height:auto;padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.5rem;padding-right:0.5rem;font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=m]) input,:host([scale=m]) .prefix,:host([scale=m]) .suffix{height:2rem;padding:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]) textarea{min-height:2rem}:host([scale=m]) .number-button-wrapper,:host([scale=m]) .action-wrapper calcite-button,:host([scale=m]) .action-wrapper calcite-button button{height:2rem}:host([scale=m]) input[type=file]{height:2rem}:host([scale=m]) .clear-button{min-height:2rem;min-width:2rem}:host([scale=m]) textarea{height:auto;padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) input,:host([scale=l]) .prefix,:host([scale=l]) .suffix{height:2.75rem;padding:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]) textarea{min-height:2.75rem}:host([scale=l]) .number-button-wrapper,:host([scale=l]) .action-wrapper calcite-button,:host([scale=l]) .action-wrapper calcite-button button{height:2.75rem}:host([scale=l]) input[type=file]{height:2.75rem}:host([scale=l]) .clear-button{min-height:2.75rem;min-width:2.75rem}:host([scale=l]) textarea{height:auto;padding-top:0.75rem;padding-bottom:0.75rem;padding-left:1rem;padding-right:1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) textarea{resize:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host textarea,:host input{-webkit-transition:var(--calcite-animation-timing), height 0s;transition:var(--calcite-animation-timing), height 0s;-webkit-appearance:none;position:relative;margin:0px;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;max-height:100%;width:100%;max-width:100%;-ms-flex:1 1 0%;flex:1 1 0%;border-radius:0px;background-color:var(--calcite-ui-foreground-1);font-family:inherit;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-1)}:host input[type=search]::-webkit-search-decoration{-webkit-appearance:none}:host input,:host textarea{border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);color:var(--calcite-ui-text-1)}:host input:-ms-input-placeholder,:host textarea:-ms-input-placeholder{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-3)}:host input::-ms-input-placeholder,:host textarea::-ms-input-placeholder{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-3)}:host input::placeholder,:host input:-ms-input-placeholder,:host input::-ms-input-placeholder,:host textarea::placeholder,:host textarea:-ms-input-placeholder,:host textarea::-ms-input-placeholder{font-weight:var(--calcite-font-weight-normal);color:var(--calcite-ui-text-3)}:host input:focus,:host textarea:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-1)}:host input[readonly],:host textarea[readonly]{background-color:var(--calcite-ui-background);font-weight:var(--calcite-font-weight-medium)}:host input[readonly]:focus,:host textarea[readonly]:focus{color:var(--calcite-ui-text-1)}:host calcite-icon{color:var(--calcite-ui-text-3)}:host textarea,:host input{outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out}:host textarea:focus,:host input:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px}:host([status=invalid]) input,:host([status=invalid]) textarea{border-color:var(--calcite-ui-danger)}:host([status=invalid]) input:focus,:host([status=invalid]) textarea:focus{outline:2px solid var(--calcite-ui-danger);outline-offset:-2px}:host([scale=s]) .icon{inset-inline-start:0.5rem}:host([scale=m]) .icon{inset-inline-start:0.75rem}:host([scale=l]) .icon{inset-inline-start:1rem}:host([icon][scale=s]) input{-webkit-padding-start:2rem;padding-inline-start:2rem}:host([icon][scale=m]) input{-webkit-padding-start:2.5rem;padding-inline-start:2.5rem}:host([icon][scale=l]) input{-webkit-padding-start:3rem;padding-inline-start:3rem}.element-wrapper{position:relative;-ms-flex-order:3;order:3;display:-ms-inline-flexbox;display:inline-flex;-ms-flex:1 1 0%;flex:1 1 0%;-ms-flex-align:center;align-items:center}.icon{pointer-events:none;position:absolute;z-index:10;display:block;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}input[type=text]::-ms-clear,input[type=text]::-ms-reveal{display:none;height:0px;width:0px}input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration,input[type=date]::-webkit-clear-button,input[type=time]::-webkit-clear-button{display:none}.clear-button{pointer-events:initial;-ms-flex-order:4;order:4;margin:0px;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;min-height:100%;cursor:pointer;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;-ms-flex-item-align:stretch;align-self:stretch;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;border-inline-start-width:0px}.clear-button:hover{background-color:var(--calcite-ui-foreground-2);-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}.clear-button:hover calcite-icon{color:var(--calcite-ui-text-1);-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}.clear-button:active{background-color:var(--calcite-ui-foreground-3)}.clear-button:active calcite-icon{color:var(--calcite-ui-text-1)}.clear-button:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:-2px}.clear-button:disabled{opacity:var(--calcite-ui-opacity-disabled)}.loader{top:1px;left:1px;right:1px;pointer-events:none;position:absolute;display:block}.action-wrapper{-ms-flex-order:7;order:7;display:-ms-flexbox;display:flex}.prefix,.suffix{-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;height:auto;min-height:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-flex-line-pack:center;align-content:center;-ms-flex-align:center;align-items:center;overflow-wrap:break-word;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-background);font-weight:var(--calcite-font-weight-medium);line-height:1;color:var(--calcite-ui-text-2)}.prefix{-ms-flex-order:2;order:2;border-inline-end-width:0px}.suffix{-ms-flex-order:5;order:5;border-inline-start-width:0px}:host([alignment=start]) textarea,:host([alignment=start]) input{text-align:start}:host([alignment=end]) textarea,:host([alignment=end]) input{text-align:end}:host input[type=number]{-moz-appearance:textfield}:host input[type=number]::-webkit-inner-spin-button,:host input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;-moz-appearance:textfield;margin:0px}.number-button-wrapper{pointer-events:none;-ms-flex-order:6;order:6;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}:host([number-button-type=vertical]) .wrapper{-ms-flex-direction:row;flex-direction:row;display:-ms-flexbox;display:flex}:host([number-button-type=vertical]) input,:host([number-button-type=vertical]) textarea{-ms-flex-order:2;order:2}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=down] calcite-icon{-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}:host([number-button-type=horizontal]) .calcite--rtl .number-button-item[data-adjustment=up] calcite-icon{-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.number-button-item.number-button-item--horizontal[data-adjustment=down],.number-button-item.number-button-item--horizontal[data-adjustment=up]{-ms-flex-order:1;order:1;max-height:100%;min-height:100%;-ms-flex-item-align:stretch;align-self:stretch}.number-button-item.number-button-item--horizontal[data-adjustment=down] calcite-icon,.number-button-item.number-button-item--horizontal[data-adjustment=up] calcite-icon{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.number-button-item.number-button-item--horizontal[data-adjustment=down]{border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);border-inline-end-width:0px}.number-button-item.number-button-item--horizontal[data-adjustment=down]:hover{background-color:var(--calcite-ui-foreground-2)}.number-button-item.number-button-item--horizontal[data-adjustment=down]:hover calcite-icon{color:var(--calcite-ui-text-1)}.number-button-item.number-button-item--horizontal[data-adjustment=up]{-ms-flex-order:5;order:5}.number-button-item.number-button-item--horizontal[data-adjustment=up]:hover{background-color:var(--calcite-ui-foreground-2)}.number-button-item.number-button-item--horizontal[data-adjustment=up]:hover calcite-icon{color:var(--calcite-ui-text-1)}:host([number-button-type=vertical]) .number-button-item[data-adjustment=down]:hover{background-color:var(--calcite-ui-foreground-2)}:host([number-button-type=vertical]) .number-button-item[data-adjustment=down]:hover calcite-icon{color:var(--calcite-ui-text-1)}:host([number-button-type=vertical]) .number-button-item[data-adjustment=up]:hover{background-color:var(--calcite-ui-foreground-2)}:host([number-button-type=vertical]) .number-button-item[data-adjustment=up]:hover calcite-icon{color:var(--calcite-ui-text-1)}:host([number-button-type=vertical]) .number-button-item[data-adjustment=down]{border-top-width:0px}.number-button-item{max-height:50%;min-height:50%;pointer-events:initial;margin:0px;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;cursor:pointer;-ms-flex-align:center;align-items:center;-ms-flex-item-align:center;align-self:center;border-width:1px;border-style:solid;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);padding-top:0px;padding-bottom:0px;padding-left:0.5rem;padding-right:0.5rem;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s;border-inline-start-width:0px}.number-button-item calcite-icon{pointer-events:none;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}.number-button-item:focus{background-color:var(--calcite-ui-foreground-2)}.number-button-item:focus calcite-icon{color:var(--calcite-ui-text-1)}.number-button-item:active{background-color:var(--calcite-ui-foreground-3)}.wrapper{position:relative;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center}:host input::-webkit-calendar-picker-indicator{display:none}:host input[type=date]::-webkit-input-placeholder{visibility:hidden !important}:host textarea::-webkit-resizer{position:absolute;bottom:0px;-webkit-box-sizing:border-box;box-sizing:border-box;padding-top:0px;padding-bottom:0px;padding-left:0.25rem;padding-right:0.25rem;inset-inline-end:0}.resize-icon-wrapper{bottom:2px;inset-inline-end:2px;pointer-events:none;position:absolute;z-index:10;height:0.75rem;width:0.75rem;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-3)}.resize-icon-wrapper calcite-icon{bottom:0.25rem;inset-inline-end:0.25rem;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.calcite--rtl .resize-icon-wrapper calcite-icon{-webkit-transform:rotate(45deg);transform:rotate(45deg)}:host([type=color]) input{padding:0.25rem}:host([type=file]) input{cursor:pointer;border-width:1px;border-style:dashed;border-color:var(--calcite-ui-border-input);background-color:var(--calcite-ui-foreground-1);text-align:center}:host([type=file][scale=s]) input{padding-top:1px;padding-bottom:1px;padding-left:0.5rem;padding-right:0.5rem}:host([type=file][scale=m]) input{padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem}:host([type=file][scale=l]) input{padding-top:0.5rem;padding-bottom:0.5rem;padding-left:1rem;padding-right:1rem}:host(.no-bottom-border) input{border-bottom-width:0px}:host(.border-top-color-one) input{border-top-color:var(--calcite-ui-border-1)}:host .inline-child{background-color:transparent;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:var(--calcite-animation-timing);transition-duration:var(--calcite-animation-timing);-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;-webkit-transition-delay:0s;transition-delay:0s}:host .inline-child .editing-enabled{background-color:inherit}:host .inline-child:not(.editing-enabled){display:-ms-flexbox;display:flex;cursor:pointer;border-color:transparent;-webkit-padding-start:0;padding-inline-start:0}::slotted(input[slot=hidden-form-input]){bottom:0 !important;left:0 !important;margin:0 !important;opacity:0 !important;outline:none !important;padding:0 !important;position:absolute !important;right:0 !important;top:0 !important;-webkit-transform:none !important;transform:none !important;-webkit-appearance:none !important;z-index:-1 !important}",L1t=bE(class extends _E{constructor(){super();this.__registerHost(),this.__attachShadow(),this.calciteInputFocus=Ab(this,"calciteInputFocus",7),this.calciteInputBlur=Ab(this,"calciteInputBlur",7),this.calciteInputInput=Ab(this,"calciteInputInput",7),this.calciteInputChange=Ab(this,"calciteInputChange",7),this.alignment="start",this.autofocus=!1,this.clearable=!1,this.disabled=!1,this.groupSeparator=!1,this.hidden=!1,this.intlLoading=z_t.loading,this.iconFlipRtl=!1,this.loading=!1,this.locale=document.documentElement.lang||"en",this.localeFormat=!1,this.numberButtonType="vertical",this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.editingEnabled=!1,this.type="text",this.value="",this.childElType="input",this.previousValueOrigin="initial",this.mutationObserver=tz("mutation",()=>this.setDisabledAction()),this.userChangedValue=!1,this.keyDownHandler=e=>{this.readOnly||this.disabled||(this.isClearable&&e.key==="Escape"&&(this.clearInputValue(e),e.preventDefault()),e.key==="Enter"&&!e.defaultPrevented&&r1t(this))},this.clearInputValue=e=>{this.setValue({committing:!0,nativeEvent:e,origin:"user",value:""})},this.emitChangeIfUserModified=()=>{this.previousValueOrigin==="user"&&this.value!==this.previousEmittedValue&&this.calciteInputChange.emit(),this.previousEmittedValue=this.value},this.inputBlurHandler=()=>{this.calciteInputBlur.emit({element:this.childEl,value:this.value}),this.emitChangeIfUserModified()},this.inputFocusHandler=e=>{const t=Yce(this.el,"action");e.target!==t&&this.setFocus(),this.calciteInputFocus.emit({element:this.childEl,value:this.value})},this.inputInputHandler=e=>{this.disabled||this.readOnly||this.setValue({nativeEvent:e,origin:"user",value:e.target.value})},this.inputKeyDownHandler=e=>{this.disabled||this.readOnly||e.key==="Enter"&&this.emitChangeIfUserModified()},this.inputNumberInputHandler=e=>{if(this.disabled||this.readOnly)return;const t=e.target.value,i=O1t(t,this.locale);e.inputType==="insertFromPaste"?(Fd(i)||e.preventDefault(),this.setValue({nativeEvent:e,origin:"user",value:w1t(i)}),this.childNumberEl.value=this.localizedValue):this.setValue({nativeEvent:e,origin:"user",value:i})},this.inputNumberKeyDownHandler=e=>{if(this.type!=="number"||this.disabled||this.readOnly)return;if(e.key==="ArrowUp"){e.preventDefault(),this.nudgeNumberValue("up",e);return}if(e.key==="ArrowDown"){this.nudgeNumberValue("down",e);return}const t=[...gJ,"ArrowLeft","ArrowRight","Backspace","Delete","Enter","Escape","Tab"];if(e.altKey||e.ctrlKey||e.metaKey)return;const i=e.shiftKey&&e.key==="Tab";if(t.includes(e.key)&&(!e.shiftKey||i)){e.key==="Enter"&&this.emitChangeIfUserModified();return}const r=yJ(this.locale);e.key===r&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.indexOf(r)===-1)||/[eE]/.test(e.key)&&(!this.value&&!this.childNumberEl.value||this.value&&!/[eE]/.test(this.childNumberEl.value))||e.key==="-"&&(!this.value&&!this.childNumberEl.value||this.value&&this.childNumberEl.value.split("-").length<=2)||e.preventDefault()},this.nudgeNumberValue=(e,t)=>{if(t instanceof KeyboardEvent&&t.repeat||this.type!=="number")return;const i=this.maxString?parseFloat(this.maxString):null,r=this.minString?parseFloat(this.minString):null,s=100;this.incrementOrDecrementNumberValue(e,i,r,t),this.nudgeNumberValueIntervalId&&window.clearInterval(this.nudgeNumberValueIntervalId);let n=!0;this.nudgeNumberValueIntervalId=window.setInterval(()=>{if(n){n=!1;return}this.incrementOrDecrementNumberValue(e,i,r,t)},s)},this.numberButtonMouseUpAndMouseOutHandler=()=>{window.clearInterval(this.nudgeNumberValueIntervalId)},this.numberButtonMouseDownHandler=e=>{e.preventDefault();const t=e.target.dataset.adjustment;this.nudgeNumberValue(t,e)},this.setChildElRef=e=>{this.childEl=e},this.setChildNumberElRef=e=>{this.childNumberEl=e},this.setInputValue=e=>{this.type==="text"&&!this.childEl||this.type==="number"&&!this.childNumberEl||(this[`child${this.type==="number"?"Number":""}El`].value=e)},this.setPreviousEmittedValue=e=>{this.previousEmittedValue=this.type==="number"?Fd(e)?e:"":e},this.setPreviousValue=e=>{this.previousValue=this.type==="number"?Fd(e)?e:"":e},this.setValue=({committing:e=!1,nativeEvent:t,origin:i,previousValue:r,value:s})=>{const n=this.type==="number"?eue(this.previousValue,this.locale,this.groupSeparator):"",o=this.type==="number"?S1t(s):s,a=this.type==="number"&&s&&!o?Fd(this.previousValue)?this.previousValue:"":o,l=this.type==="number"?eue(a,this.locale,this.groupSeparator):"";this.setPreviousValue(r||this.value),this.previousValueOrigin=i,this.userChangedValue=i==="user"&&this.value!==a,this.value=a,this.type==="number"&&(this.localizedValue=l),i==="direct"&&this.setInputValue(this.type==="number"?l:a),t&&(this.calciteInputInput.emit({element:this.childEl,nativeEvent:t,value:this.value}).defaultPrevented?(this.value=this.previousValue,this.localizedValue=n):e&&this.emitChangeIfUserModified())},this.inputKeyUpHandler=()=>{window.clearInterval(this.nudgeNumberValueIntervalId)}}disabledWatcher(){this.setDisabledAction()}maxWatcher(){var e;this.maxString=((e=this.max)===null||e===void 0?void 0:e.toString())||null}minWatcher(){var e;this.minString=((e=this.min)===null||e===void 0?void 0:e.toString())||null}valueWatcher(e,t){this.userChangedValue||(this.setValue({origin:"direct",previousValue:t,value:e==null||e==""?"":this.type==="number"?Fd(e)?e:this.previousValue||"":e}),this.warnAboutInvalidNumberValue(e)),this.userChangedValue=!1}updateRequestedIcon(){this.requestedIcon=Zce(iue,this.icon,this.type)}get isClearable(){return!this.isTextarea&&(this.clearable||this.type==="search")&&this.value.length>0}get isTextarea(){return this.childElType==="textarea"}connectedCallback(){var e;this.scale=Xce(this.el,"scale",this.scale),this.status=Xce(this.el,"status",this.status),this.inlineEditableEl=this.el.closest("calcite-inline-editable"),this.inlineEditableEl&&(this.editingEnabled=this.inlineEditableEl.editingEnabled||!1),this.setPreviousEmittedValue(this.value),this.setPreviousValue(this.value),this.type==="number"&&(this.warnAboutInvalidNumberValue(this.value),this.setValue({origin:"connected",value:Fd(this.value)?this.value:""})),dJ(this),PEe(this),(e=this.mutationObserver)===null||e===void 0||e.observe(this.el,{childList:!0}),this.setDisabledAction()}disconnectedCallback(){var e;REe(this),IEe(this),(e=this.mutationObserver)===null||e===void 0||e.disconnect()}componentWillLoad(){var e,t;this.childElType=this.type==="textarea"?"textarea":"input",this.maxString=(e=this.max)===null||e===void 0?void 0:e.toString(),this.minString=(t=this.min)===null||t===void 0?void 0:t.toString(),this.requestedIcon=Zce(iue,this.icon,this.type)}componentShouldUpdate(e,t,i){return this.type==="number"&&i==="value"&&e&&!Fd(e)?(this.setValue({origin:"reset",value:t}),!1):!0}componentDidRender(){DEe(this)}async setFocus(){var e,t;this.type==="number"?(e=this.childNumberEl)===null||e===void 0||e.focus():(t=this.childEl)===null||t===void 0||t.focus()}onLabelClick(){this.setFocus()}incrementOrDecrementNumberValue(e,t,i,r){const{value:s}=this,n=this.step==="any"?1:Math.abs(this.step||1),o=s&&s!==""?parseFloat(s):0,l=o+n*(e==="up"?1:-1),c=typeof i=="number"&&!isNaN(i)&&l<i||typeof t=="number"&&!isNaN(t)&&l>t?o:l,h=tue(o),p=tue(n);this.setValue({committing:!0,nativeEvent:r,origin:"user",value:c.toFixed(Math.max(h,p))})}onFormReset(){this.setValue({origin:"reset",value:this.defaultValue})}syncHiddenFormInput(e){var t,i,r,s;this.type==="number"?(e.type="number",e.min=(i=(t=this.min)===null||t===void 0?void 0:t.toString(10))!==null&&i!==void 0?i:"",e.max=(s=(r=this.max)===null||r===void 0?void 0:r.toString(10))!==null&&s!==void 0?s:""):this.type==="text"?(e.type="text",this.minLength!=null&&(e.minLength=this.minLength),this.maxLength!=null&&(e.maxLength=this.maxLength)):this.type==="password"&&(e.type="password")}setDisabledAction(){const e=Yce(this.el,"action");!e||(this.disabled?e.setAttribute("disabled",""):e.removeAttribute("disabled"))}warnAboutInvalidNumberValue(e){this.type==="number"&&e&&!Fd(e)&&console.warn(`The specified value "${e}" cannot be parsed, or is out of range.`)}render(){const e=EEe(this.el),t=ui("div",{class:ya.loader},ui("calcite-progress",{label:this.intlLoading,type:"indeterminate"})),i=ui("button",{"aria-label":this.intlClear||$1t.clear,class:ya.clearButton,disabled:this.disabled||this.readOnly,onClick:this.clearInputValue,tabIndex:this.disabled?-1:0,type:"button"},ui("calcite-icon",{icon:"x",scale:"s"})),r=ui("calcite-icon",{class:ya.inputIcon,flipRtl:this.iconFlipRtl,icon:this.requestedIcon,scale:"s"}),s=this.numberButtonType==="horizontal",n=ui("button",{class:{[ya.numberButtonItem]:!0,[ya.buttonItemHorizontal]:s},"data-adjustment":"up",disabled:this.disabled||this.readOnly,onMouseDown:this.numberButtonMouseDownHandler,onMouseOut:this.numberButtonMouseUpAndMouseOutHandler,onMouseUp:this.numberButtonMouseUpAndMouseOutHandler,tabIndex:-1,type:"button"},ui("calcite-icon",{icon:"chevron-up",scale:"s"})),o=ui("button",{class:{[ya.numberButtonItem]:!0,[ya.buttonItemHorizontal]:s},"data-adjustment":"down",disabled:this.disabled||this.readOnly,onMouseDown:this.numberButtonMouseDownHandler,onMouseOut:this.numberButtonMouseUpAndMouseOutHandler,onMouseUp:this.numberButtonMouseUpAndMouseOutHandler,tabIndex:-1,type:"button"},ui("calcite-icon",{icon:"chevron-down",scale:"s"})),a=ui("div",{class:ya.numberButtonWrapper},n,o),l=ui("div",{class:ya.prefix},this.prefixText),c=ui("div",{class:ya.suffix},this.suffixText),h=this.type==="number"?ui("input",{"aria-label":Jce(this),autofocus:this.autofocus?!0:null,defaultValue:this.defaultValue,disabled:this.disabled?!0:null,enterKeyHint:this.el.enterKeyHint,inputMode:this.el.inputMode,key:"localized-input",maxLength:this.maxLength,minLength:this.minLength,name:void 0,onBlur:this.inputBlurHandler,onFocus:this.inputFocusHandler,onInput:this.inputNumberInputHandler,onKeyDown:this.inputNumberKeyDownHandler,onKeyUp:this.inputKeyUpHandler,placeholder:this.placeholder||"",readOnly:this.readOnly,ref:this.setChildNumberElRef,type:"text",value:this.localizedValue}):null,p=this.type!=="number"?[ui(this.childElType,{"aria-label":Jce(this),autofocus:this.autofocus?!0:null,class:{[ya.editingEnabled]:this.editingEnabled,[ya.inlineChild]:!!this.inlineEditableEl},defaultValue:this.defaultValue,disabled:this.disabled?!0:null,enterKeyHint:this.el.enterKeyHint,inputMode:this.el.inputMode,max:this.maxString,maxLength:this.maxLength,min:this.minString,minLength:this.minLength,name:this.name,onBlur:this.inputBlurHandler,onFocus:this.inputFocusHandler,onInput:this.inputInputHandler,onKeyDown:this.inputKeyDownHandler,onKeyUp:this.inputKeyUpHandler,placeholder:this.placeholder||"",readOnly:this.readOnly,ref:this.setChildElRef,required:this.required?!0:null,step:this.step,tabIndex:this.disabled||this.inlineEditableEl&&!this.editingEnabled?-1:null,type:this.type,value:this.value}),this.isTextarea?ui("div",{class:ya.resizeIconWrapper},ui("calcite-icon",{icon:"chevron-down",scale:"s"})):null]:null;return ui(y5,{onClick:this.inputFocusHandler,onKeyDown:this.keyDownHandler},ui("div",{class:{[ya.inputWrapper]:!0,[k_t.rtl]:e==="rtl"}},this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?o:null,this.prefixText?l:null,ui("div",{class:ya.wrapper},h,p,this.isClearable?i:null,this.requestedIcon?r:null,this.loading?t:null),ui("div",{class:ya.actionWrapper},ui("slot",{name:I1t.action})),this.type==="number"&&this.numberButtonType==="vertical"&&!this.readOnly?a:null,this.suffixText?c:null,this.type==="number"&&this.numberButtonType==="horizontal"&&!this.readOnly?n:null,ui($Ee,{component:this})))}get el(){return this}static get watchers(){return{disabled:["disabledWatcher"],max:["maxWatcher"],min:["minWatcher"],value:["valueWatcher"],icon:["updateRequestedIcon"],type:["updateRequestedIcon"]}}static get style(){return D1t}},[1,"calcite-input",{alignment:[513],autofocus:[4],clearable:[516],disabled:[516],groupSeparator:[4,"group-separator"],hidden:[4],icon:[520],intlClear:[1,"intl-clear"],intlLoading:[1,"intl-loading"],iconFlipRtl:[516,"icon-flip-rtl"],label:[1],loading:[516],locale:[1],localeFormat:[4,"locale-format"],max:[514],min:[514],maxlength:[514],maxLength:[514,"max-length"],minLength:[514,"min-length"],name:[513],numberButtonType:[513,"number-button-type"],placeholder:[1],prefixText:[1,"prefix-text"],readOnly:[4,"read-only"],required:[4],scale:[1537],status:[1537],step:[520],suffixText:[1,"suffix-text"],editingEnabled:[1540,"editing-enabled"],type:[513],value:[1025],localizedValue:[32],setFocus:[64]}]);function N1t(){if(typeof customElements=="undefined")return;["calcite-input","calcite-icon","calcite-progress"].forEach(t=>{switch(t){case"calcite-input":customElements.get(t)||customElements.define(t,L1t);break;case"calcite-icon":customElements.get(t)||mJ();break;case"calcite-progress":customElements.get(t)||kEe();break}})}N1t();var rue,sue,nue,zEe={exports:{}};rue=zEe,sue=function(){function e(s,n,o,a,l){t(s,n,o||0,a||s.length-1,l||r)}function t(s,n,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,h=n-o+1,p=Math.log(c),f=.5*Math.exp(2*p/3),m=.5*Math.sqrt(p*f*(c-f)/c)*(h-c/2<0?-1:1);t(s,n,Math.max(o,Math.floor(n-h*f/c+m)),Math.min(a,Math.floor(n+(c-h)*f/c+m)),l)}var y=s[n],v=o,b=a;for(i(s,o,n),l(s[a],y)>0&&i(s,o,a);v<b;){for(i(s,v,b),v++,b--;l(s[v],y)<0;)v++;for(;l(s[b],y)>0;)b--}l(s[o],y)===0?i(s,o,b):i(s,++b,a),b<=n&&(o=b+1),n<=b&&(a=b-1)}}function i(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return e},(nue=sue())!==void 0&&(rue.exports=nue);const F1t=zEe.exports;class U1t{constructor(t=9,i){this.compareMinX=oue,this.compareMinY=aue,this._toBBox=r=>r,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&(typeof i=="function"?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),u1.prune(),xD.prune(),jl.prune(),TD.prune()}all(t){this._all(this.data,t)}search(t,i){let r=this.data;const s=this._toBBox;if(wD(t,r))for(u1.clear();r;){for(let n=0,o=r.children.length;n<o;n++){const a=r.children[n],l=r.leaf?s(a):a;wD(t,l)&&(r.leaf?i(a):b8(t,l)?this._all(a,i):u1.push(a))}r=u1.pop()}}collides(t){let i=this.data;const r=this._toBBox;if(!wD(t,i))return!1;for(u1.clear();i;){for(let s=0,n=i.children.length;s<n;s++){const o=i.children[s],a=i.leaf?r(o):o;if(wD(t,a)){if(i.leaf||b8(t,a))return!0;u1.push(o)}}i=u1.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let r=0,s=t.length;r<s;r++)this.insert(t[r]);return this}let i=this._build(t.slice(0,t.length),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=new AN([]),this}remove(t){var l;if(!t)return this;let i,r=this.data,s=null,n=0,o=!1;const a=this._toBBox(t);for(jl.clear(),TD.clear();r||jl.length>0;){if(r||(r=jl.pop(),s=jl.data[jl.length-1],n=(l=TD.pop())!=null?l:0,o=!0),r.leaf&&(i=ON(r.children,t,r.children.length,r.indexHint),i!==-1))return r.children.splice(i,1),jl.push(r),this._condense(jl),this;o||r.leaf||!b8(r,a)?s?(n++,r=s.children[n],o=!1):r=null:(jl.push(r),TD.push(n),n=0,s=r,r=r.children[0])}return this}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,i){var s;let r=t;for(xD.clear();r;){if(r.leaf===!0)for(const n of r.children)i(n);else xD.pushArray(r.children);r=(s=xD.pop())!=null?s:null}}_build(t,i,r,s){const n=r-i+1;let o=this._maxEntries;if(n<=o){const h=new AN(t.slice(i,r+1));return yT(h,this._toBBox),h}s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/o**(s-1)));const a=new w8([]);a.height=s;const l=Math.ceil(n/o),c=l*Math.ceil(Math.sqrt(o));lue(t,i,r,c,this.compareMinX);for(let h=i;h<=r;h+=c){const p=Math.min(h+c-1,r);lue(t,h,p,l,this.compareMinY);for(let f=h;f<=p;f+=l){const m=Math.min(f+l-1,p);a.children.push(this._build(t,f,m,s-1))}}return yT(a,this._toBBox),a}_chooseSubtree(t,i,r,s){for(;s.push(i),i.leaf!==!0&&s.length-1!==r;){let n,o=1/0,a=1/0;for(let l=0,c=i.children.length;l<c;l++){const h=i.children[l],p=_8(h),f=k1t(t,h)-p;f<a?(a=f,o=p<o?p:o,n=h):f===a&&p<o&&(o=p,n=h)}i=n||i.children[0]}return i}_insert(t,i,r){const s=this._toBBox,n=r?t:s(t);jl.clear();const o=this._chooseSubtree(n,this.data,i,jl);for(o.children.push(t),RM(o,n);i>=0&&jl.data[i].children.length>this._maxEntries;)this._split(jl,i),i--;this._adjustParentBBoxes(n,jl,i)}_split(t,i){const r=t.data[i],s=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,s);const o=this._chooseSplitIndex(r,n,s);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=r.children.splice(o,r.children.length-o),l=r.leaf?new AN(a):new w8(a);l.height=r.height,yT(r,this._toBBox),yT(l,this._toBBox),i?t.data[i-1].children.push(l):this._splitRoot(r,l)}_splitRoot(t,i){this.data=new w8([t,i]),this.data.height=t.height+1,yT(this.data,this._toBBox)}_chooseSplitIndex(t,i,r){let s,n,o;s=n=1/0;for(let a=i;a<=r-i;a++){const l=OM(t,0,a,this._toBBox),c=OM(t,a,r,this._toBBox),h=z1t(l,c),p=_8(l)+_8(c);h<s?(s=h,o=a,n=p<n?p:n):h===s&&p<n&&(n=p,o=a)}return o}_chooseSplitAxis(t,i,r){const s=t.leaf?this.compareMinX:oue,n=t.leaf?this.compareMinY:aue;this._allDistMargin(t,i,r,s)<this._allDistMargin(t,i,r,n)&&t.children.sort(s)}_allDistMargin(t,i,r,s){t.children.sort(s);const n=this._toBBox,o=OM(t,0,i,n),a=OM(t,r-i,r,n);let l=bD(o)+bD(a);for(let c=i;c<r-i;c++){const h=t.children[c];RM(o,t.leaf?n(h):h),l+=bD(o)}for(let c=r-i-1;c>=i;c--){const h=t.children[c];RM(a,t.leaf?n(h):h),l+=bD(a)}return l}_adjustParentBBoxes(t,i,r){for(let s=r;s>=0;s--)RM(i.data[s],t)}_condense(t){for(let i=t.length-1;i>=0;i--){const r=t.data[i];if(r.children.length===0)if(i>0){const s=t.data[i-1],n=s.children;n.splice(ON(n,r,n.length,s.indexHint),1)}else this.clear();else yT(r,this._toBBox)}}_initFormat(t){const i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function yT(e,t){OM(e,0,e.children.length,t,e)}function OM(e,t,i,r,s){s||(s=new AN([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n,o=t;o<i;o++)n=e.children[o],RM(s,e.leaf?r(n):n);return s}function RM(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function oue(e,t){return e.minX-t.minX}function aue(e,t){return e.minY-t.minY}function _8(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function bD(e){return e.maxX-e.minX+(e.maxY-e.minY)}function k1t(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function z1t(e,t){const i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function b8(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function wD(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function lue(e,t,i,r,s){const n=[t,i];for(;n.length;){const o=n.pop(),a=n.pop();if(o-a<=r)continue;const l=a+Math.ceil((o-a)/r/2)*r;F1t(e,l,a,o,s),n.push(a,l,l,o)}}const u1=new It,xD=new It,jl=new It,TD=new It({deallocator:void 0});class V1t{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class VEe extends V1t{constructor(){super(...arguments),this.height=1,this.indexHint=new Dq}}class AN extends VEe{constructor(t){super(),this.children=t,this.leaf=!0}}class w8 extends VEe{constructor(t){super(),this.children=t,this.leaf=!1}}const B1t=5e4,PM={minX:0,minY:0,maxX:0,maxY:0};function G1t(e){PM.minX=e[0],PM.minY=e[1],PM.maxX=e[2],PM.maxY=e[3]}function j1t(e,t,i){G1t(t),e.search(PM,i)}class H1t{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new U1t(9,he("esri-csp-restrictions")?t=>({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const t=new Array(this._idByBounds.size);let i=0;this._idByBounds.forEach((r,s)=>{t[i++]=s}),this._indexInvalid=!1,this._index.clear(),this._index.load(t)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(t=>this._idByBounds.has(t))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const t=xc();for(const i of this._boundsById.values())i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]));return t}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(t){const i=this._boundsById.get(t);this._boundsById.delete(t),i&&(this._idByBounds.delete(i),this._indexInvalid||this._index.remove(i))}forEachInBounds(t,i){this._loadIndex(),j1t(this._index,t,r=>i(this._idByBounds.get(r)))}get(t){return this._boundsById.get(t)}has(t){return this._boundsById.has(t)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(t,i){if(!this._indexInvalid){const r=this._boundsById.get(t);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(t,i),i&&(this._idByBounds.set(i,t),this._indexInvalid||(this._boundsToLoad.push(i),this._boundsToLoad.length>B1t&&this._loadIndex()))}}let Iq=class extends r9{};Iq=u([P("esri.layers.support.GeoreferenceBase")],Iq);const vJ=Iq;let F0=class extends vJ{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:t,bottomLeft:i,bottomRight:r}=this;if(M(e)||M(t)||M(i)||M(r))return null;const s=e.spatialReference;return t=rL(t,s).geometry,i=rL(i,s).geometry,r=rL(r,s).geometry,M(t)||M(i)||M(r)?null:new la({rings:[[[i.x,i.y],[e.x,e.y],[t.x,t.y],[r.x,r.y],[i.x,i.y]]],spatialReference:s})}};u([d({readOnly:!0})],F0.prototype,"coords",null),u([d({type:qe})],F0.prototype,"bottomLeft",void 0),u([d({type:qe})],F0.prototype,"bottomRight",void 0),u([d({type:qe})],F0.prototype,"topLeft",void 0),u([d({type:qe})],F0.prototype,"topRight",void 0),F0=u([P("esri.layers.support.CornersGeoreference")],F0);const q1t=F0;let lS=class extends vJ{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(M(this.extent))return null;const{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s}=this.extent;let n;if(this.rotation){const{x:o,y:a}=this.extent.center,l=W1t(o,a,this.rotation);n=[l(e,t),l(e,r),l(i,r),l(i,t)],n.push(n[0])}else n=[[e,t],[e,r],[i,r],[i,t],[e,t]];return new la({rings:[n],spatialReference:s})}};function W1t(e,t,i){const r=c3(i),s=Math.cos(r),n=Math.sin(r);return(o,a)=>[s*(o-e)+n*(a-t)+e,s*(a-t)-n*(o-e)+t]}u([d({readOnly:!0})],lS.prototype,"coords",null),u([d({type:Xt})],lS.prototype,"extent",void 0),u([d({type:Number})],lS.prototype,"rotation",void 0),lS=u([P("esri.layers.support.ExtentAndRotationGeoreference")],lS);const X1t=lS,Y1t={key:"type",base:vJ,typeMap:{corners:q1t,"extent-and-rotation":X1t}};let IM=class extends y$e($u){constructor(){super(...arguments),this.georeference=null,this.opacity=1}};u([d({types:Y1t})],IM.prototype,"georeference",void 0),u([d()],IM.prototype,"opacity",void 0),IM=u([P("esri.layers.support.MediaElementBase")],IM);const _J=IM;let $M=class extends _J{constructor(e){super(e),this.content=null,this.type="image",this.image=null}load(){const e=this.image;if(typeof e=="string"){const t=_i(e,{responseType:"image"}).then(({data:i})=>{this._set("content",i)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new q("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}set image(e){this.loadStatus==="not-loaded"?this._set("image",e):de.getLogger(this.declaredClass).error("#image","image cannot be changed after the element is loaded.")}};u([d({readOnly:!0})],$M.prototype,"content",void 0),u([d()],$M.prototype,"image",null),$M=u([P("esri.layers.support.ImageElement")],$M);const Z1t=$M;function Q1t(e){return BEe(e,!0)}function jSt(e){return BEe(e,!1)}function BEe(e,t){if(M(e))return null;const i=e.spatialReference,r=Rg(i),s="toJSON"in e?e.toJSON():e;if(!r)return s;const n=Gv(i)?102100:4326,o=mS[n].maxX,a=mS[n].minX;if(w5(s))return cue(s,o,a);if(b5(s))return s.points=s.points.map(l=>cue(l,o,a)),s;if(LW(s))return J1t(s,r);if(Cv(s)||d3(s)){const l=RIe(ebt,s),c={xmin:l[0],ymin:l[1],xmax:l[2],ymax:l[3]},h=Lh(c.xmin,a)*(2*o),p=h===0?s:jX(s,h);return c.xmin+=h,c.xmax+=h,c.xmax>o?hue(p,o,t):c.xmin<a?hue(p,a,t):p}return s}function J1t(e,t){if(!t)return e;const i=K1t(e,t).map(r=>r.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(r=>[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]])}}function cue(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=Lh(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=Lh(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=Lh(r,t);e.x+=s*(-2*t)}else if(r<i){const s=Lh(r,i);e.x+=s*(-2*i)}}return e}function K1t(e,t){const i=[],{ymin:r,ymax:s,xmin:n,xmax:o}=e,a=e.xmax-e.xmin,[l,c]=t.valid,{x:h,frameId:p}=uue(e.xmin,t),{x:f,frameId:m}=uue(e.xmax,t),y=h===f&&a>0;if(a>2*c){const v={xmin:n<o?h:f,ymin:r,xmax:c,ymax:s},b={xmin:l,ymin:r,xmax:n<o?f:h,ymax:s},w={xmin:0,ymin:r,xmax:c,ymax:s},S={xmin:l,ymin:r,xmax:0,ymax:s},T=[],E=[];SD(v,w)&&T.push(p),SD(v,S)&&E.push(p),SD(b,w)&&T.push(m),SD(b,S)&&E.push(m);for(let C=p+1;C<m;C++)T.push(C),E.push(C);i.push(new h1(v,[p]),new h1(b,[m]),new h1(w,T),new h1(S,E))}else h>f||y?i.push(new h1({xmin:h,ymin:r,xmax:c,ymax:s},[p]),new h1({xmin:l,ymin:r,xmax:f,ymax:s},[m])):i.push(new h1({xmin:h,ymin:r,xmax:f,ymax:s},[p]));return i}function uue(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}function SD(e,t){const{xmin:i,ymin:r,xmax:s,ymax:n}=t;return ED(e,i,r)&&ED(e,i,n)&&ED(e,s,n)&&ED(e,s,r)}function ED(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function hue(e,t,i=!0){const r=!d3(e);if(r&&CIe(e),i)return new tbt().cut(e,t);const s=r?e.rings:e.paths,n=r?4:2,o=s.length,a=-2*t;for(let l=0;l<o;l++){const c=s[l];if(c&&c.length>=n){const h=[];for(const p of c)h.push([p[0]+a,p[1]]);s.push(h)}}return r?e.rings=s:e.paths=s,e}class h1{constructor(t,i){this.extent=t,this.frameIds=i}}const ebt=Lt();class tbt{constructor(){this.linesIn=[],this.linesOut=[]}cut(t,i){let r;if(this.xCut=i,t.rings)this.closed=!0,r=t.rings,this.minPts=4;else{if(!t.paths)return null;this.closed=!1,r=t.paths,this.minPts=2}for(const n of r){if(!n||n.length<this.minPts)continue;let o=!0;for(const a of n)o?(this.moveTo(a),o=!1):this.lineTo(a);this.closed&&this.close()}this._pushLineIn(),this._pushLineOut(),r=[];for(const n of this.linesIn)n&&n.length>=this.minPts&&r.push(n);const s=-2*this.xCut;for(const n of this.linesOut)if(n&&n.length>=this.minPts){for(const o of n)o[0]+=s;r.push(n)}return this.closed?t.rings=r:t.paths=r,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const i=this._side(t[0]);if(i*this._prevSide==-1){const r=this._intersect(this._prevPt,t);this._lineTo(this.xCut,r,0),this._prevSide=0,this._lineTo(t[0],t[1],i)}else this._lineTo(t[0],t[1],i);this._prevSide=i,this._prevPt=t}close(){const t=this._firstPt,i=this._prevPt;t[0]===i[0]&&t[1]===i[1]||this.lineTo(t),this._checkClosingPt(this.lineIn),this._checkClosingPt(this.lineOut)}_moveTo(t,i,r){this.closed?(this.lineIn.push([r<=0?t:this.xCut,i]),this.lineOut.push([r>=0?t:this.xCut,i])):(r<=0&&this.lineIn.push([t,i]),r>=0&&this.lineOut.push([t,i]))}_lineTo(t,i,r){this.closed?(this._addPolyVertex(this.lineIn,r<=0?t:this.xCut,i),this._addPolyVertex(this.lineOut,r>=0?t:this.xCut,i)):r<0?(this._prevSide===0&&this._pushLineOut(),this.lineIn.push([t,i])):r>0?(this._prevSide===0&&this._pushLineIn(),this.lineOut.push([t,i])):this._prevSide<0?(this.lineIn.push([t,i]),this.lineOut.push([t,i])):this._prevSide>0&&(this.lineOut.push([t,i]),this.lineIn.push([t,i]))}_addPolyVertex(t,i,r){const s=t.length;s>1&&t[s-1][0]===i&&t[s-2][0]===i?t[s-1][1]=r:t.push([i,r])}_checkClosingPt(t){const i=t.length;i>3&&t[0][0]===this.xCut&&t[i-2][0]===this.xCut&&t[1][0]===this.xCut&&(t[0][1]=t[i-2][1],t.pop())}_side(t){return t<this.xCut?-1:t>this.xCut?1:0}_intersect(t,i){const r=(this.xCut-t[0])/(i[0]-t[0]);return t[1]+r*(i[1]-t[1])}_pushLineIn(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn),this.lineIn=[]}_pushLineOut(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut),this.lineOut=[]}}let og=class extends Ae{constructor(e){super(e)}get bounds(){const e=this.coords;return M(e)?null:jO(e.extent)}get coords(){var t;const e=(t=this.element.georeference)==null?void 0:t.coords;return rL(e,this.spatialReference).geometry}get normalizedCoords(){return la.fromJSON(Q1t(this.coords))}get normalizedBounds(){return _(this.normalizedCoords)?jO(this.normalizedCoords.extent):null}};u([d()],og.prototype,"spatialReference",void 0),u([d()],og.prototype,"element",void 0),u([d()],og.prototype,"bounds",null),u([d()],og.prototype,"coords",null),u([d()],og.prototype,"normalizedCoords",null),u([d()],og.prototype,"normalizedBounds",null),og=u([P("esri.layers.support.media.MediaElementView")],og);let DM=class extends _J{constructor(e){super(e),this.content=null,this.type="video"}load(){const e=this.video;if(typeof e=="string"){const t=document.createElement("video");t.src=e,t.crossOrigin="anonymous",t.autoplay=!0,t.muted=!0,t.loop=!0,this.addResolvingPromise(this._loadVideo(t).then(()=>{this._set("content",t)}))}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new q("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}set video(e){this.loadStatus==="not-loaded"?this._set("video",e):de.getLogger(this.declaredClass).error("#video","video cannot be changed after the element is loaded.")}_loadVideo(e){return new Promise((t,i)=>{e.oncanplay=()=>{e.oncanplay=null,e.play().then(t,i)},e.crossOrigin!=="anonymous"&&(e.crossOrigin="anonymous",e.src=e.src)})}};u([d({readOnly:!0})],DM.prototype,"content",void 0),u([d()],DM.prototype,"video",null),DM=u([P("esri.layers.support.VideoElement")],DM);const ibt=DM,rbt={key:"type",defaultKeyValue:"image",base:_J,typeMap:{image:Z1t,video:ibt}},due=ct.ofType(rbt);let cS=class extends $u.LoadableMixin(yE(Jh(Zr.EventedAccessor))){constructor(e){super(e),this._index=new H1t,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(const r of t.removed){const s=this._elementViewsMap.get(r);this._elementViewsMap.delete(r),this._index.delete(s),this.handles.remove(s),s.destroy(),this.notifyChange("fullExtent")}const{spatialReference:i}=this;for(const r of t.added){if(this._elementViewsMap.get(r))continue;const s=new og({spatialReference:i,element:r});this._elementViewsMap.set(r,s);const n=ae(()=>s.bounds,()=>this._updateIndexForElement(s,!1));this._updateIndexForElement(s,!0),this.handles.add(n,s)}this._elementsIndexes.clear(),this.elements.forEach((r,s)=>this._elementsIndexes.set(r,s)),this.emit("refresh")},this.elements=new due}async load(e){if(Wt(e),!this.spatialReference){const t=this.elements.find(i=>_(i.georeference)&&_(i.georeference.coords));this._set("spatialReference",t?t.georeference.coords.spatialReference:Ze.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.handles.add(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",Hv(e,this._get("elements"),due))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;const e=this._index.fullBounds;return M(e)?null:new Xt({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):de.getLogger(this.declaredClass).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await nNe(e.spatialReference,this.spatialReference,null,t);const i=OE(e,this.spatialReference);if(!i)return[];const r=i.normalize(),s=[];for(const n of r)this._index.forEachInBounds(jO(n),({normalizedCoords:o,element:a})=>{_(o)&&Ppe(n,o)&&s.push(a)});return s.sort((n,o)=>this._elementsIndexes.get(n)-this._elementsIndexes.get(o)),s}_updateIndexForElement(e,t){const i=e.normalizedBounds,r=this._index.has(e),s=_(i);this._index.delete(e),s&&this._index.set(e,i),this.notifyChange("fullExtent"),t||r===s||this.emit("refresh")}};u([d()],cS.prototype,"elements",null),u([d({readOnly:!0})],cS.prototype,"fullExtent",null),u([d()],cS.prototype,"spatialReference",null),cS=u([P("esri.layers.support.LocalMediaElementSource")],cS);const pue=cS;let mf=class extends fU(gU(Zv)){constructor(e){super(e),this.copyright=null,this.fullExtent=null,this.spatialReference=null,this.type="media",this.source=new pue}load(e){this.spatialReference&&(this.source.spatialReference=this.spatialReference);const t=this.source.load(e).then(()=>{this.spatialReference=this.source.spatialReference});return this.addResolvingPromise(t),Promise.resolve(this)}destroy(){var e;(e=this.source)==null||e.destroy()}set source(e){this.loadStatus==="not-loaded"?this._set("source",e):de.getLogger(this.declaredClass).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)||e instanceof ct?new pue({elements:e}):e:null}};u([d({type:String})],mf.prototype,"copyright",void 0),u([d({aliasOf:"source.fullExtent"})],mf.prototype,"fullExtent",void 0),u([d({type:["show","hide"]})],mf.prototype,"listMode",void 0),u([d({nonNullable:!0})],mf.prototype,"source",null),u([Nt("source")],mf.prototype,"castSource",null),u([d()],mf.prototype,"spatialReference",void 0),u([d({readOnly:!0})],mf.prototype,"type",void 0),mf=u([P("esri.layers.MediaLayer")],mf);const HSt=mf,sbt=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0}readCapabilities(i,r){var S,T;const s=r.capabilities&&r.capabilities.split(",").map(E=>E.toLowerCase().trim());if(!s)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const n=this.type,o=s.includes("data"),a=s.includes("query"),l=s.includes("map"),c=!!r.exportTilesAllowed,h=s.includes("tilemap"),p=n!=="tile"&&!!r.supportsDynamicLayers,f=n!=="tile"&&(!r.tileInfo||p),m=n!=="tile"&&(!r.tileInfo||p),y=n!=="tile",v=r.cimVersion&&d_.parse(r.cimVersion),b=(S=v==null?void 0:v.since(1,4))!=null?S:!1,w=(T=v==null?void 0:v.since(2,0))!=null?T:!1;return{operations:{supportsExportMap:l,supportsExportTiles:c,supportsIdentify:a,supportsQuery:o,supportsTileMap:h},exportMap:l?{supportsArcadeExpressionForLabeling:b,supportsSublayersChanges:y,supportsDynamicLayers:p,supportsSublayerVisibility:f,supportsSublayerDefinitionExpression:m,supportsCIMSymbols:w}:null,exportTiles:c?{maxExportTilesCount:+r.maxExportTilesCount}:null}}readVersion(i,r){let s=r.currentVersion;return s||(s=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),s}async fetchSublayerInfo(i,r){return await this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap.get(i)}async fetchAllLayersAndTables(i){await this.load(i),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=_i(ho(this.url).path+"/layers",{responseType:"json",query:ye(F({f:"json"},this.customParameters),{token:this.apiKey})}).then(s=>{this._allLayersAndTablesMap=new Map;for(const n of s.data.layers)this._allLayersAndTablesMap.set(n.id,n);return{result:s.data}},s=>({error:s})));const r=await this._allLayersAndTablesPromise;if(Wt(i),"result"in r)return r.result;throw r.error}};return u([d({readOnly:!0})],t.prototype,"capabilities",void 0),u([Ie("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),u([d({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:Xt})],t.prototype,"fullExtent",void 0),u([d(Rve)],t.prototype,"id",void 0),u([d({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),u([d(mU)],t.prototype,"popupEnabled",void 0),u([d({type:Ze})],t.prototype,"spatialReference",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([Ie("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=u([P("esri.layers.mixins.ArcGISMapService")],t),t};var MN;function x8(e){return e&&e.type==="esriSMS"}function T8(e,t,i){var s;const r=this.originIdOf(t)>=Dh(i.origin);return{ignoreOrigin:!0,allowNull:r,enabled:!!i&&((s=i.layer)==null?void 0:s.type)==="map-image"&&(i.writeSublayerStructure||r)}}function fue(e,t,i){var r;return{enabled:!!i&&((r=i.layer)==null?void 0:r.type)==="tile"&&this._isOverridden(t)}}function th(e,t,i){return{ignoreOrigin:!0,enabled:i&&i.writeSublayerStructure||!1}}function CD(e,t,i){return{ignoreOrigin:!0,enabled:!!i&&(i.writeSublayerStructure||this.originIdOf(t)>=Dh(i.origin))}}const S8=de.getLogger("esri.layers.support.Sublayer");let nbt=0;const ab=new Set;ab.add("layer"),ab.add("parent"),ab.add("loaded"),ab.add("loadStatus"),ab.add("loadError"),ab.add("loadWarnings");let jt=MN=class extends Jh(R3(E5($u))){constructor(e){super(e),this.capabilities=void 0,this.fields=null,this.fullExtent=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.types=null}async load(e){return this.addResolvingPromise((async()=>{var i,r;if(!this.layer&&!this.url)throw new q("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let t=null;if(!this.layer||this.originIdOf("url")>Ye.SERVICE||((i=this.source)==null?void 0:i.type)==="data-layer")t=(await _i(this.url,F({responseType:"json",query:{f:"json"}},e))).data;else{let s=this.id;((r=this.source)==null?void 0:r.type)==="map-layer"&&(s=this.source.mapLayerId),t=await this.layer.fetchSublayerInfo(s,e)}t&&(this.sourceJSON=t,this.read({layerDefinition:t},{origin:"service"}))})()),this}readCapabilities(e,t){const i=(e=(t=t.layerDefinition||t).capabilities||e)?e.toLowerCase().split(",").map(n=>n.trim()):[],r=this.url?Qv(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query");return{exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:s}}}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get fieldsIndex(){return new jve(this.fields||[])}set floorInfo(e){this._setAndNotifyLayer("floorInfo",e)}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}get id(){const e=this._get("id");return e==null?nbt++:e}set id(e){this._get("id")!==e&&(this.get("layer.capabilities.exportMap.supportsDynamicLayers")!==!1?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,t,i,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map(s=>s.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(t=>t.layer=e)}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,t){return t.minScale||t.layerDefinition&&t.layerDefinition.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition&&t.layerDefinition.maxScale||0}get effectiveScaleRange(){const{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,t){const i=t.layerDefinition;return 1-.01*(i.transparency!=null?i.transparency:i.drawingInfo.transparency)}writeOpacity(e,t,i,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=K4(this.parent.id):t.parentLayerId=-1}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){if(e){for(const t of e.getSymbols())if(vw(t)){S8.warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new bg({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return Ss(ct.ofType(MN),e)}writeSublayers(e,t,i){this.get("sublayers.length")&&(t[i]=this.sublayers.map(r=>r.id).toArray().reverse())}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return null}get url(){var r,s;const e=(s=(r=this.layer)==null?void 0:r.parsedUrl)!=null?s:this._lastParsedUrl,t=this.source;if(!e)return null;if(this._lastParsedUrl=e,(t==null?void 0:t.type)==="map-layer")return`${e.path}/${t.mapLayerId}`;const i={layer:JSON.stringify({source:this.source})};return`${e.path}/dynamicLayer?${Hg(i)}`}set url(e){e?this._override("url",e):this._clearOverride("url")}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,t,i,r){t[i]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=Nn(this),t=new MN;return Nn(t).store=e.clone(ab),this.commitProperty("url"),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return qve(this,e)}createQuery(){return new mu({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var i,r;if(this.hasOwnProperty("sublayers"))return null;const e=(i=this.layer)==null?void 0:i.parsedUrl,t=new(await Promise.resolve().then(function(){return A9e})).default({url:e.path});return e&&this.source&&(this.source.type==="map-layer"?t.layerId=this.source.mapLayerId:t.dynamicDataSource=this.source),this.layer.refreshInterval!=null&&(t.refreshInterval=this.layer.refreshInterval),this.definitionExpression&&(t.definitionExpression=this.definitionExpression),this.floorInfo&&(t.floorInfo=te(this.floorInfo)),this.originIdOf("labelingInfo")>Ye.SERVICE&&(t.labelingInfo=te(this.labelingInfo)),this.originIdOf("labelsVisible")>Ye.DEFAULTS&&(t.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>Ye.DEFAULTS&&(t.legendEnabled=this.legendEnabled),this.originIdOf("visible")>Ye.DEFAULTS&&(t.visible=this.visible),this.originIdOf("minScale")>Ye.DEFAULTS&&(t.minScale=this.minScale),this.originIdOf("maxScale")>Ye.DEFAULTS&&(t.maxScale=this.maxScale),this.originIdOf("opacity")>Ye.DEFAULTS&&(t.opacity=this.opacity),this.originIdOf("popupTemplate")>Ye.DEFAULTS&&(t.popupTemplate=te(this.popupTemplate)),this.originIdOf("renderer")>Ye.SERVICE&&(t.renderer=te(this.renderer)),((r=this.source)==null?void 0:r.type)==="data-layer"&&(t.dynamicDataSource=this.source.clone()),this.originIdOf("title")>Ye.DEFAULTS&&(t.title=this.title),this.layer.type==="map-image"&&this.layer.originIdOf("customParameters")>Ye.DEFAULTS&&(t.customParameters=this.layer.customParameters),this.layer.type==="tile"&&this.layer.originIdOf("customParameters")>Ye.DEFAULTS&&(t.customParameters=this.layer.customParameters),t}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}async queryFeatures(e=this.createQuery(),t){var o,a,l,c,h,p;if(await this.load(),!((a=(o=this.capabilities)==null?void 0:o.operations)!=null&&a.supportsQuery))throw new q("Sublayer.queryFeatures","this layer doesn't support queries.");const[{executeQuery:i},{default:r}]=await Promise.all([Promise.resolve().then(function(){return BUe}),Promise.resolve().then(function(){return GUe})]),s=await i(this.url,mu.from(e),(c=(l=this.layer)==null?void 0:l.spatialReference)!=null?c:null,ye(F({},t),{query:ye(F({},(h=this.layer)==null?void 0:h.customParameters),{token:(p=this.layer)==null?void 0:p.apiKey})})),n=r.fromJSON(s.data);if(n!=null&&n.features)for(const f of n.features)f.sourceLayer=this;return n}toExportImageJSON(e){var n;const t={id:this.id,source:((n=this.source)==null?void 0:n.toJSON())||{mapLayerId:this.id,type:"mapLayer"}},i=_ve(e,this.definitionExpression);_(i)&&(t.definitionExpression=i);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((o,a)=>(o[a]=this.originIdOf(a),o),{});if(Object.keys(r).some(o=>r[o]>Ye.SERVICE)){const o=t.drawingInfo={};r.renderer>Ye.SERVICE&&(o.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>Ye.SERVICE&&(o.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>Ye.SERVICE&&(o.labelingInfo=this.labelingInfo?this.labelingInfo.map(a=>a.write({},{origin:"service",layer:this.layer})):null,o.showLabels=!0),r.opacity>Ye.SERVICE&&(o.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(o.renderer)}return t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,t=>{t.color||t.style!=="esriSMSX"&&t.style!=="esriSMSCross"||(t.outline&&t.outline.color?t.color=t.outline.color:t.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,t){if(e){const i="uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:[];for(const r of i)x8(r.symbol)&&t(r.symbol);"symbol"in e&&x8(e.symbol)&&t(e.symbol),"defaultSymbol"in e&&x8(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){const i=this.layer,r=this._get(e);let s,n;switch(e){case"definitionExpression":case"floorInfo":s="supportsSublayerDefinitionExpression";case"minScale":case"maxScale":case"visible":s="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":s="supportsDynamicLayers",n="supportsModification"}const o=Nn(this).getDefaultOrigin();if(o!=="service"){if(s&&this.get(`layer.capabilities.exportMap.${s}`)===!1)return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${s}'`);if(n&&this.get(`capabilities.exportMap.${n}`)===!1)return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${n}'`)}e!=="source"||this.loadStatus==="not-loaded"?(this._set(e,t),o!=="service"&&r!==t&&i&&i.emit&&i.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,t){t&&(t.forEach(i=>{i.parent=null,i.layer=null}),this.handles.removeAll()),e&&(e.forEach(i=>{i.parent=this,i.layer=this.layer}),this.handles.add([e.on("after-add",({item:i})=>{i.parent=this,i.layer=this.layer}),e.on("after-remove",({item:i})=>{i.parent=null,i.layer=null}),e.on("before-changes",i=>{const r=this.get("layer.capabilities.exportMap.supportsSublayersChanges");r==null||r||(S8.error(new q("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),i.preventDefault())})]))}_logLockedError(e,t){S8.error(new q("sublayer:locked",`Property '${String(e)}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:t,sublayer:this,layer:this.layer}))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};jt.test={isMapImageLayerOverridePolicy:e=>e===th||e===T8,isTileImageLayerOverridePolicy:e=>e===fue},u([d({readOnly:!0})],jt.prototype,"capabilities",void 0),u([Ie("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],jt.prototype,"readCapabilities",null),u([d({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:T8}}})],jt.prototype,"definitionExpression",null),u([d({type:[IE],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],jt.prototype,"fields",void 0),u([d({readOnly:!0})],jt.prototype,"fieldsIndex",null),u([d({type:Hve,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:T8},origins:{"web-scene":{read:!1,write:!1}}}})],jt.prototype,"floorInfo",null),u([d({type:Xt,json:{read:{source:"layerDefinition.extent"}}})],jt.prototype,"fullExtent",void 0),u([d({type:String})],jt.prototype,"globalIdField",void 0),u([Ie("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],jt.prototype,"readGlobalIdFieldFromService",null),u([d({type:wr,json:{write:{ignoreOrigin:!0}}})],jt.prototype,"id",null),u([d({value:null,type:[P3],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:th}}})],jt.prototype,"labelingInfo",null),u([He("labelingInfo")],jt.prototype,"writeLabelingInfo",null),u([d({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:th}}})],jt.prototype,"labelsVisible",null),u([d({value:null})],jt.prototype,"layer",null),u([d({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:CD}}})],jt.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],jt.prototype,"listMode",null),u([d({type:Number,value:0,json:{write:{overridePolicy:th}}})],jt.prototype,"minScale",null),u([Ie("minScale",["minScale","layerDefinition.minScale"])],jt.prototype,"readMinScale",null),u([d({type:Number,value:0,json:{write:{overridePolicy:th}}})],jt.prototype,"maxScale",null),u([Ie("maxScale",["maxScale","layerDefinition.maxScale"])],jt.prototype,"readMaxScale",null),u([d({readOnly:!0})],jt.prototype,"effectiveScaleRange",null),u([d({type:String})],jt.prototype,"objectIdField",void 0),u([Ie("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],jt.prototype,"readObjectIdFieldFromService",null),u([d({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:th}}})],jt.prototype,"opacity",null),u([Ie("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],jt.prototype,"readOpacity",null),u([He("opacity")],jt.prototype,"writeOpacity",null),u([d({json:{type:wr,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:th}}})],jt.prototype,"parent",void 0),u([He("parent")],jt.prototype,"writeParent",null),u([d({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:CD,writer(e,t,i){t[i]=!e}}}})],jt.prototype,"popupEnabled",void 0),u([d({type:SE,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:CD}}})],jt.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],jt.prototype,"defaultPopupTemplate",null),u([d({types:O3,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:th},origins:{"web-scene":{types:yve,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:th}}}}})],jt.prototype,"renderer",null),u([d({types:{key:"type",base:null,typeMap:{"data-layer":au,"map-layer":bg}},cast(e){if(e){if("mapLayerId"in e)return kv(bg,e);if("dataSource"in e)return kv(au,e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:th}}})],jt.prototype,"source",null),u([d()],jt.prototype,"sourceJSON",void 0),u([d({value:null,json:{type:[wr],write:{target:"subLayerIds",allowNull:!0,overridePolicy:th}}})],jt.prototype,"sublayers",null),u([Nt("sublayers")],jt.prototype,"castSublayers",null),u([He("sublayers")],jt.prototype,"writeSublayers",null),u([d({type:String,json:{name:"name",write:{overridePolicy:CD}}})],jt.prototype,"title",void 0),u([d({type:String})],jt.prototype,"typeIdField",void 0),u([Ie("typeIdField",["layerDefinition.typeIdField"])],jt.prototype,"readTypeIdField",null),u([d({type:[$Y],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],jt.prototype,"types",void 0),u([d({type:String,json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:fue}}})],jt.prototype,"url",null),u([d({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:th}}})],jt.prototype,"visible",null),u([He("visible")],jt.prototype,"writeVisible",null),jt=MN=u([P("esri.layers.support.Sublayer")],jt);const sz=jt;function qSt(e,t,i){return t.flatten(({sublayers:s})=>s).length!==e.length?!0:!!e.some(s=>s.originIdOf("minScale")>i||s.originIdOf("maxScale")>i||s.originIdOf("renderer")>i||s.originIdOf("labelingInfo")>i||s.originIdOf("opacity")>i||s.originIdOf("labelsVisible")>i||s.originIdOf("source")>i)||!GEe(e,t)}function WSt(e,t,i){return!!e.some(r=>{const s=r.source;return!(!s||s.type==="map-layer"&&s.mapLayerId===r.id&&(M(s.gdbVersion)||s.gdbVersion===i))||r.originIdOf("renderer")>Ye.SERVICE||r.originIdOf("labelingInfo")>Ye.SERVICE||r.originIdOf("opacity")>Ye.SERVICE||r.originIdOf("labelsVisible")>Ye.SERVICE})||!GEe(e,t)}function GEe(e,t){if(!e||!e.length||M(t))return!0;const i=t.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).map(n=>n.id).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of e){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function obt(e){return!!e&&e.some(t=>t.minScale!=null||t.layerDefinition&&t.layerDefinition.minScale!=null)}const abt=de.getLogger("esri.layers.TileLayer");function lbt(e,t){const i=[],r={};return e&&e.forEach(s=>{const n=new sz;if(n.read(s,t),r[n.id]=n,s.parentLayerId!=null&&s.parentLayerId!==-1){const o=r[s.parentLayerId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(n)}else i.unshift(n)}),i}const E8=ct.ofType(sz);function jEe(e,t){e&&e.forEach(i=>{t(i),i.sublayers&&i.sublayers.length&&jEe(i.sublayers,t)})}const cbt=e=>{let t=class extends e{constructor(...i){super(...i),this.allSublayers=new Ew({getCollections:()=>[this.sublayers],getChildrenFunction:r=>r.sublayers}),this.sublayersSourceJSON={[Ye.SERVICE]:{},[Ye.PORTAL_ITEM]:{},[Ye.WEB_SCENE]:{},[Ye.WEB_MAP]:{}},this.own(ae(()=>this.sublayers,(r,s)=>this._handleSublayersChange(r,s),Qi))}readSublayers(i,r){if(!r||!i)return;const{sublayersSourceJSON:s}=this,n=Dh(r.origin);if(n<Ye.SERVICE||(s[n]={context:r,visibleLayers:i.visibleLayers||s[n].visibleLayers,layers:i.layers||s[n].layers},n>Ye.SERVICE))return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin("web-document"),l=Nn(this);l.setDefaultOrigin(a),this._set("sublayers",new E8(o)),l.setDefaultOrigin("user")}findSublayerById(i){return this.allSublayers.find(r=>r.id===i)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(i){const r=Dh(i==="web-document"?"web-map":i);let s=Ye.SERVICE,n=this.sublayersSourceJSON[Ye.SERVICE].layers,o=this.sublayersSourceJSON[Ye.SERVICE].context,a=null;const l=[Ye.PORTAL_ITEM,Ye.WEB_SCENE,Ye.WEB_MAP].filter(y=>y<=r);for(const y of l){const v=this.sublayersSourceJSON[y];obt(v.layers)&&(s=y,n=v.layers,o=v.context,v.visibleLayers&&(a={visibleLayers:v.visibleLayers,context:v.context}))}const c=[Ye.PORTAL_ITEM,Ye.WEB_SCENE,Ye.WEB_MAP].filter(y=>y>s&&y<=r);let h=null;for(const y of c){const{layers:v,visibleLayers:b,context:w}=this.sublayersSourceJSON[y];v&&(h={layers:v,context:w}),b&&(a={visibleLayers:b,context:w})}const p=lbt(n,o),f=new Map,m=new Set;if(h)for(const y of h.layers)f.set(y.id,y);if(a)for(const y of a.visibleLayers)m.add(y);return jEe(p,y=>{h&&y.read(f.get(y.id),h.context),a&&y.read({defaultVisibility:m.has(y.id)},a.context)}),{origin:RO(s),sublayers:new E8({items:p})}}read(i,r){super.read(i,r),this.readSublayers(i,r)}_handleSublayersChange(i,r){r&&(r.forEach(s=>{s.parent=null,s.layer=null}),this.handles.remove("sublayers-owner")),i&&(i.forEach(s=>{s.parent=this,s.layer=this}),this.handles.add([i.on("after-add",({item:s})=>{s.parent=this,s.layer=this}),i.on("after-remove",({item:s})=>{s.parent=null,s.layer=null})],"sublayers-owner"),this.type==="tile"&&this.handles.add(i.on("before-changes",s=>{abt.error(new q("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),s.preventDefault()}),"sublayers-owner"))}};return u([d({readOnly:!0})],t.prototype,"allSublayers",void 0),u([d({readOnly:!0,type:ct.ofType(sz)})],t.prototype,"serviceSublayers",void 0),u([d({value:null,type:E8,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),u([d({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),t=u([P("esri.layers.mixins.SublayersOwner")],t),t},mue=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let pn=class extends fU(cbt(gU(AY(MY(xEe(sbt(SY(R3(Jh(Nve(Sve(Mve(Zv))))))))))))){constructor(...e){super(...e),this.listMode="show",this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(bp).then(()=>this._fetchService(t))),Promise.resolve(this)}get attributionDataUrl(){var t;const e=(t=this.parsedUrl)==null?void 0:t.path.toLowerCase();return e&&this._getDefaultAttribution(this._getMapName(e))}readSpatialReference(e,t){return(e=e||t.tileInfo&&t.tileInfo.spatialReference)&&Ze.fromJSON(e)}writeSublayers(e,t,i,r){if(!this.loaded||!e)return;const s=e.slice().reverse().flatten(({sublayers:a})=>a&&a.toArray().reverse()).toArray(),n=[],o=F({writeSublayerStructure:!1},r);s.forEach(a=>{const l=a.write({},o);n.push(l)}),n.some(a=>Object.keys(a).length>1)&&(t.layers=n)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map(t=>ho(t).path):null}fetchTile(e,t,i,r={}){const{signal:s}=r,n=this.getTileUrl(e,t,i),o={responseType:"image",signal:s,query:F({},this.refreshParameters)};return _i(n,o).then(a=>a.data)}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,s=Hg(ye(F(ye(F({},this.parsedUrl.query),{blankTile:!r&&null}),this.customParameters),{token:this.apiKey})),n=this.tileServers;return`${n&&n.length?n[t%n.length]:this.parsedUrl.path}/tile/${e}/${t}/${i}${s?"?"+s:""}`}_fetchService(e){return new Promise((t,i)=>{if(this.sourceJSON){if(this.sourceJSON.bandCount!=null&&this.sourceJSON.pixelSizeX!=null)throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void t({data:this.sourceJSON})}if(!this.parsedUrl)throw new q("tile-layer:undefined-url","layer's url is not defined");const r=Qv(this.parsedUrl.path);if(_(r)&&r.serverType==="ImageServer")throw new q("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");_i(this.parsedUrl.path,{query:ye(F(F({f:"json"},this.parsedUrl.query),this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t,i)}).then(t=>{if(t.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t.data,this.read(t.data,{origin:"service",url:this.parsedUrl}),this.version===10.1&&!TY(this.url))return this._fetchServerVersion(this.url,e).then(i=>{this.read({currentVersion:i})}).catch(()=>{})})}_fetchServerVersion(e,t){if(!QBe(e))return Promise.reject();const i=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return _i(i,{query:ye(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:t}).then(r=>{if(r.data&&r.data.currentVersion)return r.data.currentVersion;throw new q("tile-layer:version-not-available")})}_getMapName(e){const t=e.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return t&&t[2]}_getDefaultAttribution(e){if(!e)return;let t;e=e.toLowerCase();for(let i=0,r=mue.length;i<r;i++)if(t=mue[i],t.toLowerCase().includes(e))return _u("//static.arcgis.com/attribution/"+t)}_getDefaultTileServers(e){const t=e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i)!==-1,i=e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i)!==-1;return t||i?[e,e.replace(t?/server\.arcgisonline/i:/services\.arcgisonline/i,t?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};u([d({readOnly:!0})],pn.prototype,"attributionDataUrl",null),u([d({type:["show","hide","hide-children"]})],pn.prototype,"listMode",void 0),u([d({json:{read:!0,write:!0}})],pn.prototype,"blendMode",void 0),u([d({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],pn.prototype,"isReference",void 0),u([d({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],pn.prototype,"operationalLayerType",void 0),u([d({type:Boolean})],pn.prototype,"resampling",void 0),u([d()],pn.prototype,"sourceJSON",void 0),u([d({type:Ze})],pn.prototype,"spatialReference",void 0),u([Ie("spatialReference",["spatialReference","tileInfo"])],pn.prototype,"readSpatialReference",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],pn.prototype,"path",void 0),u([d({readOnly:!0})],pn.prototype,"sublayers",void 0),u([He("sublayers",{layers:{type:[sz]}})],pn.prototype,"writeSublayers",null),u([d({json:{read:!1,write:!1}})],pn.prototype,"popupEnabled",void 0),u([d()],pn.prototype,"tileServers",null),u([Nt("tileServers")],pn.prototype,"castTileServers",null),u([d({readOnly:!0,json:{read:!1}})],pn.prototype,"type",void 0),u([d(CY)],pn.prototype,"url",void 0),pn=u([P("esri.layers.TileLayer")],pn),pn.prototype.fetchTile.__isDefault__=!0;const ubt=pn;var XSt=Object.freeze(Object.defineProperty({__proto__:null,default:ubt},Symbol.toStringTag,{value:"Module"}));class hbt{constructor(t){this.view=t,this.camera=new qi,this.sunLight={direction:R(),ambient:{color:R(),intensity:1},diffuse:{color:R(),intensity:1}},this._renderTargetHelper=null}get gl(){return this.rctx.gl}resetWebGLState(){this.rctx!=null&&(this.rctx.enforceState(),this._renderTargetHelper&&this._renderTargetHelper.bindFramebuffer())}bindRenderTarget(){this._renderTargetHelper&&this._renderTargetHelper.framebuffer.initializeAndBind()}}const dbt=de.getLogger("esri.views.3d.externalRenderers.ExternalRendererStore");class pbt{constructor(){this._renderers=new ct}add(t,i){this._findOrCreateStageRenderer(t).add(i)}remove(t,i){const r=this._findStageRenderer(t);r&&r.remove(i),r.renderers.length===0&&(r.destroy(),this._renderers.remove(r))}_findStageRenderer(t){return this._renderers.find(i=>i.view===t)}_findOrCreateStageRenderer(t){let i=this._findStageRenderer(t);return i||(i=new fbt(t),this._renderers.add(i)),i}}class fbt{constructor(t){this.view=t,this.canRender=!0,this.renderers=new ct,this._readyWatchHandle=ae(()=>t.ready,i=>{i?(this.context=new hbt(this.view),this.view._stage.addRenderPlugin([Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL],this)):(this.renderers.forEach(r=>d1(r,"dispose",this.context)),this.context=null)},Ft)}destroy(){this.renderers.drain(t=>{this.context&&d1(t,"dispose",this.context)}),this.view._stage&&this.view._stage.removeRenderPlugin(this),this._readyWatchHandle&&(this._readyWatchHandle.remove(),this._readyWatchHandle=null),this.context=null}add(t){this.renderers.includes(t)?dbt.warn("add(): Cannot add external renderer: renderer has already been added"):(this.renderers.add(t),this.context&&(this._webglStateReset(),d1(t,"setup",this.context),this.view._stage.renderView.requestRender()))}remove(t){const i=this.renderers.indexOf(t);i!==-1&&(this.renderers.removeAt(i),this.context&&(d1(t,"dispose",this.context),this.view._stage.renderView.requestRender()))}initializeRenderContext(t){this.context.rctx=t.renderContext.rctx,this.renderers.length>0&&this._webglStateReset(),this.renderers.forEach(i=>d1(i,"setup",this.context))}uninitializeRenderContext(){}render(t){this.renderers.length===0||t.pass!==Be.MATERIAL||t.bindParameters.slot!==Te.OPAQUE_MATERIAL&&t.bindParameters.slot!==Te.TRANSPARENT_MATERIAL||(this._updateContext(t),this._webglStateReset(),this.renderers.forEach(i=>{switch(t.bindParameters.slot){case Te.OPAQUE_MATERIAL:d1(i,"render",this.context);break;case Te.TRANSPARENT_MATERIAL:d1(i,"renderTransparent",this.context)}}))}_updateContext(t){this.context.camera.copyFrom(t.bindParameters.camera),ne(this.context.sunLight.direction,t.bindParameters.lighting.old.direction),ne(this.context.sunLight.diffuse.color,t.bindParameters.lighting.old.diffuse.color),ne(this.context.sunLight.ambient.color,t.bindParameters.lighting.old.ambient.color),this.context._renderTargetHelper=t.offscreenRenderingHelper}_webglStateReset(){var t;this.context.rctx.resetState(),(t=this.context._renderTargetHelper)==null||t.bindFramebuffer()}get needsTransparentPass(){return this.renderers.some(t=>typeof t.renderTransparent=="function")}}function d1(e,t,i){typeof e[t]=="function"&&e[t](i)}new pbt;function YSt(e){he.add("esri-force-webgl",e)}let ag=class extends VY(Zr.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new q("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],ag.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],ag.prototype,"state",null),u([d()],ag.prototype,"view",null),u([d({type:Bh})],ag.prototype,"viewpoint",null),u([d()],ag.prototype,"go",null),u([d()],ag.prototype,"cancelGo",null),ag=u([P("esri.widgets.Home.HomeViewModel")],ag);const HEe=ag,p1={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let cl=class extends ja{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=p1.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new HEe,this.viewpoint=null}get homeTitle(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{messagesCommon:t,messages:i}=this;return e==="going-home"?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{homeTitle:t}=this,i={[p1.disabled]:e==="disabled"};return ce("div",{bind:this,class:this.classes(p1.base,i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[p1.loadingIcon]:e==="going-home",[p1.rotatingIcon]:e==="going-home"};return ce("span",{"aria-hidden":"true",class:this.classes(p1.homeIcon,t)})}renderText(){const{messages:e}=this;return ce("span",{class:p1.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([ht("viewModel.goToOverride")],cl.prototype,"goToOverride",void 0),u([d({readOnly:!0})],cl.prototype,"homeTitle",null),u([d()],cl.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],cl.prototype,"label",void 0),u([d(),za("esri/widgets/Home/t9n/Home")],cl.prototype,"messages",void 0),u([d(),za("esri/t9n/common")],cl.prototype,"messagesCommon",void 0),u([ht("viewModel.view")],cl.prototype,"view",void 0),u([d({type:HEe}),epe("go")],cl.prototype,"viewModel",void 0),u([ht("viewModel.viewpoint")],cl.prototype,"viewpoint",void 0),u([ht("viewModel.cancelGo")],cl.prototype,"cancelGo",null),u([ht("viewModel.go")],cl.prototype,"go",null),u([iu()],cl.prototype,"_go",null),cl=u([P("esri.widgets.Home")],cl);const ZSt=cl;export{f_ as $,vY as A,uv as B,cv as C,P3 as D,$5 as E,tx as F,HSt as G,Z1t as H,X1t as I,zF as J,Xve as K,I7e as L,Xt as M,kSt as N,ja as O,kF as P,ubt as Q,qe as R,GSt as S,ZSt as T,Bh as U,lw as V,ce as W,Df as X,Ft as Y,u as Z,gbt as _,eX as a,WTt as a$,_ as a0,ME as a1,M as a2,Zt as a3,E5 as a4,at as a5,jK as a6,E2 as a7,dO as a8,z2 as a9,Xf as aA,Clt as aB,Ttt as aC,mp as aD,Wt as aE,Lq as aF,U1t as aG,he as aH,gwt as aI,de as aJ,Wh as aK,lo as aL,_w as aM,u8e as aN,_t as aO,pr as aP,qW as aQ,ne as aR,qf as aS,xc as aT,R as aU,ks as aV,Qg as aW,N2 as aX,It as aY,kTt as aZ,UTt as a_,vBe as aa,Br as ab,Qi as ac,zTt as ad,VTt as ae,Zv as af,Aet as ag,Kg as ah,mu as ai,ct as aj,_s as ak,Vh as al,$Tt as am,BTt as an,q as ao,KVe as ap,tTt as aq,D5 as ar,iTt as as,rTt as at,zve as au,eTt as av,Zr as aw,PTt as ax,oNe as ay,Tl as az,P5 as b,nNe as b$,fQ as b0,FTt as b1,NTt as b2,oo as b3,zE as b4,vt as b5,sn as b6,Axe as b7,Ba as b8,Js as b9,Lt as bA,uSe as bB,ywt as bC,tr as bD,z5 as bE,aTt as bF,Xg as bG,Rfe as bH,Hb as bI,WK as bJ,Pfe as bK,Wlt as bL,Ai as bM,Ni as bN,Be as bO,Te as bP,pi as bQ,fr as bR,tp as bS,ss as bT,_i as bU,tt as bV,ar as bW,D4 as bX,Ge as bY,Wge as bZ,ev as b_,Ebt as ba,yu as bb,eo as bc,zv as bd,en as be,Qd as bf,IO as bg,ie as bh,nn as bi,pe as bj,oe as bk,cu as bl,cI as bm,RTt as bn,gee as bo,ETt as bp,Ett as bq,qv as br,ybt as bs,ix as bt,Alt as bu,iQ as bv,jf as bw,_Y as bx,rn as by,gE as bz,RTe as c,nc as c$,OE as c0,hTt as c1,jO as c2,Nl as c3,a5 as c4,bp as c5,Zw as c6,wu as c7,d9e as c8,NF as c9,Mi as cA,$u as cB,yhe as cC,HBe as cD,om as cE,_c as cF,Wg as cG,q8e as cH,W8e as cI,X8e as cJ,zUe as cK,kUe as cL,OX as cM,uCe as cN,Wwt as cO,Qv as cP,JBe as cQ,Dbt as cR,ije as cS,pTt as cT,ght as cU,tSt as cV,UQ as cW,Jh as cX,yE as cY,fu as cZ,fp as c_,Pl as ca,gA as cb,ho as cc,te as cd,u5 as ce,wye as cf,Ume as cg,kxt as ch,ate as ci,dke as cj,_ye as ck,UUe as cl,Pbt as cm,Fbt as cn,XFe as co,xye as cp,QG as cq,VUe as cr,x7 as cs,oU as ct,ow as cu,xE as cv,m7 as cw,ZP as cx,au as cy,QUe as cz,d,B5 as d$,m3 as d0,Nr as d1,O as d2,qb as d3,Q5 as d4,Wi as d5,Fo as d6,bs as d7,hi as d8,ti as d9,hr as dA,rr as dB,na as dC,dr as dD,sr as dE,Vi as dF,zt as dG,gy as dH,xU as dI,b_ as dJ,Dl as dK,qU as dL,ri as dM,Jf as dN,u_ as dO,x_ as dP,YU as dQ,hm as dR,WU as dS,BU as dT,zw as dU,uk as dV,Lit as dW,sZ as dX,WE as dY,mxe as dZ,xs as d_,$s as da,wt as db,Fr as dc,oE as dd,lTt as de,XD as df,Yw as dg,Kct as dh,Xi as di,Ou as dj,Io as dk,mi as dl,hge as dm,x as dn,fs as dp,Nu as dq,Bt as dr,Xe as ds,K as dt,g4 as du,cm as dv,yt as dw,lm as dx,Oe as dy,j as dz,We as e,LLe as e$,Qs as e0,xft as e1,Kpe as e2,Ybt as e3,u$e as e4,Oft as e5,r8e as e6,aq as e7,u2 as e8,Pu as e9,Ee as eA,zr as eB,oYe as eC,OSt as eD,dSt as eE,RSt as eF,SZ as eG,xw as eH,KQ as eI,SSt as eJ,bSt as eK,wSt as eL,_St as eM,XG as eN,xwe as eO,Oc as eP,pmt as eQ,vSt as eR,rft as eS,ZE as eT,MSt as eU,sft as eV,Mwt as eW,_le as eX,o2 as eY,Zb as eZ,Dr as e_,u7e as ea,cie as eb,Ie as ec,wr as ed,Qxt as ee,jve as ef,qve as eg,Ove as eh,yve as ei,mU as ej,SE as ek,mt as el,o9e as em,zue as en,O5 as eo,YK as ep,xu as eq,Nfe as er,Oo as es,yy as et,CSe as eu,J4 as ev,kLe as ew,ke as ex,Ig as ey,qNe as ez,Cl as f,Se as f$,Sc as f0,kg as f1,Pwt as f2,vi as f3,tn as f4,hp as f5,mSt as f6,pNe as f7,wft as f8,jb as f9,PSt as fA,Fu as fB,Hi as fC,$St as fD,fTt as fE,g2 as fF,cr as fG,tft as fH,Kwt as fI,nSt as fJ,_u as fK,Yq as fL,Obt as fM,AR as fN,UO as fO,Uu as fP,LTt as fQ,ube as fR,Zd as fS,Net as fT,Uft as fU,kft as fV,hSt as fW,vv as fX,HNe as fY,_n as fZ,ur as f_,ASt as fa,Ji as fb,AE as fc,CSt as fd,Dt as fe,Mft as ff,ive as fg,rve as fh,DTt as fi,ESt as fj,ySt as fk,gSt as fl,rX as fm,bF as fn,BW as fo,Rz as fp,Dq as fq,ON as fr,Ne as fs,$i as ft,qt as fu,ewt as fv,xe as fw,gX as fx,Re as fy,ISt as fz,Ga as g,wTt as g$,Fa as g0,fe as g1,Il as g2,NL as g3,Mf as g4,Rft as g5,Sre as g6,fSt as g7,qK as g8,cTt as g9,XW as gA,yw as gB,HO as gC,Dh as gD,Su as gE,cDe as gF,d2 as gG,t5 as gH,yOe as gI,_wt as gJ,hS as gK,UM as gL,Ev as gM,Gv as gN,mee as gO,S5e as gP,wxt as gQ,ote as gR,Txt as gS,Xbt as gT,Ape as gU,rIe as gV,pxt as gW,Lye as gX,Fye as gY,$ye as gZ,iwt as g_,rut as ga,dCe as gb,Jwt as gc,Bf as gd,xNe as ge,TNe as gf,He as gg,Owt as gh,Nq as gi,Sge as gj,gIe as gk,xIe as gl,Cv as gm,Uye as gn,LW as go,OW as gp,Hbt as gq,Ml as gr,BX as gs,T5e as gt,S2 as gu,Cc as gv,hke as gw,RIe as gx,Lbt as gy,Zue as gz,zSt as h,st as h$,Xpe as h0,AIe as h1,qbt as h2,Ac as h3,CVe as h4,AVe as h5,IE as h6,$E as h7,Cye as h8,ATt as h9,hrt as hA,Bs as hB,Ru as hC,$t as hD,yf as hE,is as hF,Pi as hG,ft as hH,ze as hI,gt as hJ,Et as hK,it as hL,Cr as hM,qa as hN,ot as hO,Ha as hP,Je as hQ,Ki as hR,Po as hS,Jg as hT,ns as hU,NB as hV,fi as hW,GF as hX,v_ as hY,GU as hZ,_Tt as h_,s8e as ha,Jxt as hb,PAe as hc,twt as hd,Zbt as he,Jbt as hf,Qbt as hg,Kbt as hh,kO as hi,Uh as hj,c$e as hk,exe as hl,TTt as hm,Tet as hn,MTt as ho,dwt as hp,Tbt as hq,iSt as hr,cwt as hs,M5 as ht,XUe as hu,OTt as hv,Ir as hw,Mye as hx,TY as hy,__ as hz,VSt as i,zs as i$,no as i0,ige as i1,Iwt as i2,Yge as i3,Bxt as i4,x5 as i5,fxt as i6,_bt as i7,Gr as i8,yQ as i9,aSt as iA,lSt as iB,fwt as iC,X$e as iD,rb as iE,oSt as iF,_4 as iG,Kv as iH,xr as iI,Lg as iJ,bl as iK,Mc as iL,my as iM,ao as iN,dt as iO,vwt as iP,b3 as iQ,Ri as iR,Ei as iS,oa as iT,$fe as iU,cSt as iV,uSt as iW,HW as iX,UNe as iY,U5 as iZ,bTt as i_,El as ia,Yi as ib,ID as ic,Zpe as id,Mbt as ie,H1t as ig,xxt as ih,qxt as ii,Bfe as ij,Hv as ik,$H as il,a3 as im,zh as io,qwt as ip,WSt as iq,_ve as ir,Qw as is,kv as it,VK as iu,lUe as iv,aUe as iw,og as ix,Abt as iy,Pv as iz,Hw as j,Ts as j$,ai as j0,Ci as j1,qTt as j2,xSt as j3,TSt as j4,mye as j5,GA as j6,Rge as j7,ghe as j8,WF as j9,$G as jA,vF as jB,rNe as jC,Jb as jD,dme as jE,Sf as jF,QTt as jG,eSt as jH,MSe as jI,qae as jJ,ZTt as jK,JTt as jL,YTt as jM,bO as jN,lL as jO,rht as jP,Zh as jQ,Vbt as jR,pZ as jS,La as jT,jae as jU,Dut as jV,Lut as jW,oTt as jX,FY as jY,nTt as jZ,Nt as j_,bP as ja,sSt as jb,hle as jc,rSt as jd,da as je,WS as jf,k4e as jg,Ew as jh,Ec as ji,Wb as jj,jg as jk,d5 as jl,aX as jm,Ift as jn,pSt as jo,hIe as jp,_2e as jq,Ue as jr,Eue as js,fz as jt,h2 as ju,tdt as jv,W0t as jw,PG as jx,cs as jy,RG as jz,Ze as k,YT as k$,d3 as k0,b5 as k1,w5 as k2,Th as k3,PR as k4,lxt as k5,Iu as k6,A5e as k7,kFe as k8,hNe as k9,Is as kA,xwt as kB,wwt as kC,_Le as kD,yLe as kE,vhe as kF,Swt as kG,Awt as kH,Cwt as kI,Ewt as kJ,Af as kK,oR as kL,Ro as kM,Y5 as kN,Zwt as kO,Qwt as kP,Xwt as kQ,Ywt as kR,ws as kS,vy as kT,No as kU,DQ as kV,Gct as kW,OS as kX,kH as kY,jw as kZ,Fi as k_,Gwt as ka,uNe as kb,we as kc,lt as kd,iE as ke,ww as kf,Au as kg,Rwt as kh,zwt as ki,Vwt as kj,HY as kk,c9 as kl,tse as km,Pt as kn,If as ko,fme as kp,cLe as kq,BS as kr,sNe as ks,oi as kt,uo as ku,$r as kv,LO as kw,GTt as kx,bAe as ky,Bbt as kz,ae as l,_X as l$,nge as l0,co as l1,on as l2,dl as l3,_5 as l4,Rg as l5,Uv as l6,Mje as l7,pc as l8,zd as l9,Sh as lA,r9 as lB,$Z as lC,nm as lD,io as lE,ka as lF,Qb as lG,eZe as lH,vTt as lI,gTt as lJ,yTt as lK,Fwt as lL,Oyt as lM,p2 as lN,N8 as lO,pet as lP,Ret as lQ,dTt as lR,Mb as lS,bc as lT,Twt as lU,qi as lV,yre as lW,zq as lX,vg as lY,mbe as lZ,sx as l_,Xs as la,W_e as lb,qY as lc,VS as ld,kA as le,ny as lf,bX as lg,R2 as lh,lr as li,qM as lj,H5 as lk,jwt as ll,hw as lm,Hwt as ln,Dje as lo,Uje as lp,OG as lq,pp as lr,Wr as ls,WY as lt,A$e as lu,je as lv,rs as lw,Bwt as lx,iFe as ly,SW as lz,gO as m,A2 as m$,owt as m0,Uwt as m1,hwt as m2,gre as m3,sm as m4,hX as m5,Hme as m6,Wf as m7,ir as m8,Zf as m9,bu as mA,NNe as mB,_p as mC,Awe as mD,eE as mE,m2 as mF,JZ as mG,v3 as mH,Gbt as mI,lCe as mJ,kwt as mK,Kk as mL,xF as mM,V0t as mN,DSt as mO,NSt as mP,LSt as mQ,yW as mR,rL as mS,Fq as mT,uwt as mU,f1 as mV,mre as mW,sf as mX,h3 as mY,xX as mZ,XO as m_,Tt as ma,Do as mb,XU as mc,jU as md,pt as me,bi as mf,mwt as mg,oae as mh,vX as mi,Xr as mj,sR as mk,uTt as ml,lwt as mm,$wt as mn,qd as mo,Lu as mp,hk as mq,kr as mr,ca as ms,Ua as mt,Ui as mu,bn as mv,_we as mw,Lwt as mx,LJe as my,Du as mz,P as n,mTt as n$,awt as n0,$Ze as n1,TX as n2,Ame as n3,C2 as n4,GNe as n5,Loe as n6,Al as n7,y_ as n8,xFe as n9,Un as nA,Ll as nB,qh as nC,qx as nD,sy as nE,Jv as nF,Yh as nG,jbt as nH,hQ as nI,znt as nJ,kTe as nK,Dnt as nL,GTe as nM,VTe as nN,knt as nO,GH as nP,BTe as nQ,r_ as nR,Lnt as nS,i_ as nT,IH as nU,tP as nV,$w as nW,Ott as nX,fot as nY,pot as nZ,dot as n_,Yg as na,W5 as nb,tqe as nc,Dwt as nd,XTt as ne,s5 as nf,nx as ng,Tc as nh,Eme as ni,Lf as nj,em as nk,KHe as nl,MNe as nm,CNe as nn,Rf as no,USt as np,kq as nq,wp as nr,GHe as ns,$bt as nt,jTe as nu,qTe as nv,Sb as nw,wvt as nx,Pa as ny,Mr as nz,BSt as o,bVe as o$,za as o0,Im as o1,Z8 as o2,spe as o3,Fs as o4,Iue as o5,FS as o6,OO as o7,xhe as o8,Ibt as o9,lu as oA,j0e as oB,Fke as oC,H6e as oD,X6e as oE,ii as oF,G0e as oG,Tu as oH,lVe as oI,rVe as oJ,ox as oK,PW as oL,uVe as oM,hVe as oN,dVe as oO,lY as oP,fVe as oQ,pVe as oR,mVe as oS,Dhe as oT,JO as oU,V6e as oV,oVe as oW,sVe as oX,K6e as oY,SVe as oZ,wVe as o_,o3 as oa,Hg as ob,ki as oc,sp as od,l5 as oe,pE as of,Nbt as og,pl as oh,fl as oi,ta as oj,Ol as ok,am as ol,dL as om,KO as on,uY as oo,PF as op,Ps as oq,cVe as or,Mv as os,$a as ot,aVe as ou,jh as ov,iVe as ow,J6e as ox,Q6e as oy,Sw as oz,P$e as p,t6 as p$,Lxt as p0,xVe as p1,TVe as p2,eVe as p3,tVe as p4,nVe as p5,vVe as p6,QX as p7,Uxt as p8,Y6e as p9,vxt as pA,Eg as pB,Fve as pC,rUe as pD,kye as pE,gxt as pF,mxt as pG,rwt as pH,swt as pI,nwt as pJ,VPe as pK,CTt as pL,STt as pM,wl as pN,FUe as pO,F1t as pP,yBe as pQ,BIe as pR,bUe as pS,Sxt as pT,PUe as pU,Yee as pV,Aye as pW,bxt as pX,YDe as pY,Hxt as pZ,AG as p_,Z6e as pa,W6e as pb,q6e as pc,gS as pd,SBe as pe,Wxt as pf,zxt as pg,Mhe as ph,TBe as pi,CE as pj,Xxt as pk,jTt as pl,Pnt as pm,vw as pn,BM as po,fG as pp,Yxt as pq,xTt as pr,iIe as ps,jxt as pt,hBe as pu,z6e as pv,QIe as pw,bvt as px,dxt as py,_xt as pz,y3 as q,eDe as q$,i6 as q0,L8 as q1,aCe as q2,bbt as q3,wbt as q4,uu as q5,hxt as q6,xbt as q7,uc as q8,yxt as q9,Yce as qA,mJ as qB,o2e as qC,Apt as qD,eHe as qE,_qe as qF,I1e as qG,iWe as qH,EWe as qI,mZ as qJ,OWe as qK,XWe as qL,sXe as qM,AKe as qN,y4 as qO,frt as qP,_rt as qQ,srt as qR,yn as qS,so as qT,zht as qU,k2e as qV,Qmt as qW,ixt as qX,txt as qY,NP as qZ,Iz as q_,nU as qa,l2e as qb,Li as qc,ey as qd,Eu as qe,hv as qf,sTt as qg,ip as qh,nJ as qi,Nwt as qj,KNe as qk,kbt as ql,Ubt as qm,eMe as qn,tW as qo,KTt as qp,cc as qq,Uq as qr,Hae as qs,tz as qt,zbt as qu,bE as qv,_E as qw,Ab as qx,Zce as qy,ui as qz,Hfe as r,P7e as r$,sWe as r0,ftt as r1,oxt as r2,nxt as r3,rxt as r4,pS as r5,M5e as r6,sxt as r7,axt as r8,C5e as r9,Ggt as rA,byt as rB,Ast as rC,pnt as rD,Oat as rE,Jat as rF,qat as rG,fU as rH,gU as rI,Nve as rJ,AY as rK,R3 as rL,xfe as rM,SY as rN,MY as rO,Sve as rP,C_e as rQ,Kxt as rR,m8e as rS,Rve as rT,rx as rU,CY as rV,KBe as rW,xY as rX,t8e as rY,i8e as rZ,jv as r_,p3 as ra,Frt as rb,cxt as rc,uxt as rd,ext as re,irt as rf,Ght as rg,Bht as rh,Lk as ri,jht as rj,w4 as rk,ait as rl,O2e as rm,bmt as rn,tJ as ro,xgt as rp,V2e as rq,Egt as rr,B2e as rs,Agt as rt,G2e as ru,Vgt as rv,Wk as rw,Ygt as rx,syt as ry,Iit as rz,A3e as s,Cie as s$,O7e as s0,C7e as s1,tre as s2,Nn as s3,FO as s4,f8e as s5,Qh as s6,L5 as s7,m_ as s8,w8e as s9,sve as sA,hve as sB,DF as sC,Cbt as sD,X0e as sE,LF as sF,e8e as sG,f_t as sH,Id as sI,Wbt as sJ,Ss as sK,Sbt as sL,gw as sM,pwt as sN,cbt as sO,sbt as sP,Ye as sQ,qSt as sR,sz as sS,T_e as sT,Gf as sU,zf as sV,ffe as sW,Ohe as sX,vbt as sY,ABe as sZ,Ov as s_,Mve as sa,n8e as sb,P8e as sc,BK as sd,Jpe as se,r9e as sf,EY as sg,Iie as sh,AL as si,O3 as sj,p8e as sk,IY as sl,$Y as sm,ave as sn,ht as so,F8 as sp,e6 as sq,XCe as sr,h9e as ss,UE as st,er as su,Y0e as sv,K0e as sw,j5e as sx,qVe as sy,H5e as sz,YSt as t,XSt as t$,Hve as t0,GO as t1,v8e as t2,y8e as t3,fE as t4,lme as t5,np as t6,Rbt as t7,xEe as t8,Vfe as t9,j6e as tA,jte as tB,Pxt as tC,gVe as tD,dU as tE,q0e as tF,W0e as tG,Gxt as tH,hGe as tI,c_e as tJ,d_e as tK,q1 as tL,kY as tM,UY as tN,oGe as tO,Ext as tP,zY as tQ,Z8e as tR,Q8e as tS,J8e as tT,dve as tU,khe as tV,Vxt as tW,A9e as tX,ITt as tY,HTt as tZ,v_t as t_,g8e as ta,Zxt as tb,JPe as tc,VJ as td,N as te,bwt as tf,W4 as tg,h8 as th,Lge as ti,vFe as tj,ea as tk,N7e as tl,jSt as tm,Dxt as tn,Bte as to,Cxt as tp,Vte as tq,yVe as tr,$xt as ts,Fxt as tt,Nxt as tu,Mxt as tv,Axt as tw,Oxt as tx,Rxt as ty,Ixt as tz,si as u,la as v,wc as w,y_t as x,Ae as y,FSt as z};
