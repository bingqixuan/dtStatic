(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[624],{6498:function(__unused_webpack_module,exports){!function(exports){"use strict";class BladeApi{constructor(controller){this.controller_=controller}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(disabled){this.controller_.viewProps.set("disabled",disabled)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(hidden){this.controller_.viewProps.set("hidden",hidden)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class TpEvent{constructor(target){this.target=target}}class TpChangeEvent extends TpEvent{constructor(target,value,presetKey,last){super(target),this.value=value,this.presetKey=presetKey,this.last=null==last||last}}class TpUpdateEvent extends TpEvent{constructor(target,value,presetKey){super(target),this.value=value,this.presetKey=presetKey}}class TpFoldEvent extends TpEvent{constructor(target,expanded){super(target),this.expanded=expanded}}class TpTabSelectEvent extends TpEvent{constructor(target,index){super(target),this.index=index}}function isEmpty(value){return null==value}function deepEqualsArray(a1,a2){if(a1.length!==a2.length)return!1;for(let i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}let CREATE_MESSAGE_MAP={alreadydisposed:()=>"View has been already disposed",invalidparams:context=>`Invalid parameters for '${context.name}'`,nomatchingcontroller:context=>`No matching controller for '${context.key}'`,nomatchingview:context=>`No matching view for '${JSON.stringify(context.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:context=>`Property '${context.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class TpError{constructor(config){var _a;this.message=null!==(_a=CREATE_MESSAGE_MAP[config.type](config.context))&&void 0!==_a?_a:"Unexpected error",this.name=this.constructor.name,this.stack=Error(this.message).stack,this.type=config.type}static alreadyDisposed(){return new TpError({type:"alreadydisposed"})}static notBindable(){return new TpError({type:"notbindable"})}static propertyNotFound(name){return new TpError({type:"propertynotfound",context:{name:name}})}static shouldNeverHappen(){return new TpError({type:"shouldneverhappen"})}}class BindingTarget{constructor(obj,key,opt_id){this.obj_=obj,this.key_=key,this.presetKey_=null!=opt_id?opt_id:key}static isBindable(obj){return null!==obj&&"object"==typeof obj}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(value){this.obj_[this.key_]=value}writeProperty(name,value){let valueObj=this.read();if(!BindingTarget.isBindable(valueObj))throw TpError.notBindable();if(!(name in valueObj))throw TpError.propertyNotFound(name);valueObj[name]=value}}class ButtonApi extends BladeApi{get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get title(){var _a;return null!==(_a=this.controller_.valueController.props.get("title"))&&void 0!==_a?_a:""}set title(title){this.controller_.valueController.props.set("title",title)}on(eventName,handler){let bh=handler.bind(this),emitter=this.controller_.valueController.emitter;return emitter.on(eventName,()=>{bh(new TpEvent(this))}),this}}class Emitter{constructor(){this.observers_={}}on(eventName,handler){let observers=this.observers_[eventName];return observers||(observers=this.observers_[eventName]=[]),observers.push({handler:handler}),this}off(eventName,handler){let observers=this.observers_[eventName];return observers&&(this.observers_[eventName]=observers.filter(observer=>observer.handler!==handler)),this}emit(eventName,event){let observers=this.observers_[eventName];observers&&observers.forEach(observer=>{observer.handler(event)})}}function ClassName(viewName){let fn=(opt_elementName,opt_modifier)=>["tp","-",viewName,"v",opt_elementName?`_${opt_elementName}`:"",opt_modifier?`-${opt_modifier}`:""].join("");return fn}function bindValue(value,applyValue){value.emitter.on("change",input=>applyValue(input.rawValue)),applyValue(value.rawValue)}function bindValueMap(valueMap,key,applyValue){bindValue(valueMap.value(key),applyValue)}function valueToClassName(elem,className){return value=>{value?elem.classList.add(className):elem.classList.remove(className)}}function bindValueToTextContent(value,elem){bindValue(value,text=>{elem.textContent=null!=text?text:""})}let className$q=ClassName("btn");class ButtonView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$q()),config.viewProps.bindClassModifiers(this.element);let buttonElem=doc.createElement("button");buttonElem.classList.add(className$q("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(className$q("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem)}}class ButtonController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new ButtonView(doc,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class BoundValue{constructor(initialValue,config){var _a;this.constraint_=null==config?void 0:config.constraint,this.equals_=null!==(_a=null==config?void 0:config.equals)&&void 0!==_a?_a:(v1,v2)=>v1===v2,this.emitter=new Emitter,this.rawValue_=initialValue}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(rawValue){this.setRawValue(rawValue,{forceEmit:!1,last:!0})}setRawValue(rawValue,options){let opts=null!=options?options:{forceEmit:!1,last:!0},constrainedValue=this.constraint_?this.constraint_.constrain(rawValue):rawValue,changed=!this.equals_(this.rawValue_,constrainedValue);(changed||opts.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=constrainedValue,this.emitter.emit("change",{options:opts,rawValue:constrainedValue,sender:this}))}}class PrimitiveValue{constructor(initialValue){this.emitter=new Emitter,this.value_=initialValue}get rawValue(){return this.value_}set rawValue(value){this.setRawValue(value,{forceEmit:!1,last:!0})}setRawValue(value,options){let opts=null!=options?options:{forceEmit:!1,last:!0};(this.value_!==value||opts.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=value,this.emitter.emit("change",{options:opts,rawValue:this.value_,sender:this}))}}function createValue(initialValue,config){let constraint=null==config?void 0:config.constraint,equals=null==config?void 0:config.equals;return constraint||equals?new BoundValue(initialValue,config):new PrimitiveValue(initialValue)}class ValueMap{constructor(valueMap){for(let key in this.emitter=new Emitter,this.valMap_=valueMap,this.valMap_){let v=this.valMap_[key];v.emitter.on("change",()=>{this.emitter.emit("change",{key:key,sender:this})})}}static createCore(initialValue){let keys=Object.keys(initialValue);return keys.reduce((o,key)=>Object.assign(o,{[key]:createValue(initialValue[key])}),{})}static fromObject(initialValue){let core=this.createCore(initialValue);return new ValueMap(core)}get(key){return this.valMap_[key].rawValue}set(key,value){this.valMap_[key].rawValue=value}value(key){return this.valMap_[key]}}function createParamsParserBuilder(parse){return optional=>v=>{if(!optional&&void 0===v)return{succeeded:!1,value:void 0};if(optional&&void 0===v)return{succeeded:!0,value:void 0};let result=parse(v);return void 0!==result?{succeeded:!0,value:result}:{succeeded:!1,value:void 0}}}function createParamsParserBuilders(optional){return{custom:parse=>createParamsParserBuilder(parse)(optional),boolean:createParamsParserBuilder(v=>"boolean"==typeof v?v:void 0)(optional),number:createParamsParserBuilder(v=>"number"==typeof v?v:void 0)(optional),string:createParamsParserBuilder(v=>"string"==typeof v?v:void 0)(optional),function:createParamsParserBuilder(v=>"function"==typeof v?v:void 0)(optional),constant:value=>createParamsParserBuilder(v=>v===value?value:void 0)(optional),raw:createParamsParserBuilder(v=>v)(optional),object:keyToParserMap=>createParamsParserBuilder(v=>{if(null!==v&&"object"==typeof v)return function(value,keyToParserMap){let keys=Object.keys(keyToParserMap),result=keys.reduce((tmp,key)=>{if(void 0===tmp)return;let parser=keyToParserMap[key],result=parser(value[key]);return result.succeeded?Object.assign(Object.assign({},tmp),{[key]:result.value}):void 0},{});return result}(v,keyToParserMap)})(optional),array:itemParser=>createParamsParserBuilder(v=>{if(Array.isArray(v))return v.reduce((tmp,item)=>{if(void 0===tmp)return;let result=itemParser(item);if(result.succeeded&&void 0!==result.value)return[...tmp,result.value]},[])})(optional)}}let ParamsParsers={optional:createParamsParserBuilders(!0),required:createParamsParserBuilders(!1)};function parseParams(value,keyToParserMap){let result=ParamsParsers.required.object(keyToParserMap)(value);return result.succeeded?result.value:void 0}let className$p=ClassName(""),POS_TO_CLASS_NAME_MAP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class BladeController{constructor(config){this.parent_=null,this.blade=config.blade,this.view=config.view,this.viewProps=config.viewProps;let elem=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(pos=>{elem.classList.remove(className$p(void 0,POS_TO_CLASS_NAME_MAP[pos]))}),this.blade.get("positions").forEach(pos=>{elem.classList.add(className$p(void 0,POS_TO_CLASS_NAME_MAP[pos]))})}),this.viewProps.handleDispose(()=>{elem&&elem.parentElement&&elem.parentElement.removeChild(elem)})}get parent(){return this.parent_}}let SVG_NS="http://www.w3.org/2000/svg";function forceReflow(element){element.offsetHeight}function supportsTouch(doc){return void 0!==doc.ontouchstart}let ICON_ID_TO_INNER_HTML_MAP={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function createSvgIconElement(document,iconId){let elem=document.createElementNS(SVG_NS,"svg");return elem.innerHTML=ICON_ID_TO_INNER_HTML_MAP[iconId],elem}function insertElementAt(parentElement,element,index){parentElement.insertBefore(element,parentElement.children[index])}function removeElement(element){element.parentElement&&element.parentElement.removeChild(element)}function removeChildElements(element){for(;element.children.length>0;)element.removeChild(element.children[0])}function findNextTarget(ev){return ev.relatedTarget?ev.relatedTarget:"explicitOriginalTarget"in ev?ev.explicitOriginalTarget:null}let className$o=ClassName("lbl");class LabelView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$o()),config.viewProps.bindClassModifiers(this.element);let labelElem=doc.createElement("div");labelElem.classList.add(className$o("l")),bindValueMap(config.props,"label",value=>{isEmpty(value)?this.element.classList.add(className$o(void 0,"nol")):(this.element.classList.remove(className$o(void 0,"nol")),function(element){for(;element.childNodes.length>0;)element.removeChild(element.childNodes[0])}(labelElem),labelElem.appendChild(function(doc,label){let frag=doc.createDocumentFragment(),lineNodes=label.split("\n").map(line=>doc.createTextNode(line));return lineNodes.forEach((lineNode,index)=>{index>0&&frag.appendChild(doc.createElement("br")),frag.appendChild(lineNode)}),frag}(doc,value)))}),this.element.appendChild(labelElem),this.labelElement=labelElem;let valueElem=doc.createElement("div");valueElem.classList.add(className$o("v")),this.element.appendChild(valueElem),this.valueElement=valueElem}}class LabelController extends BladeController{constructor(doc,config){let viewProps=config.valueController.viewProps;super(Object.assign(Object.assign({},config),{view:new LabelView(doc,{props:config.props,viewProps:viewProps}),viewProps:viewProps})),this.props=config.props,this.valueController=config.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}let ButtonBladePlugin={id:"button",type:"blade",accept(params){let result=parseParams(params,{title:ParamsParsers.required.string,view:ParamsParsers.required.constant("button"),label:ParamsParsers.optional.string});return result?{params:result}:null},controller:args=>new LabelController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:new ButtonController(args.document,{props:ValueMap.fromObject({title:args.params.title}),viewProps:args.viewProps})}),api:args=>args.controller instanceof LabelController&&args.controller.valueController instanceof ButtonController?new ButtonApi(args.controller):null};class ValueBladeController extends BladeController{constructor(config){super(config),this.value=config.value}}function createBlade(){return new ValueMap({positions:createValue([],{equals:deepEqualsArray})})}class Foldable extends ValueMap{constructor(valueMap){super(valueMap)}static create(expanded){let core=ValueMap.createCore({completed:!0,expanded:expanded,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null});return new Foldable(core)}get styleExpanded(){var _a;return null!==(_a=this.get("temporaryExpanded"))&&void 0!==_a?_a:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let exHeight=this.get("expandedHeight");return this.get("shouldFixHeight")&&!isEmpty(exHeight)?`${exHeight}px`:"auto"}bindExpandedClass(elem,expandedClassName){let onExpand=()=>{let expanded=this.styleExpanded;expanded?elem.classList.add(expandedClassName):elem.classList.remove(expandedClassName)};bindValueMap(this,"expanded",onExpand),bindValueMap(this,"temporaryExpanded",onExpand)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function applyHeight(foldable,elem){elem.style.height=foldable.styleHeight}function bindFoldable(foldable,elem){foldable.value("expanded").emitter.on("beforechange",()=>{if(foldable.set("completed",!1),isEmpty(foldable.get("expandedHeight"))){let height;foldable.set("expandedHeight",(height=0,function(element,callback){let t=element.style.transition;element.style.transition="none",callback(),element.style.transition=t}(elem,()=>{foldable.set("expandedHeight",null),foldable.set("temporaryExpanded",!0),forceReflow(elem),height=elem.clientHeight,foldable.set("temporaryExpanded",null),forceReflow(elem)}),height))}foldable.set("shouldFixHeight",!0),forceReflow(elem)}),foldable.emitter.on("change",()=>{applyHeight(foldable,elem)}),applyHeight(foldable,elem),elem.addEventListener("transitionend",ev=>{"height"===ev.propertyName&&foldable.cleanUpTransition()})}class RackLikeApi extends BladeApi{constructor(controller,rackApi){super(controller),this.rackApi_=rackApi}}class NestedOrderedSet{constructor(extract){this.emitter=new Emitter,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=extract}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(callback){for(let item of this.allItems())if(callback(item))return item;return null}includes(item){return this.cache_.has(item)}add(item,opt_index){if(this.includes(item))throw TpError.shouldNeverHappen();let index=void 0!==opt_index?opt_index:this.items_.length;this.items_.splice(index,0,item),this.cache_.add(item);let subList=this.extract_(item);subList&&(subList.emitter.on("add",this.onSubListAdd_),subList.emitter.on("remove",this.onSubListRemove_),subList.allItems().forEach(item=>{this.cache_.add(item)})),this.emitter.emit("add",{index:index,item:item,root:this,target:this})}remove(item){let index=this.items_.indexOf(item);if(index<0)return;this.items_.splice(index,1),this.cache_.delete(item);let subList=this.extract_(item);subList&&(subList.emitter.off("add",this.onSubListAdd_),subList.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:index,item:item,root:this,target:this})}onSubListAdd_(ev){this.cache_.add(ev.item),this.emitter.emit("add",{index:ev.index,item:ev.item,root:this,target:ev.target})}onSubListRemove_(ev){this.cache_.delete(ev.item),this.emitter.emit("remove",{index:ev.index,item:ev.item,root:this,target:ev.target})}}class InputBindingApi extends BladeApi{constructor(controller){super(controller),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Emitter,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(ev){let value=ev.sender.target.read();this.emitter_.emit("change",{event:new TpChangeEvent(this,value,this.controller_.binding.target.presetKey,ev.options.last)})}}class InputBindingController extends LabelController{constructor(doc,config){super(doc,config),this.binding=config.binding}}class MonitorBindingApi extends BladeApi{constructor(controller){super(controller),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Emitter,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(ev){let value=ev.sender.target.read();this.emitter_.emit("update",{event:new TpUpdateEvent(this,value,this.controller_.binding.target.presetKey)})}}class MonitorBindingController extends LabelController{constructor(doc,config){super(doc,config),this.binding=config.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function findSubBladeApiSet(api){return api instanceof RackApi?api.apiSet_:api instanceof RackLikeApi?api.rackApi_.apiSet_:null}function getApiByController(apiSet,controller){let api=apiSet.find(api=>api.controller_===controller);if(!api)throw TpError.shouldNeverHappen();return api}function createBindingTarget(obj,key,opt_id){if(!BindingTarget.isBindable(obj))throw TpError.notBindable();return new BindingTarget(obj,key,opt_id)}class RackApi extends BladeApi{constructor(controller,pool){super(controller),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Emitter,this.apiSet_=new NestedOrderedSet(findSubBladeApiSet),this.pool_=pool;let rack=this.controller_.rack;rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),rack.emitter.on("inputchange",this.onRackInputChange_),rack.emitter.on("monitorupdate",this.onRackMonitorUpdate_),rack.children.forEach(bc=>{this.setUpApi_(bc)})}get children(){return this.controller_.rack.children.map(bc=>getApiByController(this.apiSet_,bc))}addInput(object,key,opt_params){let params=null!=opt_params?opt_params:{},doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createInput(doc,createBindingTarget(object,key,params.presetKey),params),api=new InputBindingApi(bc);return this.add(api,params.index)}addMonitor(object,key,opt_params){let params=null!=opt_params?opt_params:{},doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createMonitor(doc,createBindingTarget(object,key),params),api=new MonitorBindingApi(bc);return this.add(api,params.index)}addFolder(params){return this.addBlade(Object.assign(Object.assign({},params),{view:"folder"}))}addButton(params){return this.addBlade(Object.assign(Object.assign({},params),{view:"button"}))}addSeparator(opt_params){return this.addBlade(Object.assign(Object.assign({},null!=opt_params?opt_params:{}),{view:"separator"}))}addTab(params){return this.addBlade(Object.assign(Object.assign({},params),{view:"tab"}))}add(api,opt_index){this.controller_.rack.add(api.controller_,opt_index);let gapi=this.apiSet_.find(a=>a.controller_===api.controller_);return gapi&&this.apiSet_.remove(gapi),this.apiSet_.add(api),api}remove(api){this.controller_.rack.remove(api.controller_)}addBlade(params){let doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createBlade(doc,params),api=this.pool_.createBladeApi(bc);return this.add(api,params.index)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}setUpApi_(bc){let api=this.apiSet_.find(api=>api.controller_===bc);api||this.apiSet_.add(this.pool_.createBladeApi(bc))}onRackAdd_(ev){this.setUpApi_(ev.bladeController)}onRackRemove_(ev){if(ev.isRoot){let api=getApiByController(this.apiSet_,ev.bladeController);this.apiSet_.remove(api)}}onRackInputChange_(ev){let bc=ev.bladeController;if(bc instanceof InputBindingController){let api=getApiByController(this.apiSet_,bc),binding=bc.binding;this.emitter_.emit("change",{event:new TpChangeEvent(api,binding.target.read(),binding.target.presetKey,ev.options.last)})}else if(bc instanceof ValueBladeController){let api1=getApiByController(this.apiSet_,bc);this.emitter_.emit("change",{event:new TpChangeEvent(api1,bc.value.rawValue,void 0,ev.options.last)})}}onRackMonitorUpdate_(ev){if(!(ev.bladeController instanceof MonitorBindingController))throw TpError.shouldNeverHappen();let api=getApiByController(this.apiSet_,ev.bladeController),binding=ev.bladeController.binding;this.emitter_.emit("update",{event:new TpUpdateEvent(api,binding.target.read(),binding.target.presetKey)})}}class FolderApi extends RackLikeApi{constructor(controller,pool){super(controller,new RackApi(controller.rackController,pool)),this.emitter_=new Emitter,this.controller_.foldable.value("expanded").emitter.on("change",ev=>{this.emitter_.emit("fold",{event:new TpFoldEvent(this,ev.sender.rawValue)})}),this.rackApi_.on("change",ev=>{this.emitter_.emit("change",{event:ev})}),this.rackApi_.on("update",ev=>{this.emitter_.emit("update",{event:ev})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(expanded){this.controller_.foldable.set("expanded",expanded)}get title(){return this.controller_.props.get("title")}set title(title){this.controller_.props.set("title",title)}get children(){return this.rackApi_.children}addInput(object,key,opt_params){return this.rackApi_.addInput(object,key,opt_params)}addMonitor(object,key,opt_params){return this.rackApi_.addMonitor(object,key,opt_params)}addFolder(params){return this.rackApi_.addFolder(params)}addButton(params){return this.rackApi_.addButton(params)}addSeparator(opt_params){return this.rackApi_.addSeparator(opt_params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){return this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addBlade(params){return this.rackApi_.addBlade(params)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class RackLikeController extends BladeController{constructor(config){super({blade:config.blade,view:config.view,viewProps:config.rackController.viewProps}),this.rackController=config.rackController}}class PlainView{constructor(doc,config){let className=ClassName(config.viewName);this.element=doc.createElement("div"),this.element.classList.add(className()),config.viewProps.bindClassModifiers(this.element)}}function findSubRack(bc){return bc instanceof RackController?bc.rack:bc instanceof RackLikeController?bc.rackController.rack:null}function findSubBladeControllerSet(bc){let rack=findSubRack(bc);return rack?rack.bcSet_:null}class BladeRack{constructor(blade){var _a;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Emitter,this.blade_=null!=blade?blade:null,null===(_a=this.blade_)||void 0===_a||_a.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new NestedOrderedSet(findSubBladeControllerSet),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(bc,opt_index){bc.parent&&bc.parent.remove(bc),bc.parent_=this,this.bcSet_.add(bc,opt_index)}remove(bc){bc.parent_=null,this.bcSet_.remove(bc)}find(controllerClass){return this.bcSet_.allItems().filter(bc=>bc instanceof controllerClass)}onSetAdd_(ev){this.updatePositions_();let isRoot=ev.target===ev.root;if(this.emitter.emit("add",{bladeController:ev.item,index:ev.index,isRoot:isRoot,sender:this}),!isRoot)return;let bc=ev.item;if(bc.viewProps.emitter.on("change",this.onChildViewPropsChange_),bc.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),bc.viewProps.handleDispose(this.onChildDispose_),bc instanceof InputBindingController)bc.binding.emitter.on("change",this.onChildInputChange_);else if(bc instanceof MonitorBindingController)bc.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(bc instanceof ValueBladeController)bc.value.emitter.on("change",this.onChildValueChange_);else{let rack=findSubRack(bc);if(rack){let emitter=rack.emitter;emitter.on("layout",this.onDescendantLayout_),emitter.on("inputchange",this.onDescendantInputChange_),emitter.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(ev){this.updatePositions_();let isRoot=ev.target===ev.root;if(this.emitter.emit("remove",{bladeController:ev.item,isRoot:isRoot,sender:this}),!isRoot)return;let bc=ev.item;if(bc instanceof InputBindingController)bc.binding.emitter.off("change",this.onChildInputChange_);else if(bc instanceof MonitorBindingController)bc.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(bc instanceof ValueBladeController)bc.value.emitter.off("change",this.onChildValueChange_);else{let rack=findSubRack(bc);if(rack){let emitter=rack.emitter;emitter.off("layout",this.onDescendantLayout_),emitter.off("inputchange",this.onDescendantInputChange_),emitter.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){let visibleItems=this.bcSet_.items.filter(bc=>!bc.viewProps.get("hidden")),firstVisibleItem=visibleItems[0],lastVisibleItem=visibleItems[visibleItems.length-1];this.bcSet_.items.forEach(bc=>{let ps=[];bc===firstVisibleItem&&(ps.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&ps.push("veryfirst")),bc===lastVisibleItem&&(ps.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&ps.push("verylast")),bc.blade.set("positions",ps)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(_ev){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){let disposedUcs=this.bcSet_.items.filter(bc=>bc.viewProps.get("disposed"));disposedUcs.forEach(bc=>{this.bcSet_.remove(bc)})}onChildInputChange_(ev){let bc=function(bcs,b){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof InputBindingController&&bc.binding===b)return bc}return null}(this.find(InputBindingController),ev.sender);if(!bc)throw TpError.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:bc,options:ev.options,sender:this})}onChildMonitorUpdate_(ev){let bc=function(bcs,b){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof MonitorBindingController&&bc.binding===b)return bc}return null}(this.find(MonitorBindingController),ev.sender);if(!bc)throw TpError.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:bc,sender:this})}onChildValueChange_(ev){let bc=function(bcs,v){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof ValueBladeController&&bc.value===v)return bc}return null}(this.find(ValueBladeController),ev.sender);if(!bc)throw TpError.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:bc,options:ev.options,sender:this})}onDescendantLayout_(_){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(ev){this.emitter.emit("inputchange",{bladeController:ev.bladeController,options:ev.options,sender:this})}onDescendantMonitorUpdate_(ev){this.emitter.emit("monitorupdate",{bladeController:ev.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class RackController extends BladeController{constructor(doc,config){super(Object.assign(Object.assign({},config),{view:new PlainView(doc,{viewName:"brk",viewProps:config.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let rack=new BladeRack(config.root?void 0:config.blade);rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),this.rack=rack,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--){let bc=this.rack.children[i];bc.viewProps.set("disposed",!0)}})}onRackAdd_(ev){ev.isRoot&&insertElementAt(this.view.element,ev.bladeController.view.element,ev.index)}onRackRemove_(ev){ev.isRoot&&removeElement(ev.bladeController.view.element)}}let bladeContainerClassName=ClassName("cnt");class FolderView{constructor(doc,config){var _a;this.className_=ClassName(null!==(_a=config.viewName)&&void 0!==_a?_a:"fld"),this.element=doc.createElement("div"),this.element.classList.add(this.className_(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),this.foldable_=config.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),bindValueMap(this.foldable_,"completed",valueToClassName(this.element,this.className_(void 0,"cpl")));let buttonElem=doc.createElement("button");buttonElem.classList.add(this.className_("b")),bindValueMap(config.props,"title",title=>{isEmpty(title)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(this.className_("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem;let markElem=doc.createElement("div");markElem.classList.add(this.className_("m")),this.buttonElement.appendChild(markElem);let containerElem=config.containerElement;containerElem.classList.add(this.className_("c")),this.element.appendChild(containerElem),this.containerElement=containerElem}}class FolderController extends RackLikeController{constructor(doc,config){var _a;let foldable=Foldable.create(null===(_a=config.expanded)||void 0===_a||_a),rc=new RackController(doc,{blade:config.blade,root:config.root,viewProps:config.viewProps});super(Object.assign(Object.assign({},config),{rackController:rc,view:new FolderView(doc,{containerElement:rc.view.element,foldable:foldable,props:config.props,viewName:config.root?"rot":void 0,viewProps:config.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=config.props,this.foldable=foldable,bindFoldable(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}let FolderBladePlugin={id:"folder",type:"blade",accept(params){let result=parseParams(params,{title:ParamsParsers.required.string,view:ParamsParsers.required.constant("folder"),expanded:ParamsParsers.optional.boolean});return result?{params:result}:null},controller:args=>new FolderController(args.document,{blade:args.blade,expanded:args.params.expanded,props:ValueMap.fromObject({title:args.params.title}),viewProps:args.viewProps}),api:args=>args.controller instanceof FolderController?new FolderApi(args.controller,args.pool):null};class LabeledValueController extends ValueBladeController{constructor(doc,config){let viewProps=config.valueController.viewProps;super(Object.assign(Object.assign({},config),{value:config.valueController.value,view:new LabelView(doc,{props:config.props,viewProps:viewProps}),viewProps:viewProps})),this.props=config.props,this.valueController=config.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class SeparatorApi extends BladeApi{}let className$n=ClassName("spr");class SeparatorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$n()),config.viewProps.bindClassModifiers(this.element);let hrElem=doc.createElement("hr");hrElem.classList.add(className$n("r")),this.element.appendChild(hrElem)}}class SeparatorController extends BladeController{constructor(doc,config){super(Object.assign(Object.assign({},config),{view:new SeparatorView(doc,{viewProps:config.viewProps})}))}}let SeparatorBladePlugin={id:"separator",type:"blade",accept(params){let result=parseParams(params,{view:ParamsParsers.required.constant("separator")});return result?{params:result}:null},controller:args=>new SeparatorController(args.document,{blade:args.blade,viewProps:args.viewProps}),api:args=>args.controller instanceof SeparatorController?new SeparatorApi(args.controller):null},className$m=ClassName("");function valueToModifier(elem,modifier){return valueToClassName(elem,className$m(void 0,modifier))}class ViewProps extends ValueMap{constructor(valueMap){super(valueMap)}static create(opt_initialValue){var _a,_b;let initialValue=null!=opt_initialValue?opt_initialValue:{},coreObj={disabled:null!==(_a=initialValue.disabled)&&void 0!==_a&&_a,disposed:!1,hidden:null!==(_b=initialValue.hidden)&&void 0!==_b&&_b},core=ValueMap.createCore(coreObj);return new ViewProps(core)}bindClassModifiers(elem){bindValueMap(this,"disabled",valueToModifier(elem,"disabled")),bindValueMap(this,"hidden",valueToModifier(elem,"hidden"))}bindDisabled(target){bindValueMap(this,"disabled",disabled=>{target.disabled=disabled})}bindTabIndex(elem){bindValueMap(this,"disabled",disabled=>{elem.tabIndex=disabled?-1:0})}handleDispose(callback){this.value("disposed").emitter.on("change",disposed=>{disposed&&callback()})}}let className$l=ClassName("tbi");class TabItemView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$l()),config.viewProps.bindClassModifiers(this.element),bindValueMap(config.props,"selected",selected=>{selected?this.element.classList.add(className$l(void 0,"sel")):this.element.classList.remove(className$l(void 0,"sel"))});let buttonElem=doc.createElement("button");buttonElem.classList.add(className$l("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(className$l("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem}}class TabItemController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new TabItemView(doc,{props:config.props,viewProps:config.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class TabPageController{constructor(doc,config){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new TabItemController(doc,{props:config.itemProps,viewProps:ViewProps.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new RackController(doc,{blade:createBlade(),viewProps:ViewProps.create()}),this.props=config.props,bindValueMap(this.props,"selected",selected=>{this.itemController.props.set("selected",selected),this.contentController.viewProps.set("hidden",!selected)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class TabPageApi{constructor(controller,contentRackApi){this.controller_=controller,this.rackApi_=contentRackApi}get title(){var _a;return null!==(_a=this.controller_.itemController.props.get("title"))&&void 0!==_a?_a:""}set title(title){this.controller_.itemController.props.set("title",title)}get selected(){return this.controller_.props.get("selected")}set selected(selected){this.controller_.props.set("selected",selected)}get children(){return this.rackApi_.children}addButton(params){return this.rackApi_.addButton(params)}addFolder(params){return this.rackApi_.addFolder(params)}addSeparator(opt_params){return this.rackApi_.addSeparator(opt_params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addInput(object,key,opt_params){return this.rackApi_.addInput(object,key,opt_params)}addMonitor(object,key,opt_params){return this.rackApi_.addMonitor(object,key,opt_params)}addBlade(params){return this.rackApi_.addBlade(params)}}class TabApi extends RackLikeApi{constructor(controller,pool){super(controller,new RackApi(controller.rackController,pool)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new Emitter,this.pageApiMap_=new Map,this.rackApi_.on("change",ev=>{this.emitter_.emit("change",{event:ev})}),this.rackApi_.on("update",ev=>{this.emitter_.emit("update",{event:ev})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(pc=>{this.setUpPageApi_(pc)})}get pages(){return this.controller_.pageSet.items.map(pc=>{let api=this.pageApiMap_.get(pc);if(!api)throw TpError.shouldNeverHappen();return api})}addPage(params){let doc=this.controller_.view.element.ownerDocument,pc=new TabPageController(doc,{itemProps:ValueMap.fromObject({selected:!1,title:params.title}),props:ValueMap.fromObject({selected:!1})});this.controller_.add(pc,params.index);let api=this.pageApiMap_.get(pc);if(!api)throw TpError.shouldNeverHappen();return api}removePage(index){this.controller_.remove(index)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}setUpPageApi_(pc){let rackApi=this.rackApi_.apiSet_.find(api=>api.controller_===pc.contentController);if(!rackApi)throw TpError.shouldNeverHappen();let api=new TabPageApi(pc,rackApi);this.pageApiMap_.set(pc,api)}onPageAdd_(ev){this.setUpPageApi_(ev.item)}onPageRemove_(ev){let api=this.pageApiMap_.get(ev.item);if(!api)throw TpError.shouldNeverHappen();this.pageApiMap_.delete(ev.item)}onSelect_(ev){this.emitter_.emit("select",{event:new TpTabSelectEvent(this,ev.rawValue)})}}class Tab{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=createValue(!0),this.selectedIndex=createValue(-1),this.items_=[]}add(item,opt_index){let index=null!=opt_index?opt_index:this.items_.length;this.items_.splice(index,0,item),item.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(item){let index=this.items_.indexOf(item);index<0||(this.items_.splice(index,1),item.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length){this.selectedIndex.rawValue=-1,this.empty.rawValue=!0;return}let firstSelIndex=this.items_.findIndex(s=>s.rawValue);firstSelIndex<0?(this.items_.forEach((s,i)=>{s.rawValue=0===i}),this.selectedIndex.rawValue=0):(this.items_.forEach((s,i)=>{s.rawValue=i===firstSelIndex}),this.selectedIndex.rawValue=firstSelIndex),this.empty.rawValue=!1}onItemSelectedChange_(ev){if(ev.rawValue){let index=this.items_.findIndex(s=>s===ev.sender);this.items_.forEach((s,i)=>{s.rawValue=i===index}),this.selectedIndex.rawValue=index}else this.keepSelection_()}}let className$k=ClassName("tab");class TabView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$k(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),bindValue(config.empty,valueToClassName(this.element,className$k(void 0,"nop")));let itemsElem=doc.createElement("div");itemsElem.classList.add(className$k("i")),this.element.appendChild(itemsElem),this.itemsElement=itemsElem;let contentsElem=config.contentsElement;contentsElem.classList.add(className$k("c")),this.element.appendChild(contentsElem),this.contentsElement=contentsElem}}class TabController extends RackLikeController{constructor(doc,config){let cr=new RackController(doc,{blade:config.blade,viewProps:config.viewProps}),tab=new Tab;super({blade:config.blade,rackController:cr,view:new TabView(doc,{contentsElement:cr.view.element,empty:tab.empty,viewProps:config.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new NestedOrderedSet(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=tab}get pageSet(){return this.pageSet_}add(pc,opt_index){this.pageSet_.add(pc,opt_index)}remove(index){this.pageSet_.remove(this.pageSet_.items[index])}onPageAdd_(ev){let pc=ev.item;insertElementAt(this.view.itemsElement,pc.itemController.view.element,ev.index),this.rackController.rack.add(pc.contentController,ev.index),this.tab.add(pc.props.value("selected"))}onPageRemove_(ev){let pc=ev.item;removeElement(pc.itemController.view.element),this.rackController.rack.remove(pc.contentController),this.tab.remove(pc.props.value("selected"))}}let TabBladePlugin={id:"tab",type:"blade",accept(params){let result=parseParams(params,{pages:ParamsParsers.required.array(ParamsParsers.required.object({title:ParamsParsers.required.string})),view:ParamsParsers.required.constant("tab")});return result&&0!==result.pages.length?{params:result}:null},controller(args){let c=new TabController(args.document,{blade:args.blade,viewProps:args.viewProps});return args.params.pages.forEach(p=>{let pc=new TabPageController(args.document,{itemProps:ValueMap.fromObject({selected:!1,title:p.title}),props:ValueMap.fromObject({selected:!1})});c.add(pc)}),c},api:args=>args.controller instanceof TabController?new TabApi(args.controller,args.pool):null};class ManualTicker{constructor(){this.disabled=!1,this.emitter=new Emitter}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class IntervalTicker{constructor(doc,interval){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=doc,this.emitter=new Emitter,this.interval_=interval,this.setTimer_()}get disabled(){return this.disabled_}set disabled(inactive){this.disabled_=inactive,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;let win=this.doc_.defaultView;win&&win.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let win=this.doc_.defaultView;win&&(this.timerId_=win.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class CompositeConstraint{constructor(constraints){this.constraints=constraints}constrain(value){return this.constraints.reduce((result,c)=>c.constrain(result),value)}}function findConstraint(c,constraintClass){if(c instanceof constraintClass)return c;if(c instanceof CompositeConstraint){let result=c.constraints.reduce((tmpResult,sc)=>tmpResult||(sc instanceof constraintClass?sc:null),null);if(result)return result}return null}class ListConstraint{constructor(options){this.options=options}constrain(value){let opts=this.options;if(0===opts.length)return value;let matched=opts.filter(item=>item.value===value).length>0;return matched?value:opts[0].value}}class RangeConstraint{constructor(config){this.maxValue=config.max,this.minValue=config.min}constrain(value){let result=value;return isEmpty(this.minValue)||(result=Math.max(result,this.minValue)),isEmpty(this.maxValue)||(result=Math.min(result,this.maxValue)),result}}class StepConstraint{constructor(step,origin=0){this.step=step,this.origin=origin}constrain(value){let o=this.origin%this.step,r=Math.round((value-o)/this.step);return o+r*this.step}}let className$j=ClassName("lst");class ListView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.props_=config.props,this.element=doc.createElement("div"),this.element.classList.add(className$j()),config.viewProps.bindClassModifiers(this.element);let selectElem=doc.createElement("select");selectElem.classList.add(className$j("s")),bindValueMap(this.props_,"options",opts=>{removeChildElements(selectElem),opts.forEach((item,index)=>{let optionElem=doc.createElement("option");optionElem.dataset.index=String(index),optionElem.textContent=item.text,optionElem.value=String(item.value),selectElem.appendChild(optionElem)})}),config.viewProps.bindDisabled(selectElem),this.element.appendChild(selectElem),this.selectElement=selectElem;let markElem=doc.createElement("div");markElem.classList.add(className$j("m")),markElem.appendChild(createSvgIconElement(doc,"dropdown")),this.element.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value_=config.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ListController{constructor(doc,config){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new ListView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){let selectElem=e.currentTarget,optElem=selectElem.selectedOptions.item(0);if(!optElem)return;let itemIndex=Number(optElem.dataset.index);this.value.rawValue=this.props.get("options")[itemIndex].value}}let className$i=ClassName("pop");class PopupView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$i()),config.viewProps.bindClassModifiers(this.element),bindValue(config.shows,valueToClassName(this.element,className$i(void 0,"v")))}}class PopupController{constructor(doc,config){this.shows=createValue(!1),this.viewProps=config.viewProps,this.view=new PopupView(doc,{shows:this.shows,viewProps:this.viewProps})}}let className$h=ClassName("txt");class TextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className$h()),config.viewProps.bindClassModifiers(this.element),this.props_=config.props,this.props_.emitter.on("change",this.onChange_);let inputElem=doc.createElement("input");inputElem.classList.add(className$h("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onChange_),this.value_=config.value,this.refresh()}refresh(){let formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value_.rawValue)}onChange_(){this.refresh()}}class TextController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=config.parser,this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new TextView(doc,{props:config.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){let inputElem=e.currentTarget,value=inputElem.value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=parsedValue),this.view.refresh()}}function boolFromUnknown(value){return"false"!==value&&!!value}function BooleanFormatter(value){return String(value)}class NumberLiteralNode{constructor(text){this.text=text}evaluate(){return Number(this.text)}toString(){return this.text}}let BINARY_OPERATION_MAP={"**":(v1,v2)=>Math.pow(v1,v2),"*":(v1,v2)=>v1*v2,"/":(v1,v2)=>v1/v2,"%":(v1,v2)=>v1%v2,"+":(v1,v2)=>v1+v2,"-":(v1,v2)=>v1-v2,"<<":(v1,v2)=>v1<<v2,">>":(v1,v2)=>v1>>v2,">>>":(v1,v2)=>v1>>>v2,"&":(v1,v2)=>v1&v2,"^":(v1,v2)=>v1^v2,"|":(v1,v2)=>v1|v2};class BinaryOperationNode{constructor(operator,left,right){this.left=left,this.operator=operator,this.right=right}evaluate(){let op=BINARY_OPERATION_MAP[this.operator];if(!op)throw Error(`unexpected binary operator: '${this.operator}`);return op(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}let UNARY_OPERATION_MAP={"+":v=>v,"-":v=>-v,"~":v=>~v};class UnaryOperationNode{constructor(operator,expr){this.operator=operator,this.expression=expr}evaluate(){let op=UNARY_OPERATION_MAP[this.operator];if(!op)throw Error(`unexpected unary operator: '${this.operator}`);return op(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function combineReader(parsers){return(text,cursor)=>{for(let i=0;i<parsers.length;i++){let result=parsers[i](text,cursor);if(""!==result)return result}return""}}function readWhitespace(text,cursor){var _a;let m=text.substr(cursor).match(/^\s+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}function readDecimalDigits(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-9]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}function readExponentPart(text,cursor){let e=text.substr(cursor,1);if(cursor+=1,"e"!==e.toLowerCase())return"";let si=function(text,cursor){let ds=readDecimalDigits(text,cursor);if(""!==ds)return ds;let sign=text.substr(cursor,1);if(cursor+=1,"-"!==sign&&"+"!==sign)return"";let sds=readDecimalDigits(text,cursor);return""===sds?"":sign+sds}(text,cursor);return""===si?"":e+si}function readDecimalIntegerLiteral(text,cursor){let ch=text.substr(cursor,1);if("0"===ch)return ch;let nzd=function(text,cursor){let ch=text.substr(cursor,1);return ch.match(/^[1-9]$/)?ch:""}(text,cursor);return(cursor+=nzd.length,""===nzd)?"":nzd+readDecimalDigits(text,cursor)}let readDecimalLiteral=combineReader([function(text,cursor){let dil=readDecimalIntegerLiteral(text,cursor);if(cursor+=dil.length,""===dil)return"";let dot=text.substr(cursor,1);if(cursor+=dot.length,"."!==dot)return"";let dds=readDecimalDigits(text,cursor);return cursor+=dds.length,dil+dot+dds+readExponentPart(text,cursor)},function(text,cursor){let dot=text.substr(cursor,1);if(cursor+=dot.length,"."!==dot)return"";let dds=readDecimalDigits(text,cursor);return(cursor+=dds.length,""===dds)?"":dot+dds+readExponentPart(text,cursor)},function(text,cursor){let dil=readDecimalIntegerLiteral(text,cursor);return(cursor+=dil.length,""===dil)?"":dil+readExponentPart(text,cursor)}]),readNonDecimalIntegerLiteral=combineReader([function(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0b"!==prefix.toLowerCase())return"";let bds=function(text,cursor){var _a;let m=text.substr(cursor).match(/^[01]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===bds?"":prefix+bds},function(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0o"!==prefix.toLowerCase())return"";let ods=function(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-7]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===ods?"":prefix+ods},function(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0x"!==prefix.toLowerCase())return"";let hds=function(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-9a-f]+/i);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===hds?"":prefix+hds}]),readNumericLiteral=combineReader([readNonDecimalIntegerLiteral,readDecimalLiteral]),parseBinaryOperationExpression=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((parser,ops)=>(text,cursor)=>{let firstExpr=parser(text,cursor);if(!firstExpr)return null;cursor=firstExpr.cursor;let expr=firstExpr.evaluable;for(;;){let op=function(ops,text,cursor){cursor+=readWhitespace(text,cursor).length;let op=ops.filter(op=>text.startsWith(op,cursor))[0];return op?(cursor+=op.length,{cursor:cursor+=readWhitespace(text,cursor).length,operator:op}):null}(ops,text,cursor);if(!op)break;cursor=op.cursor;let nextExpr=parser(text,cursor);if(!nextExpr)return null;cursor=nextExpr.cursor,expr=new BinaryOperationNode(op.operator,expr,nextExpr.evaluable)}return expr?{cursor:cursor,evaluable:expr}:null},function parseUnaryExpression(text,cursor){var cursor1,_a;let expr=null!==(_a=function(text,cursor){let num=readNumericLiteral(text,cursor);return(cursor+=num.length,""===num)?null:{evaluable:new NumberLiteralNode(num),cursor:cursor}}(text,cursor1=cursor))&&void 0!==_a?_a:function(text,cursor){let op=text.substr(cursor,1);if(cursor+=op.length,"("!==op)return null;let expr=parseExpression(text,cursor);if(!expr)return null;cursor=expr.cursor,cursor+=readWhitespace(text,cursor).length;let cl=text.substr(cursor,1);return(cursor+=cl.length,")"!==cl)?null:{evaluable:expr.evaluable,cursor:cursor}}(text,cursor1);if(expr)return expr;let op=text.substr(cursor,1);if(cursor+=op.length,"+"!==op&&"-"!==op&&"~"!==op)return null;let num=parseUnaryExpression(text,cursor);return num?{cursor:cursor=num.cursor,evaluable:new UnaryOperationNode(op,num.evaluable)}:null});function parseExpression(text,cursor){return cursor+=readWhitespace(text,cursor).length,parseBinaryOperationExpression(text,cursor)}function parseNumber(text){var _a;let r=function(text){let expr=parseExpression(text,0);if(!expr)return null;let cursor=expr.cursor+readWhitespace(text,expr.cursor).length;return cursor!==text.length?null:expr.evaluable}(text);return null!==(_a=null==r?void 0:r.evaluate())&&void 0!==_a?_a:null}function numberFromUnknown(value){if("number"==typeof value)return value;if("string"==typeof value){let pv=parseNumber(value);if(!isEmpty(pv))return pv}return 0}function numberToString(value){return String(value)}function createNumberFormatter(digits){return value=>value.toFixed(Math.max(Math.min(digits,20),0))}let innerFormatter=createNumberFormatter(0);function formatPercentage(value){return innerFormatter(value)+"%"}function stringFromUnknown(value){return String(value)}function formatString(value){return value}function fillBuffer(buffer,bufferSize){for(;buffer.length<bufferSize;)buffer.push(void 0)}function connectValues({primary,secondary,forward,backward}){let changing=!1;function preventFeedback(callback){changing||(changing=!0,callback(),changing=!1)}primary.emitter.on("change",ev=>{preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),ev.options)})}),secondary.emitter.on("change",ev=>{preventFeedback(()=>{primary.setRawValue(backward(primary,secondary),ev.options)}),preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),ev.options)})}),preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),{forceEmit:!1,last:!0})})}function getStepForKey(baseStep,keys){let step=baseStep*(keys.altKey?.1:1)*(keys.shiftKey?10:1);return keys.upKey?+step:keys.downKey?-step:0}function getVerticalStepKeys(ev){return{altKey:ev.altKey,downKey:"ArrowDown"===ev.key,shiftKey:ev.shiftKey,upKey:"ArrowUp"===ev.key}}function getHorizontalStepKeys(ev){return{altKey:ev.altKey,downKey:"ArrowLeft"===ev.key,shiftKey:ev.shiftKey,upKey:"ArrowRight"===ev.key}}function isArrowKey(key){return"ArrowUp"===key||"ArrowDown"===key||"ArrowLeft"===key||"ArrowRight"===key}function computeOffset$1(ev,elem){var _a,_b;let win=elem.ownerDocument.defaultView,rect=elem.getBoundingClientRect();return{x:ev.pageX-((null!==(_a=win&&win.scrollX)&&void 0!==_a?_a:0)+rect.left),y:ev.pageY-((null!==(_b=win&&win.scrollY)&&void 0!==_b?_b:0)+rect.top)}}class PointerHandler{constructor(element){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=element,this.emitter=new Emitter,element.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),element.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),element.addEventListener("touchend",this.onTouchEnd_),element.addEventListener("mousedown",this.onMouseDown_)}computePosition_(offset){let rect=this.elem_.getBoundingClientRect();return{bounds:{width:rect.width,height:rect.height},point:offset?{x:offset.x,y:offset.y}:null}}onMouseDown_(ev){var _a;ev.preventDefault(),null===(_a=ev.currentTarget)||void 0===_a||_a.focus();let doc=this.elem_.ownerDocument;doc.addEventListener("mousemove",this.onDocumentMouseMove_),doc.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseMove_(ev){this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseUp_(ev){let doc=this.elem_.ownerDocument;doc.removeEventListener("mousemove",this.onDocumentMouseMove_),doc.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onTouchStart_(ev){ev.preventDefault();let touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchMove_(ev){let touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchEnd_(ev){var _a;let touch=null!==(_a=ev.targetTouches.item(0))&&void 0!==_a?_a:this.lastTouch_,rect=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey})}}function mapRange(value,start1,end1,start2,end2){return start2+(value-start1)/(end1-start1)*(end2-start2)}function getDecimalDigits(value){let text=String(value.toFixed(10)),frac=text.split(".")[1];return frac.replace(/0+$/,"").length}function constrainRange(value,min,max){return Math.min(Math.max(value,min),max)}let className$g=ClassName("txt");class NumberTextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(className$g(),className$g(void 0,"num")),config.arrayPosition&&this.element.classList.add(className$g(void 0,config.arrayPosition)),config.viewProps.bindClassModifiers(this.element);let inputElem=doc.createElement("input");inputElem.classList.add(className$g("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=config.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(className$g()),this.inputElement.classList.add(className$g("i"));let knobElem=doc.createElement("div");knobElem.classList.add(className$g("k")),this.element.appendChild(knobElem),this.knobElement=knobElem;let guideElem=doc.createElementNS(SVG_NS,"svg");guideElem.classList.add(className$g("g")),this.knobElement.appendChild(guideElem);let bodyElem=doc.createElementNS(SVG_NS,"path");bodyElem.classList.add(className$g("gb")),guideElem.appendChild(bodyElem),this.guideBodyElem_=bodyElem;let headElem=doc.createElementNS(SVG_NS,"path");headElem.classList.add(className$g("gh")),guideElem.appendChild(headElem),this.guideHeadElem_=headElem;let tooltipElem=doc.createElement("div");tooltipElem.classList.add(ClassName("tt")()),this.knobElement.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.refresh()}onDraggingChange_(ev){if(null===ev.rawValue){this.element.classList.remove(className$g(void 0,"drg"));return}this.element.classList.add(className$g(void 0,"drg"));let x=ev.rawValue/this.props_.get("draggingScale"),aox=x+(x>0?-1:x<0?1:0),adx=constrainRange(-aox,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",`M ${aox+adx},0 L${aox},4 L${aox+adx},8 M ${x},-1 L${x},9`),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${x},4`);let formatter=this.props_.get("formatter");this.tooltipElem_.textContent=formatter(this.value.rawValue),this.tooltipElem_.style.left=`${x}px`}refresh(){let formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value.rawValue)}onChange_(){this.refresh()}}class NumberTextController{constructor(doc,config){var _a;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=config.baseStep,this.parser_=config.parser,this.props=config.props,this.sliderProps_=null!==(_a=config.sliderProps)&&void 0!==_a?_a:null,this.value=config.value,this.viewProps=config.viewProps,this.dragging_=createValue(null),this.view=new NumberTextView(doc,{arrayPosition:config.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let ph=new PointerHandler(this.view.knobElement);ph.emitter.on("down",this.onPointerDown_),ph.emitter.on("move",this.onPointerMove_),ph.emitter.on("up",this.onPointerUp_)}constrainValue_(value){var _a,_b;let min=null===(_a=this.sliderProps_)||void 0===_a?void 0:_a.get("minValue"),max=null===(_b=this.sliderProps_)||void 0===_b?void 0:_b.get("maxValue"),v=value;return void 0!==min&&(v=Math.max(v,min)),void 0!==max&&(v=Math.min(v,max)),v}onInputChange_(e){let inputElem=e.currentTarget,value=inputElem.value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=this.constrainValue_(parsedValue)),this.view.refresh()}onInputKeyDown_(ev){let step=getStepForKey(this.baseStep_,getVerticalStepKeys(ev));0!==step&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+step),{forceEmit:!1,last:!1})}onInputKeyUp_(ev){let step=getStepForKey(this.baseStep_,getVerticalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(data){if(!data.point)return null;let dx=data.point.x-data.bounds.width/2;return this.constrainValue_(this.originRawValue_+dx*this.props.get("draggingScale"))}onPointerMove_(ev){let v=this.computeDraggingValue_(ev.data);null!==v&&(this.value.setRawValue(v,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ev){let v=this.computeDraggingValue_(ev.data);null!==v&&(this.value.setRawValue(v,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}let className$f=ClassName("sld");class SliderView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(className$f()),config.viewProps.bindClassModifiers(this.element);let trackElem=doc.createElement("div");trackElem.classList.add(className$f("t")),config.viewProps.bindTabIndex(trackElem),this.element.appendChild(trackElem),this.trackElement=trackElem;let knobElem=doc.createElement("div");knobElem.classList.add(className$f("k")),this.trackElement.appendChild(knobElem),this.knobElement=knobElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.update_()}update_(){let p=constrainRange(mapRange(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${p}%`}onChange_(){this.update_()}}class SliderController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=config.baseStep,this.value=config.value,this.viewProps=config.viewProps,this.props=config.props,this.view=new SliderView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){d.point&&this.value.setRawValue(mapRange(constrainRange(d.point.x,0,d.bounds.width),0,d.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),opts)}onPointerDownOrMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step=getStepForKey(this.baseStep_,getHorizontalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue+step,{forceEmit:!1,last:!1})}onKeyUp_(ev){let step=getStepForKey(this.baseStep_,getHorizontalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$e=ClassName("sldtxt");class SliderTextView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$e());let sliderElem=doc.createElement("div");sliderElem.classList.add(className$e("s")),this.sliderView_=config.sliderView,sliderElem.appendChild(this.sliderView_.element),this.element.appendChild(sliderElem);let textElem=doc.createElement("div");textElem.classList.add(className$e("t")),this.textView_=config.textView,textElem.appendChild(this.textView_.element),this.element.appendChild(textElem)}}class SliderTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.sliderC_=new SliderController(doc,{baseStep:config.baseStep,props:config.sliderProps,value:config.value,viewProps:this.viewProps}),this.textC_=new NumberTextController(doc,{baseStep:config.baseStep,parser:config.parser,props:config.textProps,sliderProps:config.sliderProps,value:config.value,viewProps:config.viewProps}),this.view=new SliderTextView(doc,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function writePrimitive(target,value){target.write(value)}function parseListOptions(value){return Array.isArray(value)?ParamsParsers.required.array(ParamsParsers.required.object({text:ParamsParsers.required.string,value:ParamsParsers.required.raw}))(value).value:"object"==typeof value?ParamsParsers.required.raw(value).value:void 0}function parsePickerLayout(value){if("inline"===value||"popup"===value)return value}function parsePointDimensionParams(value){return ParamsParsers.required.object({max:ParamsParsers.optional.number,min:ParamsParsers.optional.number,step:ParamsParsers.optional.number})(value).value}function normalizeListOptions(options){if(Array.isArray(options))return options;let items=[];return Object.keys(options).forEach(text=>{items.push({text:text,value:options[text]})}),items}function createListConstraint(options){return isEmpty(options)?null:new ListConstraint(normalizeListOptions(options))}function findListItems(constraint){let c=constraint?findConstraint(constraint,ListConstraint):null;return c?c.options:null}function getSuitableDecimalDigits(constraint,rawValue){let sc=constraint&&findConstraint(constraint,StepConstraint);return sc?getDecimalDigits(sc.step):Math.max(getDecimalDigits(rawValue),2)}function getBaseStep(constraint){let step=function(constraint){let c=constraint?findConstraint(constraint,StepConstraint):null;return c?c.step:null}(constraint);return null!=step?step:1}function getSuitableDraggingScale(constraint,rawValue){var _a;let sc=constraint&&findConstraint(constraint,StepConstraint),base=Math.abs(null!==(_a=null==sc?void 0:sc.step)&&void 0!==_a?_a:rawValue);return 0===base?.1:Math.pow(10,Math.floor(Math.log10(base))-1)}let className$d=ClassName("ckb");class CheckboxView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className$d()),config.viewProps.bindClassModifiers(this.element);let labelElem=doc.createElement("label");labelElem.classList.add(className$d("l")),this.element.appendChild(labelElem);let inputElem=doc.createElement("input");inputElem.classList.add(className$d("i")),inputElem.type="checkbox",labelElem.appendChild(inputElem),this.inputElement=inputElem,config.viewProps.bindDisabled(this.inputElement);let wrapperElem=doc.createElement("div");wrapperElem.classList.add(className$d("w")),labelElem.appendChild(wrapperElem);let markElem=createSvgIconElement(doc,"check");wrapperElem.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class CheckboxController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new CheckboxView(doc,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){let inputElem=e.currentTarget;this.value.rawValue=inputElem.checked}}let BooleanInputPlugin={id:"input-bool",type:"input",accept(value,params){if("boolean"!=typeof value)return null;let result=parseParams(params,{options:ParamsParsers.optional.custom(parseListOptions)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown,constraint:args=>(function(params){let constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)})(args.params),writer:_args=>writePrimitive},controller(args){var _a;let doc=args.document,value=args.value,c=args.constraint;return c&&findConstraint(c,ListConstraint)?new ListController(doc,{props:ValueMap.fromObject({options:null!==(_a=findListItems(c))&&void 0!==_a?_a:[]}),value:value,viewProps:args.viewProps}):new CheckboxController(doc,{value:value,viewProps:args.viewProps})}},className$c=ClassName("col");class ColorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$c()),config.foldable.bindExpandedClass(this.element,className$c(void 0,"expanded")),bindValueMap(config.foldable,"completed",valueToClassName(this.element,className$c(void 0,"cpl")));let headElem=doc.createElement("div");headElem.classList.add(className$c("h")),this.element.appendChild(headElem);let swatchElem=doc.createElement("div");swatchElem.classList.add(className$c("s")),headElem.appendChild(swatchElem),this.swatchElement=swatchElem;let textElem=doc.createElement("div");if(textElem.classList.add(className$c("t")),headElem.appendChild(textElem),this.textElement=textElem,"inline"===config.pickerLayout){let pickerElem=doc.createElement("div");pickerElem.classList.add(className$c("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}function hsvToRgbInt(h,s,v){let rp,gp,bp;let hp=(h%360+360)%360,sp=constrainRange(s/100,0,1),vp=constrainRange(v/100,0,1),c=vp*sp,x=c*(1-Math.abs(hp/60%2-1)),m=vp-c;return hp>=0&&hp<60?[rp,gp,bp]=[c,x,0]:hp>=60&&hp<120?[rp,gp,bp]=[x,c,0]:hp>=120&&hp<180?[rp,gp,bp]=[0,c,x]:hp>=180&&hp<240?[rp,gp,bp]=[0,x,c]:hp>=240&&hp<300?[rp,gp,bp]=[x,0,c]:[rp,gp,bp]=[c,0,x],[(rp+m)*255,(gp+m)*255,(bp+m)*255]}function removeAlphaComponent(comps){return[comps[0],comps[1],comps[2]]}function appendAlphaComponent(comps,alpha){return[comps[0],comps[1],comps[2],alpha]}let MODE_CONVERTER_MAP={hsl:{hsl:(h,s,l)=>[h,s,l],hsv:function(h,s,l){let sd=l+s*(100-Math.abs(2*l-100))/200;return[h,0!==sd?s*(100-Math.abs(2*l-100))/sd:0,l+s*(100-Math.abs(2*l-100))/200]},rgb:function(h,s,l){let rp,gp,bp;let hp=(h%360+360)%360,sp=constrainRange(s/100,0,1),lp=constrainRange(l/100,0,1),c=(1-Math.abs(2*lp-1))*sp,x=c*(1-Math.abs(hp/60%2-1)),m=lp-c/2;return hp>=0&&hp<60?[rp,gp,bp]=[c,x,0]:hp>=60&&hp<120?[rp,gp,bp]=[x,c,0]:hp>=120&&hp<180?[rp,gp,bp]=[0,c,x]:hp>=180&&hp<240?[rp,gp,bp]=[0,x,c]:hp>=240&&hp<300?[rp,gp,bp]=[x,0,c]:[rp,gp,bp]=[c,0,x],[(rp+m)*255,(gp+m)*255,(bp+m)*255]}},hsv:{hsl:function(h,s,v){let sd=100-Math.abs(v*(200-s)/100-100);return[h,0!==sd?s*v/sd:0,v*(200-s)/200]},hsv:(h,s,v)=>[h,s,v],rgb:hsvToRgbInt},rgb:{hsl:function(r,g,b){let rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),cmin=Math.min(rp,gp,bp),c=cmax-cmin,h=0,s=0;return 0!==c&&(s=c/(1-Math.abs(cmax+cmin-1)),h=(h=rp===cmax?(gp-bp)/c:gp===cmax?2+(bp-rp)/c:4+(rp-gp)/c)/6+(h<0?1:0)),[360*h,100*s,100*((cmin+cmax)/2)]},hsv:function(r,g,b){let rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),d=cmax-Math.min(rp,gp,bp);return[0===d?0:cmax===rp?60*(((gp-bp)/d%6+6)%6):cmax===gp?60*((bp-rp)/d+2):60*((rp-gp)/d+4),100*(0===cmax?0:d/cmax),100*cmax]},rgb:(r,g,b)=>[r,g,b]}};function getColorMaxComponents(mode,type){return["float"===type?1:"rgb"===mode?255:360,"float"===type?1:"rgb"===mode?255:100,"float"===type?1:"rgb"===mode?255:100]}function convertColorType(comps,mode,from,to){let fms=getColorMaxComponents(mode,from),tms=getColorMaxComponents(mode,to);return comps.map((c,index)=>c/fms[index]*tms[index])}function isRgbColorComponent(obj,key){return!("object"!=typeof obj||isEmpty(obj))&&key in obj&&"number"==typeof obj[key]}class Color{constructor(comps,mode,type="int"){this.mode=mode,this.type=type,this.comps_=function(components,mode,type){var _a,max;let ms=getColorMaxComponents(mode,type);return["rgb"===mode?constrainRange(components[0],0,ms[0]):(components[0]%(max=ms[0])+max)%max,constrainRange(components[1],0,ms[1]),constrainRange(components[2],0,ms[2]),constrainRange(null!==(_a=components[3])&&void 0!==_a?_a:1,0,1)]}(comps,mode,type)}static black(type="int"){return new Color([0,0,0],"rgb",type)}static fromObject(obj,type="int"){let comps="a"in obj?[obj.r,obj.g,obj.b,obj.a]:[obj.r,obj.g,obj.b];return new Color(comps,"rgb",type)}static toRgbaObject(color,type="int"){return color.toRgbaObject(type)}static isRgbColorObject(obj){return isRgbColorComponent(obj,"r")&&isRgbColorComponent(obj,"g")&&isRgbColorComponent(obj,"b")}static isRgbaColorObject(obj){return this.isRgbColorObject(obj)&&isRgbColorComponent(obj,"a")}static isColorObject(obj){return this.isRgbColorObject(obj)}static equals(v1,v2){if(v1.mode!==v2.mode)return!1;let comps1=v1.comps_,comps2=v2.comps_;for(let i=0;i<comps1.length;i++)if(comps1[i]!==comps2[i])return!1;return!0}getComponents(opt_mode,type="int"){return appendAlphaComponent(function(components,from,to){let intComps=convertColorType(components,from.mode,from.type,"int"),result=MODE_CONVERTER_MAP[from.mode][to.mode](...intComps);return convertColorType(result,to.mode,"int",to.type)}(removeAlphaComponent(this.comps_),{mode:this.mode,type:this.type},{mode:null!=opt_mode?opt_mode:this.mode,type}),this.comps_[3])}toRgbaObject(type="int"){let rgbComps=this.getComponents("rgb",type);return{r:rgbComps[0],g:rgbComps[1],b:rgbComps[2],a:rgbComps[3]}}}let className$b=ClassName("colp");class ColorPickerView{constructor(doc,config){this.alphaViews_=null,this.element=doc.createElement("div"),this.element.classList.add(className$b());let hsvElem=doc.createElement("div");hsvElem.classList.add(className$b("hsv"));let svElem=doc.createElement("div");svElem.classList.add(className$b("sv")),this.svPaletteView_=config.svPaletteView,svElem.appendChild(this.svPaletteView_.element),hsvElem.appendChild(svElem);let hElem=doc.createElement("div");hElem.classList.add(className$b("h")),this.hPaletteView_=config.hPaletteView,hElem.appendChild(this.hPaletteView_.element),hsvElem.appendChild(hElem),this.element.appendChild(hsvElem);let rgbElem=doc.createElement("div");if(rgbElem.classList.add(className$b("rgb")),this.textView_=config.textView,rgbElem.appendChild(this.textView_.element),this.element.appendChild(rgbElem),config.alphaViews){this.alphaViews_={palette:config.alphaViews.palette,text:config.alphaViews.text};let aElem=doc.createElement("div");aElem.classList.add(className$b("a"));let apElem=doc.createElement("div");apElem.classList.add(className$b("ap")),apElem.appendChild(this.alphaViews_.palette.element),aElem.appendChild(apElem);let atElem=doc.createElement("div");atElem.classList.add(className$b("at")),atElem.appendChild(this.alphaViews_.text.element),aElem.appendChild(atElem),this.element.appendChild(aElem)}}get allFocusableElements(){let elems=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(v=>v.inputElement)];return this.alphaViews_&&elems.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),elems}}function parseColorType(value){return"int"===value?"int":"float"===value?"float":void 0}function parseColorInputParams(params){return parseParams(params,{alpha:ParamsParsers.optional.boolean,color:ParamsParsers.optional.object({alpha:ParamsParsers.optional.boolean,type:ParamsParsers.optional.custom(parseColorType)}),expanded:ParamsParsers.optional.boolean,picker:ParamsParsers.optional.custom(parsePickerLayout)})}function getBaseStepForColor(forAlpha){return forAlpha?.1:1}function extractColorType(params){var _a;return null===(_a=params.color)||void 0===_a?void 0:_a.type}function parseCssNumberOrPercentage(text,maxValue){let m=text.match(/^(.+)%$/);return m?Math.min(.01*parseFloat(m[1])*maxValue,maxValue):Math.min(parseFloat(text),maxValue)}let ANGLE_TO_DEG_MAP={deg:angle=>angle,grad:angle=>360*angle/400,rad:angle=>360*angle/(2*Math.PI),turn:angle=>360*angle};function parseCssNumberOrAngle(text){let m=text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!m)return parseFloat(text);let angle=parseFloat(m[1]),unit=m[2];return ANGLE_TO_DEG_MAP[unit](angle)}function parseFunctionalRgbColorComponents(text){let m=text.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function createFunctionalRgbColorParser(type){return text=>{let comps=parseFunctionalRgbColorComponents(text);return comps?new Color(comps,"rgb",type):null}}function parseFunctionalRgbaColorComponents(text){let m=text.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function createFunctionalRgbaColorParser(type){return text=>{let comps=parseFunctionalRgbaColorComponents(text);return comps?new Color(comps,"rgb",type):null}}function parseHslColorComponents(text){let m=text.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function createHslColorParser(type){return text=>{let comps=parseHslColorComponents(text);return comps?new Color(comps,"hsl",type):null}}function parseHslaColorComponents(text){let m=text.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function createHslaColorParser(type){return text=>{let comps=parseHslaColorComponents(text);return comps?new Color(comps,"hsl",type):null}}function parseHexRgbColorComponents(text){let mRgb=text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return[parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16)];let mRrggbb=text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?[parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16)]:null}function parseHexRgbaColorComponents(text){let mRgb=text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return[parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16),mapRange(parseInt(mRgb[4]+mRgb[4],16),0,255,0,1)];let mRrggbb=text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?[parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16),mapRange(parseInt(mRrggbb[4],16),0,255,0,1)]:null}function parseObjectRgbColorComponents(text){let m=text.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!m)return null;let comps=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function createObjectRgbColorParser(type){return text=>{let comps=parseObjectRgbColorComponents(text);return comps?new Color(comps,"rgb",type):null}}function parseObjectRgbaColorComponents(text){let m=text.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!m)return null;let comps=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]),parseFloat(m[4])];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function createObjectRgbaColorParser(type){return text=>{let comps=parseObjectRgbaColorComponents(text);return comps?new Color(comps,"rgb",type):null}}let PARSER_AND_RESULT=[{parser:parseHexRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:parseHexRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:parseFunctionalRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:parseFunctionalRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:parseHslColorComponents,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:parseHslaColorComponents,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:parseObjectRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:parseObjectRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"object"}}];function detectStringColorFormat(text,type="int"){let r=PARSER_AND_RESULT.reduce((prev,{parser,result:detection})=>prev||(parser(text)?detection:null),null);return r?"hex"===r.notation&&"float"!==type?Object.assign(Object.assign({},r),{type:"int"}):"func"===r.notation?Object.assign(Object.assign({},r),{type:type}):null:null}let TYPE_TO_PARSERS={int:[function(text){let comps=parseHexRgbColorComponents(text);return comps?new Color(comps,"rgb","int"):null},function(text){let comps=parseHexRgbaColorComponents(text);return comps?new Color(comps,"rgb","int"):null},createFunctionalRgbColorParser("int"),createFunctionalRgbaColorParser("int"),createHslColorParser("int"),createHslaColorParser("int"),createObjectRgbColorParser("int"),createObjectRgbaColorParser("int")],float:[createFunctionalRgbColorParser("float"),createFunctionalRgbaColorParser("float"),createHslColorParser("float"),createHslaColorParser("float"),createObjectRgbColorParser("float"),createObjectRgbaColorParser("float")]};function createColorStringParser(type){let parsers=TYPE_TO_PARSERS[type];return value=>parsers.reduce((prev,parser)=>prev||parser(value),null)}function zerofill(comp){let hex=constrainRange(Math.floor(comp),0,255).toString(16);return 1===hex.length?`0${hex}`:hex}function colorToHexRgbString(value,prefix="#"){let hexes=removeAlphaComponent(value.getComponents("rgb")).map(zerofill).join("");return`${prefix}${hexes}`}function colorToHexRgbaString(value,prefix="#"){let rgbaComps=value.getComponents("rgb"),hexes=[rgbaComps[0],rgbaComps[1],rgbaComps[2],255*rgbaComps[3]].map(zerofill).join("");return`${prefix}${hexes}`}function colorToFunctionalRgbString(value,opt_type){let formatter=createNumberFormatter("float"===opt_type?2:0),comps=removeAlphaComponent(value.getComponents("rgb",opt_type)).map(comp=>formatter(comp));return`rgb(${comps.join(", ")})`}function colorToFunctionalRgbaString(value,opt_type){let aFormatter=createNumberFormatter(2),rgbFormatter=createNumberFormatter("float"===opt_type?2:0),comps=value.getComponents("rgb",opt_type).map((comp,index)=>(3===index?aFormatter:rgbFormatter)(comp));return`rgba(${comps.join(", ")})`}function colorToObjectRgbString(value,type){let formatter=createNumberFormatter("float"===type?2:0),names=["r","g","b"],comps=removeAlphaComponent(value.getComponents("rgb",type)).map((comp,index)=>`${names[index]}: ${formatter(comp)}`);return`{${comps.join(", ")}}`}function colorToObjectRgbaString(value,type){let aFormatter=createNumberFormatter(2),rgbFormatter=createNumberFormatter("float"===type?2:0),names=["r","g","b","a"],comps=value.getComponents("rgb",type).map((comp,index)=>`${names[index]}: ${(3===index?aFormatter:rgbFormatter)(comp)}`);return`{${comps.join(", ")}}`}let FORMAT_AND_STRINGIFIERS=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:colorToHexRgbString},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:colorToHexRgbaString},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(value){let formatters=[createNumberFormatter(0),formatPercentage,formatPercentage],comps=removeAlphaComponent(value.getComponents("hsl")).map((comp,index)=>formatters[index](comp));return`hsl(${comps.join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(value){let formatters=[createNumberFormatter(0),formatPercentage,formatPercentage,createNumberFormatter(2)],comps=value.getComponents("hsl").map((comp,index)=>formatters[index](comp));return`hsla(${comps.join(", ")})`}},...["int","float"].reduce((prev,type)=>[...prev,{format:{alpha:!1,mode:"rgb",notation:"func",type:type},stringifier:value=>colorToFunctionalRgbString(value,type)},{format:{alpha:!0,mode:"rgb",notation:"func",type:type},stringifier:value=>colorToFunctionalRgbaString(value,type)},{format:{alpha:!1,mode:"rgb",notation:"object",type:type},stringifier:value=>colorToObjectRgbString(value,type)},{format:{alpha:!0,mode:"rgb",notation:"object",type:type},stringifier:value=>colorToObjectRgbaString(value,type)}],[])];function findColorStringifier(format){return FORMAT_AND_STRINGIFIERS.reduce((prev,fas)=>{var f1;return prev||((f1=fas.format).alpha===format.alpha&&f1.mode===format.mode&&f1.notation===format.notation&&f1.type===format.type?fas.stringifier:null)},null)}let className$a=ClassName("apl");class APaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$a()),config.viewProps.bindTabIndex(this.element);let barElem=doc.createElement("div");barElem.classList.add(className$a("b")),this.element.appendChild(barElem);let colorElem=doc.createElement("div");colorElem.classList.add(className$a("c")),barElem.appendChild(colorElem),this.colorElem_=colorElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$a("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem;let previewElem=doc.createElement("div");previewElem.classList.add(className$a("p")),this.markerElem_.appendChild(previewElem),this.previewElem_=previewElem,this.update_()}update_(){let c=this.value.rawValue,rgbaComps=c.getComponents("rgb"),leftColor=new Color([rgbaComps[0],rgbaComps[1],rgbaComps[2],0],"rgb"),rightColor=new Color([rgbaComps[0],rgbaComps[1],rgbaComps[2],255],"rgb"),gradientComps=["to right",colorToFunctionalRgbaString(leftColor),colorToFunctionalRgbaString(rightColor)];this.colorElem_.style.background=`linear-gradient(${gradientComps.join(",")})`,this.previewElem_.style.backgroundColor=colorToFunctionalRgbaString(c);let left=mapRange(rgbaComps[3],0,1,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class APaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new APaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let alpha=d.point.x/d.bounds.width,c=this.value.rawValue,[h,s,v]=c.getComponents("hsv");this.value.setRawValue(new Color([h,s,v,alpha],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step=getStepForKey(getBaseStepForColor(!0),getHorizontalStepKeys(ev));if(0===step)return;let c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([h,s,v,a+step],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){let step=getStepForKey(getBaseStepForColor(!0),getHorizontalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$9=ClassName("coltxt");class ColorTextView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$9());let modeElem=doc.createElement("div");modeElem.classList.add(className$9("m")),this.modeElem_=function(doc){let selectElem=doc.createElement("select");return selectElem.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((frag,item)=>{let optElem=doc.createElement("option");return optElem.textContent=item.text,optElem.value=item.value,frag.appendChild(optElem),frag},doc.createDocumentFragment())),selectElem}(doc),this.modeElem_.classList.add(className$9("ms")),modeElem.appendChild(this.modeSelectElement);let modeMarkerElem=doc.createElement("div");modeMarkerElem.classList.add(className$9("mm")),modeMarkerElem.appendChild(createSvgIconElement(doc,"dropdown")),modeElem.appendChild(modeMarkerElem),this.element.appendChild(modeElem);let textsElem=doc.createElement("div");textsElem.classList.add(className$9("w")),this.element.appendChild(textsElem),this.textsElem_=textsElem,this.textViews_=config.textViews,this.applyTextViews_(),bindValue(config.colorMode,mode=>{this.modeElem_.value=mode})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(textViews){this.textViews_=textViews,this.applyTextViews_()}applyTextViews_(){removeChildElements(this.textsElem_);let doc=this.element.ownerDocument;this.textViews_.forEach(v=>{let compElem=doc.createElement("div");compElem.classList.add(className$9("c")),compElem.appendChild(v.element),this.textsElem_.appendChild(compElem)})}}function createComponentController(doc,config,index){return new NumberTextController(doc,{arrayPosition:0===index?"fst":2===index?"lst":"mid",baseStep:getBaseStepForColor(!1),parser:config.parser,props:ValueMap.fromObject({draggingScale:"float"===config.colorType?.01:1,formatter:createNumberFormatter("float"===config.colorType?2:0)}),value:createValue(0,{constraint:function(mode,type,index){let max=getColorMaxComponents(mode,type)[index];return new RangeConstraint({min:0,max:max})}(config.colorMode,config.colorType,index)}),viewProps:config.viewProps})}class ColorTextController{constructor(doc,config){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=config.colorType,this.parser_=config.parser,this.value=config.value,this.viewProps=config.viewProps,this.colorMode=createValue(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(doc),this.view=new ColorTextView(doc,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(doc){let cc={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},ccs=[createComponentController(doc,cc,0),createComponentController(doc,cc,1),createComponentController(doc,cc,2)];return ccs.forEach((cs,index)=>{connectValues({primary:this.value,secondary:cs.value,forward:p=>p.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[index],backward:(p,s)=>{let pickedMode=this.colorMode.rawValue,comps=p.rawValue.getComponents(pickedMode,this.colorType_);return comps[index]=s.rawValue,new Color(appendAlphaComponent(removeAlphaComponent(comps),comps[3]),pickedMode,this.colorType_)}})}),ccs}onModeSelectChange_(ev){let selectElem=ev.currentTarget;this.colorMode.rawValue=selectElem.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}let className$8=ClassName("hpl");class HPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$8()),config.viewProps.bindTabIndex(this.element);let colorElem=doc.createElement("div");colorElem.classList.add(className$8("c")),this.element.appendChild(colorElem);let markerElem=doc.createElement("div");markerElem.classList.add(className$8("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){let c=this.value.rawValue,[h]=c.getComponents("hsv");this.markerElem_.style.backgroundColor=colorToFunctionalRgbString(new Color([h,100,100],"hsv"));let left=mapRange(h,0,360,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class HPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new HPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let hue=mapRange(constrainRange(d.point.x,0,d.bounds.width),0,d.bounds.width,0,359),c=this.value.rawValue,[,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([hue,s,v,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step=getStepForKey(getBaseStepForColor(!1),getHorizontalStepKeys(ev));if(0===step)return;let c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([h+step,s,v,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){let step=getStepForKey(getBaseStepForColor(!1),getHorizontalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$7=ClassName("svp");class SvPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$7()),config.viewProps.bindTabIndex(this.element);let canvasElem=doc.createElement("canvas");canvasElem.height=64,canvasElem.width=64,canvasElem.classList.add(className$7("c")),this.element.appendChild(canvasElem),this.canvasElement=canvasElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$7("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){let ctx=function(canvasElement){let win=canvasElement.ownerDocument.defaultView;return win&&"document"in win?canvasElement.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!ctx)return;let c=this.value.rawValue,hsvComps=c.getComponents("hsv"),width=this.canvasElement.width,height=this.canvasElement.height,imgData=ctx.getImageData(0,0,width,height),data=imgData.data;for(let iy=0;iy<height;iy++)for(let ix=0;ix<width;ix++){let s=mapRange(ix,0,width,0,100),v=mapRange(iy,0,height,100,0),rgbComps=hsvToRgbInt(hsvComps[0],s,v),i=(iy*width+ix)*4;data[i]=rgbComps[0],data[i+1]=rgbComps[1],data[i+2]=rgbComps[2],data[i+3]=255}ctx.putImageData(imgData,0,0);let left=mapRange(hsvComps[1],0,100,0,100);this.markerElem_.style.left=`${left}%`;let top=mapRange(hsvComps[2],0,100,100,0);this.markerElem_.style.top=`${top}%`}onValueChange_(){this.update_()}}class SvPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new SvPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let saturation=mapRange(d.point.x,0,d.bounds.width,0,100),value=mapRange(d.point.y,0,d.bounds.height,100,0),[h,,,a]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Color([h,saturation,value,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();let[h,s,v,a]=this.value.rawValue.getComponents("hsv"),baseStep=getBaseStepForColor(!1),ds=getStepForKey(baseStep,getHorizontalStepKeys(ev)),dv=getStepForKey(baseStep,getVerticalStepKeys(ev));(0!==ds||0!==dv)&&this.value.setRawValue(new Color([h,s+ds,v+dv,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){let baseStep=getBaseStepForColor(!1),ds=getStepForKey(baseStep,getHorizontalStepKeys(ev)),dv=getStepForKey(baseStep,getVerticalStepKeys(ev));(0!==ds||0!==dv)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ColorPickerController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.hPaletteC_=new HPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new SvPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=config.supportsAlpha?{palette:new APaletteController(doc,{value:this.value,viewProps:this.viewProps}),text:new NumberTextController(doc,{parser:parseNumber,baseStep:.1,props:ValueMap.fromObject({draggingScale:.01,formatter:createNumberFormatter(2)}),value:createValue(0,{constraint:new RangeConstraint({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&connectValues({primary:this.value,secondary:this.alphaIcs_.text.value,forward:p=>p.rawValue.getComponents()[3],backward(p,s){let comps=p.rawValue.getComponents();return comps[3]=s.rawValue,new Color(comps,p.rawValue.mode)}}),this.textC_=new ColorTextController(doc,{colorType:config.colorType,parser:parseNumber,value:this.value,viewProps:this.viewProps}),this.view=new ColorPickerView(doc,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:config.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}let className$6=ClassName("colsw");class ColorSwatchView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.element=doc.createElement("div"),this.element.classList.add(className$6()),config.viewProps.bindClassModifiers(this.element);let swatchElem=doc.createElement("div");swatchElem.classList.add(className$6("sw")),this.element.appendChild(swatchElem),this.swatchElem_=swatchElem;let buttonElem=doc.createElement("button");buttonElem.classList.add(className$6("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem,this.update_()}update_(){let value=this.value.rawValue;this.swatchElem_.style.backgroundColor=colorToHexRgbaString(value)}onValueChange_(){this.update_()}}class ColorSwatchController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new ColorSwatchView(doc,{value:this.value,viewProps:this.viewProps})}}class ColorController{constructor(doc,config){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.swatchC_=new ColorSwatchController(doc,{value:this.value,viewProps:this.viewProps});let buttonElem=this.swatchC_.view.buttonElement;buttonElem.addEventListener("blur",this.onButtonBlur_),buttonElem.addEventListener("click",this.onButtonClick_),this.textC_=new TextController(doc,{parser:config.parser,props:ValueMap.fromObject({formatter:config.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ColorView(doc,{foldable:this.foldable_,pickerLayout:config.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===config.pickerLayout?new PopupController(doc,{viewProps:this.viewProps}):null;let pickerC=new ColorPickerController(doc,{colorType:config.colorType,supportsAlpha:config.supportsAlpha,value:this.value,viewProps:this.viewProps});pickerC.view.allFocusableElements.forEach(elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=pickerC,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(pickerC.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p.rawValue,backward:(_,s)=>s.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;let elem=this.view.element,nextTarget=e.relatedTarget;nextTarget&&elem.contains(nextTarget)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;let elem=this.popC_.view.element,nextTarget=findNextTarget(ev);!(nextTarget&&elem.contains(nextTarget))&&(!nextTarget||nextTarget!==this.swatchC_.view.buttonElement||supportsTouch(elem.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?"Escape"===ev.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===ev.key&&this.swatchC_.view.buttonElement.focus()}}function colorToRgbNumber(value){return removeAlphaComponent(value.getComponents("rgb")).reduce((result,comp)=>result<<8|255&Math.floor(comp),0)}function colorToRgbaNumber(value){return value.getComponents("rgb").reduce((result,comp,index)=>result<<8|255&Math.floor(3===index?255*comp:comp),0)>>>0}function colorFromRgbNumber(value){return"number"!=typeof value?Color.black():new Color([value>>16&255,value>>8&255,255&value],"rgb")}function colorFromRgbaNumber(value){return"number"!=typeof value?Color.black():new Color([value>>24&255,value>>16&255,value>>8&255,mapRange(255&value,0,255,0,1)],"rgb")}function shouldSupportAlpha$1(inputParams){var _a;return null!=inputParams&&!!inputParams.alpha||null!==(_a=null==inputParams?void 0:inputParams.color)&&void 0!==_a&&!!_a.alpha}let NumberColorInputPlugin={id:"input-color-number",type:"input",accept(value,params){if("number"!=typeof value||!("color"in params||"view"in params&&"color"===params.view))return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader:args=>shouldSupportAlpha$1(args.params)?colorFromRgbaNumber:colorFromRgbNumber,equals:Color.equals,writer:args=>(function(supportsAlpha){let colorToNumber=supportsAlpha?colorToRgbaNumber:colorToRgbNumber;return(target,value)=>{writePrimitive(target,colorToNumber(value))}})(shouldSupportAlpha$1(args.params))},controller(args){let supportsAlpha=shouldSupportAlpha$1(args.params),expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new ColorController(args.document,{colorType:"int",expanded:null!=expanded&&expanded,formatter:supportsAlpha?v=>colorToHexRgbaString(v,"0x"):v=>colorToHexRgbString(v,"0x"),parser:createColorStringParser("int"),pickerLayout:null!=picker?picker:"popup",supportsAlpha:supportsAlpha,value:args.value,viewProps:args.viewProps})}},ObjectColorInputPlugin={id:"input-color-object",type:"input",accept(value,params){if(!Color.isColorObject(value))return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader(args){var opt_type;return opt_type=extractColorType(args.params),value=>Color.isColorObject(value)?Color.fromObject(value,opt_type):Color.black(opt_type)},equals:Color.equals,writer(args){var initialValue,supportsAlpha,opt_type;return initialValue=args.initialValue,supportsAlpha=Color.isRgbaColorObject(initialValue),opt_type=extractColorType(args.params),(target,inValue)=>{supportsAlpha?function(target,value,opt_type){let obj=value.toRgbaObject(opt_type);target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b),target.writeProperty("a",obj.a)}(target,inValue,opt_type):function(target,value,opt_type){let obj=value.toRgbaObject(opt_type);target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b)}(target,inValue,opt_type)}}},controller(args){var _a;let supportsAlpha=Color.isRgbaColorObject(args.initialValue),expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0,type=null!==(_a=extractColorType(args.params))&&void 0!==_a?_a:"int";return new ColorController(args.document,{colorType:type,expanded:null!=expanded&&expanded,formatter:value=>supportsAlpha?colorToObjectRgbaString(value,type):colorToObjectRgbString(value,type),parser:createColorStringParser(type),pickerLayout:null!=picker?picker:"popup",supportsAlpha:supportsAlpha,value:args.value,viewProps:args.viewProps})}},StringColorInputPlugin={id:"input-color-string",type:"input",accept(value,params){if("string"!=typeof value||"view"in params&&"text"===params.view)return null;let format=detectStringColorFormat(value,extractColorType(params));if(!format)return null;let stringifier=findColorStringifier(format);if(!stringifier)return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader(args){var _a;return function(type){let parsers=TYPE_TO_PARSERS[type];return value=>{if("string"!=typeof value)return Color.black(type);let result=parsers.reduce((prev,parser)=>prev||parser(value),null);return null!=result?result:Color.black(type)}}(null!==(_a=extractColorType(args.params))&&void 0!==_a?_a:"int")},equals:Color.equals,writer(args){let format=detectStringColorFormat(args.initialValue,extractColorType(args.params));if(!format)throw TpError.shouldNeverHappen();let writer=function(format){let stringify=findColorStringifier(format);return stringify?(target,value)=>{writePrimitive(target,stringify(value))}:null}(format);if(!writer)throw TpError.notBindable();return writer}},controller(args){let format=detectStringColorFormat(args.initialValue,extractColorType(args.params));if(!format)throw TpError.shouldNeverHappen();let stringifier=findColorStringifier(format);if(!stringifier)throw TpError.shouldNeverHappen();let expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new ColorController(args.document,{colorType:format.type,expanded:null!=expanded&&expanded,formatter:stringifier,parser:createColorStringParser(format.type),pickerLayout:null!=picker?picker:"popup",supportsAlpha:format.alpha,value:args.value,viewProps:args.viewProps})}};class PointNdConstraint{constructor(config){this.components=config.components,this.asm_=config.assembly}constrain(value){let comps=this.asm_.toComponents(value).map((comp,index)=>{var _a,_b;return null!==(_b=null===(_a=this.components[index])||void 0===_a?void 0:_a.constrain(comp))&&void 0!==_b?_b:comp});return this.asm_.fromComponents(comps)}}let className$5=ClassName("pndtxt");class PointNdTextView{constructor(doc,config){this.textViews=config.textViews,this.element=doc.createElement("div"),this.element.classList.add(className$5()),this.textViews.forEach(v=>{let axisElem=doc.createElement("div");axisElem.classList.add(className$5("a")),axisElem.appendChild(v.element),this.element.appendChild(axisElem)})}}class PointNdTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.acs_=config.axes.map((_,index)=>new NumberTextController(doc,{arrayPosition:0===index?"fst":index===config.axes.length-1?"lst":"mid",baseStep:config.axes[index].baseStep,parser:config.parser,props:config.axes[index].textProps,value:createValue(0,{constraint:config.axes[index].constraint}),viewProps:config.viewProps})),this.acs_.forEach((c,index)=>{connectValues({primary:this.value,secondary:c.value,forward:p=>config.assembly.toComponents(p.rawValue)[index],backward(p,s){let comps=config.assembly.toComponents(p.rawValue);return comps[index]=s.rawValue,config.assembly.fromComponents(comps)}})}),this.view=new PointNdTextView(doc,{textViews:this.acs_.map(ac=>ac.view)})}}function createStepConstraint(params,initialValue){return"step"in params&&!isEmpty(params.step)?new StepConstraint(params.step,initialValue):null}function createRangeConstraint(params){return"max"in params&&!isEmpty(params.max)||"min"in params&&!isEmpty(params.min)?new RangeConstraint({max:params.max,min:params.min}):null}let NumberInputPlugin={id:"input-number",type:"input",accept(value,params){if("number"!=typeof value)return null;let result=parseParams(params,{format:ParamsParsers.optional.function,max:ParamsParsers.optional.number,min:ParamsParsers.optional.number,options:ParamsParsers.optional.custom(parseListOptions),step:ParamsParsers.optional.number});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>numberFromUnknown,constraint:args=>(function(params,initialValue){let constraints=[],sc=createStepConstraint(params,initialValue);sc&&constraints.push(sc);let rc=createRangeConstraint(params);rc&&constraints.push(rc);let lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)})(args.params,args.initialValue),writer:_args=>writePrimitive},controller(args){var _a,_b;let value=args.value,c=args.constraint;if(c&&findConstraint(c,ListConstraint))return new ListController(args.document,{props:ValueMap.fromObject({options:null!==(_a=findListItems(c))&&void 0!==_a?_a:[]}),value:value,viewProps:args.viewProps});let formatter=null!==(_b="format"in args.params?args.params.format:void 0)&&void 0!==_b?_b:createNumberFormatter(getSuitableDecimalDigits(c,value.rawValue));if(c&&findConstraint(c,RangeConstraint)){let[min,max]=function(constraint){let[min,max]=function(constraint){let c=constraint?findConstraint(constraint,RangeConstraint):null;return c?[c.minValue,c.maxValue]:[void 0,void 0]}(constraint);return[null!=min?min:0,null!=max?max:100]}(c);return new SliderTextController(args.document,{baseStep:getBaseStep(c),parser:parseNumber,sliderProps:ValueMap.fromObject({maxValue:max,minValue:min}),textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(c,value.rawValue),formatter:formatter}),value:value,viewProps:args.viewProps})}return new NumberTextController(args.document,{baseStep:getBaseStep(c),parser:parseNumber,props:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(c,value.rawValue),formatter:formatter}),value:value,viewProps:args.viewProps})}};class Point2d{constructor(x=0,y=0){this.x=x,this.y=y}getComponents(){return[this.x,this.y]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y;return"number"==typeof x&&"number"==typeof y}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y}toObject(){return{x:this.x,y:this.y}}}let Point2dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point2d(...comps)},className$4=ClassName("p2d");class Point2dView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$4()),config.viewProps.bindClassModifiers(this.element),bindValue(config.expanded,valueToClassName(this.element,className$4(void 0,"expanded")));let headElem=doc.createElement("div");headElem.classList.add(className$4("h")),this.element.appendChild(headElem);let buttonElem=doc.createElement("button");buttonElem.classList.add(className$4("b")),buttonElem.appendChild(createSvgIconElement(doc,"p2dpad")),config.viewProps.bindDisabled(buttonElem),headElem.appendChild(buttonElem),this.buttonElement=buttonElem;let textElem=doc.createElement("div");if(textElem.classList.add(className$4("t")),headElem.appendChild(textElem),this.textElement=textElem,"inline"===config.pickerLayout){let pickerElem=doc.createElement("div");pickerElem.classList.add(className$4("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}let className$3=ClassName("p2dp");class Point2dPickerView{constructor(doc,config){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=config.invertsY,this.maxValue_=config.maxValue,this.element=doc.createElement("div"),this.element.classList.add(className$3()),"popup"===config.layout&&this.element.classList.add(className$3(void 0,"p"));let padElem=doc.createElement("div");padElem.classList.add(className$3("p")),config.viewProps.bindTabIndex(padElem),this.element.appendChild(padElem),this.padElement=padElem;let svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(className$3("g")),this.padElement.appendChild(svgElem),this.svgElem_=svgElem;let xAxisElem=doc.createElementNS(SVG_NS,"line");xAxisElem.classList.add(className$3("ax")),xAxisElem.setAttributeNS(null,"x1","0"),xAxisElem.setAttributeNS(null,"y1","50%"),xAxisElem.setAttributeNS(null,"x2","100%"),xAxisElem.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(xAxisElem);let yAxisElem=doc.createElementNS(SVG_NS,"line");yAxisElem.classList.add(className$3("ax")),yAxisElem.setAttributeNS(null,"x1","50%"),yAxisElem.setAttributeNS(null,"y1","0"),yAxisElem.setAttributeNS(null,"x2","50%"),yAxisElem.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(yAxisElem);let lineElem=doc.createElementNS(SVG_NS,"line");lineElem.classList.add(className$3("l")),lineElem.setAttributeNS(null,"x1","50%"),lineElem.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$3("m")),this.padElement.appendChild(markerElem),this.markerElem_=markerElem,config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[x,y]=this.value.rawValue.getComponents(),max=this.maxValue_,px=mapRange(x,-max,+max,0,100),py=mapRange(y,-max,+max,0,100),ipy=this.invertsY_?100-py:py;this.lineElem_.setAttributeNS(null,"x2",`${px}%`),this.lineElem_.setAttributeNS(null,"y2",`${ipy}%`),this.markerElem_.style.left=`${px}%`,this.markerElem_.style.top=`${ipy}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function computeOffset(ev,baseSteps,invertsY){return[getStepForKey(baseSteps[0],getHorizontalStepKeys(ev)),getStepForKey(baseSteps[1],getVerticalStepKeys(ev))*(invertsY?1:-1)]}class Point2dPickerController{constructor(doc,config){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.baseSteps_=config.baseSteps,this.maxValue_=config.maxValue,this.invertsY_=config.invertsY,this.view=new Point2dPickerView(doc,{invertsY:this.invertsY_,layout:config.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let max=this.maxValue_,px=mapRange(d.point.x,0,d.bounds.width,-max,+max),py=mapRange(this.invertsY_?d.bounds.height-d.point.y:d.point.y,0,d.bounds.height,-max,+max);this.value.setRawValue(new Point2d(px,py),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();let[dx,dy]=computeOffset(ev,this.baseSteps_,this.invertsY_);(0!==dx||0!==dy)&&this.value.setRawValue(new Point2d(this.value.rawValue.x+dx,this.value.rawValue.y+dy),{forceEmit:!1,last:!1})}onPadKeyUp_(ev){let[dx,dy]=computeOffset(ev,this.baseSteps_,this.invertsY_);(0!==dx||0!==dy)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Point2dController{constructor(doc,config){var _a,_b;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.popC_="popup"===config.pickerLayout?new PopupController(doc,{viewProps:this.viewProps}):null;let padC=new Point2dPickerController(doc,{baseSteps:[config.axes[0].baseStep,config.axes[1].baseStep],invertsY:config.invertsY,layout:config.pickerLayout,maxValue:config.maxValue,value:this.value,viewProps:this.viewProps});padC.view.allFocusableElements.forEach(elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=padC,this.textC_=new PointNdTextController(doc,{assembly:Point2dAssembly,axes:config.axes,parser:config.parser,value:this.value,viewProps:this.viewProps}),this.view=new Point2dView(doc,{expanded:this.foldable_.value("expanded"),pickerLayout:config.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(_a=this.view.buttonElement)||void 0===_a||_a.addEventListener("blur",this.onPadButtonBlur_),null===(_b=this.view.buttonElement)||void 0===_b||_b.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p.rawValue,backward:(_,s)=>s.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;let elem=this.view.element,nextTarget=e.relatedTarget;nextTarget&&elem.contains(nextTarget)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;let elem=this.popC_.view.element,nextTarget=findNextTarget(ev);!(nextTarget&&elem.contains(nextTarget))&&(!nextTarget||nextTarget!==this.view.buttonElement||supportsTouch(elem.ownerDocument))&&(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?"Escape"===ev.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===ev.key&&this.view.buttonElement.focus()}}function point2dFromUnknown(value){return Point2d.isObject(value)?new Point2d(value.x,value.y):new Point2d}function writePoint2d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y)}function createDimensionConstraint(params,initialValue){if(!params)return;let constraints=[],cs=createStepConstraint(params,initialValue);cs&&constraints.push(cs);let rs=createRangeConstraint(params);return rs&&constraints.push(rs),new CompositeConstraint(constraints)}function getSuitableMaxDimensionValue(constraint,rawValue){var _a,_b;let rc=constraint&&findConstraint(constraint,RangeConstraint);if(rc)return Math.max(Math.abs(null!==(_a=rc.minValue)&&void 0!==_a?_a:0),Math.abs(null!==(_b=rc.maxValue)&&void 0!==_b?_b:0));let step=getBaseStep(constraint);return Math.max(10*Math.abs(step),10*Math.abs(rawValue))}function createAxis$2(initialValue,constraint){return{baseStep:getBaseStep(constraint),constraint:constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,initialValue),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,initialValue))})}}let Point2dInputPlugin={id:"input-point2d",type:"input",accept(value,params){if(!Point2d.isObject(value))return null;let result=parseParams(params,{expanded:ParamsParsers.optional.boolean,picker:ParamsParsers.optional.custom(parsePickerLayout),x:ParamsParsers.optional.custom(parsePointDimensionParams),y:ParamsParsers.optional.object({inverted:ParamsParsers.optional.boolean,max:ParamsParsers.optional.number,min:ParamsParsers.optional.number,step:ParamsParsers.optional.number})});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point2dFromUnknown,constraint(args){var params,initialValue;return params=args.params,initialValue=args.initialValue,new PointNdConstraint({assembly:Point2dAssembly,components:[createDimensionConstraint("x"in params?params.x:void 0,initialValue.x),createDimensionConstraint("y"in params?params.y:void 0,initialValue.y)]})},equals:Point2d.equals,writer:_args=>writePoint2d},controller(args){let doc=args.document,value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();let expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new Point2dController(doc,{axes:[createAxis$2(value.rawValue.x,c.components[0]),createAxis$2(value.rawValue.y,c.components[1])],expanded:null!=expanded&&expanded,invertsY:function(params){if(!("y"in params))return!1;let yParams=params.y;return!!yParams&&"inverted"in yParams&&!!yParams.inverted}(args.params),maxValue:function(initialValue,constraint){let xc=constraint instanceof PointNdConstraint?constraint.components[0]:void 0,yc=constraint instanceof PointNdConstraint?constraint.components[1]:void 0,xr=getSuitableMaxDimensionValue(xc,initialValue.x),yr=getSuitableMaxDimensionValue(yc,initialValue.y);return Math.max(xr,yr)}(value.rawValue,c),parser:parseNumber,pickerLayout:null!=picker?picker:"popup",value:value,viewProps:args.viewProps})}};class Point3d{constructor(x=0,y=0,z=0){this.x=x,this.y=y,this.z=z}getComponents(){return[this.x,this.y,this.z]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y,z=obj.z;return"number"==typeof x&&"number"==typeof y&&"number"==typeof z}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}let Point3dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point3d(...comps)};function point3dFromUnknown(value){return Point3d.isObject(value)?new Point3d(value.x,value.y,value.z):new Point3d}function writePoint3d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z)}function createAxis$1(initialValue,constraint){return{baseStep:getBaseStep(constraint),constraint:constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,initialValue),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,initialValue))})}}let Point3dInputPlugin={id:"input-point3d",type:"input",accept(value,params){if(!Point3d.isObject(value))return null;let result=parseParams(params,{x:ParamsParsers.optional.custom(parsePointDimensionParams),y:ParamsParsers.optional.custom(parsePointDimensionParams),z:ParamsParsers.optional.custom(parsePointDimensionParams)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point3dFromUnknown,constraint(args){var params,initialValue;return params=args.params,initialValue=args.initialValue,new PointNdConstraint({assembly:Point3dAssembly,components:[createDimensionConstraint("x"in params?params.x:void 0,initialValue.x),createDimensionConstraint("y"in params?params.y:void 0,initialValue.y),createDimensionConstraint("z"in params?params.z:void 0,initialValue.z)]})},equals:Point3d.equals,writer:_args=>writePoint3d},controller(args){let value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();return new PointNdTextController(args.document,{assembly:Point3dAssembly,axes:[createAxis$1(value.rawValue.x,c.components[0]),createAxis$1(value.rawValue.y,c.components[1]),createAxis$1(value.rawValue.z,c.components[2])],parser:parseNumber,value:value,viewProps:args.viewProps})}};class Point4d{constructor(x=0,y=0,z=0,w=0){this.x=x,this.y=y,this.z=z,this.w=w}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y,z=obj.z,w=obj.w;return"number"==typeof x&&"number"==typeof y&&"number"==typeof z&&"number"==typeof w}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z&&v1.w===v2.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}let Point4dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point4d(...comps)};function point4dFromUnknown(value){return Point4d.isObject(value)?new Point4d(value.x,value.y,value.z,value.w):new Point4d}function writePoint4d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z),target.writeProperty("w",value.w)}let Point4dInputPlugin={id:"input-point4d",type:"input",accept(value,params){if(!Point4d.isObject(value))return null;let result=parseParams(params,{x:ParamsParsers.optional.custom(parsePointDimensionParams),y:ParamsParsers.optional.custom(parsePointDimensionParams),z:ParamsParsers.optional.custom(parsePointDimensionParams),w:ParamsParsers.optional.custom(parsePointDimensionParams)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point4dFromUnknown,constraint(args){var params,initialValue;return params=args.params,initialValue=args.initialValue,new PointNdConstraint({assembly:Point4dAssembly,components:[createDimensionConstraint("x"in params?params.x:void 0,initialValue.x),createDimensionConstraint("y"in params?params.y:void 0,initialValue.y),createDimensionConstraint("z"in params?params.z:void 0,initialValue.z),createDimensionConstraint("w"in params?params.w:void 0,initialValue.w)]})},equals:Point4d.equals,writer:_args=>writePoint4d},controller(args){let value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();return new PointNdTextController(args.document,{assembly:Point4dAssembly,axes:value.rawValue.getComponents().map((comp,index)=>{var constraint;return{baseStep:getBaseStep(constraint=c.components[index]),constraint:constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,comp),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,comp))})}}),parser:parseNumber,value:value,viewProps:args.viewProps})}},StringInputPlugin={id:"input-string",type:"input",accept(value,params){if("string"!=typeof value)return null;let result=parseParams(params,{options:ParamsParsers.optional.custom(parseListOptions)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown,constraint:args=>(function(params){let constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)})(args.params),writer:_args=>writePrimitive},controller(args){var _a;let doc=args.document,value=args.value,c=args.constraint;return c&&findConstraint(c,ListConstraint)?new ListController(doc,{props:ValueMap.fromObject({options:null!==(_a=findListItems(c))&&void 0!==_a?_a:[]}),value:value,viewProps:args.viewProps}):new TextController(doc,{parser:v=>v,props:ValueMap.fromObject({formatter:formatString}),value:value,viewProps:args.viewProps})}},Constants={monitor:{defaultInterval:200,defaultLineCount:3}},className$2=ClassName("mll");class MultiLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(className$2()),config.viewProps.bindClassModifiers(this.element);let textareaElem=doc.createElement("textarea");textareaElem.classList.add(className$2("i")),textareaElem.style.height=`calc(var(--bld-us) * ${config.lineCount})`,textareaElem.readOnly=!0,config.viewProps.bindDisabled(textareaElem),this.element.appendChild(textareaElem),this.textareaElem_=textareaElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){let elem=this.textareaElem_,shouldScroll=elem.scrollTop===elem.scrollHeight-elem.clientHeight,lines=[];this.value.rawValue.forEach(value=>{void 0!==value&&lines.push(this.formatter_(value))}),elem.textContent=lines.join("\n"),shouldScroll&&(elem.scrollTop=elem.scrollHeight)}onValueUpdate_(){this.update_()}}class MultiLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new MultiLogView(doc,{formatter:config.formatter,lineCount:config.lineCount,value:this.value,viewProps:this.viewProps})}}let className$1=ClassName("sgl");class SingleLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(className$1()),config.viewProps.bindClassModifiers(this.element);let inputElem=doc.createElement("input");inputElem.classList.add(className$1("i")),inputElem.readOnly=!0,inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){let values=this.value.rawValue,lastValue=values[values.length-1];this.inputElement.value=void 0!==lastValue?this.formatter_(lastValue):""}onValueUpdate_(){this.update_()}}class SingleLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new SingleLogView(doc,{formatter:config.formatter,value:this.value,viewProps:this.viewProps})}}let BooleanMonitorPlugin={id:"monitor-bool",type:"monitor",accept(value,params){if("boolean"!=typeof value)return null;let result=parseParams(params,{lineCount:ParamsParsers.optional.number});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown},controller(args){var _a;return 1===args.value.rawValue.length?new SingleLogController(args.document,{formatter:BooleanFormatter,value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:BooleanFormatter,lineCount:null!==(_a=args.params.lineCount)&&void 0!==_a?_a:Constants.monitor.defaultLineCount,value:args.value,viewProps:args.viewProps})}},className=ClassName("grl");class GraphLogView{constructor(doc,config){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className()),config.viewProps.bindClassModifiers(this.element),this.formatter_=config.formatter,this.props_=config.props,this.cursor_=config.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(className("g")),svgElem.style.height=`calc(var(--bld-us) * ${config.lineCount})`,this.element.appendChild(svgElem),this.svgElem_=svgElem;let lineElem=doc.createElementNS(SVG_NS,"polyline");this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;let tooltipElem=doc.createElement("div");tooltipElem.classList.add(className("t"),ClassName("tt")()),this.element.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let bounds=this.svgElem_.getBoundingClientRect(),maxIndex=this.value.rawValue.length-1,min=this.props_.get("minValue"),max=this.props_.get("maxValue"),points=[];this.value.rawValue.forEach((v,index)=>{if(void 0===v)return;let x=mapRange(index,0,maxIndex,0,bounds.width),y=mapRange(v,min,max,bounds.height,0);points.push([x,y].join(","))}),this.lineElem_.setAttributeNS(null,"points",points.join(" "));let tooltipElem=this.tooltipElem_,value=this.value.rawValue[this.cursor_.rawValue];if(void 0===value){tooltipElem.classList.remove(className("t","a"));return}let tx=mapRange(this.cursor_.rawValue,0,maxIndex,0,bounds.width),ty=mapRange(value,min,max,bounds.height,0);tooltipElem.style.left=`${tx}px`,tooltipElem.style.top=`${ty}px`,tooltipElem.textContent=`${this.formatter_(value)}`,tooltipElem.classList.contains(className("t","a"))||(tooltipElem.classList.add(className("t","a"),className("t","in")),forceReflow(tooltipElem),tooltipElem.classList.remove(className("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class GraphLogController{constructor(doc,config){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=config.props,this.value=config.value,this.viewProps=config.viewProps,this.cursor_=createValue(-1),this.view=new GraphLogView(doc,{cursor:this.cursor_,formatter:config.formatter,lineCount:config.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),supportsTouch(doc)){let ph=new PointerHandler(this.view.element);ph.emitter.on("down",this.onGraphPointerDown_),ph.emitter.on("move",this.onGraphPointerMove_),ph.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(ev){let bounds=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(mapRange(ev.offsetX,0,bounds.width,0,this.value.rawValue.length))}onGraphPointerDown_(ev){this.onGraphPointerMove_(ev)}onGraphPointerMove_(ev){if(!ev.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(mapRange(ev.data.point.x,0,ev.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function createFormatter(params){return"format"in params&&!isEmpty(params.format)?params.format:createNumberFormatter(2)}function shouldShowGraph(params){return"view"in params&&"graph"===params.view}let NumberMonitorPlugin={id:"monitor-number",type:"monitor",accept(value,params){if("number"!=typeof value)return null;let result=parseParams(params,{format:ParamsParsers.optional.function,lineCount:ParamsParsers.optional.number,max:ParamsParsers.optional.number,min:ParamsParsers.optional.number,view:ParamsParsers.optional.string});return result?{initialValue:value,params:result}:null},binding:{defaultBufferSize:params=>shouldShowGraph(params)?64:1,reader:_args=>numberFromUnknown},controller(args){var _a,_b,_c,_a1;return shouldShowGraph(args.params)?new GraphLogController(args.document,{formatter:createFormatter(args.params),lineCount:null!==(_a=args.params.lineCount)&&void 0!==_a?_a:Constants.monitor.defaultLineCount,props:ValueMap.fromObject({maxValue:null!==(_b="max"in args.params?args.params.max:null)&&void 0!==_b?_b:100,minValue:null!==(_c="min"in args.params?args.params.min:null)&&void 0!==_c?_c:0}),value:args.value,viewProps:args.viewProps}):1===args.value.rawValue.length?new SingleLogController(args.document,{formatter:createFormatter(args.params),value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:createFormatter(args.params),lineCount:null!==(_a1=args.params.lineCount)&&void 0!==_a1?_a1:Constants.monitor.defaultLineCount,value:args.value,viewProps:args.viewProps})}},StringMonitorPlugin={id:"monitor-string",type:"monitor",accept(value,params){if("string"!=typeof value)return null;let result=parseParams(params,{lineCount:ParamsParsers.optional.number,multiline:ParamsParsers.optional.boolean});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown},controller(args){var _a;let value=args.value,multiline=value.rawValue.length>1||"multiline"in args.params&&args.params.multiline;return multiline?new MultiLogController(args.document,{formatter:formatString,lineCount:null!==(_a=args.params.lineCount)&&void 0!==_a?_a:Constants.monitor.defaultLineCount,value:value,viewProps:args.viewProps}):new SingleLogController(args.document,{formatter:formatString,value:value,viewProps:args.viewProps})}};class InputBinding{constructor(config){this.onValueChange_=this.onValueChange_.bind(this),this.reader=config.reader,this.writer=config.writer,this.emitter=new Emitter,this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.target=config.target,this.read()}read(){let targetValue=this.target.read();void 0!==targetValue&&(this.value.rawValue=this.reader(targetValue))}write_(rawValue){this.writer(this.target,rawValue)}onValueChange_(ev){this.write_(ev.rawValue),this.emitter.emit("change",{options:ev.options,rawValue:ev.rawValue,sender:this})}}class MonitorBinding{constructor(config){this.onTick_=this.onTick_.bind(this),this.reader_=config.reader,this.target=config.target,this.emitter=new Emitter,this.value=config.value,this.ticker=config.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){let targetValue=this.target.read();if(void 0===targetValue)return;let buffer=this.value.rawValue,newValue=this.reader_(targetValue);this.value.rawValue=function(buffer,newValue){let newBuffer=[...function(buffer){let index=buffer.indexOf(void 0);return index<0?buffer:buffer.slice(0,index)}(buffer),newValue];return newBuffer.length>buffer.length?newBuffer.splice(0,newBuffer.length-buffer.length):fillBuffer(newBuffer,buffer.length),newBuffer}(buffer,newValue),this.emitter.emit("update",{rawValue:newValue,sender:this})}onTick_(_){this.read()}}class PluginPool{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(r){"blade"===r.type?this.pluginsMap_.blades.unshift(r):"input"===r.type?this.pluginsMap_.inputs.unshift(r):"monitor"===r.type&&this.pluginsMap_.monitors.unshift(r)}createInput(document,target,params){let initialValue=target.read();if(isEmpty(initialValue))throw new TpError({context:{key:target.key},type:"nomatchingcontroller"});let bc=this.pluginsMap_.inputs.reduce((result,plugin)=>null!=result?result:function(plugin,args){let result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;let valueArgs={target:args.target,initialValue:result.initialValue,params:result.params},reader=plugin.binding.reader(valueArgs),constraint=plugin.binding.constraint?plugin.binding.constraint(valueArgs):void 0,value=createValue(reader(result.initialValue),{constraint:constraint,equals:plugin.binding.equals}),binding=new InputBinding({reader:reader,target:args.target,value:value,writer:plugin.binding.writer(valueArgs)}),disabled=ParamsParsers.optional.boolean(args.params.disabled).value,hidden=ParamsParsers.optional.boolean(args.params.hidden).value,controller=plugin.controller({constraint:constraint,document:args.document,initialValue:result.initialValue,params:result.params,value:binding.value,viewProps:ViewProps.create({disabled:disabled,hidden:hidden})}),label=ParamsParsers.optional.string(args.params.label).value;return new InputBindingController(args.document,{binding:binding,blade:createBlade(),props:ValueMap.fromObject({label:null!=label?label:args.target.key}),valueController:controller})}(plugin,{document:document,target:target,params:params}),null);if(bc)return bc;throw new TpError({context:{key:target.key},type:"nomatchingcontroller"})}createMonitor(document,target,params){let bc=this.pluginsMap_.monitors.reduce((result,plugin)=>null!=result?result:function(plugin,args){var _a,_b,_c,document;let result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;let bindingArgs={target:args.target,initialValue:result.initialValue,params:result.params},reader=plugin.binding.reader(bindingArgs),bufferSize=null!==(_b=null!==(_a=ParamsParsers.optional.number(args.params.bufferSize).value)&&void 0!==_a?_a:plugin.binding.defaultBufferSize&&plugin.binding.defaultBufferSize(result.params))&&void 0!==_b?_b:1,interval=ParamsParsers.optional.number(args.params.interval).value,binding=new MonitorBinding({reader:reader,target:args.target,ticker:(document=args.document,0===interval?new ManualTicker:new IntervalTicker(document,null!=interval?interval:Constants.monitor.defaultInterval)),value:function(bufferSize){let buffer=[];return fillBuffer(buffer,bufferSize),createValue(buffer)}(bufferSize)}),disabled=ParamsParsers.optional.boolean(args.params.disabled).value,hidden=ParamsParsers.optional.boolean(args.params.hidden).value,controller=plugin.controller({document:args.document,params:result.params,value:binding.value,viewProps:ViewProps.create({disabled:disabled,hidden:hidden})}),label=null!==(_c=ParamsParsers.optional.string(args.params.label).value)&&void 0!==_c?_c:args.target.key;return new MonitorBindingController(args.document,{binding:binding,blade:createBlade(),props:ValueMap.fromObject({label:label}),valueController:controller})}(plugin,{document:document,params:params,target:target}),null);if(bc)return bc;throw new TpError({context:{key:target.key},type:"nomatchingcontroller"})}createBlade(document,params){let bc=this.pluginsMap_.blades.reduce((result,plugin)=>null!=result?result:function(plugin,args){let ac=plugin.accept(args.params);if(!ac)return null;let disabled=ParamsParsers.optional.boolean(args.params.disabled).value,hidden=ParamsParsers.optional.boolean(args.params.hidden).value;return plugin.controller({blade:createBlade(),document:args.document,params:Object.assign(Object.assign({},ac.params),{disabled:disabled,hidden:hidden}),viewProps:ViewProps.create({disabled:disabled,hidden:hidden})})}(plugin,{document:document,params:params}),null);if(!bc)throw new TpError({type:"nomatchingview",context:{params:params}});return bc}createBladeApi(bc){if(bc instanceof InputBindingController)return new InputBindingApi(bc);if(bc instanceof MonitorBindingController)return new MonitorBindingApi(bc);if(bc instanceof RackController)return new RackApi(bc,this);let api=this.pluginsMap_.blades.reduce((result,plugin)=>null!=result?result:plugin.api({controller:bc,pool:this}),null);if(!api)throw TpError.shouldNeverHappen();return api}}class ListApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get options(){return this.controller_.valueController.props.get("options")}set options(options){this.controller_.valueController.props.set("options",options)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class SliderApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(maxValue){this.controller_.valueController.sliderController.props.set("maxValue",maxValue)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(minValue){this.controller_.valueController.sliderController.props.set("minValue",minValue)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class TextApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(formatter){this.controller_.valueController.props.set("formatter",formatter)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}let ListBladePlugin={id:"list",type:"blade",accept(params){let result=parseParams(params,{options:ParamsParsers.required.custom(parseListOptions),value:ParamsParsers.required.raw,view:ParamsParsers.required.constant("list"),label:ParamsParsers.optional.string});return result?{params:result}:null},controller(args){let ic=new ListController(args.document,{props:ValueMap.fromObject({options:normalizeListOptions(args.params.options)}),value:createValue(args.params.value),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:ic})},api:args=>args.controller instanceof LabeledValueController&&args.controller.valueController instanceof ListController?new ListApi(args.controller):null};class RootApi extends FolderApi{constructor(controller,pool){super(controller,pool)}get element(){return this.controller_.view.element}importPreset(preset){let targets=this.controller_.rackController.rack.find(InputBindingController).map(ibc=>ibc.binding.target);(function(targets,preset){targets.forEach(target=>{let value=preset[target.presetKey];void 0!==value&&target.write(value)})})(targets,preset),this.refresh()}exportPreset(){let targets=this.controller_.rackController.rack.find(InputBindingController).map(ibc=>ibc.binding.target);return targets.reduce((result,target)=>Object.assign(result,{[target.presetKey]:target.read()}),{})}refresh(){this.controller_.rackController.rack.find(InputBindingController).forEach(ibc=>{ibc.binding.read()}),this.controller_.rackController.rack.find(MonitorBindingController).forEach(mbc=>{mbc.binding.read()})}}class RootController extends FolderController{constructor(doc,config){super(doc,{expanded:config.expanded,blade:config.blade,props:config.props,root:!0,viewProps:config.viewProps})}}let SliderBladePlugin={id:"slider",type:"blade",accept(params){let result=parseParams(params,{max:ParamsParsers.required.number,min:ParamsParsers.required.number,view:ParamsParsers.required.constant("slider"),format:ParamsParsers.optional.function,label:ParamsParsers.optional.string,value:ParamsParsers.optional.number});return result?{params:result}:null},controller(args){var _a,_b;let v=null!==(_a=args.params.value)&&void 0!==_a?_a:0,vc=new SliderTextController(args.document,{baseStep:1,parser:parseNumber,sliderProps:ValueMap.fromObject({maxValue:args.params.max,minValue:args.params.min}),textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(void 0,v),formatter:null!==(_b=args.params.format)&&void 0!==_b?_b:numberToString}),value:createValue(v),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:vc})},api:args=>args.controller instanceof LabeledValueController&&args.controller.valueController instanceof SliderTextController?new SliderApi(args.controller):null},TextBladePlugin={id:"text",type:"blade",accept(params){let result=parseParams(params,{parse:ParamsParsers.required.function,value:ParamsParsers.required.raw,view:ParamsParsers.required.constant("text"),format:ParamsParsers.optional.function,label:ParamsParsers.optional.string});return result?{params:result}:null},controller(args){var _a;let ic=new TextController(args.document,{parser:args.params.parse,props:ValueMap.fromObject({formatter:null!==(_a=args.params.format)&&void 0!==_a?_a:v=>String(v)}),value:createValue(args.params.value),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:ic})},api:args=>args.controller instanceof LabeledValueController&&args.controller.valueController instanceof TextController?new TextApi(args.controller):null};function embedStyle(doc,id,css){if(doc.querySelector(`style[data-tp-style=${id}]`))return;let styleElem=doc.createElement("style");styleElem.dataset.tpStyle=id,styleElem.textContent=css,doc.head.appendChild(styleElem)}let VERSION=new class{constructor(text){let[core,prerelease]=text.split("-"),coreComps=core.split(".");this.major=parseInt(coreComps[0],10),this.minor=parseInt(coreComps[1],10),this.patch=parseInt(coreComps[2],10),this.prerelease=null!=prerelease?prerelease:null}toString(){let core=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[core,this.prerelease].join("-"):core}}("3.1.1");exports.BladeApi=BladeApi,exports.ButtonApi=ButtonApi,exports.FolderApi=FolderApi,exports.InputBindingApi=InputBindingApi,exports.ListApi=ListApi,exports.MonitorBindingApi=MonitorBindingApi,exports.Pane=class extends RootApi{constructor(opt_config){var _a,_b;let config=null!=opt_config?opt_config:{},doc=null!==(_a=config.document)&&void 0!==_a?_a:function(){let globalObj=globalThis;return globalObj.document}(),pool=function(){let pool=new PluginPool;return[Point2dInputPlugin,Point3dInputPlugin,Point4dInputPlugin,StringInputPlugin,NumberInputPlugin,StringColorInputPlugin,ObjectColorInputPlugin,NumberColorInputPlugin,BooleanInputPlugin,BooleanMonitorPlugin,StringMonitorPlugin,NumberMonitorPlugin,ButtonBladePlugin,FolderBladePlugin,SeparatorBladePlugin,TabBladePlugin].forEach(p=>{pool.register(p)}),pool}(),rootController=new RootController(doc,{expanded:config.expanded,blade:createBlade(),props:ValueMap.fromObject({title:config.title}),viewProps:ViewProps.create()});super(rootController,pool),this.pool_=pool,this.containerElem_=null!==(_b=config.container)&&void 0!==_b?_b:function(doc){let elem=doc.createElement("div");return elem.classList.add(ClassName("dfw")()),doc.body&&doc.body.appendChild(elem),elem}(doc),this.containerElem_.appendChild(this.element),this.doc_=doc,this.usesDefaultWrapper_=!config.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw TpError.alreadyDisposed();return this.doc_}dispose(){let containerElem=this.containerElem_;if(!containerElem)throw TpError.alreadyDisposed();if(this.usesDefaultWrapper_){let parentElem=containerElem.parentElement;parentElem&&parentElem.removeChild(containerElem)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(bundle){let plugins="plugin"in bundle?[bundle.plugin]:"plugins"in bundle?bundle.plugins:[];plugins.forEach(p=>{this.pool_.register(p),this.embedPluginStyle_(p)})}embedPluginStyle_(plugin){plugin.css&&embedStyle(this.document,`plugin-${plugin.id}`,plugin.css)}setUpDefaultPlugins_(){embedStyle(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230deg, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230deg, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230deg, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230deg, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230deg, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(plugin=>{this.embedPluginStyle_(plugin)}),this.registerPlugin({plugins:[SliderBladePlugin,ListBladePlugin,TabBladePlugin,TextBladePlugin]})}},exports.SeparatorApi=SeparatorApi,exports.SliderApi=SliderApi,exports.TabApi=TabApi,exports.TabPageApi=TabPageApi,exports.TextApi=TextApi,exports.TpChangeEvent=TpChangeEvent,exports.VERSION=VERSION,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)}}]);