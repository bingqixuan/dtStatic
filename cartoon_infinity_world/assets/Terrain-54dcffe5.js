(function(){"use strict";const Ft=.5*(Math.sqrt(3)-1),J=(3-Math.sqrt(3))/6,Xt=1/3,B=1/6,kt=(Math.sqrt(5)-1)/4,D=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class xt{constructor(n=Math.random){const i=typeof n=="function"?n:Zt(n);this.p=vt(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let c=0;c<512;c++)this.perm[c]=this.p[c&255],this.permMod12[c]=this.perm[c]%12}noise2D(n,i){const c=this.permMod12,g=this.perm;let r=0,p=0,A=0;const j=(n+i)*Ft,R=Math.floor(n+j),Z=Math.floor(i+j),Y=(R+Z)*J,C=R-Y,G=Z-Y,v=n-C,t=i-G;let N,T;v>t?(N=1,T=0):(N=0,T=1);const U=v-N+J,q=t-T+J,u=v-1+2*J,a=t-1+2*J,b=R&255,F=Z&255;let y=.5-v*v-t*t;if(y>=0){const e=c[b+g[F]]*3;y*=y,r=y*y*(I[e]*v+I[e+1]*t)}let X=.5-U*U-q*q;if(X>=0){const e=c[b+N+g[F+T]]*3;X*=X,p=X*X*(I[e]*U+I[e+1]*q)}let l=.5-u*u-a*a;if(l>=0){const e=c[b+1+g[F+1]]*3;l*=l,A=l*l*(I[e]*u+I[e+1]*a)}return 70*(r+p+A)}noise3D(n,i,c){const g=this.permMod12,r=this.perm;let p,A,j,R;const Z=(n+i+c)*Xt,Y=Math.floor(n+Z),C=Math.floor(i+Z),G=Math.floor(c+Z),v=(Y+C+G)*B,t=Y-v,N=C-v,T=G-v,U=n-t,q=i-N,u=c-T;let a,b,F,y,X,l;U>=q?q>=u?(a=1,b=0,F=0,y=1,X=1,l=0):U>=u?(a=1,b=0,F=0,y=1,X=0,l=1):(a=0,b=0,F=1,y=1,X=0,l=1):q<u?(a=0,b=0,F=1,y=0,X=1,l=1):U<u?(a=0,b=1,F=0,y=0,X=1,l=1):(a=0,b=1,F=0,y=1,X=1,l=0);const e=U-a+B,P=q-b+B,V=u-F+B,o=U-y+2*B,m=q-X+2*B,f=u-l+2*B,d=U-1+3*B,M=q-1+3*B,x=u-1+3*B,S=Y&255,w=C&255,h=G&255;let O=.6-U*U-q*q-u*u;if(O<0)p=0;else{const E=g[S+r[w+r[h]]]*3;O*=O,p=O*O*(I[E]*U+I[E+1]*q+I[E+2]*u)}let W=.6-e*e-P*P-V*V;if(W<0)A=0;else{const E=g[S+a+r[w+b+r[h+F]]]*3;W*=W,A=W*W*(I[E]*e+I[E+1]*P+I[E+2]*V)}let _=.6-o*o-m*m-f*f;if(_<0)j=0;else{const E=g[S+y+r[w+X+r[h+l]]]*3;_*=_,j=_*_*(I[E]*o+I[E+1]*m+I[E+2]*f)}let H=.6-d*d-M*M-x*x;if(H<0)R=0;else{const E=g[S+1+r[w+1+r[h+1]]]*3;H*=H,R=H*H*(I[E]*d+I[E+1]*M+I[E+2]*x)}return 32*(p+A+j+R)}noise4D(n,i,c,g){const r=this.perm;let p,A,j,R,Z;const Y=(n+i+c+g)*kt,C=Math.floor(n+Y),G=Math.floor(i+Y),v=Math.floor(c+Y),t=Math.floor(g+Y),N=(C+G+v+t)*D,T=C-N,U=G-N,q=v-N,u=t-N,a=n-T,b=i-U,F=c-q,y=g-u;let X=0,l=0,e=0,P=0;a>b?X++:l++,a>F?X++:e++,a>y?X++:P++,b>F?l++:e++,b>y?l++:P++,F>y?e++:P++;const V=X>=3?1:0,o=l>=3?1:0,m=e>=3?1:0,f=P>=3?1:0,d=X>=2?1:0,M=l>=2?1:0,x=e>=2?1:0,S=P>=2?1:0,w=X>=1?1:0,h=l>=1?1:0,O=e>=1?1:0,W=P>=1?1:0,_=a-V+D,H=b-o+D,E=F-m+D,rt=y-f+D,at=a-d+2*D,lt=b-M+2*D,ft=F-x+2*D,dt=y-S+2*D,ut=a-w+3*D,ht=b-h+3*D,mt=F-O+3*D,yt=y-W+3*D,pt=a-1+4*D,gt=b-1+4*D,Mt=F-1+4*D,wt=y-1+4*D,K=C&255,L=G&255,Q=v&255,$=t&255;let tt=.6-a*a-b*b-F*F-y*y;if(tt<0)p=0;else{const k=r[K+r[L+r[Q+r[$]]]]%32*4;tt*=tt,p=tt*tt*(z[k]*a+z[k+1]*b+z[k+2]*F+z[k+3]*y)}let nt=.6-_*_-H*H-E*E-rt*rt;if(nt<0)A=0;else{const k=r[K+V+r[L+o+r[Q+m+r[$+f]]]]%32*4;nt*=nt,A=nt*nt*(z[k]*_+z[k+1]*H+z[k+2]*E+z[k+3]*rt)}let ot=.6-at*at-lt*lt-ft*ft-dt*dt;if(ot<0)j=0;else{const k=r[K+d+r[L+M+r[Q+x+r[$+S]]]]%32*4;ot*=ot,j=ot*ot*(z[k]*at+z[k+1]*lt+z[k+2]*ft+z[k+3]*dt)}let st=.6-ut*ut-ht*ht-mt*mt-yt*yt;if(st<0)R=0;else{const k=r[K+w+r[L+h+r[Q+O+r[$+W]]]]%32*4;st*=st,R=st*st*(z[k]*ut+z[k+1]*ht+z[k+2]*mt+z[k+3]*yt)}let et=.6-pt*pt-gt*gt-Mt*Mt-wt*wt;if(et<0)Z=0;else{const k=r[K+1+r[L+1+r[Q+1+r[$+1]]]]%32*4;et*=et,Z=et*et*(z[k]*pt+z[k+1]*gt+z[k+2]*Mt+z[k+3]*wt)}return 27*(p+A+j+R+Z)}}function vt(s){const n=new Uint8Array(256);for(let i=0;i<256;i++)n[i]=i;for(let i=0;i<255;i++){const c=i+~~(s()*(256-i)),g=n[i];n[i]=n[c],n[c]=g}return n}function Zt(s){let n=0,i=0,c=0,g=1;const r=jt();return n=r(" "),i=r(" "),c=r(" "),n-=r(s),n<0&&(n+=1),i-=r(s),i<0&&(i+=1),c-=r(s),c<0&&(c+=1),function(){const p=2091639*n+g*23283064365386963e-26;return n=i,i=c,c=p-(g=p|0)}}function jt(){let s=4022871197;return function(n){n=n.toString();for(let i=0;i<n.length;i++){s+=n.charCodeAt(i);let c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26}}var ct=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});function At(){var s=new ct(3);return ct!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function it(s,n,i){var c=new ct(3);return c[0]=s,c[1]=n,c[2]=i,c}function zt(s,n){var i=n[0],c=n[1],g=n[2],r=i*i+c*c+g*g;return r>0&&(r=1/Math.sqrt(r)),s[0]=n[0]*r,s[1]=n[1]*r,s[2]=n[2]*r,s}function qt(s,n,i){var c=n[0],g=n[1],r=n[2],p=i[0],A=i[1],j=i[2];return s[0]=g*j-r*A,s[1]=r*p-c*j,s[2]=c*A-g*p,s}(function(){var s=At();return function(n,i,c,g,r,p){var A,j;for(i||(i=3),c||(c=0),g?j=Math.min(g*i+c,n.length):j=n.length,A=c;A<j;A+=i)s[0]=n[A],s[1]=n[A+1],s[2]=n[A+2],r(s,s,p),n[A]=s[0],n[A+1]=s[1],n[A+2]=s[2];return n}})();let St=null;const bt=(s,n,i)=>Math.max(0,Math.min(1,(i-s)/(n-s))),Pt=(s,n,i,c,g,r,p,A,j,R)=>{let Z=0,Y=r,C=1,G=0;for(let v=0;v<g;v++){const t=St.noise2D(s*Y+R[v][0],n*Y+R[v][1]);Z+=t*C,G+=C,C*=c,Y*=i}return Z/=G,Z=Math.pow(Math.abs(Z),A)*Math.sign(Z),Z*=p,Z+=j,Z};onmessage=function(s){const n=s.data.id,i=s.data.size,c=s.data.x,g=s.data.z,r=s.data.seed,p=s.data.subdivisions,A=s.data.lacunarity,j=s.data.persistence,R=s.data.iterations,Z=s.data.baseFrequency,Y=s.data.baseAmplitude,C=s.data.power,G=s.data.elevationOffset,v=s.data.iterationsOffsets,t=p+1;St=new xt(r);const N=new xt(r),T=new Float32Array((t+1)*(t+1)),U=new Float32Array(t*t);for(let o=0;o<t+1;o++){const m=c+(o/p-.5)*i;for(let f=0;f<t+1;f++){const d=g+(f/p-.5)*i,M=Pt(m,d,A,j,R,Z,Y,C,G,v),x=f*(t+1)+o;if(T[x]=M,o<t&&f<t){const S=f*t+o;U[S]=M}}}const q=p*4+4,u=new Float32Array(t*t*3+q*3);for(let o=0;o<t;o++){const m=g+(o/p-.5)*i;for(let f=0;f<t;f++){const d=c+(f/p-.5)*i,M=U[o*t+f],x=(o*t+f)*3;u[x]=d,u[x+1]=M,u[x+2]=m}}const a=new Float32Array(t*t*3+q*3),b=-i/p,F=-i/p;for(let o=0;o<t;o++)for(let m=0;m<t;m++){const f=o*(t+1)+m,d=T[f],M=T[f+1],x=T[f+t+1],S=it(b,d-M,0),w=it(0,d-x,F),h=At();qt(h,w,S),zt(h,h);const O=(o*t+m)*3;a[O]=h[0],a[O+1]=h[1],a[O+2]=h[2]}const y=new Float32Array(t*t*2+q*2);for(let o=0;o<t;o++)for(let m=0;m<t;m++){const f=(o*t+m)*2;y[f]=m/(t-1),y[f+1]=o/(t-1)}const X=p*p,l=new(X<65535?Uint16Array:Uint32Array)(X*6+p*4*6*4);for(let o=0;o<p;o++)for(let m=0;m<p;m++){const f=p+1,d=o*f+m,M=o*f+(m+1),x=(o+1)*f+m,S=(o+1)*f+(m+1),w=(o*p+m)*6;l[w]=d,l[w+1]=S,l[w+2]=M,l[w+3]=S,l[w+4]=d,l[w+5]=x}let e=t*t,P=t*t;for(let o=0;o<t;o++){const f=0*t+o,d=f*3;if(u[e*3]=u[d+0],u[e*3+1]=u[d+1]-15,u[e*3+2]=u[d+2],a[e*3]=a[d+0],a[e*3+1]=a[d+1],a[e*3+2]=a[d+2],y[e*2]=0/(t-1),y[e*2+1]=o/(t-1),o<t-1){const M=f,x=f+1,S=e,w=e+1,h=P*6;l[h]=x,l[h+1]=w,l[h+2]=M,l[h+3]=S,l[h+4]=M,l[h+5]=w,P++}e++}for(let o=0;o<t;o++){const m=t-1,f=m*t+o,d=f*3;if(u[e*3]=u[d+0],u[e*3+1]=u[d+1]-15,u[e*3+2]=u[d+2],a[e*3]=a[d+0],a[e*3+1]=a[d+1],a[e*3+2]=a[d+2],y[e*2]=m/(t-1),y[e*2+1]=o/(t-1),o<t-1){const M=f,x=f+1,S=e,w=e+1,h=P*6;l[h]=M,l[h+1]=S,l[h+2]=x,l[h+3]=w,l[h+4]=x,l[h+5]=S,P++}e++}for(let o=0;o<t;o++){const f=o*t+0,d=f*3;if(u[e*3]=u[d+0],u[e*3+1]=u[d+1]-15,u[e*3+2]=u[d+2],a[e*3]=a[d+0],a[e*3+1]=a[d+1],a[e*3+2]=a[d+2],y[e*2]=o/(t-1),y[e*2+1]=0,o<t-1){const M=f,x=f+t,S=e,w=e+1,h=P*6;l[h]=M,l[h+1]=S,l[h+2]=x,l[h+3]=w,l[h+4]=x,l[h+5]=S,P++}e++}for(let o=0;o<t;o++){const m=t-1,f=o*t+m,d=f*3;if(u[e*3]=u[d+0],u[e*3+1]=u[d+1]-15,u[e*3+2]=u[d+2],a[e*3]=a[d+0],a[e*3+1]=a[d+1],a[e*3+2]=a[d+2],y[e*2]=o/(t-1),y[e*2+1]=m/(t-1),o<t-1){const M=f,x=f+t,S=e,w=e+1,h=P*6;l[h]=x,l[h+1]=w,l[h+2]=M,l[h+3]=S,l[h+4]=M,l[h+5]=w,P++}e++}const V=new Float32Array(t*t*4);for(let o=0;o<t;o++)for(let m=0;m<t;m++){const f=(o*t+m)*3,d=it(u[f],u[f+1],u[f+2]),M=(o*t+m)*3,x=it(a[M],a[M+1],a[M+2]),S=Math.max(0,x[1]);let w=0;if(d[1]>0){let W=N.noise2D(d[0]*.05+v[0][0],d[2]*.05+v[0][0]);W=bt(-.5,0,W);const _=bt(.9,1,S);w=W*_}const h=(o*t+m)*4;V[h]=0,V[h+1]=w,V[h+2]=0,V[h+3]=d[1]}postMessage({id:n,positions:u,normals:a,indices:l,texture:V,uv:y})}})();
