class t{enterFullScreen(){document.fullscreenElement||document.documentElement.requestFullscreen({navigationUI:"hide"})}exitFullScreen(){document.exitFullscreen&&document.exitFullscreen()}addFullScreenListener(t){document.addEventListener("fullscreenchange",t,!1)}isFullScreen(){return!!document.fullscreenElement}}class e{static async load(t){return(await fetch(t)).arrayBuffer()}}class i{static load(t,e,i=e.LINEAR,n=e.LINEAR,r=!1){return new Promise(((o,s)=>{const a=e.createTexture();if(null===a)return void s("Error creating WebGL texture");const l=new Image;l.src=t,l.onload=()=>{e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),!0===r?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)),e.bindTexture(e.TEXTURE_2D,null),l&&l.src&&console.log(`Loaded texture ${t} [${l.width}x${l.height}]`),o(a)},l.onerror=()=>s("Cannot load image")}))}static async loadCubemap(t,e,i="png"){const n=e.createTexture();if(null===n)throw new Error("Error creating WebGL texture");e.bindTexture(e.TEXTURE_CUBE_MAP,n),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.NEAREST);const r=[{type:e.TEXTURE_CUBE_MAP_POSITIVE_X,suffix:`-posx.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_X,suffix:`-negx.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Y,suffix:`-posy.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,suffix:`-negy.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Z,suffix:`-posz.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,suffix:`-negz.${i}`}].map((i=>new Promise(((r,o)=>{const s=new Image;s.src=t+i.suffix,s.onload=()=>{e.bindTexture(e.TEXTURE_CUBE_MAP,n),e.texImage2D(i.type,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,s),s&&s.src&&console.log(`Loaded texture ${t}${i.suffix} [${s.width}x${s.height}]`),r()},s.onerror=()=>o("Cannot load image")}))));return await Promise.all(r),e.bindTexture(e.TEXTURE_2D,null),n}}class n{constructor(){this.numIndices=0}loadBuffer(t,e,i,n){var r=new Uint8Array(n,0,n.byteLength);t.bindBuffer(i,e),t.bufferData(i,r,t.STATIC_DRAW)}async load(t,i){const[n,r]=await Promise.all([e.load(`${t}-indices.bin`),e.load(`${t}-strides.bin`)]);console.log(`Loaded ${t}-indices.bin (${n.byteLength} bytes)`),console.log(`Loaded ${t}-strides.bin (${r.byteLength} bytes)`),this.bufferIndices=i.createBuffer(),this.loadBuffer(i,this.bufferIndices,i.ELEMENT_ARRAY_BUFFER,n),this.numIndices=n.byteLength/2/3,this.bufferStrides=i.createBuffer(),this.loadBuffer(i,this.bufferStrides,i.ARRAY_BUFFER,r)}bindBuffers(t){t.bindBuffer(t.ARRAY_BUFFER,this.bufferStrides),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.bufferIndices)}getNumIndices(){return this.numIndices}}class r{constructor(t){this.gl=t,this.vertexShaderCode="",this.fragmentShaderCode="",this.fillCode(),this.initShader()}getShader(t,e){const i=this.gl.createShader(t);if(i){if(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;console.warn(this.gl.getShaderInfoLog(i))}else console.warn("Error creating shader.")}getUniform(t){if(void 0===this.program)throw new Error("No program for shader.");const e=this.gl.getUniformLocation(this.program,t);if(null!==e)return e;throw new Error(`Cannot get uniform "${t}".`)}getAttrib(t){if(void 0===this.program)throw new Error("No program for shader.");return this.gl.getAttribLocation(this.program,t)}initShader(){const t=this.getShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderCode),e=this.getShader(this.gl.VERTEX_SHADER,this.vertexShaderCode),i=this.gl.createProgram();void 0!==t&&void 0!==e&&null!==i&&(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?console.log(this.constructor.name+": Initialised shader"):console.warn(this.constructor.name+": Could not initialise shader"),this.gl.useProgram(i),this.program=i,this.fillUniformsAttributes())}use(){this.program&&this.gl.useProgram(this.program)}deleteProgram(){this.program&&this.gl.deleteProgram(this.program)}}var o=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array;function a(){var t=new s(16);return s!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],f=e[10],m=e[11],_=e[12],g=e[13],p=e[14],v=e[15],x=i[0],b=i[1],E=i[2],T=i[3];return t[0]=x*n+b*a+E*c+T*_,t[1]=x*r+b*l+E*u+T*g,t[2]=x*o+b*h+E*f+T*p,t[3]=x*s+b*d+E*m+T*v,x=i[4],b=i[5],E=i[6],T=i[7],t[4]=x*n+b*a+E*c+T*_,t[5]=x*r+b*l+E*u+T*g,t[6]=x*o+b*h+E*f+T*p,t[7]=x*s+b*d+E*m+T*v,x=i[8],b=i[9],E=i[10],T=i[11],t[8]=x*n+b*a+E*c+T*_,t[9]=x*r+b*l+E*u+T*g,t[10]=x*o+b*h+E*f+T*p,t[11]=x*s+b*d+E*m+T*v,x=i[12],b=i[13],E=i[14],T=i[15],t[12]=x*n+b*a+E*c+T*_,t[13]=x*r+b*l+E*u+T*g,t[14]=x*o+b*h+E*f+T*p,t[15]=x*s+b*d+E*m+T*v,t}function h(){var t=new s(3);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function d(t,e,i){var n=new s(3);return n[0]=t,n[1]=e,n[2]=i,n}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function c(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}h(),function(){var t,e=(t=new s(4),s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var u;h(),d(1,0,0),d(0,1,0),c(),c(),u=new s(9),s!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,function(){var t=function(){var t=new s(2);return s!=Float32Array&&(t[0]=0,t[1]=0),t}()}();class f{constructor(){this.mMMatrix=a(),this.mVMatrix=a(),this.mMVPMatrix=a(),this.mProjMatrix=a(),this.matOrtho=a(),this.m_boundTick=this.tick.bind(this),this.isWebGL2=!1,this.viewportWidth=0,this.viewportHeight=0}get gl(){if(void 0===this.m_gl)throw new Error("No WebGL context");return this.m_gl}logGLError(){var t=this.gl.getError();t!==this.gl.NO_ERROR&&console.warn(`WebGL error # + ${t}`)}setTexture2D(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i,t)}setTextureCubemap(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e),this.gl.uniform1i(i,t)}setFOV(t,e,i,n,r){const o=Math.tan(e/360*Math.PI)*n,s=o*i;!function(t,e,i,n,r,o,s){var a=1/(i-e),l=1/(r-n),h=1/(o-s);t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*l,t[10]=(s+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*h,t[15]=0}(t,-s,s,-o,o,n,r)}calculateMVPMatrix(t,e,i,n,r,s,a,h,d){!function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.mMMatrix),function(t,e,i,n){var r,s,a,l,h,d,c,u,f,m,_,g,p,v,x,b,E,T,w,A,C,y,R,M,S=n[0],O=n[1],F=n[2],P=Math.hypot(S,O,F);P<o||(S*=P=1/P,O*=P,F*=P,r=Math.sin(i),a=1-(s=Math.cos(i)),l=e[0],h=e[1],d=e[2],c=e[3],u=e[4],f=e[5],m=e[6],_=e[7],g=e[8],p=e[9],v=e[10],x=e[11],b=S*S*a+s,E=O*S*a+F*r,T=F*S*a-O*r,w=S*O*a-F*r,A=O*O*a+s,C=F*O*a+S*r,y=S*F*a+O*r,R=O*F*a-S*r,M=F*F*a+s,t[0]=l*b+u*E+g*T,t[1]=h*b+f*E+p*T,t[2]=d*b+m*E+v*T,t[3]=c*b+_*E+x*T,t[4]=l*w+u*A+g*C,t[5]=h*w+f*A+p*C,t[6]=d*w+m*A+v*C,t[7]=c*w+_*A+x*C,t[8]=l*y+u*R+g*M,t[9]=h*y+f*R+p*M,t[10]=d*y+m*R+v*M,t[11]=c*y+_*R+x*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this.mMMatrix,this.mMMatrix,0,[1,0,0]),function(t,e,i){var n,r,o,s,a,l,h,d,c,u,f,m,_=i[0],g=i[1],p=i[2];e===t?(t[12]=e[0]*_+e[4]*g+e[8]*p+e[12],t[13]=e[1]*_+e[5]*g+e[9]*p+e[13],t[14]=e[2]*_+e[6]*g+e[10]*p+e[14],t[15]=e[3]*_+e[7]*g+e[11]*p+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],f=e[10],m=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=h,t[7]=d,t[8]=c,t[9]=u,t[10]=f,t[11]=m,t[12]=n*_+a*g+c*p+e[12],t[13]=r*_+l*g+u*p+e[13],t[14]=o*_+h*g+f*p+e[14],t[15]=s*_+d*g+m*p+e[15])}(this.mMMatrix,this.mMMatrix,[t,e,i]),function(t,e,i){var n=i[0],r=i[1],o=i[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.mMMatrix,this.mMMatrix,[a,h,d]),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*n,t[5]=s*r+d*n,t[6]=a*r+c*n,t[7]=l*r+u*n,t[8]=h*r-o*n,t[9]=d*r-s*n,t[10]=c*r-a*n,t[11]=u*r-l*n}(this.mMMatrix,this.mMMatrix,n),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*n,t[1]=s*r-d*n,t[2]=a*r-c*n,t[3]=l*r-u*n,t[8]=o*n+h*r,t[9]=s*n+d*r,t[10]=a*n+c*r,t[11]=l*n+u*r}(this.mMMatrix,this.mMMatrix,r),function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+h*n,t[1]=s*r+d*n,t[2]=a*r+c*n,t[3]=l*r+u*n,t[4]=h*r-o*n,t[5]=d*r-s*n,t[6]=c*r-a*n,t[7]=u*r-l*n}(this.mMMatrix,this.mMMatrix,s),l(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),l(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}drawScene(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}tick(){requestAnimationFrame(this.m_boundTick),this.resizeCanvas(),this.drawScene(),this.animate()}initGL(t){const e=t.getContext("webgl",{alpha:!1});if(null===e)throw new Error("Cannot initialize WebGL context");return e}initGL2(t){let e=t.getContext("webgl2",{alpha:!1});return null===e?(console.warn("Could not initialise WebGL 2, falling back to WebGL 1"),this.initGL(t)):e}generateMipmaps(...t){for(const e of t)this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.generateMipmap(this.gl.TEXTURE_2D)}init(t,e=!1){if(this.onBeforeInit(),this.canvas=document.getElementById(t),null===this.canvas)throw new Error("Cannot find canvas element");this.viewportWidth=this.canvas.width,this.viewportHeight=this.canvas.height,this.m_gl=e?this.initGL2(this.canvas):this.initGL(this.canvas),this.m_gl?(this.resizeCanvas(),this.onAfterInit(),this.initShaders(),this.loadData(),this.m_boundTick()):this.onInitError()}resizeCanvas(){if(void 0===this.canvas)return;const t=window.devicePixelRatio||1,e=Math.floor(this.canvas.clientWidth*t),i=Math.floor(this.canvas.clientHeight*t);this.canvas.width==e&&this.canvas.height==i||(this.canvas.width=e,this.canvas.height=i)}checkGlError(t){let e;for(;(e=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${t}: glError ${e}`)}unbindBuffers(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}getMVPMatrix(){return this.mMVPMatrix}getOrthoMatrix(){return this.matOrtho}getModelMatrix(){return this.mMMatrix}getViewMatrix(){return this.mVMatrix}}class m{constructor(t){this.gl=t,this.m_textureHandle=null,this.m_depthTextureHandle=null,this.m_framebufferHandle=null,this.m_depthbufferHandle=null}createGLData(t,e){if(this.m_width=t,this.m_height=e,null!==this.m_textureHandle&&this.m_width>0&&this.m_height>0){this.m_framebufferHandle=this.gl.createFramebuffer(),null!==this.m_textureHandle&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.m_textureHandle),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.m_framebufferHandle),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.m_textureHandle,0),this.checkGlError("FB")),null===this.m_depthTextureHandle?(this.m_depthbufferHandle=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.m_depthbufferHandle),this.checkGlError("FB - glBindRenderbuffer"),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.m_width,this.m_height),this.checkGlError("FB - glRenderbufferStorage"),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.m_depthbufferHandle),this.checkGlError("FB - glFramebufferRenderbuffer")):(this.gl.bindTexture(this.gl.TEXTURE_2D,this.m_depthTextureHandle),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.m_framebufferHandle),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.m_depthTextureHandle,0),this.checkGlError("FB depth"));const t=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);t!=this.gl.FRAMEBUFFER_COMPLETE&&console.error(`Error creating framebufer: ${t}`),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}checkGlError(t){let e;for(;(e=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${t}: glError ${e}`)}get width(){return this.m_width}set width(t){this.m_width=t}get height(){return this.m_height}set height(t){this.m_height=t}get textureHandle(){return this.m_textureHandle}set textureHandle(t){this.m_textureHandle=t}get depthbufferHandle(){return this.m_depthbufferHandle}set depthbufferHandle(t){this.m_depthbufferHandle=t}get framebufferHandle(){return this.m_framebufferHandle}set framebufferHandle(t){this.m_framebufferHandle=t}get depthTextureHandle(){return this.m_depthTextureHandle}set depthTextureHandle(t){this.m_depthTextureHandle=t}}class _{static createNpotTexture(t,e,i,n=!1){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);let o=null,s=null;return n?(o=t.RGBA,s=t.RGBA):(o=t.RGB,s=t.RGB),t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,o,t.UNSIGNED_BYTE,null),r}static createDepthTexture(t,e,i){const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const r=t.getParameter(t.VERSION)||"",o=t.DEPTH_COMPONENT,s=r.includes("WebGL 2")?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT,a=t.UNSIGNED_SHORT;return t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,o,a,null),n}}class g{constructor(t){this.frames=t,this.start=0,this.end=0,this.currentCoeff=0}getStart(){return this.start}getEnd(){return this.end}getFramesCount(){return this.frames}getCurrentCoeff(){return this.currentCoeff}clamp(t,e,i){return Math.max(Math.min(t,i),e)}animate(t){const e=this.clamp(t,0,1);this.start=Math.trunc(e*(this.frames-1)),this.start==this.frames-1&&(this.start=this.frames-2),this.end=this.start+1,this.currentCoeff=e*(this.frames-1)-this.start}}class p extends r{fillCode(){this.vertexShaderCode="uniform mat4 view_proj_matrix;\nattribute vec4 rm_Vertex;\nattribute vec2 rm_TexCoord0;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = view_proj_matrix * rm_Vertex;\n  vTextureCoord = rm_TexCoord0;\n}",this.fragmentShaderCode="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D sTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(sTexture, vTextureCoord);\n}"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.sTexture=this.getUniform("sTexture")}drawModel(t,e,i,n,r,o,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,20,12),t.calculateMVPMatrix(i,n,r,o,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("DiffuseShader glDrawElements")}}var v=1e-6,x="undefined"!=typeof Float32Array?Float32Array:Array;function b(){var t=new x(16);return x!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function E(t){var e=new x(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function T(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],h=e[7],d=e[8],c=e[9],u=e[10],f=e[11],m=e[12],_=e[13],g=e[14],p=e[15],v=i*a-n*s,x=i*l-r*s,b=i*h-o*s,E=n*l-r*a,T=n*h-o*a,w=r*h-o*l,A=d*_-c*m,C=d*g-u*m,y=d*p-f*m,R=c*g-u*_,M=c*p-f*_,S=u*p-f*g,O=v*S-x*M+b*R+E*y-T*C+w*A;return O?(O=1/O,t[0]=(a*S-l*M+h*R)*O,t[1]=(r*M-n*S-o*R)*O,t[2]=(_*w-g*T+p*E)*O,t[3]=(u*T-c*w-f*E)*O,t[4]=(l*y-s*S-h*C)*O,t[5]=(i*S-r*y+o*C)*O,t[6]=(g*b-m*w-p*x)*O,t[7]=(d*w-u*b+f*x)*O,t[8]=(s*M-a*y+h*A)*O,t[9]=(n*y-i*M-o*A)*O,t[10]=(m*T-_*b+p*v)*O,t[11]=(c*b-d*T-f*v)*O,t[12]=(a*C-s*R-l*A)*O,t[13]=(i*R-n*C+r*A)*O,t[14]=(_*x-m*E-g*v)*O,t[15]=(d*E-c*x+u*v)*O,t):null}function A(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],f=e[10],m=e[11],_=e[12],g=e[13],p=e[14],v=e[15],x=i[0],b=i[1],E=i[2],T=i[3];return t[0]=x*n+b*a+E*c+T*_,t[1]=x*r+b*l+E*u+T*g,t[2]=x*o+b*h+E*f+T*p,t[3]=x*s+b*d+E*m+T*v,x=i[4],b=i[5],E=i[6],T=i[7],t[4]=x*n+b*a+E*c+T*_,t[5]=x*r+b*l+E*u+T*g,t[6]=x*o+b*h+E*f+T*p,t[7]=x*s+b*d+E*m+T*v,x=i[8],b=i[9],E=i[10],T=i[11],t[8]=x*n+b*a+E*c+T*_,t[9]=x*r+b*l+E*u+T*g,t[10]=x*o+b*h+E*f+T*p,t[11]=x*s+b*d+E*m+T*v,x=i[12],b=i[13],E=i[14],T=i[15],t[12]=x*n+b*a+E*c+T*_,t[13]=x*r+b*l+E*u+T*g,t[14]=x*o+b*h+E*f+T*p,t[15]=x*s+b*d+E*m+T*v,t}function C(t,e,i){var n,r,o,s,a,l,h,d,c,u,f,m,_=i[0],g=i[1],p=i[2];return e===t?(t[12]=e[0]*_+e[4]*g+e[8]*p+e[12],t[13]=e[1]*_+e[5]*g+e[9]*p+e[13],t[14]=e[2]*_+e[6]*g+e[10]*p+e[14],t[15]=e[3]*_+e[7]*g+e[11]*p+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],f=e[10],m=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=h,t[7]=d,t[8]=c,t[9]=u,t[10]=f,t[11]=m,t[12]=n*_+a*g+c*p+e[12],t[13]=r*_+l*g+u*p+e[13],t[14]=o*_+h*g+f*p+e[14],t[15]=s*_+d*g+m*p+e[15]),t}function y(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*n,t[5]=s*r+d*n,t[6]=a*r+c*n,t[7]=l*r+u*n,t[8]=h*r-o*n,t[9]=d*r-s*n,t[10]=c*r-a*n,t[11]=u*r-l*n,t}function R(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*n,t[1]=s*r-d*n,t[2]=a*r-c*n,t[3]=l*r-u*n,t[8]=o*n+h*r,t[9]=s*n+d*r,t[10]=a*n+c*r,t[11]=l*n+u*r,t}function M(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+h*n,t[1]=s*r+d*n,t[2]=a*r+c*n,t[3]=l*r+u*n,t[4]=h*r-o*n,t[5]=d*r-s*n,t[6]=c*r-a*n,t[7]=u*r-l*n,t}function S(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var O=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),h=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*h,t[15]=1,t};function F(){var t=new x(3);return x!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function P(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function D(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}var k,I=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};!function(){var t=F()}(),function(t){t[t.Rotating=0]="Rotating",t[t.Random=1]="Random"}(k||(k={}));class N{constructor(){this._speed=0,this.duration=0,this._minDuration=3e3,this._timer=0,this.lastTime=0,this._reverse=!1,this._cameraPosition=F(),this._cameraRotation=F(),this._matrix=b()}get cameraPosition(){return this._cameraPosition}get cameraRotation(){return this._cameraRotation}set reverse(t){this._reverse=t}set minDuration(t){this._minDuration=t}get matrix(){return this._matrix}get speed(){return this._speed}set speed(t){this._speed=t}get position(){return this._position}set position(t){this._position=t,this.duration=Math.max(this.getLength()/this.speed,this._minDuration)}get timer(){return this._timer}getLength(){if(void 0===this.position)return 0;const t=this.position.start.position,e=this.position.end.position;return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}iterate(t){if(0!=this.lastTime){const e=t-this.lastTime;this._timer+=e/this.duration,this._timer>1&&(this._timer=1)}this.lastTime=t,this.updateMatrix()}reset(){this._timer=0,this.updateMatrix()}updateMatrix(){if(void 0===this._position)return;const t=this._reverse?this._position.end:this._position.start,e=this._reverse?this._position.start:this._position.end;this._cameraPosition[0]=t.position[0]+this._timer*(e.position[0]-t.position[0]),this._cameraPosition[1]=t.position[1]+this._timer*(e.position[1]-t.position[1]),this._cameraPosition[2]=t.position[2]+this._timer*(e.position[2]-t.position[2]),this._cameraRotation[0]=t.rotation[0]+this._timer*(e.rotation[0]-t.rotation[0]),this._cameraRotation[1]=t.rotation[1]+this._timer*(e.rotation[1]-t.rotation[1]),this._cameraRotation[2]=t.rotation[2]+this._timer*(e.rotation[2]-t.rotation[2]),T(this.matrix),y(this.matrix,this.matrix,this._cameraRotation[0]-Math.PI/2),M(this.matrix,this.matrix,this._cameraRotation[1]),R(this.matrix,this.matrix,this._cameraRotation[2]),C(this.matrix,this.matrix,[-this._cameraPosition[0],-this._cameraPosition[1],-this._cameraPosition[2]])}}const L=120,U=16,V=3,B=7,G=19,H=4,X=8,j=1,z=3,$=7,W=[0,0,0];function Y(t,e,i){const n=2*Math.PI*t,r=n*B,o=n*G,s=n*H,a=n*X;let l=L+U*Math.sin(r)+V*Math.sin(o);l+=e;let h=j*Math.sin(s)+z*Math.sin(a);return h+=$,W[0]=Math.sin(n)*l,W[1]=Math.cos(n)*l,W[2]=h,void 0!==i&&(i[0]=W[0],i[1]=W[1],i[2]=W[2]),W}let K=[];function Z(t,e,i){K=[],function(t,e,i,n){for(let r=0;r<e;r++){let o=Math.random()-.5;o>0&&o<i&&(o+=i),o<0&&o>-i&&(o-=i);const[s,a,l]=Y(r/e,o*n);t.push([s,a,l])}}(K,t,e,i);const n=new Float32Array(6*K.length);for(let t=0;t<K.length;t++){const[e,i,r]=K[t];n[3*t+0]=e,n[3*t+1]=i,n[3*t+2]=Math.random();const o=Math.random()*Math.PI*2;n[3*t+0+3*K.length]=Math.sin(o),n[3*t+1+3*K.length]=Math.cos(o),n[3*t+2+3*K.length]=0}return[n,K.length]}const[J,Q]=Z(97,.7,23),[q,tt]=Z(119,.72,25),[et,it]=Z(60,.75,60),[nt,rt]=Z(40,0,10),[ot,st]=Z(70,0,30),[at,lt]=Z(1360,0,60),[ht,dt]=Z(40,0,40),ct=new N;ct.reverse=!0,ct.speed=1e3,ct.minDuration=2e4/1.3,ct.position={start:{position:new Float32Array([-21.162155151367188,257.8841247558594,45]),rotation:new Float32Array([.09479612112045288,3.1140060424804688,0])},end:{position:new Float32Array([13.270217895507812,-567.8276977539062,47]),rotation:new Float32Array([.09479612112045288,3.1140060424804688,0])}};const ut=new N;ut.reverse=!0,ut.speed=1e3,ut.minDuration=3e4/1.3,ut.position={start:{position:new Float32Array([-183.71414184570312,99.32198333740234,45]),rotation:new Float32Array([.17399953305721283,1.7340009212493896,0])},end:{position:new Float32Array([181.34555053710938,29.235549926757812,51]),rotation:new Float32Array([.17399953305721283,1.7340009212493896,0])}};const ft=new N;ft.reverse=!0,ft.speed=1e3,ft.minDuration=24e3/1.3,ft.position={start:{position:new Float32Array([-257.13592529296875,193.58749389648438,45]),rotation:new Float32Array([.13199906051158905,2.6340126991271973,0])},end:{position:new Float32Array([88.29415893554688,-352.470458984375,44]),rotation:new Float32Array([.13199906051158905,2.6340126991271973,0])}};const mt=new N;mt.reverse=!0,mt.speed=1e3,mt.minDuration=22e3/1.3,mt.position={start:{position:new Float32Array([-167.41603088378906,-272.6703796386719,44]),rotation:new Float32Array([.09000006318092346,.9119994640350342,0])},end:{position:new Float32Array([213.55006408691406,31.966976165771484,44]),rotation:new Float32Array([.09000006318092346,.9119994640350342,0])}};const _t=new N;_t.reverse=!0,_t.speed=1e3,_t.minDuration=27e3/1.3,_t.position={start:{position:new Float32Array([249.5919189453125,274.224365234375,45]),rotation:new Float32Array([.12599891424179077,4.177173137664795,0])},end:{position:new Float32Array([-359.8509216308594,-126.64541625976562,46]),rotation:new Float32Array([.03599891439080238,.9239869713783264,0])}};const gt=new N;gt.reverse=!0,gt.speed=1e3,gt.minDuration=28e3/1.3,gt.position={start:{position:new Float32Array([-293.573486328125,-56.97015380859375,44]),rotation:new Float32Array([.1500007063150406,1.7520021200180054,0])},end:{position:new Float32Array([204.3482666015625,-165.2449188232422,44]),rotation:new Float32Array([.1500007063150406,1.7520021200180054,0])}};const pt=[{positionInterpolator:ct,rotation:0},{positionInterpolator:ut,rotation:1.3},{positionInterpolator:ft,rotation:.4},{positionInterpolator:mt,rotation:2.4},{positionInterpolator:_t,rotation:5.2},{positionInterpolator:gt,rotation:1.3}],vt="\n    /** From https://thebookofshaders.com/10/ */\n    float random_vec2 (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n\n    /** Optimized version of the same random() from The Book of Shaders */\n    float random (float st) {\n        return fract(sin(st) * 43758.5453123);\n    }\n    ",xt="\n    /** https://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/ */\n    mat4 rotationMatrix(vec3 axis, float angle)\n    {\n        // axis = normalize(axis);\n        float s = sin(angle);\n        float c = cos(angle);\n        float oc = 1.0 - c;\n        \n        return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                    oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                    oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                    0.0,                                0.0,                                0.0,                                1.0);\n    }  \n\n    /** Optimized version to rotate only around Z axis */\n    mat4 rotationAroundZ(float angle)\n    {\n        float s = sin(angle);\n        float c = cos(angle);\n        \n        return mat4(c,  -s,   0.0, 0.0,\n                    s,   c,   0.0, 0.0,\n                    0.0, 0.0, 1.0, 0.0,\n                    0.0, 0.0, 0.0, 1.0);\n    }\n    ";class bt extends p{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            out mediump vec2 vTexCoord;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${vt}\n            ${xt}\n\n            const float PI2 = 6.28318530718;\n\n            void main(void)\n            {\n                ${bt.COMMON_TRANSFORMS}\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n            }`,this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uScale=this.getUniform("uScale"),this.sPositions=this.getUniform("sPositions"),this.uPositionOffset=this.getUniform("uPositionOffset")}drawModel(t,e,i,n,r,o,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.HALF_FLOAT,!1,12,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.HALF_FLOAT,!1,12,6),t.calculateMVPMatrix(i,n,r,o,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("VertexLitInstancedShader glDrawElements")}drawInstanced(t,e,i,n,r,o,s,a,l,h,d,c,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const f=t.gl;e.bindBuffers(f),f.enableVertexAttribArray(this.rm_Vertex),f.enableVertexAttribArray(this.rm_TexCoord0),f.vertexAttribPointer(this.rm_Vertex,3,f.HALF_FLOAT,!1,12,0),f.vertexAttribPointer(this.rm_TexCoord0,2,f.HALF_FLOAT,!1,12,6),t.calculateMVPMatrix(i,n,r,o,s,a,l,h,d),f.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),f.uniform1i(this.uPositionOffset,c),f.drawElementsInstanced(f.TRIANGLES,3*e.getNumIndices(),f.UNSIGNED_SHORT,0,u),t.checkGlError("InstancedVegetationShader glDrawElements")}}bt.COMMON_TRANSFORMS="\n    vec4 vertex = rm_Vertex;\n    float fInstance = float(gl_InstanceID);\n    int x = uPositionOffset + gl_InstanceID;\n    vec4 translationAndScale = texelFetch(sPositions, ivec2(x, 0), 0); // xy=translation, z=scale\n    vec4 rotations = texelFetch(sPositions, ivec2(x, 1), 0); // x=sin a; y=cos a\n    vec2 translation = translationAndScale.xy;\n    float scale = uScale.x + translationAndScale.z * uScale.y;\n    float s = rotations.x;\n    float c = rotations.y;\n    mat4 rotationMatrix = mat4(\n        c,  -s,   0.0, 0.0,\n        s,   c,   0.0, 0.0,\n        0.0, 0.0, 1.0, 0.0,\n        0.0, 0.0, 0.0, 1.0\n    );\n\n    vertex *= rotationMatrix;\n    vertex *= vec4(scale, scale, scale, 1.0);\n    vertex.xy += translation;\n    ";class Et extends bt{fillCode(){super.fillCode(),this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            void main(void)\n            {\n                fragColor = texture(sTexture, vTexCoord) * color;\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.color=this.getUniform("color")}}var Tt;class wt extends Et{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            out vec3 texCoord;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${vt}\n            ${xt}\n\n            const float PI2 = 6.28318530718;\n\n            ${wt.FOG_VERTEX_UNIFORMS_VARYINGS}\n\n            void main(void)\n            {\n                ${bt.COMMON_TRANSFORMS}\n                vertex.z += rotations.x * heightOffset.x + heightOffset.y;\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n\n                ${wt.FOG_VERTEX_MAIN}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            void main(void)\n            {\n                ${wt.FOG_FRAGMENT_MAIN}\n                vec4 diffuse = texture(sTexture, vTexCoord) * color;\n                fragColor = mix(diffuse, fogColor, fogAmount);\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance"),this.heightFogParams=this.getUniform("heightFogParams"),this.heightOffset=this.getUniform("heightOffset"),this.view_matrix=this.getUniform("view_matrix"),this.texCubemap=this.getUniform("texCubemap")}}Tt=wt,wt.FOG_VERTEX_UNIFORMS_VARYINGS="\n        uniform vec2 heightOffset; // x: random positive/negative offset; y: fixed offset\n        uniform float fogDistance;\n        uniform float fogStartDistance;\n        out float vFogAmount;\n        out float vFogZ;\n        out mediump vec2 vTexCoord;\n        const float ZERO = 0.0;\n        const float ONE = 1.0;\n    ",wt.FOG_FRAGMENT_UNIFORMS_VARYINGS="\n        in float vFogAmount;\n        in float vFogZ;\n        uniform vec2 heightFogParams;\n        in vec3 texCoord;\n        uniform samplerCube texCubemap;\n        const float ZERO = 0.0;\n        const float ONE = 1.0;\n    ",wt.FOG_AMOUNT_VERTEX="\n        float distanceFog = clamp((length(gl_Position) - fogStartDistance) / fogDistance, ZERO, ONE);\n        vFogAmount = clamp(distanceFog, ZERO, ONE);\n    ",wt.FOG_VERTEX_MAIN=`\n        ${Tt.FOG_AMOUNT_VERTEX}\n        vFogZ = vertex.z;\n        texCoord = inverse(mat3(view_matrix)) * (view_matrix * vertex).xyz;\n    `,wt.FOG_AMOUNT_FRAGMENT="\n        float heightFog = clamp(1.0 - ((vFogZ + heightFogParams.x) * heightFogParams.y), ZERO, ONE);\n        float fogAmount = clamp(vFogAmount + heightFog, ZERO, ONE);\n    ",wt.FOG_FRAGMENT_MAIN=`\n        ${Tt.FOG_AMOUNT_FRAGMENT}\n        vec4 fogColor = texture(texCubemap, texCoord);\n    `;class At extends wt{fillCode(){super.fillCode(),this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            void main(void)\n            {\n                ${wt.FOG_FRAGMENT_MAIN}\n                vec4 diffuse = texture(sTexture, vTexCoord) * color;\n                if (diffuse.a < 0.5) {\n                    discard;\n                } else {\n                    fragColor = mix(diffuse, fogColor, fogAmount);\n                }\n            }`}}class Ct extends r{fillCode(){this.vertexShaderCode="#version 300 es\n            precision highp float;\n            uniform mat4 view_proj_matrix;\n            in vec4 rm_Vertex;\n            out vec3 texCoord;\n            uniform mat4 view_matrix;\n\n            void main() {\n                gl_Position = view_proj_matrix * rm_Vertex;\n                vec4 p = view_matrix * rm_Vertex;\n                texCoord = inverse(mat3(view_matrix)) * p.xyz;\n            }",this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n            in vec3 texCoord;\n            out vec4 color;\n            uniform samplerCube texCubemap;\n\n            void main(void) {\n                color = texture(texCubemap, texCoord);\n            }\n        "}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.view_matrix=this.getUniform("view_matrix"),this.texCubemap=this.getUniform("texCubemap"),this.rm_Vertex=this.getAttrib("rm_Vertex")}drawModel(t,e,i,n,r,o,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.texCubemap)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),t.calculateMVPMatrix(i,n,r,o,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("SkyShader glDrawElements")}}class yt extends r{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n            uniform highp mat4 uMVPMatrix;\n            in highp vec4 aPosition1;\n            in highp vec4 aPosition2;\n            uniform float m;\n            in highp vec2 aTextureCoord;\n            out mediump vec2 vTextureCoord;\n            uniform vec2 uSeed;\n\n            ${wt.FOG_VERTEX_UNIFORMS_VARYINGS}\n            out vec3 texCoord;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            ${vt}\n\n            void main() {\n              float fInstance = float(gl_InstanceID);\n              vec4 vertex = mix(aPosition1, aPosition2, m);\n              float r1 = random(fInstance + uSeed.x);\n              float r2 = random(fInstance + uSeed.y);\n              vec3 translation = vec3(\n                150. * r1,\n                300. * r2,\n                42. * r1\n              );\n              vertex.xyz += translation;\n              gl_Position = uMVPMatrix * vertex;\n              vTextureCoord = aTextureCoord;\n              vertex = model_matrix * vertex;\n              ${wt.FOG_VERTEX_MAIN}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            in mediump vec2 vTextureCoord;\n            uniform sampler2D sTexture;\n            out vec4 fragColor;\n            uniform vec4 color;\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            void main() {\n              ${wt.FOG_FRAGMENT_MAIN}\n              vec4 base = texture(sTexture, vTextureCoord);\n              if (base.a < 0.95) {\n                discard;\n              } else {\n                fragColor = mix(base * color, fogColor, fogAmount);\n              }\n            }`}fillUniformsAttributes(){this.maPosition1Handle=this.getAttrib("aPosition1"),this.maPosition2Handle=this.getAttrib("aPosition2"),this.maTextureHandle=this.getAttrib("aTextureCoord"),this.muMVPMatrixHandle=this.getUniform("uMVPMatrix"),this.msTextureHandle=this.getUniform("sTexture"),this.mMHandle=this.getUniform("m"),this.uSeed=this.getUniform("uSeed"),this.color=this.getUniform("color"),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance"),this.heightFogParams=this.getUniform("heightFogParams"),this.view_matrix=this.getUniform("view_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.texCubemap=this.getUniform("texCubemap")}clamp(t,e,i){return Math.max(Math.min(t,i),e)}drawModel(t,e,i,n,r,o,s,a,l,h,d,c,u,f,m){if(void 0===this.muMVPMatrixHandle||void 0===this.msTextureHandle||void 0===this.mMHandle||void 0===this.maPosition1Handle||void 0===this.maPosition2Handle||void 0===this.maTextureHandle)return;const _=t.gl;e.bindBuffers(_);const g=4*(2+3*i),p=3*i*4;_.enableVertexAttribArray(this.maPosition1Handle),_.enableVertexAttribArray(this.maPosition2Handle),_.enableVertexAttribArray(this.maTextureHandle),_.vertexAttribPointer(this.maPosition1Handle,3,_.FLOAT,!1,g,3*n*4),_.vertexAttribPointer(this.maPosition2Handle,3,_.FLOAT,!1,g,3*r*4),_.vertexAttribPointer(this.maTextureHandle,2,_.FLOAT,!1,g,p),t.calculateMVPMatrix(s,a,l,h,d,c,u,f,m),_.uniformMatrix4fv(this.muMVPMatrixHandle,!1,t.getMVPMatrix()),_.uniform1f(this.mMHandle,this.clamp(o,0,1)),_.drawElements(_.TRIANGLES,3*e.getNumIndices(),_.UNSIGNED_SHORT,0),t.checkGlError("glDrawElements")}drawInstanced(t,e,i,n,r,o,s,a,l,h,d,c,u,f,m,_){if(void 0===this.muMVPMatrixHandle||void 0===this.msTextureHandle||void 0===this.mMHandle||void 0===this.maPosition1Handle||void 0===this.maPosition2Handle||void 0===this.maTextureHandle)return;const g=t.gl;e.bindBuffers(g);const p=4*(2+3*i),v=3*i*4;g.enableVertexAttribArray(this.maPosition1Handle),g.enableVertexAttribArray(this.maPosition2Handle),g.enableVertexAttribArray(this.maTextureHandle),g.vertexAttribPointer(this.maPosition1Handle,3,g.FLOAT,!1,p,3*n*4),g.vertexAttribPointer(this.maPosition2Handle,3,g.FLOAT,!1,p,3*r*4),g.vertexAttribPointer(this.maTextureHandle,2,g.FLOAT,!1,p,v),t.calculateMVPMatrix(s,a,l,h,d,c,u,f,m),g.uniformMatrix4fv(this.muMVPMatrixHandle,!1,t.getMVPMatrix()),g.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),g.uniform1f(this.mMHandle,this.clamp(o,0,1)),g.drawElementsInstanced(g.TRIANGLES,3*e.getNumIndices(),g.UNSIGNED_SHORT,0,_),t.checkGlError("glDrawElementsInstanced")}}class Rt extends wt{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            out vec3 texCoord;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            ${vt}\n            ${xt}\n\n            const float PI2 = 6.28318530718;\n\n            ${wt.FOG_VERTEX_UNIFORMS_VARYINGS}\n\n            uniform vec4 color;\n            uniform vec4 colorSun;\n            uniform vec4 lightDir;\n            uniform float diffuseExponent;\n            out vec4 vDiffuseColor;\n\n            void main(void)\n            {\n                ${bt.COMMON_TRANSFORMS}\n                vertex.z += rotations.x * heightOffset.x + heightOffset.y;\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n\n                ${wt.FOG_VERTEX_MAIN}\n\n                vec4 normal = vec4(rm_Normal, 0.0) * rotationMatrix;\n                float d = pow(max(0.0, dot(normal, lightDir)), diffuseExponent);\n\n                vDiffuseColor = mix(colorSun, color, d);\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            in vec4 vDiffuseColor;\n\n            void main(void)\n            {\n                ${wt.FOG_FRAGMENT_MAIN}\n                vec4 diffuse = texture(sTexture, vTexCoord) * vDiffuseColor;\n                fragColor = mix(diffuse, fogColor, fogAmount);\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.colorSun=this.getUniform("colorSun"),this.lightDir=this.getUniform("lightDir"),this.diffuseExponent=this.getUniform("diffuseExponent"),this.rm_Normal=this.getAttrib("rm_Normal")}drawInstanced(t,e,i,n,r,o,s,a,l,h,d,c,u){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix)return;const f=t.gl;e.bindBuffers(f),f.enableVertexAttribArray(this.rm_Vertex),f.enableVertexAttribArray(this.rm_TexCoord0),f.enableVertexAttribArray(this.rm_Normal),f.vertexAttribPointer(this.rm_Vertex,3,f.HALF_FLOAT,!1,16,0),f.vertexAttribPointer(this.rm_TexCoord0,2,f.HALF_FLOAT,!1,16,6),f.vertexAttribPointer(this.rm_Normal,3,f.HALF_FLOAT,!1,16,10),t.calculateMVPMatrix(i,n,r,o,s,a,l,h,d),f.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),f.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),f.uniform1i(this.uPositionOffset,c),f.drawElementsInstanced(f.TRIANGLES,3*e.getNumIndices(),f.UNSIGNED_SHORT,0,u),t.checkGlError("InstancedVegetationShader glDrawElements")}}class Mt extends Rt{fillCode(){this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            out vec3 texCoord;\n\n            uniform vec2 uScale; // x: base scale for models; y: max random additional scale\n            uniform sampler2D sPositions;\n            uniform int uPositionOffset;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            ${vt}\n            ${xt}\n\n            const float PI2 = 6.28318530718;\n\n            ${wt.FOG_VERTEX_UNIFORMS_VARYINGS}\n\n            uniform vec4 color;\n            uniform vec4 colorSun;\n            uniform vec4 lightDir;\n            uniform float diffuseExponent;\n            out vec4 vDiffuseColor;\n            out float vGrass;\n            uniform float grassAmount;\n\n            void main(void)\n            {\n                ${bt.COMMON_TRANSFORMS}\n                vertex.z += rotations.x * heightOffset.x + heightOffset.y;\n\n                gl_Position = view_proj_matrix * vertex;\n                vTexCoord = rm_TexCoord0;\n\n                ${wt.FOG_VERTEX_MAIN}\n\n                vec4 normal = vec4(rm_Normal, 0.0) * rotationMatrix;\n\n                float d = pow(max(0.0, dot(normal, lightDir)), diffuseExponent);\n\n                vDiffuseColor = mix(colorSun, color, d);\n                vGrass = smoothstep(0.2, 0.3, normal.z * grassAmount);\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform sampler2D sTextureGrass;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            in vec4 vDiffuseColor;\n            in float vGrass;\n\n            void main(void)\n            {\n                ${wt.FOG_FRAGMENT_MAIN}\n                vec4 rock = texture(sTexture, vTexCoord);\n                vec4 grass = texture(sTextureGrass, vTexCoord * 5.0);\n                vec4 mixed = mix(rock, grass, vGrass);\n                vec4 diffuse = mixed * vDiffuseColor;\n                fragColor = mix(diffuse, fogColor, fogAmount);\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.sTextureGrass=this.getUniform("sTextureGrass"),this.grassAmount=this.getUniform("grassAmount")}}class St extends p{fillCode(){super.fillCode(),this.vertexShaderCode=`#version 300 es\n            precision highp float;\n\n            uniform mat4 view_proj_matrix;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            out vec3 texCoord;\n\n            in vec2 rm_TexCoord0;\n            in vec4 rm_Vertex;\n\n            ${wt.FOG_VERTEX_UNIFORMS_VARYINGS}\n\n            void main(void)\n            {\n                vec4 vertex = model_matrix * rm_Vertex;\n                gl_Position = view_proj_matrix * rm_Vertex;\n                vTexCoord = rm_TexCoord0;\n                ${wt.FOG_VERTEX_MAIN}\n            }`,this.fragmentShaderCode=`#version 300 es\n            precision mediump float;\n            uniform sampler2D sTexture;\n            uniform vec4 color;\n\n            in mediump vec2 vTexCoord;\n            out vec4 fragColor;\n\n            uniform vec2 uCameraRange;\n            uniform vec2 uInvViewportSize;\n            uniform float uTransitionSize;\n            float calc_depth(in float z)\n            {\n              return (2.0 * uCameraRange.x) / (uCameraRange.y + uCameraRange.x - z*(uCameraRange.y - uCameraRange.x));\n            }\n            uniform sampler2D sDepth;\n            const float NEAR_SMOOTH_FADE = 0.03;\n\n            ${wt.FOG_FRAGMENT_UNIFORMS_VARYINGS}\n\n            void main(void)\n            {\n                vec2 coords = gl_FragCoord.xy * uInvViewportSize; // calculate depth texture coordinates\n                float geometryZ = calc_depth(texture(sDepth, coords).r); // lineriarize particle depth\n                float sceneZ = calc_depth(gl_FragCoord.z); // lineriarize scene depth\n                float a = clamp(geometryZ - sceneZ, 0.0, 1.0); // linear clamped diff between scene and particle depth\n                float b = smoothstep(0.0, uTransitionSize, a); // apply smoothstep to make soft transition\n\n                ${wt.FOG_AMOUNT_FRAGMENT}\n                vec4 diffuse = texture(sTexture, vTexCoord).rrrr * color;\n                b *= smoothstep(ZERO, NEAR_SMOOTH_FADE, sceneZ); // smooth fade out right before near clipping plane\n                fragColor = diffuse * (ONE - fogAmount) * b;\n            }`}fillUniformsAttributes(){super.fillUniformsAttributes(),this.fogStartDistance=this.getUniform("fogStartDistance"),this.fogDistance=this.getUniform("fogDistance"),this.heightFogParams=this.getUniform("heightFogParams"),this.model_matrix=this.getUniform("model_matrix"),this.color=this.getUniform("color"),this.cameraRange=this.getUniform("uCameraRange"),this.sDepth=this.getUniform("sDepth"),this.invViewportSize=this.getUniform("uInvViewportSize"),this.transitionSize=this.getUniform("uTransitionSize")}}class Ot extends f{constructor(){super(),this.lastTime=0,this.loaded=!1,this.fmSky=new n,this.fmRock1=new n,this.fmRock1Grass=new n,this.fmRock2=new n,this.fmRock2Grass=new n,this.fmRock3=new n,this.fmRock3Grass=new n,this.fmTree=new n,this.fmBird=new n,this.fmSmoke=new n,this.noTextures=!1,this.noGlare=!1,this.textureOffscreenColor=null,this.textureOffscreenDepth=null,this.textureRocksPositions1=null,this.textureRocksPositions2=null,this.textureRocksPositions3=null,this.textureRocksPositions4=null,this.textureRocksPositions5=null,this.textureTreesPositions=null,this.animationBird=new g(5),this.Z_NEAR=2,this.Z_FAR=1100,this.SMOKE_SOFTNESS=.012,this.timerCamera=0,this.SPLINE_CAMERA_PERIOD=166e3,this.timerFogThickness=0,this.FOG_THICKNESS_PERIOD=42e3,this.timerBirdAnimation1=0,this.BIRD_ANIMATION_PERIOD1=1200,this.timerRocksMovement=0,this.ROCKS_MOVEMENT_PERIOD=8e3,this.fogStartDistance=0,this.currentPreset=2,this.PRESETS=[{name:"Sunrise",cubemap:"sunrise1",lightDir:[0,1,0,1],diffuseExponent:.025,cloudsColor:[.17,.17,.17,1],colorSun:[1,167/255,53/255,1],colorAmbient:[93/255,81/255,112/255,1]},{name:"Day",cubemap:"day1",lightDir:[0,1,0,1],diffuseExponent:.025,cloudsColor:[.17,.17,.17,1],colorSun:[1,1,1,1],colorAmbient:[61/255,95/255,156/255,1]},{name:"Sunset",cubemap:"sunset1",lightDir:[0,1,0,1],diffuseExponent:.025,cloudsColor:[.17,.17,.17,1],colorSun:[1,.78,.2,1],colorAmbient:[.43,.45,.47,1]},{name:"Night",cubemap:"night1",lightDir:[0,1,0,1],diffuseExponent:.025,cloudsColor:[24/255,28/255,34/255,1],colorSun:[44/255,60/255,93/255,1],colorAmbient:[37/255,42/255,.2,1]}],this.cameraMode=k.Rotating,this.matViewInverted=b(),this.matViewInvertedTransposed=b(),this.matTemp=b(),this.cameraPosition=F(),this.cameraRotation=F(),this.tmpPosition1=[0,0,0],this.tmpPosition2=[0,0,0],this.tmpPosition3=[0,0,0],this.config={fogStartDistance:70,fogDistance:50,fogHeightOffset:2,fogHeightMultiplier:.08,heightOffset:10,treesHeightOffset:5.2,lightDir:[0,1,0,1],diffuseExponent:.025,grassAmount:1.5,cloudsColor:[.17,.17,.17,1],cloudsScale:.3,preset:2},this.v1=F(),this.v2=F(),this.v3=F()}setCustomCamera(t,e,i){this.customCamera=t,void 0!==e&&(this.cameraPosition=e),void 0!==i&&(this.cameraRotation=i)}resetCustomCamera(){this.customCamera=void 0}onBeforeInit(){}onAfterInit(){}onInitError(){var t,e;null===(t=document.getElementById("canvasGL"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("alertError"))||void 0===e||e.classList.remove("hidden")}initShaders(){this.shaderDiffuse=new p(this.gl),this.shaderFogVertexLitGrass=new Mt(this.gl),this.shaderFogAt=new At(this.gl),this.shaderSky=new Ct(this.gl),this.shaderBirds=new yt(this.gl),this.shaderFogSprite=new St(this.gl)}loadFp32Texture(t,e,i,n,r=e.LINEAR,o=e.LINEAR,s=!1,a=3){const l=e.createTexture();if(null===l)throw new Error("Error creating WebGL texture");let h=e.RGB32F,d=e.RGB;2===a?(h=e.RG32F,d=e.RG):1===a?(h=e.R32F,d=e.RED):4===a&&(h=e.RGBA32F,d=e.RGBA);const c=new Float32Array(t);return e.bindTexture(e.TEXTURE_2D,l),this.checkGlError("loadFp32Texture 0"),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,h,i,n,0,d,e.FLOAT,c),this.checkGlError("loadFp32Texture 1"),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),!0===s?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)),this.checkGlError("loadFp32Texture 2"),e.bindTexture(e.TEXTURE_2D,null),l}async loadData(){var t;const e=this.PRESETS[this.currentPreset];this.initOffscreen(),this.initVignette(),await Promise.all([this.fmSky.load("data/models/sky",this.gl),this.fmRock1.load("data/models/rock-8",this.gl),this.fmRock2.load("data/models/rock-11",this.gl),this.fmRock3.load("data/models/rock-6",this.gl),this.fmTree.load("data/models/pinetree",this.gl),this.fmBird.load("data/models/bird-anim-uv",this.gl),this.fmRock1Grass.load("data/models/rock-8-grass",this.gl),this.fmRock2Grass.load("data/models/rock-11-grass",this.gl),this.fmRock3Grass.load("data/models/rock-6-grass",this.gl),this.fmSmoke.load("data/models/cloud",this.gl)]);const n=(t,e)=>this.loadFp32Texture(t,this.gl,e,2,this.gl.NEAREST,this.gl.NEAREST,!0,3);this.textureRocksPositions1=n(J,Q),this.textureRocksPositions2=n(q,tt),this.textureRocksPositions3=n(et,it),this.textureRocksPositions4=n(nt,rt),this.textureRocksPositions5=n(ot,st),this.textureTreesPositions=n(at,lt),[this.textureRocks,this.textureTrees,this.textureFogCubemap,this.textureBirds,this.textureGrass,this.textureFern,this.textureCloud,this.textureWhite]=await Promise.all([i.load("data/textures/rocks.webp",this.gl,void 0,void 0,!0),i.load("data/textures/pine_leaves.webp",this.gl,void 0,void 0,!0),i.loadCubemap(`data/textures/cubemaps/${e.cubemap}/sky`,this.gl,"webp"),i.load("data/textures/bird2.webp",this.gl,void 0,void 0,!0),i.load("data/textures/grass.webp",this.gl,void 0,void 0,!1),i.load("data/textures/fern.webp",this.gl,void 0,void 0,!1),i.load("data/textures/smoke.webp",this.gl),i.load("data/textures/white.webp",this.gl,void 0,void 0,!0)]),this.generateMipmaps(this.textureRocks,this.textureTrees,this.textureGrass,this.textureFern,this.textureCloud,this.textureBirds),this.loaded=!0,console.log("Loaded all assets"),null===(t=this.readyCallback)||void 0===t||t.call(this)}initOffscreen(){void 0!==this.canvas&&(null!==this.textureOffscreenColor&&this.gl.deleteTexture(this.textureOffscreenColor),null!==this.textureOffscreenDepth&&this.gl.deleteTexture(this.textureOffscreenDepth),this.textureOffscreenColor=_.createNpotTexture(this.gl,this.canvas.width,this.canvas.height,!1),this.textureOffscreenDepth=_.createDepthTexture(this.gl,this.canvas.width,this.canvas.height),this.fboOffscreen=new m(this.gl),this.fboOffscreen.textureHandle=this.textureOffscreenColor,this.fboOffscreen.depthTextureHandle=this.textureOffscreenDepth,this.fboOffscreen.width=this.canvas.width,this.fboOffscreen.height=this.canvas.height,this.fboOffscreen.createGLData(this.canvas.width,this.canvas.height),this.checkGlError("offscreen FBO"))}resizeCanvas(){if(void 0===this.canvas)return;const{width:t,height:e}=this.canvas;super.resizeCanvas(),this.canvas.width==t&&this.canvas.height==e||this.initOffscreen()}initVignette(){O(this.matOrtho,-1,1,-1,1,2,250),this.mQuadTriangles=new Float32Array([-1,-1,-5,0,0,1,-1,-5,1,0,-1,1,-5,0,1,1,1,-5,1,1]),this.mTriangleVerticesVignette=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.mTriangleVerticesVignette),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.mQuadTriangles,this.gl.STATIC_DRAW)}async changeScene(t){const e=null!=t?t:(this.currentPreset+1)%4,n=await i.loadCubemap(`data/textures/cubemaps/${this.PRESETS[e].cubemap}/sky`,this.gl,"webp");this.gl.deleteTexture(this.textureFogCubemap),this.textureFogCubemap=n,this.currentPreset=e}animate(){const t=(new Date).getTime();0!=this.lastTime&&(this.timerCamera=this.cameraMode===k.Rotating?t%this.SPLINE_CAMERA_PERIOD/this.SPLINE_CAMERA_PERIOD:0,this.timerFogThickness=t%this.FOG_THICKNESS_PERIOD/this.FOG_THICKNESS_PERIOD,this.timerBirdAnimation1=t%this.BIRD_ANIMATION_PERIOD1/this.BIRD_ANIMATION_PERIOD1,this.timerRocksMovement=t%this.ROCKS_MOVEMENT_PERIOD/this.ROCKS_MOVEMENT_PERIOD),this.lastTime=t}setCameraFOV(t){var e;e=this.gl.canvas.height>0?this.gl.canvas.width/this.gl.canvas.height:1;let i=0;i=this.gl.canvas.width>=this.gl.canvas.height?60*t:70*t,this.setFOV(this.mProjMatrix,i,e,this.Z_NEAR,this.Z_FAR)}positionCamera(t){void 0===this.customCamera?(Y(t,0,this.tmpPosition1),Y(t+.02,0,this.tmpPosition2),Y(t+.0205,0,this.tmpPosition3),this.cameraPosition[0]=this.tmpPosition1[0],this.cameraPosition[1]=this.tmpPosition1[1],this.cameraPosition[2]=this.tmpPosition1[2],I(this.v1,this.tmpPosition2,this.tmpPosition1),I(this.v2,this.tmpPosition3,this.tmpPosition1),D(this.v1,this.v1),D(this.v2,this.v2),function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s}(this.v3,this.v1,this.v2),function(t,e,i,n){var r,o,s,a,l,h,d,c,u,f,m=e[0],_=e[1],g=e[2],p=n[0],x=n[1],b=n[2],E=i[0],w=i[1],A=i[2];Math.abs(m-E)<v&&Math.abs(_-w)<v&&Math.abs(g-A)<v?T(t):(d=m-E,c=_-w,u=g-A,r=x*(u*=f=1/Math.hypot(d,c,u))-b*(c*=f),o=b*(d*=f)-p*u,s=p*c-x*d,(f=Math.hypot(r,o,s))?(r*=f=1/f,o*=f,s*=f):(r=0,o=0,s=0),a=c*s-u*o,l=u*r-d*s,h=d*o-c*r,(f=Math.hypot(a,l,h))?(a*=f=1/f,l*=f,h*=f):(a=0,l=0,h=0),t[0]=r,t[1]=a,t[2]=d,t[3]=0,t[4]=o,t[5]=l,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=u,t[11]=0,t[12]=-(r*m+o*_+s*g),t[13]=-(a*m+l*_+h*g),t[14]=-(d*m+c*_+u*g),t[15]=1)}(this.mVMatrix,this.tmpPosition1,this.tmpPosition2,[0,-6*this.v3[2],1])):this.mVMatrix=this.customCamera}drawScene(){this.loaded&&(this.positionCamera(this.timerCamera),this.setCameraFOV(1),this.gl.clearColor(0,0,0,0),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fboOffscreen.framebufferHandle),this.gl.viewport(0,0,this.fboOffscreen.width,this.fboOffscreen.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.drawOffscreenObjects(),this.gl.clearColor(0,0,0,0),this.cameraMode===k.Random&&this.gl.clearColor(1,0,1,1),this.positionCamera(this.timerCamera),this.setCameraFOV(1),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.drawSceneObjects())}drawTestDepth(){this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND),this.shaderDiffuse.use(),this.setTexture2D(0,this.textureOffscreenDepth,this.shaderDiffuse.sTexture),this.drawVignette(this.shaderDiffuse)}drawVignette(t){this.unbindBuffers(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.mTriangleVerticesVignette),this.gl.enableVertexAttribArray(t.rm_Vertex),this.gl.vertexAttribPointer(t.rm_Vertex,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(t.rm_TexCoord0),this.gl.vertexAttribPointer(t.rm_TexCoord0,2,this.gl.FLOAT,!1,20,12),this.gl.uniformMatrix4fv(t.view_proj_matrix,!1,this.getOrthoMatrix()),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}drawOffscreenObjects(){this.drawRocks()}drawSceneObjects(){void 0!==this.shaderDiffuse?(this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND),this.fogStartDistance=.666*this.config.fogStartDistance+.333*this.config.fogStartDistance*(.5*(Math.sin(2*Math.PI*this.timerFogThickness)+1)),this.drawRocks(),this.drawBirds(),this.gl.enable(this.gl.CULL_FACE),this.drawSkyObject(),this.gl.depthMask(!1),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.drawClouds(),this.gl.disable(this.gl.BLEND),this.gl.depthMask(!0)):console.log("undefined shaders")}drawClouds(){if(void 0===this.shaderFogSprite)return void console.log("undefined shaders");const t=this.PRESETS[this.currentPreset];this.gl.enable(this.gl.CULL_FACE);const e=this.shaderFogSprite;e.use(),this.gl.uniform1f(e.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(e.fogDistance,this.config.fogDistance),this.gl.uniform2f(e.heightFogParams,this.config.fogHeightOffset,this.config.fogHeightMultiplier),this.setTexture2D(0,this.textureCloud,e.sTexture),this.gl.uniform4fv(e.color,t.cloudsColor),this.gl.uniform2f(e.cameraRange,this.Z_NEAR,this.Z_FAR),this.gl.uniform2f(e.invViewportSize,1/this.gl.canvas.width,1/this.gl.canvas.height),this.gl.uniform1f(e.transitionSize,this.SMOKE_SOFTNESS),this.setTexture2D(1,this.textureOffscreenDepth,e.sDepth),this.drawCloudModels(e,this.fmSmoke,ht,dt,this.config.cloudsScale,0,[0,0,12])}drawRocks(){if(void 0===this.shaderFogVertexLitGrass||void 0===this.shaderFogAt||void 0===this.shaderFogSprite||void 0===this.shaderDiffuse)return void console.log("undefined shaders");const t=this.PRESETS[this.currentPreset];let e;this.gl.enable(this.gl.CULL_FACE),e=this.shaderFogAt,e.use(),this.gl.uniform1f(e.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(e.fogDistance,this.config.fogDistance),this.gl.uniform2f(e.heightFogParams,this.config.fogHeightOffset,this.config.fogHeightMultiplier),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureTrees,e.sTexture),this.gl.uniformMatrix4fv(e.view_matrix,!1,this.getViewMatrix()),this.setTextureCubemap(2,this.textureFogCubemap,e.texCubemap),this.gl.uniform2f(e.heightOffset,0,-this.config.treesHeightOffset),this.drawInstances(e,this.fmTree,this.textureTreesPositions,lt,[.003,.003],[0,0,0]),e=this.shaderFogVertexLitGrass,e.use(),this.gl.uniform1f(e.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(e.fogDistance,this.config.fogDistance),this.gl.uniform2f(e.heightFogParams,this.config.fogHeightOffset,this.config.fogHeightMultiplier),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureRocks,e.sTexture),this.gl.uniformMatrix4fv(e.view_matrix,!1,this.getViewMatrix()),this.setTextureCubemap(2,this.textureFogCubemap,e.texCubemap),this.gl.uniform4fv(this.shaderFogVertexLitGrass.colorSun,t.colorSun),this.gl.uniform4fv(this.shaderFogVertexLitGrass.lightDir,t.lightDir),this.gl.uniform1f(this.shaderFogVertexLitGrass.diffuseExponent,this.config.diffuseExponent),this.gl.uniform1f(this.shaderFogVertexLitGrass.grassAmount,this.config.grassAmount),this.setTexture2D(3,this.noTextures?this.textureWhite:this.textureGrass,this.shaderFogVertexLitGrass.sTextureGrass),this.gl.uniform2f(e.heightOffset,this.config.heightOffset,.25*this.config.heightOffset),this.drawInstances(e,this.fmRock1,this.textureRocksPositions1,Q,[.0055,.004]),this.drawInstances(e,this.fmRock2,this.textureRocksPositions2,tt,[.006,.004]),this.gl.uniform2f(e.heightOffset,0,0),this.drawInstances(e,this.fmRock3,this.textureRocksPositions3,it,[.012,.004]);const i=6*Math.sin(this.timerRocksMovement*Math.PI*2);this.gl.uniform2f(e.heightOffset,i,34),this.drawInstances(e,this.fmRock1,this.textureRocksPositions4,rt,[.0055,.004]),this.gl.uniform2f(e.heightOffset,0,-14),this.drawInstances(e,this.fmRock1,this.textureRocksPositions5,st,[.0055,.004]),this.gl.disable(this.gl.CULL_FACE),e=this.shaderFogAt,e.use(),this.gl.uniform1f(e.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(e.fogDistance,this.config.fogDistance),this.gl.uniform2f(e.heightFogParams,this.config.fogHeightOffset,this.config.fogHeightMultiplier),this.gl.uniformMatrix4fv(e.view_matrix,!1,this.getViewMatrix()),this.setTextureCubemap(2,this.textureFogCubemap,e.texCubemap),this.gl.uniform2f(e.heightOffset,0,-this.config.treesHeightOffset),this.setTexture2D(1,this.noTextures?this.textureWhite:this.textureFern,e.sTexture),this.gl.uniform2f(e.heightOffset,this.config.heightOffset,.25*this.config.heightOffset),this.drawInstances(e,this.fmRock1Grass,this.textureRocksPositions1,Q,[.0055,.004]),this.drawInstances(e,this.fmRock2Grass,this.textureRocksPositions2,tt,[.006,.004]),this.gl.uniform2f(e.heightOffset,0,0),this.drawInstances(e,this.fmRock3Grass,this.textureRocksPositions3,it,[.012,.004]),this.gl.uniform2f(e.heightOffset,i,34),this.drawInstances(e,this.fmRock1Grass,this.textureRocksPositions4,rt,[.0055,.004]),this.gl.uniform2f(e.heightOffset,0,-14),this.drawInstances(e,this.fmRock1Grass,this.textureRocksPositions5,st,[.0055,.004])}drawInstances(t,e,i,n,r,o=[0,0,0]){const s=this.PRESETS[this.currentPreset];this.setTexture2D(0,i,t.sPositions),this.gl.uniform4fv(t.color,s.colorAmbient),this.gl.uniform2fv(t.uScale,r);const a=Math.floor(n*(this.timerCamera-.05)),l=Math.floor(.25*n);a>0&&a+l<=n?t.drawInstanced(this,e,o[0],o[1],o[2],0,0,0,1,1,1,a,l):a<=0?(t.drawInstanced(this,e,o[0],o[1],o[2],0,0,0,1,1,1,n+a,-a),t.drawInstanced(this,e,o[0],o[1],o[2],0,0,0,1,1,1,0,l+a)):(t.drawInstanced(this,e,o[0],o[1],o[2],0,0,0,1,1,1,a,n-a),t.drawInstanced(this,e,o[0],o[1],o[2],0,0,0,1,1,1,0,l-(n-a)))}drawCloudModels(t,e,i,n,r=1,o=0,s=[0,0,0]){const a=(n,a)=>{for(let l=n;l<n+a;l++){const n=i[3*l+0],a=i[3*l+1],h=i[3*l+2];this.drawDiffuseVBOFacingCamera(t,e,n+s[0],a+s[1],h+s[2],r,r,r,o)}},l=Math.floor(n*(this.timerCamera-.05)),h=Math.floor(.25*n);l>0&&l+h<=n?a(l,h):l<=0?(a(n+l,-l),a(0,h+l)):(a(l,n-l),a(0,h-(n-l)))}drawBirds(){const t=this.PRESETS[this.currentPreset];this.shaderBirds.use(),this.setTexture2D(0,this.noTextures?this.textureWhite:this.textureBirds,this.shaderBirds.msTextureHandle),this.setTextureCubemap(1,this.textureFogCubemap,this.shaderBirds.texCubemap),this.gl.uniform1f(this.shaderBirds.fogStartDistance,this.fogStartDistance),this.gl.uniform1f(this.shaderBirds.fogDistance,this.config.fogDistance),this.gl.uniform2f(this.shaderBirds.heightFogParams,this.config.fogHeightOffset,this.config.fogHeightMultiplier),this.gl.uniformMatrix4fv(this.shaderBirds.view_matrix,!1,this.getViewMatrix()),this.gl.uniform4fv(this.shaderBirds.color,t.colorSun);const e=(new Date).getTime();for(let t=0;t<pt.length;t++){const{positionInterpolator:i,rotation:n}=pt[t];i.iterate(e),i.timer>.99&&i.reset(),this.drawBirdsFlock(9,i.cameraPosition[0],i.cameraPosition[1],i.cameraPosition[2]-20,n,.4,1)}}drawBirdsFlock(t,e,i,n,r,o,s){var a,l;this.animationBird.animate(this.timerBirdAnimation1),this.gl.uniform2f(this.shaderBirds.uSeed,1.1*s,2.2*s),null===(a=this.shaderBirds)||void 0===a||a.drawInstanced(this,this.fmBird,this.animationBird.getFramesCount(),this.animationBird.getStart(),this.animationBird.getEnd(),this.animationBird.getCurrentCoeff(),e,i,n,0,0,r,o,o,o,t),this.animationBird.animate((this.timerBirdAnimation1+.3)%1),this.gl.uniform2f(this.shaderBirds.uSeed,12.5*s,13.5*s),null===(l=this.shaderBirds)||void 0===l||l.drawInstanced(this,this.fmBird,this.animationBird.getFramesCount(),this.animationBird.getStart(),this.animationBird.getEnd(),this.animationBird.getCurrentCoeff(),e,i,n,0,0,r,o,o,o,t)}drawSkyObject(){void 0!==this.shaderSky&&(this.shaderSky.use(),this.setTextureCubemap(0,this.textureFogCubemap,this.shaderSky.texCubemap),this.shaderSky.drawModel(this,this.fmSky,0,0,0,0,0,0,1,1,1))}toggleGlare(){this.noGlare=!this.noGlare}changeCameraMode(){this.cameraMode===k.Random?this.cameraMode=k.Rotating:this.cameraMode=k.Random}checkGlError(t){}set ready(t){this.readyCallback=t}drawDiffuseVBOFacingCamera(t,e,i,n,r,o,s,a,l){e.bindBuffers(this.gl),this.gl.enableVertexAttribArray(t.rm_Vertex),this.gl.enableVertexAttribArray(t.rm_TexCoord0),this.gl.vertexAttribPointer(t.rm_Vertex,3,this.gl.FLOAT,!1,20,0),this.gl.vertexAttribPointer(t.rm_TexCoord0,2,this.gl.FLOAT,!1,20,12),this.calculateMVPMatrixForSprite(i,n,r,o,s,a,l),this.gl.uniformMatrix4fv(t.view_proj_matrix,!1,this.mMVPMatrix),this.gl.uniformMatrix4fv(t.model_matrix,!1,this.getModelMatrix()),this.gl.drawElements(this.gl.TRIANGLES,3*e.getNumIndices(),this.gl.UNSIGNED_SHORT,0),this.checkGlError("glDrawElements")}calculateMVPMatrixForSprite(t,e,i,n,r,o,s){T(this.mMMatrix),C(this.mMMatrix,this.mMMatrix,[t,e,i]),function(t,e,i){var n=i[0],r=i[1],o=i[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.mMMatrix,this.mMMatrix,[n,r,o]),A(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),this.resetMatrixRotations(this.mMVPMatrix),M(this.mMVPMatrix,this.mMVPMatrix,s),A(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}resetMatrixRotations(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]=e,t[4]=0,t[8]=0,t[1]=0,t[5]=e,t[9]=0,t[2]=0,t[6]=0,t[10]=e,t[3]=0,t[7]=0,t[11]=0,t[15]=1}}class Ft{get angles(){return this._angles}set angles(t){this._angles=t,this._dirty=!0}get position(){return this._position}set position(t){this._position=t,this._dirty=!0}get viewMat(){if(this._dirty){var t=this._viewMat;T(t),y(t,t,this.angles[0]-Math.PI/2),M(t,t,this.angles[1]),R(t,t,this.angles[2]),C(t,t,[-this.position[0],-this.position[1],-this.position[2]]),this._dirty=!1}return this._viewMat}constructor(t){var e,i;this._dirty=!0,this._angles=F(),this._position=F(),this.speed=100,this.rotationSpeed=.025,this._cameraMat=b(),this._viewMat=b(),this.projectionMat=b(),this.pressedKeys=new Array,this.canvas=t.canvas,this.speed=null!==(e=t.movementSpeed)&&void 0!==e?e:100,this.rotationSpeed=null!==(i=t.rotationSpeed)&&void 0!==i?i:.025;let n,r,o=!1;window.addEventListener("keydown",(t=>this.pressedKeys[t.keyCode]=!0)),window.addEventListener("keyup",(t=>this.pressedKeys[t.keyCode]=!1)),this.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),this.canvas.addEventListener("mousedown",(t=>{3===t.which&&(o=!0),n=t.pageX,r=t.pageY})),this.canvas.addEventListener("mousemove",(t=>{if(o){let e=t.pageX-n,i=t.pageY-r;n=t.pageX,r=t.pageY,this.angles[1]+=e*this.rotationSpeed,this.angles[1]<0&&(this.angles[1]+=2*Math.PI),this.angles[1]>=2*Math.PI&&(this.angles[1]-=2*Math.PI),this.angles[0]+=i*this.rotationSpeed,this.angles[0]<.5*-Math.PI&&(this.angles[0]=.5*-Math.PI),this.angles[0]>.5*Math.PI&&(this.angles[0]=.5*Math.PI),this._dirty=!0}})),this.canvas.addEventListener("mouseup",(t=>o=!1))}update(t){const e=F();let i=this.speed/1e3*t;if(this.pressedKeys[16]&&(i*=5),this.pressedKeys["W".charCodeAt(0)]&&(e[1]+=i),this.pressedKeys["S".charCodeAt(0)]&&(e[1]-=i),this.pressedKeys["A".charCodeAt(0)]&&(e[0]-=i),this.pressedKeys["D".charCodeAt(0)]&&(e[0]+=i),this.pressedKeys[32]&&(e[2]+=i),this.pressedKeys["C".charCodeAt(0)]&&(e[2]-=i),0!==e[0]||0!==e[1]||0!==e[2]){let t=this._cameraMat;T(t),y(t,t,this.angles[0]),M(t,t,this.angles[1]),w(t,t),function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];s=s||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s}(e,e,t),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this.position,this.position,e),this._dirty=!0}}}var Pt;!function(t){t[t.Free=0]="Free",t[t.Predefined=1]="Predefined"}(Pt||(Pt={}));class Dt{constructor(t,e){this.renderer=t,this.options=e,this.matCamera=b(),this.matInvCamera=new Float32Array(16),this.vec3Eye=new Float32Array(3),this.vec3Rotation=new Float32Array(3),this.mode=Pt.Predefined,this.setupControls()}setupControls(){document.addEventListener("dblclick",(t=>{var e;if(this.mode===Pt.Predefined){this.matCamera=E(this.renderer.getViewMatrix()),this.renderer.setCustomCamera(this.matCamera),this.mode=Pt.Free,w(this.matInvCamera,this.matCamera),S(this.vec3Eye,this.matInvCamera),D(this.vec3Rotation,this.vec3Eye),P(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(e=this.fpsCamera)&&void 0!==e?e:new Ft(this.options),this.fpsCamera.position=this.vec3Eye;const t=e=>{this.mode===Pt.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(t))};t()}else this.renderer.resetCustomCamera(),this.mode=Pt.Predefined})),document.addEventListener("keypress",(t=>{var e;if("Enter"===t.code)if(this.mode===Pt.Predefined){this.matCamera=E(this.renderer.getViewMatrix()),this.renderer.setCustomCamera(this.matCamera),this.mode=Pt.Free,w(this.matInvCamera,this.matCamera),S(this.vec3Eye,this.matInvCamera),D(this.vec3Rotation,this.vec3Eye),P(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(e=this.fpsCamera)&&void 0!==e?e:new Ft(this.options),this.fpsCamera.position=this.vec3Eye;const t=e=>{this.mode===Pt.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(t))};t()}else this.renderer.resetCustomCamera(),this.mode=Pt.Predefined}))}}function kt(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),o=Math.round(t.b),s=t.a,a=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===i?"rgb("+n+","+r+","+o+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+o+","+s+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+o+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+o+","+s+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+o+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+",a:"+s+"}":"unknown format"}var It=Array.prototype.forEach,Nt=Array.prototype.slice,Lt={BREAK:{},extend:function(t){return this.each(Nt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(Nt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=Nt.call(arguments);return function(){for(var e=Nt.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(It&&t.forEach&&t.forEach===It)t.forEach(e,i);else if(t.length===t.length+0){var n,r=void 0;for(r=0,n=t.length;r<n;r++)if(r in t&&e.call(i,t[r],r)===this.BREAK)return}else for(var o in t)if(e.call(i,t[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var r=this,o=arguments;var s=i||!n;clearTimeout(n),n=setTimeout((function(){n=null,i||t.apply(r,o)}),e),s&&t.apply(r,o)}},toArray:function(t){return t.toArray?t.toArray():Nt.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},Ut=[{litmus:Lt.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:kt},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:kt},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:kt},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:kt}}},{litmus:Lt.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:Lt.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:Lt.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(Lt.isNumber(t.r)&&Lt.isNumber(t.g)&&Lt.isNumber(t.b)&&Lt.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(Lt.isNumber(t.r)&&Lt.isNumber(t.g)&&Lt.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(Lt.isNumber(t.h)&&Lt.isNumber(t.s)&&Lt.isNumber(t.v)&&Lt.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(Lt.isNumber(t.h)&&Lt.isNumber(t.s)&&Lt.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],Vt=void 0,Bt=void 0,Gt=function(){Bt=!1;var t=arguments.length>1?Lt.toArray(arguments):arguments[0];return Lt.each(Ut,(function(e){if(e.litmus(t))return Lt.each(e.conversions,(function(e,i){if(Vt=e.read(t),!1===Bt&&!1!==Vt)return Bt=Vt,Vt.conversionName=i,Vt.conversion=e,Lt.BREAK})),Lt.BREAK})),Bt},Ht=void 0,Xt={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=i*(1-e),s=i*(1-r*e),a=i*(1-(1-r)*e),l=[[i,a,o],[s,i,o],[o,i,a],[o,s,i],[a,o,i],[i,o,s]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),r=Math.max(t,e,i),o=r-n,s=void 0;return 0===r?{h:NaN,s:0,v:0}:(s=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,(s/=6)<0&&(s+=1),{h:360*s,s:o/r,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(Ht=8*e)|t&~(255<<Ht)}},jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},$t=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Wt=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0},Yt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Kt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Zt=function(){function t(){if(zt(this,t),this.__state=Gt.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return $t(t,[{key:"toString",value:function(){return kt(this)}},{key:"toHexString",value:function(){return kt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function Jt(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||Zt.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(Zt.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function Qt(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||Zt.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(Zt.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}Zt.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=Xt.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");Lt.extend(t.__state,Xt.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},Zt.recalculateHSV=function(t){var e=Xt.rgb_to_hsv(t.r,t.g,t.b);Lt.extend(t.__state,{s:e.s,v:e.v}),Lt.isNaN(e.h)?Lt.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},Zt.COMPONENTS=["r","g","b","h","s","v","hex","a"],Jt(Zt.prototype,"r",2),Jt(Zt.prototype,"g",1),Jt(Zt.prototype,"b",0),Qt(Zt.prototype,"h"),Qt(Zt.prototype,"s"),Qt(Zt.prototype,"v"),Object.defineProperty(Zt.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(Zt.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=Xt.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var qt=function(){function t(e,i){zt(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return $t(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),te={};Lt.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){Lt.each(t,(function(t){te[t]=e}))}));var ee=/(\d+(\.\d+)?)px/;function ie(t){if("0"===t||Lt.isUndefined(t))return 0;var e=t.match(ee);return Lt.isNull(e)?0:parseFloat(e[1])}var ne={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,r=e;Lt.isUndefined(r)&&(r=!0),Lt.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var r=i||{},o=te[e];if(!o)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var a=r.x||r.clientX||0,l=r.y||r.clientY||0;s.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=s.initKeyboardEvent||s.initKeyEvent;Lt.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:s.initEvent(e,r.bubbles||!1,r.cancelable||!0)}Lt.defaults(s,n),t.dispatchEvent(s)},bind:function(t,e,i,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on"+e,i),ne},unbind:function(t,e,i,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on"+e,i),ne},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ne},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return ne},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return ie(e["border-left-width"])+ie(e["border-right-width"])+ie(e["padding-left"])+ie(e["padding-right"])+ie(e.width)},getHeight:function(t){var e=getComputedStyle(t);return ie(e["border-top-width"])+ie(e["border-bottom-width"])+ie(e["padding-top"])+ie(e["padding-bottom"])+ie(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},re=function(t){function e(t,i){zt(this,e);var n=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),ne.bind(n.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return Yt(e,qt),$t(e,[{key:"setValue",value:function(t){var i=Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),oe=function(t){function e(t,i,n){zt(this,e);var r=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=n,s=r;if(r.__select=document.createElement("select"),Lt.isArray(o)){var a={};Lt.each(o,(function(t){a[t]=t})),o=a}return Lt.each(o,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),s.__select.appendChild(i)})),r.updateDisplay(),ne.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),r.domElement.appendChild(r.__select),r}return Yt(e,qt),$t(e,[{key:"setValue",value:function(t){var i=Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return ne.isActive(this.__select)?this:(this.__select.value=this.getValue(),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),se=function(t){function e(t,i){zt(this,e);var n=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;function o(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),ne.bind(n.__input,"keyup",o),ne.bind(n.__input,"change",o),ne.bind(n.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),ne.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return Yt(e,qt),$t(e,[{key:"updateDisplay",value:function(){return ne.isActive(this.__input)||(this.__input.value=this.getValue()),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function ae(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var le=function(t){function e(t,i,n){zt(this,e);var r=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=n||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,Lt.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=ae(r.__impliedStep),r}return Yt(e,qt),$t(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=ae(t),this}}]),e}();var he=function(t){function e(t,i,n){zt(this,e);var r=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.__truncationSuspended=!1;var o=r,s=void 0;function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(t){var e=s-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),s=t.clientY}function h(){ne.unbind(window,"mousemove",l),ne.unbind(window,"mouseup",h),a()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),ne.bind(r.__input,"change",(function(){var t=parseFloat(o.__input.value);Lt.isNaN(t)||o.setValue(t)})),ne.bind(r.__input,"blur",(function(){a()})),ne.bind(r.__input,"mousedown",(function(t){ne.bind(window,"mousemove",l),ne.bind(window,"mouseup",h),s=t.clientY})),ne.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,a())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return Yt(e,le),$t(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function de(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var ce=function(t){function e(t,i,n,r,o){zt(this,e);var s=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:r,step:o})),a=s;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(de(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function h(){ne.unbind(window,"mousemove",l),ne.unbind(window,"mouseup",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(t){var e=t.touches[0].clientX,i=a.__background.getBoundingClientRect();a.setValue(de(e,i.left,i.right,a.__min,a.__max))}function c(){ne.unbind(window,"touchmove",d),ne.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),ne.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),ne.bind(window,"mousemove",l),ne.bind(window,"mouseup",h),l(t)})),ne.bind(s.__background,"touchstart",(function(t){if(1!==t.touches.length)return;ne.bind(window,"touchmove",d),ne.bind(window,"touchend",c),d(t)})),ne.addClass(s.__background,"slider"),ne.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return Yt(e,le),$t(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",Wt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),ue=function(t){function e(t,i,n){zt(this,e);var r=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,ne.bind(r.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),ne.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return Yt(e,qt),$t(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),fe=function(t){function e(t,i){zt(this,e);var n=Kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new Zt(n.getValue()),n.__temp=new Zt(0);var r=n;n.domElement=document.createElement("div"),ne.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",ne.bind(n.__input,"keydown",(function(t){13===t.keyCode&&c.call(this)})),ne.bind(n.__input,"blur",c),ne.bind(n.__selector,"mousedown",(function(){ne.addClass(this,"drag").bind(window,"mouseup",(function(){ne.removeClass(r.__selector,"drag")}))})),ne.bind(n.__selector,"touchstart",(function(){ne.addClass(this,"drag").bind(window,"touchend",(function(){ne.removeClass(r.__selector,"drag")}))}));var o,s=document.createElement("div");function a(t){f(t),ne.bind(window,"mousemove",f),ne.bind(window,"touchmove",f),ne.bind(window,"mouseup",h),ne.bind(window,"touchend",h)}function l(t){m(t),ne.bind(window,"mousemove",m),ne.bind(window,"touchmove",m),ne.bind(window,"mouseup",d),ne.bind(window,"touchend",d)}function h(){ne.unbind(window,"mousemove",f),ne.unbind(window,"touchmove",f),ne.unbind(window,"mouseup",h),ne.unbind(window,"touchend",h),u()}function d(){ne.unbind(window,"mousemove",m),ne.unbind(window,"touchmove",m),ne.unbind(window,"mouseup",d),ne.unbind(window,"touchend",d),u()}function c(){var t=Gt(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function u(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,o=i.clientY,s=(n-e.left)/(e.right-e.left),a=1-(o-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),r.__color.v=a,r.__color.s=s,r.setValue(r.__color.toOriginal()),!1}function m(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return Lt.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Lt.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Lt.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Lt.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Lt.extend(s.style,{width:"100%",height:"100%",background:"none"}),_e(s,"top","rgba(0,0,0,0)","#000"),Lt.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=n.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Lt.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),ne.bind(n.__saturation_field,"mousedown",a),ne.bind(n.__saturation_field,"touchstart",a),ne.bind(n.__field_knob,"mousedown",a),ne.bind(n.__field_knob,"touchstart",a),ne.bind(n.__hue_field,"mousedown",l),ne.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(s),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return Yt(e,qt),$t(e,[{key:"updateDisplay",value:function(){var t=Gt(this.getValue());if(!1!==t){var e=!1;Lt.each(Zt.COMPONENTS,(function(i){if(!Lt.isUndefined(t[i])&&!Lt.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&Lt.extend(this.__color.__state,t)}Lt.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;Lt.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,_e(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Lt.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(),me=["-moz-","-o-","-webkit-","-ms-",""];function _e(t,e,i,n){t.style.background="",Lt.each(me,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "}))}var ge=function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},pe='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ve=function(t,e){var i=t[e];return Lt.isArray(arguments[2])||Lt.isObject(arguments[2])?new oe(t,e,arguments[2]):Lt.isNumber(i)?Lt.isNumber(arguments[2])&&Lt.isNumber(arguments[3])?Lt.isNumber(arguments[4])?new ce(t,e,arguments[2],arguments[3],arguments[4]):new ce(t,e,arguments[2],arguments[3]):Lt.isNumber(arguments[4])?new he(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new he(t,e,{min:arguments[2],max:arguments[3]}):Lt.isString(i)?new se(t,e):Lt.isFunction(i)?new ue(t,e,""):Lt.isBoolean(i)?new re(t,e):null};var xe=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},be=function(){function t(){zt(this,t),this.backgroundElement=document.createElement("div"),Lt.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ne.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Lt.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;ne.bind(this.backgroundElement,"click",(function(){e.hide()}))}return $t(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Lt.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ne.unbind(t.domElement,"webkitTransitionEnd",e),ne.unbind(t.domElement,"transitionend",e),ne.unbind(t.domElement,"oTransitionEnd",e)};ne.bind(this.domElement,"webkitTransitionEnd",e),ne.bind(this.domElement,"transitionend",e),ne.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-ne.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ne.getHeight(this.domElement)/2+"px"}}]),t}(),Ee=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ge(Ee);var Te="Default",we=function(){try{return!!window.localStorage}catch(t){return!1}}(),Ae=void 0,Ce=!0,ye=void 0,Re=!1,Me=[],Se=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ne.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=Lt.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=Lt.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),Lt.isUndefined(n.load)?n.load={preset:Te}:n.preset&&(n.load.preset=n.preset),Lt.isUndefined(n.parent)&&n.hideable&&Me.push(this),n.resizable=Lt.isUndefined(n.parent)&&n.resizable,n.autoPlace&&Lt.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,o=we&&"true"===localStorage.getItem(Ie(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,Ve(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,a&&(a.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?ne.addClass(i.__ul,t.CLASS_CLOSED):ne.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(t){we&&(o=t,t?ne.bind(window,"unload",s):ne.unbind(window,"unload",s),localStorage.setItem(Ie(i,"isLocal"),t))}}}),Lt.isUndefined(n.parent)){if(this.closed=n.closed||!1,ne.addClass(this.domElement,t.CLASS_MAIN),ne.makeSelectable(this.domElement,!1),we&&o){i.useLocalStorage=!0;var l=localStorage.getItem(Ie(this,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,ne.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(ne.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ne.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ne.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===n.closed&&(n.closed=!0);var h=document.createTextNode(n.name);ne.addClass(h,"controller-name"),a=Oe(i,h);ne.addClass(this.__ul,t.CLASS_CLOSED),ne.addClass(a,"title"),ne.bind(a,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(Lt.isUndefined(n.parent)&&(Ce&&(ye=document.createElement("div"),ne.addClass(ye,"dg"),ne.addClass(ye,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ye),Ce=!1),ye.appendChild(this.domElement),ne.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Ve(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},ne.bind(window,"resize",this.__resizeHandler),ne.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ne.bind(this.__ul,"transitionend",this.__resizeHandler),ne.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&Ue(this),s=function(){we&&"true"===localStorage.getItem(Ie(i,"isLocal"))&&localStorage.setItem(Ie(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=s,n.parent||((r=i.getRoot()).width+=1,Lt.defer((function(){r.width-=1})))};function Oe(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function Fe(t){ne.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&ne.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Pe(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function De(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,i.load&&i.load.remembered){var o=i.load.remembered,s=void 0;if(o[t.preset])s=o[t.preset];else{if(!o[Te])return;s=o[Te]}if(s[n]&&void 0!==s[n][e.property]){var a=s[n][e.property];e.initialValue=a,e.setValue(a)}}}}function ke(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new fe(e,i);else{var o=[e,i].concat(n.factoryArgs);r=ve.apply(t,o)}n.before instanceof qt&&(n.before=n.before.__li),De(t,r),ne.addClass(r.domElement,"c");var s=document.createElement("span");ne.addClass(s,"property-name"),s.innerHTML=r.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(r.domElement);var l=Oe(t,a,n.before);return ne.addClass(l,Se.CLASS_CONTROLLER_ROW),r instanceof fe?ne.addClass(l,"color"):ne.addClass(l,jt(r.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,Lt.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),ke(t,i.object,i.property,{before:n,factoryArgs:[Lt.toArray(arguments)]})}if(Lt.isArray(e)||Lt.isObject(e)){var r=i.__li.nextElementSibling;return i.remove(),ke(t,i.object,i.property,{before:r,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof ce){var n=new he(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});Lt.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],r=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(i,t)}})),ne.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof he){var r=function(e){if(Lt.isNumber(i.__min)&&Lt.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var o=ke(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return o.name(n),r&&o.listen(),o}return e};i.min=Lt.compose(r,i.min),i.max=Lt.compose(r,i.max)}else i instanceof re?(ne.bind(e,"click",(function(){ne.fakeEvent(i.__checkbox,"click")})),ne.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof ue?(ne.bind(e,"click",(function(){ne.fakeEvent(i.__button,"click")})),ne.bind(e,"mouseover",(function(){ne.addClass(i.__button,"hover")})),ne.bind(e,"mouseout",(function(){ne.removeClass(i.__button,"hover")}))):i instanceof fe&&(ne.addClass(e,"color"),i.updateDisplay=Lt.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=Lt.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&Pe(t.getRoot(),!0),e}),i.setValue)}(t,l,r),t.__controllers.push(r),r}function Ie(t,e){return document.location.href+"."+e}function Ne(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Le(t,e){e.style.display=t.useLocalStorage?"block":"none"}function Ue(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){ne.removeClass(t.__closeButton,Se.CLASS_DRAG),ne.unbind(window,"mousemove",i),ne.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),e=r.clientX,ne.addClass(t.__closeButton,Se.CLASS_DRAG),ne.bind(window,"mousemove",i),ne.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),Lt.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),ne.bind(t.__resize_handle,"mousedown",r),ne.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function Ve(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function Be(t,e){var i={};return Lt.each(t.__rememberedObjects,(function(n,r){var o={},s=t.__rememberedObjectIndecesToControllers[r];Lt.each(s,(function(t,i){o[i]=e?t.initialValue:t.getValue()})),i[r]=o})),i}function Ge(t){0!==t.length&&xe.call(window,(function(){Ge(t)})),Lt.each(t,(function(t){t.updateDisplay()}))}Se.toggleHide=function(){Re=!Re,Lt.each(Me,(function(t){t.domElement.style.display=Re?"none":""}))},Se.CLASS_AUTO_PLACE="a",Se.CLASS_AUTO_PLACE_CONTAINER="ac",Se.CLASS_MAIN="main",Se.CLASS_CONTROLLER_ROW="cr",Se.CLASS_TOO_TALL="taller-than-window",Se.CLASS_CLOSED="closed",Se.CLASS_CLOSE_BUTTON="close-button",Se.CLASS_CLOSE_TOP="close-top",Se.CLASS_CLOSE_BOTTOM="close-bottom",Se.CLASS_DRAG="drag",Se.DEFAULT_WIDTH=245,Se.TEXT_CLOSED="Close Controls",Se.TEXT_OPEN="Open Controls",Se._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Se.toggleHide()},ne.bind(window,"keydown",Se._keydownHandler,!1),Lt.extend(Se.prototype,{add:function(t,e){return ke(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return ke(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;Lt.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ye.removeChild(this.domElement);var t=this;Lt.each(this.__folders,(function(e){t.removeFolder(e)})),ne.unbind(window,"keydown",Se._keydownHandler,!1),Fe(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new Se(e);this.__folders[t]=i;var n=Oe(this,i.domElement);return ne.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Fe(t);var e=this;Lt.each(t.__folders,(function(e){t.removeFolder(e)})),Lt.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=ne.getOffset(t.__ul).top,i=0;Lt.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=ne.getHeight(e))})),window.innerHeight-e-20<i?(ne.addClass(t.domElement,Se.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(ne.removeClass(t.domElement,Se.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&Lt.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:Lt.debounce((function(){this.onResize()}),50),remember:function(){if(Lt.isUndefined(Ae)&&((Ae=new be).domElement.innerHTML=pe),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Lt.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");ne.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),ne.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",ne.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",ne.addClass(n,"button"),ne.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",ne.addClass(r,"button"),ne.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",ne.addClass(o,"button"),ne.addClass(o,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?Lt.each(t.load.remembered,(function(e,i){Ne(t,i,i===t.preset)})):Ne(t,Te,!1);if(ne.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(o),we){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Ie(t,"isLocal"))&&l.setAttribute("checked","checked"),Le(t,a),ne.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,Le(t,a)}))}var h=document.getElementById("dg-new-constructor");ne.bind(h,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||Ae.hide()})),ne.bind(i,"click",(function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),Ae.show(),h.focus(),h.select()})),ne.bind(n,"click",(function(){t.save()})),ne.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),ne.bind(o,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&Ve(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=Be(this)),t.folders={},Lt.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Be(this),Pe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[Te]=Be(this,!0)),this.load.remembered[t]=Be(this),this.preset=t,Ne(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){Lt.each(this.__controllers,(function(e){this.getRoot().load.remembered?De(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),Lt.each(this.__folders,(function(t){t.revert(t)})),t||Pe(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&Ge(this.__listening)},updateDisplay:function(){Lt.each(this.__controllers,(function(t){t.updateDisplay()})),Lt.each(this.__folders,(function(t){t.updateDisplay()}))}});var He=Se;let Xe;var je;je=()=>{Xe=new Ot,Xe.ready=()=>{!function(){var t,e;null===(t=document.getElementById("message"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("canvasGL"))||void 0===e||e.classList.remove("transparent"),setTimeout((()=>{var t;return null===(t=document.querySelector(".promo"))||void 0===t?void 0:t.classList.remove("transparent")}),4e3),setTimeout((()=>{var t;return null===(t=document.querySelector("#toggleFullscreen"))||void 0===t?void 0:t.classList.remove("transparent")}),1800);const i=new He;i.add(Xe.config,"preset",{Sunrise:0,Day:1,Sunset:2,Night:3}).onChange((t=>Xe.changeScene(t))),i.add(Xe.config,"heightOffset",0,20),i.add(Xe.config,"treesHeightOffset",4,15),i.add(Xe.config,"grassAmount",0,5).step(.1),i.add(Xe.config,"fogStartDistance",0,150),i.add(Xe.config,"fogDistance",0,200),i.add(Xe.config,"fogHeightOffset",-5,5),i.add(Xe.config,"fogHeightMultiplier",0,1).step(.01)}()},Xe.init("canvasGL",!0);const e=document.getElementById("canvasGL");new Dt(Xe,{canvas:e,movementSpeed:35,rotationSpeed:.006});const i=new t;document.getElementById("toggleFullscreen").addEventListener("click",(()=>{document.body.classList.contains("fs")?i.exitFullScreen():i.enterFullScreen(),i.addFullScreenListener((function(){i.isFullScreen()?document.body.classList.add("fs"):document.body.classList.remove("fs")}))}))},"loading"!==document.readyState?je():document.addEventListener("DOMContentLoaded",je);
//# sourceMappingURL=index.min.js.map
